function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==typeof t?t:t+""}function _toPrimitive(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}!function(e,t){"object"==typeof exports&&typeof module<"u"?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=typeof globalThis<"u"?globalThis:e||self).InVideoRenderer=t()}(this,function(){"use strict";var e=Object.defineProperty,t=(t,n,i)=>((t,n,i)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i)(t,"symbol"!=typeof n?n+"":n,i),n=document.createElement("style");function i(e,t){for(var n=0;n<t.length;n++){const i=t[n];if("string"!=typeof i&&!Array.isArray(i))for(const t in i)if("default"!==t&&!(t in e)){const n=Object.getOwnPropertyDescriptor(i,t);n&&Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:()=>i[t]})}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}n.textContent=".suggested_tile_grid{--thumbnail-height: 120px}.suggested_tile_grid{position:absolute;left:0;width:100%;z-index:100;display:flex;height:var(--thumbnail-height);overflow-x:auto;overflow-y:hidden;justify-content:flex-start;bottom:53px;top:initial;column-gap:10px;row-gap:10px;white-space:nowrap}.suggested_tile{aspect-ratio:16/9;display:flex;justify-content:center;align-items:center;position:relative;border-radius:2px;flex-shrink:0;width:calc(var(--thumbnail-height) * (16/9));height:var(--thumbnail-height)}.suggested_tile img{height:-webkit-fill-available}.suggested_tile_image{max-width:100%;max-height:100%}.suggested_tile:first-child{margin-left:20px}.suggested_tile:last-child{margin-right:20px}.suggested_tile_overlay{position:absolute;width:100%;height:100%;background:#0009;color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;opacity:0;transition:opacity .25s}.suggested_tile_overlay .suggested_tile_title{position:absolute;bottom:0;left:10px}.suggested_tile_overlay--blur{-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px)}.suggested_tile_overlay>*{transform:translateY(20px);transition:transform .25s}.suggested_tile_overlay:hover{opacity:1}.suggested_tile_overlay:hover>*{transform:translateY(0)}.suggested_tile:hover{cursor:pointer}@media only screen and (max-width: 600px) and (orientation: portrait){.suggested_tile_grid{display:none}}@media only screen and (min-width: 992px){.suggested_tile_grid{position:absolute;left:0;top:0;width:100%;height:calc(100% - 53px);display:grid;grid-template-columns:repeat(3,20%);grid-template-rows:min-content min-content;column-gap:40px;row-gap:10px;z-index:100;align-content:center;justify-content:center}.suggested_tile:nth-child(n+7){display:none}.suggested_tile:first-child{margin-left:0}.suggested_tile:last-child{margin-right:0}}@media only screen and (min-width: 1200px){.suggested_tile_grid{grid-template-columns:repeat(4,20%);column-gap:10px}.suggested_tile{width:initial;height:initial}.suggested_tile:nth-child(n+7){display:flex}}.fluid_sub_menu_button{position:relative;cursor:pointer;padding:0 20px;border-bottom:1px solid #e0e0e0}.fluid_sub_menu_button.arrow-right:after{content:\"▶\";position:absolute;right:5px;top:50%;transform:translateY(-50%);font-size:12px;color:#fff}.fluid_sub_menu_button.arrow-left:before{content:\"◀\";position:absolute;left:5px;top:50%;transform:translateY(-50%);font-size:12px;color:#fff}.fluid_video_wrapper{animation:none;animation-delay:0;animation-direction:normal;animation-duration:0;animation-fill-mode:none;animation-iteration-count:1;animation-name:none;animation-play-state:running;animation-timing-function:ease;backface-visibility:visible;background:0;background-attachment:scroll;background-clip:border-box;background-color:transparent;background-image:none;background-origin:padding-box;background-position:0 0;background-position-x:0;background-position-y:0;background-repeat:repeat;background-size:auto auto;border:0;border-style:none;border-width:medium;border-color:inherit;border-bottom:0;border-bottom-color:inherit;border-bottom-style:none;border-bottom-width:medium;border-collapse:separate;border-image:none;border-left:0;border-left-color:inherit;border-left-style:none;border-left-width:medium;border-radius:0;border-right:0;border-right-color:inherit;border-right-style:none;border-right-width:medium;border-spacing:0;border-top:0;border-top-color:inherit;border-top-style:none;border-top-width:medium;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:inherit;columns:auto;column-count:auto;column-fill:balance;column-gap:normal;column-rule:medium none currentColor;column-rule-color:currentColor;column-rule-style:none;column-rule-width:none;column-span:1;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font:normal;font-family:-apple-system,BlinkMacSystemFont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,arial,sans-serif,\"apple color emoji\",\"segoe ui emoji\",segoe ui symbol;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;line-height:normal;list-style:none;list-style-image:none;list-style-position:outside;list-style-type:disc;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:0;outline:0;outline-color:invert;outline-style:none;outline-width:medium;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;perspective:none;perspective-origin:50% 50%;position:static;quotes:\"“\" \"”\" \"‘\" \"’\";right:auto;-moz-tab-size:8;tab-size:8;table-layout:auto;text-align:inherit;text-align-last:auto;text-decoration:none;text-decoration-color:inherit;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-shadow:none;text-transform:none;top:auto;transform:none;transform-style:flat;transition:none;transition-delay:0s;transition-duration:0s;transition-property:none;transition-timing-function:ease;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:0;width:auto;word-spacing:normal;z-index:auto;-webkit-tap-highlight-color:transparent}.fluid_video_wrapper canvas{pointer-events:none}.fluid_video_wrapper,.fluid_video_wrapper *{box-sizing:content-box}.fluid_video_wrapper:after,.fluid_video_wrapper:before{content:none}.fluid_video_wrapper{position:relative;display:inline-block}.fluid_video_wrapper video{position:relative;background-color:#000;display:block}.fluid_video_wrapper .vast_video_loading{display:table;text-align:center;width:100%;height:100%;top:0;left:0;pointer-events:auto;z-index:1}.fluid_video_wrapper .vast_video_loading:before{background-image:url(\"data:image/svg+xml,%3csvg%20class='lds-eclipse'%20width='200'%20height='200'%20style='background:0%200'%20preserveAspectRatio='xMidYMid'%20viewBox='0%200%20100%20100'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M68.095%2059.578A20%2020%200%200031.14%2044.27a22%2020-67.5%200136.955%2015.308'%20fill='%23fff'%3e%3canimateTransform%20attributeName='transform'%20begin='0s'%20calcMode='linear'%20dur='0.8s'%20keyTimes='0;1'%20repeatCount='indefinite'%20type='rotate'%20values='0%2050%2051;360%2050%2051'/%3e%3c/path%3e%3c/svg%3e\");background-position:center,center;background-repeat:no-repeat,repeat;background-color:#0003;content:\"\";position:absolute;height:100%;width:100%;top:0;left:0}.skip_button{position:absolute;bottom:50px;right:0;background-color:#000000b3;padding:13px 21px}.skip_button,.skip_button a{color:#fff;text-decoration:none;cursor:pointer;z-index:10;font-size:13px;font-family:-apple-system,BlinkMacSystemFont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,arial,sans-serif,\"apple color emoji\",\"segoe ui emoji\",segoe ui symbol;font-weight:400;white-space:nowrap;text-align:start}.skip_button a span.skip_button_icon{display:inline-block;text-align:left;width:21px;position:relative;bottom:20px}.skip_button a span.skip_button_icon:before{background:url(\"data:image/svg+xml,%3csvg%20xmlns:xlink='http://www.w3.org/1999/xlink'%20xmlns='http://www.w3.org/2000/svg'%20width='388.75'%20height='96'%20version='1.1'%20viewBox='0%200%20388.75%2096'%20id='svg63'%3e%3cpath%20id='path4087'%20d='m%20347.64062,35.959%20a%206.9826789,6.9826789%200%200%200%206.98438,-6.984375%206.9826789,6.9826789%200%200%200%20-6.98438,-6.982422%206.9826789,6.9826789%200%200%200%20-6.98242,6.982422%206.9826789,6.9826789%200%200%200%206.98242,6.984375%20z%20m%200,-2.476562%20a%204.5078053,4.5078053%200%200%201%20-4.50781,-4.507813%204.5078053,4.5078053%200%200%201%204.50781,-4.507812%204.5078053,4.5078053%200%200%201%204.50781,4.507812%204.5078053,4.5078053%200%200%201%20-4.50781,4.507813%20z'%20style='fill:%23ffffff;fill-opacity:1;stroke-width:1.70873225'%20/%3e%3cpath%20style='fill:%23ffffff;fill-opacity:1;stroke-width:1.00886583'%20d='M%20273.55469,22%20C%20272.69375,22%20272,22.693749%20272,23.554688%20V%2034.445312%20C%20272,35.306251%20272.69375,36%20273.55469,36%20h%2010.89062%20C%20285.30625,36%20286,35.306251%20286,34.445312%20V%2023.554688%20C%20286,22.693749%20285.30625,22%20284.44531,22%20Z%20m%203.61133,4.541016%20c%200.22916,0%200.45442,0.02083%200.67578,0.0625%200.22396,0.03906%200.44661,0.09896%200.66797,0.179687%20v%201.140625%20c%20-0.19011,-0.130208%20-0.38151,-0.226562%20-0.57422,-0.289062%20-0.19011,-0.0625%20-0.38802,-0.09375%20-0.59375,-0.09375%20-0.39063,0%20-0.69532,0.114583%20-0.91407,0.34375%20-0.21614,0.226562%20-0.32421,0.54427%20-0.32421,0.953125%200,0.408854%200.10807,0.727864%200.32421,0.957031%200.21875,0.226562%200.52344,0.339844%200.91407,0.339844%200.21875,0%200.42578,-0.03255%200.62109,-0.09766%200.19792,-0.0651%200.38021,-0.161458%200.54688,-0.289062%20v%201.144531%20c%20-0.21875,0.08073%20-0.44141,0.140625%20-0.66797,0.179688%20-0.22396,0.04167%20-0.44922,0.0625%20-0.67578,0.0625%20-0.78907,0%20-1.40625,-0.201823%20-1.85157,-0.605469%20-0.44531,-0.40625%20-0.66797,-0.970052%20-0.66797,-1.691406%200,-0.721355%200.22266,-1.283855%200.66797,-1.6875%200.44532,-0.40625%201.0625,-0.609375%201.85157,-0.609375%20z%20m%204.75,0%20c%200.22916,0%200.45442,0.02083%200.67578,0.0625%200.22396,0.03906%200.44661,0.09896%200.66797,0.179687%20v%201.140625%20c%20-0.19011,-0.130208%20-0.38151,-0.226562%20-0.57422,-0.289062%20-0.19011,-0.0625%20-0.38802,-0.09375%20-0.59375,-0.09375%20-0.39063,0%20-0.69532,0.114583%20-0.91407,0.34375%20-0.21614,0.226562%20-0.32421,0.54427%20-0.32421,0.953125%200,0.408854%200.10807,0.727864%200.32421,0.957031%200.21875,0.226562%200.52344,0.339844%200.91407,0.339844%200.21875,0%200.42578,-0.03255%200.62109,-0.09766%200.19792,-0.0651%200.38021,-0.161458%200.54688,-0.289062%20v%201.144531%20c%20-0.21875,0.08073%20-0.44141,0.140625%20-0.66797,0.179688%20-0.22396,0.04167%20-0.44922,0.0625%20-0.67578,0.0625%20-0.78907,0%20-1.40625,-0.201823%20-1.85157,-0.605469%20-0.44531,-0.40625%20-0.66797,-0.970052%20-0.66797,-1.691406%200,-0.721355%200.22266,-1.283855%200.66797,-1.6875%200.44532,-0.40625%201.0625,-0.609375%201.85157,-0.609375%20z'%20id='rect7816'%20/%3e%3cg%20transform='translate(-3702,106)'%20id='g44'%3e%3cclipPath%20id='q'%20style='clip-rule:evenodd'%3e%3cpath%20d='m%203702,-106%20h%20272%20v%2096%20h%20-272%20z'%20id='path6'%20style='fill:%23ffffff'/%3e%3c/clipPath%3e%3cg%20clip-path='url(%23q)'%20id='g42'%3e%3cuse%20transform='translate(3757,-86)'%20xlink:href='%23o'%20id='use9'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3757,-48)'%20xlink:href='%23i'%20id='use11'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3830,-84)'%20xlink:href='%23h'%20id='use13'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3723,-86)'%20xlink:href='%23g'%20id='use15'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3723,-48)'%20xlink:href='%23f'%20id='use17'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3795,-46)'%20xlink:href='%23e'%20id='use19'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3831,-46)'%20xlink:href='%23d'%20id='use21'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3865,-44)'%20xlink:href='%23c'%20id='use23'%20style='fill:%23f2c94c'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3795,-84)'%20xlink:href='%23b'%20id='use25'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3866,-83)'%20xlink:href='%23a'%20id='use27'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3939,-47)'%20xlink:href='%23n'%20id='use29'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cmask%20id='p'%3e%3cuse%20transform='translate(3902,-46)'%20xlink:href='%23m'%20id='use31'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3c/mask%3e%3cg%20mask='url(%23p)'%20id='g36'%3e%3cuse%20transform='translate(3902,-46)'%20xlink:href='%23l'%20id='use34'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3c/g%3e%3cuse%20transform='translate(3904,-85)'%20xlink:href='%23k'%20id='use38'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3939,-85)'%20xlink:href='%23j'%20id='use40'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3c/g%3e%3c/g%3e%3cdefs%20id='defs61'%3e%3cpath%20id='o'%20d='m%200,5.5924%20v%205.8152%20H%203.7778%20L%208.5,16.2537%20V%200.7467%20L%203.7778,5.5928%20H%200%20Z%20M%2012.75,8.5%20c%200,-1.7155%20-0.9633,-3.1887%20-2.3611,-3.9059%20v%207.8021%20C%2011.7867,11.6887%2012.75,10.2155%2012.75,8.5%20Z%20M%2010.3889,0%20v%201.9966%20c%202.7294,0.83352%204.7222,3.431%204.7222,6.5034%200,3.0724%20-1.9928,5.6699%20-4.7222,6.5034%20V%2017%20C%2014.1761,16.118%2017,12.6482%2017,8.5%2017,4.3518%2014.1761,0.882%2010.3889,0%20Z'%20/%3e%3cpath%20id='i'%20d='m%2012.75,8.5%20c%200,-1.6717%20-0.9633,-3.1072%20-2.3611,-3.8061%20V%206.7811%20L%2012.7028,9.095%20C%2012.7311,8.90611%2012.75,8.70778%2012.75,8.5%20Z%20m%202.3611,0%20c%200,0.88778%20-0.1889,1.7189%20-0.51,2.4933%20l%201.4261,1.4261%20C%2016.6506,11.2483%2017,9.9167%2017,8.5%2017,4.4578%2014.1761,1.0767%2010.3889,0.2172%20V%202.1628%20C%2013.1183,2.97502%2015.1111,5.5061%2015.1111,8.5%20Z%20M%201.1991,0%20-3e-4,1.1994%204.4669,5.6666%20H%20-3e-4%20v%205.6666%20h%203.7778%20l%204.7222,4.7223%20V%209.6993%20l%204.0139,4.0139%20c%20-0.6328,0.4911%20-1.3411,0.8784%20-2.125,1.1145%20v%201.9455%20c%201.3033,-0.2927%202.4839,-0.8972%203.485,-1.7094%20l%201.9267,1.9361%201.1994,-1.1994%20-8.5,-8.5%20L%201.1991,-1e-4%20Z%20m%207.3006,0.94444%20-1.9739,1.9739%201.9739,1.9739%20z'%20/%3e%3cpath%20id='h'%20d='M%2012.444,0%20H%201.555%20C%200.69166,0%20-6e-4,0.7%20-6e-4,1.5556%20v%2010.889%20c%200,0.8556%200.69222,1.5556%201.5556,1.5556%20h%2010.889%20c%200.8556,0%201.5556,-0.7%201.5556,-1.5556%20V%201.5556%20C%2013.9996,0.70004%2013.2996,0%2012.444,0%20Z%20M%206.2218,9.3333%20H%205.0551%20V%207.7777%20H%203.4995%20V%209.3333%20H%202.3328%20V%204.6666%20H%203.4995%20V%206.611%20H%205.0551%20V%204.6666%20H%206.2218%20Z%20M%207.7774,4.6666%20h%203.1111%20c%200.4278,0%200.7778,0.35%200.7778,0.77777%20v%203.1111%20c%200,0.42777%20-0.35,0.77777%20-0.7778,0.77777%20H%207.7774%20v%20-4.6667%20z%20m%201.1667,3.5%20h%201.5556%20V%205.8333%20H%208.9441%20Z'%20/%3e%3cpath%20id='g'%20d='M%200,0%20V%2017%20L%2013,8.5%20Z'%20/%3e%3cpath%20id='f'%20d='M%200,17%20H%204.3333%20V%200%20H%200%20Z%20M%208.6667,0%20V%2017%20H%2013%20V%200%20Z'%20/%3e%3cpath%20id='e'%20d='m%200,11%20h%203%20v%203%20H%205%20V%209%20H%200%20Z%20M%203,3%20H%200%20V%205%20H%205%20V%200%20H%203%20Z%20m%206,11%20h%202%20v%20-3%20h%203%20V%209%20H%209%20Z%20M%2011,3%20V%200%20H%209%20v%205%20h%205%20V%203%20Z'%20/%3e%3cpath%20id='d'%20d='M%200,12%208.5,6%200,0%20Z%20M%2010,0%20v%2012%20h%202%20V%200%20Z'%20/%3e%3cpath%20id='c'%20d='M%201.52,4.5%20C%201.52,2.961%202.632,1.71%204,1.71%20H%207.2%20V%200%20H%204%20C%201.792,0%200,2.016%200,4.5%200,6.984%201.792,9%204,9%20H%207.2%20V%207.29%20H%204%20C%202.632,7.29%201.52,6.039%201.52,4.5%20Z%20M%204.8,5.4%20h%206.4%20V%203.6%20H%204.8%20Z%20M%2012,0%20H%208.8%20V%201.71%20H%2012%20c%201.368,0%202.48,1.251%202.48,2.79%200,1.539%20-1.112,2.79%20-2.48,2.79%20H%208.8%20V%209%20H%2012%20C%2014.208,9%2016,6.984%2016,4.5%2016,2.016%2014.208,0%2012,0%20Z'%20/%3e%3cpath%20id='b'%20d='M%202,9%20H%200%20v%205%20H%205%20V%2012%20H%202%20Z%20M%200,5%20H%202%20V%202%20H%205%20V%200%20H%200%20Z%20m%2012,7%20H%209%20v%202%20h%205%20V%209%20H%2012%20Z%20M%209,0%20v%202%20h%203%20v%203%20h%202%20V%200%20Z'%20/%3e%3cpath%20id='a'%20d='M%204.4546,8.7015%201.1137,5.2537%201e-4,6.403%204.4546,11%2014,1.1492%2012.8864,-1e-4%204.4546,8.7014%20Z'%20/%3e%3cpath%20id='n'%20d='M%2012.348,7.686%20C%2012.3768,7.462%2012.3984,7.238%2012.3984,7%2012.3984,6.762%2012.3768,6.538%2012.348,6.314%20L%2013.8664,5.159%20C%2014.0032,5.054%2014.0391,4.865%2013.9528,4.711%20L%2012.5135,2.289%20C%2012.4272,2.135%2012.2329,2.079%2012.0745,2.135%20l%20-1.7919,0.7%20C%209.90842,2.555%209.50543,2.324%209.0664,2.149%20L%208.79294,0.294%20C%208.77135,0.126%208.62022,0%208.44031,0%20H%205.56171%20C%205.38181,0%205.23068,0.126%205.20909,0.294%20L%204.93563,2.149%20C%204.49665,2.324%204.09365,2.562%203.71943,2.835%20l%20-1.7919,-0.7%20C%201.76201,2.072%201.5749,2.135%201.48855,2.289%20l%20-1.4393,2.422%20c%20-0.093553,0.154%20-0.050374,0.343%200.086356,0.448%20l%201.5184,1.155%20C%201.625226,6.538%201.603636,6.769%201.603636,7%20c%200,0.231%200.02159,0.462%200.05037,0.686%20l%20-1.5184,1.155%20c%20-0.13673,0.105%20-0.17271,0.294%20-0.086356,0.448%20l%201.4393,2.422%20c%200.08635,0.154%200.28066,0.21%200.43898,0.154%20l%201.7919,-0.7%20c%200.37421,0.28%200.77721,0.511%201.2162,0.686%20l%200.27346,1.855%20C%205.23068,13.874%205.38181,14%205.56171,14%20h%202.8786%20c%200.17991,0%200.33104,-0.126%200.35263,-0.294%20L%209.0664,11.851%20c%200.43898,-0.175%200.84197,-0.413%201.2162,-0.686%20l%201.7919,0.7%20c%200.1655,0.063%200.3527,0%200.439,-0.154%20L%2013.9528,9.289%20C%2014.0391,9.135%2014.0032,8.946%2013.8664,8.841%20Z%20M%207.0011,9.45%20C%205.6122,9.45%204.4824,8.351%204.4824,7%204.4824,5.649%205.6122,4.55%207.0011,4.55%208.39,4.55%209.5198,5.649%209.5198,7%209.5198,8.351%208.39,9.45%207.0011,9.45%20Z'%20/%3e%3cpath%20id='m'%20d='M%200,0%20H%2016%20V%2012%20H%200%20Z'%20/%3e%3cpath%20id='l'%20d='m%200,0%20v%20-2%20h%20-2%20v%202%20z%20m%2016,0%20h%202%20v%20-2%20h%20-2%20z%20m%200,12%20v%202%20h%202%20V%2012%20Z%20M%200,12%20h%20-2%20v%202%20H%200%20Z%20M%200,2%20H%2016%20V%20-2%20H%200%20Z%20M%2014,0%20v%2012%20h%204%20V%200%20Z%20m%202,10%20H%200%20v%204%20H%2016%20Z%20M%202,12%20V%200%20h%20-4%20v%2012%20z'%20/%3e%3cpath%20id='k'%20d='M%2012,5.2941%20H%208.5714%20V%200%20H%203.4285%20V%205.2941%20H%20-1e-4%20l%206,6.1765%206,-6.1765%20z%20M%200,13.2353%20V%2015%20h%2012%20v%20-1.7647%20z'%20/%3e%3cpath%20id='j'%20d='M%209.3333,0%20H%204.6666%20V%201.5238%20H%209.3333%20Z%20M%206.2222,9.9048%20H%207.7778%20V%205.3334%20H%206.2222%20Z%20M%2012.4678,4.8686%2013.5722,3.7867%20C%2013.2378,3.39813%2012.8722,3.03241%2012.4756,2.7124%20L%2011.3711,3.7943%20C%2010.1656,2.84953%208.6489,2.2857%207,2.2857%203.1344,2.2857%200,5.3562%200,9.1429%200,12.9295%203.1267,16%207,16%2010.8733,16%2014,12.9295%2014,9.1429%2014,7.5277%2013.4244,6.0419%2012.4678,4.8686%20Z%20M%207,14.4762%20C%203.99,14.4762%201.5556,12.0914%201.5556,9.1429%201.5556,6.1943%203.99,3.8096%207,3.8096%20c%203.01,0%205.4444,2.3848%205.4444,5.3333%200,2.9485%20-2.4344,5.3333%20-5.4444,5.3333%20z'%20/%3e%3c/defs%3e%3cg%20id='g3989'%20transform='matrix(0.03107656,0,0,0.03432918,271.52581,57.128037)'%20style='fill:%23ffffff'%3e%3cg%20id='g3979'%20style='fill:%23ffffff'%3e%3cpath%20style='fill:%23ffffff;stroke-width:0.03266241'%20d='m%20273.49023,60.4375%20c%20-1.07158,0%20-1.96484,0.958273%20-1.96484,2.169922%20v%206.61914%20c%200,1.216352%200.89727,2.167935%201.96484,2.167969%20h%202.87305%20c%200.52417,0%201.01765,-0.2246%201.39063,-0.634765%20l%201,-1.103516%20c%200.19059,-0.211639%200.45448,-0.333984%200.72656,-0.333984%200.27207,0%200.53829,0.122547%200.73047,0.335937%20l%200.99804,1.101563%20c%200.37212,0.409203%200.86646,0.634765%201.39063,0.634765%20h%202.87305%20c%201.07158,0%201.96484,-0.95632%201.96484,-2.167969%20v%20-6.61914%20c%200,-1.216352%20-0.89727,-2.169922%20-1.96484,-2.169922%20z%20m%202.4961,3.308594%20c%201.08295,0%201.96484,0.973618%201.96484,2.169922%200,1.196303%20-0.88185,2.169921%20-1.96484,2.169922%20-1.08299,0%20-1.96485,-0.973619%20-1.96485,-2.169922%200,-1.196304%200.88189,-2.169922%201.96485,-2.169922%20z%20m%206.99023,0%20c%201.08296,0%201.96485,0.973618%201.96485,2.169922%200,1.196303%20-0.88189,2.169922%20-1.96485,2.169922%20-1.08298,0%20-1.96484,-0.973619%20-1.96484,-2.169922%200,-1.196304%200.88189,-2.169922%201.96484,-2.169922%20z'%20transform='matrix(32.178594,0,0,29.129737,-8737.3187,-1664.1247)'%20id='path3977'%20/%3e%3c/g%3e%3cg%20id='g3983'%20style='fill:%23ffffff'/%3e%3cg%20id='g3987'%20style='fill:%23ffffff'/%3e%3c/g%3e%3cpath%20style='fill:%23ffffff;fill-opacity:1'%20d='M%20317.03125%2021.992188%20A%206.9826789%206.9826789%200%200%200%20310.04883%2028.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2035.958984%20A%206.9826789%206.9826789%200%200%200%20324.01367%2028.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2021.992188%20z%20M%20312.20703%2027.580078%20L%20321.94336%2027.642578%20C%20322.32865%2027.645013%20322.63647%2027.956519%20322.63281%2028.341797%20L%20322.62109%2029.603516%20C%20322.61743%2029.988794%20322.30326%2030.297356%20321.91797%2030.294922%20L%20312.18164%2030.232422%20C%20311.79635%2030.229987%20311.48853%2029.918481%20311.49219%2029.533203%20L%20311.50391%2028.271484%20C%20311.50757%2027.886206%20311.82174%2027.577644%20312.20703%2027.580078%20z%20'%20id='path3997'/%3e%3cpath%20style='fill:%23ffffff;fill-opacity:1'%20d='M%20317.03125%2059.992188%20A%206.9826789%206.9826789%200%200%200%20310.04883%2066.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2073.958984%20A%206.9826789%206.9826789%200%200%200%20324.01367%2066.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2059.992188%20z%20M%20316.49805%2061.365234%20L%20317.76172%2061.382812%20C%20318.14697%2061.388692%20318.45192%2061.704576%20318.44727%2062.089844%20L%20318.4043%2065.619141%20L%20321.94336%2065.642578%20C%20322.32865%2065.645013%20322.63647%2065.956519%20322.63281%2066.341797%20L%20322.62109%2067.603516%20C%20322.61743%2067.988794%20322.30326%2068.297356%20321.91797%2068.294922%20L%20318.37305%2068.271484%20L%20318.33008%2071.826172%20C%20318.32543%2072.21144%20318.0122%2072.515645%20317.62695%2072.509766%20L%20316.36328%2072.492188%20C%20315.97803%2072.486309%20315.67308%2072.170424%20315.67773%2071.785156%20L%20315.7207%2068.255859%20L%20312.18164%2068.232422%20C%20311.79635%2068.229987%20311.48853%2067.918481%20311.49219%2067.533203%20L%20311.50391%2066.271484%20C%20311.50757%2065.886206%20311.82174%2065.577644%20312.20703%2065.580078%20L%20315.75195%2065.603516%20L%20315.79492%2062.048828%20C%20315.79957%2061.66356%20316.1128%2061.359355%20316.49805%2061.365234%20z%20'%20id='path3997-6'/%3e%3cellipse%20style='fill:%23800000;fill-opacity:1;stroke-width:1.10310566'%20id='circle4073'%20cx='353.64172'%20cy='-28.97954'%20transform='scale(1,-1)'%20/%3e%3cg%20id='g7787'%20transform='matrix(-0.02885349,0,0,-0.02885337,352.04486,75.172258)'%20style='fill:%23ffffff;fill-opacity:1'%3e%3cg%20id='g7731'%20transform='translate(-90.566882,42.049084)'%20style='fill:%23ffffff;fill-opacity:1'%3e%3cpath%20id='path7729'%20d='M%20242.607,0%20C%20108.629,0%200.001,108.628%200.001,242.606%20c%200,133.976%20108.628,242.606%20242.606,242.606%20133.978,0%20242.604,-108.631%20242.604,-242.606%20C%20485.212,108.628%20376.585,0%20242.607,0%20Z%20M%20401.815,288.094%20H%20219.862%20v%2090.979%20L%2083.397,242.606%20219.862,106.141%20v%2090.978%20h%20181.953%20z'%20style='fill:%23ffffff;fill-opacity:1'/%3e%3c/g%3e%3cg%20id='g7733'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7735'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7737'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7739'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7741'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7743'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7745'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7747'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7749'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7751'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7753'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7755'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7757'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7759'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7761'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3c/g%3e%3c/svg%3e\") no-repeat;position:absolute;height:18px;width:18px;top:6px;content:\"\";opacity:.8;transition:opacity .3s ease-in-out;background-position:-122px -57px}.skip_button a span.skip_button_icon:before:hover{opacity:1}.skip_button_disabled{cursor:default!important;padding:13px 21px}.close_button{position:absolute;background:#000 url(\"data:image/svg+xml,%3csvg%20fill='%23FFF'%20height='24'%20width='24'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M19%206.41L17.59%205%2012%2010.59%206.41%205%205%206.41%2010.59%2012%205%2017.59%206.41%2019%2012%2013.41%2017.59%2019%2019%2017.59%2013.41%2012z'/%3e%3cpath%20d='M0%200h24v24H0z'%20fill='none'/%3e%3c/svg%3e\") no-repeat scroll center center;height:16px;width:16px;top:0;right:0;background-size:18px 18px;cursor:pointer;padding:1px;z-index:31}.close_button:hover{background-color:#000;border:1px solid #ffffff}.vast_clickthrough_layer{background-color:#fff;opacity:0}.fluid_ad_playing{position:absolute;background-color:#000;opacity:.8;border-radius:1px;color:#fff;font-size:13px;font-family:-apple-system,BlinkMacSystemFont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,arial,sans-serif,\"apple color emoji\",\"segoe ui emoji\",segoe ui symbol;font-weight:400;white-space:nowrap;text-align:start;line-height:18px;z-index:10;padding:13px 21px}.fluid_ad_cta{position:absolute;background-color:#000000b3;color:#fff;font-size:13px;font-family:-apple-system,BlinkMacSystemFont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,arial,sans-serif,\"apple color emoji\",\"segoe ui emoji\",segoe ui symbol;font-weight:400;text-align:right;cursor:pointer;z-index:10;padding:13px 21px 13px 13px;max-width:50%}.fluid_ad_cta.left{text-align:left}.fluid_ad_cta a{text-decoration:none;color:#fff;line-height:18px}.fluid_ad_cta:hover,.skip_button:not(.skip_button_disabled):hover{background-color:#000}.fluid_html_on_pause,.fluid_html_on_pause_container,.fluid_pseudo_poster{position:absolute;top:0;right:0;bottom:0;left:0;margin:auto;z-index:0;display:flex;flex-direction:column;justify-content:center;align-items:center;pointer-events:none}.fluid_html_on_pause_container *,.fluid_html_on_pause *{pointer-events:auto}.fluid_video_wrapper.mobile .skip_button{bottom:50px}.fluid_initial_play{width:60px;height:60px;border-radius:50px;cursor:pointer}.fluid_initial_play_button{margin-top:15px;margin-left:23px;border-style:solid;border-width:15px 0 15px 21px;border-color:transparent transparent transparent #ffffff}.fluid_initial_pause_button{margin-top:15px;margin-left:17px;width:8px;height:31px;border:9px solid white;border-top:0;border-bottom:0}.fluid_timeline_preview{bottom:11px;color:#fff;font-size:13px;line-height:18px;font-family:-apple-system,BlinkMacSystemFont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,arial,sans-serif,\"apple color emoji\",\"segoe ui emoji\",segoe ui symbol;font-weight:400;text-align:start;padding:13px 21px;background-color:#000000d9;border-radius:1px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_fluid_control_duration{display:inline-block;white-space:nowrap;height:24px;font-family:-apple-system,BlinkMacSystemFont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,arial,sans-serif,\"apple color emoji\",\"segoe ui emoji\",segoe ui symbol;font-size:13px;font-weight:400;font-style:normal;text-align:left;text-decoration:none;line-height:21px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_fluid_control_duration.cardboard_time{left:13px;top:-15px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_fluid_control_duration.cardboard_time .ad_timer_prefix,.fluid_video_wrapper.fluid_player_layout_default .ad_countdown .ad_timer_prefix{color:#f2c94c}.fluid_video_wrapper.fluid_player_layout_default .ad_countdown{position:absolute;right:0;width:75px;bottom:5px;height:24px;color:red;font-family:-apple-system,BlinkMacSystemFont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,arial,sans-serif,\"apple color emoji\",\"segoe ui emoji\",segoe ui symbol;font-size:13px;font-weight:400;font-style:normal;text-align:left;text-decoration:none;line-height:21px}.initial_controls_show{visibility:visible!important;opacity:1!important}.fluid_video_wrapper.fluid_player_layout_default .fluid_vr_container{color:#fff;position:absolute;bottom:0;left:0;right:0;background:linear-gradient(to bottom,#0000,#0009);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=\"#00000000\",endColorstr=\"#ad000000\",GradientType=0);height:100%;width:100%;z-index:0;pointer-events:none}.fluid_video_wrapper.fluid_player_layout_default .fluid_vr_container .fluid_vr_joystick_panel{height:96px;width:72px;left:10px;top:10px;position:absolute;background:#000000b3;text-align:center;border-radius:6px;overflow:hidden;pointer-events:auto}.fluid_video_wrapper.fluid_player_layout_default .fluid_vr_container .fluid_vr_joystick_panel .fluid_vr_button{cursor:pointer;display:inline-block;text-align:left;height:24px;width:24px;position:relative;background:url(\"data:image/svg+xml,%3csvg%20xmlns:xlink='http://www.w3.org/1999/xlink'%20xmlns='http://www.w3.org/2000/svg'%20width='388.75'%20height='96'%20version='1.1'%20viewBox='0%200%20388.75%2096'%20id='svg63'%3e%3cpath%20id='path4087'%20d='m%20347.64062,35.959%20a%206.9826789,6.9826789%200%200%200%206.98438,-6.984375%206.9826789,6.9826789%200%200%200%20-6.98438,-6.982422%206.9826789,6.9826789%200%200%200%20-6.98242,6.982422%206.9826789,6.9826789%200%200%200%206.98242,6.984375%20z%20m%200,-2.476562%20a%204.5078053,4.5078053%200%200%201%20-4.50781,-4.507813%204.5078053,4.5078053%200%200%201%204.50781,-4.507812%204.5078053,4.5078053%200%200%201%204.50781,4.507812%204.5078053,4.5078053%200%200%201%20-4.50781,4.507813%20z'%20style='fill:%23ffffff;fill-opacity:1;stroke-width:1.70873225'%20/%3e%3cpath%20style='fill:%23ffffff;fill-opacity:1;stroke-width:1.00886583'%20d='M%20273.55469,22%20C%20272.69375,22%20272,22.693749%20272,23.554688%20V%2034.445312%20C%20272,35.306251%20272.69375,36%20273.55469,36%20h%2010.89062%20C%20285.30625,36%20286,35.306251%20286,34.445312%20V%2023.554688%20C%20286,22.693749%20285.30625,22%20284.44531,22%20Z%20m%203.61133,4.541016%20c%200.22916,0%200.45442,0.02083%200.67578,0.0625%200.22396,0.03906%200.44661,0.09896%200.66797,0.179687%20v%201.140625%20c%20-0.19011,-0.130208%20-0.38151,-0.226562%20-0.57422,-0.289062%20-0.19011,-0.0625%20-0.38802,-0.09375%20-0.59375,-0.09375%20-0.39063,0%20-0.69532,0.114583%20-0.91407,0.34375%20-0.21614,0.226562%20-0.32421,0.54427%20-0.32421,0.953125%200,0.408854%200.10807,0.727864%200.32421,0.957031%200.21875,0.226562%200.52344,0.339844%200.91407,0.339844%200.21875,0%200.42578,-0.03255%200.62109,-0.09766%200.19792,-0.0651%200.38021,-0.161458%200.54688,-0.289062%20v%201.144531%20c%20-0.21875,0.08073%20-0.44141,0.140625%20-0.66797,0.179688%20-0.22396,0.04167%20-0.44922,0.0625%20-0.67578,0.0625%20-0.78907,0%20-1.40625,-0.201823%20-1.85157,-0.605469%20-0.44531,-0.40625%20-0.66797,-0.970052%20-0.66797,-1.691406%200,-0.721355%200.22266,-1.283855%200.66797,-1.6875%200.44532,-0.40625%201.0625,-0.609375%201.85157,-0.609375%20z%20m%204.75,0%20c%200.22916,0%200.45442,0.02083%200.67578,0.0625%200.22396,0.03906%200.44661,0.09896%200.66797,0.179687%20v%201.140625%20c%20-0.19011,-0.130208%20-0.38151,-0.226562%20-0.57422,-0.289062%20-0.19011,-0.0625%20-0.38802,-0.09375%20-0.59375,-0.09375%20-0.39063,0%20-0.69532,0.114583%20-0.91407,0.34375%20-0.21614,0.226562%20-0.32421,0.54427%20-0.32421,0.953125%200,0.408854%200.10807,0.727864%200.32421,0.957031%200.21875,0.226562%200.52344,0.339844%200.91407,0.339844%200.21875,0%200.42578,-0.03255%200.62109,-0.09766%200.19792,-0.0651%200.38021,-0.161458%200.54688,-0.289062%20v%201.144531%20c%20-0.21875,0.08073%20-0.44141,0.140625%20-0.66797,0.179688%20-0.22396,0.04167%20-0.44922,0.0625%20-0.67578,0.0625%20-0.78907,0%20-1.40625,-0.201823%20-1.85157,-0.605469%20-0.44531,-0.40625%20-0.66797,-0.970052%20-0.66797,-1.691406%200,-0.721355%200.22266,-1.283855%200.66797,-1.6875%200.44532,-0.40625%201.0625,-0.609375%201.85157,-0.609375%20z'%20id='rect7816'%20/%3e%3cg%20transform='translate(-3702,106)'%20id='g44'%3e%3cclipPath%20id='q'%20style='clip-rule:evenodd'%3e%3cpath%20d='m%203702,-106%20h%20272%20v%2096%20h%20-272%20z'%20id='path6'%20style='fill:%23ffffff'/%3e%3c/clipPath%3e%3cg%20clip-path='url(%23q)'%20id='g42'%3e%3cuse%20transform='translate(3757,-86)'%20xlink:href='%23o'%20id='use9'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3757,-48)'%20xlink:href='%23i'%20id='use11'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3830,-84)'%20xlink:href='%23h'%20id='use13'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3723,-86)'%20xlink:href='%23g'%20id='use15'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3723,-48)'%20xlink:href='%23f'%20id='use17'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3795,-46)'%20xlink:href='%23e'%20id='use19'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3831,-46)'%20xlink:href='%23d'%20id='use21'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3865,-44)'%20xlink:href='%23c'%20id='use23'%20style='fill:%23f2c94c'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3795,-84)'%20xlink:href='%23b'%20id='use25'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3866,-83)'%20xlink:href='%23a'%20id='use27'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3939,-47)'%20xlink:href='%23n'%20id='use29'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cmask%20id='p'%3e%3cuse%20transform='translate(3902,-46)'%20xlink:href='%23m'%20id='use31'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3c/mask%3e%3cg%20mask='url(%23p)'%20id='g36'%3e%3cuse%20transform='translate(3902,-46)'%20xlink:href='%23l'%20id='use34'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3c/g%3e%3cuse%20transform='translate(3904,-85)'%20xlink:href='%23k'%20id='use38'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3939,-85)'%20xlink:href='%23j'%20id='use40'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3c/g%3e%3c/g%3e%3cdefs%20id='defs61'%3e%3cpath%20id='o'%20d='m%200,5.5924%20v%205.8152%20H%203.7778%20L%208.5,16.2537%20V%200.7467%20L%203.7778,5.5928%20H%200%20Z%20M%2012.75,8.5%20c%200,-1.7155%20-0.9633,-3.1887%20-2.3611,-3.9059%20v%207.8021%20C%2011.7867,11.6887%2012.75,10.2155%2012.75,8.5%20Z%20M%2010.3889,0%20v%201.9966%20c%202.7294,0.83352%204.7222,3.431%204.7222,6.5034%200,3.0724%20-1.9928,5.6699%20-4.7222,6.5034%20V%2017%20C%2014.1761,16.118%2017,12.6482%2017,8.5%2017,4.3518%2014.1761,0.882%2010.3889,0%20Z'%20/%3e%3cpath%20id='i'%20d='m%2012.75,8.5%20c%200,-1.6717%20-0.9633,-3.1072%20-2.3611,-3.8061%20V%206.7811%20L%2012.7028,9.095%20C%2012.7311,8.90611%2012.75,8.70778%2012.75,8.5%20Z%20m%202.3611,0%20c%200,0.88778%20-0.1889,1.7189%20-0.51,2.4933%20l%201.4261,1.4261%20C%2016.6506,11.2483%2017,9.9167%2017,8.5%2017,4.4578%2014.1761,1.0767%2010.3889,0.2172%20V%202.1628%20C%2013.1183,2.97502%2015.1111,5.5061%2015.1111,8.5%20Z%20M%201.1991,0%20-3e-4,1.1994%204.4669,5.6666%20H%20-3e-4%20v%205.6666%20h%203.7778%20l%204.7222,4.7223%20V%209.6993%20l%204.0139,4.0139%20c%20-0.6328,0.4911%20-1.3411,0.8784%20-2.125,1.1145%20v%201.9455%20c%201.3033,-0.2927%202.4839,-0.8972%203.485,-1.7094%20l%201.9267,1.9361%201.1994,-1.1994%20-8.5,-8.5%20L%201.1991,-1e-4%20Z%20m%207.3006,0.94444%20-1.9739,1.9739%201.9739,1.9739%20z'%20/%3e%3cpath%20id='h'%20d='M%2012.444,0%20H%201.555%20C%200.69166,0%20-6e-4,0.7%20-6e-4,1.5556%20v%2010.889%20c%200,0.8556%200.69222,1.5556%201.5556,1.5556%20h%2010.889%20c%200.8556,0%201.5556,-0.7%201.5556,-1.5556%20V%201.5556%20C%2013.9996,0.70004%2013.2996,0%2012.444,0%20Z%20M%206.2218,9.3333%20H%205.0551%20V%207.7777%20H%203.4995%20V%209.3333%20H%202.3328%20V%204.6666%20H%203.4995%20V%206.611%20H%205.0551%20V%204.6666%20H%206.2218%20Z%20M%207.7774,4.6666%20h%203.1111%20c%200.4278,0%200.7778,0.35%200.7778,0.77777%20v%203.1111%20c%200,0.42777%20-0.35,0.77777%20-0.7778,0.77777%20H%207.7774%20v%20-4.6667%20z%20m%201.1667,3.5%20h%201.5556%20V%205.8333%20H%208.9441%20Z'%20/%3e%3cpath%20id='g'%20d='M%200,0%20V%2017%20L%2013,8.5%20Z'%20/%3e%3cpath%20id='f'%20d='M%200,17%20H%204.3333%20V%200%20H%200%20Z%20M%208.6667,0%20V%2017%20H%2013%20V%200%20Z'%20/%3e%3cpath%20id='e'%20d='m%200,11%20h%203%20v%203%20H%205%20V%209%20H%200%20Z%20M%203,3%20H%200%20V%205%20H%205%20V%200%20H%203%20Z%20m%206,11%20h%202%20v%20-3%20h%203%20V%209%20H%209%20Z%20M%2011,3%20V%200%20H%209%20v%205%20h%205%20V%203%20Z'%20/%3e%3cpath%20id='d'%20d='M%200,12%208.5,6%200,0%20Z%20M%2010,0%20v%2012%20h%202%20V%200%20Z'%20/%3e%3cpath%20id='c'%20d='M%201.52,4.5%20C%201.52,2.961%202.632,1.71%204,1.71%20H%207.2%20V%200%20H%204%20C%201.792,0%200,2.016%200,4.5%200,6.984%201.792,9%204,9%20H%207.2%20V%207.29%20H%204%20C%202.632,7.29%201.52,6.039%201.52,4.5%20Z%20M%204.8,5.4%20h%206.4%20V%203.6%20H%204.8%20Z%20M%2012,0%20H%208.8%20V%201.71%20H%2012%20c%201.368,0%202.48,1.251%202.48,2.79%200,1.539%20-1.112,2.79%20-2.48,2.79%20H%208.8%20V%209%20H%2012%20C%2014.208,9%2016,6.984%2016,4.5%2016,2.016%2014.208,0%2012,0%20Z'%20/%3e%3cpath%20id='b'%20d='M%202,9%20H%200%20v%205%20H%205%20V%2012%20H%202%20Z%20M%200,5%20H%202%20V%202%20H%205%20V%200%20H%200%20Z%20m%2012,7%20H%209%20v%202%20h%205%20V%209%20H%2012%20Z%20M%209,0%20v%202%20h%203%20v%203%20h%202%20V%200%20Z'%20/%3e%3cpath%20id='a'%20d='M%204.4546,8.7015%201.1137,5.2537%201e-4,6.403%204.4546,11%2014,1.1492%2012.8864,-1e-4%204.4546,8.7014%20Z'%20/%3e%3cpath%20id='n'%20d='M%2012.348,7.686%20C%2012.3768,7.462%2012.3984,7.238%2012.3984,7%2012.3984,6.762%2012.3768,6.538%2012.348,6.314%20L%2013.8664,5.159%20C%2014.0032,5.054%2014.0391,4.865%2013.9528,4.711%20L%2012.5135,2.289%20C%2012.4272,2.135%2012.2329,2.079%2012.0745,2.135%20l%20-1.7919,0.7%20C%209.90842,2.555%209.50543,2.324%209.0664,2.149%20L%208.79294,0.294%20C%208.77135,0.126%208.62022,0%208.44031,0%20H%205.56171%20C%205.38181,0%205.23068,0.126%205.20909,0.294%20L%204.93563,2.149%20C%204.49665,2.324%204.09365,2.562%203.71943,2.835%20l%20-1.7919,-0.7%20C%201.76201,2.072%201.5749,2.135%201.48855,2.289%20l%20-1.4393,2.422%20c%20-0.093553,0.154%20-0.050374,0.343%200.086356,0.448%20l%201.5184,1.155%20C%201.625226,6.538%201.603636,6.769%201.603636,7%20c%200,0.231%200.02159,0.462%200.05037,0.686%20l%20-1.5184,1.155%20c%20-0.13673,0.105%20-0.17271,0.294%20-0.086356,0.448%20l%201.4393,2.422%20c%200.08635,0.154%200.28066,0.21%200.43898,0.154%20l%201.7919,-0.7%20c%200.37421,0.28%200.77721,0.511%201.2162,0.686%20l%200.27346,1.855%20C%205.23068,13.874%205.38181,14%205.56171,14%20h%202.8786%20c%200.17991,0%200.33104,-0.126%200.35263,-0.294%20L%209.0664,11.851%20c%200.43898,-0.175%200.84197,-0.413%201.2162,-0.686%20l%201.7919,0.7%20c%200.1655,0.063%200.3527,0%200.439,-0.154%20L%2013.9528,9.289%20C%2014.0391,9.135%2014.0032,8.946%2013.8664,8.841%20Z%20M%207.0011,9.45%20C%205.6122,9.45%204.4824,8.351%204.4824,7%204.4824,5.649%205.6122,4.55%207.0011,4.55%208.39,4.55%209.5198,5.649%209.5198,7%209.5198,8.351%208.39,9.45%207.0011,9.45%20Z'%20/%3e%3cpath%20id='m'%20d='M%200,0%20H%2016%20V%2012%20H%200%20Z'%20/%3e%3cpath%20id='l'%20d='m%200,0%20v%20-2%20h%20-2%20v%202%20z%20m%2016,0%20h%202%20v%20-2%20h%20-2%20z%20m%200,12%20v%202%20h%202%20V%2012%20Z%20M%200,12%20h%20-2%20v%202%20H%200%20Z%20M%200,2%20H%2016%20V%20-2%20H%200%20Z%20M%2014,0%20v%2012%20h%204%20V%200%20Z%20m%202,10%20H%200%20v%204%20H%2016%20Z%20M%202,12%20V%200%20h%20-4%20v%2012%20z'%20/%3e%3cpath%20id='k'%20d='M%2012,5.2941%20H%208.5714%20V%200%20H%203.4285%20V%205.2941%20H%20-1e-4%20l%206,6.1765%206,-6.1765%20z%20M%200,13.2353%20V%2015%20h%2012%20v%20-1.7647%20z'%20/%3e%3cpath%20id='j'%20d='M%209.3333,0%20H%204.6666%20V%201.5238%20H%209.3333%20Z%20M%206.2222,9.9048%20H%207.7778%20V%205.3334%20H%206.2222%20Z%20M%2012.4678,4.8686%2013.5722,3.7867%20C%2013.2378,3.39813%2012.8722,3.03241%2012.4756,2.7124%20L%2011.3711,3.7943%20C%2010.1656,2.84953%208.6489,2.2857%207,2.2857%203.1344,2.2857%200,5.3562%200,9.1429%200,12.9295%203.1267,16%207,16%2010.8733,16%2014,12.9295%2014,9.1429%2014,7.5277%2013.4244,6.0419%2012.4678,4.8686%20Z%20M%207,14.4762%20C%203.99,14.4762%201.5556,12.0914%201.5556,9.1429%201.5556,6.1943%203.99,3.8096%207,3.8096%20c%203.01,0%205.4444,2.3848%205.4444,5.3333%200,2.9485%20-2.4344,5.3333%20-5.4444,5.3333%20z'%20/%3e%3c/defs%3e%3cg%20id='g3989'%20transform='matrix(0.03107656,0,0,0.03432918,271.52581,57.128037)'%20style='fill:%23ffffff'%3e%3cg%20id='g3979'%20style='fill:%23ffffff'%3e%3cpath%20style='fill:%23ffffff;stroke-width:0.03266241'%20d='m%20273.49023,60.4375%20c%20-1.07158,0%20-1.96484,0.958273%20-1.96484,2.169922%20v%206.61914%20c%200,1.216352%200.89727,2.167935%201.96484,2.167969%20h%202.87305%20c%200.52417,0%201.01765,-0.2246%201.39063,-0.634765%20l%201,-1.103516%20c%200.19059,-0.211639%200.45448,-0.333984%200.72656,-0.333984%200.27207,0%200.53829,0.122547%200.73047,0.335937%20l%200.99804,1.101563%20c%200.37212,0.409203%200.86646,0.634765%201.39063,0.634765%20h%202.87305%20c%201.07158,0%201.96484,-0.95632%201.96484,-2.167969%20v%20-6.61914%20c%200,-1.216352%20-0.89727,-2.169922%20-1.96484,-2.169922%20z%20m%202.4961,3.308594%20c%201.08295,0%201.96484,0.973618%201.96484,2.169922%200,1.196303%20-0.88185,2.169921%20-1.96484,2.169922%20-1.08299,0%20-1.96485,-0.973619%20-1.96485,-2.169922%200,-1.196304%200.88189,-2.169922%201.96485,-2.169922%20z%20m%206.99023,0%20c%201.08296,0%201.96485,0.973618%201.96485,2.169922%200,1.196303%20-0.88189,2.169922%20-1.96485,2.169922%20-1.08298,0%20-1.96484,-0.973619%20-1.96484,-2.169922%200,-1.196304%200.88189,-2.169922%201.96484,-2.169922%20z'%20transform='matrix(32.178594,0,0,29.129737,-8737.3187,-1664.1247)'%20id='path3977'%20/%3e%3c/g%3e%3cg%20id='g3983'%20style='fill:%23ffffff'/%3e%3cg%20id='g3987'%20style='fill:%23ffffff'/%3e%3c/g%3e%3cpath%20style='fill:%23ffffff;fill-opacity:1'%20d='M%20317.03125%2021.992188%20A%206.9826789%206.9826789%200%200%200%20310.04883%2028.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2035.958984%20A%206.9826789%206.9826789%200%200%200%20324.01367%2028.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2021.992188%20z%20M%20312.20703%2027.580078%20L%20321.94336%2027.642578%20C%20322.32865%2027.645013%20322.63647%2027.956519%20322.63281%2028.341797%20L%20322.62109%2029.603516%20C%20322.61743%2029.988794%20322.30326%2030.297356%20321.91797%2030.294922%20L%20312.18164%2030.232422%20C%20311.79635%2030.229987%20311.48853%2029.918481%20311.49219%2029.533203%20L%20311.50391%2028.271484%20C%20311.50757%2027.886206%20311.82174%2027.577644%20312.20703%2027.580078%20z%20'%20id='path3997'/%3e%3cpath%20style='fill:%23ffffff;fill-opacity:1'%20d='M%20317.03125%2059.992188%20A%206.9826789%206.9826789%200%200%200%20310.04883%2066.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2073.958984%20A%206.9826789%206.9826789%200%200%200%20324.01367%2066.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2059.992188%20z%20M%20316.49805%2061.365234%20L%20317.76172%2061.382812%20C%20318.14697%2061.388692%20318.45192%2061.704576%20318.44727%2062.089844%20L%20318.4043%2065.619141%20L%20321.94336%2065.642578%20C%20322.32865%2065.645013%20322.63647%2065.956519%20322.63281%2066.341797%20L%20322.62109%2067.603516%20C%20322.61743%2067.988794%20322.30326%2068.297356%20321.91797%2068.294922%20L%20318.37305%2068.271484%20L%20318.33008%2071.826172%20C%20318.32543%2072.21144%20318.0122%2072.515645%20317.62695%2072.509766%20L%20316.36328%2072.492188%20C%20315.97803%2072.486309%20315.67308%2072.170424%20315.67773%2071.785156%20L%20315.7207%2068.255859%20L%20312.18164%2068.232422%20C%20311.79635%2068.229987%20311.48853%2067.918481%20311.49219%2067.533203%20L%20311.50391%2066.271484%20C%20311.50757%2065.886206%20311.82174%2065.577644%20312.20703%2065.580078%20L%20315.75195%2065.603516%20L%20315.79492%2062.048828%20C%20315.79957%2061.66356%20316.1128%2061.359355%20316.49805%2061.365234%20z%20'%20id='path3997-6'/%3e%3cellipse%20style='fill:%23800000;fill-opacity:1;stroke-width:1.10310566'%20id='circle4073'%20cx='353.64172'%20cy='-28.97954'%20transform='scale(1,-1)'%20/%3e%3cg%20id='g7787'%20transform='matrix(-0.02885349,0,0,-0.02885337,352.04486,75.172258)'%20style='fill:%23ffffff;fill-opacity:1'%3e%3cg%20id='g7731'%20transform='translate(-90.566882,42.049084)'%20style='fill:%23ffffff;fill-opacity:1'%3e%3cpath%20id='path7729'%20d='M%20242.607,0%20C%20108.629,0%200.001,108.628%200.001,242.606%20c%200,133.976%20108.628,242.606%20242.606,242.606%20133.978,0%20242.604,-108.631%20242.604,-242.606%20C%20485.212,108.628%20376.585,0%20242.607,0%20Z%20M%20401.815,288.094%20H%20219.862%20v%2090.979%20L%2083.397,242.606%20219.862,106.141%20v%2090.978%20h%20181.953%20z'%20style='fill:%23ffffff;fill-opacity:1'/%3e%3c/g%3e%3cg%20id='g7733'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7735'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7737'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7739'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7741'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7743'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7745'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7747'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7749'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7751'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7753'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7755'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7757'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7759'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7761'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3c/g%3e%3c/svg%3e\") no-repeat;opacity:.8}.fluid_video_wrapper.fluid_player_layout_default .fluid_vr_container .fluid_vr_joystick_panel .fluid_vr_button:hover{opacity:1}.fluid_video_wrapper.fluid_player_layout_default .fluid_vr_container .fluid_vr_joystick_panel .fluid_vr_joystick_up{background-position:-336px -55px;transform:rotate(270deg);display:block;left:calc(50% - 12px);top:0;position:absolute}.fluid_video_wrapper.fluid_player_layout_default .fluid_vr_container .fluid_vr_joystick_panel .fluid_vr_joystick_left{background-position:-336px -55px;transform:rotate(180deg);display:block;left:0;top:24px;position:absolute}.fluid_video_wrapper.fluid_player_layout_default .fluid_vr_container .fluid_vr_joystick_panel .fluid_vr_joystick_right{background-position:-336px -55px;transform:rotate(0);display:block;right:0;top:24px;position:absolute}.fluid_video_wrapper.fluid_player_layout_default .fluid_vr_container .fluid_vr_joystick_panel .fluid_vr_joystick_down{background-position:-336px -55px;transform:rotate(90deg);display:block;left:calc(50% - 12px);top:48px;position:absolute}.fluid_video_wrapper.fluid_player_layout_default .fluid_vr_container .fluid_vr_joystick_panel .fluid_vr_joystick_zoomdefault{background-position:-336px -17px;top:72px;transform:rotate(0);position:absolute;left:calc(50% - 12px)}.fluid_video_wrapper.fluid_player_layout_default .fluid_vr_container .fluid_vr_joystick_panel .fluid_vr_joystick_zoomin{background-position:-305px -55px;top:72px;transform:rotate(0);position:absolute;right:0}.fluid_video_wrapper.fluid_player_layout_default .fluid_vr_container .fluid_vr_joystick_panel .fluid_vr_joystick_zoomout{background-position:-305px -17px;top:72px;transform:rotate(0);position:absolute;left:0}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container.fluid_vr_controls_container{width:50%!important}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container.fluid_vr2_controls_container{width:50%!important;left:50%}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container{color:#fff;position:absolute;bottom:0;left:0;right:0;background:linear-gradient(to bottom,#0000,#0009);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=\"#00000000\",endColorstr=\"#ad000000\",GradientType=0);height:53px;z-index:1}.fluid_video_wrapper.fluid_player_layout_default .fluid_vpaid_iframe{position:absolute;top:0;width:100%;height:100%;left:0;z-index:-10}.fluid_video_wrapper.fluid_player_layout_default .fluid_vpaid_nonlinear_slot_iframe{z-index:30}.fluid_video_wrapper.fluid_player_layout_default .fluid_vpaid_slot{position:absolute!important;top:0!important;width:100%!important;height:100%!important;left:0!important}.fluid_video_wrapper.fluid_player_layout_default .fluid_subtitles_container{color:#fff;position:absolute;bottom:46px;left:0;right:0;height:auto;z-index:1;text-align:center;transition:bottom .2s ease}.fluid_video_wrapper.fluid_player_layout_default .fluid_subtitles_container div{display:inline;background:#000;color:#fff;font-size:1em;font-family:-apple-system,BlinkMacSystemFont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,arial,sans-serif,\"apple color emoji\",\"segoe ui emoji\",segoe ui symbol;padding:.25em;border-radius:4px}.fluid_video_wrapper.fluid_player_layout_default .fade_out{visibility:hidden;opacity:0;transition:visibility .5s,opacity .5s}.fluid_video_wrapper.fluid_player_layout_default .fade_in{visibility:visible;opacity:1;transition:visibility .5s,opacity .5s}.fluid_video_wrapper.fluid_player_layout_default.pseudo_fullscreen{width:100%!important;height:100%!important;top:0;left:0;position:fixed;z-index:99999}.fluid_video_wrapper.fluid_player_layout_default:-webkit-full-screen{width:100%!important;height:100%!important;position:absolute;top:0;left:0}.fluid_video_wrapper.fluid_player_layout_default:-ms-fullscreen{width:100%!important;height:100%!important;position:absolute}.fluid_video_wrapper.fluid_player_layout_default .fluid_context_menu{background-color:#000;color:#fff;font-size:13px;font-family:-apple-system,BlinkMacSystemFont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,arial,sans-serif,\"apple color emoji\",\"segoe ui emoji\",segoe ui symbol;font-weight:400;white-space:nowrap;text-align:start;z-index:11;opacity:.8;border-radius:1px}_:-ms-lang(x),.fluid_video_wrapper.fluid_player_layout_default .fluid_context_menu{text-align:left}.fluid_video_wrapper.fluid_player_layout_default .fluid_context_menu ul{list-style:none;padding:0;margin:0}.fluid_video_wrapper.fluid_player_layout_default .fluid_context_menu ul li{padding:13px 71px 13px 21px;cursor:pointer}.fluid_video_wrapper.fluid_player_layout_default .fluid_context_menu ul li+li{border-top:1px solid #000000}.fluid_video_wrapper.fluid_player_layout_default .fluid_context_menu ul li:hover{background-color:#1e1e1e;color:#fbfaff}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_left{width:24px;left:20px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container.skip_controls .fluid_controls_left{width:80px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button{width:24px;height:24px;-webkit-user-select:none;-ms-user-select:none;user-select:none}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_control_duration{display:flex;align-items:center}.fluid_button_live_indicator{margin-right:10px;display:inline-flex;align-items:center;padding:2px 5px;background-color:red;color:#fff;border-radius:4px;font-weight:700;font-size:11px;margin-bottom:3px}.live_circle{position:relative;display:inline-block;width:6px;height:6px;background-color:transparent;border:1px solid #ffffff;border-radius:50%;margin-left:3px}.live_circle:after{content:\"\";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:4px;height:4px;background-color:#fff;border-radius:50%}@media (max-width: 768px){.fluid_button_live_indicator{position:absolute;font-size:8px;top:-30px;left:-40px;padding:2px 3px!important}}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right{left:60px;right:20px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container.skip_controls .fluid_controls_right{left:110px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_left,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right{position:absolute;height:24px;top:23px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_progress_container{height:14px;position:absolute;left:13px;right:13px;z-index:1;top:8px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_progress_container .fluid_controls_progress{position:absolute;top:5px;width:100%;height:4px;background-color:#ffffff40}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_progress_container .fluid_controls_buffered{position:absolute;top:5px;width:0;height:3px;background-color:#ffffff80;z-index:-1}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_progress_container .fluid_controls_progress,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_progress_container .fluid_controls_progress .fluid_controls_currentprogress{position:absolute;height:3px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_progress_container:hover .fluid_controls_progress,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_progress_container:hover .fluid_controls_buffered,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_progress_container:hover .fluid_controls_ad_markers_holder{margin-top:-1px;height:5px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_progress_container:hover .fluid_controls_progress .fluid_controls_currentprogress{height:5px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_progress_container .fluid_timeline_preview_container{border:1px solid #262626}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_progress_container .fluid_timeline_preview_container,.fluid_timeline_preview_container_shadow{bottom:14px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_progress_container.fluid_slider .fluid_controls_progress .fluid_controls_currentprogress .fluid_controls_currentpos{background-color:#fff}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_progress_container.fluid_slider .fluid_controls_progress .fluid_controls_currentprogress .fluid_controls_currentpos,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_progress_container.fluid_ad_slider .fluid_controls_progress .fluid_controls_currentprogress .fluid_controls_currentpos{opacity:0}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_progress_container.fluid_slider:hover .fluid_controls_progress .fluid_controls_currentprogress .fluid_controls_currentpos{opacity:1}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_progress_container.fluid_slider .fluid_controls_progress .fluid_controls_currentprogress .fluid_controls_currentpos{transition:opacity .3s}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_ad_markers_holder{position:absolute;top:5px;width:100%;height:3px;z-index:2}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_ad_marker{position:absolute;background-color:#fc0;height:100%;width:6px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_control_volume_container{height:24px;width:56px;left:25px;top:-1px;z-index:2;opacity:.8;transition:opacity .3s ease-in-out;display:none}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_control_volume_container:hover{opacity:1}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_control_volume_container .fluid_control_volume{position:relative;height:3px;width:100%;margin-top:10px;background-color:#abacacad;z-index:3}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_control_volume_container .fluid_control_volume .fluid_control_currentvolume{float:left;background-color:#fff;height:3px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_control_volume_container .fluid_control_volume .fluid_control_currentvolume .fluid_control_volume_currentpos{background-color:#fff}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_progress_container .fluid_controls_progress .fluid_controls_currentpos{right:-4px;z-index:3}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_control_volume_container .fluid_control_volume .fluid_control_currentvolume .fluid_control_volume_currentpos,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_progress_container .fluid_controls_progress .fluid_controls_currentpos{width:11px;height:11px;position:absolute;top:-4px;border-radius:6px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_progress_container .fluid_controls_progress .fluid_controls_currentpos{width:13px;height:13px;position:absolute;top:-4px;border-radius:6px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container.no_volume_bar .fluid_controls_right .fluid_control_volume_container{display:none}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_slider{cursor:pointer}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container div div{display:block}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button.fluid_button_fullscreen,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button.fluid_button_fullscreen_exit,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button.fluid_button_mini_player{float:right}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button_video_source,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button_subtitles,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button_cardboard{font-size:13px;height:24px;line-height:24px;float:right;cursor:pointer;position:relative;text-align:right;-webkit-touch-callout:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button_video_source .fluid_video_sources_title,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button_subtitles .fluid_subtitles_title{width:80px;overflow:hidden}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button_subtitles .fluid_subtitles_list,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button_subtitles .fluid_subtitle_size_menu,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button_video_source .fluid_video_sources_list,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_video_playback_rates{position:absolute;bottom:25px;right:3px;z-index:888888;opacity:99%;background-color:#000;border-radius:2px;color:#fff;font-size:13px;font-family:-apple-system,BlinkMacSystemFont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,arial,sans-serif,\"apple color emoji\",\"segoe ui emoji\",segoe ui symbol;font-weight:400;white-space:nowrap;text-align:start;width:max-content;padding:.5em;overflow:auto}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button_subtitles .fluid_subtitles_list .fluid_subtitle_list_item,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button_subtitles .fluid_subtitle_size_menu .fluid_subtitle_size_button,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button_video_source .fluid_video_sources_list .fluid_video_source_list_item{padding:12px 34px 12px 24px;line-height:15px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button_video_source .fluid_video_sources_list .fluid_video_source_list_item:hover,.fluid_video_playback_rates_item:hover,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button_subtitles .fluid_subtitle_size_menu .fluid_subtitle_size_button:hover,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button_subtitles .fluid_subtitles_list .fluid_subtitle_list_item:hover{background-color:#3a3a3a}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_control_volume_container,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button.fluid_button_volume,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button.fluid_button_mute{position:absolute}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button.fluid_button_volume,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button.fluid_button_mute{left:-10px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_live_indicator,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_play,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_pause,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_skip_back,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_skip_forward,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_volume,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_mute,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_video_source,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_fullscreen,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_fullscreen_exit,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_playback_rate,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_download,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_theatre,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_subtitles,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_cardboard,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_mini_player{display:inline-block;text-align:left;height:24px;width:24px;position:relative}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_play:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_pause:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_skip_back:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_skip_forward:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_volume:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_mute:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_video_source:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_fullscreen:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_fullscreen_exit:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_playback_rate:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_download:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_theatre:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_subtitles:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_cardboard:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_mini_player:before{background:url(\"data:image/svg+xml,%3csvg%20xmlns:xlink='http://www.w3.org/1999/xlink'%20xmlns='http://www.w3.org/2000/svg'%20width='388.75'%20height='96'%20version='1.1'%20viewBox='0%200%20388.75%2096'%20id='svg63'%3e%3cpath%20id='path4087'%20d='m%20347.64062,35.959%20a%206.9826789,6.9826789%200%200%200%206.98438,-6.984375%206.9826789,6.9826789%200%200%200%20-6.98438,-6.982422%206.9826789,6.9826789%200%200%200%20-6.98242,6.982422%206.9826789,6.9826789%200%200%200%206.98242,6.984375%20z%20m%200,-2.476562%20a%204.5078053,4.5078053%200%200%201%20-4.50781,-4.507813%204.5078053,4.5078053%200%200%201%204.50781,-4.507812%204.5078053,4.5078053%200%200%201%204.50781,4.507812%204.5078053,4.5078053%200%200%201%20-4.50781,4.507813%20z'%20style='fill:%23ffffff;fill-opacity:1;stroke-width:1.70873225'%20/%3e%3cpath%20style='fill:%23ffffff;fill-opacity:1;stroke-width:1.00886583'%20d='M%20273.55469,22%20C%20272.69375,22%20272,22.693749%20272,23.554688%20V%2034.445312%20C%20272,35.306251%20272.69375,36%20273.55469,36%20h%2010.89062%20C%20285.30625,36%20286,35.306251%20286,34.445312%20V%2023.554688%20C%20286,22.693749%20285.30625,22%20284.44531,22%20Z%20m%203.61133,4.541016%20c%200.22916,0%200.45442,0.02083%200.67578,0.0625%200.22396,0.03906%200.44661,0.09896%200.66797,0.179687%20v%201.140625%20c%20-0.19011,-0.130208%20-0.38151,-0.226562%20-0.57422,-0.289062%20-0.19011,-0.0625%20-0.38802,-0.09375%20-0.59375,-0.09375%20-0.39063,0%20-0.69532,0.114583%20-0.91407,0.34375%20-0.21614,0.226562%20-0.32421,0.54427%20-0.32421,0.953125%200,0.408854%200.10807,0.727864%200.32421,0.957031%200.21875,0.226562%200.52344,0.339844%200.91407,0.339844%200.21875,0%200.42578,-0.03255%200.62109,-0.09766%200.19792,-0.0651%200.38021,-0.161458%200.54688,-0.289062%20v%201.144531%20c%20-0.21875,0.08073%20-0.44141,0.140625%20-0.66797,0.179688%20-0.22396,0.04167%20-0.44922,0.0625%20-0.67578,0.0625%20-0.78907,0%20-1.40625,-0.201823%20-1.85157,-0.605469%20-0.44531,-0.40625%20-0.66797,-0.970052%20-0.66797,-1.691406%200,-0.721355%200.22266,-1.283855%200.66797,-1.6875%200.44532,-0.40625%201.0625,-0.609375%201.85157,-0.609375%20z%20m%204.75,0%20c%200.22916,0%200.45442,0.02083%200.67578,0.0625%200.22396,0.03906%200.44661,0.09896%200.66797,0.179687%20v%201.140625%20c%20-0.19011,-0.130208%20-0.38151,-0.226562%20-0.57422,-0.289062%20-0.19011,-0.0625%20-0.38802,-0.09375%20-0.59375,-0.09375%20-0.39063,0%20-0.69532,0.114583%20-0.91407,0.34375%20-0.21614,0.226562%20-0.32421,0.54427%20-0.32421,0.953125%200,0.408854%200.10807,0.727864%200.32421,0.957031%200.21875,0.226562%200.52344,0.339844%200.91407,0.339844%200.21875,0%200.42578,-0.03255%200.62109,-0.09766%200.19792,-0.0651%200.38021,-0.161458%200.54688,-0.289062%20v%201.144531%20c%20-0.21875,0.08073%20-0.44141,0.140625%20-0.66797,0.179688%20-0.22396,0.04167%20-0.44922,0.0625%20-0.67578,0.0625%20-0.78907,0%20-1.40625,-0.201823%20-1.85157,-0.605469%20-0.44531,-0.40625%20-0.66797,-0.970052%20-0.66797,-1.691406%200,-0.721355%200.22266,-1.283855%200.66797,-1.6875%200.44532,-0.40625%201.0625,-0.609375%201.85157,-0.609375%20z'%20id='rect7816'%20/%3e%3cg%20transform='translate(-3702,106)'%20id='g44'%3e%3cclipPath%20id='q'%20style='clip-rule:evenodd'%3e%3cpath%20d='m%203702,-106%20h%20272%20v%2096%20h%20-272%20z'%20id='path6'%20style='fill:%23ffffff'/%3e%3c/clipPath%3e%3cg%20clip-path='url(%23q)'%20id='g42'%3e%3cuse%20transform='translate(3757,-86)'%20xlink:href='%23o'%20id='use9'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3757,-48)'%20xlink:href='%23i'%20id='use11'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3830,-84)'%20xlink:href='%23h'%20id='use13'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3723,-86)'%20xlink:href='%23g'%20id='use15'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3723,-48)'%20xlink:href='%23f'%20id='use17'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3795,-46)'%20xlink:href='%23e'%20id='use19'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3831,-46)'%20xlink:href='%23d'%20id='use21'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3865,-44)'%20xlink:href='%23c'%20id='use23'%20style='fill:%23f2c94c'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3795,-84)'%20xlink:href='%23b'%20id='use25'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3866,-83)'%20xlink:href='%23a'%20id='use27'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3939,-47)'%20xlink:href='%23n'%20id='use29'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cmask%20id='p'%3e%3cuse%20transform='translate(3902,-46)'%20xlink:href='%23m'%20id='use31'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3c/mask%3e%3cg%20mask='url(%23p)'%20id='g36'%3e%3cuse%20transform='translate(3902,-46)'%20xlink:href='%23l'%20id='use34'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3c/g%3e%3cuse%20transform='translate(3904,-85)'%20xlink:href='%23k'%20id='use38'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3939,-85)'%20xlink:href='%23j'%20id='use40'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3c/g%3e%3c/g%3e%3cdefs%20id='defs61'%3e%3cpath%20id='o'%20d='m%200,5.5924%20v%205.8152%20H%203.7778%20L%208.5,16.2537%20V%200.7467%20L%203.7778,5.5928%20H%200%20Z%20M%2012.75,8.5%20c%200,-1.7155%20-0.9633,-3.1887%20-2.3611,-3.9059%20v%207.8021%20C%2011.7867,11.6887%2012.75,10.2155%2012.75,8.5%20Z%20M%2010.3889,0%20v%201.9966%20c%202.7294,0.83352%204.7222,3.431%204.7222,6.5034%200,3.0724%20-1.9928,5.6699%20-4.7222,6.5034%20V%2017%20C%2014.1761,16.118%2017,12.6482%2017,8.5%2017,4.3518%2014.1761,0.882%2010.3889,0%20Z'%20/%3e%3cpath%20id='i'%20d='m%2012.75,8.5%20c%200,-1.6717%20-0.9633,-3.1072%20-2.3611,-3.8061%20V%206.7811%20L%2012.7028,9.095%20C%2012.7311,8.90611%2012.75,8.70778%2012.75,8.5%20Z%20m%202.3611,0%20c%200,0.88778%20-0.1889,1.7189%20-0.51,2.4933%20l%201.4261,1.4261%20C%2016.6506,11.2483%2017,9.9167%2017,8.5%2017,4.4578%2014.1761,1.0767%2010.3889,0.2172%20V%202.1628%20C%2013.1183,2.97502%2015.1111,5.5061%2015.1111,8.5%20Z%20M%201.1991,0%20-3e-4,1.1994%204.4669,5.6666%20H%20-3e-4%20v%205.6666%20h%203.7778%20l%204.7222,4.7223%20V%209.6993%20l%204.0139,4.0139%20c%20-0.6328,0.4911%20-1.3411,0.8784%20-2.125,1.1145%20v%201.9455%20c%201.3033,-0.2927%202.4839,-0.8972%203.485,-1.7094%20l%201.9267,1.9361%201.1994,-1.1994%20-8.5,-8.5%20L%201.1991,-1e-4%20Z%20m%207.3006,0.94444%20-1.9739,1.9739%201.9739,1.9739%20z'%20/%3e%3cpath%20id='h'%20d='M%2012.444,0%20H%201.555%20C%200.69166,0%20-6e-4,0.7%20-6e-4,1.5556%20v%2010.889%20c%200,0.8556%200.69222,1.5556%201.5556,1.5556%20h%2010.889%20c%200.8556,0%201.5556,-0.7%201.5556,-1.5556%20V%201.5556%20C%2013.9996,0.70004%2013.2996,0%2012.444,0%20Z%20M%206.2218,9.3333%20H%205.0551%20V%207.7777%20H%203.4995%20V%209.3333%20H%202.3328%20V%204.6666%20H%203.4995%20V%206.611%20H%205.0551%20V%204.6666%20H%206.2218%20Z%20M%207.7774,4.6666%20h%203.1111%20c%200.4278,0%200.7778,0.35%200.7778,0.77777%20v%203.1111%20c%200,0.42777%20-0.35,0.77777%20-0.7778,0.77777%20H%207.7774%20v%20-4.6667%20z%20m%201.1667,3.5%20h%201.5556%20V%205.8333%20H%208.9441%20Z'%20/%3e%3cpath%20id='g'%20d='M%200,0%20V%2017%20L%2013,8.5%20Z'%20/%3e%3cpath%20id='f'%20d='M%200,17%20H%204.3333%20V%200%20H%200%20Z%20M%208.6667,0%20V%2017%20H%2013%20V%200%20Z'%20/%3e%3cpath%20id='e'%20d='m%200,11%20h%203%20v%203%20H%205%20V%209%20H%200%20Z%20M%203,3%20H%200%20V%205%20H%205%20V%200%20H%203%20Z%20m%206,11%20h%202%20v%20-3%20h%203%20V%209%20H%209%20Z%20M%2011,3%20V%200%20H%209%20v%205%20h%205%20V%203%20Z'%20/%3e%3cpath%20id='d'%20d='M%200,12%208.5,6%200,0%20Z%20M%2010,0%20v%2012%20h%202%20V%200%20Z'%20/%3e%3cpath%20id='c'%20d='M%201.52,4.5%20C%201.52,2.961%202.632,1.71%204,1.71%20H%207.2%20V%200%20H%204%20C%201.792,0%200,2.016%200,4.5%200,6.984%201.792,9%204,9%20H%207.2%20V%207.29%20H%204%20C%202.632,7.29%201.52,6.039%201.52,4.5%20Z%20M%204.8,5.4%20h%206.4%20V%203.6%20H%204.8%20Z%20M%2012,0%20H%208.8%20V%201.71%20H%2012%20c%201.368,0%202.48,1.251%202.48,2.79%200,1.539%20-1.112,2.79%20-2.48,2.79%20H%208.8%20V%209%20H%2012%20C%2014.208,9%2016,6.984%2016,4.5%2016,2.016%2014.208,0%2012,0%20Z'%20/%3e%3cpath%20id='b'%20d='M%202,9%20H%200%20v%205%20H%205%20V%2012%20H%202%20Z%20M%200,5%20H%202%20V%202%20H%205%20V%200%20H%200%20Z%20m%2012,7%20H%209%20v%202%20h%205%20V%209%20H%2012%20Z%20M%209,0%20v%202%20h%203%20v%203%20h%202%20V%200%20Z'%20/%3e%3cpath%20id='a'%20d='M%204.4546,8.7015%201.1137,5.2537%201e-4,6.403%204.4546,11%2014,1.1492%2012.8864,-1e-4%204.4546,8.7014%20Z'%20/%3e%3cpath%20id='n'%20d='M%2012.348,7.686%20C%2012.3768,7.462%2012.3984,7.238%2012.3984,7%2012.3984,6.762%2012.3768,6.538%2012.348,6.314%20L%2013.8664,5.159%20C%2014.0032,5.054%2014.0391,4.865%2013.9528,4.711%20L%2012.5135,2.289%20C%2012.4272,2.135%2012.2329,2.079%2012.0745,2.135%20l%20-1.7919,0.7%20C%209.90842,2.555%209.50543,2.324%209.0664,2.149%20L%208.79294,0.294%20C%208.77135,0.126%208.62022,0%208.44031,0%20H%205.56171%20C%205.38181,0%205.23068,0.126%205.20909,0.294%20L%204.93563,2.149%20C%204.49665,2.324%204.09365,2.562%203.71943,2.835%20l%20-1.7919,-0.7%20C%201.76201,2.072%201.5749,2.135%201.48855,2.289%20l%20-1.4393,2.422%20c%20-0.093553,0.154%20-0.050374,0.343%200.086356,0.448%20l%201.5184,1.155%20C%201.625226,6.538%201.603636,6.769%201.603636,7%20c%200,0.231%200.02159,0.462%200.05037,0.686%20l%20-1.5184,1.155%20c%20-0.13673,0.105%20-0.17271,0.294%20-0.086356,0.448%20l%201.4393,2.422%20c%200.08635,0.154%200.28066,0.21%200.43898,0.154%20l%201.7919,-0.7%20c%200.37421,0.28%200.77721,0.511%201.2162,0.686%20l%200.27346,1.855%20C%205.23068,13.874%205.38181,14%205.56171,14%20h%202.8786%20c%200.17991,0%200.33104,-0.126%200.35263,-0.294%20L%209.0664,11.851%20c%200.43898,-0.175%200.84197,-0.413%201.2162,-0.686%20l%201.7919,0.7%20c%200.1655,0.063%200.3527,0%200.439,-0.154%20L%2013.9528,9.289%20C%2014.0391,9.135%2014.0032,8.946%2013.8664,8.841%20Z%20M%207.0011,9.45%20C%205.6122,9.45%204.4824,8.351%204.4824,7%204.4824,5.649%205.6122,4.55%207.0011,4.55%208.39,4.55%209.5198,5.649%209.5198,7%209.5198,8.351%208.39,9.45%207.0011,9.45%20Z'%20/%3e%3cpath%20id='m'%20d='M%200,0%20H%2016%20V%2012%20H%200%20Z'%20/%3e%3cpath%20id='l'%20d='m%200,0%20v%20-2%20h%20-2%20v%202%20z%20m%2016,0%20h%202%20v%20-2%20h%20-2%20z%20m%200,12%20v%202%20h%202%20V%2012%20Z%20M%200,12%20h%20-2%20v%202%20H%200%20Z%20M%200,2%20H%2016%20V%20-2%20H%200%20Z%20M%2014,0%20v%2012%20h%204%20V%200%20Z%20m%202,10%20H%200%20v%204%20H%2016%20Z%20M%202,12%20V%200%20h%20-4%20v%2012%20z'%20/%3e%3cpath%20id='k'%20d='M%2012,5.2941%20H%208.5714%20V%200%20H%203.4285%20V%205.2941%20H%20-1e-4%20l%206,6.1765%206,-6.1765%20z%20M%200,13.2353%20V%2015%20h%2012%20v%20-1.7647%20z'%20/%3e%3cpath%20id='j'%20d='M%209.3333,0%20H%204.6666%20V%201.5238%20H%209.3333%20Z%20M%206.2222,9.9048%20H%207.7778%20V%205.3334%20H%206.2222%20Z%20M%2012.4678,4.8686%2013.5722,3.7867%20C%2013.2378,3.39813%2012.8722,3.03241%2012.4756,2.7124%20L%2011.3711,3.7943%20C%2010.1656,2.84953%208.6489,2.2857%207,2.2857%203.1344,2.2857%200,5.3562%200,9.1429%200,12.9295%203.1267,16%207,16%2010.8733,16%2014,12.9295%2014,9.1429%2014,7.5277%2013.4244,6.0419%2012.4678,4.8686%20Z%20M%207,14.4762%20C%203.99,14.4762%201.5556,12.0914%201.5556,9.1429%201.5556,6.1943%203.99,3.8096%207,3.8096%20c%203.01,0%205.4444,2.3848%205.4444,5.3333%200,2.9485%20-2.4344,5.3333%20-5.4444,5.3333%20z'%20/%3e%3c/defs%3e%3cg%20id='g3989'%20transform='matrix(0.03107656,0,0,0.03432918,271.52581,57.128037)'%20style='fill:%23ffffff'%3e%3cg%20id='g3979'%20style='fill:%23ffffff'%3e%3cpath%20style='fill:%23ffffff;stroke-width:0.03266241'%20d='m%20273.49023,60.4375%20c%20-1.07158,0%20-1.96484,0.958273%20-1.96484,2.169922%20v%206.61914%20c%200,1.216352%200.89727,2.167935%201.96484,2.167969%20h%202.87305%20c%200.52417,0%201.01765,-0.2246%201.39063,-0.634765%20l%201,-1.103516%20c%200.19059,-0.211639%200.45448,-0.333984%200.72656,-0.333984%200.27207,0%200.53829,0.122547%200.73047,0.335937%20l%200.99804,1.101563%20c%200.37212,0.409203%200.86646,0.634765%201.39063,0.634765%20h%202.87305%20c%201.07158,0%201.96484,-0.95632%201.96484,-2.167969%20v%20-6.61914%20c%200,-1.216352%20-0.89727,-2.169922%20-1.96484,-2.169922%20z%20m%202.4961,3.308594%20c%201.08295,0%201.96484,0.973618%201.96484,2.169922%200,1.196303%20-0.88185,2.169921%20-1.96484,2.169922%20-1.08299,0%20-1.96485,-0.973619%20-1.96485,-2.169922%200,-1.196304%200.88189,-2.169922%201.96485,-2.169922%20z%20m%206.99023,0%20c%201.08296,0%201.96485,0.973618%201.96485,2.169922%200,1.196303%20-0.88189,2.169922%20-1.96485,2.169922%20-1.08298,0%20-1.96484,-0.973619%20-1.96484,-2.169922%200,-1.196304%200.88189,-2.169922%201.96484,-2.169922%20z'%20transform='matrix(32.178594,0,0,29.129737,-8737.3187,-1664.1247)'%20id='path3977'%20/%3e%3c/g%3e%3cg%20id='g3983'%20style='fill:%23ffffff'/%3e%3cg%20id='g3987'%20style='fill:%23ffffff'/%3e%3c/g%3e%3cpath%20style='fill:%23ffffff;fill-opacity:1'%20d='M%20317.03125%2021.992188%20A%206.9826789%206.9826789%200%200%200%20310.04883%2028.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2035.958984%20A%206.9826789%206.9826789%200%200%200%20324.01367%2028.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2021.992188%20z%20M%20312.20703%2027.580078%20L%20321.94336%2027.642578%20C%20322.32865%2027.645013%20322.63647%2027.956519%20322.63281%2028.341797%20L%20322.62109%2029.603516%20C%20322.61743%2029.988794%20322.30326%2030.297356%20321.91797%2030.294922%20L%20312.18164%2030.232422%20C%20311.79635%2030.229987%20311.48853%2029.918481%20311.49219%2029.533203%20L%20311.50391%2028.271484%20C%20311.50757%2027.886206%20311.82174%2027.577644%20312.20703%2027.580078%20z%20'%20id='path3997'/%3e%3cpath%20style='fill:%23ffffff;fill-opacity:1'%20d='M%20317.03125%2059.992188%20A%206.9826789%206.9826789%200%200%200%20310.04883%2066.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2073.958984%20A%206.9826789%206.9826789%200%200%200%20324.01367%2066.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2059.992188%20z%20M%20316.49805%2061.365234%20L%20317.76172%2061.382812%20C%20318.14697%2061.388692%20318.45192%2061.704576%20318.44727%2062.089844%20L%20318.4043%2065.619141%20L%20321.94336%2065.642578%20C%20322.32865%2065.645013%20322.63647%2065.956519%20322.63281%2066.341797%20L%20322.62109%2067.603516%20C%20322.61743%2067.988794%20322.30326%2068.297356%20321.91797%2068.294922%20L%20318.37305%2068.271484%20L%20318.33008%2071.826172%20C%20318.32543%2072.21144%20318.0122%2072.515645%20317.62695%2072.509766%20L%20316.36328%2072.492188%20C%20315.97803%2072.486309%20315.67308%2072.170424%20315.67773%2071.785156%20L%20315.7207%2068.255859%20L%20312.18164%2068.232422%20C%20311.79635%2068.229987%20311.48853%2067.918481%20311.49219%2067.533203%20L%20311.50391%2066.271484%20C%20311.50757%2065.886206%20311.82174%2065.577644%20312.20703%2065.580078%20L%20315.75195%2065.603516%20L%20315.79492%2062.048828%20C%20315.79957%2061.66356%20316.1128%2061.359355%20316.49805%2061.365234%20z%20'%20id='path3997-6'/%3e%3cellipse%20style='fill:%23800000;fill-opacity:1;stroke-width:1.10310566'%20id='circle4073'%20cx='353.64172'%20cy='-28.97954'%20transform='scale(1,-1)'%20/%3e%3cg%20id='g7787'%20transform='matrix(-0.02885349,0,0,-0.02885337,352.04486,75.172258)'%20style='fill:%23ffffff;fill-opacity:1'%3e%3cg%20id='g7731'%20transform='translate(-90.566882,42.049084)'%20style='fill:%23ffffff;fill-opacity:1'%3e%3cpath%20id='path7729'%20d='M%20242.607,0%20C%20108.629,0%200.001,108.628%200.001,242.606%20c%200,133.976%20108.628,242.606%20242.606,242.606%20133.978,0%20242.604,-108.631%20242.604,-242.606%20C%20485.212,108.628%20376.585,0%20242.607,0%20Z%20M%20401.815,288.094%20H%20219.862%20v%2090.979%20L%2083.397,242.606%20219.862,106.141%20v%2090.978%20h%20181.953%20z'%20style='fill:%23ffffff;fill-opacity:1'/%3e%3c/g%3e%3cg%20id='g7733'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7735'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7737'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7739'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7741'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7743'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7745'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7747'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7749'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7751'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7753'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7755'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7757'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7759'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7761'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3c/g%3e%3c/svg%3e\") no-repeat;position:absolute;height:24px;width:24px;top:1px;left:5px;content:\"\";opacity:.8;transition:opacity .3s ease-in-out}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_play:before{background-position:-15px -19px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_pause:before{background-position:-15px -57px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_volume:before{background-position:-52px -19px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_mute:before{background-position:-52px -57px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_fullscreen:before{background-position:-88px -19px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_fullscreen_exit:before{background-position:-88px -57px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_video_source:before{background-position:-122px -19px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_playback_rate:before{background-position:-232px -19px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_download:before{background-position:-194px -18px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_theatre:before{background-position:-195px -56px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_subtitles:before{background-position:-269px -19px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_cardboard:before{background-position:-269px -56px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_skip_back:before{background:url(\"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='white'%20width='24px'%20height='24px'%3e%3cpath%20d='M0%200h24v24H0V0z'%20fill='none'/%3e%3cpath%20d='M11.99%205V1l-5%205%205%205V7c3.31%200%206%202.69%206%206s-2.69%206-6%206-6-2.69-6-6h-2c0%204.42%203.58%208%208%208s8-3.58%208-8-3.58-8-8-8zm-1.1%2011h-.85v-3.26l-1.01.31v-.69l1.77-.63h.09V16zm4.28-1.76c0%20.32-.03.6-.1.82s-.17.42-.29.57-.28.26-.45.33-.37.1-.59.1-.41-.03-.59-.1-.33-.18-.46-.33-.23-.34-.3-.57-.11-.5-.11-.82v-.74c0-.32.03-.6.1-.82s.17-.42.29-.57.28-.26.45-.33.37-.1.59-.1.41.03.59.1.33.18.46.33.23.34.3.57.11.5.11.82v.74zm-.85-.86c0-.19-.01-.35-.04-.48s-.07-.23-.12-.31-.11-.14-.19-.17-.16-.05-.25-.05-.18.02-.25.05-.14.09-.19.17-.09.18-.12.31-.04.29-.04.48v.97c0%20.19.01.35.04.48s.07.24.12.32.11.14.19.17.16.05.25.05.18-.02.25-.05.14-.09.19-.17.09-.19.11-.32.04-.29.04-.48v-.97z'/%3e%3c/svg%3e\") no-repeat;background-position:-2px -2px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_skip_forward:before{background:url(\"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20enable-background='new%200%200%2024%2024'%20viewBox='0%200%2024%2024'%20fill='white'%20width='24px'%20height='24px'%3e%3cg%3e%3crect%20fill='none'%20height='24'%20width='24'/%3e%3crect%20fill='none'%20height='24'%20width='24'/%3e%3crect%20fill='none'%20height='24'%20width='24'/%3e%3c/g%3e%3cg%3e%3cg/%3e%3cg%3e%3cpath%20d='M18,13c0,3.31-2.69,6-6,6s-6-2.69-6-6s2.69-6,6-6v4l5-5l-5-5v4c-4.42,0-8,3.58-8,8c0,4.42,3.58,8,8,8s8-3.58,8-8H18z'/%3e%3cpolygon%20points='10.9,16%2010.9,11.73%2010.81,11.73%209.04,12.36%209.04,13.05%2010.05,12.74%2010.05,16'/%3e%3cpath%20d='M14.32,11.78c-0.18-0.07-0.37-0.1-0.59-0.1s-0.41,0.03-0.59,0.1s-0.33,0.18-0.45,0.33s-0.23,0.34-0.29,0.57%20s-0.1,0.5-0.1,0.82v0.74c0,0.32,0.04,0.6,0.11,0.82s0.17,0.42,0.3,0.57s0.28,0.26,0.46,0.33s0.37,0.1,0.59,0.1s0.41-0.03,0.59-0.1%20s0.33-0.18,0.45-0.33s0.22-0.34,0.29-0.57s0.1-0.5,0.1-0.82V13.5c0-0.32-0.04-0.6-0.11-0.82s-0.17-0.42-0.3-0.57%20S14.49,11.85,14.32,11.78z%20M14.33,14.35c0,0.19-0.01,0.35-0.04,0.48s-0.06,0.24-0.11,0.32s-0.11,0.14-0.19,0.17%20s-0.16,0.05-0.25,0.05s-0.18-0.02-0.25-0.05s-0.14-0.09-0.19-0.17s-0.09-0.19-0.12-0.32s-0.04-0.29-0.04-0.48v-0.97%20c0-0.19,0.01-0.35,0.04-0.48s0.06-0.23,0.12-0.31s0.11-0.14,0.19-0.17s0.16-0.05,0.25-0.05s0.18,0.02,0.25,0.05%20s0.14,0.09,0.19,0.17s0.09,0.18,0.12,0.31s0.04,0.29,0.04,0.48V14.35z'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e\") no-repeat;background-position:-2px -2px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_mini_player:before{background:url(\"data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M2.00005%2011V9H5.60005L1.30005%204.7L2.70005%203.3L7.00005%207.6V4H9.00005V11H2.00005ZM4.00005%2020C3.45005%2020%202.97922%2019.8042%202.58755%2019.4125C2.19588%2019.0208%202.00005%2018.55%202.00005%2018V13H4.00005V18H12V20H4.00005ZM20%2013V6H11V4H20C20.55%204%2021.0209%204.19583%2021.4125%204.5875C21.8042%204.97917%2022%205.45%2022%206V13H20ZM14%2020V15H22V20H14Z'%20fill='white'/%3e%3c/svg%3e\") no-repeat 0 0;background-size:20px}.fluid_video_wrapper.fluid_mini_player_mode .fluid_controls_container .fluid_button.fluid_button_mini_player:before{background:url(\"data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M3.5%2020C3.1%2020%202.75%2019.85%202.45%2019.55C2.15%2019.25%202%2018.9%202%2018.5V11H3.5V18.5H20.5V5.5H11V4H20.5C20.9%204%2021.25%204.15%2021.55%204.45C21.85%204.75%2022%205.1%2022%205.5V18.5C22%2018.9%2021.85%2019.25%2021.55%2019.55C21.25%2019.85%2020.9%2020%2020.5%2020H3.5ZM17.425%2016.5L18.5%2015.425L14.725%2011.675H17.675V10.175H12.175V15.675H13.675V12.75L17.425%2016.5ZM2%209.5V4H9.5V9.5H2Z'%20fill='white'/%3e%3c/svg%3e\") no-repeat 0 0;background-size:20px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_skip_back{margin-left:5px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_video_source:hover:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_fullscreen_exit:hover:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_fullscreen:hover:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_mute:hover:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_volume:hover:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_pause:hover:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_play:hover:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_skip_back:hover:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_skip_forward:hover:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_playback_rate:hover:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_download:hover:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_theatre:hover:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_subtitles:hover:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_cardboard:hover:before,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_mini_player:hover:before{opacity:1}.fp_title{position:absolute;top:10px;left:10px;color:#fff;font-size:15px;font-family:-apple-system,BlinkMacSystemFont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,arial,sans-serif,\"apple color emoji\",\"segoe ui emoji\",segoe ui symbol;font-weight:400;white-space:nowrap}.transform-active{animation:flash 1s infinite;display:inline-block!important;opacity:0}@keyframes flash{0%{opacity:.6;box-shadow:0 0 #fff9}70%{box-shadow:0 0 0 20px #fff0}to{opacity:0;display:none;box-shadow:0 0 #fff0}}.fluid_nonLinear_top,.fluid_nonLinear_middle,.fluid_nonLinear_bottom{flex-direction:column;align-items:center;cursor:pointer;display:flex;vertical-align:middle;align-content:center;border:1px solid #777777;position:absolute;left:50%;margin-right:-50%;background-color:#000000b3}.fluid_nonLinear_top{top:20px;transform:translate(-50%)}.fluid_nonLinear_middle{top:50%;transform:translate(-50%,-50%)}.fluid_nonLinear_bottom{bottom:50px;transform:translate(-50%)}.fluid_vpaidNonLinear_top,.fluid_vpaidNonLinear_middle,.fluid_vpaidNonLinear_bottom{flex-direction:column;align-items:center;cursor:pointer;vertical-align:middle;align-content:center;position:absolute;display:flex}.fluid_vpaidNonLinear_frame{margin:auto;position:absolute;top:0;left:0;right:0;bottom:0}.fluid_vpaidNonLinear_top{top:20px}.fluid_vpaidNonLinear_middle{top:50%}.fluid_vpaidNonLinear_bottom{bottom:50px}.add_icon_clickthrough{color:#f2c94c;line-height:18px;text-overflow:ellipsis;max-width:100%;white-space:nowrap;overflow:hidden;display:inline-block}.add_icon_clickthrough:before{background:url(\"data:image/svg+xml,%3csvg%20xmlns:xlink='http://www.w3.org/1999/xlink'%20xmlns='http://www.w3.org/2000/svg'%20width='388.75'%20height='96'%20version='1.1'%20viewBox='0%200%20388.75%2096'%20id='svg63'%3e%3cpath%20id='path4087'%20d='m%20347.64062,35.959%20a%206.9826789,6.9826789%200%200%200%206.98438,-6.984375%206.9826789,6.9826789%200%200%200%20-6.98438,-6.982422%206.9826789,6.9826789%200%200%200%20-6.98242,6.982422%206.9826789,6.9826789%200%200%200%206.98242,6.984375%20z%20m%200,-2.476562%20a%204.5078053,4.5078053%200%200%201%20-4.50781,-4.507813%204.5078053,4.5078053%200%200%201%204.50781,-4.507812%204.5078053,4.5078053%200%200%201%204.50781,4.507812%204.5078053,4.5078053%200%200%201%20-4.50781,4.507813%20z'%20style='fill:%23ffffff;fill-opacity:1;stroke-width:1.70873225'%20/%3e%3cpath%20style='fill:%23ffffff;fill-opacity:1;stroke-width:1.00886583'%20d='M%20273.55469,22%20C%20272.69375,22%20272,22.693749%20272,23.554688%20V%2034.445312%20C%20272,35.306251%20272.69375,36%20273.55469,36%20h%2010.89062%20C%20285.30625,36%20286,35.306251%20286,34.445312%20V%2023.554688%20C%20286,22.693749%20285.30625,22%20284.44531,22%20Z%20m%203.61133,4.541016%20c%200.22916,0%200.45442,0.02083%200.67578,0.0625%200.22396,0.03906%200.44661,0.09896%200.66797,0.179687%20v%201.140625%20c%20-0.19011,-0.130208%20-0.38151,-0.226562%20-0.57422,-0.289062%20-0.19011,-0.0625%20-0.38802,-0.09375%20-0.59375,-0.09375%20-0.39063,0%20-0.69532,0.114583%20-0.91407,0.34375%20-0.21614,0.226562%20-0.32421,0.54427%20-0.32421,0.953125%200,0.408854%200.10807,0.727864%200.32421,0.957031%200.21875,0.226562%200.52344,0.339844%200.91407,0.339844%200.21875,0%200.42578,-0.03255%200.62109,-0.09766%200.19792,-0.0651%200.38021,-0.161458%200.54688,-0.289062%20v%201.144531%20c%20-0.21875,0.08073%20-0.44141,0.140625%20-0.66797,0.179688%20-0.22396,0.04167%20-0.44922,0.0625%20-0.67578,0.0625%20-0.78907,0%20-1.40625,-0.201823%20-1.85157,-0.605469%20-0.44531,-0.40625%20-0.66797,-0.970052%20-0.66797,-1.691406%200,-0.721355%200.22266,-1.283855%200.66797,-1.6875%200.44532,-0.40625%201.0625,-0.609375%201.85157,-0.609375%20z%20m%204.75,0%20c%200.22916,0%200.45442,0.02083%200.67578,0.0625%200.22396,0.03906%200.44661,0.09896%200.66797,0.179687%20v%201.140625%20c%20-0.19011,-0.130208%20-0.38151,-0.226562%20-0.57422,-0.289062%20-0.19011,-0.0625%20-0.38802,-0.09375%20-0.59375,-0.09375%20-0.39063,0%20-0.69532,0.114583%20-0.91407,0.34375%20-0.21614,0.226562%20-0.32421,0.54427%20-0.32421,0.953125%200,0.408854%200.10807,0.727864%200.32421,0.957031%200.21875,0.226562%200.52344,0.339844%200.91407,0.339844%200.21875,0%200.42578,-0.03255%200.62109,-0.09766%200.19792,-0.0651%200.38021,-0.161458%200.54688,-0.289062%20v%201.144531%20c%20-0.21875,0.08073%20-0.44141,0.140625%20-0.66797,0.179688%20-0.22396,0.04167%20-0.44922,0.0625%20-0.67578,0.0625%20-0.78907,0%20-1.40625,-0.201823%20-1.85157,-0.605469%20-0.44531,-0.40625%20-0.66797,-0.970052%20-0.66797,-1.691406%200,-0.721355%200.22266,-1.283855%200.66797,-1.6875%200.44532,-0.40625%201.0625,-0.609375%201.85157,-0.609375%20z'%20id='rect7816'%20/%3e%3cg%20transform='translate(-3702,106)'%20id='g44'%3e%3cclipPath%20id='q'%20style='clip-rule:evenodd'%3e%3cpath%20d='m%203702,-106%20h%20272%20v%2096%20h%20-272%20z'%20id='path6'%20style='fill:%23ffffff'/%3e%3c/clipPath%3e%3cg%20clip-path='url(%23q)'%20id='g42'%3e%3cuse%20transform='translate(3757,-86)'%20xlink:href='%23o'%20id='use9'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3757,-48)'%20xlink:href='%23i'%20id='use11'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3830,-84)'%20xlink:href='%23h'%20id='use13'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3723,-86)'%20xlink:href='%23g'%20id='use15'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3723,-48)'%20xlink:href='%23f'%20id='use17'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3795,-46)'%20xlink:href='%23e'%20id='use19'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3831,-46)'%20xlink:href='%23d'%20id='use21'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3865,-44)'%20xlink:href='%23c'%20id='use23'%20style='fill:%23f2c94c'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3795,-84)'%20xlink:href='%23b'%20id='use25'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3866,-83)'%20xlink:href='%23a'%20id='use27'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3939,-47)'%20xlink:href='%23n'%20id='use29'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cmask%20id='p'%3e%3cuse%20transform='translate(3902,-46)'%20xlink:href='%23m'%20id='use31'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3c/mask%3e%3cg%20mask='url(%23p)'%20id='g36'%3e%3cuse%20transform='translate(3902,-46)'%20xlink:href='%23l'%20id='use34'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3c/g%3e%3cuse%20transform='translate(3904,-85)'%20xlink:href='%23k'%20id='use38'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3939,-85)'%20xlink:href='%23j'%20id='use40'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3c/g%3e%3c/g%3e%3cdefs%20id='defs61'%3e%3cpath%20id='o'%20d='m%200,5.5924%20v%205.8152%20H%203.7778%20L%208.5,16.2537%20V%200.7467%20L%203.7778,5.5928%20H%200%20Z%20M%2012.75,8.5%20c%200,-1.7155%20-0.9633,-3.1887%20-2.3611,-3.9059%20v%207.8021%20C%2011.7867,11.6887%2012.75,10.2155%2012.75,8.5%20Z%20M%2010.3889,0%20v%201.9966%20c%202.7294,0.83352%204.7222,3.431%204.7222,6.5034%200,3.0724%20-1.9928,5.6699%20-4.7222,6.5034%20V%2017%20C%2014.1761,16.118%2017,12.6482%2017,8.5%2017,4.3518%2014.1761,0.882%2010.3889,0%20Z'%20/%3e%3cpath%20id='i'%20d='m%2012.75,8.5%20c%200,-1.6717%20-0.9633,-3.1072%20-2.3611,-3.8061%20V%206.7811%20L%2012.7028,9.095%20C%2012.7311,8.90611%2012.75,8.70778%2012.75,8.5%20Z%20m%202.3611,0%20c%200,0.88778%20-0.1889,1.7189%20-0.51,2.4933%20l%201.4261,1.4261%20C%2016.6506,11.2483%2017,9.9167%2017,8.5%2017,4.4578%2014.1761,1.0767%2010.3889,0.2172%20V%202.1628%20C%2013.1183,2.97502%2015.1111,5.5061%2015.1111,8.5%20Z%20M%201.1991,0%20-3e-4,1.1994%204.4669,5.6666%20H%20-3e-4%20v%205.6666%20h%203.7778%20l%204.7222,4.7223%20V%209.6993%20l%204.0139,4.0139%20c%20-0.6328,0.4911%20-1.3411,0.8784%20-2.125,1.1145%20v%201.9455%20c%201.3033,-0.2927%202.4839,-0.8972%203.485,-1.7094%20l%201.9267,1.9361%201.1994,-1.1994%20-8.5,-8.5%20L%201.1991,-1e-4%20Z%20m%207.3006,0.94444%20-1.9739,1.9739%201.9739,1.9739%20z'%20/%3e%3cpath%20id='h'%20d='M%2012.444,0%20H%201.555%20C%200.69166,0%20-6e-4,0.7%20-6e-4,1.5556%20v%2010.889%20c%200,0.8556%200.69222,1.5556%201.5556,1.5556%20h%2010.889%20c%200.8556,0%201.5556,-0.7%201.5556,-1.5556%20V%201.5556%20C%2013.9996,0.70004%2013.2996,0%2012.444,0%20Z%20M%206.2218,9.3333%20H%205.0551%20V%207.7777%20H%203.4995%20V%209.3333%20H%202.3328%20V%204.6666%20H%203.4995%20V%206.611%20H%205.0551%20V%204.6666%20H%206.2218%20Z%20M%207.7774,4.6666%20h%203.1111%20c%200.4278,0%200.7778,0.35%200.7778,0.77777%20v%203.1111%20c%200,0.42777%20-0.35,0.77777%20-0.7778,0.77777%20H%207.7774%20v%20-4.6667%20z%20m%201.1667,3.5%20h%201.5556%20V%205.8333%20H%208.9441%20Z'%20/%3e%3cpath%20id='g'%20d='M%200,0%20V%2017%20L%2013,8.5%20Z'%20/%3e%3cpath%20id='f'%20d='M%200,17%20H%204.3333%20V%200%20H%200%20Z%20M%208.6667,0%20V%2017%20H%2013%20V%200%20Z'%20/%3e%3cpath%20id='e'%20d='m%200,11%20h%203%20v%203%20H%205%20V%209%20H%200%20Z%20M%203,3%20H%200%20V%205%20H%205%20V%200%20H%203%20Z%20m%206,11%20h%202%20v%20-3%20h%203%20V%209%20H%209%20Z%20M%2011,3%20V%200%20H%209%20v%205%20h%205%20V%203%20Z'%20/%3e%3cpath%20id='d'%20d='M%200,12%208.5,6%200,0%20Z%20M%2010,0%20v%2012%20h%202%20V%200%20Z'%20/%3e%3cpath%20id='c'%20d='M%201.52,4.5%20C%201.52,2.961%202.632,1.71%204,1.71%20H%207.2%20V%200%20H%204%20C%201.792,0%200,2.016%200,4.5%200,6.984%201.792,9%204,9%20H%207.2%20V%207.29%20H%204%20C%202.632,7.29%201.52,6.039%201.52,4.5%20Z%20M%204.8,5.4%20h%206.4%20V%203.6%20H%204.8%20Z%20M%2012,0%20H%208.8%20V%201.71%20H%2012%20c%201.368,0%202.48,1.251%202.48,2.79%200,1.539%20-1.112,2.79%20-2.48,2.79%20H%208.8%20V%209%20H%2012%20C%2014.208,9%2016,6.984%2016,4.5%2016,2.016%2014.208,0%2012,0%20Z'%20/%3e%3cpath%20id='b'%20d='M%202,9%20H%200%20v%205%20H%205%20V%2012%20H%202%20Z%20M%200,5%20H%202%20V%202%20H%205%20V%200%20H%200%20Z%20m%2012,7%20H%209%20v%202%20h%205%20V%209%20H%2012%20Z%20M%209,0%20v%202%20h%203%20v%203%20h%202%20V%200%20Z'%20/%3e%3cpath%20id='a'%20d='M%204.4546,8.7015%201.1137,5.2537%201e-4,6.403%204.4546,11%2014,1.1492%2012.8864,-1e-4%204.4546,8.7014%20Z'%20/%3e%3cpath%20id='n'%20d='M%2012.348,7.686%20C%2012.3768,7.462%2012.3984,7.238%2012.3984,7%2012.3984,6.762%2012.3768,6.538%2012.348,6.314%20L%2013.8664,5.159%20C%2014.0032,5.054%2014.0391,4.865%2013.9528,4.711%20L%2012.5135,2.289%20C%2012.4272,2.135%2012.2329,2.079%2012.0745,2.135%20l%20-1.7919,0.7%20C%209.90842,2.555%209.50543,2.324%209.0664,2.149%20L%208.79294,0.294%20C%208.77135,0.126%208.62022,0%208.44031,0%20H%205.56171%20C%205.38181,0%205.23068,0.126%205.20909,0.294%20L%204.93563,2.149%20C%204.49665,2.324%204.09365,2.562%203.71943,2.835%20l%20-1.7919,-0.7%20C%201.76201,2.072%201.5749,2.135%201.48855,2.289%20l%20-1.4393,2.422%20c%20-0.093553,0.154%20-0.050374,0.343%200.086356,0.448%20l%201.5184,1.155%20C%201.625226,6.538%201.603636,6.769%201.603636,7%20c%200,0.231%200.02159,0.462%200.05037,0.686%20l%20-1.5184,1.155%20c%20-0.13673,0.105%20-0.17271,0.294%20-0.086356,0.448%20l%201.4393,2.422%20c%200.08635,0.154%200.28066,0.21%200.43898,0.154%20l%201.7919,-0.7%20c%200.37421,0.28%200.77721,0.511%201.2162,0.686%20l%200.27346,1.855%20C%205.23068,13.874%205.38181,14%205.56171,14%20h%202.8786%20c%200.17991,0%200.33104,-0.126%200.35263,-0.294%20L%209.0664,11.851%20c%200.43898,-0.175%200.84197,-0.413%201.2162,-0.686%20l%201.7919,0.7%20c%200.1655,0.063%200.3527,0%200.439,-0.154%20L%2013.9528,9.289%20C%2014.0391,9.135%2014.0032,8.946%2013.8664,8.841%20Z%20M%207.0011,9.45%20C%205.6122,9.45%204.4824,8.351%204.4824,7%204.4824,5.649%205.6122,4.55%207.0011,4.55%208.39,4.55%209.5198,5.649%209.5198,7%209.5198,8.351%208.39,9.45%207.0011,9.45%20Z'%20/%3e%3cpath%20id='m'%20d='M%200,0%20H%2016%20V%2012%20H%200%20Z'%20/%3e%3cpath%20id='l'%20d='m%200,0%20v%20-2%20h%20-2%20v%202%20z%20m%2016,0%20h%202%20v%20-2%20h%20-2%20z%20m%200,12%20v%202%20h%202%20V%2012%20Z%20M%200,12%20h%20-2%20v%202%20H%200%20Z%20M%200,2%20H%2016%20V%20-2%20H%200%20Z%20M%2014,0%20v%2012%20h%204%20V%200%20Z%20m%202,10%20H%200%20v%204%20H%2016%20Z%20M%202,12%20V%200%20h%20-4%20v%2012%20z'%20/%3e%3cpath%20id='k'%20d='M%2012,5.2941%20H%208.5714%20V%200%20H%203.4285%20V%205.2941%20H%20-1e-4%20l%206,6.1765%206,-6.1765%20z%20M%200,13.2353%20V%2015%20h%2012%20v%20-1.7647%20z'%20/%3e%3cpath%20id='j'%20d='M%209.3333,0%20H%204.6666%20V%201.5238%20H%209.3333%20Z%20M%206.2222,9.9048%20H%207.7778%20V%205.3334%20H%206.2222%20Z%20M%2012.4678,4.8686%2013.5722,3.7867%20C%2013.2378,3.39813%2012.8722,3.03241%2012.4756,2.7124%20L%2011.3711,3.7943%20C%2010.1656,2.84953%208.6489,2.2857%207,2.2857%203.1344,2.2857%200,5.3562%200,9.1429%200,12.9295%203.1267,16%207,16%2010.8733,16%2014,12.9295%2014,9.1429%2014,7.5277%2013.4244,6.0419%2012.4678,4.8686%20Z%20M%207,14.4762%20C%203.99,14.4762%201.5556,12.0914%201.5556,9.1429%201.5556,6.1943%203.99,3.8096%207,3.8096%20c%203.01,0%205.4444,2.3848%205.4444,5.3333%200,2.9485%20-2.4344,5.3333%20-5.4444,5.3333%20z'%20/%3e%3c/defs%3e%3cg%20id='g3989'%20transform='matrix(0.03107656,0,0,0.03432918,271.52581,57.128037)'%20style='fill:%23ffffff'%3e%3cg%20id='g3979'%20style='fill:%23ffffff'%3e%3cpath%20style='fill:%23ffffff;stroke-width:0.03266241'%20d='m%20273.49023,60.4375%20c%20-1.07158,0%20-1.96484,0.958273%20-1.96484,2.169922%20v%206.61914%20c%200,1.216352%200.89727,2.167935%201.96484,2.167969%20h%202.87305%20c%200.52417,0%201.01765,-0.2246%201.39063,-0.634765%20l%201,-1.103516%20c%200.19059,-0.211639%200.45448,-0.333984%200.72656,-0.333984%200.27207,0%200.53829,0.122547%200.73047,0.335937%20l%200.99804,1.101563%20c%200.37212,0.409203%200.86646,0.634765%201.39063,0.634765%20h%202.87305%20c%201.07158,0%201.96484,-0.95632%201.96484,-2.167969%20v%20-6.61914%20c%200,-1.216352%20-0.89727,-2.169922%20-1.96484,-2.169922%20z%20m%202.4961,3.308594%20c%201.08295,0%201.96484,0.973618%201.96484,2.169922%200,1.196303%20-0.88185,2.169921%20-1.96484,2.169922%20-1.08299,0%20-1.96485,-0.973619%20-1.96485,-2.169922%200,-1.196304%200.88189,-2.169922%201.96485,-2.169922%20z%20m%206.99023,0%20c%201.08296,0%201.96485,0.973618%201.96485,2.169922%200,1.196303%20-0.88189,2.169922%20-1.96485,2.169922%20-1.08298,0%20-1.96484,-0.973619%20-1.96484,-2.169922%200,-1.196304%200.88189,-2.169922%201.96484,-2.169922%20z'%20transform='matrix(32.178594,0,0,29.129737,-8737.3187,-1664.1247)'%20id='path3977'%20/%3e%3c/g%3e%3cg%20id='g3983'%20style='fill:%23ffffff'/%3e%3cg%20id='g3987'%20style='fill:%23ffffff'/%3e%3c/g%3e%3cpath%20style='fill:%23ffffff;fill-opacity:1'%20d='M%20317.03125%2021.992188%20A%206.9826789%206.9826789%200%200%200%20310.04883%2028.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2035.958984%20A%206.9826789%206.9826789%200%200%200%20324.01367%2028.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2021.992188%20z%20M%20312.20703%2027.580078%20L%20321.94336%2027.642578%20C%20322.32865%2027.645013%20322.63647%2027.956519%20322.63281%2028.341797%20L%20322.62109%2029.603516%20C%20322.61743%2029.988794%20322.30326%2030.297356%20321.91797%2030.294922%20L%20312.18164%2030.232422%20C%20311.79635%2030.229987%20311.48853%2029.918481%20311.49219%2029.533203%20L%20311.50391%2028.271484%20C%20311.50757%2027.886206%20311.82174%2027.577644%20312.20703%2027.580078%20z%20'%20id='path3997'/%3e%3cpath%20style='fill:%23ffffff;fill-opacity:1'%20d='M%20317.03125%2059.992188%20A%206.9826789%206.9826789%200%200%200%20310.04883%2066.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2073.958984%20A%206.9826789%206.9826789%200%200%200%20324.01367%2066.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2059.992188%20z%20M%20316.49805%2061.365234%20L%20317.76172%2061.382812%20C%20318.14697%2061.388692%20318.45192%2061.704576%20318.44727%2062.089844%20L%20318.4043%2065.619141%20L%20321.94336%2065.642578%20C%20322.32865%2065.645013%20322.63647%2065.956519%20322.63281%2066.341797%20L%20322.62109%2067.603516%20C%20322.61743%2067.988794%20322.30326%2068.297356%20321.91797%2068.294922%20L%20318.37305%2068.271484%20L%20318.33008%2071.826172%20C%20318.32543%2072.21144%20318.0122%2072.515645%20317.62695%2072.509766%20L%20316.36328%2072.492188%20C%20315.97803%2072.486309%20315.67308%2072.170424%20315.67773%2071.785156%20L%20315.7207%2068.255859%20L%20312.18164%2068.232422%20C%20311.79635%2068.229987%20311.48853%2067.918481%20311.49219%2067.533203%20L%20311.50391%2066.271484%20C%20311.50757%2065.886206%20311.82174%2065.577644%20312.20703%2065.580078%20L%20315.75195%2065.603516%20L%20315.79492%2062.048828%20C%20315.79957%2061.66356%20316.1128%2061.359355%20316.49805%2061.365234%20z%20'%20id='path3997-6'/%3e%3cellipse%20style='fill:%23800000;fill-opacity:1;stroke-width:1.10310566'%20id='circle4073'%20cx='353.64172'%20cy='-28.97954'%20transform='scale(1,-1)'%20/%3e%3cg%20id='g7787'%20transform='matrix(-0.02885349,0,0,-0.02885337,352.04486,75.172258)'%20style='fill:%23ffffff;fill-opacity:1'%3e%3cg%20id='g7731'%20transform='translate(-90.566882,42.049084)'%20style='fill:%23ffffff;fill-opacity:1'%3e%3cpath%20id='path7729'%20d='M%20242.607,0%20C%20108.629,0%200.001,108.628%200.001,242.606%20c%200,133.976%20108.628,242.606%20242.606,242.606%20133.978,0%20242.604,-108.631%20242.604,-242.606%20C%20485.212,108.628%20376.585,0%20242.607,0%20Z%20M%20401.815,288.094%20H%20219.862%20v%2090.979%20L%2083.397,242.606%20219.862,106.141%20v%2090.978%20h%20181.953%20z'%20style='fill:%23ffffff;fill-opacity:1'/%3e%3c/g%3e%3cg%20id='g7733'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7735'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7737'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7739'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7741'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7743'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7745'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7747'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7749'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7751'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7753'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7755'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7757'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7759'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7761'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3c/g%3e%3c/svg%3e\") no-repeat;height:18px;width:18px;top:30px;padding:3px 22px 0 0;content:\"\";background-position:-162px -57px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_theatre,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_playback_rate,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_video_source,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_download,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_subtitles,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_cardboard{float:right;padding-right:5px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_theatre,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_playback_rate,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_video_source,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_download,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_subtitles,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_button.fluid_button_cardboard{display:none}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button_subtitles .fluid_subtitles_list,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button_subtitles .fluid_subtitle_size_menu,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_button_video_source .fluid_video_sources_list,.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_video_playback_rates{z-index:888888!important;opacity:.9!important}.fluid_video_playback_rates_item{padding:9px 25px;line-height:15px;text-align:center}.fluid_theatre_mode{position:fixed;float:left;top:0;z-index:10;box-shadow:0 15px 25px #000c}.fluid_mini_player_mode{position:fixed;bottom:10px;right:10px;z-index:10}.source_button_icon{background:url(\"data:image/svg+xml,%3csvg%20xmlns:xlink='http://www.w3.org/1999/xlink'%20xmlns='http://www.w3.org/2000/svg'%20width='388.75'%20height='96'%20version='1.1'%20viewBox='0%200%20388.75%2096'%20id='svg63'%3e%3cpath%20id='path4087'%20d='m%20347.64062,35.959%20a%206.9826789,6.9826789%200%200%200%206.98438,-6.984375%206.9826789,6.9826789%200%200%200%20-6.98438,-6.982422%206.9826789,6.9826789%200%200%200%20-6.98242,6.982422%206.9826789,6.9826789%200%200%200%206.98242,6.984375%20z%20m%200,-2.476562%20a%204.5078053,4.5078053%200%200%201%20-4.50781,-4.507813%204.5078053,4.5078053%200%200%201%204.50781,-4.507812%204.5078053,4.5078053%200%200%201%204.50781,4.507812%204.5078053,4.5078053%200%200%201%20-4.50781,4.507813%20z'%20style='fill:%23ffffff;fill-opacity:1;stroke-width:1.70873225'%20/%3e%3cpath%20style='fill:%23ffffff;fill-opacity:1;stroke-width:1.00886583'%20d='M%20273.55469,22%20C%20272.69375,22%20272,22.693749%20272,23.554688%20V%2034.445312%20C%20272,35.306251%20272.69375,36%20273.55469,36%20h%2010.89062%20C%20285.30625,36%20286,35.306251%20286,34.445312%20V%2023.554688%20C%20286,22.693749%20285.30625,22%20284.44531,22%20Z%20m%203.61133,4.541016%20c%200.22916,0%200.45442,0.02083%200.67578,0.0625%200.22396,0.03906%200.44661,0.09896%200.66797,0.179687%20v%201.140625%20c%20-0.19011,-0.130208%20-0.38151,-0.226562%20-0.57422,-0.289062%20-0.19011,-0.0625%20-0.38802,-0.09375%20-0.59375,-0.09375%20-0.39063,0%20-0.69532,0.114583%20-0.91407,0.34375%20-0.21614,0.226562%20-0.32421,0.54427%20-0.32421,0.953125%200,0.408854%200.10807,0.727864%200.32421,0.957031%200.21875,0.226562%200.52344,0.339844%200.91407,0.339844%200.21875,0%200.42578,-0.03255%200.62109,-0.09766%200.19792,-0.0651%200.38021,-0.161458%200.54688,-0.289062%20v%201.144531%20c%20-0.21875,0.08073%20-0.44141,0.140625%20-0.66797,0.179688%20-0.22396,0.04167%20-0.44922,0.0625%20-0.67578,0.0625%20-0.78907,0%20-1.40625,-0.201823%20-1.85157,-0.605469%20-0.44531,-0.40625%20-0.66797,-0.970052%20-0.66797,-1.691406%200,-0.721355%200.22266,-1.283855%200.66797,-1.6875%200.44532,-0.40625%201.0625,-0.609375%201.85157,-0.609375%20z%20m%204.75,0%20c%200.22916,0%200.45442,0.02083%200.67578,0.0625%200.22396,0.03906%200.44661,0.09896%200.66797,0.179687%20v%201.140625%20c%20-0.19011,-0.130208%20-0.38151,-0.226562%20-0.57422,-0.289062%20-0.19011,-0.0625%20-0.38802,-0.09375%20-0.59375,-0.09375%20-0.39063,0%20-0.69532,0.114583%20-0.91407,0.34375%20-0.21614,0.226562%20-0.32421,0.54427%20-0.32421,0.953125%200,0.408854%200.10807,0.727864%200.32421,0.957031%200.21875,0.226562%200.52344,0.339844%200.91407,0.339844%200.21875,0%200.42578,-0.03255%200.62109,-0.09766%200.19792,-0.0651%200.38021,-0.161458%200.54688,-0.289062%20v%201.144531%20c%20-0.21875,0.08073%20-0.44141,0.140625%20-0.66797,0.179688%20-0.22396,0.04167%20-0.44922,0.0625%20-0.67578,0.0625%20-0.78907,0%20-1.40625,-0.201823%20-1.85157,-0.605469%20-0.44531,-0.40625%20-0.66797,-0.970052%20-0.66797,-1.691406%200,-0.721355%200.22266,-1.283855%200.66797,-1.6875%200.44532,-0.40625%201.0625,-0.609375%201.85157,-0.609375%20z'%20id='rect7816'%20/%3e%3cg%20transform='translate(-3702,106)'%20id='g44'%3e%3cclipPath%20id='q'%20style='clip-rule:evenodd'%3e%3cpath%20d='m%203702,-106%20h%20272%20v%2096%20h%20-272%20z'%20id='path6'%20style='fill:%23ffffff'/%3e%3c/clipPath%3e%3cg%20clip-path='url(%23q)'%20id='g42'%3e%3cuse%20transform='translate(3757,-86)'%20xlink:href='%23o'%20id='use9'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3757,-48)'%20xlink:href='%23i'%20id='use11'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3830,-84)'%20xlink:href='%23h'%20id='use13'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3723,-86)'%20xlink:href='%23g'%20id='use15'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3723,-48)'%20xlink:href='%23f'%20id='use17'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3795,-46)'%20xlink:href='%23e'%20id='use19'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3831,-46)'%20xlink:href='%23d'%20id='use21'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3865,-44)'%20xlink:href='%23c'%20id='use23'%20style='fill:%23f2c94c'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3795,-84)'%20xlink:href='%23b'%20id='use25'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3866,-83)'%20xlink:href='%23a'%20id='use27'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3939,-47)'%20xlink:href='%23n'%20id='use29'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cmask%20id='p'%3e%3cuse%20transform='translate(3902,-46)'%20xlink:href='%23m'%20id='use31'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3c/mask%3e%3cg%20mask='url(%23p)'%20id='g36'%3e%3cuse%20transform='translate(3902,-46)'%20xlink:href='%23l'%20id='use34'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3c/g%3e%3cuse%20transform='translate(3904,-85)'%20xlink:href='%23k'%20id='use38'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3939,-85)'%20xlink:href='%23j'%20id='use40'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3c/g%3e%3c/g%3e%3cdefs%20id='defs61'%3e%3cpath%20id='o'%20d='m%200,5.5924%20v%205.8152%20H%203.7778%20L%208.5,16.2537%20V%200.7467%20L%203.7778,5.5928%20H%200%20Z%20M%2012.75,8.5%20c%200,-1.7155%20-0.9633,-3.1887%20-2.3611,-3.9059%20v%207.8021%20C%2011.7867,11.6887%2012.75,10.2155%2012.75,8.5%20Z%20M%2010.3889,0%20v%201.9966%20c%202.7294,0.83352%204.7222,3.431%204.7222,6.5034%200,3.0724%20-1.9928,5.6699%20-4.7222,6.5034%20V%2017%20C%2014.1761,16.118%2017,12.6482%2017,8.5%2017,4.3518%2014.1761,0.882%2010.3889,0%20Z'%20/%3e%3cpath%20id='i'%20d='m%2012.75,8.5%20c%200,-1.6717%20-0.9633,-3.1072%20-2.3611,-3.8061%20V%206.7811%20L%2012.7028,9.095%20C%2012.7311,8.90611%2012.75,8.70778%2012.75,8.5%20Z%20m%202.3611,0%20c%200,0.88778%20-0.1889,1.7189%20-0.51,2.4933%20l%201.4261,1.4261%20C%2016.6506,11.2483%2017,9.9167%2017,8.5%2017,4.4578%2014.1761,1.0767%2010.3889,0.2172%20V%202.1628%20C%2013.1183,2.97502%2015.1111,5.5061%2015.1111,8.5%20Z%20M%201.1991,0%20-3e-4,1.1994%204.4669,5.6666%20H%20-3e-4%20v%205.6666%20h%203.7778%20l%204.7222,4.7223%20V%209.6993%20l%204.0139,4.0139%20c%20-0.6328,0.4911%20-1.3411,0.8784%20-2.125,1.1145%20v%201.9455%20c%201.3033,-0.2927%202.4839,-0.8972%203.485,-1.7094%20l%201.9267,1.9361%201.1994,-1.1994%20-8.5,-8.5%20L%201.1991,-1e-4%20Z%20m%207.3006,0.94444%20-1.9739,1.9739%201.9739,1.9739%20z'%20/%3e%3cpath%20id='h'%20d='M%2012.444,0%20H%201.555%20C%200.69166,0%20-6e-4,0.7%20-6e-4,1.5556%20v%2010.889%20c%200,0.8556%200.69222,1.5556%201.5556,1.5556%20h%2010.889%20c%200.8556,0%201.5556,-0.7%201.5556,-1.5556%20V%201.5556%20C%2013.9996,0.70004%2013.2996,0%2012.444,0%20Z%20M%206.2218,9.3333%20H%205.0551%20V%207.7777%20H%203.4995%20V%209.3333%20H%202.3328%20V%204.6666%20H%203.4995%20V%206.611%20H%205.0551%20V%204.6666%20H%206.2218%20Z%20M%207.7774,4.6666%20h%203.1111%20c%200.4278,0%200.7778,0.35%200.7778,0.77777%20v%203.1111%20c%200,0.42777%20-0.35,0.77777%20-0.7778,0.77777%20H%207.7774%20v%20-4.6667%20z%20m%201.1667,3.5%20h%201.5556%20V%205.8333%20H%208.9441%20Z'%20/%3e%3cpath%20id='g'%20d='M%200,0%20V%2017%20L%2013,8.5%20Z'%20/%3e%3cpath%20id='f'%20d='M%200,17%20H%204.3333%20V%200%20H%200%20Z%20M%208.6667,0%20V%2017%20H%2013%20V%200%20Z'%20/%3e%3cpath%20id='e'%20d='m%200,11%20h%203%20v%203%20H%205%20V%209%20H%200%20Z%20M%203,3%20H%200%20V%205%20H%205%20V%200%20H%203%20Z%20m%206,11%20h%202%20v%20-3%20h%203%20V%209%20H%209%20Z%20M%2011,3%20V%200%20H%209%20v%205%20h%205%20V%203%20Z'%20/%3e%3cpath%20id='d'%20d='M%200,12%208.5,6%200,0%20Z%20M%2010,0%20v%2012%20h%202%20V%200%20Z'%20/%3e%3cpath%20id='c'%20d='M%201.52,4.5%20C%201.52,2.961%202.632,1.71%204,1.71%20H%207.2%20V%200%20H%204%20C%201.792,0%200,2.016%200,4.5%200,6.984%201.792,9%204,9%20H%207.2%20V%207.29%20H%204%20C%202.632,7.29%201.52,6.039%201.52,4.5%20Z%20M%204.8,5.4%20h%206.4%20V%203.6%20H%204.8%20Z%20M%2012,0%20H%208.8%20V%201.71%20H%2012%20c%201.368,0%202.48,1.251%202.48,2.79%200,1.539%20-1.112,2.79%20-2.48,2.79%20H%208.8%20V%209%20H%2012%20C%2014.208,9%2016,6.984%2016,4.5%2016,2.016%2014.208,0%2012,0%20Z'%20/%3e%3cpath%20id='b'%20d='M%202,9%20H%200%20v%205%20H%205%20V%2012%20H%202%20Z%20M%200,5%20H%202%20V%202%20H%205%20V%200%20H%200%20Z%20m%2012,7%20H%209%20v%202%20h%205%20V%209%20H%2012%20Z%20M%209,0%20v%202%20h%203%20v%203%20h%202%20V%200%20Z'%20/%3e%3cpath%20id='a'%20d='M%204.4546,8.7015%201.1137,5.2537%201e-4,6.403%204.4546,11%2014,1.1492%2012.8864,-1e-4%204.4546,8.7014%20Z'%20/%3e%3cpath%20id='n'%20d='M%2012.348,7.686%20C%2012.3768,7.462%2012.3984,7.238%2012.3984,7%2012.3984,6.762%2012.3768,6.538%2012.348,6.314%20L%2013.8664,5.159%20C%2014.0032,5.054%2014.0391,4.865%2013.9528,4.711%20L%2012.5135,2.289%20C%2012.4272,2.135%2012.2329,2.079%2012.0745,2.135%20l%20-1.7919,0.7%20C%209.90842,2.555%209.50543,2.324%209.0664,2.149%20L%208.79294,0.294%20C%208.77135,0.126%208.62022,0%208.44031,0%20H%205.56171%20C%205.38181,0%205.23068,0.126%205.20909,0.294%20L%204.93563,2.149%20C%204.49665,2.324%204.09365,2.562%203.71943,2.835%20l%20-1.7919,-0.7%20C%201.76201,2.072%201.5749,2.135%201.48855,2.289%20l%20-1.4393,2.422%20c%20-0.093553,0.154%20-0.050374,0.343%200.086356,0.448%20l%201.5184,1.155%20C%201.625226,6.538%201.603636,6.769%201.603636,7%20c%200,0.231%200.02159,0.462%200.05037,0.686%20l%20-1.5184,1.155%20c%20-0.13673,0.105%20-0.17271,0.294%20-0.086356,0.448%20l%201.4393,2.422%20c%200.08635,0.154%200.28066,0.21%200.43898,0.154%20l%201.7919,-0.7%20c%200.37421,0.28%200.77721,0.511%201.2162,0.686%20l%200.27346,1.855%20C%205.23068,13.874%205.38181,14%205.56171,14%20h%202.8786%20c%200.17991,0%200.33104,-0.126%200.35263,-0.294%20L%209.0664,11.851%20c%200.43898,-0.175%200.84197,-0.413%201.2162,-0.686%20l%201.7919,0.7%20c%200.1655,0.063%200.3527,0%200.439,-0.154%20L%2013.9528,9.289%20C%2014.0391,9.135%2014.0032,8.946%2013.8664,8.841%20Z%20M%207.0011,9.45%20C%205.6122,9.45%204.4824,8.351%204.4824,7%204.4824,5.649%205.6122,4.55%207.0011,4.55%208.39,4.55%209.5198,5.649%209.5198,7%209.5198,8.351%208.39,9.45%207.0011,9.45%20Z'%20/%3e%3cpath%20id='m'%20d='M%200,0%20H%2016%20V%2012%20H%200%20Z'%20/%3e%3cpath%20id='l'%20d='m%200,0%20v%20-2%20h%20-2%20v%202%20z%20m%2016,0%20h%202%20v%20-2%20h%20-2%20z%20m%200,12%20v%202%20h%202%20V%2012%20Z%20M%200,12%20h%20-2%20v%202%20H%200%20Z%20M%200,2%20H%2016%20V%20-2%20H%200%20Z%20M%2014,0%20v%2012%20h%204%20V%200%20Z%20m%202,10%20H%200%20v%204%20H%2016%20Z%20M%202,12%20V%200%20h%20-4%20v%2012%20z'%20/%3e%3cpath%20id='k'%20d='M%2012,5.2941%20H%208.5714%20V%200%20H%203.4285%20V%205.2941%20H%20-1e-4%20l%206,6.1765%206,-6.1765%20z%20M%200,13.2353%20V%2015%20h%2012%20v%20-1.7647%20z'%20/%3e%3cpath%20id='j'%20d='M%209.3333,0%20H%204.6666%20V%201.5238%20H%209.3333%20Z%20M%206.2222,9.9048%20H%207.7778%20V%205.3334%20H%206.2222%20Z%20M%2012.4678,4.8686%2013.5722,3.7867%20C%2013.2378,3.39813%2012.8722,3.03241%2012.4756,2.7124%20L%2011.3711,3.7943%20C%2010.1656,2.84953%208.6489,2.2857%207,2.2857%203.1344,2.2857%200,5.3562%200,9.1429%200,12.9295%203.1267,16%207,16%2010.8733,16%2014,12.9295%2014,9.1429%2014,7.5277%2013.4244,6.0419%2012.4678,4.8686%20Z%20M%207,14.4762%20C%203.99,14.4762%201.5556,12.0914%201.5556,9.1429%201.5556,6.1943%203.99,3.8096%207,3.8096%20c%203.01,0%205.4444,2.3848%205.4444,5.3333%200,2.9485%20-2.4344,5.3333%20-5.4444,5.3333%20z'%20/%3e%3c/defs%3e%3cg%20id='g3989'%20transform='matrix(0.03107656,0,0,0.03432918,271.52581,57.128037)'%20style='fill:%23ffffff'%3e%3cg%20id='g3979'%20style='fill:%23ffffff'%3e%3cpath%20style='fill:%23ffffff;stroke-width:0.03266241'%20d='m%20273.49023,60.4375%20c%20-1.07158,0%20-1.96484,0.958273%20-1.96484,2.169922%20v%206.61914%20c%200,1.216352%200.89727,2.167935%201.96484,2.167969%20h%202.87305%20c%200.52417,0%201.01765,-0.2246%201.39063,-0.634765%20l%201,-1.103516%20c%200.19059,-0.211639%200.45448,-0.333984%200.72656,-0.333984%200.27207,0%200.53829,0.122547%200.73047,0.335937%20l%200.99804,1.101563%20c%200.37212,0.409203%200.86646,0.634765%201.39063,0.634765%20h%202.87305%20c%201.07158,0%201.96484,-0.95632%201.96484,-2.167969%20v%20-6.61914%20c%200,-1.216352%20-0.89727,-2.169922%20-1.96484,-2.169922%20z%20m%202.4961,3.308594%20c%201.08295,0%201.96484,0.973618%201.96484,2.169922%200,1.196303%20-0.88185,2.169921%20-1.96484,2.169922%20-1.08299,0%20-1.96485,-0.973619%20-1.96485,-2.169922%200,-1.196304%200.88189,-2.169922%201.96485,-2.169922%20z%20m%206.99023,0%20c%201.08296,0%201.96485,0.973618%201.96485,2.169922%200,1.196303%20-0.88189,2.169922%20-1.96485,2.169922%20-1.08298,0%20-1.96484,-0.973619%20-1.96484,-2.169922%200,-1.196304%200.88189,-2.169922%201.96484,-2.169922%20z'%20transform='matrix(32.178594,0,0,29.129737,-8737.3187,-1664.1247)'%20id='path3977'%20/%3e%3c/g%3e%3cg%20id='g3983'%20style='fill:%23ffffff'/%3e%3cg%20id='g3987'%20style='fill:%23ffffff'/%3e%3c/g%3e%3cpath%20style='fill:%23ffffff;fill-opacity:1'%20d='M%20317.03125%2021.992188%20A%206.9826789%206.9826789%200%200%200%20310.04883%2028.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2035.958984%20A%206.9826789%206.9826789%200%200%200%20324.01367%2028.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2021.992188%20z%20M%20312.20703%2027.580078%20L%20321.94336%2027.642578%20C%20322.32865%2027.645013%20322.63647%2027.956519%20322.63281%2028.341797%20L%20322.62109%2029.603516%20C%20322.61743%2029.988794%20322.30326%2030.297356%20321.91797%2030.294922%20L%20312.18164%2030.232422%20C%20311.79635%2030.229987%20311.48853%2029.918481%20311.49219%2029.533203%20L%20311.50391%2028.271484%20C%20311.50757%2027.886206%20311.82174%2027.577644%20312.20703%2027.580078%20z%20'%20id='path3997'/%3e%3cpath%20style='fill:%23ffffff;fill-opacity:1'%20d='M%20317.03125%2059.992188%20A%206.9826789%206.9826789%200%200%200%20310.04883%2066.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2073.958984%20A%206.9826789%206.9826789%200%200%200%20324.01367%2066.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2059.992188%20z%20M%20316.49805%2061.365234%20L%20317.76172%2061.382812%20C%20318.14697%2061.388692%20318.45192%2061.704576%20318.44727%2062.089844%20L%20318.4043%2065.619141%20L%20321.94336%2065.642578%20C%20322.32865%2065.645013%20322.63647%2065.956519%20322.63281%2066.341797%20L%20322.62109%2067.603516%20C%20322.61743%2067.988794%20322.30326%2068.297356%20321.91797%2068.294922%20L%20318.37305%2068.271484%20L%20318.33008%2071.826172%20C%20318.32543%2072.21144%20318.0122%2072.515645%20317.62695%2072.509766%20L%20316.36328%2072.492188%20C%20315.97803%2072.486309%20315.67308%2072.170424%20315.67773%2071.785156%20L%20315.7207%2068.255859%20L%20312.18164%2068.232422%20C%20311.79635%2068.229987%20311.48853%2067.918481%20311.49219%2067.533203%20L%20311.50391%2066.271484%20C%20311.50757%2065.886206%20311.82174%2065.577644%20312.20703%2065.580078%20L%20315.75195%2065.603516%20L%20315.79492%2062.048828%20C%20315.79957%2061.66356%20316.1128%2061.359355%20316.49805%2061.365234%20z%20'%20id='path3997-6'/%3e%3cellipse%20style='fill:%23800000;fill-opacity:1;stroke-width:1.10310566'%20id='circle4073'%20cx='353.64172'%20cy='-28.97954'%20transform='scale(1,-1)'%20/%3e%3cg%20id='g7787'%20transform='matrix(-0.02885349,0,0,-0.02885337,352.04486,75.172258)'%20style='fill:%23ffffff;fill-opacity:1'%3e%3cg%20id='g7731'%20transform='translate(-90.566882,42.049084)'%20style='fill:%23ffffff;fill-opacity:1'%3e%3cpath%20id='path7729'%20d='M%20242.607,0%20C%20108.629,0%200.001,108.628%200.001,242.606%20c%200,133.976%20108.628,242.606%20242.606,242.606%20133.978,0%20242.604,-108.631%20242.604,-242.606%20C%20485.212,108.628%20376.585,0%20242.607,0%20Z%20M%20401.815,288.094%20H%20219.862%20v%2090.979%20L%2083.397,242.606%20219.862,106.141%20v%2090.978%20h%20181.953%20z'%20style='fill:%23ffffff;fill-opacity:1'/%3e%3c/g%3e%3cg%20id='g7733'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7735'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7737'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7739'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7741'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7743'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7745'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7747'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7749'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7751'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7753'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7755'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7757'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7759'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7761'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3c/g%3e%3c/svg%3e\") no-repeat;float:left;cursor:pointer;height:18px;width:18px;background-position:-164px -21px;opacity:0}.subtitle_button_icon{background:url(\"data:image/svg+xml,%3csvg%20xmlns:xlink='http://www.w3.org/1999/xlink'%20xmlns='http://www.w3.org/2000/svg'%20width='388.75'%20height='96'%20version='1.1'%20viewBox='0%200%20388.75%2096'%20id='svg63'%3e%3cpath%20id='path4087'%20d='m%20347.64062,35.959%20a%206.9826789,6.9826789%200%200%200%206.98438,-6.984375%206.9826789,6.9826789%200%200%200%20-6.98438,-6.982422%206.9826789,6.9826789%200%200%200%20-6.98242,6.982422%206.9826789,6.9826789%200%200%200%206.98242,6.984375%20z%20m%200,-2.476562%20a%204.5078053,4.5078053%200%200%201%20-4.50781,-4.507813%204.5078053,4.5078053%200%200%201%204.50781,-4.507812%204.5078053,4.5078053%200%200%201%204.50781,4.507812%204.5078053,4.5078053%200%200%201%20-4.50781,4.507813%20z'%20style='fill:%23ffffff;fill-opacity:1;stroke-width:1.70873225'%20/%3e%3cpath%20style='fill:%23ffffff;fill-opacity:1;stroke-width:1.00886583'%20d='M%20273.55469,22%20C%20272.69375,22%20272,22.693749%20272,23.554688%20V%2034.445312%20C%20272,35.306251%20272.69375,36%20273.55469,36%20h%2010.89062%20C%20285.30625,36%20286,35.306251%20286,34.445312%20V%2023.554688%20C%20286,22.693749%20285.30625,22%20284.44531,22%20Z%20m%203.61133,4.541016%20c%200.22916,0%200.45442,0.02083%200.67578,0.0625%200.22396,0.03906%200.44661,0.09896%200.66797,0.179687%20v%201.140625%20c%20-0.19011,-0.130208%20-0.38151,-0.226562%20-0.57422,-0.289062%20-0.19011,-0.0625%20-0.38802,-0.09375%20-0.59375,-0.09375%20-0.39063,0%20-0.69532,0.114583%20-0.91407,0.34375%20-0.21614,0.226562%20-0.32421,0.54427%20-0.32421,0.953125%200,0.408854%200.10807,0.727864%200.32421,0.957031%200.21875,0.226562%200.52344,0.339844%200.91407,0.339844%200.21875,0%200.42578,-0.03255%200.62109,-0.09766%200.19792,-0.0651%200.38021,-0.161458%200.54688,-0.289062%20v%201.144531%20c%20-0.21875,0.08073%20-0.44141,0.140625%20-0.66797,0.179688%20-0.22396,0.04167%20-0.44922,0.0625%20-0.67578,0.0625%20-0.78907,0%20-1.40625,-0.201823%20-1.85157,-0.605469%20-0.44531,-0.40625%20-0.66797,-0.970052%20-0.66797,-1.691406%200,-0.721355%200.22266,-1.283855%200.66797,-1.6875%200.44532,-0.40625%201.0625,-0.609375%201.85157,-0.609375%20z%20m%204.75,0%20c%200.22916,0%200.45442,0.02083%200.67578,0.0625%200.22396,0.03906%200.44661,0.09896%200.66797,0.179687%20v%201.140625%20c%20-0.19011,-0.130208%20-0.38151,-0.226562%20-0.57422,-0.289062%20-0.19011,-0.0625%20-0.38802,-0.09375%20-0.59375,-0.09375%20-0.39063,0%20-0.69532,0.114583%20-0.91407,0.34375%20-0.21614,0.226562%20-0.32421,0.54427%20-0.32421,0.953125%200,0.408854%200.10807,0.727864%200.32421,0.957031%200.21875,0.226562%200.52344,0.339844%200.91407,0.339844%200.21875,0%200.42578,-0.03255%200.62109,-0.09766%200.19792,-0.0651%200.38021,-0.161458%200.54688,-0.289062%20v%201.144531%20c%20-0.21875,0.08073%20-0.44141,0.140625%20-0.66797,0.179688%20-0.22396,0.04167%20-0.44922,0.0625%20-0.67578,0.0625%20-0.78907,0%20-1.40625,-0.201823%20-1.85157,-0.605469%20-0.44531,-0.40625%20-0.66797,-0.970052%20-0.66797,-1.691406%200,-0.721355%200.22266,-1.283855%200.66797,-1.6875%200.44532,-0.40625%201.0625,-0.609375%201.85157,-0.609375%20z'%20id='rect7816'%20/%3e%3cg%20transform='translate(-3702,106)'%20id='g44'%3e%3cclipPath%20id='q'%20style='clip-rule:evenodd'%3e%3cpath%20d='m%203702,-106%20h%20272%20v%2096%20h%20-272%20z'%20id='path6'%20style='fill:%23ffffff'/%3e%3c/clipPath%3e%3cg%20clip-path='url(%23q)'%20id='g42'%3e%3cuse%20transform='translate(3757,-86)'%20xlink:href='%23o'%20id='use9'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3757,-48)'%20xlink:href='%23i'%20id='use11'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3830,-84)'%20xlink:href='%23h'%20id='use13'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3723,-86)'%20xlink:href='%23g'%20id='use15'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3723,-48)'%20xlink:href='%23f'%20id='use17'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3795,-46)'%20xlink:href='%23e'%20id='use19'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3831,-46)'%20xlink:href='%23d'%20id='use21'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3865,-44)'%20xlink:href='%23c'%20id='use23'%20style='fill:%23f2c94c'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3795,-84)'%20xlink:href='%23b'%20id='use25'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3866,-83)'%20xlink:href='%23a'%20id='use27'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3939,-47)'%20xlink:href='%23n'%20id='use29'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cmask%20id='p'%3e%3cuse%20transform='translate(3902,-46)'%20xlink:href='%23m'%20id='use31'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3c/mask%3e%3cg%20mask='url(%23p)'%20id='g36'%3e%3cuse%20transform='translate(3902,-46)'%20xlink:href='%23l'%20id='use34'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3c/g%3e%3cuse%20transform='translate(3904,-85)'%20xlink:href='%23k'%20id='use38'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3cuse%20transform='translate(3939,-85)'%20xlink:href='%23j'%20id='use40'%20style='fill:%23ffffff'%20x='0'%20y='0'%20width='100%25'%20height='100%25'/%3e%3c/g%3e%3c/g%3e%3cdefs%20id='defs61'%3e%3cpath%20id='o'%20d='m%200,5.5924%20v%205.8152%20H%203.7778%20L%208.5,16.2537%20V%200.7467%20L%203.7778,5.5928%20H%200%20Z%20M%2012.75,8.5%20c%200,-1.7155%20-0.9633,-3.1887%20-2.3611,-3.9059%20v%207.8021%20C%2011.7867,11.6887%2012.75,10.2155%2012.75,8.5%20Z%20M%2010.3889,0%20v%201.9966%20c%202.7294,0.83352%204.7222,3.431%204.7222,6.5034%200,3.0724%20-1.9928,5.6699%20-4.7222,6.5034%20V%2017%20C%2014.1761,16.118%2017,12.6482%2017,8.5%2017,4.3518%2014.1761,0.882%2010.3889,0%20Z'%20/%3e%3cpath%20id='i'%20d='m%2012.75,8.5%20c%200,-1.6717%20-0.9633,-3.1072%20-2.3611,-3.8061%20V%206.7811%20L%2012.7028,9.095%20C%2012.7311,8.90611%2012.75,8.70778%2012.75,8.5%20Z%20m%202.3611,0%20c%200,0.88778%20-0.1889,1.7189%20-0.51,2.4933%20l%201.4261,1.4261%20C%2016.6506,11.2483%2017,9.9167%2017,8.5%2017,4.4578%2014.1761,1.0767%2010.3889,0.2172%20V%202.1628%20C%2013.1183,2.97502%2015.1111,5.5061%2015.1111,8.5%20Z%20M%201.1991,0%20-3e-4,1.1994%204.4669,5.6666%20H%20-3e-4%20v%205.6666%20h%203.7778%20l%204.7222,4.7223%20V%209.6993%20l%204.0139,4.0139%20c%20-0.6328,0.4911%20-1.3411,0.8784%20-2.125,1.1145%20v%201.9455%20c%201.3033,-0.2927%202.4839,-0.8972%203.485,-1.7094%20l%201.9267,1.9361%201.1994,-1.1994%20-8.5,-8.5%20L%201.1991,-1e-4%20Z%20m%207.3006,0.94444%20-1.9739,1.9739%201.9739,1.9739%20z'%20/%3e%3cpath%20id='h'%20d='M%2012.444,0%20H%201.555%20C%200.69166,0%20-6e-4,0.7%20-6e-4,1.5556%20v%2010.889%20c%200,0.8556%200.69222,1.5556%201.5556,1.5556%20h%2010.889%20c%200.8556,0%201.5556,-0.7%201.5556,-1.5556%20V%201.5556%20C%2013.9996,0.70004%2013.2996,0%2012.444,0%20Z%20M%206.2218,9.3333%20H%205.0551%20V%207.7777%20H%203.4995%20V%209.3333%20H%202.3328%20V%204.6666%20H%203.4995%20V%206.611%20H%205.0551%20V%204.6666%20H%206.2218%20Z%20M%207.7774,4.6666%20h%203.1111%20c%200.4278,0%200.7778,0.35%200.7778,0.77777%20v%203.1111%20c%200,0.42777%20-0.35,0.77777%20-0.7778,0.77777%20H%207.7774%20v%20-4.6667%20z%20m%201.1667,3.5%20h%201.5556%20V%205.8333%20H%208.9441%20Z'%20/%3e%3cpath%20id='g'%20d='M%200,0%20V%2017%20L%2013,8.5%20Z'%20/%3e%3cpath%20id='f'%20d='M%200,17%20H%204.3333%20V%200%20H%200%20Z%20M%208.6667,0%20V%2017%20H%2013%20V%200%20Z'%20/%3e%3cpath%20id='e'%20d='m%200,11%20h%203%20v%203%20H%205%20V%209%20H%200%20Z%20M%203,3%20H%200%20V%205%20H%205%20V%200%20H%203%20Z%20m%206,11%20h%202%20v%20-3%20h%203%20V%209%20H%209%20Z%20M%2011,3%20V%200%20H%209%20v%205%20h%205%20V%203%20Z'%20/%3e%3cpath%20id='d'%20d='M%200,12%208.5,6%200,0%20Z%20M%2010,0%20v%2012%20h%202%20V%200%20Z'%20/%3e%3cpath%20id='c'%20d='M%201.52,4.5%20C%201.52,2.961%202.632,1.71%204,1.71%20H%207.2%20V%200%20H%204%20C%201.792,0%200,2.016%200,4.5%200,6.984%201.792,9%204,9%20H%207.2%20V%207.29%20H%204%20C%202.632,7.29%201.52,6.039%201.52,4.5%20Z%20M%204.8,5.4%20h%206.4%20V%203.6%20H%204.8%20Z%20M%2012,0%20H%208.8%20V%201.71%20H%2012%20c%201.368,0%202.48,1.251%202.48,2.79%200,1.539%20-1.112,2.79%20-2.48,2.79%20H%208.8%20V%209%20H%2012%20C%2014.208,9%2016,6.984%2016,4.5%2016,2.016%2014.208,0%2012,0%20Z'%20/%3e%3cpath%20id='b'%20d='M%202,9%20H%200%20v%205%20H%205%20V%2012%20H%202%20Z%20M%200,5%20H%202%20V%202%20H%205%20V%200%20H%200%20Z%20m%2012,7%20H%209%20v%202%20h%205%20V%209%20H%2012%20Z%20M%209,0%20v%202%20h%203%20v%203%20h%202%20V%200%20Z'%20/%3e%3cpath%20id='a'%20d='M%204.4546,8.7015%201.1137,5.2537%201e-4,6.403%204.4546,11%2014,1.1492%2012.8864,-1e-4%204.4546,8.7014%20Z'%20/%3e%3cpath%20id='n'%20d='M%2012.348,7.686%20C%2012.3768,7.462%2012.3984,7.238%2012.3984,7%2012.3984,6.762%2012.3768,6.538%2012.348,6.314%20L%2013.8664,5.159%20C%2014.0032,5.054%2014.0391,4.865%2013.9528,4.711%20L%2012.5135,2.289%20C%2012.4272,2.135%2012.2329,2.079%2012.0745,2.135%20l%20-1.7919,0.7%20C%209.90842,2.555%209.50543,2.324%209.0664,2.149%20L%208.79294,0.294%20C%208.77135,0.126%208.62022,0%208.44031,0%20H%205.56171%20C%205.38181,0%205.23068,0.126%205.20909,0.294%20L%204.93563,2.149%20C%204.49665,2.324%204.09365,2.562%203.71943,2.835%20l%20-1.7919,-0.7%20C%201.76201,2.072%201.5749,2.135%201.48855,2.289%20l%20-1.4393,2.422%20c%20-0.093553,0.154%20-0.050374,0.343%200.086356,0.448%20l%201.5184,1.155%20C%201.625226,6.538%201.603636,6.769%201.603636,7%20c%200,0.231%200.02159,0.462%200.05037,0.686%20l%20-1.5184,1.155%20c%20-0.13673,0.105%20-0.17271,0.294%20-0.086356,0.448%20l%201.4393,2.422%20c%200.08635,0.154%200.28066,0.21%200.43898,0.154%20l%201.7919,-0.7%20c%200.37421,0.28%200.77721,0.511%201.2162,0.686%20l%200.27346,1.855%20C%205.23068,13.874%205.38181,14%205.56171,14%20h%202.8786%20c%200.17991,0%200.33104,-0.126%200.35263,-0.294%20L%209.0664,11.851%20c%200.43898,-0.175%200.84197,-0.413%201.2162,-0.686%20l%201.7919,0.7%20c%200.1655,0.063%200.3527,0%200.439,-0.154%20L%2013.9528,9.289%20C%2014.0391,9.135%2014.0032,8.946%2013.8664,8.841%20Z%20M%207.0011,9.45%20C%205.6122,9.45%204.4824,8.351%204.4824,7%204.4824,5.649%205.6122,4.55%207.0011,4.55%208.39,4.55%209.5198,5.649%209.5198,7%209.5198,8.351%208.39,9.45%207.0011,9.45%20Z'%20/%3e%3cpath%20id='m'%20d='M%200,0%20H%2016%20V%2012%20H%200%20Z'%20/%3e%3cpath%20id='l'%20d='m%200,0%20v%20-2%20h%20-2%20v%202%20z%20m%2016,0%20h%202%20v%20-2%20h%20-2%20z%20m%200,12%20v%202%20h%202%20V%2012%20Z%20M%200,12%20h%20-2%20v%202%20H%200%20Z%20M%200,2%20H%2016%20V%20-2%20H%200%20Z%20M%2014,0%20v%2012%20h%204%20V%200%20Z%20m%202,10%20H%200%20v%204%20H%2016%20Z%20M%202,12%20V%200%20h%20-4%20v%2012%20z'%20/%3e%3cpath%20id='k'%20d='M%2012,5.2941%20H%208.5714%20V%200%20H%203.4285%20V%205.2941%20H%20-1e-4%20l%206,6.1765%206,-6.1765%20z%20M%200,13.2353%20V%2015%20h%2012%20v%20-1.7647%20z'%20/%3e%3cpath%20id='j'%20d='M%209.3333,0%20H%204.6666%20V%201.5238%20H%209.3333%20Z%20M%206.2222,9.9048%20H%207.7778%20V%205.3334%20H%206.2222%20Z%20M%2012.4678,4.8686%2013.5722,3.7867%20C%2013.2378,3.39813%2012.8722,3.03241%2012.4756,2.7124%20L%2011.3711,3.7943%20C%2010.1656,2.84953%208.6489,2.2857%207,2.2857%203.1344,2.2857%200,5.3562%200,9.1429%200,12.9295%203.1267,16%207,16%2010.8733,16%2014,12.9295%2014,9.1429%2014,7.5277%2013.4244,6.0419%2012.4678,4.8686%20Z%20M%207,14.4762%20C%203.99,14.4762%201.5556,12.0914%201.5556,9.1429%201.5556,6.1943%203.99,3.8096%207,3.8096%20c%203.01,0%205.4444,2.3848%205.4444,5.3333%200,2.9485%20-2.4344,5.3333%20-5.4444,5.3333%20z'%20/%3e%3c/defs%3e%3cg%20id='g3989'%20transform='matrix(0.03107656,0,0,0.03432918,271.52581,57.128037)'%20style='fill:%23ffffff'%3e%3cg%20id='g3979'%20style='fill:%23ffffff'%3e%3cpath%20style='fill:%23ffffff;stroke-width:0.03266241'%20d='m%20273.49023,60.4375%20c%20-1.07158,0%20-1.96484,0.958273%20-1.96484,2.169922%20v%206.61914%20c%200,1.216352%200.89727,2.167935%201.96484,2.167969%20h%202.87305%20c%200.52417,0%201.01765,-0.2246%201.39063,-0.634765%20l%201,-1.103516%20c%200.19059,-0.211639%200.45448,-0.333984%200.72656,-0.333984%200.27207,0%200.53829,0.122547%200.73047,0.335937%20l%200.99804,1.101563%20c%200.37212,0.409203%200.86646,0.634765%201.39063,0.634765%20h%202.87305%20c%201.07158,0%201.96484,-0.95632%201.96484,-2.167969%20v%20-6.61914%20c%200,-1.216352%20-0.89727,-2.169922%20-1.96484,-2.169922%20z%20m%202.4961,3.308594%20c%201.08295,0%201.96484,0.973618%201.96484,2.169922%200,1.196303%20-0.88185,2.169921%20-1.96484,2.169922%20-1.08299,0%20-1.96485,-0.973619%20-1.96485,-2.169922%200,-1.196304%200.88189,-2.169922%201.96485,-2.169922%20z%20m%206.99023,0%20c%201.08296,0%201.96485,0.973618%201.96485,2.169922%200,1.196303%20-0.88189,2.169922%20-1.96485,2.169922%20-1.08298,0%20-1.96484,-0.973619%20-1.96484,-2.169922%200,-1.196304%200.88189,-2.169922%201.96484,-2.169922%20z'%20transform='matrix(32.178594,0,0,29.129737,-8737.3187,-1664.1247)'%20id='path3977'%20/%3e%3c/g%3e%3cg%20id='g3983'%20style='fill:%23ffffff'/%3e%3cg%20id='g3987'%20style='fill:%23ffffff'/%3e%3c/g%3e%3cpath%20style='fill:%23ffffff;fill-opacity:1'%20d='M%20317.03125%2021.992188%20A%206.9826789%206.9826789%200%200%200%20310.04883%2028.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2035.958984%20A%206.9826789%206.9826789%200%200%200%20324.01367%2028.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2021.992188%20z%20M%20312.20703%2027.580078%20L%20321.94336%2027.642578%20C%20322.32865%2027.645013%20322.63647%2027.956519%20322.63281%2028.341797%20L%20322.62109%2029.603516%20C%20322.61743%2029.988794%20322.30326%2030.297356%20321.91797%2030.294922%20L%20312.18164%2030.232422%20C%20311.79635%2030.229987%20311.48853%2029.918481%20311.49219%2029.533203%20L%20311.50391%2028.271484%20C%20311.50757%2027.886206%20311.82174%2027.577644%20312.20703%2027.580078%20z%20'%20id='path3997'/%3e%3cpath%20style='fill:%23ffffff;fill-opacity:1'%20d='M%20317.03125%2059.992188%20A%206.9826789%206.9826789%200%200%200%20310.04883%2066.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2073.958984%20A%206.9826789%206.9826789%200%200%200%20324.01367%2066.976562%20A%206.9826789%206.9826789%200%200%200%20317.03125%2059.992188%20z%20M%20316.49805%2061.365234%20L%20317.76172%2061.382812%20C%20318.14697%2061.388692%20318.45192%2061.704576%20318.44727%2062.089844%20L%20318.4043%2065.619141%20L%20321.94336%2065.642578%20C%20322.32865%2065.645013%20322.63647%2065.956519%20322.63281%2066.341797%20L%20322.62109%2067.603516%20C%20322.61743%2067.988794%20322.30326%2068.297356%20321.91797%2068.294922%20L%20318.37305%2068.271484%20L%20318.33008%2071.826172%20C%20318.32543%2072.21144%20318.0122%2072.515645%20317.62695%2072.509766%20L%20316.36328%2072.492188%20C%20315.97803%2072.486309%20315.67308%2072.170424%20315.67773%2071.785156%20L%20315.7207%2068.255859%20L%20312.18164%2068.232422%20C%20311.79635%2068.229987%20311.48853%2067.918481%20311.49219%2067.533203%20L%20311.50391%2066.271484%20C%20311.50757%2065.886206%20311.82174%2065.577644%20312.20703%2065.580078%20L%20315.75195%2065.603516%20L%20315.79492%2062.048828%20C%20315.79957%2061.66356%20316.1128%2061.359355%20316.49805%2061.365234%20z%20'%20id='path3997-6'/%3e%3cellipse%20style='fill:%23800000;fill-opacity:1;stroke-width:1.10310566'%20id='circle4073'%20cx='353.64172'%20cy='-28.97954'%20transform='scale(1,-1)'%20/%3e%3cg%20id='g7787'%20transform='matrix(-0.02885349,0,0,-0.02885337,352.04486,75.172258)'%20style='fill:%23ffffff;fill-opacity:1'%3e%3cg%20id='g7731'%20transform='translate(-90.566882,42.049084)'%20style='fill:%23ffffff;fill-opacity:1'%3e%3cpath%20id='path7729'%20d='M%20242.607,0%20C%20108.629,0%200.001,108.628%200.001,242.606%20c%200,133.976%20108.628,242.606%20242.606,242.606%20133.978,0%20242.604,-108.631%20242.604,-242.606%20C%20485.212,108.628%20376.585,0%20242.607,0%20Z%20M%20401.815,288.094%20H%20219.862%20v%2090.979%20L%2083.397,242.606%20219.862,106.141%20v%2090.978%20h%20181.953%20z'%20style='fill:%23ffffff;fill-opacity:1'/%3e%3c/g%3e%3cg%20id='g7733'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7735'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7737'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7739'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7741'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7743'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7745'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7747'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7749'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7751'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7753'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7755'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7757'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7759'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3cg%20id='g7761'%20style='fill:%23ffffff;fill-opacity:1'%3e%3c/g%3e%3c/g%3e%3c/svg%3e\") no-repeat;float:left;cursor:pointer;height:18px;width:18px;background-position:-164px -21px;opacity:0}.source_selected,.subtitle_selected,.subtitle_size_selected{opacity:1!important}@media only screen and (min-device-width: 375px){.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_control_duration{padding-left:95px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_control_duration.no_volume_bar{padding-left:32px}.fluid_video_wrapper.fluid_player_layout_default .fluid_controls_container .fluid_controls_right .fluid_control_volume_container{display:block}}.fp_logo{visibility:hidden;opacity:0;transition:visibility .3s ease-in-out,opacity .3s ease-in-out}.fp_hd_source:before{font-weight:bolder;font-size:6pt;content:\"HD\";padding-left:3px}.fluid_video_wrapper.fluid_player_layout_default .mini-player-close-button-wrapper{display:none}.fluid_video_wrapper.fluid_mini_player_mode .mini-player-close-button-wrapper{position:absolute;background:#000;background:linear-gradient(45deg,#0000 90%,#0009 110%);height:100%;width:100%;top:0;right:0;z-index:31;display:block;opacity:0;transition:opacity .3s ease-in-out;pointer-events:none}.fluid_video_wrapper.fluid_mini_player_mode .mini-player-close-button{position:absolute;background:transparent url(\"data:image/svg+xml,%3csvg%20fill='%23FFF'%20height='24'%20width='24'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M19%206.41L17.59%205%2012%2010.59%206.41%205%205%206.41%2010.59%2012%205%2017.59%206.41%2019%2012%2013.41%2017.59%2019%2019%2017.59%2013.41%2012z'/%3e%3cpath%20d='M0%200h24v24H0z'%20fill='none'/%3e%3c/svg%3e\") no-repeat scroll center center;height:22px;width:22px;top:6px;right:6px;background-size:22px;cursor:pointer;z-index:32;display:block;pointer-events:all}.fluid_video_wrapper.fluid_mini_player_mode:hover .mini-player-close-button-wrapper{opacity:1}.fluid_video_wrapper.fluid_mini_player_mode .disable-mini-player-mobile{position:absolute;top:0;left:0;width:100%;height:100%}.fluidplayer-miniplayer-player-placeholder{display:flex;align-items:center;justify-content:center;color:#fff;font-size:1.5rem;font-family:-apple-system,BlinkMacSystemFont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,arial,sans-serif,\"apple color emoji\",\"segoe ui emoji\",segoe ui symbol;background:#000 url(\"data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M2.00005%2011V9H5.60005L1.30005%204.7L2.70005%203.3L7.00005%207.6V4H9.00005V11H2.00005ZM4.00005%2020C3.45005%2020%202.97922%2019.8042%202.58755%2019.4125C2.19588%2019.0208%202.00005%2018.55%202.00005%2018V13H4.00005V18H12V20H4.00005ZM20%2013V6H11V4H20C20.55%204%2021.0209%204.19583%2021.4125%204.5875C21.8042%204.97917%2022%205.45%2022%206V13H20ZM14%2020V15H22V20H14Z'%20fill='white'/%3e%3c/svg%3e\") no-repeat 50% calc(50% - 48px);background-size:48px;cursor:pointer}.fluid_video_wrapper.fluid_mini_player_mode.fluid_video_wrapper.fluid_mini_player_mode--top-left{top:10px;left:10px}.fluid_video_wrapper.fluid_mini_player_mode.fluid_video_wrapper.fluid_mini_player_mode--top-right{top:10px;right:10px}.fluid_video_wrapper.fluid_mini_player_mode.fluid_video_wrapper.fluid_mini_player_mode--bottom-left{bottom:10px;left:10px}.fluid_video_wrapper.fluid_mini_player_mode.fluid_video_wrapper.fluid_mini_player_mode--bottom-right{bottom:10px;right:10px}@media screen and (max-width: 768px){.fluid_video_wrapper.fluid_mini_player_mode>*:not(video,.ad_countdown,.fluid_nonLinear_ad,.disable-mini-player-mobile){display:none}.fluid_video_wrapper.fluid_mini_player_mode .fluid_nonLinear_ad{z-index:100}.fluid_video_wrapper.fluid_mini_player_mode .fluid_nonLinear_bottom{bottom:16px}.fluid_video_wrapper.fluid_mini_player_mode .fluid_nonLinear_top{top:16px}.fluid_video_wrapper.fluid_mini_player_mode .ad_countdown{display:inline-block!important}.fluid_video_wrapper.fluid_mini_player_mode .disable-mini-player-mobile{display:block;touch-action:none}.fluidplayer-miniplayer-player-placeholder{font-size:1.25rem!important;background-size:32px!important;background-position-y:calc(50% - 32px)!important}}.fluid_video_wrapper .fluid_player_skip_offset{width:100%;height:100%;position:absolute;top:0;left:0;display:grid;grid-template-columns:1fr 1fr;pointer-events:none}.fluid_video_wrapper .fluid_player_skip_offset__backward{display:flex;align-items:center;margin:10% 10% 10% 0}.fluid_video_wrapper .fluid_player_skip_offset__backward-icon{background:#00000080 url(\"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='white'%20width='24px'%20height='24px'%3e%3cpath%20d='M0%200h24v24H0V0z'%20fill='none'/%3e%3cpath%20d='M11.99%205V1l-5%205%205%205V7c3.31%200%206%202.69%206%206s-2.69%206-6%206-6-2.69-6-6h-2c0%204.42%203.58%208%208%208s8-3.58%208-8-3.58-8-8-8zm-1.1%2011h-.85v-3.26l-1.01.31v-.69l1.77-.63h.09V16zm4.28-1.76c0%20.32-.03.6-.1.82s-.17.42-.29.57-.28.26-.45.33-.37.1-.59.1-.41-.03-.59-.1-.33-.18-.46-.33-.23-.34-.3-.57-.11-.5-.11-.82v-.74c0-.32.03-.6.1-.82s.17-.42.29-.57.28-.26.45-.33.37-.1.59-.1.41.03.59.1.33.18.46.33.23.34.3.57.11.5.11.82v.74zm-.85-.86c0-.19-.01-.35-.04-.48s-.07-.23-.12-.31-.11-.14-.19-.17-.16-.05-.25-.05-.18.02-.25.05-.14.09-.19.17-.09.18-.12.31-.04.29-.04.48v.97c0%20.19.01.35.04.48s.07.24.12.32.11.14.19.17.16.05.25.05.18-.02.25-.05.14-.09.19-.17.09-.19.11-.32.04-.29.04-.48v-.97z'/%3e%3c/svg%3e\") no-repeat -2px 3px;width:150px;height:150px;background-size:contain;opacity:0;transition:opacity .4s ease-in;border-radius:150px;margin-left:20%;pointer-events:none;background-origin:content-box;padding:10px}.fluid_video_wrapper .fluid_player_skip_offset__forward{display:flex;align-items:center;flex-direction:row-reverse;margin:10% 0 10% 10%}.fluid_video_wrapper .fluid_player_skip_offset__forward-icon{background:#00000080 url(\"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20enable-background='new%200%200%2024%2024'%20viewBox='0%200%2024%2024'%20fill='white'%20width='24px'%20height='24px'%3e%3cg%3e%3crect%20fill='none'%20height='24'%20width='24'/%3e%3crect%20fill='none'%20height='24'%20width='24'/%3e%3crect%20fill='none'%20height='24'%20width='24'/%3e%3c/g%3e%3cg%3e%3cg/%3e%3cg%3e%3cpath%20d='M18,13c0,3.31-2.69,6-6,6s-6-2.69-6-6s2.69-6,6-6v4l5-5l-5-5v4c-4.42,0-8,3.58-8,8c0,4.42,3.58,8,8,8s8-3.58,8-8H18z'/%3e%3cpolygon%20points='10.9,16%2010.9,11.73%2010.81,11.73%209.04,12.36%209.04,13.05%2010.05,12.74%2010.05,16'/%3e%3cpath%20d='M14.32,11.78c-0.18-0.07-0.37-0.1-0.59-0.1s-0.41,0.03-0.59,0.1s-0.33,0.18-0.45,0.33s-0.23,0.34-0.29,0.57%20s-0.1,0.5-0.1,0.82v0.74c0,0.32,0.04,0.6,0.11,0.82s0.17,0.42,0.3,0.57s0.28,0.26,0.46,0.33s0.37,0.1,0.59,0.1s0.41-0.03,0.59-0.1%20s0.33-0.18,0.45-0.33s0.22-0.34,0.29-0.57s0.1-0.5,0.1-0.82V13.5c0-0.32-0.04-0.6-0.11-0.82s-0.17-0.42-0.3-0.57%20S14.49,11.85,14.32,11.78z%20M14.33,14.35c0,0.19-0.01,0.35-0.04,0.48s-0.06,0.24-0.11,0.32s-0.11,0.14-0.19,0.17%20s-0.16,0.05-0.25,0.05s-0.18-0.02-0.25-0.05s-0.14-0.09-0.19-0.17s-0.09-0.19-0.12-0.32s-0.04-0.29-0.04-0.48v-0.97%20c0-0.19,0.01-0.35,0.04-0.48s0.06-0.23,0.12-0.31s0.11-0.14,0.19-0.17s0.16-0.05,0.25-0.05s0.18,0.02,0.25,0.05%20s0.14,0.09,0.19,0.17s0.09,0.18,0.12,0.31s0.04,0.29,0.04,0.48V14.35z'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e\") no-repeat -2px 3px;width:150px;height:150px;background-size:cover;opacity:0;transition:opacity .4s ease-in;border-radius:150px;margin-right:20%;pointer-events:none;background-origin:content-box;padding:10px}.fluid_video_wrapper .fluid_player_skip_offset__backward-icon.animate,.fluid_video_wrapper .fluid_player_skip_offset__forward-icon.animate{opacity:1;transition:opacity .15s ease-out}@media screen and (max-width: 768px){.fluid_video_wrapper .fluid_player_skip_offset__backward-icon,.fluid_video_wrapper .fluid_player_skip_offset__forward-icon{width:50px;height:50px;border-radius:50px;background-position-x:0;background-position-y:0;padding:5px}}.fluid_player_layout_in-renderer-js .ad_countdown{display:none}.fluid_player_layout_in-renderer-js video{position:relative}.fluid_player_layout_in-renderer-js .fluid_player_skip_offset{pointer-events:auto!important}.fluid_player_layout_in-renderer-js .fluid_context_menu{display:none!important}.fluid_player_layout_in-renderer-js .fluid_button.fluid_button_volume,.fluid_player_layout_in-renderer-js .fluid_button.fluid_button_mute,.fluid_player_layout_in-renderer-js .fluid_ad_playing,.fluid_player_layout_in-renderer-js .ad_end_card,.fluid_player_layout_in-renderer-js .ad_replay,.fluid_player_layout_in-renderer-js .ad_replay_icon{display:none}.fluid_player_layout_in-renderer-js .vast_clickthrough_layer{z-index:11}@media (max-width: 500px){.fluid_player_layout_in-renderer-js .vast_clickthrough_layer{height:50px!important}}@media (max-width: 500px){:is(.full-click-area .fluid_player_layout_in-renderer-js) .vast_clickthrough_layer{height:100%!important}}\n/*$vite$:1*/",document.head.appendChild(n);class r extends Error{constructor(){super(...arguments),t(this,"name","InvalidTargetElementException"),t(this,"message","Invalid target element.")}}class o{constructor(e){t(this,"logger"),this.logger=e}invalidBid(){this.logger.warn("Invalid bid.")}unsupportedNativeAsset(){this.logger.warn("This native asset is not supported.")}missingAdTemplate(){this.logger.warn("Ad template is missing.")}invalidNativeVideoContainer(){this.logger.warn("Native video container is invalid.")}invalidTargetElement(){this.logger.warn("Invalid target element.")}}let l=class{warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.warn("[InRenderer.js]",t)}};class c extends Error{constructor(){super(...arguments),t(this,"name","InvalidBidException"),t(this,"message","Invalid bid object.")}}const u=e=>"string"==typeof e,d=()=>{let e,t;const n=new Promise((n,i)=>{e=n,t=i});return n.resolve=e,n.reject=t,n},h=e=>null==e?"":""+e,f=/###/g,p=e=>e&&e.indexOf("###")>-1?e.replace(f,"."):e,g=e=>!e||u(e),m=(e,t,n)=>{const i=u(t)?t.split("."):t;let r=0;for(;r<i.length-1;){if(g(e))return{};const t=p(i[r]);!e[t]&&n&&(e[t]=new n),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++r}return g(e)?{}:{obj:e,k:p(i[r])}},v=(e,t,n)=>{const{obj:i,k:r}=m(e,t,Object);if(void 0!==i||1===t.length)return void(i[r]=n);let a=t[t.length-1],o=t.slice(0,t.length-1),s=m(e,o,Object);for(;void 0===s.obj&&o.length;)a="".concat(o[o.length-1],".").concat(a),o=o.slice(0,o.length-1),s=m(e,o,Object),null!=s&&s.obj&&typeof s.obj["".concat(s.k,".").concat(a)]<"u"&&(s.obj=void 0);s.obj["".concat(s.k,".").concat(a)]=n},y=(e,t)=>{const{obj:n,k:i}=m(e,t);if(n&&Object.prototype.hasOwnProperty.call(n,i))return n[i]},_=(e,t,n)=>{for(const i in t)"__proto__"!==i&&"constructor"!==i&&(i in e?u(e[i])||e[i]instanceof String||u(t[i])||t[i]instanceof String?n&&(e[i]=t[i]):_(e[i],t[i],n):e[i]=t[i]);return e},E=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const T=e=>u(e)?e.replace(/[&<>"'\/]/g,e=>b[e]):e;const S=[" ",",","?","!",";"],w=new class{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(void 0!==t)return t;const n=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,n),this.regExpQueue.push(e),n}}(20),A=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(!e)return;if(e[t])return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0;const i=t.split(n);let r=e;for(let e=0;e<i.length;){if(!r||"object"!=typeof r)return;let t,a="";for(let o=e;o<i.length;++o)if(o!==e&&(a+=n),a+=i[o],t=r[a],void 0!==t){if(["string","number","boolean"].indexOf(typeof t)>-1&&o<i.length-1)continue;e+=o-e+1;break}r=t}return r},R=e=>null==e?void 0:e.replace("_","-"),x={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){var n,i;null==(i=null==(n=null==console?void 0:console[e])?void 0:n.apply)||i.call(n,console,t)}};var I=new class e{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||x,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,n,i){return i&&!this.debug?null:(u(e[0])&&(e[0]="".concat(n).concat(this.prefix," ").concat(e[0])),this.logger[t](e))}create(t){return new e(this.logger,_objectSpread({prefix:"".concat(this.prefix,":").concat(t,":")},this.options))}clone(t){return(t=t||this.options).prefix=t.prefix||this.prefix,new e(this.logger,t)}};let L=class{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(e=>{this.observers[e]||(this.observers[e]=new Map);const n=this.observers[e].get(t)||0;this.observers[e].set(t,n+1)}),this}off(e,t){if(this.observers[e]){if(!t)return void delete this.observers[e];this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(e=>{let[t,i]=e;for(let e=0;e<i;e++)t(...n)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(t=>{let[i,r]=t;for(let t=0;t<r;t++)i.apply(i,[e,...n])})}};class M extends L{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,n){var i,r;let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const o=void 0!==a.keySeparator?a.keySeparator:this.options.keySeparator,s=void 0!==a.ignoreJSONStructure?a.ignoreJSONStructure:this.options.ignoreJSONStructure;let l;e.indexOf(".")>-1?l=e.split("."):(l=[e,t],n&&(Array.isArray(n)?l.push(...n):u(n)&&o?l.push(...n.split(o)):l.push(n)));const c=y(this.data,l);return!c&&!t&&!n&&e.indexOf(".")>-1&&(e=l[0],t=l[1],n=l.slice(2).join(".")),!c&&s&&u(n)?A(null==(r=null==(i=this.data)?void 0:i[e])?void 0:r[t],n,o):c}addResource(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1};const a=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator;let o=[e,t];n&&(o=o.concat(a?n.split(a):n)),e.indexOf(".")>-1&&(o=e.split("."),i=t,t=o[1]),this.addNamespaces(t),v(this.data,o,i),r.silent||this.emit("added",e,t,n,i)}addResources(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(const i in n)(u(n[i])||Array.isArray(n[i]))&&this.addResource(e,t,i,n[i],{silent:!0});i.silent||this.emit("added",e,t,n)}addResourceBundle(e,t,n,i,r){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1,skipCopy:!1},o=[e,t];e.indexOf(".")>-1&&(o=e.split("."),i=n,n=t,t=o[1]),this.addNamespaces(t);let s=y(this.data,o)||{};a.skipCopy||(n=JSON.parse(JSON.stringify(n))),i?_(s,n,r):s=_objectSpread(_objectSpread({},s),n),v(this.data,o,s),a.silent||this.emit("added",e,t,n)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(e=>t[e]&&Object.keys(t[e]).length>0)}toJSON(){return this.data}}var C={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,n,i,r){return e.forEach(e=>{var a,o;t=null!==(a=null==(o=this.processors[e])?void 0:o.process(t,n,i,r))&&void 0!==a?a:t}),t}};const P={},D=e=>!u(e)&&"boolean"!=typeof e&&"number"!=typeof e;class O extends L{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),((e,t,n)=>{e.forEach(e=>{t[e]&&(n[e]=t[e])})})(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=I.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;const n=this.resolve(e,t);return void 0!==(null==n?void 0:n.res)}extractFromKey(e,t){let n=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===n&&(n=":");const i=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator;let r=t.ns||this.options.defaultNS||[];const a=n&&e.indexOf(n)>-1,o=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||((e,t,n)=>{t=t||"",n=n||"";const i=S.filter(e=>t.indexOf(e)<0&&n.indexOf(e)<0);if(0===i.length)return!0;const r=w.getRegExp("(".concat(i.map(e=>"?"===e?"\\?":e).join("|"),")"));let a=!r.test(e);if(!a){const t=e.indexOf(n);t>0&&!r.test(e.substring(0,t))&&(a=!0)}return a})(e,n,i));if(a&&!o){const t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:u(r)?[r]:r};const a=e.split(n);(n!==i||n===i&&this.options.ns.indexOf(a[0])>-1)&&(r=a.shift()),e=a.join(i)}return{key:e,namespaces:u(r)?[r]:r}}translate(e,t,n){if("object"!=typeof t&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof t&&(t=_objectSpread({},t)),t||(t={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);const i=void 0!==t.returnDetails?t.returnDetails:this.options.returnDetails,r=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,{key:a,namespaces:o}=this.extractFromKey(e[e.length-1],t),s=o[o.length-1],l=t.lng||this.language,c=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if("cimode"===(null==l?void 0:l.toLowerCase())){if(c){const e=t.nsSeparator||this.options.nsSeparator;return i?{res:"".concat(s).concat(e).concat(a),usedKey:a,exactUsedKey:a,usedLng:l,usedNS:s,usedParams:this.getUsedParamsDetails(t)}:"".concat(s).concat(e).concat(a)}return i?{res:a,usedKey:a,exactUsedKey:a,usedLng:l,usedNS:s,usedParams:this.getUsedParamsDetails(t)}:a}const d=this.resolve(e,t);let h=null==d?void 0:d.res;const f=(null==d?void 0:d.usedKey)||a,p=(null==d?void 0:d.exactUsedKey)||a,g=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,m=!this.i18nFormat||this.i18nFormat.handleAsObject,v=void 0!==t.count&&!u(t.count),y=O.hasDefaultValue(t),_=v?this.pluralResolver.getSuffix(l,t.count,t):"",E=t.ordinal&&v?this.pluralResolver.getSuffix(l,t.count,{ordinal:!1}):"",b=v&&!t.ordinal&&0===t.count,T=b&&t["defaultValue".concat(this.options.pluralSeparator,"zero")]||t["defaultValue".concat(_)]||t["defaultValue".concat(E)]||t.defaultValue;let S=h;m&&!h&&y&&(S=T);const w=D(S),A=Object.prototype.toString.apply(S);if(!(m&&S&&w&&["[object Number]","[object Function]","[object RegExp]"].indexOf(A)<0)||u(g)&&Array.isArray(S))if(m&&u(g)&&Array.isArray(h))h=h.join(g),h&&(h=this.extendTranslation(h,e,t,n));else{let i=!1,o=!1;!this.isValidLookup(h)&&y&&(i=!0,h=T),this.isValidLookup(h)||(o=!0,h=a);const c=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&o?void 0:h,u=y&&T!==h&&this.options.updateMissing;if(o||i||u){if(this.logger.log(u?"updateKey":"missingKey",l,s,a,u?T:h),r){const e=this.resolve(a,_objectSpread(_objectSpread({},t),{},{keySeparator:!1}));e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[];const n=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&n&&n[0])for(let t=0;t<n.length;t++)e.push(n[t]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(t.lng||this.language):e.push(t.lng||this.language);const i=(e,n,i)=>{var r;const a=y&&i!==h?i:c;this.options.missingKeyHandler?this.options.missingKeyHandler(e,s,n,a,u,t):null!=(r=this.backendConnector)&&r.saveMissing&&this.backendConnector.saveMissing(e,s,n,a,u,t),this.emit("missingKey",e,s,n,h)};this.options.saveMissing&&(this.options.saveMissingPlurals&&v?e.forEach(e=>{const n=this.pluralResolver.getSuffixes(e,t);b&&t["defaultValue".concat(this.options.pluralSeparator,"zero")]&&n.indexOf("".concat(this.options.pluralSeparator,"zero"))<0&&n.push("".concat(this.options.pluralSeparator,"zero")),n.forEach(n=>{i([e],a+n,t["defaultValue".concat(n)]||T)})}):i(e,a,T))}h=this.extendTranslation(h,e,t,d,n),o&&h===a&&this.options.appendNamespaceToMissingKey&&(h="".concat(s,":").concat(a)),(o||i)&&this.options.parseMissingKeyHandler&&(h=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?"".concat(s,":").concat(a):a,i?h:void 0))}else{if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(f,S,_objectSpread(_objectSpread({},t),{},{ns:o})):"key '".concat(a," (").concat(this.language,")' returned an object instead of string.");return i?(d.res=e,d.usedParams=this.getUsedParamsDetails(t),d):e}if(r){const e=Array.isArray(S),n=e?[]:{},i=e?p:f;for(const e in S)if(Object.prototype.hasOwnProperty.call(S,e)){const a="".concat(i).concat(r).concat(e);n[e]=y&&!h?this.translate(a,_objectSpread(_objectSpread({},t),{},{defaultValue:D(T)?T[e]:void 0,joinArrays:!1,ns:o})):this.translate(a,_objectSpread(_objectSpread({},t),{},{joinArrays:!1,ns:o})),n[e]===a&&(n[e]=S[e])}h=n}}return i?(d.res=h,d.usedParams=this.getUsedParamsDetails(t),d):h}extendTranslation(e,t,n,i,r){var a,o,s=this;if(null!=(a=this.i18nFormat)&&a.parse)e=this.i18nFormat.parse(e,_objectSpread(_objectSpread({},this.options.interpolation.defaultVariables),n),n.lng||this.language||i.usedLng,i.usedNS,i.usedKey,{resolved:i});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init(_objectSpread(_objectSpread({},n),{},{interpolation:_objectSpread(_objectSpread({},this.options.interpolation),n.interpolation)}));const a=u(e)&&(void 0!==(null==(o=null==n?void 0:n.interpolation)?void 0:o.skipOnVariables)?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let l;if(a){const t=e.match(this.interpolator.nestingRegexp);l=t&&t.length}let c=n.replace&&!u(n.replace)?n.replace:n;if(this.options.interpolation.defaultVariables&&(c=_objectSpread(_objectSpread({},this.options.interpolation.defaultVariables),c)),e=this.interpolator.interpolate(e,c,n.lng||this.language||i.usedLng,n),a){const t=e.match(this.interpolator.nestingRegexp);l<(t&&t.length)&&(n.nest=!1)}!n.lng&&i&&i.res&&(n.lng=this.language||i.usedLng),!1!==n.nest&&(e=this.interpolator.nest(e,function(){for(var e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];return(null==r?void 0:r[0])!==i[0]||n.context?s.translate(...i,t):(s.logger.warn("It seems you are nesting recursively key: ".concat(i[0]," in key: ").concat(t[0])),null)},n)),n.interpolation&&this.interpolator.reset()}const l=n.postProcess||this.options.postProcess,c=u(l)?[l]:l;return null!=e&&null!=c&&c.length&&!1!==n.applyPostProcessor&&(e=C.handle(c,e,t,this.options&&this.options.postProcessPassResolved?_objectSpread({i18nResolved:_objectSpread(_objectSpread({},i),{},{usedParams:this.getUsedParamsDetails(n)})},n):n,this)),e}resolve(e){let t,n,i,r,a,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return u(e)&&(e=[e]),e.forEach(e=>{if(this.isValidLookup(t))return;const s=this.extractFromKey(e,o),l=s.key;n=l;let c=s.namespaces;this.options.fallbackNS&&(c=c.concat(this.options.fallbackNS));const d=void 0!==o.count&&!u(o.count),h=d&&!o.ordinal&&0===o.count,f=void 0!==o.context&&(u(o.context)||"number"==typeof o.context)&&""!==o.context,p=o.lngs?o.lngs:this.languageUtils.toResolveHierarchy(o.lng||this.language,o.fallbackLng);c.forEach(e=>{var s,c;this.isValidLookup(t)||(a=e,!P["".concat(p[0],"-").concat(e)]&&null!=(s=this.utils)&&s.hasLoadedNamespace&&!(null!=(c=this.utils)&&c.hasLoadedNamespace(a))&&(P["".concat(p[0],"-").concat(e)]=!0,this.logger.warn('key "'.concat(n,'" for languages "').concat(p.join(", "),'" won\'t get resolved as namespace "').concat(a,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),p.forEach(n=>{var a;if(this.isValidLookup(t))return;r=n;const s=[l];if(null!=(a=this.i18nFormat)&&a.addLookupKeys)this.i18nFormat.addLookupKeys(s,l,n,e,o);else{let e;d&&(e=this.pluralResolver.getSuffix(n,o.count,o));const t="".concat(this.options.pluralSeparator,"zero"),i="".concat(this.options.pluralSeparator,"ordinal").concat(this.options.pluralSeparator);if(d&&(s.push(l+e),o.ordinal&&0===e.indexOf(i)&&s.push(l+e.replace(i,this.options.pluralSeparator)),h&&s.push(l+t)),f){const n="".concat(l).concat(this.options.contextSeparator).concat(o.context);s.push(n),d&&(s.push(n+e),o.ordinal&&0===e.indexOf(i)&&s.push(n+e.replace(i,this.options.pluralSeparator)),h&&s.push(n+t))}}let c;for(;c=s.pop();)this.isValidLookup(t)||(i=c,t=this.getResource(n,e,c,o))}))})}),{res:t,usedKey:n,exactUsedKey:i,usedLng:r,usedNS:a}}isValidLookup(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}getResource(e,t,n){var i;let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return null!=(i=this.i18nFormat)&&i.getResource?this.i18nFormat.getResource(e,t,n,r):this.resourceStore.getResource(e,t,n,r)}getUsedParamsDetails(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],n=e.replace&&!u(e.replace);let i=n?e.replace:e;if(n&&typeof e.count<"u"&&(i.count=e.count),this.options.interpolation.defaultVariables&&(i=_objectSpread(_objectSpread({},this.options.interpolation.defaultVariables),i)),!n){i=_objectSpread({},i);for(const e of t)delete i[e]}return i}static hasDefaultValue(e){const t="defaultValue";for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t===n.substring(0,12)&&void 0!==e[n])return!0;return!1}}class N{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=I.create("languageUtils")}getScriptPartFromCode(e){if(!(e=R(e))||e.indexOf("-")<0)return null;const t=e.split("-");return 2===t.length||(t.pop(),"x"===t[t.length-1].toLowerCase())?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(!(e=R(e))||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(u(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch(e){}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(e=>{if(t)return;const n=this.formatLanguageCode(e);(!this.options.supportedLngs||this.isSupportedCode(n))&&(t=n)}),!t&&this.options.supportedLngs&&e.forEach(e=>{if(t)return;const n=this.getLanguagePartFromCode(e);if(this.isSupportedCode(n))return t=n;t=this.options.supportedLngs.find(e=>e===n?e:e.indexOf("-")<0&&n.indexOf("-")<0||!(e.indexOf("-")>0&&n.indexOf("-")<0&&e.substring(0,e.indexOf("-"))===n||0===e.indexOf(n)&&n.length>1)?void 0:e)}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),u(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let n=e[t];return n||(n=e[this.getScriptPartFromCode(t)]),n||(n=e[this.formatLanguageCode(t)]),n||(n=e[this.getLanguagePartFromCode(t)]),n||(n=e.default),n||[]}toResolveHierarchy(e,t){const n=this.getFallbackCodes(t||this.options.fallbackLng||[],e),i=[],r=e=>{e&&(this.isSupportedCode(e)?i.push(e):this.logger.warn("rejecting language code not found in supportedLngs: ".concat(e)))};return u(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&r(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&r(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&r(this.getLanguagePartFromCode(e))):u(e)&&r(this.formatLanguageCode(e)),n.forEach(e=>{i.indexOf(e)<0&&r(this.formatLanguageCode(e))}),i}}const k={zero:0,one:1,two:2,few:3,many:4,other:5},F={select:e=>1===e?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class B{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=I.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=R("dev"===e?"en":e),i=t.ordinal?"ordinal":"cardinal",r=JSON.stringify({cleanedCode:n,type:i});if(r in this.pluralRulesCache)return this.pluralRulesCache[r];let a;try{a=new Intl.PluralRules(n,{type:i})}catch(n){if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),F;if(!e.match(/-|_/))return F;const i=this.languageUtils.getLanguagePartFromCode(e);a=this.getRule(i,t)}return this.pluralRulesCache[r]=a,a}needsPlural(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(e,t);return n||(n=this.getRule("dev",t)),(null==n?void 0:n.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,n).map(e=>"".concat(t).concat(e))}getSuffixes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(e,t);return n||(n=this.getRule("dev",t)),n?n.resolvedOptions().pluralCategories.sort((e,t)=>k[e]-k[t]).map(e=>"".concat(this.options.prepend).concat(t.ordinal?"ordinal".concat(this.options.prepend):"").concat(e)):[]}getSuffix(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=this.getRule(e,n);return i?"".concat(this.options.prepend).concat(n.ordinal?"ordinal".concat(this.options.prepend):"").concat(i.select(t)):(this.logger.warn("no plural rule found for: ".concat(e)),this.getSuffix("dev",t,n))}}const U=function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".",r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=((e,t,n)=>{const i=y(e,n);return void 0!==i?i:y(t,n)})(e,t,n);return!a&&r&&u(n)&&(a=A(e,n,i),void 0===a&&(a=A(t,n,i))),a},V=e=>e.replace(/\$/g,"$$$$");class G{constructor(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=I.create("interpolator"),this.options=t,this.format=(null==(e=null==t?void 0:t.interpolation)?void 0:e.format)||(e=>e),this.init(t)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:n,useRawValueToEscape:i,prefix:r,prefixEscaped:a,suffix:o,suffixEscaped:s,formatSeparator:l,unescapeSuffix:c,unescapePrefix:u,nestingPrefix:d,nestingPrefixEscaped:h,nestingSuffix:f,nestingSuffixEscaped:p,nestingOptionsSeparator:g,maxReplaces:m,alwaysFormat:v}=e.interpolation;this.escape=void 0!==t?t:T,this.escapeValue=void 0===n||n,this.useRawValueToEscape=void 0!==i&&i,this.prefix=r?E(r):a||"{{",this.suffix=o?E(o):s||"}}",this.formatSeparator=l||",",this.unescapePrefix=c?"":u||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=d?E(d):h||E("$t("),this.nestingSuffix=f?E(f):p||E(")"),this.nestingOptionsSeparator=g||",",this.maxReplaces=m||1e3,this.alwaysFormat=void 0!==v&&v,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(e,t)=>(null==e?void 0:e.source)===t?(e.lastIndex=0,e):new RegExp(t,"g");this.regexp=e(this.regexp,"".concat(this.prefix,"(.+?)").concat(this.suffix)),this.regexpUnescape=e(this.regexpUnescape,"".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix)),this.nestingRegexp=e(this.nestingRegexp,"".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix))}interpolate(e,t,n,i){var r;let a,o,s;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},c=e=>{if(e.indexOf(this.formatSeparator)<0){const r=U(t,l,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(r,void 0,n,_objectSpread(_objectSpread(_objectSpread({},i),t),{},{interpolationkey:e})):r}const r=e.split(this.formatSeparator),a=r.shift().trim(),o=r.join(this.formatSeparator).trim();return this.format(U(t,l,a,this.options.keySeparator,this.options.ignoreJSONStructure),o,n,_objectSpread(_objectSpread(_objectSpread({},i),t),{},{interpolationkey:a}))};this.resetRegExp();const d=(null==i?void 0:i.missingInterpolationHandler)||this.options.missingInterpolationHandler,f=void 0!==(null==(r=null==i?void 0:i.interpolation)?void 0:r.skipOnVariables)?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>V(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?V(this.escape(e)):V(e)}].forEach(t=>{for(s=0;a=t.regex.exec(e);){const n=a[1].trim();if(o=c(n),void 0===o)if("function"==typeof d){const t=d(e,a,i);o=u(t)?t:""}else if(i&&Object.prototype.hasOwnProperty.call(i,n))o="";else{if(f){o=a[0];continue}this.logger.warn("missed to pass in variable ".concat(n," for interpolating ").concat(e)),o=""}else!u(o)&&!this.useRawValueToEscape&&(o=h(o));const r=t.safeValue(o);if(e=e.replace(a[0],r),f?(t.regex.lastIndex+=o.length,t.regex.lastIndex-=a[0].length):t.regex.lastIndex=0,s++,s>=this.maxReplaces)break}}),e}nest(e,t){let n,i,r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=(e,t)=>{var n;const i=this.nestingOptionsSeparator;if(e.indexOf(i)<0)return e;const a=e.split(new RegExp("".concat(i,"[ ]*{")));let o="{".concat(a[1]);e=a[0],o=this.interpolate(o,r);const s=o.match(/'/g),l=o.match(/"/g);((null!==(n=null==s?void 0:s.length)&&void 0!==n?n:0)%2==0&&!l||l.length%2!=0)&&(o=o.replace(/'/g,'"'));try{r=JSON.parse(o),t&&(r=_objectSpread(_objectSpread({},t),r))}catch(t){return this.logger.warn("failed parsing options string in nesting for key ".concat(e),t),"".concat(e).concat(i).concat(o)}return r.defaultValue&&r.defaultValue.indexOf(this.prefix)>-1&&delete r.defaultValue,e};for(;n=this.nestingRegexp.exec(e);){let s=[];r=_objectSpread({},a),r=r.replace&&!u(r.replace)?r.replace:r,r.applyPostProcessor=!1,delete r.defaultValue;let l=!1;if(-1!==n[0].indexOf(this.formatSeparator)&&!/{.*}/.test(n[1])){const e=n[1].split(this.formatSeparator).map(e=>e.trim());n[1]=e.shift(),s=e,l=!0}if(i=t(o.call(this,n[1].trim(),r),r),i&&n[0]===e&&!u(i))return i;u(i)||(i=h(i)),i||(this.logger.warn("missed to resolve ".concat(n[1]," for nesting ").concat(e)),i=""),l&&(i=s.reduce((e,t)=>this.format(e,t,a.lng,_objectSpread(_objectSpread({},a),{},{interpolationkey:n[1].trim()})),i.trim())),e=e.replace(n[0],i),this.regexp.lastIndex=0}return e}}const H=e=>{const t={};return(n,i,r)=>{let a=r;r&&r.interpolationkey&&r.formatParams&&r.formatParams[r.interpolationkey]&&r[r.interpolationkey]&&(a=_objectSpread(_objectSpread({},a),{},{[r.interpolationkey]:void 0}));const o=i+JSON.stringify(a);let s=t[o];return s||(s=e(R(i),r),t[o]=s),s(n)}};class j{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=I.create("formatter"),this.options=e,this.formats={number:H((e,t)=>{const n=new Intl.NumberFormat(e,_objectSpread({},t));return e=>n.format(e)}),currency:H((e,t)=>{const n=new Intl.NumberFormat(e,_objectSpread(_objectSpread({},t),{},{style:"currency"}));return e=>n.format(e)}),datetime:H((e,t)=>{const n=new Intl.DateTimeFormat(e,_objectSpread({},t));return e=>n.format(e)}),relativetime:H((e,t)=>{const n=new Intl.RelativeTimeFormat(e,_objectSpread({},t));return e=>n.format(e,t.range||"day")}),list:H((e,t)=>{const n=new Intl.ListFormat(e,_objectSpread({},t));return e=>n.format(e)})},this.init(e)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};this.formatSeparator=t.interpolation.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=H(t)}format(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const r=t.split(this.formatSeparator);if(r.length>1&&r[0].indexOf("(")>1&&r[0].indexOf(")")<0&&r.find(e=>e.indexOf(")")>-1)){const e=r.findIndex(e=>e.indexOf(")")>-1);r[0]=[r[0],...r.splice(1,e)].join(this.formatSeparator)}return r.reduce((e,t)=>{var r;const{formatName:a,formatOptions:o}=(e=>{let t=e.toLowerCase().trim();const n={};if(e.indexOf("(")>-1){const i=e.split("(");t=i[0].toLowerCase().trim();const r=i[1].substring(0,i[1].length-1);"currency"===t&&r.indexOf(":")<0?n.currency||(n.currency=r.trim()):"relativetime"===t&&r.indexOf(":")<0?n.range||(n.range=r.trim()):r.split(";").forEach(e=>{if(e){const[t,...i]=e.split(":"),r=i.join(":").trim().replace(/^'+|'+$/g,""),a=t.trim();n[a]||(n[a]=r),"false"===r&&(n[a]=!1),"true"===r&&(n[a]=!0),isNaN(r)||(n[a]=parseInt(r,10))}})}return{formatName:t,formatOptions:n}})(t);if(this.formats[a]){let t=e;try{const s=(null==(r=null==i?void 0:i.formatParams)?void 0:r[i.interpolationkey])||{},l=s.locale||s.lng||i.locale||i.lng||n;t=this.formats[a](e,l,_objectSpread(_objectSpread(_objectSpread({},o),i),s))}catch(e){this.logger.warn(e)}return t}return this.logger.warn("there was no format function for ".concat(a)),e},e)}}class z extends L{constructor(e,t,n){var i,r;let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=n,this.languageUtils=n.languageUtils,this.options=a,this.logger=I.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=a.maxParallelReads||10,this.readingCalls=0,this.maxRetries=a.maxRetries>=0?a.maxRetries:5,this.retryTimeout=a.retryTimeout>=1?a.retryTimeout:350,this.state={},this.queue=[],null==(r=null==(i=this.backend)?void 0:i.init)||r.call(i,n,a.backend,a)}queueLoad(e,t,n,i){const r={},a={},o={},s={};return e.forEach(e=>{let i=!0;t.forEach(t=>{const o="".concat(e,"|").concat(t);!n.reload&&this.store.hasResourceBundle(e,t)?this.state[o]=2:this.state[o]<0||(1===this.state[o]?void 0===a[o]&&(a[o]=!0):(this.state[o]=1,i=!1,void 0===a[o]&&(a[o]=!0),void 0===r[o]&&(r[o]=!0),void 0===s[t]&&(s[t]=!0)))}),i||(o[e]=!0)}),(Object.keys(r).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:i}),{toLoad:Object.keys(r),pending:Object.keys(a),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(s)}}loaded(e,t,n){const i=e.split("|"),r=i[0],a=i[1];t&&this.emit("failedLoading",r,a,t),!t&&n&&this.store.addResourceBundle(r,a,n,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&n&&(this.state[e]=0);const o={};this.queue.forEach(n=>{((e,t,n)=>{const{obj:i,k:r}=m(e,t,Object);i[r]=i[r]||[],i[r].push(n)})(n.loaded,[r],a),((e,t)=>{void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)})(n,e),t&&n.errors.push(t),0===n.pendingCount&&!n.done&&(Object.keys(n.loaded).forEach(e=>{o[e]||(o[e]={});const t=n.loaded[e];t.length&&t.forEach(t=>{void 0===o[e][t]&&(o[e][t]=!0)})}),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())}),this.emit("loaded",o),this.queue=this.queue.filter(e=>!e.done)}read(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,a=arguments.length>5?arguments[5]:void 0;if(!e.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:n,tried:i,wait:r,callback:a});this.readingCalls++;const o=(o,s)=>{if(this.readingCalls--,this.waitingReads.length>0){const e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}o&&s&&i<this.maxRetries?setTimeout(()=>{this.read.call(this,e,t,n,i+1,2*r,a)},r):a(o,s)},s=this.backend[n].bind(this.backend);if(2!==s.length)return s(e,t,o);try{const n=s(e,t);n&&"function"==typeof n.then?n.then(e=>o(null,e)).catch(o):o(null,n)}catch(e){o(e)}}prepareLoading(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();u(e)&&(e=this.languageUtils.toResolveHierarchy(e)),u(t)&&(t=[t]);const r=this.queueLoad(e,t,n,i);if(!r.toLoad.length)return r.pending.length||i(),null;r.toLoad.forEach(e=>{this.loadOne(e)})}load(e,t,n){this.prepareLoading(e,t,{},n)}reload(e,t,n){this.prepareLoading(e,t,{reload:!0},n)}loadOne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e.split("|"),i=n[0],r=n[1];this.read(i,r,"read",void 0,void 0,(n,a)=>{n&&this.logger.warn("".concat(t,"loading namespace ").concat(r," for language ").concat(i," failed"),n),!n&&a&&this.logger.log("".concat(t,"loaded namespace ").concat(r," for language ").concat(i),a),this.loaded(e,n,a)})}saveMissing(e,t,n,i,r){var a,o,s,l,c;let u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:()=>{};if(null==(o=null==(a=this.services)?void 0:a.utils)||!o.hasLoadedNamespace||null!=(l=null==(s=this.services)?void 0:s.utils)&&l.hasLoadedNamespace(t)){if(null!=n&&""!==n){if(null!=(c=this.backend)&&c.create){const a=_objectSpread(_objectSpread({},u),{},{isUpdate:r}),o=this.backend.create.bind(this.backend);if(o.length<6)try{let r;r=5===o.length?o(e,t,n,i,a):o(e,t,n,i),r&&"function"==typeof r.then?r.then(e=>d(null,e)).catch(d):d(null,r)}catch(e){d(e)}else o(e,t,n,i,d,a)}!e||!e[0]||this.store.addResource(e[0],t,n,i)}}else this.logger.warn('did not save key "'.concat(n,'" as the namespace "').concat(t,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")}}const Z=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if("object"==typeof e[1]&&(t=e[1]),u(e[1])&&(t.defaultValue=e[1]),u(e[2])&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){const n=e[3]||e[2];Object.keys(n).forEach(e=>{t[e]=n[e]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),q=e=>{var t,n;return u(e.ns)&&(e.ns=[e.ns]),u(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),u(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),(null==(n=null==(t=e.supportedLngs)?void 0:t.indexOf)?void 0:n.call(t,"cimode"))<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),"boolean"==typeof e.initImmediate&&(e.initAsync=e.initImmediate),e},W=()=>{};class Y extends L{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=q(e),this.services={},this.logger=I,this.modules={external:[]},n=this,Object.getOwnPropertyNames(Object.getPrototypeOf(n)).forEach(e=>{"function"==typeof n[e]&&(n[e]=n[e].bind(n))}),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}var n}init(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,"function"==typeof t&&(n=t,t={}),null==t.defaultNS&&t.ns&&(u(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const i=Z();this.options=_objectSpread(_objectSpread(_objectSpread({},i),this.options),q(t)),this.options.interpolation=_objectSpread(_objectSpread({},i.interpolation),this.options.interpolation),void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator);const r=e=>e?"function"==typeof e?new e:e:null;if(!this.options.isClone){let t;this.modules.logger?I.init(r(this.modules.logger),this.options):I.init(null,this.options),t=this.modules.formatter?this.modules.formatter:j;const n=new N(this.options);this.store=new M(this.options.resources,this.options);const a=this.services;a.logger=I,a.resourceStore=this.store,a.languageUtils=n,a.pluralResolver=new B(n,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),t&&(!this.options.interpolation.format||this.options.interpolation.format===i.interpolation.format)&&(a.formatter=r(t),a.formatter.init(a,this.options),this.options.interpolation.format=a.formatter.format.bind(a.formatter)),a.interpolator=new G(this.options),a.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},a.backendConnector=new z(r(this.modules.backend),a.resourceStore,a,this.options),a.backendConnector.on("*",function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e.emit(t,...i)}),this.modules.languageDetector&&(a.languageDetector=r(this.modules.languageDetector),a.languageDetector.init&&a.languageDetector.init(a,this.options.detection,this.options)),this.modules.i18nFormat&&(a.i18nFormat=r(this.modules.i18nFormat),a.i18nFormat.init&&a.i18nFormat.init(this)),this.translator=new O(this.services,this.options),this.translator.on("*",function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e.emit(t,...i)}),this.modules.external.forEach(e=>{e.init&&e.init(this)})}if(this.format=this.options.interpolation.format,n||(n=W),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(t=>{this[t]=function(){return e.store[t](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(t=>{this[t]=function(){return e.store[t](...arguments),e}});const a=d(),o=()=>{const e=(e,t)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),a.resolve(t),n(e,t)};if(this.languages&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initAsync?o():setTimeout(o,0),a}loadResources(e){var t,n;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W;const r=u(e)?e:this.language;if("function"==typeof e&&(i=e),!this.options.resources||this.options.partialBundledLanguages){if("cimode"===(null==r?void 0:r.toLowerCase())&&(!this.options.preload||0===this.options.preload.length))return i();const e=[],a=t=>{t&&"cimode"!==t&&this.services.languageUtils.toResolveHierarchy(t).forEach(t=>{"cimode"!==t&&e.indexOf(t)<0&&e.push(t)})};r?a(r):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(e=>a(e)),null==(n=null==(t=this.options.preload)?void 0:t.forEach)||n.call(t,e=>a(e)),this.services.backendConnector.load(e,this.options.ns,e=>{!e&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),i(e)})}else i(null)}reloadResources(e,t,n){const i=d();return"function"==typeof e&&(n=e,e=void 0),"function"==typeof t&&(n=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),n||(n=W),this.services.backendConnector.reload(e,t,e=>{i.resolve(),n(e)}),i}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&C.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(let e=0;e<this.languages.length;e++){const t=this.languages[e];if(!(["cimode","dev"].indexOf(t)>-1)&&this.store.hasLanguageSomeTranslations(t)){this.resolvedLanguage=t;break}}}changeLanguage(e,t){var n=this;this.isLanguageChangingTo=e;const i=d();this.emit("languageChanging",e);const r=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},a=(e,a)=>{a?(r(a),this.translator.changeLanguage(a),this.isLanguageChangingTo=void 0,this.emit("languageChanged",a),this.logger.log("languageChanged",a)):this.isLanguageChangingTo=void 0,i.resolve(function(){return n.t(...arguments)}),t&&t(e,function(){return n.t(...arguments)})},o=t=>{var n,i;!e&&!t&&this.services.languageDetector&&(t=[]);const o=u(t)?t:this.services.languageUtils.getBestMatchFromCodes(t);o&&(this.language||r(o),this.translator.language||this.translator.changeLanguage(o),null==(i=null==(n=this.services.languageDetector)?void 0:n.cacheUserLanguage)||i.call(n,o)),this.loadResources(o,e=>{a(e,o)})};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(o):this.services.languageDetector.detect(o):o(e):o(this.services.languageDetector.detect()),i}getFixedT(e,t,n){var i=this;const r=function(e,t){let a;if("object"!=typeof t){for(var o=arguments.length,s=new Array(o>2?o-2:0),l=2;l<o;l++)s[l-2]=arguments[l];a=i.options.overloadTranslationOptionHandler([e,t].concat(s))}else a=_objectSpread({},t);a.lng=a.lng||r.lng,a.lngs=a.lngs||r.lngs,a.ns=a.ns||r.ns,""!==a.keyPrefix&&(a.keyPrefix=a.keyPrefix||n||r.keyPrefix);const c=i.options.keySeparator||".";let u;return u=a.keyPrefix&&Array.isArray(e)?e.map(e=>"".concat(a.keyPrefix).concat(c).concat(e)):a.keyPrefix?"".concat(a.keyPrefix).concat(c).concat(e):e,i.t(u,a)};return u(e)?r.lng=e:r.lngs=e,r.ns=t,r.keyPrefix=n,r}t(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return null==(e=this.translator)?void 0:e.translate(...n)}exists(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return null==(e=this.translator)?void 0:e.exists(...n)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const n=t.lng||this.resolvedLanguage||this.languages[0],i=!!this.options&&this.options.fallbackLng,r=this.languages[this.languages.length-1];if("cimode"===n.toLowerCase())return!0;const a=(e,t)=>{const n=this.services.backendConnector.state["".concat(e,"|").concat(t)];return-1===n||0===n||2===n};if(t.precheck){const e=t.precheck(this,a);if(void 0!==e)return e}return!!(this.hasResourceBundle(n,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||a(n,e)&&(!i||a(r,e)))}loadNamespaces(e,t){const n=d();return this.options.ns?(u(e)&&(e=[e]),e.forEach(e=>{this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}),this.loadResources(e=>{n.resolve(),t&&t(e)}),n):(t&&t(),Promise.resolve())}loadLanguages(e,t){const n=d();u(e)&&(e=[e]);const i=this.options.preload||[],r=e.filter(e=>i.indexOf(e)<0&&this.services.languageUtils.isSupportedCode(e));return r.length?(this.options.preload=i.concat(r),this.loadResources(e=>{n.resolve(),t&&t(e)}),n):(t&&t(),Promise.resolve())}dir(e){var t,n;if(e||(e=this.resolvedLanguage||((null==(t=this.languages)?void 0:t.length)>0?this.languages[0]:this.language)),!e)return"rtl";const i=(null==(n=this.services)?void 0:n.languageUtils)||new N(Z());return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(i.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){return new Y(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)}cloneInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W;const n=e.forkResourceStore;n&&delete e.forkResourceStore;const i=_objectSpread(_objectSpread(_objectSpread({},this.options),e),{},{isClone:!0}),r=new Y(i);if((void 0!==e.debug||void 0!==e.prefix)&&(r.logger=r.logger.clone(e)),["store","services","language"].forEach(e=>{r[e]=this[e]}),r.services=_objectSpread({},this.services),r.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},n){const e=Object.keys(this.store.data).reduce((e,t)=>(e[t]=_objectSpread({},this.store.data[t]),Object.keys(e[t]).reduce((n,i)=>(n[i]=_objectSpread({},e[t][i]),n),{})),{});r.store=new M(e,i),r.services.resourceStore=r.store}return r.translator=new O(r.services,i),r.translator.on("*",function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];r.emit(e,...n)}),r.init(i,t),r.translator.options=i,r.translator.backendConnector.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},r}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const K=Y.createInstance();K.createInstance=Y.createInstance,K.createInstance,K.dir,K.init,K.loadResources,K.reloadResources,K.use,K.changeLanguage,K.getFixedT,K.t,K.exists,K.setDefaultNamespace,K.hasLoadedNamespace,K.loadNamespaces,K.loadLanguages;var X=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Q(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}const{slice:J,forEach:$}=[];const ee=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,te={create(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{path:"/",sameSite:"strict"};n&&(r.expires=new Date,r.expires.setTime(r.expires.getTime()+60*n*1e3)),i&&(r.domain=i),document.cookie=function(e,t){const n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{path:"/"},i=encodeURIComponent(t);let r="".concat(e,"=").concat(i);if(n.maxAge>0){const e=n.maxAge-0;if(Number.isNaN(e))throw new Error("maxAge should be a Number");r+="; Max-Age=".concat(Math.floor(e))}if(n.domain){if(!ee.test(n.domain))throw new TypeError("option domain is invalid");r+="; Domain=".concat(n.domain)}if(n.path){if(!ee.test(n.path))throw new TypeError("option path is invalid");r+="; Path=".concat(n.path)}if(n.expires){if("function"!=typeof n.expires.toUTCString)throw new TypeError("option expires is invalid");r+="; Expires=".concat(n.expires.toUTCString())}if(n.httpOnly&&(r+="; HttpOnly"),n.secure&&(r+="; Secure"),n.sameSite)switch("string"==typeof n.sameSite?n.sameSite.toLowerCase():n.sameSite){case!0:r+="; SameSite=Strict";break;case"lax":r+="; SameSite=Lax";break;case"strict":r+="; SameSite=Strict";break;case"none":r+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return n.partitioned&&(r+="; Partitioned"),r}(e,t,r)},read(e){const t="".concat(e,"="),n=document.cookie.split(";");for(let e=0;e<n.length;e++){let i=n[e];for(;" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null},remove(e,t){this.create(e,"",-1,t)}};var ne={name:"cookie",lookup(e){let{lookupCookie:t}=e;if(t&&typeof document<"u")return te.read(t)||void 0},cacheUserLanguage(e,t){let{lookupCookie:n,cookieMinutes:i,cookieDomain:r,cookieOptions:a}=t;n&&typeof document<"u"&&te.create(n,e,i,r,a)}},ie={name:"querystring",lookup(e){var t;let n,{lookupQuerystring:i}=e;if(typeof window<"u"){let{search:e}=window.location;!window.location.search&&(null==(t=window.location.hash)?void 0:t.indexOf("?"))>-1&&(e=window.location.hash.substring(window.location.hash.indexOf("?")));const r=e.substring(1).split("&");for(let e=0;e<r.length;e++){const t=r[e].indexOf("=");t>0&&r[e].substring(0,t)===i&&(n=r[e].substring(t+1))}}return n}},re={name:"hash",lookup(e){var t;let n,{lookupHash:i,lookupFromHashIndex:r}=e;if(typeof window<"u"){const{hash:e}=window.location;if(e&&e.length>2){const a=e.substring(1);if(i){const e=a.split("&");for(let t=0;t<e.length;t++){const r=e[t].indexOf("=");r>0&&e[t].substring(0,r)===i&&(n=e[t].substring(r+1))}}if(n)return n;if(!n&&r>-1){const n=e.match(/\/([a-zA-Z-]*)/g);return Array.isArray(n)?null==(t=n["number"==typeof r?r:0])?void 0:t.replace("/",""):void 0}}}return n}};let ae=null;const oe=()=>{if(null!==ae)return ae;try{if(ae=typeof window<"u"&&null!==window.localStorage,!ae)return!1;const e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch(e){ae=!1}return ae};var se={name:"localStorage",lookup(e){let{lookupLocalStorage:t}=e;if(t&&oe())return window.localStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupLocalStorage:n}=t;n&&oe()&&window.localStorage.setItem(n,e)}};let le=null;const ce=()=>{if(null!==le)return le;try{if(le=typeof window<"u"&&null!==window.sessionStorage,!le)return!1;const e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch(e){le=!1}return le};var ue={name:"sessionStorage",lookup(e){let{lookupSessionStorage:t}=e;if(t&&ce())return window.sessionStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupSessionStorage:n}=t;n&&ce()&&window.sessionStorage.setItem(n,e)}},de={name:"navigator",lookup(e){const t=[];if(typeof navigator<"u"){const{languages:e,userLanguage:n,language:i}=navigator;if(e)for(let n=0;n<e.length;n++)t.push(e[n]);n&&t.push(n),i&&t.push(i)}return t.length>0?t:void 0}},he={name:"htmlTag",lookup(e){let t,{htmlTag:n}=e;const i=n||(typeof document<"u"?document.documentElement:null);return i&&"function"==typeof i.getAttribute&&(t=i.getAttribute("lang")),t}},fe={name:"path",lookup(e){var t;let{lookupFromPathIndex:n}=e;if(typeof window>"u")return;const i=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(i)?null==(t=i["number"==typeof n?n:0])?void 0:t.replace("/",""):void 0}},pe={name:"subdomain",lookup(e){var t,n;let{lookupFromSubdomainIndex:i}=e;const r="number"==typeof i?i+1:1,a=typeof window<"u"&&(null==(n=null==(t=window.location)?void 0:t.hostname)?void 0:n.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(a)return a[r]}};let ge=!1;try{document.cookie,ge=!0}catch(e){}const me=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];ge||me.splice(1,1);class ve{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,t)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{languageUtils:{}},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=e,this.options=function(e){return $.call(J.call(arguments,1),t=>{if(t)for(const n in t)void 0===e[n]&&(e[n]=t[n])}),e}(t,this.options||{},{order:me,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:e=>e}),"string"==typeof this.options.convertDetectedLanguage&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=e=>e.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=n,this.addDetector(ne),this.addDetector(ie),this.addDetector(se),this.addDetector(ue),this.addDetector(de),this.addDetector(he),this.addDetector(fe),this.addDetector(pe),this.addDetector(re)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.order,t=[];return e.forEach(e=>{if(this.detectors[e]){let n=this.detectors[e].lookup(this.options);n&&"string"==typeof n&&(n=[n]),n&&(t=t.concat(n))}}),t=t.filter(e=>{return null!=e&&!("string"==typeof(t=e)&&[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(e=>e.test(t)));var t}).map(e=>this.options.convertDetectedLanguage(e)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?t:t.length>0?t[0]:null}cacheUserLanguage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.caches;t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach(t=>{this.detectors[t]&&this.detectors[t].cacheUserLanguage(e,this.options)}))}}ve.type="languageDetector";const ye=Q(ve),_e="in_renderer_i18n";K.use(ye).init({fallbackLng:"en",detection:{lookupCookie:_e,lookupLocalStorage:_e,lookupSessionStorage:_e},resources:{en:{translation:{LearnMore:"Learn More",Replay:"Replay"}},ja:{translation:{LearnMore:"詳しくはこちら",Replay:"リプレイ"}}}});const Ee=K;var be={exports:{}};
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */be.exports=function(){function e(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function t(e){return"function"==typeof e}var n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},i=0,r=void 0,a=void 0,o=function(e,t){_[i]=e,_[i+1]=t,2===(i+=2)&&(a?a(E):T())};function s(e){a=e}function l(e){o=e}var c=typeof window<"u"?window:void 0,u=c||{},d=u.MutationObserver||u.WebKitMutationObserver,h=typeof self>"u"&&typeof process<"u"&&"[object process]"==={}.toString.call(process),f=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function p(){return function(){return process.nextTick(E)}}function g(){return typeof r<"u"?function(){r(E)}:y()}function m(){var e=0,t=new d(E),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function v(){var e=new MessageChannel;return e.port1.onmessage=E,function(){return e.port2.postMessage(0)}}function y(){var e=setTimeout;return function(){return e(E,1)}}var _=new Array(1e3);function E(){for(var e=0;e<i;e+=2)(0,_[e])(_[e+1]),_[e]=void 0,_[e+1]=void 0;i=0}function b(){try{var e=Function("return this")().require("vertx");return r=e.runOnLoop||e.runOnContext,g()}catch(e){return y()}}var T=void 0;function S(e,t){var n=this,i=new this.constructor(R);void 0===i[A]&&q(i);var r=n._state;if(r){var a=arguments[r-1];o(function(){return H(r,i,a,n._result)})}else V(n,i,e,t);return i}function w(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(R);return k(n,e),n}T=h?p():d?m():f?v():void 0===c?b():y();var A=Math.random().toString(36).substring(2);function R(){}var x=void 0,I=1,L=2;function M(){return new TypeError("You cannot resolve a promise with itself")}function C(){return new TypeError("A promises callback cannot return that same promise.")}function P(e,t,n,i){try{e.call(t,n,i)}catch(e){return e}}function D(e,t,n){o(function(e){var i=!1,r=P(n,t,function(n){i||(i=!0,t!==n?k(e,n):B(e,n))},function(t){i||(i=!0,U(e,t))},"Settle: "+(e._label||" unknown promise"));!i&&r&&(i=!0,U(e,r))},e)}function O(e,t){t._state===I?B(e,t._result):t._state===L?U(e,t._result):V(t,void 0,function(t){return k(e,t)},function(t){return U(e,t)})}function N(e,n,i){n.constructor===e.constructor&&i===S&&n.constructor.resolve===w?O(e,n):void 0===i?B(e,n):t(i)?D(e,n,i):B(e,n)}function k(t,n){if(t===n)U(t,M());else if(e(n)){var i=void 0;try{i=n.then}catch(e){return void U(t,e)}N(t,n,i)}else B(t,n)}function F(e){e._onerror&&e._onerror(e._result),G(e)}function B(e,t){e._state===x&&(e._result=t,e._state=I,0!==e._subscribers.length&&o(G,e))}function U(e,t){e._state===x&&(e._state=L,e._result=t,o(F,e))}function V(e,t,n,i){var r=e._subscribers,a=r.length;e._onerror=null,r[a]=t,r[a+I]=n,r[a+L]=i,0===a&&e._state&&o(G,e)}function G(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i=void 0,r=void 0,a=e._result,o=0;o<t.length;o+=3)i=t[o],r=t[o+n],i?H(n,i,r,a):r(a);e._subscribers.length=0}}function H(e,n,i,r){var a=t(i),o=void 0,s=void 0,l=!0;if(a){try{o=i(r)}catch(e){l=!1,s=e}if(n===o)return void U(n,C())}else o=r;n._state!==x||(a&&l?k(n,o):!1===l?U(n,s):e===I?B(n,o):e===L&&U(n,o))}function j(e,t){try{t(function(t){k(e,t)},function(t){U(e,t)})}catch(t){U(e,t)}}var z=0;function Z(){return z++}function q(e){e[A]=z++,e._state=void 0,e._result=void 0,e._subscribers=[]}function W(){return new Error("Array Methods must be provided an Array")}var Y=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(R),this.promise[A]||q(this.promise),n(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?B(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&B(this.promise,this._result))):U(this.promise,W())}return e.prototype._enumerate=function(e){for(var t=0;this._state===x&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===w){var r=void 0,a=void 0,o=!1;try{r=e.then}catch(e){o=!0,a=e}if(r===S&&e._state!==x)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(n===te){var s=new n(R);o?U(s,a):N(s,e,r),this._willSettleAt(s,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(i(e),t)},e.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===x&&(this._remaining--,e===L?U(i,n):this._result[t]=n),0===this._remaining&&B(i,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;V(e,void 0,function(e){return n._settledAt(I,t,e)},function(e){return n._settledAt(L,t,e)})},e}();function K(e){return new Y(this,e).promise}function Q(e){var t=this;return n(e)?new t(function(n,i){for(var r=e.length,a=0;a<r;a++)t.resolve(e[a]).then(n,i)}):new t(function(e,t){return t(new TypeError("You must pass an array to race."))})}function J(e){var t=new this(R);return U(t,e),t}function $(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function ee(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var te=function(){function e(t){this[A]=Z(),this._result=this._state=void 0,this._subscribers=[],R!==t&&("function"!=typeof t&&$(),this instanceof e?j(this,t):ee())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var n=this,i=n.constructor;return t(e)?n.then(function(t){return i.resolve(e()).then(function(){return t})},function(t){return i.resolve(e()).then(function(){throw t})}):n.then(e,e)},e}();function ne(){var e=void 0;if(typeof X<"u")e=X;else if(typeof self<"u")e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=te}return te.prototype.then=S,te.all=K,te.race=Q,te.resolve=w,te.reject=J,te._setScheduler=s,te._setAsap=l,te._asap=o,te.polyfill=ne,te.Promise=te,te}();const Te=Q(be.exports);"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");const n=Object(e);for(let e=1;e<arguments.length;e++){const t=arguments[e];if(null!=t)for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e])}return n},writable:!0,configurable:!0}),function(){if("function"==typeof globalThis.CustomEvent)return!1;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}e.prototype=globalThis.Event.prototype,globalThis.CustomEvent=e}(),typeof globalThis.Element<"u"&&typeof globalThis.CharacterData<"u"&&typeof globalThis.DocumentType<"u"&&[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach(function(e){e.hasOwnProperty("remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){null!==this.parentNode&&this.parentNode.removeChild(this)}})}),Te.polyfill(),typeof window<"u"&&!window.dashjs&&(window.dashjs={skipAutoCreate:!0,isDefaultSubject:!0});const Se=[function(e,t){const n={AdStarted:()=>e.onStartVpaidAd,AdStopped:()=>e.onStopVpaidAd,AdSkipped:()=>e.onSkipVpaidAd,AdLoaded:()=>e.onVpaidAdLoaded,AdLinearChange:()=>e.onVpaidAdLinearChange,AdSizeChange:()=>e.onVpaidAdSizeChange,AdExpandedChange:()=>e.onVpaidAdExpandedChange,AdSkippableStateChange:()=>e.onVpaidAdSkippableStateChange,AdDurationChange:()=>e.onVpaidAdDurationChange,AdRemainingTimeChange:()=>e.onVpaidAdRemainingTimeChange,AdVolumeChange:()=>e.onVpaidAdVolumeChange,AdImpression:()=>e.onVpaidAdImpression,AdClickThru:()=>e.onVpaidAdClickThru,AdInteraction:()=>e.onVpaidAdInteraction,AdVideoStart:()=>e.onVpaidAdVideoStart,AdVideoFirstQuartile:()=>e.onVpaidAdVideoFirstQuartile,AdVideoMidpoint:()=>e.onVpaidAdVideoMidpoint,AdVideoThirdQuartile:()=>e.onVpaidAdVideoThirdQuartile,AdVideoComplete:()=>e.onVpaidAdVideoComplete,AdUserAcceptInvitation:()=>e.onVpaidAdUserAcceptInvitation,AdUserMinimize:()=>e.onVpaidAdUserMinimize,AdUserClose:()=>e.onVpaidAdUserClose,AdPaused:()=>e.onVpaidAdPaused,AdPlaying:()=>e.onVpaidAdPlaying,AdError:()=>e.onVpaidAdError,AdLog:()=>e.onVpaidAdLog};e.checkVPAIDInterface=e=>{const t=e;return!!(t.handshakeVersion&&"function"==typeof t.handshakeVersion&&t.initAd&&"function"==typeof t.initAd&&t.startAd&&"function"==typeof t.startAd&&t.stopAd&&"function"==typeof t.stopAd&&t.skipAd&&"function"==typeof t.skipAd&&t.resizeAd&&"function"==typeof t.resizeAd&&t.pauseAd&&"function"==typeof t.pauseAd&&t.resumeAd&&"function"==typeof t.resumeAd&&t.expandAd&&"function"==typeof t.expandAd&&t.collapseAd&&"function"==typeof t.collapseAd&&t.subscribe&&"function"==typeof t.subscribe&&t.unsubscribe&&"function"==typeof t.unsubscribe)},e.onVpaidAdPaused=()=>{e.vpaidTimeoutTimerClear(),e.debugMessage("onAdPaused")},e.onVpaidAdPlaying=()=>{e.vpaidTimeoutTimerClear(),e.debugMessage("onAdPlaying")},e.onVpaidAdError=t=>{e.debugMessage("onAdError: "+t),e.vpaidTimeoutTimerClear(),e.onVpaidEnded()},e.onVpaidAdLog=t=>{e.debugMessage("onAdLog: "+t)},e.onVpaidAdUserAcceptInvitation=()=>{e.debugMessage("onAdUserAcceptInvitation")},e.onVpaidAdUserMinimize=()=>{e.debugMessage("onAdUserMinimize")},e.onVpaidAdUserClose=()=>{e.debugMessage("onAdUserClose")},e.onVpaidAdSkippableStateChange=()=>{e.vpaidAdUnit&&e.debugMessage("Ad Skippable State Changed to: "+e.vpaidAdUnit.getAdSkippableState())},e.onVpaidAdExpandedChange=()=>{e.vpaidAdUnit&&e.debugMessage("Ad Expanded Changed to: "+e.vpaidAdUnit.getAdExpanded())},e.getVpaidAdExpanded=()=>{if(e.debugMessage("getAdExpanded"),e.vpaidAdUnit)return e.vpaidAdUnit.getAdExpanded()},e.getVpaidAdSkippableState=()=>{if(e.debugMessage("getAdSkippableState"),e.vpaidAdUnit)return e.vpaidAdUnit.getAdSkippableState()},e.onVpaidAdSizeChange=()=>{e.vpaidAdUnit&&e.debugMessage("Ad size changed to: w="+e.vpaidAdUnit.getAdWidth()+" h="+e.vpaidAdUnit.getAdHeight())},e.onVpaidAdDurationChange=()=>{e.vpaidAdUnit&&e.debugMessage("Ad Duration Changed to: "+e.vpaidAdUnit.getAdDuration())},e.onVpaidAdRemainingTimeChange=()=>{e.vpaidAdUnit&&e.debugMessage("Ad Remaining Time Changed to: "+e.vpaidAdUnit.getAdRemainingTime())},e.getVpaidAdRemainingTime=()=>{if(e.debugMessage("getAdRemainingTime"),e.vpaidAdUnit)return e.vpaidAdUnit.getAdRemainingTime()},e.onVpaidAdImpression=()=>{e.debugMessage("Ad Impression"),e.trackSingleEvent("impression")},e.onVpaidAdClickThru=(t,n,i)=>{e.debugMessage("Clickthrough portion of the ad was clicked"),i&&window.open(e.vastOptions.clickthroughUrl),e.pauseVpaidAd(),e.callUris(e.vastOptions.clicktracking)},e.onVpaidAdInteraction=t=>{e.debugMessage("A non-clickthrough event has occured")},e.onVpaidAdVideoStart=()=>{e.debugMessage("Video 0% completed"),e.trackSingleEvent("start")},e.onVpaidAdVideoFirstQuartile=()=>{e.debugMessage("Video 25% completed"),e.trackSingleEvent("firstQuartile")},e.onVpaidAdVideoMidpoint=()=>{e.debugMessage("Video 50% completed"),e.trackSingleEvent("midpoint")},e.onVpaidAdVideoThirdQuartile=()=>{e.debugMessage("Video 75% completed"),e.trackSingleEvent("thirdQuartile")},e.onVpaidAdVideoComplete=()=>{e.debugMessage("Video 100% completed"),e.trackSingleEvent("complete")},e.onVpaidAdLinearChange=()=>{const t=e.domRef.wrapper.getElementsByClassName("fluid_vpaidNonLinear_ad")[0],n=e.domRef.wrapper.querySelector(".close_button"),i=t.getAttribute("adlistid");if(e.debugMessage("Ad linear has changed: "+e.vpaidAdUnit.getAdLinear()),!e.vpaidAdUnit.getAdLinear())return;e.backupMainVideoContentTime(i.split("_")[0]),e.isCurrentlyPlayingAd=!0,n&&n.remove(),t.className="fluid_vpaid_slot",e.domRef.player.loop=!1,e.domRef.player.removeAttribute("controls");const r=e.domRef.player.parentNode.getElementsByClassName("fluid_controls_currentprogress");for(let t=0;t<r.length;t++)r[t].style.backgroundColor=e.displayOptions.layoutControls.adProgressColor;e.toggleLoader(!1)},e.getVpaidAdLinear=()=>(e.debugMessage("getAdLinear"),e.vpaidAdUnit.getAdLinear()),e.isAdLinear=t=>{try{return e.getVpaidAdLinear()}catch(n){return e.debugMessage("Error calling getAdLinear(), handshake -> initAd() must be set before calling getAdLinear(). Falling back to VAST metadata: "+n),t.adType&&"linear"===t.adType.toLowerCase()}},e.startVpaidAd=()=>{e.debugMessage("startAd"),e.vpaidTimeoutTimerStart(),e.vpaidAdUnit.startAd()},e.onVpaidAdLoaded=()=>{e.debugMessage("ad has been loaded"),e.vpaidTimeoutTimerClear(),e.startVpaidAd()},e.onStartVpaidAd=()=>{e.debugMessage("Ad has started"),e.vpaidTimeoutTimerClear()},e.stopVpaidAd=()=>{e.vpaidTimeoutTimerStart(),e.vpaidAdUnit.stopAd()},e.hardStopVpaidAd=t=>{e.vpaidAdUnit&&(e.vpaidAdUnit.stopAd(),e.vpaidAdUnit=null);const n=e.domRef.wrapper.getElementsByClassName("fluid_vpaid_iframe"),i=e.domRef.wrapper.getElementsByClassName("fluid_vpaid_slot"),r=e.domRef.wrapper.getElementsByClassName("fluid_vpaidNonLinear_ad");for(let e=0;e<n.length;e++)n[e].getAttribute("adListId")!==t.id&&n[e].remove();for(let e=0;e<i.length;e++)i[e].getAttribute("adListId")!==t.id&&i[e].remove();for(let e=0;e<r.length;e++)r[e].getAttribute("adListId")!==t.id&&r[e].remove()},e.onStopVpaidAd=()=>{e.debugMessage("Ad has stopped"),e.vpaidTimeoutTimerClear(),e.onVpaidEnded()},e.onSkipVpaidAd=()=>{e.debugMessage("Ad was skipped"),e.vpaidTimeoutTimerClear(),e.onVpaidEnded()},e.skipVpaidAd=()=>{e.vpaidTimeoutTimerStart(),e.vpaidAdUnit&&(e.vpaidAdUnit.skipAd(),e.vpaidTimeoutTimerClear(),e.onVpaidEnded())},e.setVpaidAdVolume=t=>{e.vpaidAdUnit&&e.vpaidAdUnit.setAdVolume(t)},e.getVpaidAdVolume=()=>{if(e.vpaidAdUnit)return e.vpaidAdUnit.getAdVolume()},e.onVpaidAdVolumeChange=()=>{e.vpaidAdUnit&&e.debugMessage("Ad Volume has changed to - "+e.vpaidAdUnit.getAdVolume())},e.resizeVpaidAuto=()=>{if(null!==e.vastOptions&&e.vastOptions.vpaid&&e.vastOptions.linear){const t=e.domRef.player.offsetWidth,n=e.domRef.player.offsetHeight,i=e.fullscreenMode?"fullscreen":"normal";e.resizeVpaidAd(t,n,i)}},e.resizeVpaidAd=(t,n,i)=>{e.vpaidAdUnit&&e.vpaidAdUnit.resizeAd(t,n,i)},e.pauseVpaidAd=()=>{e.vpaidTimeoutTimerStart(),e.vpaidAdUnit&&e.vpaidAdUnit.pauseAd()},e.resumeVpaidAd=()=>{e.vpaidTimeoutTimerStart(),e.vpaidAdUnit&&e.vpaidAdUnit.resumeAd()},e.expandVpaidAd=()=>{e.vpaidAdUnit&&e.vpaidAdUnit.expandAd()},e.collapseVpaidAd=()=>{e.vpaidAdUnit&&e.vpaidAdUnit.collapseAd()},e.vpaidTimeoutTimerClear=()=>{e.vpaidTimer&&clearTimeout(e.vpaidTimer)},e.vpaidTimeoutTimerStart=()=>{e.vpaidTimeoutTimerClear(),e.vpaidTimer=setTimeout(function(){e.announceLocalError("901"),e.onVpaidEnded()},e.displayOptions.vastOptions.vpaidTimeout)},e.vpaidCallbackListenersAttach=()=>{for(let t in n)e.vpaidAdUnit.subscribe(n[t](),t,e)},e.vpaidCallbackListenersDetach=()=>{if(e.vpaidAdUnit)for(let t in n)e.vpaidAdUnit.unsubscribe(n[t](),t,e)},e.loadVpaid=(t,n)=>{const i=document.createElement("iframe");i.id="fp_"+t.id+"_fluid_vpaid_iframe",i.className="fluid_vpaid_iframe",i.setAttribute("adListId",t.id),i.setAttribute("frameborder","0"),e.domRef.player.parentNode.insertBefore(i,e.domRef.player.nextSibling);const r=document.createElement("script");r.src=n,i.contentWindow.document.head.append(r),e.tempVpaidCounter=0,e.getVPAIDAdInterval=setInterval(function(){if(i&&i.contentWindow){const n=i.contentWindow.getVPAIDAd;if(n&&"function"==typeof n)e.vpaidAdUnit&&e.hardStopVpaidAd(t),e.vpaidAdUnit=n(),clearInterval(e.getVPAIDAdInterval),e.checkVPAIDInterface(e.vpaidAdUnit)&&(e.isAdLinear(t)?(e.isCurrentlyPlayingAd=!0,e.switchPlayerToVpaidMode(t)):(e.debugMessage("non linear vpaid ad is loaded"),e.loadVpaidNonlinearAssets(t)));else{if(e.tempVpaidCounter++,e.tempVpaidCounter>=20)return clearInterval(e.getVPAIDAdInterval),e.rollsById[t.rollListId].error=!0,e.playMainVideoWhenVpaidFails(403),!1;e.debugMessage(e.tempVpaidCounter)}}},100),e.destructors.push(()=>clearInterval(e.getVPAIDAdInterval))},e.onVpaidEnded=t=>{if(t&&t.stopImmediatePropagation(),!e.vpaidAdUnit)return;const n=e.domRef.wrapper.querySelector(".fluid_vpaid_slot");e.vpaidCallbackListenersDetach(),e.vpaidAdUnit=null,clearInterval(e.getVPAIDAdInterval),n&&n.remove(),e.checkForNextAd()},e.playMainVideoWhenVpaidFails=t=>{const n=e.domRef.wrapper.querySelector(".fluid_vpaid_slot");n&&n.remove(),clearInterval(e.getVPAIDAdInterval),e.playMainVideoWhenVastFails(t)}},function(e,t){function n(e){for(const t of e)if(void 0===t.data.attributes.sequence)return[t];return[]}async function i(t,a){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];var l,c,u,d;const h=_objectSpread(_objectSpread({},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),{},{children:[]}),{responseXML:f}=await e.sendRequestAsync(t,!0,e.displayOptions.vastOptions.vastTimeout),p=Array.from(f.getElementsByTagName("Ad"));for(const t of p){const f=e.getVastAdTagUriFromWrapper(t),p=void 0!==t.attributes.sequence,g={data:t},m=(t.getElementsByTagName("Linear").length?"linear":t.getElementsByTagName("NonLinearAds").length&&"nonLinear")||"";if(f&&o<=a&&s){const[r]=t.getElementsByTagName("Wrapper"),s=r.attributes.followAdditionalWrappers&&["false","0"].includes(r.attributes.followAdditionalWrappers.value),l=r.attributes.allowMultipleAds&&["true","1"].includes(r.attributes.allowMultipleAds.value),c=r.attributes.fallbackOnNoAd&&["true","1"].includes(r.attributes.fallbackOnNoAd.value);try{const e=await i(f,a,_objectSpread(_objectSpread({tagType:"wrapper"},g),{},{fallbackOnNoAd:c}),o+1,!s);e.fallbackOnNoAd=c,(!l||p)&&(e.children=n(e.children)),h.children.push(e)}catch(t){h.children.push({tagType:"wrapper",fallbackOnNoAd:c,httpError:!0}),e.debugMessage("Error when loading Wrapper, will trigger fallback if available",t)}}else if(!f)if("nonLinear"===m)h.children.push(_objectSpread({tagType:"inLine"},g));else if(Array.from(t.getElementsByTagName("MediaFiles")).length){const e=null==(l=Array.from(t.getElementsByTagName("MediaFiles"))[0])?void 0:l.getElementsByTagName("MediaFile"),n=null==(c=e[0])?void 0:c.textContent.trim();("VPAID"===e[0].getAttribute("apiFramework")||await r(n))&&h.children.push(_objectSpread({tagType:"inLine"},g))}else if(Array.from(t.getElementsByTagName("AdParameters")).length){const e=Array.from(t.getElementsByTagName("AdParameters"));for(const t of e)try{const e=JSON.parse(t.textContent.trim()),n=null!=(u=null==e?void 0:e.videos)&&u.length?null==(d=null==e?void 0:e.videos[0])?void 0:d.url:"";await r(n)&&h.children.push(_objectSpread({tagType:"inLine"},g))}catch(e){console.error("Error parsing media file URL:",e)}}}return h}async function r(e){if(!e)return!1;try{const t=await fetch(e);if(!t.ok||-1===t.headers.get("content-type").indexOf("video"))return!1;const n=document.createElement("video");return n.src=e,""!==await n.canPlayType(t.headers.get("content-type"))}catch(e){return console.error("Failed to load media file:",e),!1}}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=[...arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],e.data];return Array.isArray(e.children)&&e.children.length&&e.children.forEach(e=>a(e,t,n)),"inLine"===e.tagType&&t.push(_objectSpread(_objectSpread({},e),{},{wrappers:n.filter(Boolean)})),t}e.setCTAFromVast=(t,n)=>{if(e.displayOptions.vastOptions.adCTATextVast&&t){const i=e.extractNodeDataByTagName(t,"MobileText"),r=e.extractNodeDataByTagName(t,"PCText"),a=e.extractNodeDataByTagName(t,"DisplayUrl")||e.extractNodeDataByTagName(t,"Link"),o=e.extractNodeDataByTagName(t,"Tracking"),s=window.matchMedia("(max-width: 768px)").matches;(r||i)&&o&&(n.titleCTA={text:s?i||r:r||i,link:a||null,tracking:o})}},e.getClickThroughUrlFromLinear=t=>{const n=t.getElementsByTagName("VideoClicks");if(n.length){const t=n[0].getElementsByTagName("ClickThrough");if(t.length)return e.extractNodeData(t[0])}return!1},e.getVastAdTagUriFromWrapper=t=>{const n=t.getElementsByTagName("Wrapper");if(typeof n<"u"&&n.length){const t=n[0].getElementsByTagName("VASTAdTagURI");if(t.length)return e.extractNodeData(t[0])}return!1},e.hasInLine=e=>{const t=e.getElementsByTagName("InLine");return typeof t<"u"&&t.length},e.hasVastAdTagUri=e=>{const t=e.getElementsByTagName("VASTAdTagURI");return typeof t<"u"&&t.length},e.getClickThroughUrlFromNonLinear=t=>{let n="";if(t.getElementsByTagName("NonLinear").length){const i=t.getElementsByTagName("NonLinearClickThrough");i.length&&(n=e.extractNodeData(i[0]))}return n},e.getTrackingFromLinear=e=>{const t=e.getElementsByTagName("TrackingEvents");return t.length?t[0].getElementsByTagName("Tracking"):[]},e.getDurationFromLinear=t=>{const n=t.getElementsByTagName("Duration");if(n.length&&typeof n[0].childNodes[0]<"u"){const t=e.extractNodeData(n[0]);return e.convertTimeStringToSeconds(t)}return!1},e.getDurationFromNonLinear=t=>{let n=0;const i=t.getElementsByTagName("NonLinear");return i.length&&typeof i[0].getAttribute("minSuggestedDuration")<"u"&&(n=e.convertTimeStringToSeconds(i[0].getAttribute("minSuggestedDuration"))),n},e.getDimensionFromNonLinear=e=>{const t={width:null,height:null},n=e.getElementsByTagName("NonLinear");return n.length&&(typeof n[0].getAttribute("width")<"u"&&(t.width=n[0].getAttribute("width")),typeof n[0].getAttribute("height")<"u"&&(t.height=n[0].getAttribute("height"))),t},e.getCreativeTypeFromStaticResources=e=>{let t="";const n=e.getElementsByTagName("NonLinear");return n.length&&typeof n[0].childNodes[0]<"u"&&(t=n[0].getElementsByTagName("StaticResource")[0].getAttribute("creativeType")),t.toLowerCase()},e.getMediaFilesFromLinear=e=>{const t=e.getElementsByTagName("MediaFiles");return t.length?t[0].getElementsByTagName("MediaFile"):[]},e.getStaticResourcesFromNonLinear=e=>{let t=[];const n=e.getElementsByTagName("NonLinear");return n.length&&(t=n[0].getElementsByTagName("StaticResource")),t},e.extractNodeDataByTagName=(t,n)=>{const i=t.getElementsByTagName(n);return i&&i.length?e.extractNodeData(i[0]):null},e.extractNodeData=e=>{let t="";for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];8===i.nodeType||3===i.nodeType&&/^\s*$/.test(i.nodeValue)||(t+=i.nodeValue)}return t.replace(/(^\s+|\s+$)/g,"")},e.getAdParametersFromLinear=t=>{const n=t.getElementsByTagName("AdParameters");let i=null;return n.length&&(i=e.extractNodeData(n[0])),i},e.getMediaFileListFromLinear=t=>{const n=[],i=e.getMediaFilesFromLinear(t);if(!i.length)return n;for(let t=0;t<i.length;t++){let r=i[t].getAttribute("mediaType");r||(r="2D"),n.push({src:e.extractNodeData(i[t]),type:i[t].getAttribute("type"),apiFramework:i[t].getAttribute("apiFramework"),codec:i[t].getAttribute("codec"),id:i[t].getAttribute("codec"),fileSize:i[t].getAttribute("fileSize"),delivery:i[t].getAttribute("delivery"),width:i[t].getAttribute("width"),height:i[t].getAttribute("height"),mediaType:r.toLowerCase()})}return n},e.getIconClickThroughFromLinear=t=>{const n=t.getElementsByTagName("IconClickThrough");return n.length?e.extractNodeData(n[0]):""},e.getStaticResourceFromNonLinear=t=>{let n;const i=e.getStaticResourcesFromNonLinear(t);for(let t=0;t<i.length;t++)if(i[t].getAttribute("type")||(n=e.extractNodeData(i[t])),i[t].getAttribute("type")===e.displayOptions.staticResource)return e.extractNodeData(i[t]);return n},e.registerTrackingEvents=(t,n)=>{const i=e.getTrackingFromLinear(t);let r="",a=0;for(let t=0;t<i.length;t++)switch(r=i[t].getAttribute("event"),r){case"start":case"firstQuartile":case"midpoint":case"thirdQuartile":case"complete":typeof n.tracking[r]>"u"&&(n.tracking[r]=[]),typeof n.stopTracking[r]>"u"&&(n.stopTracking[r]=[]),n.tracking[r].push(i[t].textContent.trim()),n.stopTracking[r]=!1;break;case"progress":typeof n.tracking[r]>"u"&&(n.tracking[r]=[]),a=e.convertTimeStringToSeconds(i[t].getAttribute("offset")),typeof n.tracking[r][a]>"u"&&(n.tracking[r][a]={elements:[],stopTracking:!1}),n.tracking[r][a].elements.push(i[t].textContent.trim())}},e.registerClickTracking=(e,t)=>{if(e&&e.length)for(let n=0;n<e.length;n++)""!==e[n]&&t.clicktracking.push(e[n])},e.registerViewableImpressionEvents=(t,n)=>{if(t.length)for(let i=0;i<t.length;i++){const r=e.extractNodeData(t[i]);n.viewImpression.push(r)}},e.registerImpressionEvents=(t,n)=>{if(t.length)for(let i=0;i<t.length;i++){const r=e.extractNodeData(t[i]);n.impression.push(r)}},e.registerErrorEvents=(e,t)=>{typeof e<"u"&&null!==e&&1===e.length&&1===e[0].childNodes.length&&(t.errorUrl=e[0].childNodes[0].nodeValue)},e.announceError=t=>{if(typeof e.vastOptions.errorUrl>"u"||!e.vastOptions.errorUrl)return;const n=typeof t<"u"?parseInt(t):900,i=e.vastOptions.errorUrl.replace("[ERRORCODE]",n);e.callUris([i])},e.getClickTrackingEvents=t=>{const n=[],i=t.getElementsByTagName("VideoClicks");if(!i.length)return;const r=i[0].getElementsByTagName("ClickTracking");if(r.length){for(let t=0;t<r.length;t++){const i=e.extractNodeData(r[t]);n.push(i)}return n}},e.getNonLinearClickTrackingEvents=t=>{const n=[];if(!t.getElementsByTagName("NonLinear").length)return;const i=t.getElementsByTagName("NonLinearClickTracking");if(i.length){for(let t=0;t<i.length;t++){const r=e.extractNodeData(i[t]);n.push(r)}return n}},e.callUris=e=>{for(let t=0;t<e.length;t++)(new Image).src=e[t]},e.recalculateAdDimensions=()=>{const t=e.domRef.player,n=e.domRef.wrapper.querySelector(".vast_clickthrough_layer");n&&(n.style.width=t.offsetWidth+"px",n.style.height=t.offsetHeight+"px");const i=e.checkFullscreenSupport(),r=e.domRef.wrapper.querySelector(".fluid_control_fullscreen"),a=e.domRef.wrapper.querySelector(".context_option_fullscreen");if(i)null===document[i.isFullscreen]?e.fullscreenOff(r,a):e.fullscreenOn(r,a);else{const t=e.domRef.wrapper;-1!==t.className.search(/\bpseudo_fullscreen\b/g)?(t.className+=" pseudo_fullscreen",e.fullscreenOn(r,a)):(t.className=t.className.replace(/\bpseudo_fullscreen\b/g,""),e.fullscreenOff(r,a))}},e.prepareVast=t=>{let n=e.findRoll(t);for(let t=0;t<n.length;t++){const i=n[t];!0!==e.rollsById[i].vastLoaded&&!0!==e.rollsById[i].error&&e.processVastWithRetries(e.rollsById[i])}},e.playMainVideoWhenVastFails=t=>{e.debugMessage("playMainVideoWhenVastFails called"),e.domRef.player.removeEventListener("loadedmetadata",e.switchPlayerToVastMode),e.domRef.player.pause(),e.toggleLoader(!1),e.displayOptions.vastOptions.vastAdvanced.noVastVideoCallback(),!e.vastOptions||typeof e.vastOptions.errorUrl>"u"?e.announceLocalError(t):e.announceError(t),e.switchToMainVideo()},e.switchPlayerToVastMode=()=>{},e.processVastWithRetries=t=>{let n=t.vastTag;const i=t.id;e.domRef.player.addEventListener("adId_"+i,e[t.roll]);const r=function(a,o){if(a&&Array.isArray(o)&&!e.displayOptions.vastOptions.allowVPAID&&o.some(e=>e.vpaid)&&(o=o.filter(e=>!0!==e.vpaid),e.announceLocalError("103","VPAID not allowed, so skipping this VAST tag.")),a&&Array.isArray(o)&&o.length){e.adPool[i]=[],o.forEach((t,n)=>{if(t.id=i+"_AD"+n,t.rollListId=i,"linear"===t.adType){typeof t.iconClick<"u"&&null!==t.iconClick&&t.iconClick.length&&(t.landingPage=t.iconClick);const n=e.getSupportedMediaFileObject(t.mediaFileList);n&&(t.mediaType=n.mediaType)}if(t.adType=t.adType?t.adType:"unknown",e.adPool[i].push(Object.assign({},t)),e.hasTitle()){e.domRef.wrapper.querySelector(".fp_title").style.display="none"}e.rollsById[i].ads.push(t)}),e.rollsById[i].vastLoaded=!0;const t=document.createEvent("Event");t.initEvent("adId_"+i,!1,!0),e.domRef.player.dispatchEvent(t),e.displayOptions.vastOptions.vastAdvanced.vastLoadedCallback()}else e.announceLocalError("101"),t.hasOwnProperty("fallbackVastTags")&&t.fallbackVastTags.length>0?(n=t.fallbackVastTags.shift(),e.processUrl(n,r,i)):("preRoll"===t.roll&&e.preRollFail(t),e.rollsById[i].error=!0)};e.processUrl(n,r,i)},e.processUrl=(t,n,i)=>{e.resolveVastTag(t,0,{tracking:[],stopTracking:[],impression:[],viewImpression:[],clicktracking:[],vastLoaded:!1},n,i)},e.resolveVastTag=(t,n,r,o,s)=>{if(!t||""===t)return o(!1);i(t,e.displayOptions.vastOptions.maxAllowedVastTagRedirects).then(t=>{try{const n=t.children.some(e=>"wrapper"===e.tagType&&e.fallbackOnNoAd&&(!/"tagType":"ad"/.test(JSON.stringify(e))||e.httpError));n&&e.debugMessage("Error on VAST Wrapper, triggering fallbackOnNoAd. Ad tree:",t),t=a(t).map(t=>function(t){var n,i,r,a,o,s,l,c;const u=t.data;if(!u)return;const d=Array.from(u.getElementsByTagName("Creative"));if(d.length)for(let h=0;h<d.length;h++){const f=d[h];try{if("linear"===t.adType){const d=f.getElementsByTagName("Linear")[0];if(!e.hasVastAdTagUri(u)&&e.hasInLine(u))if(t.adFinished=!1,t.vpaid=!1,t.skipoffset=e.convertTimeStringToSeconds(d.getAttribute("skipoffset")),t.clickthroughUrl=e.getClickThroughUrlFromLinear(d),t.duration=e.getDurationFromLinear(d),t.mediaFileList=e.getMediaFileListFromLinear(d),t.adParameters=e.getAdParametersFromLinear(d),t.iconClick=t.iconClick||e.getIconClickThroughFromLinear(d),null!=(n=null==t?void 0:t.mediaFileList)&&n.length&&"VPAID"===(null==(i=t.mediaFileList[0])?void 0:i.apiFramework))t.vpaid=!0;else if((null==(r=null==t?void 0:t.mediaFileList)||!r.length)&&null!=t&&t.adParameters){try{const e=JSON.parse(null==(a=null==t?void 0:t.adParameters)?void 0:a.trim());e&&(t.mediaFileList=[{src:null!=(o=null==e?void 0:e.videos)&&o.length?null==(s=null==e?void 0:e.videos[0])?void 0:s.url:"",type:null!=(l=null==e?void 0:e.videos)&&l.length?null==(c=null==e?void 0:e.videos[0])?void 0:c.mimetype:""}])}catch(e){console.error("Error parsing media file URL:",e)}t.adParameters=null}}if("nonLinear"===t.adType){const n=f.getElementsByTagName("NonLinearAds")[0];!e.hasVastAdTagUri(u)&&e.hasInLine(u)&&(t.vpaid=!1,t.clickthroughUrl=e.getClickThroughUrlFromNonLinear(n),t.duration=e.getDurationFromNonLinear(n),t.dimension=e.getDimensionFromNonLinear(n),t.staticResource=e.getStaticResourceFromNonLinear(n),t.creativeType=e.getCreativeTypeFromStaticResources(n),t.adParameters=e.getAdParametersFromLinear(n),t.adParameters&&(t.vpaid=!0))}break}catch(e){f.firstElementChild&&!("Linear"===f.firstElementChild.tagName||"NonLinearAds"===f.firstElementChild.tagName)&&console.warn("Skipping "+f.firstElementChild.tagName+", this might not be supported yet."),console.error(e)}}return t}(function(t,n){const i=_objectSpread(_objectSpread({},t),JSON.parse(JSON.stringify(n)));return i.adType=(i.data.getElementsByTagName("Linear").length?"linear":i.data.getElementsByTagName("NonLinearAds").length&&"nonLinear")||"unknown",[...i.wrappers||[],i.data].filter(Boolean).forEach(t=>{const n=t.getElementsByTagName("Impression");null!==n&&e.registerImpressionEvents(n,i);const r=t.getElementsByTagName("Viewable");null!==r&&e.registerViewableImpressionEvents(r,i);const a=t.getElementsByTagName("Error");null!==a&&e.registerErrorEvents(a,i);const[o]=t.getElementsByTagName("TitleCTA");o&&e.setCTAFromVast(o,i),e.registerTrackingEvents(t,i);const s="linear"===i.adType?e.getClickTrackingEvents(t):e.getNonLinearClickTrackingEvents(t);e.registerClickTracking(s,i)}),i.sequence=i.data.attributes.sequence?Number(i.data.attributes.sequence.value):null,i.played=!1,i}(t,r)));const i=function(t,n,i,r){const{adPod:a}=t.filter(e=>!!e.sequence).sort((e,t)=>e.sequence-t.sequence).reduce((e,t)=>(e.adPod.length<i&&e.totalDuration+t.duration<=n&&e.adPod.push(t),e),{adPod:[],totalDuration:0}),o=t.filter(e=>!e.sequence&&e.duration<n),s=a.map(e=>e.adType).slice(0,-1).every(e=>"linear"===e);return a.length>0&&!r&&s?(e.debugMessage("Playing valid adPod",a),a):(e.debugMessage("Trying to play single ad, adBuffet:",o),o.length>0?[o[0]]:[])}(t,e.rollsById[s].maxTotalDuration||Number.MAX_SAFE_INTEGER,e.rollsById[s].maxTotalQuantity||Number.MAX_SAFE_INTEGER,n);i&&i.length?o(!0,i):o(!1)}catch(e){o(!1)}}).catch(()=>o(!1))},e.setVastList=()=>{const t={},n={preRoll:[],postRoll:[],midRoll:[],onPauseRoll:[]},i={id:null,roll:null,vastLoaded:!1,error:!1,adText:null,adTextPosition:null};let r=0;const a=function(e){let t=!1;return"midRoll"===e.roll&&typeof e.timer>"u"&&(t=!0),t},o=function(t){let n=!1;return t.vastTag||(e.announceLocalError(102,'"vastTag" property is missing from adList.'),n=!0),t.roll||(e.announceLocalError(102,'"roll" is missing from adList.'),n=!0),-1===e.availableRolls.indexOf(t.roll)&&(e.announceLocalError(102,"Only "+e.availableRolls.join(",")+" rolls are supported."),n=!0),t.size&&-1===e.supportedNonLinearAd.indexOf(t.size)&&(e.announceLocalError(102,"Only "+e.supportedNonLinearAd.join(",")+" size are supported."),n=!0),n};if(e.displayOptions.vastOptions.hasOwnProperty("adList"))for(let n in e.displayOptions.vastOptions.adList){let s=e.displayOptions.vastOptions.adList[n];if(o(s)){e.announceLocalError(102,"Wrong adList parameters.");continue}const l="ID"+r;t[l]=Object.assign({},i),t[l]=Object.assign(t[l],e.displayOptions.vastOptions.adList[n]),"midRoll"===s.roll&&(t[l].error=a("midRoll")),t[l].id=l,t[l].ads=[],r++}Object.keys(t).map(function(e){switch(t[e].roll.toLowerCase()){case"preRoll".toLowerCase():n.preRoll.push(t[e]);break;case"midRoll".toLowerCase():n.midRoll.push(t[e]);break;case"postRoll".toLowerCase():n.postRoll.push(t[e]);break;case"onPauseRoll".toLowerCase():n.onPauseRoll.push(t[e]);break;default:console.error("".concat(t[e].roll.toLowerCase()," is not a recognized roll"))}}),e.adGroupedByRolls=n,e.rollsById=t},e.onVastAdEnded=t=>{t&&t.stopImmediatePropagation(),e.vastOptions.adFinished=!0,e.deleteVastAdElements(),e.checkForNextAd()},e.vastLogoBehaviour=t=>{if(!e.displayOptions.layoutControls.logo.showOverAds){const n=e.domRef.wrapper.querySelector(".logo_holder");if(!n)return;n.style.display=t?"none":"inline"}},e.deleteVastAdElements=()=>{e.removeClickthrough(),e.removeSkipButton(),e.removeAdCountdown(),e.removeAdPlayingText(),e.removeCTAButton(),e.vastLogoBehaviour(!1)}},function(e,t){function n(){e.vrViewer.onWindowResize()}e.createCardboardJoystickButton=t=>{const n=e.domRef.wrapper.querySelector(".fluid_vr_joystick_panel"),i=document.createElement("div");return i.className="fluid_vr_button fluid_vr_joystick_"+t,n.appendChild(i),i},e.cardboardRotateLeftRight=t=>{const n=e.vrROTATION_POSITION,i=-e.vrROTATION_POSITION,r={val:t<1?n:i};new TWEEN.Tween(r).to({val:0},e.vrROTATION_SPEED).easing(TWEEN.Easing.Quadratic.InOut).onUpdate(function(){e.vrViewer.OrbitControls.rotateLeft(r.val)}).start()},e.cardboardRotateUpDown=t=>{const n=e.vrROTATION_POSITION,i=-e.vrROTATION_POSITION,r={val:t<1?n:i};new TWEEN.Tween(r).to({val:0},e.vrROTATION_SPEED).easing(TWEEN.Easing.Quadratic.InOut).onUpdate(function(){e.vrViewer.OrbitControls.rotateUp(r.val)}).start()},e.createCardboardJoystick=()=>{const t=e.domRef.wrapper.querySelector(".fluid_vr_container"),n=document.createElement("div");n.className="fluid_vr_joystick_panel",t.appendChild(n);const i=e.createCardboardJoystickButton("up"),r=e.createCardboardJoystickButton("left"),a=e.createCardboardJoystickButton("right"),o=e.createCardboardJoystickButton("down"),s=e.createCardboardJoystickButton("zoomdefault"),l=e.createCardboardJoystickButton("zoomin"),c=e.createCardboardJoystickButton("zoomout");i.addEventListener("click",function(){e.cardboardRotateUpDown(1)}),o.addEventListener("click",function(){e.cardboardRotateUpDown(0)}),a.addEventListener("click",function(){e.cardboardRotateLeftRight(0)}),r.addEventListener("click",function(){e.cardboardRotateLeftRight(1)}),s.addEventListener("click",function(){e.vrViewer.camera.fov=60,e.vrViewer.camera.updateProjectionMatrix()}),c.addEventListener("click",function(){e.vrViewer.camera.fov*=1.1,e.vrViewer.camera.updateProjectionMatrix()}),l.addEventListener("click",function(){e.vrViewer.camera.fov*=.9,e.vrViewer.camera.updateProjectionMatrix()})},e.cardBoardResize=()=>{e.domRef.player.removeEventListener("theatreModeOn",n),e.domRef.player.addEventListener("theatreModeOn",n),e.domRef.player.removeEventListener("theatreModeOff",n),e.domRef.player.addEventListener("theatreModeOff",n)},e.cardBoardSwitchToNormal=()=>{const t=e.domRef.wrapper.querySelector(".fluid_vr_joystick_panel"),n=e.domRef.player;let i=n.parentNode.getElementsByClassName("fluid_controls_container");e.vrViewer.enableEffect(PANOLENS.MODES.NORMAL),e.vrViewer.onWindowResize(),e.vrMode=!1;const r=Array.from(i),a=r.findIndex(e=>e.classList.contains("fluid_vr2_controls_container"));if(-1!==a){const e=i[a],t=r.find((e,t)=>t!==a);n.parentNode.removeChild(e),null==t||t.classList.remove("fluid_vr_controls_container")}e.displayOptions.layoutControls.showCardBoardJoystick&&t&&(t.style.display="block");e.domRef.wrapper.querySelector(".fluid_control_volume_container").style.display="block";const o=e.domRef.wrapper.querySelector(".ad_countdown"),s=e.domRef.wrapper.querySelector(".fluid_ad_cta"),l=e.domRef.wrapper.querySelector(".fluid_ad_playing"),c=e.domRef.wrapper.querySelector(".skip_button");o&&(o.style.display="block"),s&&(s.style.display="block"),l&&(l.style.display="block"),c&&(c.style.display="block")},e.cardBoardHideDefaultControls=()=>{const t=e.domRef.wrapper.querySelector(".fluid_vr_joystick_panel"),n=e.domRef.wrapper.querySelector(".fluid_initial_play"),i=e.domRef.wrapper.querySelector(".fluid_control_volume_container");e.displayOptions.layoutControls.showCardBoardJoystick&&t&&(t.style.display="none"),n&&(e.domRef.wrapper.querySelector(".fluid_initial_play").style.display="none",e.domRef.wrapper.querySelector(".fluid_initial_play_button_container").style.opacity="1"),i.style.display="none"},e.cardBoardCreateVRControls=()=>{const t=e.domRef.wrapper.querySelector(".fluid_controls_container").cloneNode(!0);t.removeAttribute("id"),t.querySelectorAll("*").forEach(function(e){e.removeAttribute("id")}),t.classList.add("fluid_vr2_controls_container"),e.domRef.player.parentNode.insertBefore(t,e.domRef.player.nextSibling),e.copyEvents(t)},e.cardBoardSwitchToVR=()=>{const t=e.domRef.wrapper.querySelector(".fluid_controls_container");e.vrViewer.enableEffect(PANOLENS.MODES.CARDBOARD),e.vrViewer.onWindowResize(),e.vrViewer.disableReticleControl(),e.vrMode=!0,t.classList.add("fluid_vr_controls_container"),e.cardBoardHideDefaultControls(),e.cardBoardCreateVRControls();const n=e.domRef.wrapper.querySelector(".ad_countdown"),i=e.domRef.wrapper.querySelector(".fluid_ad_cta"),r=e.domRef.wrapper.querySelector(".fluid_ad_playing"),a=e.domRef.wrapper.querySelector(".skip_button");n&&(n.style.display="none"),i&&(i.style.display="none"),r&&(r.style.display="none"),a&&(a.style.display="none")},e.cardBoardMoveTimeInfo=()=>{const t=e.domRef.wrapper.querySelector(".fluid_control_duration"),n=e.domRef.wrapper.querySelector(".fluid_controls_container");t.classList.add("cardboard_time"),n.appendChild(t),e.controlDurationUpdate=function(){const t=e.formatTime(e.domRef.player.currentTime),n=e.formatTime(e.currentVideoDuration),i=e.domRef.player.parentNode.getElementsByClassName("fluid_control_duration");let r="";if(e.isCurrentlyPlayingAd){r="<span class='ad_timer_prefix'>AD : </span>"+t+" / "+n;for(let e=0;e<i.length;e++)i[e].classList.add("ad_timer_prefix")}else{r=t+" / "+n;for(let e=0;e<i.length;e++)i[e].classList.remove("ad_timer_prefix")}for(let e=0;e<i.length;e++)i[e].innerHTML=r}},e.cardBoardAlterDefaultControls=()=>{e.cardBoardMoveTimeInfo()},e.createCardboardView=()=>{const t=document.createElement("div");t.className="fluid_vr_container",e.domRef.player.parentNode.insertBefore(t,e.domRef.player.nextSibling),PANOLENS.VideoPanorama.prototype.pauseVideo=function(){},PANOLENS.VideoPanorama.prototype.playVideo=function(){},e.vrPanorama=new PANOLENS.VideoPanorama("",{videoElement:e.domRef.player,autoplay:e.displayOptions.layoutControls.autoPlay,loop:!!e.displayOptions.layoutControls.loop}),e.vrViewer=new PANOLENS.Viewer({container:t,controlBar:!0,controlButtons:[],enableReticle:!1}),e.vrViewer.add(e.vrPanorama),e.vrViewer.enableEffect(PANOLENS.MODES.NORMAL),e.vrViewer.onWindowResize(),("Android"===e.getMobileOs().userOs||"iOS"===e.getMobileOs().userOs)&&e.vrViewer.enableControl(1),e.cardBoardAlterDefaultControls(),e.cardBoardResize(),e.vrViewer.initialCameraPosition=JSON.parse(JSON.stringify(e.vrViewer.camera.position)),e.displayOptions.layoutControls.showCardBoardJoystick&&("Android"===e.getMobileOs().userOs||"iOS"===e.getMobileOs().userOs||e.createCardboardJoystick(),e.vrViewer.OrbitControls.noZoom=!0),e.trackEvent(e.domRef.player.parentNode,"click",".fluid_control_cardboard",function(){e.vrMode?e.cardBoardSwitchToNormal():e.cardBoardSwitchToVR()})},e.createCardboard=()=>{e.displayOptions.layoutControls.showCardBoardView&&(e.domRef.wrapper.querySelector(".fluid_control_cardboard").style.display="inline-block",window.PANOLENS?e.createCardboardView():Promise.resolve().then(()=>oc).then(t=>{window.PANOLENS=t,e.createCardboardView()}))}},function(e,t){function n(t){const n=e.domRef.wrapper.querySelector(".fluid_control_subtitles");let i=!1;for(let e=0;e<n.children.length;e++)"block"===n.children[e].style.display&&(i=!0,n.children[e].style.display="none");i||e.openCloseSubtitlesSwitch()}function i(){e.renderSubtitles()}e.subtitleSizeLevels=[50,75,100,150,200],e.currentSubtitleSizeIndex=e.subtitleSizeLevels.indexOf(100),e.subtitleFetchParse=t=>{e.sendRequest(t.url,!1,e.displayOptions.vastOptions.vastTimeout,function(){const t=this;if(4===t.readyState&&200!==t.status||4!==t.readyState||200!==t.status)return;const n=t.responseText,i=new WebVTT.Parser(window,WebVTT.StringDecoder()),r=[];i.oncue=function(e){r.push(e)},i.onregion=function(e){},i.parse(n),i.flush(),e.subtitlesData=r})},e.createSubtitlesSwitch=()=>{const t="OFF";if(e.subtitlesData=[],!e.displayOptions.layoutControls.subtitlesEnabled)return void(e.domRef.wrapper.querySelector(".fluid_control_subtitles").style.display="none");const r=[];r.push({label:t,url:"na",lang:t});const a=e.domRef.player.querySelectorAll("track");[].forEach.call(a,function(e){"metadata"===e.kind&&e.src&&r.push({label:e.label,url:e.src,lang:e.srclang,default:e.default})}),e.subtitlesTracks=r;const o=e.domRef.wrapper.querySelector(".fluid_control_subtitles");o.style.display="inline-block";let s=!1;const l=document.createElement("div");l.className="fluid_subtitles_list",l.style.display="none",e.addSubtitleSizeControls(l,o);let c=!1;const u=!!e.subtitlesTracks.find(e=>e.default);e.subtitlesTracks.forEach(function(n){let i="";const r=e.displayOptions.layoutControls.subtitlesOnByDefault;(!c&&(r&&n.default||!u&&n.label!==t||1===e.subtitlesTracks.length)||!r&&n.label===t)&&(i="subtitle_selected",e.subtitleFetchParse(n),c=!0);const a=document.createElement("div");a.className="fluid_subtitle_list_item",a.innerHTML='<span class="subtitle_button_icon '+i+'"></span>'+n.label,a.addEventListener("click",function(n){n.stopPropagation();const i=this,r=e.domRef.wrapper.getElementsByClassName("subtitle_button_icon");for(let e=0;e<r.length;e++)r[e].className=r[e].className.replace("subtitle_selected","");i.firstChild.className+=" subtitle_selected",e.subtitlesTracks.forEach(function(n){n.label===i.innerText.replace(/(\r\n\t|\n|\r\t)/gm,"")&&(n.label===t?e.subtitlesData=[]:e.subtitleFetchParse(n))}),e.openCloseSubtitlesSwitch()}),l.appendChild(a),s=!0}),s?(o.appendChild(l),o.removeEventListener("click",n),o.addEventListener("click",n)):e.domRef.wrapper.querySelector(".fluid_control_subtitles").style.display="none",e.domRef.player.removeEventListener("timeupdate",i),e.domRef.player.addEventListener("timeupdate",i)},e.addSubtitleSizeControls=(t,n)=>{const i=e.createSubtitleSizeButton(),r=e.createSubtitleSizeMenu();r.style.display="none",t.appendChild(i),n.appendChild(r)},e.renderSubtitles=()=>{const t=e.domRef.player;let n=Math.floor(t.currentTime),i=!1,r=e.domRef.wrapper.querySelector(".fluid_subtitles_container");if(e.isCurrentlyPlayingAd)r.innerHTML="";else{for(let t=0;t<e.subtitlesData.length;t++)n>=e.subtitlesData[t].startTime&&n<=e.subtitlesData[t].endTime&&(r.innerHTML="",r.appendChild(WebVTT.convertCueToDOMTree(window,e.subtitlesData[t].text)),i=!0);i||(r.innerHTML="")}},e.openCloseSubtitlesSwitch=()=>{const t=e.domRef.wrapper.querySelector(".fluid_subtitles_list");if(e.isCurrentlyPlayingAd)t.style.display="none";else{if("none"===t.style.display){t.style.display="block";const e=function(n){t.removeEventListener("mouseleave",e),t.style.display="none"};t.addEventListener("mouseleave",e)}else t.style.display="none";e.setMenusMaxHeight()}},e.createSubtitles=()=>{const t=document.createElement("div");t.className="fluid_subtitles_container",e.domRef.player.parentNode.insertBefore(t,e.domRef.player.nextSibling),e.displayOptions.layoutControls.subtitlesEnabled&&Promise.resolve().then(()=>Xc).then(t=>{window.WebVTT=t.WebVTT||t.default.WebVTT,e.createSubtitlesSwitch()})},e.resizeSubtitles=t=>{const n=t/100;e.domRef.wrapper.querySelector(".fluid_subtitles_container").style.fontSize="".concat(n,"em")},e.adjustSubtitleSizeByOperation=t=>{if("+"===t&&e.currentSubtitleSizeIndex<e.subtitleSizeLevels.length-1)e.currentSubtitleSizeIndex++;else{if(!("-"===t&&e.currentSubtitleSizeIndex>0))return;e.currentSubtitleSizeIndex--}const n=e.subtitleSizeLevels[e.currentSubtitleSizeIndex];e.resizeSubtitles(n),e.updateSubtitleSizeMenuSelection()},e.updateSubtitleSizeMenuSelection=()=>{const t=e.domRef.wrapper.querySelector(".fluid_subtitle_size_menu");if(!t)return;const n=t.querySelectorAll(".subtitle_button_icon");for(let e=0;e<n.length;e++)n[e].className=n[e].className.replace("subtitle_size_selected","");const i=Array.from(t.querySelectorAll(".fluid_subtitle_size_button")).filter(e=>!e.classList.contains("fluid_sub_menu_button"));if(i[e.currentSubtitleSizeIndex]){const t=i[e.currentSubtitleSizeIndex].querySelector(".subtitle_button_icon");t&&(t.className+=" subtitle_size_selected")}},e.createSubtitleSizeButton=()=>{const t=document.createElement("div");return t.className="fluid_subtitle_list_item fluid_sub_menu_button arrow-right",t.innerHTML="Font Size",t.addEventListener("click",t=>{t.stopPropagation(),e.toggleSubtitleSizeMenu(),e.openCloseSubtitlesSwitch()}),t},e.createSubtitleSizeMenu=()=>{const t=document.createElement("div");t.className="fluid_subtitle_size_menu";const n=e.createBackButtonForSubtitleSizeMenu();return t.appendChild(n),e.subtitleSizeLevels.forEach((n,i)=>{const r=document.createElement("div");r.className="fluid_subtitle_size_button";const a=100===n;r.innerHTML='<span class="subtitle_button_icon '+(a?"subtitle_size_selected":"")+'"></span>'+n+"%",r.addEventListener("click",t=>{t.stopPropagation(),e.toggleSubtitleSizeMenu(),e.resizeSubtitles(n),e.currentSubtitleSizeIndex=i,e.updateSubtitleSizeMenuSelection()}),t.appendChild(r)}),t},e.createBackButtonForSubtitleSizeMenu=()=>{const t=document.createElement("div");return t.className="fluid_subtitle_size_button fluid_sub_menu_button arrow-left",t.innerHTML="Font Size",t.addEventListener("click",t=>{t.stopPropagation(),e.toggleSubtitleSizeMenu(),e.openCloseSubtitlesSwitch()}),t},e.toggleSubtitleSizeMenu=()=>{const t=e.domRef.wrapper.querySelector(".fluid_subtitle_size_menu"),n=function(e){t.removeEventListener("mouseleave",n),t.style.display="none"};"block"===t.style.display?(t.style.display="none",t.removeEventListener("mouseleave",n)):(t.style.display="block",t.addEventListener("mouseleave",n)),e.setMenusMaxHeight()},e.setMenusMaxHeight=()=>{const t=e.domRef.wrapper.offsetHeight-e.domRef.wrapper.querySelector(".fluid_controls_container").offsetHeight,n=e.domRef.wrapper.querySelector(".fluid_subtitle_size_menu"),i=e.domRef.wrapper.querySelector(".fluid_subtitles_list");n.style.maxHeight="".concat(t,"px"),i.style.maxHeight="".concat(t,"px")},e.repositionSubtitlesContainer=t=>{e.domRef.wrapper.querySelector(".fluid_subtitles_container").style.bottom=t}},function(e,t){e.setupThumbnailPreviewVtt=()=>{e.sendRequest(e.displayOptions.layoutControls.timelinePreview.file,!1,e.displayOptions.vastOptions.vastTimeout,function(){const t=this;if(4===t.readyState&&200!==t.status||4!==t.readyState||200!==t.status)return;const n=t.responseText,i=(new window.WebVTTParser).parse(n);e.timelinePreviewData=function(t){if(!(typeof t.cues<"u"&&t.cues.length))return[];const n=[];let i=null,r=null;for(let a=0;a<t.cues.length;a++){i=t.cues[a].text.split("#");let o,s=0,l=0,c=122.5,u=69;2===i.length&&0===i[1].indexOf("xywh=")&&(r=i[1].substring(5),r=r.split(","),4===r.length&&(e.displayOptions.layoutControls.timelinePreview.spriteImage=!0,s=parseInt(r[0]),l=parseInt(r[1]),c=parseInt(r[2]),u=parseInt(r[3]))),e.displayOptions.layoutControls.timelinePreview.spriteRelativePath&&-1!==e.displayOptions.layoutControls.timelinePreview.file.indexOf("/")&&(typeof e.displayOptions.layoutControls.timelinePreview.sprite>"u"||""===e.displayOptions.layoutControls.timelinePreview.sprite)?(o=e.displayOptions.layoutControls.timelinePreview.file.substring(0,e.displayOptions.layoutControls.timelinePreview.file.lastIndexOf("/")),o+="/"+i[0]):o=e.displayOptions.layoutControls.timelinePreview.sprite?e.displayOptions.layoutControls.timelinePreview.sprite:i[0],n.push({startTime:t.cues[a].startTime,endTime:t.cues[a].endTime,image:o,x:s,y:l,w:c,h:u})}return n}(i)})},e.generateTimelinePreviewTags=()=>{const t=e.domRef.wrapper.querySelector(".fluid_controls_progress_container"),n=document.createElement("div");n.className="fluid_timeline_preview_container",n.style.display="none",n.style.position="absolute",t.appendChild(n);const i=document.createElement("div");i.className="fluid_timeline_preview_container_shadow",i.style.position="absolute",i.style.display="none",i.style.opacity=1,t.appendChild(i)},e.getThumbnailCoordinates=t=>{if(e.timelinePreviewData.length)for(let n=0;n<e.timelinePreviewData.length;n++)if(t>=e.timelinePreviewData[n].startTime&&t<=e.timelinePreviewData[n].endTime)return e.timelinePreviewData[n];return!1},e.drawTimelinePreview=t=>{const n=e.domRef.wrapper.querySelector(".fluid_timeline_preview_container"),i=e.domRef.wrapper.querySelector(".fluid_timeline_preview_container_shadow"),r=e.domRef.wrapper.querySelector(".fluid_controls_progress_container"),a=r.clientWidth;if(e.isCurrentlyPlayingAd)return void("none"!==n.style.display&&(n.style.display="none"));const o=e.getEventOffsetX(t,r);let s=null;if(a){s=e.currentVideoDuration*o/a;const t=e.getThumbnailCoordinates(s);i.style.width=a+"px",i.style.display="block",!1!==t?(n.style.width=t.w+"px",n.style.height=t.h+"px",i.style.height=t.h+"px",n.style.background="url("+t.image+") no-repeat scroll -"+t.x+"px -"+t.y+"px",n.style.left=o-t.w/2+"px",n.style.display="block",e.displayOptions.layoutControls.timelinePreview.spriteImage||(n.style.backgroundSize="contain")):n.style.display="none"}},e.setupThumbnailPreview=()=>{let t=e.displayOptions.layoutControls.timelinePreview;if(!t||!t.type)return;let n="mousemove",i="mouseleave";if(e.mobileInfo.userOs&&(n="touchmove",i="touchend"),e.domRef.wrapper.querySelector(".fluid_controls_progress_container").addEventListener(n,e.drawTimelinePreview.bind(e),!1),e.domRef.wrapper.querySelector(".fluid_controls_progress_container").addEventListener(i,function(t){const n=e.domRef.wrapper.querySelector(".fluid_controls_progress_container");typeof t.clientX<"u"&&n.contains(document.elementFromPoint(t.clientX,t.clientY))||(e.domRef.wrapper.querySelector(".fluid_timeline_preview_container").style.display="none",e.domRef.wrapper.querySelector(".fluid_timeline_preview_container_shadow").style.display="none")},!1),e.generateTimelinePreviewTags(),"VTT"===t.type&&"string"==typeof t.file)Promise.resolve().then(()=>$c).then(t=>{window.WebVTTParser=t.default,e.setupThumbnailPreviewVtt()});else{if("static"!==t.type||"object"!=typeof t.frames)throw"Invalid thumbnail-preview - type must be VTT or static";t.spriteImage=!0,e.timelinePreviewData=t.frames}e.showTimeOnHover=!1}},function(e,t){const n="2.0";e.renderLinearAd=(t,i)=>{e.toggleLoader(!1),e.hideLiveIndicator(),e.isLiveStream=null,e.vastOptions=t,i&&e.backupMainVideoContentTime(t.rollListId);const r=()=>{if(e.adFinished)return void e.domRef.player.removeEventListener("timeupdate",r);const t=Math.floor(e.domRef.player.currentTime);0!==e.vastOptions.duration&&e.scheduleTrackingEvent(t,e.vastOptions.duration),t>=e.vastOptions.duration-1&&0!==e.vastOptions.duration&&(e.domRef.player.removeEventListener("timeupdate",r),e.adFinished=!0)};(t=>{e.switchPlayerToVpaidMode=t=>{e.debugMessage("starting function switchPlayerToVpaidMode");const i="fp_"+t.id+"_fluid_vpaid_iframe",r={};r.AdParameters=t.adParameters;const a=document.createElement("div");a.className="fluid_vpaid_slot",a.setAttribute("adListId",t.id),e.domRef.player.parentNode.insertBefore(a,i.nextSibling);const o={slot:a,videoSlot:e.domRef.player,videoSlotCanAutoPlay:!0},s=e.vpaidAdUnit.handshakeVersion(n);if(1===e.compareVersion(n,s))return t.error=!0,e.playMainVideoWhenVpaidFails(403),!1;!1!==e.vastOptions.skipoffset&&e.addSkipButton(),e.domRef.player.loop=!1,e.domRef.player.removeAttribute("controls"),e.vpaidCallbackListenersAttach();const l=e.fullscreenMode?"fullscreen":"normal",c=e.domRef.player.offsetWidth,u=e.domRef.player.offsetHeight;e.vpaidAdUnit.initAd(c,u,l,3e3,r,o);const d=e.domRef.player.parentNode.getElementsByClassName("fluid_controls_currentprogress");for(let t=0;t<d.length;t++)d[t].style.backgroundColor=e.displayOptions.layoutControls.adProgressColor;e.toggleLoader(!1),t.played=!0,e.adFinished=!1},e.switchPlayerToVastMode=()=>{if(e.vastOptions.duration||(e.vastOptions.duration="streaming"===i.delivery?1/0:e.domRef.player.duration),e.displayOptions.layoutControls.showCardBoardView)t.landingPage?e.addCTAButton(t.landingPage):e.addCTAButton(t.clickthroughUrl);else{let n=[void 0,!0].includes(e.displayOptions.vastOptions.adClickable);void 0!==e.rollsById[t.rollListId].adClickable&&(n=e.rollsById[t.rollListId].adClickable),n&&e.addClickthroughLayer(),e.addCTAButton(t.landingPage)}!1!==e.vastOptions.skipoffset&&e.addSkipButton(),e.domRef.player.loop=!1,e.addAdCountdown(),e.domRef.player.removeAttribute("controls"),e.vastLogoBehaviour(!0);const n=e.domRef.player.parentNode.getElementsByClassName("fluid_controls_currentprogress");for(let t=0;t<n.length;t++)n[t].style.backgroundColor=e.displayOptions.layoutControls.adProgressColor;if(e.rollsById[t.rollListId].adText||t.adText){const n=t.adText?t.adText:e.rollsById[t.rollListId].adText;e.addAdPlayingText(n)}if(e.positionTextElements(t),e.toggleLoader(!1),t.played=!0,e.adFinished=!1,e.domRef.player.play(),e.trackSingleEvent("impression"),e.domRef.player.removeEventListener("loadedmetadata",e.switchPlayerToVastMode),e.vrMode){const t=e.domRef.wrapper.querySelector(".ad_countdown"),n=e.domRef.wrapper.querySelector(".fluid_ad_cta"),i=e.domRef.wrapper.querySelector(".fluid_ad_playing"),r=e.domRef.wrapper.querySelector(".skip_button");t&&(t.style.display="none"),n&&(n.style.display="none"),i&&(i.style.display="none"),r&&(r.style.display="none")}},e.domRef.player.pause(),e.detachStreamers();const i=e.getSupportedMediaFileObject(e.vastOptions.mediaFileList);if(e.displayOptions.layoutControls.showCardBoardView&&"360"!==t.mediaType)return t.error=!0,e.playMainVideoWhenVastFails(403),!1;const r=e.vastOptions.vpaid;if(!r&&i.isUnsuportedHls)Promise.resolve().then(()=>a_).then(t=>{window.Hls=t.default;const n=new Hls({debug:typeof FP_DEBUG<"u"&&!0===FP_DEBUG,startPosition:0,p2pConfig:{logLevel:!1},enableWebVTT:!1,enableCEA708Captions:!1});n.attachMedia(e.domRef.player),n.loadSource(i.src),e.isCurrentlyPlayingAd=!0,n.once(Hls.Events.LEVEL_LOADED,function(t,n){e.isLiveStream=!!n.details.live,n.details.live?e.showLiveIndicator():e.hideLiveIndicator()}),e.hlsPlayer=n,e.domRef.player.addEventListener("loadedmetadata",e.switchPlayerToVastMode),e.domRef.player.addEventListener("ended",()=>{n.detachMedia(),n.destroy(),e.hlsPlayer=!1,e.onVastAdEnded()}),e.domRef.player.play()});else if(r)e.loadVpaid(t,i.src),e.displayOptions.vastOptions.showProgressbarMarkers&&e.hideAdMarkers();else{if(!1===i.src)return t.error=!0,e.playMainVideoWhenVastFails(403),!1;e.domRef.player.addEventListener("loadedmetadata",e.switchPlayerToVastMode),e.domRef.player.src=i.src,e.isCurrentlyPlayingAd=!0,e.displayOptions.vastOptions.showProgressbarMarkers&&e.hideAdMarkers(),e.domRef.player.load(),e.domRef.player.addEventListener("ended",e.onVastAdEnded)}})(t),e.domRef.player.addEventListener("timeupdate",r)},e.playRoll=t=>{const n=[];for(let e=0;e<t.length;e++)n.push(t[e]);if(e.temporaryAdPods=n,null!==e.vastOptions&&"linear"===e.vastOptions.adType.toLowerCase())return;const i=e.getNextAdPod();null!==i&&e.renderLinearAd(i,!0);const r=e.rollsById[i.rollListId].roll;e.currentMediaSourceType=r},e.backupMainVideoContentTime=t=>{switch(e.rollsById[t].roll){case"midRoll":e.domRef.player.mainVideoCurrentTime=e.domRef.player.currentTime-1;break;case"postRoll":e.domRef.player.mainVideoCurrentTime=e.mainVideoDuration,e.autoplayAfterAd=!1,e.domRef.player.currentTime=e.mainVideoDuration;break;case"preRoll":if(e.domRef.player.currentTime>0||e.domRef.player.safariPlayheadPosition){var n;const t=null!==(n=e.domRef.player.safariPlayheadPosition)&&void 0!==n?n:e.domRef.player.currentTime;e.domRef.player.mainVideoCurrentTime=t-1}}},e.getSupportedMediaFileObject=t=>{let n=null,i=!1;if(t.length)for(let r=0;r<t.length;r++){if("VPAID"===t[r].apiFramework){n=t[r],i=!0;break}{const a=e.getMediaFileTypeSupportLevel(t[r].type);if(("maybe"===a||"probably"===a)&&(n=t[r],i=!0),"probably"===a)break;"no"===a&&"streaming"===t[r].delivery&&("application/vnd.apple.mpegurl"===t[r].type||"application/x-mpegURL"===t[r].type)&&(n=t[r],n.isUnsuportedHls=!0,i=!0)}}return!1!==i&&n},e.getMediaFileTypeSupportLevel=e=>{if(null===e)return null;return document.createElement("video").canPlayType(e)||"no"},e.scheduleTrackingEvent=(t,n)=>{0===t&&(e.trackSingleEvent("start"),e.observe(),e.domRef.player.timeInView=0),e.domRef.player.inView&&(e.domRef.player.timeInView>2?e.trackSingleEvent("viewImpression"):e.domRef.player.timeInView+=t),typeof e.vastOptions.tracking.progress<"u"&&e.vastOptions.tracking.progress.length&&typeof e.vastOptions.tracking.progress[t]<"u"&&e.trackSingleEvent("progress",t),t===Math.floor(n/4)&&e.trackSingleEvent("firstQuartile"),t===Math.floor(n/2)&&e.trackSingleEvent("midpoint"),t===Math.floor(3*n/4)&&e.trackSingleEvent("thirdQuartile"),t>=n-1&&e.trackSingleEvent("complete")},e.trackSingleEvent=(t,n)=>{if(typeof e.vastOptions>"u"||null===e.vastOptions)return;let i=[];switch(i.length=0,t){case"start":case"firstQuartile":case"midpoint":case"thirdQuartile":case"complete":!1===e.vastOptions.stopTracking[t]&&(null!==e.vastOptions.tracking[t]&&(i=e.vastOptions.tracking[t]),e.vastOptions.stopTracking[t]=!0);break;case"progress":e.vastOptions.tracking.progress[n].elements.forEach(function(t,r){!1===e.vastOptions.tracking.progress[n].stopTracking&&e.vastOptions.tracking.progress[n].elements.length&&(i=e.vastOptions.tracking.progress[n].elements),e.vastOptions.tracking.progress[n].stopTracking=!0});break;case"impression":typeof e.vastOptions.impression<"u"&&null!==e.vastOptions.impression&&typeof e.vastOptions.impression.length<"u"&&(i=e.vastOptions.impression);break;case"viewImpression":if(!0===e.vastOptions.stopTracking.viewImpression)break;typeof e.vastOptions.viewImpression<"u"&&null!==e.vastOptions.viewImpression&&typeof e.vastOptions.viewImpression.length<"u"&&(i=e.vastOptions.viewImpression,e.vastOptions.stopTracking.viewImpression=!0)}e.callUris(i)},e.completeNonLinearStatic=t=>{e.closeNonLinear(t.id),!1===e.adFinished&&(e.adFinished=!0,e.trackSingleEvent("complete")),clearInterval(e.nonLinearTracking)},e.createNonLinearStatic=t=>{if(e.vastOptions=t,e.createBoard(t),!0===e.rollsById[t.rollListId].error||!0===t.error)return void e.announceLocalError(101);e.adFinished=!1;let n=!!e.rollsById[t.rollListId].nonLinearDuration&&e.rollsById[t.rollListId].nonLinearDuration;e.vastOptions.vpaid||(e.trackSingleEvent("start"),n=n||e.vastOptions.duration,e.nonLinearTracking=setInterval(function(){if(!0===e.adFinished)return;const t=Math.floor(e.domRef.player.currentTime);e.scheduleTrackingEvent(t,n),t>=n-1&&(e.adFinished=!0)},400),e.destructors.push(()=>clearInterval(e.nonLinearTracking)));const i=parseInt(e.getCurrentTime())+parseInt(n);e.scheduleTask({time:i,closeStaticAd:t,rollListId:t.rollListId})},e.createVpaidNonLinearBoard=t=>{e.loadVpaidNonlinearAssets=function(t){e.vastOptions=t,e.debugMessage("starting function switchPlayerToVpaidMode");const i=t.vAlign?t.vAlign:e.nonLinearVerticalAlign,r=t.vpaidNonLinearCloseButton?t.vpaidNonLinearCloseButton:e.vpaidNonLinearCloseButton,a="fp_"+t.id+"_fluid_vpaid_iframe",o={};o.AdParameters=t.adParameters;const s=document.createElement("div");s.id="fluid_vpaidNonLinear_"+t.id,s.className="fluid_vpaidNonLinear_"+i,s.className+=" fluid_vpaidNonLinear_ad",s.setAttribute("adListId",t.id);let l=Math.min(468,e.domRef.player.offsetWidth),c=Math.min(60,Math.floor(e.domRef.player.offsetHeight/4));if(typeof t.size<"u"){const e=t.size.split("x");l=e[0],c=e[1]}else t.dimension.width&&t.dimension.height&&(l=t.dimension.width,c=t.dimension.height);if(s.style.width="100%",s.style.height=c+"px",r){const n=document.createElement("div");n.className="fluid_vpaidNonLinear_frame",n.style.width=l+"px",n.style.height=c+"px",s.appendChild(n);const i=document.createElement("div");i.className="close_button",i.innerHTML="",i.title=e.displayOptions.layoutControls.closeButtonCaption;const[r]=t.id.split("_");i.onclick=function(t){if(e.hardStopVpaidAd(""),typeof t.stopImmediatePropagation<"u"&&t.stopImmediatePropagation(),e.adFinished=!0,"onPauseRoll"===e.rollsById[r].roll&&e.onPauseRollAdPods[0]){const t=e.onPauseRollAdPods[0];e.createBoard(t),e.currentOnPauseRollAd=e.onPauseRollAdPods[0],delete e.onPauseRollAdPods[0]}return!1},n.appendChild(i)}const u=document.createElement("iframe");u.id=e.videoPlayerId+"non_linear_vapid_slot_iframe",u.className="fluid_vpaid_nonlinear_slot_iframe",u.setAttribute("width",l+"px"),u.setAttribute("height",c+"px"),u.setAttribute("sandbox","allow-forms allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"),u.setAttribute("frameborder","0"),u.setAttribute("scrolling","no"),u.setAttribute("marginwidth","0"),u.setAttribute("marginheight","0"),s.appendChild(u),e.domRef.player.parentNode.insertBefore(s,a.nextSibling);const d=u.contentWindow.document.createElement("div");u.contentWindow.document.body.appendChild(d),e.vastOptions.slotIframe=u,e.vastOptions.slotFrame=undefined;const h={slot:d,videoSlot:e.domRef.player,videoSlotCanAutoPlay:!0};e.debugMessage(t);const f=e.vpaidAdUnit.handshakeVersion(n);if(1===e.compareVersion(n,f))return t.error=!0,e.playMainVideoWhenVpaidFails(403),!1;e.domRef.player.loop=!1,e.domRef.player.removeAttribute("controls"),e.vpaidCallbackListenersAttach();const p=e.fullscreenMode?"fullscreen":"normal";e.vpaidAdUnit.initAd(l,c,p,3e3,o,h),e.toggleLoader(!1),t.played=!0,e.adFinished=!1},e.loadVpaid(t,t.staticResource),e.debugMessage("create non linear vpaid")},e.createNonLinearBoard=t=>{t.played=!0;const n=document.createElement("div"),i=e.rollsById[t.rollListId].vAlign?e.rollsById[t.rollListId].vAlign:e.nonLinearVerticalAlign,r=new Image;r.src=t.staticResource,r.id="fluid_nonLinear_imgCreative_"+t.id+"_"+e.videoPlayerId,r.onerror=function(){e.rollsById[t.rollListId].error=!0,e.announceError(500)},r.onload=function(){const n=e.domRef.player.clientWidth;let i,a,o,s;if(typeof e.rollsById[t.rollListId].size<"u"?(i=e.rollsById[t.rollListId].size.split("x")[0],a=e.rollsById[t.rollListId].size.split("x")[1]):t.dimension.width&&t.dimension.height?(i=t.dimension.width,a=t.dimension.height):(i=r.width,a=r.height),i>n?(o=n-5,s=a*o/i):(o=i,s=a),"onPauseRoll"!==e.rollsById[t.rollListId].roll){const n=e.domRef.wrapper.querySelector("#fluid_nonLinear_"+t.id);n&&(n.style.display="")}const l=e.domRef.wrapper.querySelector("#"+r.id);l.width=o,l.height=s,e.trackSingleEvent("impression")},n.id="fluid_nonLinear_"+t.id,n.className="fluid_nonLinear_"+i,n.className+=" fluid_nonLinear_ad",n.innerHTML=r.outerHTML,n.style.display="none",n.onclick=function(){typeof t.clickthroughUrl<"u"&&window.open(t.clickthroughUrl),typeof t.clicktracking<"u"&&e.callUris([t.clicktracking])},typeof t.clickthroughUrl<"u"&&(n.style.cursor="pointer");const a=document.createElement("div");a.className="close_button",a.innerHTML="",a.title=e.displayOptions.layoutControls.closeButtonCaption;const o=t.rollListId;a.onclick=function(t){if(this.parentElement.remove(),typeof t.stopImmediatePropagation<"u"&&t.stopImmediatePropagation(),e.adFinished=!0,clearInterval(e.nonLinearTracking),"onPauseRoll"===e.rollsById[o].roll&&e.onPauseRollAdPods[0]){const t=e.onPauseRollAdPods[0];e.createBoard(t),e.currentOnPauseRollAd=e.onPauseRollAdPods[0],delete e.onPauseRollAdPods[0]}return!1},n.appendChild(a),e.domRef.player.parentNode.insertBefore(n,e.domRef.player.nextSibling)},e.createBoard=t=>{if(t.vpaid)e.hardStopVpaidAd(""),e.createVpaidNonLinearBoard(t);else{if(typeof t.staticResource>"u"||-1===e.supportedStaticTypes.indexOf(t.creativeType))return t.error=!0,void(!e.vastOptions||typeof e.vastOptions.errorUrl>"u"?e.announceLocalError(503):e.announceError(503));e.createNonLinearBoard(t)}},e.closeNonLinear=t=>{const n=e.domRef.wrapper.querySelector("#fluid_nonLinear_"+t+", #fluid_vpaidNonLinear_"+t);n&&n.remove()},e.rollGroupContainsLinear=t=>{let n=!1;for(let i=0;i<t.length;i++)if(e.rollsById[t[i].id].adType&&"linear"===e.rollsById[t[i].id].adType){n=!0;break}return n},e.rollGroupContainsNonlinear=t=>{let n=!1;for(let i=0;i<t.length;i++)if("nonlinear"===e.rollsById[t[i].id].adType.toLowerCase()){n=!0;break}return n},e.preRollFail=()=>{const t=e.preRollAdPodsLength;e.preRollVastResolved++,e.preRollVastResolved===t&&e.preRollAdsPlay()},e.preRollSuccess=()=>{const t=e.preRollAdPodsLength;e.preRollVastResolved++,e.preRollVastResolved===t&&e.preRollAdsPlay()},e.preRollAdsPlay=()=>{const t=e.preRollAdPods,n={linear:[],nonLinear:[]};e.firstPlayLaunched=!0;for(let i=0;i<t.length;i++)e.rollsById[t[i]].ads.forEach(t=>{!0!==t.played&&("linear"===t.adType&&n.linear.push(t),"nonLinear"===t.adType&&(n.nonLinear.push(t),e.scheduleTask({time:0,playRoll:"midRoll",rollListId:t.rollListId})))});n.linear.length>0?(e.toggleLoader(!1),e.playRoll(n.linear)):e.playMainVideoWhenVastFails(900)},e.preRoll=t=>{const n=t.vastObj;e.domRef.player.removeEventListener(t.type,e.preRoll);const i=[];i[0]=t.type.replace("adId_",""),!0!==e.rollsById[i[0]].played&&(e.preRollAdPods.push(i[0]),e.preRollSuccess(n))},e.createAdMarker=(t,n)=>{const i=e.domRef.wrapper.querySelector(".fluid_controls_ad_markers_holder"),r=document.createElement("div");r.className="fluid_controls_ad_marker fluid_controls_ad_marker_"+t,r.dataset.adListId=t,r.style.left=n/e.mainVideoDuration*100+"%",e.isCurrentlyPlayingAd&&(r.style.display="none"),i.appendChild(r)},e.hideAdMarker=t=>{const n=e.domRef.wrapper.querySelector("fluid_controls_ad_marker_"+t);n&&(n.style.display="none")},e.showAdMarkers=()=>{const t=e.domRef.wrapper.querySelector(".fluid_controls_ad_markers_holder").getElementsByClassName("fluid_controls_ad_marker");for(let n=0;n<t.length;++n){const i=t[n],r=i.dataset.adListId;!1===e.rollsById[r].played&&(i.style.display="")}},e.hideAdMarkers=()=>{const t=e.domRef.wrapper.querySelector(".fluid_controls_ad_markers_holder").getElementsByClassName("fluid_controls_ad_marker");for(let e=0;e<t.length;++e){t[e].style.display="none"}},e.midRoll=t=>{e.domRef.player.removeEventListener(t.type,e.midRoll);const n=t.type.replace("adId_","");if(!0===e.rollsById[n].played)return;let i=e.rollsById[n].timer;"string"==typeof i&&-1!==i.indexOf("%")&&(i=i.replace("%",""),i=Math.floor(e.mainVideoDuration/100*i)),e.displayOptions.vastOptions.showProgressbarMarkers&&"nonLinear"===e.rollsById[n].adType&&e.createAdMarker(n,i),e.scheduleTask({time:i,playRoll:"midRoll",rollListId:n})},e.postRoll=t=>{e.domRef.player.removeEventListener(t.type,e.postRoll);const n=t.type.replace("adId_","");e.scheduleTask({time:Math.floor(e.mainVideoDuration),playRoll:"postRoll",rollListId:n})},e.onPauseRoll=t=>{e.domRef.player.removeEventListener(t.type,e.onPauseRoll);const n=t.type.replace("adId_","");e.rollsById[n].ads.forEach(t=>{if("nonLinear"===t.adType){if(!0===e.rollsById[t.rollListId].error||!0===t.error)return void e.announceLocalError(101);if(e.domRef.wrapper.getElementsByClassName("fluid_nonLinear_ad")[0])e.onPauseRollAdPods.push(n);else{e.createBoard(t),e.currentOnPauseRollAd=n;let i="";for(const t of e.domRef.wrapper.children)t.id==="fluid_nonLinear_"+n&&(i=t);i&&(i.style.display="none")}}})},e.hasValidOnPauseAd=()=>{const t=e.findRoll("onPauseRoll");return 0!==t.length&&e.rollsById[t[0]]&&!1===e.rollsById[t[0]].error&&e.rollsById[t[0]].ads.length&&!0!==e.rollsById[t[0]].ads[0].error},e.toggleOnPauseAd=()=>{if(e.toggleLoader(!1),e.hasValidOnPauseAd()&&!e.isCurrentlyPlayingAd){const t=e.findRoll("onPauseRoll"),n=e.rollsById[t].ads[0];e.vastOptions=n;let i="";for(const t of e.domRef.wrapper.children)t.id==="fluid_nonLinear_"+n.id&&(i=t);i&&e.domRef.player.paused?setTimeout(function(){i.style.display="flex",n.played=!1,e.trackingOnPauseNonLinearAd(n,"start")},500):i&&!e.domRef.player.paused&&(i.style.display="none",e.adFinished=!0,e.trackingOnPauseNonLinearAd(n,"complete"))}},e.trackingOnPauseNonLinearAd=(t,n)=>{!0!==e.rollsById[t.rollListId].error&&!0!==t.error?(e.vastOptions=t,e.trackSingleEvent(n)):e.announceLocalError(101)},e.getLinearAdsFromKeyTime=t=>{const n=[];for(let i=0;i<t.length;i++)!1===e.rollsById[t[i].adListId].played&&n.push(t[i].adListId);return n},e.adKeytimePlay=t=>{if(!e.timerPool[t]||e.isCurrentlyPlayingAd)return;const n=e.timerPool[t].closeStaticAd.length,i=e.timerPool[t].linear.length,r=e.timerPool[t].nonLinear.length,a=e.timerPool[t].loadVast.length;if([n,i,r,a].every(e=>0===e))delete e.timerPool[t];else{if(n>0){for(let i=0;i<n;i++){const n=e.timerPool[t].closeStaticAd[i];!0===n.played&&e.completeNonLinearStatic(n)}e.timerPool[t].closeStaticAd=[]}if(i>0&&e.timerPool[t].linear.length>0)return e.playRoll(e.timerPool[t].linear),void(e.timerPool[t].linear=[]);if(r>0)for(let n=0;n<r;n++){const i=e.timerPool[t].nonLinear[n],r=i.rollListId;if(e.adPool[r],!1===i.played&&!e.displayOptions.layoutControls.showCardBoardView)return e.createNonLinearStatic(i),e.displayOptions.vastOptions.showProgressbarMarkers&&e.hideAdMarker(r),void e.timerPool[t].nonLinear.splice(n,1)}a>0&&(e.timerPool[t].loadVast.forEach(t=>{"postRoll"===t.roll&&t.voidPostRollTasks||("postRoll"===t.roll&&(t.voidPostRollTasks=!0),e.debugMessage("Handling on-demand VAST load for roll ".concat(t.id)),e.processVastWithRetries(t))}),e.timerPool[t].loadVast=[])}},e.adTimer=()=>{e.isTimer||(e.isTimer=!e.isTimer,e.timer=setInterval(function(){const t=Math.floor(e.getCurrentTime());e.adKeytimePlay(t)},800),e.destructors.push(()=>e.timer))},e.scheduleTask=t=>{t.time>e.mainVideoDuration||t.time<0||Number.isNaN(t.time)?console.warn("Scheduled task has invalid time",t.time,". Check your configuration."):(e.debugMessage("Scheduling task",t),e.timerPool.hasOwnProperty(t.time)||(e.timerPool[t.time]={linear:[],nonLinear:[],closeStaticAd:[],loadVast:[]}),t.rollListId&&e.rollsById[t.rollListId].ads.filter(e=>{let{adType:n}=e;return 0!==t.time||"linear"!==n}).forEach(n=>{t.hasOwnProperty("playRoll")&&"linear"===n.adType?e.timerPool[t.time].linear.push(n):t.hasOwnProperty("playRoll")&&"nonLinear"===n.adType?e.timerPool[t.time].nonLinear.push(n):t.hasOwnProperty("closeStaticAd")&&e.timerPool[t.time].closeStaticAd.push(n)}),t.loadVast&&e.timerPool[t.time].loadVast.push(t.roll))},e.scheduleOnDemandRolls=()=>{[...e.findRoll("midRoll")||[],...e.findRoll("postRoll")||[]].map(t=>e.rollsById[t]).filter(e=>!0!==e.vastLoaded&&!0!==e.error).forEach(t=>{if("midRoll"===t.roll){"string"==typeof t.timer&&(t.timer=Math.floor(e.mainVideoDuration/100*t.timer.replace("%","")),e.debugMessage("Replaced midRoll from percentage to timer value ".concat(t.timer," seconds")));const n=t.timer-e.displayOptions.vastOptions.vastTimeout/1e3;n<=Number(e.getCurrentTime())?(e.debugMessage("Loading Mid Roll VAST immediately as it needs to be played soon"),e.processVastWithRetries(t)):e.scheduleTask({loadVast:!0,time:n,roll:t})}else{const n=parseInt(e.mainVideoDuration),i=e.displayOptions.vastOptions.vastTimeout/1e3;t.voidPostRollTasks=!1;for(let r=1;r<=i;r++)e.scheduleTask({loadVast:!0,time:n-r,roll:t})}})},e.switchToMainVideo=()=>{e.debugMessage("starting main video"),e.hideLiveIndicator(),e.isLiveStream=null,e.domRef.player.src=e.originalSrc,e.currentMediaSourceType="source",e.initialiseStreamers(),e.hlsPlayer&&!e.hlsPlayer.config.autoStartLoad&&e.hlsPlayer.startLoad();const t=typeof e.domRef.player.mainVideoCurrentTime<"u"?Math.floor(e.domRef.player.mainVideoCurrentTime):0;if(e.domRef.player.hasOwnProperty("currentTime")&&(e.domRef.player.currentTime=t),e.displayOptions.layoutControls.loop&&(e.domRef.player.loop=!0),e.setCurrentTimeAndPlay(t,e.autoplayAfterAd),e.isCurrentlyPlayingAd=!1,e.deleteVastAdElements(),e.adFinished=!0,e.displayOptions.vastOptions.vastAdvanced.vastVideoEndedCallback(),e.vastOptions=null,e.setBuffering(),null!==e.domRef.wrapper.querySelector(".fluid_controls_progress_container")){const t=e.displayOptions.layoutControls.primaryColor?e.displayOptions.layoutControls.primaryColor:"white",n=e.domRef.player.parentNode.getElementsByClassName("fluid_controls_currentprogress");for(let e=0;e<n.length;e++)n[e].style.backgroundColor=t}if(e.domRef.player.removeEventListener("ended",e.onVastAdEnded),e.displayOptions.vastOptions.showProgressbarMarkers&&e.showAdMarkers(),e.hasTitle()){e.domRef.wrapper.querySelector(".fp_title").style.display="inline"}},e.getNextAdPod=()=>e.temporaryAdPods.length>0?e.temporaryAdPods.shift():null,e.checkForNextAd=()=>{const t=e.getNextAdPod();null===t?(e.switchToMainVideo(),e.vastOptions=null,e.adFinished=!0):(e.domRef.player.removeEventListener("ended",e.onVastAdEnded),e.isCurrentlyPlayingAd=!1,e.vastOptions=null,e.adFinished=!0,e.renderLinearAd(t,!1))},e.addSkipButton=()=>{const t=document.createElement("div");t.className="skip_button skip_button_disabled",e.vastOptions.skipoffset>0&&(t.innerHTML=e.displayOptions.vastOptions.skipButtonCaption.replace("[seconds]",e.vastOptions.skipoffset)),e.domRef.wrapper.appendChild(t),0===e.vastOptions.skipoffset&&e.decreaseSkipOffset(),e.domRef.player.addEventListener("timeupdate",e.decreaseSkipOffset,!1)},e.addAdCountdown=()=>{if(e.isCurrentlyPlayingAd&&e.hlsPlayer||e.currentVideoDuration===1/0)return;const t=e.domRef.wrapper,n=document.createElement("div"),i=e.pad(parseInt(e.currentVideoDuration/60))+":"+e.pad(parseInt(e.currentVideoDuration%60)),r=parseInt(i);n.className="ad_countdown",n.innerHTML="<span class='ad_timer_prefix'>Ad - </span>"+r,t.appendChild(n),e.domRef.player.addEventListener("timeupdate",e.decreaseAdCountdown,!1),t.addEventListener("mouseover",function(){n.style.display="none"},!1)},e.decreaseAdCountdown=function(){const t=parseInt(e.currentVideoDuration)-parseInt(e.domRef.player.currentTime),n=e.domRef.wrapper.querySelector(".ad_countdown");n&&isNaN(t)?n.parentNode.removeChild(n):n?n.innerHTML="<span class='ad_timer_prefix'>Ad - </span> "+e.pad(parseInt(t/60))+":"+e.pad(parseInt(t%60)):e.domRef.player.removeEventListener("timeupdate",e.decreaseAdCountdown)},e.removeAdCountdown=()=>{const t=e.domRef.wrapper.querySelector(".ad_countdown");t&&t.parentElement.removeChild(t)},e.toggleAdCountdown=t=>{const n=e.domRef.wrapper.querySelector(".ad_countdown");n&&(n.style.display=t?"inline-block":"none")},e.addAdPlayingText=t=>{const n=document.createElement("div");e.displayOptions.layoutControls.primaryColor&&(n.style.backgroundColor=e.displayOptions.layoutControls.primaryColor,n.style.opacity=1),n.className="fluid_ad_playing",n.innerText=t,e.domRef.wrapper.appendChild(n)},e.positionTextElements=t=>{const n=["top left","top right","bottom left","bottom right"],i=e.domRef.wrapper.querySelector(".skip_button"),r=e.domRef.wrapper.querySelector(".fluid_ad_playing"),a=e.domRef.wrapper.querySelector(".fluid_ad_cta");let o=0,s=0;let l=!1,c=0,u=[];const d={top:{left:{h:34,v:34},right:{h:0,v:34}},bottom:{left:{h:34,v:50},right:{h:0,v:50}}};let h,f,p;null!==i&&(c=i.offsetHeight+8,e.domRef.wrapper.classList.contains("mobile")&&(d.top={left:{h:0,v:8},right:{h:0,v:8}},d.bottom={left:{h:0,v:50},right:{h:0,v:50}})),null!==a&&(h=e.rollsById[t.rollListId].adCTATextPosition?e.rollsById[t.rollListId].adCTATextPosition.toLowerCase():e.displayOptions.vastOptions.adCTATextPosition,-1===n.indexOf(h)&&(console.log('[FP Error] Invalid position for CTAText. Reverting to "bottom right"'),h="bottom right"),a.classList.add.apply(a.classList,h.split(" ")),u=h.split(" "),l="bottom"===u[0],a.style[u[0]]=d[u[0]][u[1]].v+"px",a.style[u[1]]=d[u[0]][u[1]].h+"px",l&&"right"===u[1]&&(a.style[u[0]]=d[u[0]][u[1]].v+c+"px"),o=a.offsetHeight+8+"px"),null!==r&&(f=e.rollsById[t.rollListId].adTextPosition?e.rollsById[t.rollListId].adTextPosition.toLowerCase():e.displayOptions.vastOptions.adTextPosition,-1===n.indexOf(f)&&(console.log('[FP Error] Invalid position for adText. Reverting to "top left"'),f="top left"),p=f.split(" "),r.style[p[0]]=d[p[0]][p[1]].v+"px",r.style[p[1]]=d[p[0]][p[1]].h+"px",s=r.offsetHeight+8+"px"),o>0&&s>0&&h===f&&(l?"right"===u[1]?r.style.bottom=d[p[0]][p[1]].v+c+o+"px":r.style.bottom=d[p[0]][p[1]].v+o+"px":a.style.top=d[u[0]][u[1]].v+s+"px")},e.removeAdPlayingText=()=>{const t=e.domRef.wrapper.querySelector(".fluid_ad_playing");t&&t.parentElement.removeChild(t)},e.addCTAButton=t=>{if(e.vastOptions.titleCTA){const{text:t,link:n,tracking:i}=e.vastOptions.titleCTA;return e.createAndAppendCTAButton(t,n,i)}if(t&&"string"==typeof e.displayOptions.vastOptions.adCTAText)return e.createAndAppendCTAButton(e.displayOptions.vastOptions.adCTAText,t,e.vastOptions.clickthroughUrl)},e.createAndAppendCTAButton=(t,n,i)=>{const r=document.createElement("div");r.className="fluid_ad_cta";const a=document.createElement("span");let o=t;n&&(o+='<br/><span class="add_icon_clickthrough">'+n+"</span>"),a.innerHTML=o,r.addEventListener("click",()=>(e.domRef.player.paused||e.domRef.player.pause(),window.open(i,"_blank").focus(),!0),!1),r.appendChild(a),e.domRef.wrapper.appendChild(r)},e.removeCTAButton=()=>{const t=e.domRef.wrapper.querySelector(".fluid_ad_cta");t&&t.parentElement.removeChild(t)},e.decreaseSkipOffset=()=>{if(typeof e.vastOptions>"u"||null===e.vastOptions)return;let t=e.vastOptions.skipoffset-Math.floor(e.domRef.player.currentTime);const n=e.domRef.wrapper.querySelector(".skip_button");if(!n)return void e.domRef.player.removeEventListener("timeupdate",e.decreaseSkipOffset);if(t>=1)return void(n.innerHTML=e.displayOptions.vastOptions.skipButtonCaption.replace("[seconds]",t));const i=document.createElement("a");i.href="#",i.className="js-skipHref",i.innerHTML=e.displayOptions.vastOptions.skipButtonClickCaption,i.onclick=t=>{t.preventDefault(),t.stopPropagation(),e.pressSkipButton()},n.innerHTML="",n.appendChild(i),n.className=n.className.replace(/\bskip_button_disabled\b/,""),e.domRef.player.removeEventListener("timeupdate",e.decreaseSkipOffset)},e.pressSkipButton=()=>{if(e.removeSkipButton(),e.removeAdPlayingText(),e.removeCTAButton(),e.vastOptions.vpaid)return void e.skipVpaidAd();e.displayOptions.vastOptions.vastAdvanced.vastVideoSkippedCallback();const t=document.createEvent("Event");t.initEvent("ended",!1,!0),e.domRef.player.dispatchEvent(t)},e.removeSkipButton=()=>{const t=e.domRef.wrapper.querySelector(".skip_button");t&&t.parentElement.removeChild(t)},e.addClickthroughLayer=()=>{const t=e.domRef.wrapper,n=document.createElement("div");n.className="vast_clickthrough_layer",n.setAttribute("style","position: absolute; cursor: pointer; top: 0; left: 0; width: "+e.domRef.player.offsetWidth+"px; height: "+e.domRef.player.offsetHeight+"px;"),t.appendChild(n);const i=function(){window.open(e.vastOptions.clickthroughUrl),typeof e.vastOptions.clicktracking<"u"&&e.callUris(e.vastOptions.clicktracking)},r=e.domRef.wrapper.querySelector(".vast_clickthrough_layer"),a="iPhone"===e.mobileInfo.device&&!1!==e.mobileInfo.userOsMajor&&e.mobileInfo.userOsMajor<=9;r.onclick=()=>{e.domRef.player.paused?a&&!e.suppressClickthrough?(i(),e.suppressClickthrough=!0):e.domRef.player.play():(i(),e.domRef.player.pause())}},e.removeClickthrough=()=>{const t=e.domRef.wrapper.querySelector(".vast_clickthrough_layer");t&&t.parentNode.removeChild(t)}},function(e,t){e.initialiseStreamers=()=>{switch(e.detachStreamers(),e.displayOptions.layoutControls.mediaType){case"application/dash+xml":e.dashScriptLoaded||window.dashjs&&!window.dashjs.isDefaultSubject?e.initialiseDash():(e.dashScriptLoaded=!0,Promise.resolve().then(()=>l_).then(t=>{window.dashjs=t.default,e.initialiseDash()}));break;case"application/x-mpegurl":const{displayOptions:t,domRef:n}=e,{player:i}=n,{hls:r}=t;if(i.canPlayType("application/x-mpegurl")&&!r.overrideNative){e.debugMessage("Native HLS support found, skipping hls.js");break}e.hlsScriptLoaded||window.Hls?e.initialiseHls():(e.hlsScriptLoaded=!0,Promise.resolve().then(()=>a_).then(t=>{window.Hls=t.default,e.initialiseHls()}))}},e.initialiseDash=()=>{if("function"==typeof(window.MediaSource||window.WebKitMediaSource)){const t=e.autoplayAfterAd?e.displayOptions.layoutControls.autoPlay:e.autoplayAfterAd,n={debug:{logLevel:typeof FP_DEBUG<"u"&&!0===FP_DEBUG?dashjs.Debug.LOG_LEVEL_DEBUG:dashjs.Debug.LOG_LEVEL_FATAL}},i=dashjs.MediaPlayer().create(),r=e.displayOptions.modules.configureDash(n);i.updateSettings(r),e.displayOptions.modules.onBeforeInitDash(i),i.initialize(e.domRef.player,e.originalSrc,t),i.on("streamInitializing",()=>{e.toggleLoader(!0)}),i.on("canPlay",()=>{e.toggleLoader(!1)}),i.on("playbackPlaying",()=>{e.toggleLoader(!1)}),i.on(dashjs.MediaPlayer.events.STREAM_INITIALIZED,()=>{e.isLiveStream=!!i.isDynamic(),i.isDynamic()&&e.showLiveIndicator()}),e.displayOptions.modules.onAfterInitDash(i),e.dashPlayer=i}else e.nextSource(),console.log("[FP_WARNING] Media type not supported by this browser using DASH.js. (application/dash+xml)")},e.initialiseHls=()=>{if(typeof Hls<"u"&&Hls.isSupported()){e.debugMessage("Initializing hls.js");const t={debug:typeof FP_DEBUG<"u"&&!0===FP_DEBUG,startPosition:0,p2pConfig:{logLevel:!1},enableWebVTT:!1,enableCEA708Captions:!1},n=e.displayOptions.modules.configureHls(t),i=new Hls(n);e.displayOptions.modules.onBeforeInitHls(i),i.attachMedia(e.domRef.player),i.loadSource(e.originalSrc),i.once(Hls.Events.LEVEL_LOADED,function(t,n){e.isLiveStream=!!n.details.live,n.details.live?e.showLiveIndicator():e.hideLiveIndicator()}),e.displayOptions.modules.onAfterInitHls(i),e.hlsPlayer=i,!e.firstPlayLaunched&&e.displayOptions.layoutControls.autoPlay&&e.domRef.player.play(),e.createHLSVideoSourceSwitch()}else e.nextSource(),console.log("[FP_WARNING] Media type not supported by this browser using HLS.js. (application/x-mpegURL)")},e.createHLSVideoSourceSwitch=()=>{e.hlsPlayer.on(Hls.Events.MANIFEST_PARSED,function(){try{const t=function(){const t=e.hlsPlayer.levels.map((e,t)=>({id:t,title:e.height+"p",isHD:"HDR"===e.videoRange,bitrate:e.bitrate})),n={id:-1,title:"auto",isHD:!1,bitrate:0};return[...t,n]}(),n=function(e){return[...e].sort((e,t)=>t.height!==e.height?t.height-e.height:t.bitrate-e.bitrate)}(t);if(e.videoSources=n,n.length<=2)return;const i=e.domRef.wrapper.querySelector(".fluid_control_video_source");!function(e,t){e.length>1?t.style.display="inline-block":t.style.display="none"}(n,i);const r=function(t){const n=document.createElement("div");return n.className="fluid_video_sources_list",n.style.display="none",t.forEach(t=>{const i=function(t){const n=function(t){const n=e.videoSources.filter(t=>t.title===e.fluidStorage.fluidQuality);if(n.length>1){if(n[0].id===t.id)return"source_selected"}else if(1===n.length)return n[0].id===t.id?"source_selected":"";return n.length||"auto"!==t.title?"":"source_selected"}(t),i=t.isHD?'<sup style="color:'.concat(e.displayOptions.layoutControls.primaryColor,'" class="fp_hd_source"></sup>'):"",r=document.createElement("div");return r.className="fluid_video_source_list_item js-source_".concat(t.title),r.innerHTML='<span class="source_button_icon '.concat(n,'"></span>').concat(t.title).concat(i),r.addEventListener("click",n=>function(t,n){t.stopPropagation();const i=t.currentTarget;(function(){const t=e.domRef.wrapper.getElementsByClassName("source_button_icon");Array.from(t).forEach(e=>e.classList.remove("source_selected"))})(),i.firstChild.classList.add("source_selected"),e.videoSources.forEach(t=>{t.title===i.innerText.replace(/(\r\n\t|\n|\r\t)/gm,"")&&(e.hlsPlayer.currentLevel=n.id,e.fluidStorage.fluidQuality=n.title)}),e.openCloseVideoSourceSwitch()}(n,t)),r}(t);n.appendChild(i)}),n}(n);(function(t,n){t.appendChild(n),t.removeEventListener("click",e.openCloseVideoSourceSwitch),t.addEventListener("click",e.openCloseVideoSourceSwitch)})(i,r),function(t){const n=t.find(t=>t.title===e.fluidStorage.fluidQuality);if(n)e.hlsPlayer.currentLevel=n.id;else{const n=t.find(e=>"auto"===e.title);e.hlsPlayer.currentLevel=n.id}}(n)}catch(e){console.error(e)}})},e.detachStreamers=()=>{e.dashPlayer?(e.dashPlayer.reset(),e.dashPlayer=!1):e.hlsPlayer&&(e.hlsPlayer.detachMedia(),e.hlsPlayer=!1)}},function(e,t){e.isTouchDevice=()=>!(!("ontouchstart"in window)&&!navigator.maxTouchPoints),e.getMobileOs=()=>{const e=navigator.userAgent||"",t={device:!1,userOs:!1,userOsVer:!1,userOsMajor:!1};let n;if(e.match(/Android/i)?(t.userOs="Android",n=e.indexOf("Android ")):e.match(/iPhone/i)?(t.device="iPhone",t.userOs="iOS",n=e.indexOf("OS ")):e.match(/iPad/i)?(t.device="iPad",t.userOs="iOS",n=e.indexOf("OS ")):t.userOs=!1,"iOS"===t.userOs&&n>-1){const i=e.substr(n+3);-1!==i.indexOf(" ")&&(t.userOsVer=i.substring(0,i.indexOf(" ")).replace(/_/g,"."),t.userOsMajor=parseInt(t.userOsVer))}else"Android"===t.userOs&&n>-1?t.userOsVer=e.substr(n+8,3):t.userOsVer=!1;return t},e.getBrowserVersion=()=>{const e=navigator.userAgent||"",t={browserName:!1,fullVersion:!1,majorVersion:!1,userOsMajor:!1};let n,i;try{t.browserName=navigator.appName,-1!==(n=e.indexOf("OPR/"))?(t.browserName="Opera",t.fullVersion=e.substring(n+4)):-1!==(n=e.indexOf("Opera"))?(t.browserName="Opera",t.fullVersion=e.substring(n+6),-1!==(n=e.indexOf("Version"))&&(t.fullVersion=e.substring(n+8))):-1!==(n=e.indexOf("MSIE"))?(t.browserName="Microsoft Internet Explorer",t.fullVersion=e.substring(n+5)):-1!==(n=e.indexOf("Chrome"))?(t.browserName="Google Chrome",t.fullVersion=e.substring(n+7)):-1!==(n=e.indexOf("Safari"))?(t.browserName="Safari",t.fullVersion=e.substring(n+7),-1!==(n=e.indexOf("Version"))&&(t.fullVersion=e.substring(n+8))):-1!==(n=e.indexOf("Firefox"))?(t.browserName="Mozilla Firefox",t.fullVersion=e.substring(n+8)):(i=e.lastIndexOf(" ")+1)<(n=e.lastIndexOf("/"))&&(t.browserName=e.substring(i,n),t.fullVersion=e.substring(n+1),t.browserName.toLowerCase()===t.browserName.toUpperCase()&&(t.browserName=navigator.appName)),-1!==(i=t.fullVersion.indexOf(";"))&&(t.fullVersion=t.fullVersion.substring(0,i)),-1!==(i=t.fullVersion.indexOf(" "))&&(t.fullVersion=t.fullVersion.substring(0,i)),t.majorVersion=parseInt(""+t.fullVersion,10),isNaN(t.majorVersion)&&(t.fullVersion=""+parseFloat(navigator.appVersion),t.majorVersion=parseInt(navigator.appVersion,10))}catch(e){}return t},e.compareVersion=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)return!1;e=e.split("."),t=t.split(".");const n=Math.min(e.length,t.length);for(let i=0;i<n;++i){if(e[i]=parseInt(e[i],10),t[i]=parseInt(t[i],10),e[i]>t[i])return 1;if(e[i]<t[i])return-1}return e.length===t.length?0:e.length<t.length?-1:1},e.convertTimeStringToSeconds=e=>{if(!e||!e.match(/^(\d){2}(:[0-5][0-9]){2}(.(\d){1,3})?$/))return!1;const t=e.split(":");return 3600*parseInt(t[0],10)+60*parseInt(t[1],10)+parseInt(t[2],10)},e.formatTime=t=>{const n=new Date(1e3*t),i=e.pad(n.getUTCHours()),r=e.pad(n.getUTCMinutes()),a=e.pad(n.getSeconds());return i>=1?i+":"+r+":"+a:r+":"+a},e.pad=e=>e<10?"0"+e:e,e.isElementVisible=e=>{if(!e)return null;const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},e.observe=()=>{new IntersectionObserver(function(t){t.forEach(function(t){t.intersectionRatio>=.5&&(e.domRef.player.inView=!0),0==t.intersectionRatio&&t.target.glast&&(e.domRef.player.inView=!1)})},{threshold:[0,.5]}).observe(e.domRef.wrapper)},e.throttle=function(e,t){let n=!1;return function(){n||(e.apply(this,arguments),n=!0,setTimeout(function(){n=!1},t))}},e.getImageTwoMostProminentColours=e=>new Promise((t,n)=>{const i=new Image;i.crossOrigin="Anonymous",i.src=e,i.onload=()=>{const e=document.createElement("canvas"),n=e.getContext("2d");e.width=i.width,e.height=i.height,n.drawImage(i,0,0,i.width,i.height);const r=n.getImageData(0,0,i.width,i.height).data,a={};for(let e=0;e<r.length;e+=4){const t=r[e],n=r[e+1],i=r[e+2],o="rgb(".concat(t,",").concat(n,",").concat(i,")");a[o]?a[o]++:a[o]=1}const o=Object.keys(a).map(e=>{const[t,n,i]=e.match(/\d+/g).map(Number),[r,a,o]=((e,t,n)=>{e/=255,t/=255,n/=255;const i=Math.max(e,t,n),r=Math.min(e,t,n);let a,o,s=(i+r)/2;if(i===r)a=o=0;else{const l=i-r;switch(o=s>.5?l/(2-i-r):l/(i+r),i){case e:a=(t-n)/l+(t<n?6:0);break;case t:a=(n-e)/l+2;break;case n:a=(e-t)/l+4}a/=6}return[a,o,s]})(t,n,i);return{color:e,h:r,s:a,l:o,score:a+(1-Math.abs(2*o-1))}}).sort((e,t)=>t.score-e.score),s=e=>{const t=e.match(/\d+/g).map(Number);return t[0]<40&&t[1]<40&&t[2]<40};let l=[];for(const e of o){if(2===l.length)break;s(e.color)||l.every(t=>{const n=Math.abs(e.h-t.h),i=Math.abs(e.s-t.s),r=Math.abs(e.l-t.l);return n>=.1&&i>=.1&&r>=.1})&&l.push(e)}l.length<2&&(l=o.slice(0,2)),t(l.map(e=>e.color))},i.onerror=()=>{n(new Error("Failed to load image"))}})},function(e,t){e.suggestedVideosGrid=null,e.generateSuggestedVideoList=()=>{const t=e.displayOptions.suggestedVideos.configUrl;t&&e.sendRequestAsync(t,!1,5e3).then(t=>{let{response:n}=t;const i=JSON.parse(n),r=e.generateSuggestedVideoGrid(i);e.suggestedVideosGrid=r}).catch(e=>{console.error("[FP_ERROR] given suggested videos config url is invalid or not found.",e)})},e.generateSuggestedVideoGrid=t=>{const n=document.createElement("div");n.className="suggested_tile_grid";for(let i=0;i<12;i++){const r=e.createVideoTile(t[i]);n.appendChild(r)}return n},e.displaySuggestedVideos=()=>{e.domRef.wrapper.appendChild(e.suggestedVideosGrid)},e.clickSuggestedVideo=(t,n,i)=>{e.toggleLoader(!0),e.hideSuggestedVideos(),e.resetPlayer(t,n,i),e.generateSuggestedVideoList()},e.resetPlayer=(t,n,i)=>{const r=e.domRef.wrapper.querySelector("#".concat(e.videoPlayerId));r.innerHTML="";let a="";t&&t.forEach(e=>{a+="<source src='".concat(e.url,"' ").concat(e.hd?"data-fluid-hd":"",' title="').concat(e.resolution,"\" type='").concat(e.mimeType,"'/>")}),n&&n.forEach(e=>{a+='<track label="'.concat(e.label,'" kind="metadata" srclang="').concat(e.lang,'" src="').concat(e.url,'" ').concat(e.default?"default":"",">")}),r.innerHTML=a,e.removeVideoSourcesListFromDOM();e.domRef.wrapper.getElementsByClassName("fluid_control_video_source")[0].innerHTML="",e.domRef.player.src="",e.domRef.player.removeAttribute("src"),e.setVideoSource(t[0].url),e.createVideoSourceSwitch(!1),e.resetSubtitles(),e.setPersistentSettings(!0),e.loadInNewVideo(),e.resetAds(),i&&(e.displayOptions.suggestedVideos.configUrl=i,e.generateSuggestedVideoList())},e.createVideoTile=t=>{const n=document.createElement("div");n.addEventListener("click",function(){e.clickSuggestedVideo(t.sources,t.subtitles,t.configUrl)},!1),n.className="suggested_tile",n.id="suggested_tile_"+t.id,e.getImageTwoMostProminentColours(t.thumbnailUrl).then(e=>{e&&e.length&&(n.style="background: ".concat(e[0],";"))});const i=document.createElement("img");i.src=t.thumbnailUrl,i.className="suggested_tile_image";const r=document.createElement("div");r.className="suggested_tile_overlay";const a=document.createElement("p");return a.className="suggested_tile_title",a.innerText=t.title,r.appendChild(a),n.appendChild(i),n.appendChild(r),n},e.resetSubtitles=()=>{e.removeSubtitlesListFromDOM();e.domRef.wrapper.getElementsByClassName("fluid_control_subtitles")[0].innerHTML="",e.domRef.player.load(),e.createSubtitles(!1)},e.loadInNewVideo=()=>{e.displayOptions.layoutControls.mediaType=e.getCurrentSrcType(),e.initialiseStreamers(),e.domRef.player.currentTime=0,e.domRef.player.mainVideoCurrentTime=0,e.setBuffering()},e.resetAds=()=>{e.timerPool={},e.rollsById={},e.adPool={},e.adGroupedByRolls={},e.onPauseRollAdPods=[],e.currentOnPauseRollAd="",e.isTimer=!1,e.timer=null,e.firstPlayLaunched=!1,e.preRollAdsResolved=!1,e.preRollAdPods=[],e.preRollAdPodsLength=0,e.preRollVastResolved=0,e.autoplayAfterAd=!0;const t=setInterval(()=>{!isNaN(e.domRef.player.duration)&&e.domRef.player.duration>0&&(e.toggleLoader(!0),e.mainVideoDuration=e.domRef.player.duration,clearInterval(t),e.setVastList(),e.checkForNextAd(),e.playPauseToggle())},100)},e.removeVideoSourcesListFromDOM=()=>{const t=e.domRef.wrapper.getElementsByClassName("fluid_video_source_list_item");for(let e=0;e<t.length;e++)t[e].remove()},e.removeSubtitlesListFromDOM=()=>{const t=e.domRef.wrapper.getElementsByClassName("fluid_subtitle_list_item");for(let e=0;e<t.length;e++)t[e].remove()},e.hideSuggestedVideos=()=>{const t=e.domRef.wrapper.getElementsByClassName("suggested_tile_grid")[0];t&&t.remove()},e.isShowingSuggestedVideos=()=>!!e.domRef.wrapper.getElementsByClassName("suggested_tile_grid")[0]},function(e){const t="fluid_mini_player_mode",n="mini-player-close-button-wrapper",i="mini-player-close-button",r="fluidplayer-miniplayer-player-placeholder",a="disable-mini-player-mobile";let o=null,s=null,l=null,c=null,u=!1,d=null,h=!1,f=!1;function p(l){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.debugMessage("[MiniPlayer] Toggling MiniPlayer, forceToggle: ".concat(l));const f=e.displayOptions.layoutControls.miniPlayer;f.enabled?"on"===l&&e.miniPlayerToggledOn||"off"===l&&!e.miniPlayerToggledOn?e.debugMessage("[MiniPlayer] Can't force toggle Mini Player to it's same state"):(c&&_(),window.matchMedia("(max-width: 768px)").matches&&(h=!0),e.resetDisplayMode("miniPlayer"),u||function(){if(!e.domRef.player.parentNode.querySelector(".".concat(i))){const t=document.createElement("div");t.classList.add(n);const r=document.createElement("span");r.classList.add(i),r.addEventListener("click",()=>{p("off",!0),e.domRef.player.paused||e.playPauseToggle()}),t.appendChild(r),e.domRef.player.parentNode.append(t)}h&&function(){const t=document.createElement("div");let n,r=0,o=0;t.classList.add(a);const s=document.createElement("span");s.classList.add(i),t.appendChild(s),t.ontouchstart=e=>{n=!1,e.timeStamp,o=e.changedTouches[0].screenX,e.preventDefault()},t.ontouchmove=t=>{r=Math.min(Math.max(o-t.changedTouches[0].screenX,-50),50),Math.abs(r)>5?(e.domRef.wrapper.style.transform="translateX(".concat(-1*r,"px)"),n=!0):e.domRef.wrapper.style.transform="translateX(0px)"},t.ontouchend=t=>{Math.abs(r)>5?(p("off",!0),e.domRef.player.paused||e.playPauseToggle(),t.preventDefault()):n||(p("off",!0),setTimeout(()=>{e.domRef.wrapper.scrollIntoView({behavior:"smooth",block:"center"})})),r=0,e.domRef.wrapper.style.transform=""},t.onmouseup=()=>p("off",!0),e.domRef.wrapper.insertBefore(t,e.domRef.player.nextSibling)}(),u=!0}(),"off"===l||e.miniPlayerToggledOn?function(){const n=e.domRef.wrapper;e.domRef.wrapper.parentElement.removeChild(d),d=null,n.classList.remove(t),n.style.width="".concat(o,"px"),n.style.height="".concat(s,"px"),o=null,s=null,v(),y(),e.miniPlayerToggledOn=!1,g()}():("on"===l||!e.miniPlayerToggledOn)&&function(n,i,a,l){const c=e.domRef.wrapper,u=n>400?n:400,f=i>225?i:225,_=a>40?a:40;o=m(c,"width","clientWidth"),s=m(c,"height","clientHeight"),c.classList.add(t,"".concat(t,"--").concat(l.trim().replace(/\s/,"-"))),h?(c.style.width="".concat(_,"vw"),c.style.height="auto",c.style.aspectRatio="16 / 9"):(c.style.width="".concat(u,"px"),c.style.height="".concat(f,"px")),function(t,n){d=document.createElement("div"),d.classList.add(r),d.style.height="".concat(n,"px"),d.style.width="".concat(t,"px"),d.innerText=e.displayOptions.layoutControls.miniPlayer.placeholderText||"",d.onclick=()=>p("off",!0),e.domRef.wrapper.parentElement.insertBefore(d,e.domRef.wrapper)}(o,s),v(u,f,_),y(),e.miniPlayerToggledOn=!0,g()}(f.width,f.height,f.widthMobile,f.position)):e.debugMessage("[MiniPlayer] Prevent toggle MiniPlayer, it's currently disabled")}function g(){e.domRef.player.dispatchEvent(new CustomEvent("miniPlayerToggle",{detail:{isToggledOn:e.miniPlayerToggledOn}}))}function m(e,t,n){return t&&e.style[t]&&e.style[t].match("px")?parseInt(e.style[t]):String(e[n]).match("px")?parseInt(e[n]):e[n]}function v(t,n,i){const r=e.domRef.wrapper.querySelector(".fluid_nonLinear_ad img, .fluid_vpaid_nonlinear_slot_iframe"),a=e.domRef.wrapper.querySelector(".fluid_vpaidNonLinear_frame");if(!r)return;h&&(t=window.innerWidth*i/100);const o=m(r,null,"width"),s=m(r,null,"height");if(l&&c)r.width=l,r.height=c,a&&(a.style.width="".concat(l,"px"),a.style.height="".concat(c,"px")),l=c=null;else if(o>t||s>n){const e=(t-(h?4:32))/o;l=o,c=s,r.width=Math.round(o*e),r.height=Math.round(s*e),a&&(a.style.width="".concat(Math.round(o*e),"px"),a.style.height="".concat(Math.round(s*e),"px"))}}function y(){const t=e.domRef.wrapper.querySelector(".vast_clickthrough_layer");t&&(t.style.width="".concat(e.domRef.player.offsetWidth,"px"),t.style.height="".concat(e.domRef.player.offsetHeight,"px"))}function _(){const t=e.displayOptions.layoutControls.miniPlayer.autoToggle;!f&&t?(f=!0,document.addEventListener("scroll",E,{passive:!0})):document.removeEventListener("scroll",E)}const E=e.throttle(function(){if(e.domRef.player.paused)return;const t=e.isElementVisible(e.domRef.player),n=e.isElementVisible(e.domRef.wrapper.querySelector(".".concat(r)));t||e.miniPlayerToggledOn?n&&e.miniPlayerToggledOn&&p("off"):p("on")},16.666666666666668);e.toggleMiniPlayer=p,e.toggleMiniPlayerScreenDetection=_}],we=typeof FP_ENV<"u"&&"development"===FP_ENV,Ae=typeof FP_DEBUG<"u"&&!0===FP_DEBUG;let Re=0;const xe=function(){const e=this;e.domRef={player:null},e.version=typeof FP_BUILD_VERSION<"u"?FP_BUILD_VERSION:"",e.homepage=typeof FP_HOMEPAGE<"u"?FP_HOMEPAGE+"/?utm_source=player&utm_medium=context_menu&utm_campaign=organic":"",e.destructors=[],e.init=(t,n)=>{const i={development:we,debug:Ae};for(const t of Se)t(e,i);let r;if(t instanceof HTMLVideoElement)r=t,t.id||(t.id="fluid_player_instance_"+(Re++).toString());else{if(!("string"==typeof t||t instanceof String))throw"Invalid initializer - player target must be HTMLVideoElement or ID";r=document.getElementById(t)}if(!r)throw"Could not find a HTML node to attach to for target "+t+'"';if(r.classList.contains("js-fluid-player"))throw"Invalid initializer - player target already is initialized";r.setAttribute("playsinline",""),r.setAttribute("webkit-playsinline",""),r.classList.add("js-fluid-player"),e.domRef.player=r,e.vrROTATION_POSITION=.1,e.vrROTATION_SPEED=80,e.vrMode=!1,e.vrPanorama=null,e.vrViewer=null,e.vpaidTimer=null,e.vpaidAdUnit=null,e.vastOptions=null,e.videoPlayerId=r.id,e.originalSrc=e.getCurrentSrc(),e.isCurrentlyPlayingAd=!1,e.recentWaiting=!1,e.latestVolume=1,e.currentVideoDuration=0,e.firstPlayLaunched=!1,e.suppressClickthrough=!1,e.timelinePreviewData=[],e.mainVideoCurrentTime=0,e.mainVideoDuration=0,e.isTimer=!1,e.timer=null,e.timerPool={},e.rollsById={},e.adPool={},e.adGroupedByRolls={},e.onPauseRollAdPods=[],e.currentOnPauseRollAd="",e.preRollAdsResolved=!1,e.preRollAdPods=[],e.preRollAdPodsLength=0,e.preRollVastResolved=0,e.temporaryAdPods=[],e.availableRolls=["preRoll","midRoll","postRoll","onPauseRoll"],e.supportedNonLinearAd=["300x250","468x60","728x90"],e.autoplayAfterAd=!0,e.nonLinearDuration=15,e.supportedStaticTypes=["image/gif","image/jpeg","image/png"],e.inactivityTimeout=null,e.isUserActive=null,e.nonLinearVerticalAlign="bottom",e.vpaidNonLinearCloseButton=!0,e.showTimeOnHover=!0,e.initialAnimationSet=!0,e.theatreMode=!1,e.theatreModeAdvanced=!1,e.fullscreenMode=!1,e.originalWidth=r.offsetWidth,e.originalHeight=r.offsetHeight,e.dashPlayer=!1,e.hlsPlayer=!1,e.dashScriptLoaded=!1,e.hlsScriptLoaded=!1,e.isPlayingMedia=!1,e.isSwitchingSource=!1,e.isLoading=!1,e.isInIframe=e.inIframe(),e.mainVideoReadyState=!1,e.xmlCollection=[],e.inLineFound=null,e.fluidStorage={},e.fluidPseudoPause=!1,e.mobileInfo=e.getMobileOs(),e.events={},e.timeSkipOffsetAmount=10,e.currentMediaSourceType="source",e.isLiveStream=null,e.displayOptions={layoutControls:{mediaType:e.getCurrentSrcType(),primaryColor:!1,posterImage:!1,posterImageSize:"contain",adProgressColor:"#f9d300",playButtonShowing:!0,playPauseAnimation:!0,closeButtonCaption:"Close",fillToContainer:!1,autoPlay:!1,preload:"auto",mute:!1,loop:null,keyboardControl:!0,allowDownload:!1,playbackRateEnabled:!1,subtitlesEnabled:!1,subtitlesOnByDefault:!0,showCardBoardView:!1,showCardBoardJoystick:!1,allowTheatre:!0,doubleclickFullscreen:!0,autoRotateFullScreen:!1,theatreSettings:{width:"100%",height:"60%",marginTop:0,horizontalAlign:"center",keepPosition:!1},theatreAdvanced:{theatreElement:null},title:null,logo:{imageUrl:null,position:"top left",clickUrl:null,opacity:1,mouseOverImageUrl:null,imageMargin:"2px",hideWithControls:!1,showOverAds:!1},controlBar:{autoHide:!1,autoHideTimeout:3,animated:!0,playbackRates:["x2","x1.5","x1","x0.5"]},timelinePreview:{spriteImage:!1,spriteRelativePath:!1},htmlOnPauseBlock:{html:null,height:null,width:null},layout:"default",playerInitCallback:function(){},persistentSettings:{volume:!0,quality:!0,speed:!0,theatre:!0},controlForwardBackward:{show:!1,doubleTapMobile:!0},contextMenu:{controls:!0,links:[]},miniPlayer:{enabled:!0,width:400,height:225,widthMobile:50,placeholderText:"Playing in Miniplayer",position:"bottom right",autoToggle:!1},roundedCorners:0},suggestedVideos:{configUrl:null},vastOptions:{adList:{},skipButtonCaption:"Skip ad in [seconds]",skipButtonClickCaption:'Skip Ad <span class="skip_button_icon"></span>',adText:null,adTextPosition:"top left",adCTAText:"Visit now!",adCTATextPosition:"bottom right",adCTATextVast:!1,adClickable:!0,vastTimeout:5e3,showProgressbarMarkers:!1,allowVPAID:!1,showPlayButton:!1,maxAllowedVastTagRedirects:3,vpaidTimeout:3e3,vastAdvanced:{vastLoadedCallback:function(){},noVastVideoCallback:function(){},vastVideoSkippedCallback:function(){},vastVideoEndedCallback:function(){}}},hls:{overrideNative:!1},captions:{play:"Play",pause:"Pause",mute:"Mute",unmute:"Unmute",fullscreen:"Fullscreen",subtitles:"Subtitles",exitFullscreen:"Exit Fullscreen"},debug:Ae,modules:{configureHls:e=>e,onBeforeInitHls:e=>{},onAfterInitHls:e=>{},configureDash:e=>e,onBeforeInitDash:e=>{},onAfterInitDash:e=>{}},onBeforeXMLHttpRequestOpen:e=>{},onBeforeXMLHttpRequest:e=>{(Ae||we)&&console.debug("[FP_DEBUG] Request made",e)}},n.hlsjsConfig&&console.error("[FP_ERROR] player option hlsjsConfig is removed and has no effect. Use module callbacks instead!"),function e(t,n){return Object.keys(n).forEach(i=>{"object"!=typeof n[i]||null===n[i]||Array.isArray(n[i])?typeof n[i]<"u"&&(t[i]=n[i]):e(t[i],n[i])}),t}(e.displayOptions,n),e.domRef.wrapper=e.setupPlayerWrapper(),r.addEventListener("webkitfullscreenchange",e.recalculateAdDimensions),r.addEventListener("fullscreenchange",e.recalculateAdDimensions),r.addEventListener("waiting",e.onRecentWaiting),r.addEventListener("pause",e.onFluidPlayerPause),r.addEventListener("error",e.onErrorDetection),r.addEventListener("ended",e.onMainVideoEnded),r.addEventListener("durationchange",()=>{e.currentVideoDuration=e.getCurrentVideoDuration()}),r.readyState>0?e.mainVideoReady():r.addEventListener("loadedmetadata",e.mainVideoReady),e.displayOptions.layoutControls.showCardBoardView&&r.setAttribute("crossOrigin","anonymous"),e.currentVideoDuration=e.getCurrentVideoDuration(),(isNaN(e.currentVideoDuration)||!isFinite(e.currentVideoDuration))&&(e.currentVideoDuration=0),e.setLayout(),e.latestVolume=r.volume,e.initialAnimationSet=e.displayOptions.layoutControls.playPauseAnimation,e.handleFullscreen(),e.initLogo(),e.initTitle(),e.initMute(),e.initLoop(),e.displayOptions.layoutControls.playerInitCallback(),e.createVideoSourceSwitch(),e.createSubtitles(),e.createCardboard(),e.userActivityChecker(),e.setVastList(),e.setPersistentSettings(),e.generateSuggestedVideoList(),e.initialiseStreamers();const a=r.play;r.play=function(){let t=null;e.displayOptions.layoutControls.showCardBoardView&&typeof DeviceOrientationEvent<"u"&&"function"==typeof DeviceOrientationEvent.requestPermission&&DeviceOrientationEvent.requestPermission().then(function(t){"granted"===t&&e.debugMessage("DeviceOrientationEvent permission granted!")}).catch(console.error);try{return t=a.apply(this,arguments),null!=t&&(t.then(()=>{e.isPlayingMedia=!0,clearTimeout(e.promiseTimeout)}).catch(t=>{console.error("[FP_ERROR] Playback error",t),typeof t.name<"u"&&"AbortError"===t.name||e.announceLocalError(202,"Failed to play video."),clearTimeout(e.promiseTimeout)}),e.promiseTimeout=setTimeout(function(){!1===e.isPlayingMedia&&e.announceLocalError(204,"[FP_ERROR] Timeout error. Failed to play video?")},5e3)),t}catch(t){console.error("[FP_ERROR] Playback error",t),e.announceLocalError(201,"Failed to play video.")}};const o=r.pause;if(r.pause=function(){if(!0===e.isPlayingMedia)return e.isPlayingMedia=!1,o.apply(this,arguments);if(e.isCurrentlyPlayingVideo(e.domRef.player))try{return e.isPlayingMedia=!1,o.apply(this,arguments)}catch(t){e.announceLocalError(203,"Failed to play video.")}},e.displayOptions.layoutControls.autoPlay&&!e.dashScriptLoaded&&!e.hlsScriptLoaded){if("Safari"===e.getBrowserVersion().browserName)return;r.play()}e.mobileInfo.userOs?(e.hideControlBar(),e.domRef.wrapper.addEventListener("touchstart",e.showControlBar,{passive:!0})):(e.displayOptions.layoutControls.controlBar.autoHide||e.domRef.wrapper.addEventListener("mouseleave",e.handleMouseleave,!1),e.domRef.wrapper.addEventListener("mouseenter",e.showControlBar,!1),e.domRef.wrapper.addEventListener("mouseenter",e.showTitle,!1)),e.displayOptions.layoutControls.keyboardControl&&e.keyboardControl(),e.displayOptions.layoutControls.controlBar.autoHide&&e.linkControlBarUserActivity();try{if(e.domRef.player.textTracks)for(const t of e.domRef.player.textTracks)t.mode="hidden"}catch(e){}},e.getCurrentVideoDuration=()=>e.domRef.player?e.domRef.player.duration:0,e.toggleLoader=t=>{e.isLoading=!!t;const n=e.domRef.wrapper.querySelector(".vast_video_loading");n&&(n.style.display=t?"table":"none")},e.sendRequest=(t,n,i,r)=>{const a=new XMLHttpRequest;a.onreadystatechange=r,e.displayOptions.onBeforeXMLHttpRequestOpen(a),a.open("GET",t,!0),a.withCredentials=n,a.timeout=i,e.displayOptions.onBeforeXMLHttpRequest(a),a.send()},e.sendRequestAsync=async(t,n,i)=>await new Promise((r,a)=>{const o=new XMLHttpRequest;o.onreadystatechange=e=>{const t=e.target;4===t.readyState&&t.status>=200&&t.status<300?r(t):4===t.readyState&&a(t)},e.displayOptions.onBeforeXMLHttpRequestOpen(o),o.open("GET",t,!0),o.withCredentials=n,o.timeout=i,e.displayOptions.onBeforeXMLHttpRequest(o),o.send()}),e.announceLocalError=(e,t)=>{let n="[Error] ("+(typeof e<"u"?parseInt(e):900)+"): ";n+=t||"Failed to load Vast",console.warn(n)},e.debugMessage=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];e.displayOptions.debug&&console.log("%cFP DEBUG","color: #fff; font-weight: bold; background-color: #1a5e87; padding: 3px 6px; border-radius: 3px;",...n)},e.onMainVideoEnded=t=>{e.debugMessage("onMainVideoEnded is called"),(!e.isCurrentlyPlayingAd||!e.autoplayAfterAd)&&(Math.floor(e.getCurrentTime())>=Math.floor(e.mainVideoDuration)&&(e.adKeytimePlay(Math.floor(e.mainVideoDuration)),clearInterval(e.timer)),e.displayOptions.layoutControls.loop&&(e.switchToMainVideo(),e.playPauseToggle()),setTimeout(()=>{!e.isCurrentlyPlayingAd&&e.displayOptions.suggestedVideos.configUrl&&e.displaySuggestedVideos()},100))},e.getCurrentTime=()=>e.isCurrentlyPlayingAd?e.mainVideoCurrentTime:e.domRef.player.currentTime,e.getCurrentSrc=()=>{const t=e.domRef.player.getElementsByTagName("source");return t.length?t[0].getAttribute("src"):null},e.getCurrentSrcType=()=>{const t=e.domRef.player.getElementsByTagName("source");if(!t.length)return null;for(let n=0;n<t.length;n++)if(t[n].getAttribute("src")===e.originalSrc)return t[n].getAttribute("type").toLowerCase();return null},e.onRecentWaiting=()=>{e.recentWaiting=!0,setTimeout(function(){e.recentWaiting=!1},1e3)},e.onFluidPlayerPause=()=>{setTimeout(function(){if(e.recentWaiting)return;const t=document.createEvent("CustomEvent");t.initEvent("fluidplayerpause",!1,!0),e.domRef.player.dispatchEvent(t)},100)},e.checkShouldDisplayVolumeBar=()=>"iOS"!==e.getMobileOs().userOs,e.generateCustomControlTags=e=>{const t={};t.loader=document.createElement("div"),t.loader.className="vast_video_loading",t.loader.style.display="none",t.root=document.createElement("div"),t.root.className="fluid_controls_container",e.displayVolumeBar||(t.root.className=t.root.className+" no_volume_bar"),e.controlForwardBackward&&(t.root.className=t.root.className+" skip_controls"),t.leftContainer=document.createElement("div"),t.leftContainer.className="fluid_controls_left",t.root.appendChild(t.leftContainer),t.playPause=document.createElement("div"),t.playPause.className="fluid_button fluid_button_play fluid_control_playpause",t.leftContainer.appendChild(t.playPause),e.controlForwardBackward&&(t.skipBack=document.createElement("div"),t.skipBack.className="fluid_button fluid_button_skip_back",t.leftContainer.appendChild(t.skipBack),t.skipForward=document.createElement("div"),t.skipForward.className="fluid_button fluid_button_skip_forward",t.leftContainer.appendChild(t.skipForward)),t.progressContainer=document.createElement("div"),t.progressContainer.className="fluid_controls_progress_container fluid_slider",t.root.appendChild(t.progressContainer),t.progressWrapper=document.createElement("div"),t.progressWrapper.className="fluid_controls_progress",t.progressContainer.appendChild(t.progressWrapper),t.progressCurrent=document.createElement("div"),t.progressCurrent.className="fluid_controls_currentprogress",t.progressCurrent.style.backgroundColor=e.primaryColor,t.progressWrapper.appendChild(t.progressCurrent),t.progress_current_marker=document.createElement("div"),t.progress_current_marker.className="fluid_controls_currentpos",t.progressCurrent.appendChild(t.progress_current_marker),t.bufferedIndicator=document.createElement("div"),t.bufferedIndicator.className="fluid_controls_buffered",t.progressContainer.appendChild(t.bufferedIndicator),t.adMarkers=document.createElement("div"),t.adMarkers.className="fluid_controls_ad_markers_holder",t.progressContainer.appendChild(t.adMarkers),t.rightContainer=document.createElement("div"),t.rightContainer.className="fluid_controls_right",t.root.appendChild(t.rightContainer),t.fullscreen=document.createElement("div"),t.fullscreen.className="fluid_button fluid_control_fullscreen fluid_button_fullscreen",t.fullscreen.title="Full Screen",t.rightContainer.appendChild(t.fullscreen),e.miniPlayer.enabled&&(t.miniPlayer=document.createElement("div"),t.miniPlayer.className="fluid_button fluid_control_mini_player fluid_button_mini_player",t.miniPlayer.title="Mini Player",t.rightContainer.appendChild(t.miniPlayer)),t.theatre=document.createElement("div"),t.theatre.className="fluid_button fluid_control_theatre fluid_button_theatre",t.theatre.title="Theatre Mode",t.rightContainer.appendChild(t.theatre),t.cardboard=document.createElement("div"),t.cardboard.className="fluid_button fluid_control_cardboard fluid_button_cardboard",t.cardboard.title="Cardboard",t.rightContainer.appendChild(t.cardboard),t.subtitles=document.createElement("div"),t.subtitles.className="fluid_button fluid_control_subtitles fluid_button_subtitles",t.subtitles.title="Captions",t.rightContainer.appendChild(t.subtitles),t.videoSource=document.createElement("div"),t.videoSource.className="fluid_button fluid_control_video_source fluid_button_video_source",t.videoSource.title="Source",t.rightContainer.appendChild(t.videoSource),t.playbackRate=document.createElement("div"),t.playbackRate.className="fluid_button fluid_control_playback_rate fluid_button_playback_rate",t.playbackRate.title="Playback Rate",t.rightContainer.appendChild(t.playbackRate),t.download=document.createElement("div"),t.download.className="fluid_button fluid_control_download fluid_button_download",t.download.title="Download",t.rightContainer.appendChild(t.download),t.volumeContainer=document.createElement("div"),t.volumeContainer.className="fluid_control_volume_container fluid_slider",t.rightContainer.appendChild(t.volumeContainer),t.volume=document.createElement("div"),t.volume.className="fluid_control_volume",t.volumeContainer.appendChild(t.volume),t.volumeCurrent=document.createElement("div"),t.volumeCurrent.className="fluid_control_currentvolume",t.volume.appendChild(t.volumeCurrent),t.volumeCurrentPos=document.createElement("div"),t.volumeCurrentPos.className="fluid_control_volume_currentpos",t.volumeCurrent.appendChild(t.volumeCurrentPos),t.mute=document.createElement("div"),t.mute.className="fluid_button fluid_button_volume fluid_control_mute",t.rightContainer.appendChild(t.mute);const n=document.createElement("div");return n.className="fluid_control_duration",t.duration=document.createElement("div"),t.duration.className="fluid_fluid_control_duration",t.duration.innerText="00:00 / 00:00",e.displayVolumeBar||(n.className=n.className+" no_volume_bar"),t.live_indicator=document.createElement("div"),t.live_indicator.className="fluid_control_live_indicator",n.append(t.live_indicator,t.duration),t.rightContainer.appendChild(n),t},e.showLiveIndicator=()=>{if(!e.domRef.player.parentNode.getElementsByClassName("fluid_button_live_indicator").length){const t=e.domRef.player.parentNode.getElementsByClassName("fluid_control_live_indicator"),n=document.createElement("span");n.className="fluid_button_live_indicator",n.innerHTML='LIVE<span class="live_circle"></span>',n.addEventListener("click",()=>{e.domRef.player.currentTime=e.currentVideoDuration});for(let e=0;e<t.length;e++)t[e].appendChild(n)}},e.hideLiveIndicator=()=>{const t=e.domRef.player.parentNode.getElementsByClassName("fluid_button_live_indicator")[0];t&&t.remove()},e.controlPlayPauseToggle=()=>{const t=e.domRef.player.parentNode.getElementsByClassName("fluid_control_playpause"),n=e.domRef.wrapper.querySelector(".context_option_play"),i=e.domRef.player.parentNode.getElementsByClassName("fluid_controls_container"),r=e.domRef.wrapper.querySelector(".logo_holder");if(e.domRef.wrapper.querySelector(".fluid_initial_play")&&(e.domRef.wrapper.querySelector(".fluid_initial_play").style.display="none",e.domRef.wrapper.querySelector(".fluid_initial_play_button_container").style.opacity="1"),!e.domRef.player.paused){for(let e=0;e<t.length;e++)t[e].className=t[e].className.replace(/\bfluid_button_play\b/g,"fluid_button_pause");for(let e=0;e<i.length;e++)i[e].classList.remove("initial_controls_show");return r&&r.classList.remove("initial_controls_show"),void(null!==n&&(n.innerHTML=e.displayOptions.captions.pause))}for(let e=0;e<t.length;e++)t[e].className=t[e].className.replace(/\bfluid_button_pause\b/g,"fluid_button_play");for(let e=0;e<i.length;e++)i[e].classList.add("initial_controls_show");e.isCurrentlyPlayingAd&&e.displayOptions.vastOptions.showPlayButton&&(e.domRef.wrapper.querySelector(".fluid_initial_play").style.display="block",e.domRef.wrapper.querySelector(".fluid_initial_play_button_container").style.opacity="1"),r&&r.classList.add("initial_controls_show"),null!==n&&(n.innerHTML=e.displayOptions.captions.play)},e.playPauseAnimationToggle=t=>{if(e.isCurrentlyPlayingAd||!e.displayOptions.layoutControls.playPauseAnimation||e.isSwitchingSource)return;const n=e.domRef.wrapper.querySelector(".fluid_initial_play_button, .fluid_initial_pause_button");t?(n.classList.remove("fluid_initial_pause_button"),n.classList.add("fluid_initial_play_button")):(n.classList.remove("fluid_initial_play_button"),n.classList.add("fluid_initial_pause_button")),e.domRef.wrapper.querySelector(".fluid_initial_play").classList.add("transform-active"),setTimeout(function(){e.domRef.wrapper.querySelector(".fluid_initial_play").classList.remove("transform-active")},800)},e.contolProgressbarUpdate=()=>{const t=e.domRef.player.parentNode.getElementsByClassName("fluid_controls_currentprogress");for(let n=0;n<t.length;n++)t[n].style.width=e.domRef.player.currentTime/e.currentVideoDuration*100+"%"},e.controlDurationUpdate=()=>{const t=e.formatTime(e.domRef.player.currentTime);let n,i=!1;if(e.hlsPlayer&&(i=e.hlsPlayer.levels&&e.hlsPlayer.levels[e.hlsPlayer.currentLevel]&&e.hlsPlayer.levels[e.hlsPlayer.currentLevel].details.live),isNaN(e.currentVideoDuration)||!isFinite(e.currentVideoDuration)||i)n=t;else{n=t+" / "+e.formatTime(e.currentVideoDuration)}const r=e.domRef.player.parentNode.getElementsByClassName("fluid_control_duration");for(let t=0;t<r.length;t++){if(r[t].innerHTML="",e.isLiveStream){const n=document.createElement("span");n.className="fluid_button_live_indicator",n.innerHTML='LIVE<span class="live_circle"></span>',n.addEventListener("pointerdown",()=>{e.domRef.player.currentTime=e.currentVideoDuration}),r[t].appendChild(n)}const i=document.createElement("span");i.className="fluid_fluid_control_duration",i.innerText=n,r[t].appendChild(i)}},e.contolVolumebarUpdate=()=>{const t=e.domRef.wrapper.querySelector(".fluid_control_currentvolume"),n=e.domRef.wrapper.querySelector(".fluid_control_volume_currentpos"),i=e.domRef.wrapper.querySelector(".fluid_control_volume").clientWidth,r=n.clientWidth,a=e.domRef.player.parentNode.getElementsByClassName("fluid_control_mute"),o=e.domRef.wrapper.querySelector(".context_option_mute");if(0!==e.domRef.player.volume?(e.latestVolume=e.domRef.player.volume,e.fluidStorage.fluidMute=!1):e.fluidStorage.fluidMute=!0,e.domRef.player.volume&&!e.domRef.player.muted){for(let e=0;e<a.length;e++)a[e].className=a[e].className.replace(/\bfluid_button_mute\b/g,"fluid_button_volume");null!==o&&(o.innerHTML=e.displayOptions.captions.mute)}else{for(let e=0;e<a.length;e++)a[e].className=a[e].className.replace(/\bfluid_button_volume\b/g,"fluid_button_mute");null!==o&&(o.innerHTML=e.displayOptions.captions.unmute)}t.style.width=e.domRef.player.volume*i+"px",n.style.left=e.domRef.player.volume*i-r/2+"px"},e.muteToggle=()=>{0===e.domRef.player.volume||e.domRef.player.muted?(e.domRef.player.volume=e.latestVolume,e.domRef.player.muted=!1):(e.domRef.player.volume=0,e.domRef.player.muted=!0),e.fluidStorage.fluidVolume=e.latestVolume,e.fluidStorage.fluidMute=e.domRef.player.muted},e.checkFullscreenSupport=()=>{const t=e.domRef.wrapper;return t.mozRequestFullScreen?{goFullscreen:"mozRequestFullScreen",exitFullscreen:"mozCancelFullScreen",isFullscreen:"mozFullScreenElement"}:t.webkitRequestFullscreen?{goFullscreen:"webkitRequestFullscreen",exitFullscreen:"webkitExitFullscreen",isFullscreen:"webkitFullscreenElement"}:t.msRequestFullscreen?{goFullscreen:"msRequestFullscreen",exitFullscreen:"msExitFullscreen",isFullscreen:"msFullscreenElement"}:t.requestFullscreen?{goFullscreen:"requestFullscreen",exitFullscreen:"exitFullscreen",isFullscreen:"fullscreenElement"}:!!e.domRef.player.webkitSupportsFullscreen&&{goFullscreen:"webkitEnterFullscreen",exitFullscreen:"webkitExitFullscreen",isFullscreen:"webkitDisplayingFullscreen"}},e.fullscreenOff=(t,n)=>{for(let e=0;e<t.length;e++)t[e].className=t[e].className.replace(/\bfluid_button_fullscreen_exit\b/g,"fluid_button_fullscreen");null!==n&&(n.innerHTML="Fullscreen"),e.fullscreenMode=!1},e.fullscreenOn=(t,n)=>{for(let e=0;e<t.length;e++)t[e].className=t[e].className.replace(/\bfluid_button_fullscreen\b/g,"fluid_button_fullscreen_exit");null!==n&&(n.innerHTML=e.displayOptions.captions.exitFullscreen),e.fullscreenMode=!0},e.fullscreenToggle=()=>{e.debugMessage("Toggling Full Screen");const t=e.domRef.player,n=e.domRef.wrapper,i=e.checkFullscreenSupport(),r=t.parentNode.getElementsByClassName("fluid_control_fullscreen"),a=n.querySelector(".context_option_fullscreen");let o;e.resetDisplayMode("fullScreen"),i?"webkitEnterFullscreen"===i.goFullscreen?t[i.isFullscreen]||(o="videoPlayerTag."+i.goFullscreen+"();",e.fullscreenOn(r,a),new Function("videoPlayerTag",o)(t)):(null===document[i.isFullscreen]?(o="videoPlayerTag."+i.goFullscreen+"();",e.fullscreenOn(r,a)):(o="document."+i.exitFullscreen+"();",e.fullscreenOff(r,a)),new Function("videoPlayerTag",o)(n)):-1!==n.className.search(/\bpseudo_fullscreen\b/g)?(n.className=n.className.replace(/\bpseudo_fullscreen\b/g,""),e.fullscreenOff(r,a)):(n.className+=" pseudo_fullscreen",e.fullscreenOn(r,a)),e.resizeVpaidAuto(),e.domRef.player.addEventListener("webkitendfullscreen",()=>{e.fullscreenOff(r,a)})},e.findClosestParent=(e,t)=>{let n,i=null;if(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].some(function(e){return"function"==typeof document.body[e]&&(i=e,!0)}),e[i](t))return e;for(;e;){if(n=e.parentElement,n&&n[i](t))return n;e=n}return null},e.getTranslateX=e=>{let t=null;try{const n=e.style.transform.match(/translate3d\((-?\d+px,\s?){2}-?\d+px\)/);n&&n.length&&(t=n[0].replace("translate3d(","").replace(")","").replace(/\s/g,"").replace(/px/g,"").split(","))}catch(e){t=null}return t&&3===t.length?parseInt(t[0]):0},e.getEventOffsetX=(t,n)=>{let i,r=0,a=0;for(;n&&!isNaN(n.offsetLeft);)a=e.getTranslateX(n),"BODY"===n.tagName?r+=n.offsetLeft+n.clientLeft+a-(n.scrollLeft||document.documentElement.scrollLeft):r+=n.offsetLeft+n.clientLeft+a-n.scrollLeft,n=n.offsetParent;return i=typeof t.touches<"u"&&typeof t.touches[0]<"u"?t.touches[0].clientX:t.clientX,i-r},e.getEventOffsetY=(t,n)=>{let i=1;const r=e.checkFullscreenSupport();r&&document[r.isFullscreen]&&(i=0);let a=0;for(;n&&!isNaN(n.offsetTop);)"BODY"===n.tagName?a+=n.offsetTop-(n.scrollTop||document.documentElement.scrollTop)*i:a+=n.offsetTop-n.scrollTop*i,n=n.offsetParent;return t.clientY-a},e.onProgressbarMouseDown=t=>{let n;if(e.displayOptions.layoutControls.playPauseAnimation=!1,n=e.displayOptions.layoutControls.showCardBoardView?e.getEventOffsetX(t,t.target.parentNode):e.getEventOffsetX(t,e.domRef.wrapper.querySelector(".fluid_controls_progress_container")),e.isCurrentlyPlayingAd)return;e.fluidPseudoPause=!0;const i=e.domRef.player.paused;i||e.domRef.player.pause();const r=t=>{const n=e.domRef.wrapper.querySelector(".fluid_controls_progress_container").clientWidth;if(!n)return void e.hideSuggestedVideos();const i=Math.abs(e.currentVideoDuration*t/n);e.domRef.player.currentTime=i,"safari"===e.getBrowserVersion().browserName.toLowerCase()&&(e.domRef.player.safariPlayheadPosition=i),e.hideSuggestedVideos()},a=t=>{const i=e.getEventOffsetX(t,t.target.parentNode);n=NaN,r(i),e.contolProgressbarUpdate(),e.controlDurationUpdate()},o=t=>{document.removeEventListener("mousemove",a),document.removeEventListener("touchmove",a),document.removeEventListener("mouseup",o),document.removeEventListener("touchend",o);let s=e.getEventOffsetX(t,t.target.parentNode);isNaN(s)&&!isNaN(n)&&(s=n),isNaN(s)||r(s),i||e.play(),e.initialAnimationSet&&setTimeout(()=>{e.displayOptions.layoutControls.playPauseAnimation=e.initialAnimationSet},200),e.fluidPseudoPause=!1};document.addEventListener("mouseup",o),document.addEventListener("touchend",o,{passive:!0}),document.addEventListener("mousemove",a),document.addEventListener("touchmove",a,{passive:!0})},e.onVolumeBarMouseDown=()=>{const t=t=>{const n=e.domRef.controls.volumeContainer.clientWidth;if(n){let i=t/n;i<.05?(i=0,e.domRef.player.muted=!0):i>.95&&(i=1),e.domRef.player.muted&&i>0&&(e.domRef.player.muted=!1),e.setVolume(i)}},n=n=>{const i=e.getEventOffsetX(n,e.domRef.controls.volumeContainer);t(i)},i=r=>{document.removeEventListener("mousemove",n),document.removeEventListener("touchmove",n),document.removeEventListener("mouseup",i),document.removeEventListener("touchend",i);const a=e.getEventOffsetX(r,e.domRef.controls.volumeContainer);isNaN(a)||t(a)};document.addEventListener("mouseup",i),document.addEventListener("touchend",i,{passive:!0}),document.addEventListener("mousemove",n),document.addEventListener("touchmove",n,{passive:!0})},e.findRoll=t=>{const n=[];if(n.length=0,t&&e.hasOwnProperty("rollsById")){for(let i in e.rollsById)e.rollsById.hasOwnProperty(i)&&e.rollsById[i].roll===t&&n.push(i);return n}},e.onKeyboardVolumeChange=t=>{let n=e.domRef.player.volume;"asc"===t?n+=.05:"desc"===t&&(n-=.05),n<.05?n=0:n>.95&&(n=1),e.setVolume(n)},e.onKeyboardSeekPosition=t=>{e.isCurrentlyPlayingAd||(e.domRef.player.currentTime=e.getNewCurrentTimeValueByKeyCode(t,e.domRef.player.currentTime,e.domRef.player.duration))},e.getNewCurrentTimeValueByKeyCode=(e,t,n)=>{let i=t;switch(e){case 35:i=n;break;case 36:i=0;break;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:if(e<58&&e>47){i=n*(10*(e-48))/100}}return i},e.handleMouseleave=t=>{typeof t.clientX<"u"&&e.domRef.wrapper.contains(document.elementFromPoint(t.clientX,t.clientY))||(e.hideControlBar(),e.hideTitle())},e.handleMouseenterForKeyboard=()=>{e.captureKey||(e.captureKey=t=>{t.stopPropagation();const n=t.keyCode;switch(n){case 70:e.fullscreenToggle(),t.preventDefault();break;case 13:case 32:e.playPauseToggle(),t.preventDefault();break;case 77:e.muteToggle(),t.preventDefault();break;case 38:e.onKeyboardVolumeChange("asc"),t.preventDefault();break;case 40:e.onKeyboardVolumeChange("desc"),t.preventDefault();break;case 37:e.skipRelative(-e.timeSkipOffsetAmount);break;case 39:e.skipRelative(e.timeSkipOffsetAmount);break;case 35:case 36:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:e.onKeyboardSeekPosition(n),t.preventDefault();break;case 73:e.toggleMiniPlayer(void 0,!0);break;case 187:case 61:case 43:case 107:case 171:e.displayOptions.layoutControls.subtitlesEnabled&&e.adjustSubtitleSizeByOperation("+");break;case 189:case 173:case 45:case 109:e.displayOptions.layoutControls.subtitlesEnabled&&e.adjustSubtitleSizeByOperation("-")}return!1},document.addEventListener("keydown",e.captureKey,!0))},e.keyboardControl=()=>{e.domRef.wrapper.addEventListener("click",e.handleMouseenterForKeyboard,!1);const t=e.handleWindowClick.bind(e);e.destructors.push(()=>{window.removeEventListener("click",t)}),window.addEventListener("click",t)},e.handleWindowClick=t=>{e.domRef.wrapper?e.domRef.wrapper.contains(t.target)||t.target.classList.contains(".js-skipHref")||(document.removeEventListener("keydown",e.captureKey,!0),delete e.captureKey,e.theatreMode&&!e.theatreModeAdvanced&&e.theatreToggle()):console.warn("Dangling click event listener should be collected for unknown wrapper.Did you forget to call destroy on player instance?")},e.initialPlay=()=>{if(e.domRef.player.addEventListener("playing",()=>{e.toggleLoader(!1)}),e.domRef.player.addEventListener("timeupdate",()=>{e.toggleLoader(!1)}),e.domRef.player.addEventListener("waiting",()=>{e.toggleLoader(!0)}),!e.displayOptions.layoutControls.playButtonShowing){e.domRef.wrapper.querySelector(".fluid_controls_container").classList.remove("initial_controls_show");const t=e.domRef.wrapper.querySelector(".logo_holder");t&&t.classList.remove("initial_controls_show")}e.firstPlayLaunched||(e.playPauseToggle(),e.domRef.player.removeEventListener("play",e.initialPlay))},e.playPauseToggle=()=>{e.hideSuggestedVideos();const t=!e.firstPlayLaunched,n=e.findRoll("preRoll");if(t&&0!==n.length){e.isCurrentlyPlayingAd=!0;const t=e.getBrowserVersion(),i=!1!==e.mobileInfo.userOs&&"Android"===e.mobileInfo.userOs&&"Google Chrome"===t.browserName;("Safari"===t.browserName||i)&&(e.domRef.player.src="https://cdn.fluidplayer.com/static/blank.mp4",e.domRef.player.play(),e.playPauseAnimationToggle(!0)),e.firstPlayLaunched=!0,e.prepareVast("preRoll"),e.preRollAdPodsLength=n.length}else t&&0===n.length&&(e.firstPlayLaunched=!0,e.displayOptions.vastOptions.vastAdvanced.noVastVideoCallback()),e.domRef.player.paused?(e.isCurrentlyPlayingAd&&null!==e.vastOptions&&e.vastOptions.vpaid?e.resumeVpaidAd():(0!==Math.floor(e.domRef.player.currentTime)&&Math.floor(e.currentVideoDuration)===Math.floor(e.domRef.player.currentTime)&&(e.initialiseStreamers(),e.domRef.player.currentTime=0),e.hlsPlayer&&!e.hlsPlayer.config.autoStartLoad&&e.hlsPlayer.startLoad(),e.dashPlayer?e.dashPlayer.play():e.domRef.player.play()),e.playPauseAnimationToggle(!0)):t||(e.isCurrentlyPlayingAd&&null!==e.vastOptions&&e.vastOptions.vpaid?e.pauseVpaidAd():e.domRef.player.pause(),e.playPauseAnimationToggle(!1)),e.toggleOnPauseAd();const i=()=>{e.prepareVast("onPauseRoll"),e.scheduleOnDemandRolls()};if(t){const t=e.domRef.wrapper.querySelector(".fluid_pseudo_poster");t&&t.parentNode.removeChild(t),e.mainVideoDuration>0?i():e.domRef.player.addEventListener("mainVideoDurationSet",i)}e.adTimer();const r=e.domRef.wrapper.querySelector(".fluid_html_on_pause_container");r&&!e.isCurrentlyPlayingAd&&(e.domRef.player.paused?r.style.display="flex":r.style.display="none")},e.setCustomControls=()=>{e.trackEvent(e.domRef.player.parentNode,"click",".fluid_control_playpause",()=>{e.firstPlayLaunched||e.domRef.player.removeEventListener("play",e.initialPlay),e.playPauseToggle()},!1),e.domRef.player.addEventListener("play",()=>{e.controlPlayPauseToggle(),e.contolVolumebarUpdate()},!1),e.domRef.player.addEventListener("fluidplayerpause",()=>{e.controlPlayPauseToggle()},!1),e.domRef.player.addEventListener("timeupdate",()=>{e.contolProgressbarUpdate(),e.controlDurationUpdate()});const t=e.getMobileOs().userOs?"touchstart":"mousedown";e.displayOptions.layoutControls.showCardBoardView?e.trackEvent(e.domRef.player.parentNode,t,".fluid_controls_progress_container",t=>e.onProgressbarMouseDown(t),!1):e.domRef.wrapper.querySelector(".fluid_controls_progress_container").addEventListener(t,t=>e.onProgressbarMouseDown(t),{passive:!0}),e.domRef.wrapper.querySelector(".fluid_control_volume_container").addEventListener(t,t=>e.onVolumeBarMouseDown(),{passive:!0}),e.domRef.player.addEventListener("volumechange",()=>e.contolVolumebarUpdate()),e.trackEvent(e.domRef.player.parentNode,"click",".fluid_control_mute",()=>e.muteToggle()),e.setBuffering(),e.trackEvent(e.domRef.player.parentNode,"click",".fluid_control_fullscreen",()=>e.fullscreenToggle()),e.displayOptions.layoutControls.allowTheatre&&!e.isInIframe?(e.domRef.wrapper.querySelector(".fluid_control_theatre").style.display="inline-block",e.trackEvent(e.domRef.player.parentNode,"click",".fluid_control_theatre",()=>e.theatreToggle())):e.domRef.wrapper.querySelector(".fluid_control_theatre").style.display="none",e.displayOptions.layoutControls.miniPlayer.enabled&&!e.isInIframe&&e.trackEvent(e.domRef.player.parentNode,"click",".fluid_control_mini_player",()=>e.toggleMiniPlayer(void 0,!0)),e.domRef.player.addEventListener("ratechange",()=>{e.isCurrentlyPlayingAd&&(e.playbackRate=1)})},e.createTimePositionPreview=()=>{if(!e.showTimeOnHover)return;const t=e.domRef.wrapper.querySelector(".fluid_controls_progress_container"),n=document.createElement("div");n.className="fluid_timeline_preview",n.style.display="none",n.style.position="absolute",t.appendChild(n),e.domRef.wrapper.querySelector(".fluid_controls_progress_container").addEventListener("mousemove",t=>{const n=e.domRef.wrapper.querySelector(".fluid_controls_progress_container"),i=n.clientWidth,r=e.domRef.wrapper.querySelector(".fluid_timeline_preview"),a=e.getEventOffsetX(t,n),o=e.currentVideoDuration*a/i;r.innerText=e.formatTime(o),r.style.display="block",r.style.left=o/e.domRef.player.duration*100+"%"},!1),e.domRef.wrapper.querySelector(".fluid_controls_progress_container").addEventListener("mouseout",()=>{e.domRef.wrapper.querySelector(".fluid_timeline_preview").style.display="none"},!1)},e.setCustomContextMenu=()=>{const t=e.domRef.wrapper,n=e.displayOptions.layoutControls.contextMenu.controls,i=e.displayOptions.layoutControls.contextMenu.links,r=document.createElement("div");r.className="fluid_context_menu",r.style.display="none",r.style.position="absolute";const a=document.createElement("ul");if(r.appendChild(a),Array.isArray(i)&&i.forEach(function(e,t){const n=document.createElement("li");n.innerHTML=e.label,n.addEventListener("click",()=>window.open(e.href,"_blank"),!1),a.appendChild(n)}),n){const t=document.createElement("li");t.className="context_option_play",t.innerHTML=e.displayOptions.captions.play,t.addEventListener("click",()=>e.playPauseToggle(),!1),a.appendChild(t);const n=document.createElement("li");n.className="context_option_mute",n.innerHTML=e.displayOptions.captions.mute,n.addEventListener("click",()=>e.muteToggle(),!1),a.appendChild(n);const i=document.createElement("li");i.className="context_option_fullscreen",i.innerHTML=e.displayOptions.captions.fullscreen,i.addEventListener("click",()=>e.fullscreenToggle(),!1),a.appendChild(i)}const o=document.createElement("li");o.innerHTML="Fluid Player "+e.version,o.addEventListener("click",()=>window.open(e.homepage,"_blank"),!1),a.appendChild(o),e.domRef.player.parentNode.insertBefore(r,e.domRef.player.nextSibling),t.addEventListener("contextmenu",t=>{t.preventDefault(),r.style.left=e.getEventOffsetX(t,e.domRef.player)+"px",r.style.top=e.getEventOffsetY(t,e.domRef.player)+"px",r.style.display="block"},!1),document.addEventListener("click",t=>{(t.target!==e.domRef.player||2!==t.button)&&(r.style.display="none")},!1)},e.setDefaultLayout=()=>{e.domRef.wrapper.className+=" fluid_player_layout_"+e.displayOptions.layoutControls.layout,e.setCustomContextMenu();const t=e.generateCustomControlTags({displayVolumeBar:e.checkShouldDisplayVolumeBar(),primaryColor:e.displayOptions.layoutControls.primaryColor?e.displayOptions.layoutControls.primaryColor:"red",controlForwardBackward:!!e.displayOptions.layoutControls.controlForwardBackward.show,miniPlayer:e.displayOptions.layoutControls.miniPlayer});e.domRef.player.removeAttribute("controls"),e.domRef.player.parentNode.insertBefore(t.root,e.domRef.player.nextSibling),e.domRef.player.parentNode.insertBefore(t.loader,e.domRef.player.nextSibling),e.domRef.controls=t;let n=100,i=setInterval(function(){n?e.checkIfVolumebarIsRendered()?(clearInterval(i),e.contolVolumebarUpdate()):n--:clearInterval(i)},100);if(e.destructors.push(()=>clearInterval(i)),e.displayOptions.layoutControls.doubleclickFullscreen&&!(e.isTouchDevice()||!e.displayOptions.layoutControls.controlForwardBackward.doubleTapMobile)&&e.domRef.player.addEventListener("dblclick",e.fullscreenToggle),"iOS"===e.getMobileOs().userOs){let t=!1;new IntersectionObserver(n=>{n.forEach(n=>{n.isIntersecting?(e.domRef.player.inView=!0,e.displayOptions.layoutControls.autoRotateFullScreen&&e.isTouchDevice()&&!t&&(window.matchMedia("(orientation: landscape)").addEventListener("change",e.handleOrientationChange),t=!0)):e.domRef.player.inView=!1})}).observe(e.domRef.player)}e.initHtmlOnPauseBlock(),e.setCustomControls(),e.setupThumbnailPreview(),e.createTimePositionPreview(),e.posterImage(),e.initPlayButton(),e.setVideoPreload(),e.createPlaybackList(),e.createDownload(),e.toggleMiniPlayerScreenDetection(),e.displayOptions.layoutControls.controlForwardBackward.show&&e.initSkipControls(),e.displayOptions.layoutControls.controlForwardBackward.doubleTapMobile&&e.initDoubleTapSkip(),e.initSkipAnimationElements()},e.initSkipControls=()=>{e.domRef.controls.skipBack.addEventListener("click",e.skipRelative.bind(this,-e.timeSkipOffsetAmount)),e.domRef.controls.skipForward.addEventListener("click",e.skipRelative.bind(this,e.timeSkipOffsetAmount))},e.handleOrientationChange=()=>{const t=window.matchMedia("(orientation: landscape)").matches,n=e.domRef.player,i=e.domRef.wrapper,r=e.checkFullscreenSupport(),a=n.parentNode.getElementsByClassName("fluid_control_fullscreen"),o=i.querySelector(".context_option_fullscreen");let s;t&&e.domRef.player.inView?r?"webkitEnterFullscreen"===r.goFullscreen?(s="videoPlayerTag."+r.goFullscreen+"();",e.fullscreenOn(a,o),new Function("videoPlayerTag",s)(n)):(null===document[r.isFullscreen]&&(s="videoPlayerTag."+r.goFullscreen+"();",e.fullscreenOn(a,o)),new Function("videoPlayerTag",s)(i)):(i.className+=" pseudo_fullscreen",e.fullscreenOn(a,o)):(i.className=i.className.replace(/\bpseudo_fullscreen\b/g,""),r?(s="document."+r.exitFullscreen+"();",e.fullscreenOff(a,o),new Function("videoPlayerTag",s)(i)):-1!==i.className.search(/\bpseudo_fullscreen\b/g)&&(i.className=i.className.replace(/\bpseudo_fullscreen\b/g,""),e.fullscreenOff(a,o))),e.resizeVpaidAuto()},e.initSkipAnimationElements=function(){const t=document.createElement("div");t.classList.add("fluid_player_skip_offset");const n=document.createElement("div");n.classList.add("fluid_player_skip_offset__backward"),t.appendChild(n);const i=document.createElement("div");i.classList.add("fluid_player_skip_offset__backward-icon"),i.ontransitionend=()=>i.classList.remove("animate"),n.appendChild(i);const r=document.createElement("div");r.classList.add("fluid_player_skip_offset__forward"),t.appendChild(r);const a=document.createElement("div");a.classList.add("fluid_player_skip_offset__forward-icon"),a.ontransitionend=()=>a.classList.remove("animate"),r.appendChild(a),e.domRef.player.parentNode.insertBefore(t,e.domRef.player.nextSibling)},e.initDoubleTapSkip=()=>{let t=!1,n=[];e.domRef.player.addEventListener("pointerdown",i=>{if(!e.isTouchDevice())return;const r=e.isControlBarVisible(),{offsetX:a}=i,{clientWidth:o}=e.domRef.player;if(n.push(setTimeout(()=>{t=!1,r&&e.playPauseToggle()},300)),t)return n.forEach(e=>clearTimeout(e)),n=[],t=!1,e.skipRelative(a<o/2?-e.timeSkipOffsetAmount:e.timeSkipOffsetAmount);t=!0})},e.skipRelative=function(t){if(e.debugMessage("skipping video time by ",t),e.isCurrentlyPlayingAd)return;let n=e.domRef.player.currentTime+t;n<0&&(n=0),e.domRef.player.currentTime=n,t>=0?e.domRef.wrapper.querySelector(".fluid_player_skip_offset__forward-icon").classList.add("animate"):e.domRef.wrapper.querySelector(".fluid_player_skip_offset__backward-icon").classList.add("animate")},e.checkIfVolumebarIsRendered=()=>{const t=e.domRef.wrapper.querySelector(".fluid_control_volume_currentpos"),n=e.domRef.wrapper.querySelector(".fluid_control_volume").clientWidth;return t.clientWidth!==n},e.setLayout=()=>{e.isTouchDevice()||e.domRef.player.addEventListener("click",()=>e.playPauseToggle(),!1),e.domRef.player.addEventListener("play",e.initialPlay,!1),e.setDefaultLayout()},e.handleFullscreen=()=>{typeof document.vastFullsreenChangeEventListenersAdded<"u"||(["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","msfullscreenchange"].forEach(t=>{"object"==typeof document["on"+t]&&document.addEventListener(t,function(t){e.recalculateAdDimensions()},!1)}),document.vastFullsreenChangeEventListenersAdded=!0)},e.setupPlayerWrapper=()=>{const t=document.createElement("div");t.id="fluid_video_wrapper_"+e.videoPlayerId,t.className=e.isTouchDevice()?"fluid_video_wrapper mobile":"fluid_video_wrapper",e.displayOptions.layoutControls.fillToContainer?(t.style.width="100%",t.style.height="100%"):(t.style.height=e.domRef.player.clientHeight+"px",t.style.width=e.domRef.player.clientWidth+"px");return t.style.borderRadius=e.domRef.player.style.borderRadius=(()=>{const t=e.displayOptions.layoutControls.roundedCorners,n=Number(t);return isNaN(n)||0===n?t:"".concat(n,"px")})(),t.style.overflow="hidden",e.domRef.player.style.height="100%",e.domRef.player.style.width="100%",e.domRef.player.parentNode.insertBefore(t,e.domRef.player),t.appendChild(e.domRef.player),t},e.onErrorDetection=()=>{e.domRef.player.networkState===e.domRef.player.NETWORK_NO_SOURCE&&e.isCurrentlyPlayingAd&&e.playMainVideoWhenVastFails(401)},e.createVideoSourceSwitch=function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const n=[],i=e.domRef.player.querySelectorAll("source");[].forEach.call(i,e=>{e.title&&e.src&&n.push({title:e.title,url:e.src,isHD:null!=e.getAttribute("data-fluid-hd")})});const r=e.domRef.wrapper.querySelector(".fluid_control_video_source");if(e.videoSources=n,e.videoSources.length>1?r.style.display="inline-block":r.style.display="none",e.videoSources.length<=1)return;let a=!1;const o=document.createElement("div");o.className="fluid_video_sources_list",o.style.display="none";let s=!0;for(const n of e.videoSources){const i=n.url.split(".").pop();if("iOS"===e.mobileInfo.userOs&&"mkv"===i)continue;s&&!t&&(e.domRef.player.src=n.url);const r=s?"source_selected":"",l=n.isHD?'<sup style="color:'+e.displayOptions.layoutControls.primaryColor+'" class="fp_hd_source"></sup>':"";s=!1;const c=document.createElement("div");c.className="fluid_video_source_list_item js-source_"+n.title,c.innerHTML='<span class="source_button_icon '+r+'"></span>'+n.title+l,c.addEventListener("click",function(t){t.stopPropagation(),e.domRef.player.style.width=e.domRef.player.clientWidth+"px",e.domRef.player.style.height=e.domRef.player.clientHeight+"px";const n=this,i=e.domRef.wrapper.getElementsByClassName("source_button_icon");for(let e=0;e<i.length;e++)i[e].className=i[e].className.replace("source_selected","");n.firstChild.className+=" source_selected",e.videoSources.forEach(t=>{t.title===n.innerText.replace(/(\r\n\t|\n|\r\t)/gm,"")&&(e.setBuffering(),e.setVideoSource(t.url),e.fluidStorage.fluidQuality=t.title)}),e.openCloseVideoSourceSwitch()}),o.appendChild(c),a=!0}a?(r.appendChild(o),r.removeEventListener("click",e.openCloseVideoSourceSwitch),r.addEventListener("click",e.openCloseVideoSourceSwitch)):e.domRef.wrapper.querySelector(".fluid_control_video_source").style.display="none"},e.openCloseVideoSourceSwitch=()=>{const t=e.domRef.wrapper.querySelector(".fluid_video_sources_list");if(e.isCurrentlyPlayingAd||e.isShowingSuggestedVideos())return void(t.style.display="none");if("none"!==t.style.display)return void(t.style.display="none");t.style.display="block";const n=()=>{t.removeEventListener("mouseleave",n),t.style.display="none"};t.addEventListener("mouseleave",n)},e.setVideoSource=t=>{if("iOS"===e.mobileInfo.userOs&&t.indexOf(".mkv")>0)return console.log("[FP_ERROR] .mkv files not supported by iOS devices."),!1;if(e.isCurrentlyPlayingAd)return void(e.originalSrc=t);e.isSwitchingSource=!0;let n=!1;e.domRef.player.paused||(e.domRef.player.pause(),n=!0);const i=e.domRef.player.currentTime;e.setCurrentTimeAndPlay(i,n),e.domRef.player.src=t,e.originalSrc=t,e.displayOptions.layoutControls.mediaType=e.getCurrentSrcType(),e.initialiseStreamers()},e.setCurrentTimeAndPlay=(t,n)=>{const i=()=>{e.domRef.player.currentTime=t,e.domRef.player.removeEventListener("loadedmetadata",i),("iOS"===e.mobileInfo.userOs||"safari"===e.getBrowserVersion().browserName.toLowerCase())&&e.domRef.player.addEventListener("playing",r),n?e.domRef.player.play():(e.domRef.player.pause(),e.controlPlayPauseToggle()),e.isSwitchingSource=!1,e.domRef.player.style.width="100%",e.domRef.player.style.height="100%"};let r=()=>{e.currentTime=t,e.domRef.player.removeEventListener("playing",r)};e.domRef.player.addEventListener("loadedmetadata",i,!1),e.domRef.player.load()},e.initTitle=()=>{if(!e.displayOptions.layoutControls.title)return;const t=document.createElement("div");e.domRef.player.parentNode.insertBefore(t,null),t.innerHTML+=e.displayOptions.layoutControls.title,t.classList.add("fp_title")},e.hasTitle=()=>{const t=e.domRef.wrapper.querySelector(".fp_title"),n=e.displayOptions.layoutControls.title;return t&&null!=n},e.hideTitle=()=>{const t=e.domRef.wrapper.querySelector(".fp_title");e.hasTitle()&&t.classList.add("fade_out")},e.showTitle=()=>{const t=e.domRef.wrapper.querySelector(".fp_title");e.hasTitle()&&t.classList.remove("fade_out")},e.initLogo=()=>{if(!e.displayOptions.layoutControls.logo.imageUrl)return;const t=document.createElement("div");t.className="logo_holder",e.displayOptions.layoutControls.logo.hideWithControls?t.classList.add("initial_controls_show","fp_logo"):t.classList.add("logo_maintain_display");const n=document.createElement("img");e.displayOptions.layoutControls.logo.imageUrl&&(n.src=e.displayOptions.layoutControls.logo.imageUrl),n.style.position="absolute",n.style.margin=e.displayOptions.layoutControls.logo.imageMargin;const i=e.displayOptions.layoutControls.logo.position.toLowerCase();-1!==i.indexOf("bottom")?n.style.bottom=0:n.style.top=0,-1!==i.indexOf("right")?n.style.right=0:n.style.left=0,e.displayOptions.layoutControls.logo.opacity&&(n.style.opacity=e.displayOptions.layoutControls.logo.opacity),null!==e.displayOptions.layoutControls.logo.clickUrl&&(n.style.cursor="pointer",n.addEventListener("click",function(){window.open(e.displayOptions.layoutControls.logo.clickUrl,"_blank").focus()})),e.displayOptions.layoutControls.logo.mouseOverImageUrl&&(n.addEventListener("mouseover",function(){n.src=e.displayOptions.layoutControls.logo.mouseOverImageUrl},!1),n.addEventListener("mouseout",function(){n.src=e.displayOptions.layoutControls.logo.imageUrl},!1)),e.domRef.player.parentNode.insertBefore(t,null),t.appendChild(n,null)},e.initHtmlOnPauseBlock=()=>{if(e.hasValidOnPauseAd()||!e.displayOptions.layoutControls.htmlOnPauseBlock.html)return;const t=document.createElement("div");t.className="fluid_html_on_pause_container",t.style.display="none",t.innerHTML=e.displayOptions.layoutControls.htmlOnPauseBlock.html,t.onclick=function(t){e.playPauseToggle()},e.displayOptions.layoutControls.htmlOnPauseBlock.width&&(t.style.width=e.displayOptions.layoutControls.htmlOnPauseBlock.width+"px"),e.displayOptions.layoutControls.htmlOnPauseBlock.height&&(t.style.height=e.displayOptions.layoutControls.htmlOnPauseBlock.height+"px"),e.domRef.player.parentNode.insertBefore(t,null)},e.initPlayButton=()=>{const t=document.createElement("div");t.className="fluid_html_on_pause fluid_initial_play_button_container";const n=e.displayOptions.layoutControls.primaryColor?e.displayOptions.layoutControls.primaryColor:"#333333";t.innerHTML='<div class="fluid_initial_play" style="background-color:'+n+'"><div class="fluid_initial_play_button"></div></div>';const i=["click","touchend"],r=function(){e.playPauseToggle(),i.forEach(e=>t.removeEventListener(e,r))};i.forEach(e=>t.addEventListener(e,r)),e.displayOptions.layoutControls.playButtonShowing||(e.domRef.wrapper.querySelector(".fluid_controls_container").classList.add("initial_controls_show"),t.style.opacity="0"),e.domRef.player.parentNode.insertBefore(t,null)},e.mainVideoReady=()=>{if(0!==e.mainVideoDuration||e.isCurrentlyPlayingAd||!1!==e.mainVideoReadyState)return;const t=new CustomEvent("mainVideoDurationSet");e.mainVideoDuration=e.domRef.player.duration,e.mainVideoReadyState=!0,e.domRef.player.dispatchEvent(t),e.domRef.player.removeEventListener("loadedmetadata",e.mainVideoReady)},e.userActivityChecker=()=>{const t=e.domRef.wrapper;e.newActivity=null;let n=!1;const i=t=>{("touchstart"===t.type||"mousedown"===t.type)&&(n=!0),("touchend"===t.type||"mouseup"===t.type)&&(n=!1),e.newActivity=!0},r=setInterval(()=>{if(!0===e.newActivity){if(!n&&!e.isLoading&&(e.newActivity=!1),!1===e.isUserActive||!e.isControlBarVisible()){let t=new CustomEvent("userActive");e.domRef.player.dispatchEvent(t),e.isUserActive=!0}clearTimeout(e.inactivityTimeout),e.inactivityTimeout=setTimeout(()=>{if(!0===e.newActivity)return void clearTimeout(e.inactivityTimeout);e.isUserActive=!1;let t=new CustomEvent("userInactive");e.domRef.player.dispatchEvent(t)},1e3*e.displayOptions.layoutControls.controlBar.autoHideTimeout)}},300);e.destructors.push(()=>clearInterval(r));const a=e.isTouchDevice()?["touchstart","touchmove","touchend"]:["mousemove","mousedown","mouseup"];for(let e=0;e<a.length;e++)t.addEventListener(a[e],i,{passive:!0})},e.hasControlBar=()=>!!e.domRef.wrapper.querySelector(".fluid_controls_container"),e.isControlBarVisible=()=>{if(!1===e.hasControlBar())return!1;const t=e.domRef.wrapper.querySelector(".fluid_controls_container"),n=window.getComputedStyle(t,null);return!(0===n.opacity||"hidden"===n.visibility)},e.setVideoPreload=()=>{e.domRef.player.setAttribute("preload",e.displayOptions.layoutControls.preload)},e.hideControlBar=()=>{if(e.isCurrentlyPlayingAd&&!e.domRef.player.paused&&e.toggleAdCountdown(!0),e.domRef.player.style.cursor="none",!e.hasControlBar())return;const t=e.domRef.player.parentNode.getElementsByClassName("fluid_controls_container"),n=e.domRef.player.parentNode.getElementsByClassName("fp_logo");for(let n=0;n<t.length;n++)e.displayOptions.layoutControls.controlBar.animated?(t[n].classList.remove("fade_in"),t[n].classList.add("fade_out")):t[n].style.display="none";if(e.displayOptions.layoutControls.logo.hideWithControls)for(let t=0;t<n.length;t++)e.displayOptions.layoutControls.controlBar.animated?n[t]&&(n[t].classList.remove("fade_in"),n[t].classList.add("fade_out")):n[t]&&(n[t].style.display="none");e.repositionSubtitlesContainer("12px")},e.showControlBar=t=>{if(e.isCurrentlyPlayingAd&&!e.domRef.player.paused&&e.toggleAdCountdown(!1),("mouseenter"===t.type||"userActive"===t.type)&&(e.domRef.player.style.cursor="default"),!e.hasControlBar())return;const n=e.domRef.player.parentNode.getElementsByClassName("fluid_controls_container"),i=e.domRef.player.parentNode.getElementsByClassName("fp_logo");for(let t=0;t<n.length;t++)e.displayOptions.layoutControls.controlBar.animated?(n[t].classList.remove("fade_out"),n[t].classList.add("fade_in")):n[t].style.display="block";if(e.displayOptions.layoutControls.logo.hideWithControls)for(let t=0;t<i.length;t++)e.displayOptions.layoutControls.controlBar.animated?i[t]&&(i[t].classList.remove("fade_out"),i[t].classList.add("fade_in")):i[t]&&(i[t].style.display="block");e.repositionSubtitlesContainer("46px")},e.linkControlBarUserActivity=()=>{e.domRef.player.addEventListener("userInactive",e.hideControlBar),e.domRef.player.addEventListener("userInactive",e.hideTitle),e.domRef.player.addEventListener("userActive",e.showControlBar),e.domRef.player.addEventListener("userActive",e.showTitle)},e.initMute=()=>{!0===e.displayOptions.layoutControls.mute&&(e.domRef.player.volume=0)},e.initLoop=()=>{e.domRef.player.loop=!!e.displayOptions.layoutControls.loop},e.setBuffering=()=>{let t;const n=e.domRef.player.parentNode.getElementsByClassName("fluid_controls_buffered");for(let e=0;e<n.length;e++)n[e].style.width=0;t=setInterval(()=>{const i=e.domRef.player.duration;if(!(i<=0))for(let r=0;r<e.domRef.player.buffered.length;r++){if(e.domRef.player.buffered.start(e.domRef.player.buffered.length-1-r)>=e.domRef.player.currentTime)continue;const a=e.domRef.player.buffered.end(e.domRef.player.buffered.length-1-r)/i*100+"%";for(let e=0;e<n.length;e++)n[e].style.width=a;t&&e.domRef.player.buffered.end(e.domRef.player.buffered.length-1-r)/i===1&&clearInterval(t);break}},500),e.destructors.push(()=>clearInterval(t))},e.createPlaybackList=()=>{if(!e.displayOptions.layoutControls.playbackRateEnabled)return;const t=e.domRef.wrapper.querySelector(".fluid_control_playback_rate");t.style.display="inline-block";const n=document.createElement("div");n.className="fluid_video_playback_rates",n.style.display="none",(!Array.isArray(e.displayOptions.layoutControls.controlBar.playbackRates)||e.displayOptions.layoutControls.controlBar.playbackRates.some(e=>"string"!=typeof e||Number.isNaN(Number(e.replace("x","")))))&&(e.displayOptions.layoutControls.controlBar.playbackRates=["x2","x1.5","x1","x0.5"]),e.displayOptions.layoutControls.controlBar.playbackRates.forEach(function(t){const i=document.createElement("div");i.className="fluid_video_playback_rates_item",i.innerText=t,i.addEventListener("click",function(t){t.stopPropagation();let n=this.innerText.replace("x","");e.setPlaybackSpeed(n),e.openCloseVideoPlaybackRate()}),n.appendChild(i)}),t.appendChild(n),t.addEventListener("click",function(){e.openCloseVideoPlaybackRate()})},e.openCloseVideoPlaybackRate=()=>{const t=e.domRef.wrapper.querySelector(".fluid_video_playback_rates");if(e.isCurrentlyPlayingAd||"none"!==t.style.display)return void(t.style.display="none");t.style.display="block";const n=function(){t.removeEventListener("mouseleave",n),t.style.display="none"};t.addEventListener("mouseleave",n)},e.createDownload=()=>{const t=e.domRef.wrapper.querySelector(".fluid_control_download");if(!e.displayOptions.layoutControls.allowDownload)return;t.style.display="inline-block";let n=document.createElement("a");n.className="fp_download_click",n.onclick=function(e){const t=this;typeof e.stopImmediatePropagation<"u"&&e.stopImmediatePropagation(),setTimeout(function(){t.download="",t.href=""},100)},t.appendChild(n),t.addEventListener("click",function(){const t=e.domRef.wrapper.querySelector(".fp_download_click");t.download=e.originalSrc,t.href=e.originalSrc,n.click()})},e.theatreToggle=()=>{if(e.debugMessage("Toggling Theater Mode"),e.isInIframe)return;if(this.resetDisplayMode("theaterMode"),e.displayOptions.layoutControls.theatreAdvanced){const t=e.domRef.wrapper.querySelector("#".concat(e.displayOptions.layoutControls.theatreAdvanced.theatreElement)),n=e.displayOptions.layoutControls.theatreAdvanced.classToApply;null!=t&&null!=n?(e.theatreMode?t.classList.remove(n):t.classList.add(n),e.theatreModeAdvanced=!e.theatreModeAdvanced):(console.log("[FP_ERROR] Theatre mode elements could not be found, defaulting behaviour."),e.defaultTheatre())}else e.defaultTheatre();e.theatreMode=!e.theatreMode,e.fluidStorage.fluidTheatre=e.theatreMode;const t=e.theatreMode?"theatreModeOn":"theatreModeOff",n=document.createEvent("CustomEvent");n.initEvent(t,!1,!0),e.domRef.player.dispatchEvent(n),e.resizeVpaidAuto()},e.defaultTheatre=()=>{const t=e.domRef.wrapper;if(e.theatreMode)return t.classList.remove("fluid_theatre_mode"),t.style.maxHeight="",t.style.marginTop="",t.style.left="",t.style.right="",t.style.position="",void(e.displayOptions.layoutControls.fillToContainer?(t.style.width="100%",t.style.height="100%"):(t.style.width=e.originalWidth+"px",t.style.height=e.originalHeight+"px"));t.classList.add("fluid_theatre_mode");const n=e.displayOptions.layoutControls.theatreSettings.width;let i="10px";switch(t.style.width=n,t.style.height=e.displayOptions.layoutControls.theatreSettings.height,t.style.maxHeight=screen.height+"px",t.style.marginTop=e.displayOptions.layoutControls.theatreSettings.marginTop+"px",e.displayOptions.layoutControls.theatreSettings.horizontalAlign){case"center":"string"==typeof n&&"%"===n.substr(n.length-1)?i=(100-parseInt(n.substring(0,n.length-1)))/2+"%":"string"==typeof n&&"px"===n.substr(n.length-2)?i=(screen.width-parseInt(n.substring(0,n.length-2)))/screen.width*100/2+"%":console.log("[FP_ERROR] Theatre width specified invalid."),t.style.left=i;break;case"right":t.style.right=i;break;default:t.style.left=i}},e.posterImage=()=>{if(!e.displayOptions.layoutControls.posterImage)return;const t=document.createElement("div");t.className="fluid_pseudo_poster",-1!==["auto","contain","cover"].indexOf(e.displayOptions.layoutControls.posterImageSize)?(t.style.background="url('"+e.displayOptions.layoutControls.posterImage+"') center center / "+e.displayOptions.layoutControls.posterImageSize+" no-repeat black",e.domRef.player.parentNode.insertBefore(t,null)):console.log("[FP_ERROR] Not allowed value in posterImageSize")},e.nextSource=()=>{const t=e.domRef.player.getElementsByTagName("source");if(!t.length)return null;for(let n=0;n<t.length-1;n++)if(t[n].getAttribute("src")===e.originalSrc&&t[n+1].getAttribute("src"))return void e.setVideoSource(t[n+1].getAttribute("src"))},e.inIframe=()=>{try{return window.self!==window.top}catch(e){return!0}},e.setPersistentSettings=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{if(!(typeof Storage<"u"&&typeof localStorage<"u"))return}catch(e){return}const n="_fp_storage_enabled",i=localStorage;try{i.setItem(n,"1"),i.removeItem(n)}catch(e){return!1}if(e.fluidStorage=localStorage,typeof e.fluidStorage.fluidVolume<"u"&&e.displayOptions.layoutControls.persistentSettings.volume&&!t&&(e.setVolume(e.fluidStorage.fluidVolume),typeof e.fluidStorage.fluidMute<"u"&&"true"===e.fluidStorage.fluidMute&&e.muteToggle()),typeof e.fluidStorage.fluidQuality<"u"&&e.displayOptions.layoutControls.persistentSettings.quality){const t=e.domRef.wrapper.querySelector(".js-source_"+e.fluidStorage.fluidQuality),n=e.domRef.wrapper.querySelector(".fluid_control_video_source");t&&(t.click(),n.click())}typeof e.fluidStorage.fluidSpeed<"u"&&e.displayOptions.layoutControls.persistentSettings.speed&&e.setPlaybackSpeed(e.fluidStorage.fluidSpeed),typeof e.fluidStorage.fluidTheatre<"u"&&"true"===e.fluidStorage.fluidTheatre&&e.displayOptions.layoutControls.persistentSettings.theatre&&e.theatreToggle()},e.play=()=>{if(e.domRef.player.paused)return e.playPauseToggle(),!0},e.pause=()=>(e.domRef.player.paused||e.playPauseToggle(),!0),e.skipTo=t=>{e.domRef.player.currentTime=t},e.setPlaybackSpeed=t=>{e.isCurrentlyPlayingAd||(e.domRef.player.playbackRate=t,e.fluidStorage.fluidSpeed=t)},e.setVolume=t=>{e.domRef.player.volume=t;const n=0===t?1:t;e.latestVolume=n,e.fluidStorage.fluidVolume=n},e.isCurrentlyPlayingVideo=e=>e&&e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2,e.setHtmlOnPauseBlock=t=>{if("object"!=typeof t||typeof t.html>"u")return!1;const n=e.domRef.wrapper.querySelector(".fluid_html_on_pause_container");if(!n){const n=document.createElement("div");return n.className="fluid_html_on_pause",n.style.display="none",n.innerHTML=t.html,n.onclick=function(){e.playPauseToggle()},t.width&&(n.style.width=t.width+"px"),t.height&&(n.style.height=t.height+"px"),void e.domRef.player.parentNode.insertBefore(n,null)}n.innerHTML=t.html,t.width&&(n.style.width=t.width+"px"),t.height&&(n.style.height=t.height+"px")},e.toggleControlBar=t=>{const n=e.domRef.wrapper.querySelector(".fluid_controls_container");t?n.className+=" initial_controls_show":n.className=n.className.replace(" initial_controls_show","")},e.on=(t,n)=>{const i=function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=_objectSpread(_objectSpread({},{mediaSourceType:e.currentMediaSourceType}),i);return n(t,r)},r={play:()=>e.domRef.player.addEventListener("play",i),seeked:()=>e.domRef.player.addEventListener("seeked",i),ended:()=>e.domRef.player.addEventListener("ended",i),pause:()=>e.domRef.player.addEventListener("pause",t=>{e.fluidPseudoPause||i(t)}),playing:()=>e.domRef.player.addEventListener("playing",i),waiting:()=>e.domRef.player.addEventListener("waiting",i),theatreModeOn:()=>e.domRef.player.addEventListener("theatreModeOn",i),theatreModeOff:()=>e.domRef.player.addEventListener("theatreModeOff",i),timeupdate:()=>e.domRef.player.addEventListener("timeupdate",t=>{i(t,{currentTime:e.domRef.player.currentTime})}),miniPlayerToggle:()=>e.domRef.player.addEventListener("miniPlayerToggle",i)};r[t]?r[t]():console.error('[FP_ERROR] Event "'.concat(t,'" is not recognized'))},e.toggleLogo=t=>{if("object"!=typeof t||!t.imageUrl)return!1;const n=e.domRef.wrapper.querySelector(".fp_logo");e.displayOptions.layoutControls.logo.imageUrl=t.imageUrl?t.imageUrl:null,e.displayOptions.layoutControls.logo.position=t.position?t.position:"top left",e.displayOptions.layoutControls.logo.clickUrl=t.clickUrl?t.clickUrl:null,e.displayOptions.layoutControls.logo.opacity=t.opacity?t.opacity:1,e.displayOptions.layoutControls.logo.mouseOverImageUrl=t.mouseOverImageUrl?t.mouseOverImageUrl:null,e.displayOptions.layoutControls.logo.imageMargin=t.imageMargin?t.imageMargin:"2px",e.displayOptions.layoutControls.logo.hideWithControls=!!t.hideWithControls&&t.hideWithControls,e.displayOptions.layoutControls.logo.showOverAds=!!t.showOverAds&&t.showOverAds,n&&n.remove(),e.initLogo()},e.trackEvent=(t,n,i,r)=>{typeof e.events[i]>"u"&&(e.events[i]={}),typeof e.events[i][n]>"u"&&(e.events[i][n]=[]),e.events[i][n].push(r),e.registerListener(t,n,i,r)},e.registerListener=(e,t,n,i)=>{const r=e.querySelectorAll(n);for(let e=0;e<r.length;e++)r[e].addEventListener(t,i)},e.copyEvents=t=>{for(let n in e.events)if(e.events.hasOwnProperty(n))for(let i in e.events[n])if(e.events[n].hasOwnProperty(i))for(let r=0;r<e.events[n][i].length;r++)e.registerListener(t,i,n,e.events[n][i][r])},e.resetDisplayMode=t=>{e.fullscreenMode&&"fullScreen"!==t&&e.fullscreenToggle(),e.theatreMode&&"theaterMode"!==t&&e.theatreToggle(),e.miniPlayerToggledOn&&"miniPlayer"!==t&&e.toggleMiniPlayer("off")},e.destroy=()=>{if(e.domRef.player.classList.remove("js-fluid-player"),0===e.destructors.length)return;e.destructors.forEach(t=>t.call(e));const t=e.domRef.wrapper;t?"function"!=typeof t.remove?t.parentNode?t.parentNode.removeChild(t):console.error("Unable to remove wrapper element for Fluid Player instance - no parent"):t.remove():console.warn("Unable to remove wrapper element for Fluid Player instance - element not found")}},Ie=function(e){this.play=()=>e.play(),this.pause=()=>e.pause(),this.skipTo=t=>e.skipTo(t),this.setPlaybackSpeed=t=>e.setPlaybackSpeed(t),this.setVolume=t=>e.setVolume(t),this.setHtmlOnPauseBlock=t=>e.setHtmlOnPauseBlock(t),this.toggleControlBar=t=>e.toggleControlBar(t),this.toggleFullScreen=t=>e.fullscreenToggle(t),this.toggleMiniPlayer=t=>(void 0===t&&(t=!e.miniPlayerToggledOn),e.toggleMiniPlayer(t?"on":"off",!0)),this.destroy=()=>e.destroy(),this.dashInstance=()=>e.dashPlayer?e.dashPlayer:null,this.hlsInstance=()=>e.hlsPlayer?e.hlsPlayer:null,this.on=(t,n)=>e.on(t,n),this.setDebug=t=>{e.displayOptions.debug=t}};if(we&&console.log("Fluid Player - Development Build"+(Ae?" (in debug mode)":"")),typeof FP_HOMEPAGE>"u"&&(globalThis.FP_HOMEPAGE="https://fluidplayer.com"),typeof FP_BUILD_VERSION>"u"&&(globalThis.FP_BUILD_VERSION="v3"),typeof FP_ENV>"u"){const e=globalThis&&globalThis.location&&("localhost"===globalThis.location.hostname||"127.0.0.1"===globalThis.location.hostname||""===globalThis.location.hostname);typeof process<"u"&&process&&process.env&&process.env.NODE_ENV?globalThis.FP_ENV=process.env.NODE_ENV:globalThis&&!e?globalThis.FP_ENV="production":globalThis.FP_ENV="development"}typeof FP_DEBUG>"u"&&(globalThis.FP_DEBUG=!1);const Le=function(e,t){const n=new xe;t||(t={}),n.init(e,t);const i=new Ie(n);if(window&&we){const r={id:e,options:t,instance:i,internals:n};typeof window.fluidPlayerDebug>"u"&&(window.fluidPlayerDebug=[]),window.fluidPlayerDebug.push(r),console.log("Created instance of Fluid Player. Debug API available at window.fluidPlayerDebug["+(window.fluidPlayerDebug.length-1)+"].",r)}return i},Me="function"==typeof Buffer;"function"==typeof TextDecoder&&new TextDecoder;const Ce="function"==typeof TextEncoder?new TextEncoder:void 0,Pe=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=");(e=>{let t={};e.forEach((e,n)=>t[e]=n)})(Pe);const De=String.fromCharCode.bind(String);"function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array);const Oe="function"==typeof btoa?e=>btoa(e):Me?e=>Buffer.from(e,"binary").toString("base64"):e=>{let t,n,i,r,a="";const o=e.length%3;for(let o=0;o<e.length;){if((n=e.charCodeAt(o++))>255||(i=e.charCodeAt(o++))>255||(r=e.charCodeAt(o++))>255)throw new TypeError("invalid character found");t=n<<16|i<<8|r,a+=Pe[t>>18&63]+Pe[t>>12&63]+Pe[t>>6&63]+Pe[63&t]}return o?a.slice(0,o-3)+"===".substring(o):a},Ne=Me?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let n=0,i=e.length;n<i;n+=4096)t.push(De.apply(null,e.subarray(n,n+4096)));return Oe(t.join(""))},ke=e=>{if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?De(192|t>>>6)+De(128|63&t):De(224|t>>>12&15)+De(128|t>>>6&63)+De(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return De(240|t>>>18&7)+De(128|t>>>12&63)+De(128|t>>>6&63)+De(128|63&t)},Fe=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Be=Me?e=>Buffer.from(e,"utf8").toString("base64"):Ce?e=>Ne(Ce.encode(e)):e=>Oe((e=>e.replace(Fe,ke))(e));class Ue{constructor(e,n){t(this,"target"),t(this,"options"),t(this,"adData",{isLinear:!0,isVideoAdData:!0,currentTime:0,videoAdStatus:"",videoAdDuration:0,updatedAt:0});const i=document.createElement("video");i.defaultMuted=!0,i.muted=!0,e.appendChild(i),this.target=i,this.options=n}async create(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i,r;const a=Le(this.target,{layoutControls:{roundedCorners:0,fillToContainer:!0,autoPlay:!0,mute:!0,doubleclickFullscreen:!1,keyboardControl:!1,loop:!1,allowTheatre:!1,miniPlayer:{enabled:!1},preload:"auto",persistentSettings:{volume:!1,quality:!1,speed:!1,theatre:!1},layout:"in-renderer-js",logo:{imageUrl:null==(i=this.options.logo)?void 0:i.imageUrl,clickUrl:null==(r=this.options.logo)?void 0:r.clickUrl,position:"bottom left"},contextMenu:{controls:!1}},vastOptions:{allowVPAID:!0,adCTAText:!1,adClickable:!1,showPlayButton:!1,maxAllowedVastTagRedirects:5,showProgressbarMarkers:!1,vastTimeout:12e3,adList:[{adText:Ee.t("LearnMore"),adClickable:!1,roll:"preRoll",vastTag:await this.getVastTag(this.options.vastUrl,this.options.vastXml)}],vastAdvanced:{vastLoadedCallback:()=>{t.vastLoaded&&t.vastLoaded()},noVastVideoCallback:()=>{t.noVastVideo&&t.noVastVideo()},vastVideoEndedCallback:()=>{console.log("vastVideoEndedCallback"),t.vastVideoEnded&&t.vastVideoEnded()}}}});return a.on("playing",e=>{this.adData.videoAdStatus||(this.adData.videoAdStatus="started",this.adData.videoAdDuration=e.srcElement.duration,n.start&&n.start(this.adData))}),a.on("ended",()=>{this.adData.videoAdStatus="complete"}),a.on("timeupdate",(e,t)=>{this.adData.currentTime=t.currentTime,this.adData.updatedAt=Date.now(),n.progress&&n.progress(this.adData)}),a}async getVastTag(e,t){if(t)return e&&navigator.sendBeacon(e),this.getVastDataUrl(t);if(e){const t=await this.getVastByVastUrl(e);return this.getVastDataUrl(t)}throw new c}async getVastByVastUrl(e){return await(await fetch(e)).text()}getVastDataUrl(e){return this.getVastDataUrlFromVastXml(e)}getVastDataUrlFromVastXml(e){return"data:text/xml;charset=utf-8;base64,"+function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(e=>e.replace(/=/g,"").replace(/[+\/]/g,e=>"+"==e?"-":"_"))(Be(e)):Be(e)}(e.replace(/\\"/g,'"'))}}class Ve{constructor(e){t(this,"viewableTracker"),this.viewableTracker=e}render(e,t,n,i){this.renderContainer(e,t,i),this.viewableTracker.trackViewable(e,()=>{n.play()}),this.viewableTracker.trackViewableLost(e,()=>{n.pause()}),document.addEventListener("visibilitychange",()=>{document.hidden?n.pause():n.play()})}renderContainer(e,t,n){const i=t.playerHeight/t.playerWidth;e.style.display="block",e.style.width="100%",n&&e.classList.add("full-click-area");const r=e.offsetWidth*i;e.style.height=r+"px",window.addEventListener("resize",()=>{const t=e.offsetWidth*i;e.style.height=t+"px"})}}class Ge{constructor(e,n){t(this,"domainLogger"),t(this,"viewableTracker"),this.domainLogger=e,this.viewableTracker=n}async render(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};try{const a=await new Ue(e,{vastUrl:t.vastUrl,vastXml:t.vastXml,logo:n.logo}).create(()=>this.render(e,t,n,i,r),i,r);new Ve(this.viewableTracker).render(e,t,a,n.fullClickArea),this.viewableTracker.trackViewableVideo50(e,()=>{n.onImpressionViewable&&n.onImpressionViewable()})}catch(e){if(!(e instanceof c))throw e;this.domainLogger.invalidBid()}}}class He{trackViewable(e,t){new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&t()})}).observe(e)}trackViewableLost(e,t){new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting||t()})}).observe(e)}trackViewableMrc50(e,t){this.createObserver(t,.5,1e3).observe(e)}trackViewableMrc100(e,t){this.createObserver(t,1,1e3).observe(e)}trackViewableVideo50(e,t){this.createObserver(t,.5,2e3).observe(e)}createObserver(e,t,n){let i=null;const r=new IntersectionObserver(a=>{a.forEach(a=>{a.isIntersecting&&a.intersectionRatio>=t?null===i&&(i=window.setTimeout(()=>{e(),r.disconnect(),i=null},n)):null!==i&&(window.clearTimeout(i),i=null)})},{threshold:t,root:null});return r}}function je(){}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype||Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}),Object.assign(je.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),i=0,r=n.length;i<r;i++)n[i].call(this,e)}}}});var ze=0,Ze=1,qe=2,We=100,Ye=1e3,Ke=1001,Xe=1002,Qe=1003,Je=1004,$e=1005,et=1006,tt=1008,nt=1009,it=1012,rt=1015,at=1016,ot=1020,st=1022,lt=1023,ct=1026,ut=1027,dt=2300,ht=2301,ft=2302,pt=2400,gt=2401,mt=2402,vt=3e3,yt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&i|128]+e[i>>8&255]+"-"+e[i>>16&255]+e[i>>24&255]+e[255&r]+e[r>>8&255]+e[r>>16&255]+e[r>>24&255]).toUpperCase()}}(),clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*yt.DEG2RAD},radToDeg:function(e){return e*yt.RAD2DEG},isPowerOfTwo:function(e){return!(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};function _t(e,t){this.x=e||0,this.y=t||0}function Et(e,t,n,i){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==i?i:1}function bt(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}function Tt(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(_t.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(_t.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*i+e.x,this.y=r*i+a*n+e.y,this}}),Object.assign(Et,{slerp:function(e,t,n,i){return n.copy(e).slerp(t,i)},slerpFlat:function(e,t,n,i,r,a,o){var s=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3],d=r[a+0],h=r[a+1],f=r[a+2],p=r[a+3];if(u!==p||s!==d||l!==h||c!==f){var g=1-o,m=s*d+l*h+c*f+u*p,v=m>=0?1:-1,y=1-m*m;if(y>Number.EPSILON){var _=Math.sqrt(y),E=Math.atan2(_,m*v);g=Math.sin(g*E)/_,o=Math.sin(o*E)/_}var b=o*v;if(s=s*g+d*b,l=l*g+h*b,c=c*g+f*b,u=u*g+p*b,g===1-o){var T=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=T,l*=T,c*=T,u*=T}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}}),Object.defineProperties(Et.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(Et.prototype,{isQuaternion:!0,set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,i=e._y,r=e._z,a=e.order,o=Math.cos,s=Math.sin,l=o(n/2),c=o(i/2),u=o(r/2),d=s(n/2),h=s(i/2),f=s(r/2);return"XYZ"===a?(this._x=d*c*u+l*h*f,this._y=l*h*u-d*c*f,this._z=l*c*f+d*h*u,this._w=l*c*u-d*h*f):"YXZ"===a?(this._x=d*c*u+l*h*f,this._y=l*h*u-d*c*f,this._z=l*c*f-d*h*u,this._w=l*c*u+d*h*f):"ZXY"===a?(this._x=d*c*u-l*h*f,this._y=l*h*u+d*c*f,this._z=l*c*f+d*h*u,this._w=l*c*u-d*h*f):"ZYX"===a?(this._x=d*c*u-l*h*f,this._y=l*h*u+d*c*f,this._z=l*c*f-d*h*u,this._w=l*c*u+d*h*f):"YZX"===a?(this._x=d*c*u+l*h*f,this._y=l*h*u+d*c*f,this._z=l*c*f-d*h*u,this._w=l*c*u-d*h*f):"XZY"===a&&(this._x=d*c*u-l*h*f,this._y=l*h*u-d*c*f,this._z=l*c*f+d*h*u,this._w=l*c*u+d*h*f),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,n=e.elements,i=n[0],r=n[4],a=n[8],o=n[1],s=n[5],l=n[9],c=n[2],u=n[6],d=n[10],h=i+s+d;return h>0?(t=.5/Math.sqrt(h+1),this._w=.25/t,this._x=(u-l)*t,this._y=(a-c)*t,this._z=(o-r)*t):i>s&&i>d?(t=2*Math.sqrt(1+i-s-d),this._w=(u-l)/t,this._x=.25*t,this._y=(r+o)/t,this._z=(a+c)/t):s>d?(t=2*Math.sqrt(1+s-i-d),this._w=(a-c)/t,this._x=(r+o)/t,this._y=.25*t,this._z=(l+u)/t):(t=2*Math.sqrt(1+d-i-s),this._w=(o-r)/t,this._x=(a+c)/t,this._y=(l+u)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(e,t){var n=e.dot(t)+1;return n<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(yt.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var n=this.angleTo(e);if(0===n)return this;var i=Math.min(1,t/n);return this.slerp(e,i),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var n=e._x,i=e._y,r=e._z,a=e._w,o=t._x,s=t._y,l=t._z,c=t._w;return this._x=n*c+a*o+i*l-r*s,this._y=i*c+a*s+r*o-n*l,this._z=r*c+a*l+n*s-i*o,this._w=a*c-n*o-i*s-r*l,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,i=this._y,r=this._z,a=this._w,o=a*e._w+n*e._x+i*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=i,this._z=r,this;var s=1-o*o;if(s<=Number.EPSILON){var l=1-t;return this._w=l*a+t*this._w,this._x=l*n+t*this._x,this._y=l*i+t*this._y,this._z=l*r+t*this._z,this.normalize()}var c=Math.sqrt(s),u=Math.atan2(c,o),d=Math.sin((1-t)*u)/c,h=Math.sin(t*u)/c;return this._w=a*d+this._w*h,this._x=n*d+this._x*h,this._y=i*d+this._y*h,this._z=r*d+this._z*h,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(bt.prototype,{isVector3:!0,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e=new Et;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}}(),applyAxisAngle:function(){var e=new Et;return function(t,n){return this.applyQuaternion(e.setFromAxisAngle(t,n))}}(),applyMatrix3:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*a,this},applyQuaternion:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*i-o*n,c=s*n+o*t-r*i,u=s*i+r*n-a*t,d=-r*t-a*n-o*i;return this.x=l*s+d*-r+c*-o-u*-a,this.y=c*s+d*-a+u*-r-l*-o,this.z=u*s+d*-o+l*-a-c*-r,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var n=e.x,i=e.y,r=e.z,a=t.x,o=t.y,s=t.z;return this.x=i*s-r*o,this.y=r*a-n*s,this.z=n*o-i*a,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new bt;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new bt;return function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(yt.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,n){var i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(Tt.prototype,{isMatrix3:!0,set:function(e,t,n,i,r,a,o,s,l){var c=this.elements;return c[0]=e,c[1]=i,c[2]=o,c[3]=t,c[4]=r,c[5]=s,c[6]=n,c[7]=a,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(){var e=new bt;return function(t){for(var n=0,i=t.count;n<i;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.applyMatrix3(this),t.setXYZ(n,e.x,e.y,e.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[3],s=n[6],l=n[1],c=n[4],u=n[7],d=n[2],h=n[5],f=n[8],p=i[0],g=i[3],m=i[6],v=i[1],y=i[4],_=i[7],E=i[2],b=i[5],T=i[8];return r[0]=a*p+o*v+s*E,r[3]=a*g+o*y+s*b,r[6]=a*m+o*_+s*T,r[1]=l*p+c*v+u*E,r[4]=l*g+c*y+u*b,r[7]=l*m+c*_+u*T,r[2]=d*p+h*v+f*E,r[5]=d*g+h*y+f*b,r[8]=d*m+h*_+f*T,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8];return t*a*c-t*o*l-n*r*c+n*o*s+i*r*l-i*a*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=e.elements,i=this.elements,r=n[0],a=n[1],o=n[2],s=n[3],l=n[4],c=n[5],u=n[6],d=n[7],h=n[8],f=h*l-c*d,p=c*u-h*s,g=d*s-l*u,m=r*f+a*p+o*g;if(0===m){var v="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(v);return console.warn(v),this.identity()}var y=1/m;return i[0]=f*y,i[1]=(o*d-h*a)*y,i[2]=(c*a-o*l)*y,i[3]=p*y,i[4]=(h*r-o*u)*y,i[5]=(o*s-c*r)*y,i[6]=g*y,i[7]=(a*u-d*r)*y,i[8]=(l*r-a*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,n,i,r,a,o){var s=Math.cos(r),l=Math.sin(r);this.set(n*s,n*l,-n*(s*a+l*o)+a+e,-i*l,i*s,-i*(-l*a+s*o)+o+t,0,0,1)},scale:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],a=i[3],o=i[6],s=i[1],l=i[4],c=i[7];return i[0]=t*r+n*s,i[3]=t*a+n*l,i[6]=t*o+n*c,i[1]=-n*r+t*s,i[4]=-n*a+t*l,i[7]=-n*o+t*c,this},translate:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this},equals:function(e){for(var t=this.elements,n=e.elements,i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<9;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}});var St,wt={getDataURL:function(e){var t;if(typeof HTMLCanvasElement>"u")return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===St&&(St=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),St.width=e.width,St.height=e.height;var n=St.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=St}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},At=0;function Rt(e,t,n,i,r,a,o,s,l,c){Object.defineProperty(this,"id",{value:At++}),this.uuid=yt.generateUUID(),this.name="",this.image=void 0!==e?e:Rt.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Rt.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:Ke,this.wrapT=void 0!==i?i:Ke,this.magFilter=void 0!==r?r:et,this.minFilter=void 0!==a?a:tt,this.anisotropy=void 0!==l?l:1,this.format=void 0!==o?o:lt,this.type=void 0!==s?s:nt,this.offset=new _t(0,0),this.repeat=new _t(1,1),this.center=new _t(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Tt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:vt,this.version=0,this.onUpdate=null}function xt(e,t,n,i){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==i?i:1}function It(e,t,n){this.width=e,this.height=t,this.scissor=new xt(0,0,e,t),this.scissorTest=!1,this.viewport=new xt(0,0,e,t),n=n||{},this.texture=new Rt(void 0,void 0,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:et,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function Lt(e,t,n){It.call(this,e,t,n),this.samples=4}function Mt(e,t,n){It.call(this,e,t,n)}function Ct(e,t,n,i,r,a,o,s,l,c,u,d){Rt.call(this,null,a,o,s,l,c,i,r,u,d),this.image={data:e,width:t,height:n},this.magFilter=void 0!==l?l:Qe,this.minFilter=void 0!==c?c:Qe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function Pt(e,t){this.min=void 0!==e?e:new bt(1/0,1/0,1/0),this.max=void 0!==t?t:new bt(-1/0,-1/0,-1/0)}function Dt(e,t){this.center=void 0!==e?e:new bt,this.radius=void 0!==t?t:0}function Ot(e,t){this.normal=void 0!==e?e:new bt(1,0,0),this.constant=void 0!==t?t:0}function Nt(e,t,n,i,r,a){this.planes=[void 0!==e?e:new Ot,void 0!==t?t:new Ot,void 0!==n?n:new Ot,void 0!==i?i:new Ot,void 0!==r?r:new Ot,void 0!==a?a:new Ot]}function kt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Rt.DEFAULT_IMAGE=void 0,Rt.DEFAULT_MAPPING=300,Rt.prototype=Object.assign(Object.create(je.prototype),{constructor:Rt,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var i=this.image;if(void 0===i.uuid&&(i.uuid=yt.generateUUID()),!t&&void 0===e.images[i.uuid]){var r;if(Array.isArray(i)){r=[];for(var a=0,o=i.length;a<o;a++)r.push(wt.getDataURL(i[a]))}else r=wt.getDataURL(i);e.images[i.uuid]={uuid:i.uuid,url:r}}n.image=i.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ye:e.x=e.x-Math.floor(e.x);break;case Ke:e.x=e.x<0?0:1;break;case Xe:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Ye:e.y=e.y-Math.floor(e.y);break;case Ke:e.y=e.y<0?0:1;break;case Xe:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Rt.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(xt.prototype,{isVector4:!0,set:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*r,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,i,r,a=.01,o=.1,s=e.elements,l=s[0],c=s[4],u=s[8],d=s[1],h=s[5],f=s[9],p=s[2],g=s[6],m=s[10];if(Math.abs(c-d)<a&&Math.abs(u-p)<a&&Math.abs(f-g)<a){if(Math.abs(c+d)<o&&Math.abs(u+p)<o&&Math.abs(f+g)<o&&Math.abs(l+h+m-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var v=(l+1)/2,y=(h+1)/2,_=(m+1)/2,E=(c+d)/4,b=(u+p)/4,T=(f+g)/4;return v>y&&v>_?v<a?(n=0,i=.707106781,r=.707106781):(i=E/(n=Math.sqrt(v)),r=b/n):y>_?y<a?(n=.707106781,i=0,r=.707106781):(n=E/(i=Math.sqrt(y)),r=T/i):_<a?(n=.707106781,i=.707106781,r=0):(n=b/(r=Math.sqrt(_)),i=T/r),this.set(n,i,r,t),this}var S=Math.sqrt((g-f)*(g-f)+(u-p)*(u-p)+(d-c)*(d-c));return Math.abs(S)<.001&&(S=1),this.x=(g-f)/S,this.y=(u-p)/S,this.z=(d-c)/S,this.w=Math.acos((l+h+m-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(n,i){return void 0===e&&(e=new xt,t=new xt),e.set(n,n,n,n),t.set(i,i,i,i),this.clamp(e,t)}}(),clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),It.prototype=Object.assign(Object.create(je.prototype),{constructor:It,isWebGLRenderTarget:!0,setSize:function(e,t){(this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Lt.prototype=Object.assign(Object.create(It.prototype),{constructor:Lt,isWebGLMultisampleRenderTarget:!0,copy:function(e){return It.prototype.copy.call(this,e),this.samples=e.samples,this}}),Mt.prototype=Object.create(It.prototype),Mt.prototype.constructor=Mt,Mt.prototype.isWebGLRenderTargetCube=!0,Ct.prototype=Object.create(Rt.prototype),Ct.prototype.constructor=Ct,Ct.prototype.isDataTexture=!0,Object.assign(Pt.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,o=-1/0,s=0,l=e.length;s<l;s+=3){var c=e[s],u=e[s+1],d=e[s+2];c<t&&(t=c),u<n&&(n=u),d<i&&(i=d),c>r&&(r=c),u>a&&(a=u),d>o&&(o=d)}return this.min.set(t,n,i),this.max.set(r,a,o),this},setFromBufferAttribute:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,o=-1/0,s=0,l=e.count;s<l;s++){var c=e.getX(s),u=e.getY(s),d=e.getZ(s);c<t&&(t=c),u<n&&(n=u),d<i&&(i=d),c>r&&(r=c),u>a&&(a=u),d>o&&(o=d)}return this.min.set(t,n,i),this.max.set(r,a,o),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new bt;return function(t,n){var i=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new bt),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new bt),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){var e,t,n,i=new bt;function r(r){var a=r.geometry;if(void 0!==a)if(a.isGeometry){var o=a.vertices;for(t=0,n=o.length;t<n;t++)i.copy(o[t]),i.applyMatrix4(r.matrixWorld),e.expandByPoint(i)}else if(a.isBufferGeometry){var s=a.attributes.position;if(void 0!==s)for(t=0,n=s.count;t<n;t++)i.fromBufferAttribute(s,t).applyMatrix4(r.matrixWorld),e.expandByPoint(i)}}return function(t){return e=this,t.updateMatrixWorld(!0),t.traverse(r),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new bt),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(){var e=new bt;return function(t){return this.clampPoint(t.center,e),e.distanceToSquared(t.center)<=t.radius*t.radius}}(),intersectsPlane:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant},intersectsTriangle:function(){var e=new bt,t=new bt,n=new bt,i=new bt,r=new bt,a=new bt,o=new bt,s=new bt,l=new bt,c=new bt;function u(i){var r,a;for(r=0,a=i.length-3;r<=a;r+=3){o.fromArray(i,r);var s=l.x*Math.abs(o.x)+l.y*Math.abs(o.y)+l.z*Math.abs(o.z),c=e.dot(o),u=t.dot(o),d=n.dot(o);if(Math.max(-Math.max(c,u,d),Math.min(c,u,d))>s)return!1}return!0}return function(o){if(this.isEmpty())return!1;this.getCenter(s),l.subVectors(this.max,s),e.subVectors(o.a,s),t.subVectors(o.b,s),n.subVectors(o.c,s),i.subVectors(t,e),r.subVectors(n,t),a.subVectors(e,n);var d=[0,-i.z,i.y,0,-r.z,r.y,0,-a.z,a.y,i.z,0,-i.x,r.z,0,-r.x,a.z,0,-a.x,-i.y,i.x,0,-r.y,r.x,0,-a.y,a.x,0];return!(!u(d)||(d=[1,0,0,0,1,0,0,0,1],!u(d)))&&(c.crossVectors(i,r),u(d=[c.x,c.y,c.z]))}}(),clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new bt),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new bt;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new bt;return function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new bt,new bt,new bt,new bt,new bt,new bt,new bt,new bt];return function(t){return this.isEmpty()||(e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(e)),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(Dt.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new Pt;return function(t,n){var i=this.center;void 0!==n?i.copy(n):e.setFromPoints(t).getCenter(i);for(var r=0,a=0,o=t.length;a<o;a++)r=Math.max(r,i.distanceToSquared(t[a]));return this.radius=Math.sqrt(r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new bt),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Pt),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(Ot.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new bt,t=new bt;return function(n,i,r){var a=e.subVectors(r,i).cross(t.subVectors(n,i)).normalize();return this.setFromNormalAndCoplanarPoint(a,n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new bt),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new bt;return function(t,n){void 0===n&&(console.warn("THREE.Plane: .intersectLine() target is now required"),n=new bt);var i=t.delta(e),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(t.start)?n.copy(t.start):void 0;var a=-(t.start.dot(this.normal)+this.constant)/r;return a<0||a>1?void 0:n.copy(i).multiplyScalar(a).add(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new bt),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new bt,t=new Tt;return function(n,i){var r=i||t.getNormalMatrix(n),a=this.coplanarPoint(e).applyMatrix4(n),o=this.normal.applyMatrix3(r).normalize();return this.constant=-a.dot(o),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(Nt.prototype,{set:function(e,t,n,i,r,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements,i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],l=n[5],c=n[6],u=n[7],d=n[8],h=n[9],f=n[10],p=n[11],g=n[12],m=n[13],v=n[14],y=n[15];return t[0].setComponents(o-i,u-s,p-d,y-g).normalize(),t[1].setComponents(o+i,u+s,p+d,y+g).normalize(),t[2].setComponents(o+r,u+l,p+h,y+m).normalize(),t[3].setComponents(o-r,u-l,p-h,y-m).normalize(),t[4].setComponents(o-a,u-c,p-f,y-v).normalize(),t[5].setComponents(o+a,u+c,p+f,y+v).normalize(),this},intersectsObject:function(){var e=new Dt;return function(t){var n=t.geometry;return null===n.boundingSphere&&n.computeBoundingSphere(),e.copy(n.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new Dt;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,n=e.center,i=-e.radius,r=0;r<6;r++){if(t[r].distanceToPoint(n)<i)return!1}return!0},intersectsBox:function(){var e=new bt;return function(t){for(var n=this.planes,i=0;i<6;i++){var r=n[i];if(e.x=r.normal.x>0?t.max.x:t.min.x,e.y=r.normal.y>0?t.max.y:t.min.y,e.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(e)<0)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}}),Object.assign(kt.prototype,{isMatrix4:!0,set:function(e,t,n,i,r,a,o,s,l,c,u,d,h,f,p,g){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=i,m[1]=r,m[5]=a,m[9]=o,m[13]=s,m[2]=l,m[6]=c,m[10]=u,m[14]=d,m[3]=h,m[7]=f,m[11]=p,m[15]=g,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new kt).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(){var e=new bt;return function(t){var n=this.elements,i=t.elements,r=1/e.setFromMatrixColumn(t,0).length(),a=1/e.setFromMatrixColumn(t,1).length(),o=1/e.setFromMatrixColumn(t,2).length();return n[0]=i[0]*r,n[1]=i[1]*r,n[2]=i[2]*r,n[3]=0,n[4]=i[4]*a,n[5]=i[5]*a,n[6]=i[6]*a,n[7]=0,n[8]=i[8]*o,n[9]=i[9]*o,n[10]=i[10]*o,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,i=e.y,r=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){var d=a*c,h=a*u,f=o*c,p=o*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=h+f*l,t[5]=d-p*l,t[9]=-o*s,t[2]=p-d*l,t[6]=f+h*l,t[10]=a*s}else if("YXZ"===e.order){var g=s*c,m=s*u,v=l*c,y=l*u;t[0]=g+y*o,t[4]=v*o-m,t[8]=a*l,t[1]=a*u,t[5]=a*c,t[9]=-o,t[2]=m*o-v,t[6]=y+g*o,t[10]=a*s}else if("ZXY"===e.order){g=s*c,m=s*u,v=l*c,y=l*u;t[0]=g-y*o,t[4]=-a*u,t[8]=v+m*o,t[1]=m+v*o,t[5]=a*c,t[9]=y-g*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){d=a*c,h=a*u,f=o*c,p=o*u;t[0]=s*c,t[4]=f*l-h,t[8]=d*l+p,t[1]=s*u,t[5]=p*l+d,t[9]=h*l-f,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var _=a*s,E=a*l,b=o*s,T=o*l;t[0]=s*c,t[4]=T-_*u,t[8]=b*u+E,t[1]=u,t[5]=a*c,t[9]=-o*c,t[2]=-l*c,t[6]=E*u+b,t[10]=_-T*u}else if("XZY"===e.order){_=a*s,E=a*l,b=o*s,T=o*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=_*u+T,t[5]=a*c,t[9]=E*u-b,t[2]=b*u-E,t[6]=o*c,t[10]=T*u+_}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(){var e=new bt(0,0,0),t=new bt(1,1,1);return function(n){return this.compose(e,n,t)}}(),lookAt:function(){var e=new bt,t=new bt,n=new bt;return function(i,r,a){var o=this.elements;return n.subVectors(i,r),0===n.lengthSq()&&(n.z=1),n.normalize(),e.crossVectors(a,n),0===e.lengthSq()&&(1===Math.abs(a.z)?n.x+=1e-4:n.z+=1e-4,n.normalize(),e.crossVectors(a,n)),e.normalize(),t.crossVectors(n,e),o[0]=e.x,o[4]=t.x,o[8]=n.x,o[1]=e.y,o[5]=t.y,o[9]=n.y,o[2]=e.z,o[6]=t.z,o[10]=n.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[4],s=n[8],l=n[12],c=n[1],u=n[5],d=n[9],h=n[13],f=n[2],p=n[6],g=n[10],m=n[14],v=n[3],y=n[7],_=n[11],E=n[15],b=i[0],T=i[4],S=i[8],w=i[12],A=i[1],R=i[5],x=i[9],I=i[13],L=i[2],M=i[6],C=i[10],P=i[14],D=i[3],O=i[7],N=i[11],k=i[15];return r[0]=a*b+o*A+s*L+l*D,r[4]=a*T+o*R+s*M+l*O,r[8]=a*S+o*x+s*C+l*N,r[12]=a*w+o*I+s*P+l*k,r[1]=c*b+u*A+d*L+h*D,r[5]=c*T+u*R+d*M+h*O,r[9]=c*S+u*x+d*C+h*N,r[13]=c*w+u*I+d*P+h*k,r[2]=f*b+p*A+g*L+m*D,r[6]=f*T+p*R+g*M+m*O,r[10]=f*S+p*x+g*C+m*N,r[14]=f*w+p*I+g*P+m*k,r[3]=v*b+y*A+_*L+E*D,r[7]=v*T+y*R+_*M+E*O,r[11]=v*S+y*x+_*C+E*N,r[15]=v*w+y*I+_*P+E*k,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new bt;return function(t){for(var n=0,i=t.count;n<i;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.applyMatrix4(this),t.setXYZ(n,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],a=e[1],o=e[5],s=e[9],l=e[13],c=e[2],u=e[6],d=e[10],h=e[14];return e[3]*(+r*s*u-i*l*u-r*o*d+n*l*d+i*o*h-n*s*h)+e[7]*(+t*s*h-t*l*d+r*a*d-i*a*h+i*l*c-r*s*c)+e[11]*(+t*l*u-t*o*h-r*a*u+n*a*h+r*o*c-n*l*c)+e[15]*(-i*o*c-t*s*u+t*o*d+i*a*u-n*a*d+n*s*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e,t,n){var i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this},getInverse:function(e,t){var n=this.elements,i=e.elements,r=i[0],a=i[1],o=i[2],s=i[3],l=i[4],c=i[5],u=i[6],d=i[7],h=i[8],f=i[9],p=i[10],g=i[11],m=i[12],v=i[13],y=i[14],_=i[15],E=f*y*d-v*p*d+v*u*g-c*y*g-f*u*_+c*p*_,b=m*p*d-h*y*d-m*u*g+l*y*g+h*u*_-l*p*_,T=h*v*d-m*f*d+m*c*g-l*v*g-h*c*_+l*f*_,S=m*f*u-h*v*u-m*c*p+l*v*p+h*c*y-l*f*y,w=r*E+a*b+o*T+s*S;if(0===w){var A="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(A);return console.warn(A),this.identity()}var R=1/w;return n[0]=E*R,n[1]=(v*p*s-f*y*s-v*o*g+a*y*g+f*o*_-a*p*_)*R,n[2]=(c*y*s-v*u*s+v*o*d-a*y*d-c*o*_+a*u*_)*R,n[3]=(f*u*s-c*p*s-f*o*d+a*p*d+c*o*g-a*u*g)*R,n[4]=b*R,n[5]=(h*y*s-m*p*s+m*o*g-r*y*g-h*o*_+r*p*_)*R,n[6]=(m*u*s-l*y*s-m*o*d+r*y*d+l*o*_-r*u*_)*R,n[7]=(l*p*s-h*u*s+h*o*d-r*p*d-l*o*g+r*u*g)*R,n[8]=T*R,n[9]=(m*f*s-h*v*s-m*a*g+r*v*g+h*a*_-r*f*_)*R,n[10]=(l*v*s-m*c*s+m*a*d-r*v*d-l*a*_+r*c*_)*R,n[11]=(h*c*s-l*f*s-h*a*d+r*f*d+l*a*g-r*c*g)*R,n[12]=S*R,n[13]=(h*v*o-m*f*o+m*a*p-r*v*p-h*a*y+r*f*y)*R,n[14]=(m*c*o-l*v*o-m*a*u+r*v*u+l*a*y-r*c*y)*R,n[15]=(l*f*o-h*c*o+h*a*u-r*f*u-l*a*p+r*c*p)*R,this},scale:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=1-n,a=e.x,o=e.y,s=e.z,l=r*a,c=r*o;return this.set(l*a+n,l*o-i*s,l*s+i*o,0,l*o+i*s,c*o+n,c*s-i*a,0,l*s-i*o,c*s+i*a,r*s*s+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,n){var i=this.elements,r=t._x,a=t._y,o=t._z,s=t._w,l=r+r,c=a+a,u=o+o,d=r*l,h=r*c,f=r*u,p=a*c,g=a*u,m=o*u,v=s*l,y=s*c,_=s*u,E=n.x,b=n.y,T=n.z;return i[0]=(1-(p+m))*E,i[1]=(h+_)*E,i[2]=(f-y)*E,i[3]=0,i[4]=(h-_)*b,i[5]=(1-(d+m))*b,i[6]=(g+v)*b,i[7]=0,i[8]=(f+y)*T,i[9]=(g-v)*T,i[10]=(1-(d+p))*T,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this},decompose:function(){var e=new bt,t=new kt;return function(n,i,r){var a=this.elements,o=e.set(a[0],a[1],a[2]).length(),s=e.set(a[4],a[5],a[6]).length(),l=e.set(a[8],a[9],a[10]).length();this.determinant()<0&&(o=-o),n.x=a[12],n.y=a[13],n.z=a[14],t.copy(this);var c=1/o,u=1/s,d=1/l;return t.elements[0]*=c,t.elements[1]*=c,t.elements[2]*=c,t.elements[4]*=u,t.elements[5]*=u,t.elements[6]*=u,t.elements[8]*=d,t.elements[9]*=d,t.elements[10]*=d,i.setFromRotationMatrix(t),r.x=o,r.y=s,r.z=l,this}}(),makePerspective:function(e,t,n,i,r,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*r/(t-e),l=2*r/(n-i),c=(t+e)/(t-e),u=(n+i)/(n-i),d=-(a+r)/(a-r),h=-2*a*r/(a-r);return o[0]=s,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=h,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(e,t,n,i,r,a){var o=this.elements,s=1/(t-e),l=1/(n-i),c=1/(a-r),u=(t+e)*s,d=(n+i)*l,h=(a+r)*c;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-h,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(e){for(var t=this.elements,n=e.elements,i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}});var Ft={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = normalMatrix * objectTangent;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#endif\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\tfloat clearCoatInv = 1.0 - clearCoatDHR;\n\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec3 singleScattering = vec3( 0.0 );\n\t\tvec3 multiScattering = vec3( 0.0 );\n\t\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\t\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * singleScattering;\n\t\treflectedLight.indirectDiffuse += multiScattering * cosineWeightedIrradiance;\n\t\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\t#else\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#endif\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, irradiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t#endif\n#endif",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t#ifdef FLIP_SIDED\n\t\t\tnormal = - normal;\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tnormal = normalize( normalMatrix * normal );\n\t#else\n\t\t#ifdef USE_TANGENT\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy = normalScale * mapN.xy;\n\t\t\tnormal = normalize( vTBN * mapN );\n\t\t#else\n\t\t\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\t\t#endif\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tuniform mat3 normalMatrix;\n\t#else\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( vUv.st );\n\t\t\tvec2 st1 = dFdy( vUv.st );\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = normalize( surf_norm );\n\t\t\tmat3 tsn = mat3( S, T, N );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy *= normalScale;\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\treturn normalize( tsn * mapN );\n\t\t}\n\t#endif\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#if defined( DITHERING )\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"};function Bt(e){var t={};for(var n in e)for(var i in t[n]={},e[n]){var r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}return t}function Ut(e){for(var t={},n=0;n<e.length;n++){var i=Bt(e[n]);for(var r in i)t[r]=i[r]}return t}var Vt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Gt(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}Object.assign(Gt.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(){function e(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}return function(t,n,i){if(t=yt.euclideanModulo(t,1),n=yt.clamp(n,0,1),i=yt.clamp(i,0,1),0===n)this.r=this.g=this.b=i;else{var r=i<=.5?i*(1+n):i+n-i*n,a=2*i-r;this.r=e(a,r,t+1/3),this.g=e(a,r,t),this.b=e(a,r,t-1/3)}return this}}(),setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var i,r=n[1],a=n[2];switch(r){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){var o=parseFloat(i[1])/360,s=parseInt(i[2],10)/100,l=parseInt(i[3],10)/100;return t(i[5]),this.setHSL(o,s,l)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(e)){var c,u=(c=n[1]).length;if(3===u)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}e&&e.length>0&&(void 0!==(c=Vt[e])?this.setHex(c):console.warn("THREE.Color: Unknown color "+e));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(){function e(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}return function(t){return this.r=e(t.r),this.g=e(t.g),this.b=e(t.b),this}}(),copyLinearToSRGB:function(){function e(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}return function(t){return this.r=e(t.r),this.g=e(t.g),this.b=e(t.b),this}}(),convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,n,i=this.r,r=this.g,a=this.b,o=Math.max(i,r,a),s=Math.min(i,r,a),l=(s+o)/2;if(s===o)t=0,n=0;else{var c=o-s;switch(n=l<=.5?c/(o+s):c/(2-o-s),o){case i:t=(r-a)/c+(r<a?6:0);break;case r:t=(a-i)/c+2;break;case a:t=(i-r)/c+4}t/=6}return e.h=t,e.s=n,e.l=l,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(){var e={};return function(t,n,i){return this.getHSL(e),e.h+=t,e.s+=n,e.l+=i,this.setHSL(e.h,e.s,e.l),this}}(),add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(){var e={h:0,s:0,l:0},t={h:0,s:0,l:0};return function(n,i){this.getHSL(e),n.getHSL(t);var r=yt.lerp(e.h,t.h,i),a=yt.lerp(e.s,t.s,i),o=yt.lerp(e.l,t.l,i);return this.setHSL(r,a,o),this}}(),equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}});var Ht={common:{diffuse:{value:new Gt(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Tt},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new _t(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Gt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Gt(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new Tt}},sprite:{diffuse:{value:new Gt(15658734)},opacity:{value:1},center:{value:new _t(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new Tt}}},jt={basic:{uniforms:Ut([Ht.common,Ht.specularmap,Ht.envmap,Ht.aomap,Ht.lightmap,Ht.fog]),vertexShader:Ft.meshbasic_vert,fragmentShader:Ft.meshbasic_frag},lambert:{uniforms:Ut([Ht.common,Ht.specularmap,Ht.envmap,Ht.aomap,Ht.lightmap,Ht.emissivemap,Ht.fog,Ht.lights,{emissive:{value:new Gt(0)}}]),vertexShader:Ft.meshlambert_vert,fragmentShader:Ft.meshlambert_frag},phong:{uniforms:Ut([Ht.common,Ht.specularmap,Ht.envmap,Ht.aomap,Ht.lightmap,Ht.emissivemap,Ht.bumpmap,Ht.normalmap,Ht.displacementmap,Ht.gradientmap,Ht.fog,Ht.lights,{emissive:{value:new Gt(0)},specular:{value:new Gt(1118481)},shininess:{value:30}}]),vertexShader:Ft.meshphong_vert,fragmentShader:Ft.meshphong_frag},standard:{uniforms:Ut([Ht.common,Ht.envmap,Ht.aomap,Ht.lightmap,Ht.emissivemap,Ht.bumpmap,Ht.normalmap,Ht.displacementmap,Ht.roughnessmap,Ht.metalnessmap,Ht.fog,Ht.lights,{emissive:{value:new Gt(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Ft.meshphysical_vert,fragmentShader:Ft.meshphysical_frag},matcap:{uniforms:Ut([Ht.common,Ht.bumpmap,Ht.normalmap,Ht.displacementmap,Ht.fog,{matcap:{value:null}}]),vertexShader:Ft.meshmatcap_vert,fragmentShader:Ft.meshmatcap_frag},points:{uniforms:Ut([Ht.points,Ht.fog]),vertexShader:Ft.points_vert,fragmentShader:Ft.points_frag},dashed:{uniforms:Ut([Ht.common,Ht.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ft.linedashed_vert,fragmentShader:Ft.linedashed_frag},depth:{uniforms:Ut([Ht.common,Ht.displacementmap]),vertexShader:Ft.depth_vert,fragmentShader:Ft.depth_frag},normal:{uniforms:Ut([Ht.common,Ht.bumpmap,Ht.normalmap,Ht.displacementmap,{opacity:{value:1}}]),vertexShader:Ft.normal_vert,fragmentShader:Ft.normal_frag},sprite:{uniforms:Ut([Ht.sprite,Ht.fog]),vertexShader:Ft.sprite_vert,fragmentShader:Ft.sprite_frag},background:{uniforms:{uvTransform:{value:new Tt},t2D:{value:null}},vertexShader:Ft.background_vert,fragmentShader:Ft.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ft.cube_vert,fragmentShader:Ft.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ft.equirect_vert,fragmentShader:Ft.equirect_frag},distanceRGBA:{uniforms:Ut([Ht.common,Ht.displacementmap,{referencePosition:{value:new bt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ft.distanceRGBA_vert,fragmentShader:Ft.distanceRGBA_frag},shadow:{uniforms:Ut([Ht.lights,Ht.fog,{color:{value:new Gt(0)},opacity:{value:1}}]),vertexShader:Ft.shadow_vert,fragmentShader:Ft.shadow_frag}};function zt(){var e=null,t=!1,n=null;function i(r,a){!1!==t&&(n(r,a),e.requestAnimationFrame(i))}return{start:function(){!0!==t&&null!==n&&(e.requestAnimationFrame(i),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function Zt(e){var t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);var i=t.get(n);i&&(e.deleteBuffer(i.buffer),t.delete(n))},update:function(n,i){n.isInterleavedBufferAttribute&&(n=n.data);var r=t.get(n);void 0===r?t.set(n,function(t,n){var i=t.array,r=t.dynamic?35048:35044,a=e.createBuffer();e.bindBuffer(n,a),e.bufferData(n,i,r),t.onUploadCallback();var o=5126;return i instanceof Float32Array?o=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?o=5123:i instanceof Int16Array?o=5122:i instanceof Uint32Array?o=5125:i instanceof Int32Array?o=5124:i instanceof Int8Array?o=5120:i instanceof Uint8Array&&(o=5121),{buffer:a,type:o,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(n,i)):r.version<n.version&&(function(t,n,i){var r=n.array,a=n.updateRange;e.bindBuffer(i,t),!1===n.dynamic?e.bufferData(i,r,35044):-1===a.count?e.bufferSubData(i,0,r):0===a.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(i,a.offset*r.BYTES_PER_ELEMENT,r.subarray(a.offset,a.offset+a.count)),a.count=-1)}(r.buffer,n,i),r.version=n.version)}}}function qt(e,t,n,i,r,a){this.a=e,this.b=t,this.c=n,this.normal=i&&i.isVector3?i:new bt,this.vertexNormals=Array.isArray(i)?i:[],this.color=r&&r.isColor?r:new Gt,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==a?a:0}function Wt(e,t,n,i){this._x=e||0,this._y=t||0,this._z=n||0,this._order=i||Wt.DefaultOrder}function Yt(){this.mask=1}jt.physical={uniforms:Ut([jt.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Ft.meshphysical_vert,fragmentShader:Ft.meshphysical_frag},Object.assign(qt.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}),Wt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Wt.DefaultOrder="XYZ",Object.defineProperties(Wt.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),Object.assign(Wt.prototype,{isEuler:!0,set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._order=i||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var i=yt.clamp,r=e.elements,a=r[0],o=r[4],s=r[8],l=r[1],c=r[5],u=r[9],d=r[2],h=r[6],f=r[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(i(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(h,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-i(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(s,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,a),this._z=0)):"ZXY"===t?(this._x=Math.asin(i(h,-1,1)),Math.abs(h)<.99999?(this._y=Math.atan2(-d,f),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,a))):"ZYX"===t?(this._y=Math.asin(-i(d,-1,1)),Math.abs(d)<.99999?(this._x=Math.atan2(h,f),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-o,c))):"YZX"===t?(this._z=Math.asin(i(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-d,a)):(this._x=0,this._y=Math.atan2(s,f))):"XZY"===t?(this._z=Math.asin(-i(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(h,c),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-u,f),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==n&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new kt;return function(t,n,i){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,n,i)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new Et;return function(t){return e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new bt(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(Yt.prototype,{set:function(e){this.mask=1<<e},enable:function(e){this.mask|=1<<e},toggle:function(e){this.mask^=1<<e},disable:function(e){this.mask&=~(1<<e)},test:function(e){return 0!==(this.mask&e.mask)}});var Kt=0;function Xt(){Object.defineProperty(this,"id",{value:Kt++}),this.uuid=yt.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Xt.DefaultUp.clone();var e=new bt,t=new Wt,n=new Et,i=new bt(1,1,1);t.onChange(function(){n.setFromEuler(t,!1)}),n.onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new kt},normalMatrix:{value:new Tt}}),this.matrix=new kt,this.matrixWorld=new kt,this.matrixAutoUpdate=Xt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Yt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}Xt.DefaultUp=new bt(0,1,0),Xt.DefaultMatrixAutoUpdate=!0,Xt.prototype=Object.assign(Object.create(je.prototype),{constructor:Xt,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new Et;return function(t,n){return e.setFromAxisAngle(t,n),this.quaternion.multiply(e),this}}(),rotateOnWorldAxis:function(){var e=new Et;return function(t,n){return e.setFromAxisAngle(t,n),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new bt(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new bt(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new bt(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new bt;return function(t,n){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(n)),this}}(),translateX:function(){var e=new bt(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new bt(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new bt(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new kt;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new Et,t=new kt,n=new bt,i=new bt;return function(r,a,o){r.isVector3?n.copy(r):n.set(r,a,o);var s=this.parent;this.updateWorldMatrix(!0,!1),i.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?t.lookAt(i,n,this.up):t.lookAt(n,i,this.up),this.quaternion.setFromRotationMatrix(t),s&&(t.extractRotation(s.matrixWorld),e.setFromRotationMatrix(t),this.quaternion.premultiply(e.inverse()))}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(n,1)),this},attach:function(){var e=new kt;return function(t){return this.updateWorldMatrix(!0,!1),e.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),e.multiply(t.parent.matrixWorld)),t.applyMatrix(e),t.updateWorldMatrix(!1,!1),this.add(t),this}}(),getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,i=this.children.length;n<i;n++){var r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new bt),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new bt,t=new bt;return function(n){return void 0===n&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),n=new Et),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,n,t),n}}(),getWorldScale:function(){var e=new bt,t=new Et;return function(n){return void 0===n&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),n=new bt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,n),n}}(),getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new bt),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var i=this.children,r=0,a=i.length;r<a;r++)i[r].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isMesh&&0!==this.drawMode&&(i.drawMode=this.drawMode),this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,l=o.length;s<l;s++){var c=o[s];r(e.shapes,c)}else r(e.shapes,o)}}if(void 0!==this.material)if(Array.isArray(this.material)){var u=[];for(s=0,l=this.material.length;s<l;s++)u.push(r(e.materials,this.material[s]));i.material=u}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(s=0;s<this.children.length;s++)i.children.push(this.children[s].toJSON(e).object)}if(t){var d=g(e.geometries),h=g(e.materials),f=g(e.textures),p=g(e.images);o=g(e.shapes);d.length>0&&(n.geometries=d),h.length>0&&(n.materials=h),f.length>0&&(n.textures=f),p.length>0&&(n.images=p),o.length>0&&(n.shapes=o)}return n.object=i,n;function g(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var i=e.children[n];this.add(i.clone())}return this}});var Qt=0;function Jt(){Object.defineProperty(this,"id",{value:Qt+=2}),this.uuid=yt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function $t(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function en(e,t,n){$t.call(this,new Int8Array(e),t,n)}function tn(e,t,n){$t.call(this,new Uint8Array(e),t,n)}function nn(e,t,n){$t.call(this,new Uint8ClampedArray(e),t,n)}function rn(e,t,n){$t.call(this,new Int16Array(e),t,n)}function an(e,t,n){$t.call(this,new Uint16Array(e),t,n)}function on(e,t,n){$t.call(this,new Int32Array(e),t,n)}function sn(e,t,n){$t.call(this,new Uint32Array(e),t,n)}function ln(e,t,n){$t.call(this,new Float32Array(e),t,n)}function cn(e,t,n){$t.call(this,new Float64Array(e),t,n)}function un(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function dn(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}Jt.prototype=Object.assign(Object.create(je.prototype),{constructor:Jt,isGeometry:!0,applyMatrix:function(e){for(var t=(new Tt).getNormalMatrix(e),n=0,i=this.vertices.length;n<i;n++){this.vertices[n].applyMatrix4(e)}for(n=0,i=this.faces.length;n<i;n++){var r=this.faces[n];r.normal.applyMatrix3(t).normalize();for(var a=0,o=r.vertexNormals.length;a<o;a++)r.vertexNormals[a].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e=new kt;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new kt;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new kt;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new kt;return function(t,n,i){return e.makeTranslation(t,n,i),this.applyMatrix(e),this}}(),scale:function(){var e=new kt;return function(t,n,i){return e.makeScale(t,n,i),this.applyMatrix(e),this}}(),lookAt:function(){var e=new Xt;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){var t=this,n=null!==e.index?e.index.array:void 0,i=e.attributes,r=i.position.array,a=void 0!==i.normal?i.normal.array:void 0,o=void 0!==i.color?i.color.array:void 0,s=void 0!==i.uv?i.uv.array:void 0,l=void 0!==i.uv2?i.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var c=0;c<r.length;c+=3)t.vertices.push((new bt).fromArray(r,c)),void 0!==o&&t.colors.push((new Gt).fromArray(o,c));function u(e,n,i,r){var c=void 0===o?[]:[t.colors[e].clone(),t.colors[n].clone(),t.colors[i].clone()],u=new qt(e,n,i,void 0===a?[]:[(new bt).fromArray(a,3*e),(new bt).fromArray(a,3*n),(new bt).fromArray(a,3*i)],c,r);t.faces.push(u),void 0!==s&&t.faceVertexUvs[0].push([(new _t).fromArray(s,2*e),(new _t).fromArray(s,2*n),(new _t).fromArray(s,2*i)]),void 0!==l&&t.faceVertexUvs[1].push([(new _t).fromArray(l,2*e),(new _t).fromArray(l,2*n),(new _t).fromArray(l,2*i)])}var d=e.groups;if(d.length>0)for(c=0;c<d.length;c++)for(var h=d[c],f=h.start,p=f,g=f+h.count;p<g;p+=3)void 0!==n?u(n[p],n[p+1],n[p+2],h.materialIndex):u(p,p+1,p+2,h.materialIndex);else if(void 0!==n)for(c=0;c<n.length;c+=3)u(n[c],n[c+1],n[c+2]);else for(c=0;c<r.length/3;c+=3)u(c,c+1,c+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){var e=new bt;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,i=new kt;return i.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix(i),this},computeFaceNormals:function(){for(var e=new bt,t=new bt,n=0,i=this.faces.length;n<i;n++){var r=this.faces[n],a=this.vertices[r.a],o=this.vertices[r.b],s=this.vertices[r.c];e.subVectors(s,o),t.subVectors(a,o),e.cross(t),e.normalize(),r.normal.copy(e)}},computeVertexNormals:function(e){var t,n,i,r,a,o;for(void 0===e&&(e=!0),o=new Array(this.vertices.length),t=0,n=this.vertices.length;t<n;t++)o[t]=new bt;if(e){var s,l,c,u=new bt,d=new bt;for(i=0,r=this.faces.length;i<r;i++)a=this.faces[i],s=this.vertices[a.a],l=this.vertices[a.b],c=this.vertices[a.c],u.subVectors(c,l),d.subVectors(s,l),u.cross(d),o[a.a].add(u),o[a.b].add(u),o[a.c].add(u)}else for(this.computeFaceNormals(),i=0,r=this.faces.length;i<r;i++)o[(a=this.faces[i]).a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(t=0,n=this.vertices.length;t<n;t++)o[t].normalize();for(i=0,r=this.faces.length;i<r;i++){var h=(a=this.faces[i]).vertexNormals;3===h.length?(h[0].copy(o[a.a]),h[1].copy(o[a.b]),h[2].copy(o[a.c])):(h[0]=o[a.a].clone(),h[1]=o[a.b].clone(),h[2]=o[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,n;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var i=(n=this.faces[e]).vertexNormals;3===i.length?(i[0].copy(n.normal),i[1].copy(n.normal),i[2].copy(n.normal)):(i[0]=n.normal.clone(),i[1]=n.normal.clone(),i[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,n,i,r;for(n=0,i=this.faces.length;n<i;n++)for((r=this.faces[n]).__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),e=0,t=r.vertexNormals.length;e<t;e++)r.__originalVertexNormals[e]?r.__originalVertexNormals[e].copy(r.vertexNormals[e]):r.__originalVertexNormals[e]=r.vertexNormals[e].clone();var a=new Jt;for(a.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var o=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(n=0,i=this.faces.length;n<i;n++)l=new bt,c={a:new bt,b:new bt,c:new bt},o.push(l),s.push(c)}var l,c,u=this.morphNormals[e];for(a.vertices=this.morphTargets[e].vertices,a.computeFaceNormals(),a.computeVertexNormals(),n=0,i=this.faces.length;n<i;n++)r=this.faces[n],l=u.faceNormals[n],c=u.vertexNormals[n],l.copy(r.normal),c.a.copy(r.vertexNormals[0]),c.b.copy(r.vertexNormals[1]),c.c.copy(r.vertexNormals[2])}for(n=0,i=this.faces.length;n<i;n++)(r=this.faces[n]).normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Pt),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Dt),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e&&e.isGeometry){var i,r=this.vertices.length,a=this.vertices,o=e.vertices,s=this.faces,l=e.faces,c=this.faceVertexUvs[0],u=e.faceVertexUvs[0],d=this.colors,h=e.colors;void 0===n&&(n=0),void 0!==t&&(i=(new Tt).getNormalMatrix(t));for(var f=0,p=o.length;f<p;f++){var g=o[f].clone();void 0!==t&&g.applyMatrix4(t),a.push(g)}for(f=0,p=h.length;f<p;f++)d.push(h[f].clone());for(f=0,p=l.length;f<p;f++){var m,v,y,_=l[f],E=_.vertexNormals,b=_.vertexColors;(m=new qt(_.a+r,_.b+r,_.c+r)).normal.copy(_.normal),void 0!==i&&m.normal.applyMatrix3(i).normalize();for(var T=0,S=E.length;T<S;T++)v=E[T].clone(),void 0!==i&&v.applyMatrix3(i).normalize(),m.vertexNormals.push(v);m.color.copy(_.color);for(T=0,S=b.length;T<S;T++)y=b[T],m.vertexColors.push(y.clone());m.materialIndex=_.materialIndex+n,s.push(m)}for(f=0,p=u.length;f<p;f++){var w=u[f],A=[];if(void 0!==w){for(T=0,S=w.length;T<S;T++)A.push(w[T].clone());c.push(A)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,n,i,r,a,o,s,l={},c=[],u=[],d=Math.pow(10,4);for(n=0,i=this.vertices.length;n<i;n++)e=this.vertices[n],void 0===l[t=Math.round(e.x*d)+"_"+Math.round(e.y*d)+"_"+Math.round(e.z*d)]?(l[t]=n,c.push(this.vertices[n]),u[n]=c.length-1):u[n]=u[l[t]];var h=[];for(n=0,i=this.faces.length;n<i;n++){(r=this.faces[n]).a=u[r.a],r.b=u[r.b],r.c=u[r.c],a=[r.a,r.b,r.c];for(var f=0;f<3;f++)if(a[f]===a[(f+1)%3]){h.push(n);break}}for(n=h.length-1;n>=0;n--){var p=h[n];for(this.faces.splice(p,1),o=0,s=this.faceVertexUvs.length;o<s;o++)this.faceVertexUvs[o].splice(p,1)}var g=this.vertices.length-c.length;return this.vertices=c,g},setFromPoints:function(e){this.vertices=[];for(var t=0,n=e.length;t<n;t++){var i=e[t];this.vertices.push(new bt(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,n=0;n<t;n++)e[n]._id=n;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var i,r,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];a&&a.length===t&&(i=[]),o&&o.length===t&&(r=[]);for(n=0;n<t;n++){var s=e[n]._id;i&&i.push(a[s]),r&&r.push(o[s])}i&&(this.faceVertexUvs[0]=i),r&&(this.faceVertexUvs[1]=r)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}for(var i=[],r=0;r<this.vertices.length;r++){var a=this.vertices[r];i.push(a.x,a.y,a.z)}var o=[],s=[],l={},c=[],u={},d=[],h={};for(r=0;r<this.faces.length;r++){var f=this.faces[r],p=void 0!==this.faceVertexUvs[0][r],g=f.normal.length()>0,m=f.vertexNormals.length>0,v=1!==f.color.r||1!==f.color.g||1!==f.color.b,y=f.vertexColors.length>0,_=0;if(_=S(_,0,0),_=S(_,1,!0),_=S(_,2,!1),_=S(_,3,p),_=S(_,4,g),_=S(_,5,m),_=S(_,6,v),_=S(_,7,y),o.push(_),o.push(f.a,f.b,f.c),o.push(f.materialIndex),p){var E=this.faceVertexUvs[0][r];o.push(R(E[0]),R(E[1]),R(E[2]))}if(g&&o.push(w(f.normal)),m){var b=f.vertexNormals;o.push(w(b[0]),w(b[1]),w(b[2]))}if(v&&o.push(A(f.color)),y){var T=f.vertexColors;o.push(A(T[0]),A(T[1]),A(T[2]))}}function S(e,t,n){return n?e|1<<t:e&~(1<<t)}function w(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]||(l[t]=s.length/3,s.push(e.x,e.y,e.z)),l[t]}function A(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==u[t]||(u[t]=c.length,c.push(e.getHex())),u[t]}function R(e){var t=e.x.toString()+e.y.toString();return void 0!==h[t]||(h[t]=d.length/2,d.push(e.x,e.y)),h[t]}return e.data={},e.data.vertices=i,e.data.normals=s,c.length>0&&(e.data.colors=c),d.length>0&&(e.data.uvs=[d]),e.data.faces=o,e},clone:function(){return(new Jt).copy(this)},copy:function(e){var t,n,i,r,a,o;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,n=s.length;t<n;t++)this.vertices.push(s[t].clone());var l=e.colors;for(t=0,n=l.length;t<n;t++)this.colors.push(l[t].clone());var c=e.faces;for(t=0,n=c.length;t<n;t++)this.faces.push(c[t].clone());for(t=0,n=e.faceVertexUvs.length;t<n;t++){var u=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),i=0,r=u.length;i<r;i++){var d=u[i],h=[];for(a=0,o=d.length;a<o;a++){var f=d[a];h.push(f.clone())}this.faceVertexUvs[t].push(h)}}var p=e.morphTargets;for(t=0,n=p.length;t<n;t++){var g={};if(g.name=p[t].name,void 0!==p[t].vertices)for(g.vertices=[],i=0,r=p[t].vertices.length;i<r;i++)g.vertices.push(p[t].vertices[i].clone());if(void 0!==p[t].normals)for(g.normals=[],i=0,r=p[t].normals.length;i<r;i++)g.normals.push(p[t].normals[i].clone());this.morphTargets.push(g)}var m=e.morphNormals;for(t=0,n=m.length;t<n;t++){var v={};if(void 0!==m[t].vertexNormals)for(v.vertexNormals=[],i=0,r=m[t].vertexNormals.length;i<r;i++){var y=m[t].vertexNormals[i],_={};_.a=y.a.clone(),_.b=y.b.clone(),_.c=y.c.clone(),v.vertexNormals.push(_)}if(void 0!==m[t].faceNormals)for(v.faceNormals=[],i=0,r=m[t].faceNormals.length;i<r;i++)v.faceNormals.push(m[t].faceNormals[i].clone());this.morphNormals.push(v)}var E=e.skinWeights;for(t=0,n=E.length;t<n;t++)this.skinWeights.push(E[t].clone());var b=e.skinIndices;for(t=0,n=b.length;t<n;t++)this.skinIndices.push(b[t].clone());var T=e.lineDistances;for(t=0,n=T.length;t<n;t++)this.lineDistances.push(T[t]);var S=e.boundingBox;null!==S&&(this.boundingBox=S.clone());var w=e.boundingSphere;return null!==w&&(this.boundingSphere=w.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty($t.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign($t.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.itemSize:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),a=new Gt),t[n++]=a.r,t[n++]=a.g,t[n++]=a.b}return this},copyVector2sArray:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),a=new _t),t[n++]=a.x,t[n++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),a=new bt),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),a=new xt),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z,t[n++]=a.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this},setXYZW:function(e,t,n,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),en.prototype=Object.create($t.prototype),en.prototype.constructor=en,tn.prototype=Object.create($t.prototype),tn.prototype.constructor=tn,nn.prototype=Object.create($t.prototype),nn.prototype.constructor=nn,rn.prototype=Object.create($t.prototype),rn.prototype.constructor=rn,an.prototype=Object.create($t.prototype),an.prototype.constructor=an,on.prototype=Object.create($t.prototype),on.prototype.constructor=on,sn.prototype=Object.create($t.prototype),sn.prototype.constructor=sn,ln.prototype=Object.create($t.prototype),ln.prototype.constructor=ln,cn.prototype=Object.create($t.prototype),cn.prototype.constructor=cn,Object.assign(un.prototype,{computeGroups:function(e){for(var t,n=[],i=void 0,r=e.faces,a=0;a<r.length;a++){var o=r[a];o.materialIndex!==i&&(i=o.materialIndex,void 0!==t&&(t.count=3*a-t.start,n.push(t)),t={start:3*a,materialIndex:i})}void 0!==t&&(t.count=3*a-t.start,n.push(t)),this.groups=n},fromGeometry:function(e){var t,n=e.faces,i=e.vertices,r=e.faceVertexUvs,a=r[0]&&r[0].length>0,o=r[1]&&r[1].length>0,s=e.morphTargets,l=s.length;if(l>0){t=[];for(var c=0;c<l;c++)t[c]={name:s[c].name,data:[]};this.morphTargets.position=t}var u,d=e.morphNormals,h=d.length;if(h>0){u=[];for(c=0;c<h;c++)u[c]={name:d[c].name,data:[]};this.morphTargets.normal=u}var f=e.skinIndices,p=e.skinWeights,g=f.length===i.length,m=p.length===i.length;i.length>0&&0===n.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(c=0;c<n.length;c++){var v=n[c];this.vertices.push(i[v.a],i[v.b],i[v.c]);var y=v.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var _=v.normal;this.normals.push(_,_,_)}var E,b=v.vertexColors;if(3===b.length)this.colors.push(b[0],b[1],b[2]);else{var T=v.color;this.colors.push(T,T,T)}if(!0===a)void 0!==(E=r[0][c])?this.uvs.push(E[0],E[1],E[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new _t,new _t,new _t));if(!0===o)void 0!==(E=r[1][c])?this.uvs2.push(E[0],E[1],E[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new _t,new _t,new _t));for(var S=0;S<l;S++){var w=s[S].vertices;t[S].data.push(w[v.a],w[v.b],w[v.c])}for(S=0;S<h;S++){var A=d[S].vertexNormals[c];u[S].data.push(A.a,A.b,A.c)}g&&this.skinIndices.push(f[v.a],f[v.b],f[v.c]),m&&this.skinWeights.push(p[v.a],p[v.b],p[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}});var hn=1;function fn(){Object.defineProperty(this,"id",{value:hn+=2}),this.uuid=yt.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}function pn(e,t,n,i,r,a){Jt.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:a},this.fromBufferGeometry(new gn(e,t,n,i,r,a)),this.mergeVertices()}function gn(e,t,n,i,r,a){fn.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:a};var o=this;e=e||1,t=t||1,n=n||1,i=Math.floor(i)||1,r=Math.floor(r)||1,a=Math.floor(a)||1;var s=[],l=[],c=[],u=[],d=0,h=0;function f(e,t,n,i,r,a,f,p,g,m,v){var y,_,E=a/g,b=f/m,T=a/2,S=f/2,w=p/2,A=g+1,R=m+1,x=0,I=0,L=new bt;for(_=0;_<R;_++){var M=_*b-S;for(y=0;y<A;y++){var C=y*E-T;L[e]=C*i,L[t]=M*r,L[n]=w,l.push(L.x,L.y,L.z),L[e]=0,L[t]=0,L[n]=p>0?1:-1,c.push(L.x,L.y,L.z),u.push(y/g),u.push(1-_/m),x+=1}}for(_=0;_<m;_++)for(y=0;y<g;y++){var P=d+y+A*_,D=d+y+A*(_+1),O=d+(y+1)+A*(_+1),N=d+(y+1)+A*_;s.push(P,D,N),s.push(D,O,N),I+=6}o.addGroup(h,I,v),h+=I,d+=x}f("z","y","x",-1,-1,n,t,e,a,r,0),f("z","y","x",1,-1,n,t,-e,a,r,1),f("x","z","y",1,1,e,n,t,i,a,2),f("x","z","y",1,-1,e,n,-t,i,a,3),f("x","y","z",1,-1,e,t,n,i,r,4),f("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(s),this.addAttribute("position",new ln(l,3)),this.addAttribute("normal",new ln(c,3)),this.addAttribute("uv",new ln(u,2))}function mn(e,t,n,i){Jt.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i},this.fromBufferGeometry(new vn(e,t,n,i)),this.mergeVertices()}function vn(e,t,n,i){fn.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};var r,a,o=(e=e||1)/2,s=(t=t||1)/2,l=Math.floor(n)||1,c=Math.floor(i)||1,u=l+1,d=c+1,h=e/l,f=t/c,p=[],g=[],m=[],v=[];for(a=0;a<d;a++){var y=a*f-s;for(r=0;r<u;r++){var _=r*h-o;g.push(_,-y,0),m.push(0,0,1),v.push(r/l),v.push(1-a/c)}}for(a=0;a<c;a++)for(r=0;r<l;r++){var E=r+u*a,b=r+u*(a+1),T=r+1+u*(a+1),S=r+1+u*a;p.push(E,b,S),p.push(b,T,S)}this.setIndex(p),this.addAttribute("position",new ln(g,3)),this.addAttribute("normal",new ln(m,3)),this.addAttribute("uv",new ln(v,2))}fn.prototype=Object.assign(Object.create(je.prototype),{constructor:fn,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(dn(e)>65535?sn:an)(e,1):this.index=e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):(this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new $t(arguments[1],arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var n=this.attributes.normal;void 0!==n&&((new Tt).getNormalMatrix(e).applyToBufferAttribute(n),n.needsUpdate=!0);var i=this.attributes.tangent;void 0!==i&&((new Tt).getNormalMatrix(e).applyToBufferAttribute(i),i.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new kt;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new kt;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new kt;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new kt;return function(t,n,i){return e.makeTranslation(t,n,i),this.applyMatrix(e),this}}(),scale:function(){var e=new kt;return function(t,n,i){return e.makeScale(t,n,i),this.applyMatrix(e),this}}(),lookAt:function(){var e=new Xt;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){var e=new bt;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var n=new ln(3*t.vertices.length,3),i=new ln(3*t.colors.length,3);if(this.addAttribute("position",n.copyVector3sArray(t.vertices)),this.addAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var r=new ln(t.lineDistances.length,1);this.addAttribute("lineDistance",r.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n];t.push(r.x,r.y,r.z||0)}return this.addAttribute("position",new ln(t,3)),this},updateFromObject:function(e){var t,n=e.geometry;if(e.isMesh){var i=n.__directGeometry;if(!0===n.elementsNeedUpdate&&(i=void 0,n.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(n);i.verticesNeedUpdate=n.verticesNeedUpdate,i.normalsNeedUpdate=n.normalsNeedUpdate,i.colorsNeedUpdate=n.colorsNeedUpdate,i.uvsNeedUpdate=n.uvsNeedUpdate,i.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=i}return!0===n.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(n.vertices),t.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(n.normals),t.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(n.colors),t.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(n.uvs),t.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(n.lineDistances),t.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(e.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new un).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new $t(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var n=new Float32Array(3*e.normals.length);this.addAttribute("normal",new $t(n,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var i=new Float32Array(3*e.colors.length);this.addAttribute("color",new $t(i,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var r=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new $t(r,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var a=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new $t(a,2).copyVector2sArray(e.uvs2))}for(var o in this.groups=e.groups,e.morphTargets){for(var s=[],l=e.morphTargets[o],c=0,u=l.length;c<u;c++){var d=l[c],h=new ln(3*d.data.length,3);h.name=d.name,s.push(h.copyVector3sArray(d.data))}this.morphAttributes[o]=s}if(e.skinIndices.length>0){var f=new ln(4*e.skinIndices.length,4);this.addAttribute("skinIndex",f.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var p=new ln(4*e.skinWeights.length,4);this.addAttribute("skinWeight",p.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){var e=new Pt;return function(){null===this.boundingBox&&(this.boundingBox=new Pt);var t=this.attributes.position,n=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),n)for(var i=0,r=n.length;i<r;i++){var a=n[i];e.setFromBufferAttribute(a),this.boundingBox.expandByPoint(e.min),this.boundingBox.expandByPoint(e.max)}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}(),computeBoundingSphere:function(){var e=new Pt,t=new Pt,n=new bt;return function(){null===this.boundingSphere&&(this.boundingSphere=new Dt);var i=this.attributes.position,r=this.morphAttributes.position;if(i){var a=this.boundingSphere.center;if(e.setFromBufferAttribute(i),r)for(var o=0,s=r.length;o<s;o++){var l=r[o];t.setFromBufferAttribute(l),e.expandByPoint(t.min),e.expandByPoint(t.max)}e.getCenter(a);var c=0;for(o=0,s=i.count;o<s;o++)n.fromBufferAttribute(i,o),c=Math.max(c,a.distanceToSquared(n));if(r)for(o=0,s=r.length;o<s;o++)for(var u=0,d=(l=r[o]).count;u<d;u++)n.fromBufferAttribute(l,u),c=Math.max(c,a.distanceToSquared(n));this.boundingSphere.radius=Math.sqrt(c),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var n=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new $t(new Float32Array(n.length),3));else for(var i=t.normal.array,r=0,a=i.length;r<a;r++)i[r]=0;var o,s,l,c=t.normal.array,u=new bt,d=new bt,h=new bt,f=new bt,p=new bt;if(e){var g=e.array;for(r=0,a=e.count;r<a;r+=3)o=3*g[r+0],s=3*g[r+1],l=3*g[r+2],u.fromArray(n,o),d.fromArray(n,s),h.fromArray(n,l),f.subVectors(h,d),p.subVectors(u,d),f.cross(p),c[o]+=f.x,c[o+1]+=f.y,c[o+2]+=f.z,c[s]+=f.x,c[s+1]+=f.y,c[s+2]+=f.z,c[l]+=f.x,c[l+1]+=f.y,c[l+2]+=f.z}else for(r=0,a=n.length;r<a;r+=9)u.fromArray(n,r),d.fromArray(n,r+3),h.fromArray(n,r+6),f.subVectors(h,d),p.subVectors(u,d),f.cross(p),c[r]=f.x,c[r+1]=f.y,c[r+2]=f.z,c[r+3]=f.x,c[r+4]=f.y,c[r+5]=f.z,c[r+6]=f.x,c[r+7]=f.y,c[r+8]=f.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var i in n)if(void 0!==e.attributes[i])for(var r=n[i].array,a=e.attributes[i],o=a.array,s=a.itemSize*t,l=Math.min(o.length,r.length-s),c=0,u=s;c<l;c++,u++)r[u]=o[c];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){var e=new bt;return function(){for(var t=this.attributes.normal,n=0,i=t.count;n<i;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.normalize(),t.setXYZ(n,e.x,e.y,e.z)}}(),toNonIndexed:function(){function e(e,t){for(var n=e.array,i=e.itemSize,r=new n.constructor(t.length*i),a=0,o=0,s=0,l=t.length;s<l;s++){a=t[s]*i;for(var c=0;c<i;c++)r[o++]=n[a++]}return new $t(r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new fn,n=this.index.array,i=this.attributes;for(var r in i){var a=e(i[r],n);t.addAttribute(r,a)}var o=this.morphAttributes;for(r in o){for(var s=[],l=o[r],c=0,u=l.length;c<u;c++){a=e(l[c],n);s.push(a)}t.morphAttributes[r]=s}for(var d=this.groups,h=(c=0,d.length);c<h;c++){var f=d[c];t.addGroup(f.start,f.count,f.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var i=this.index;null!==i&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});var r=this.attributes;for(var n in r){var a=(h=r[n]).toJSON();""!==h.name&&(a.name=h.name),e.data.attributes[n]=a}var o={},s=!1;for(var n in this.morphAttributes){for(var l=this.morphAttributes[n],c=[],u=0,d=l.length;u<d;u++){var h;a=(h=l[u]).toJSON();""!==h.name&&(a.name=h.name),c.push(a)}c.length>0&&(o[n]=c,s=!0)}s&&(e.data.morphAttributes=o);var f=this.groups;f.length>0&&(e.data.groups=JSON.parse(JSON.stringify(f)));var p=this.boundingSphere;return null!==p&&(e.data.boundingSphere={center:p.center.toArray(),radius:p.radius}),e},clone:function(){return(new fn).copy(this)},copy:function(e){var t,n,i;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var r=e.index;null!==r&&this.setIndex(r.clone());var a=e.attributes;for(t in a){var o=a[t];this.addAttribute(t,o.clone())}var s=e.morphAttributes;for(t in s){var l=[],c=s[t];for(n=0,i=c.length;n<i;n++)l.push(c[n].clone());this.morphAttributes[t]=l}var u=e.groups;for(n=0,i=u.length;n<i;n++){var d=u[n];this.addGroup(d.start,d.count,d.materialIndex)}var h=e.boundingBox;null!==h&&(this.boundingBox=h.clone());var f=e.boundingSphere;return null!==f&&(this.boundingSphere=f.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),pn.prototype=Object.create(Jt.prototype),pn.prototype.constructor=pn,gn.prototype=Object.create(fn.prototype),gn.prototype.constructor=gn,mn.prototype=Object.create(Jt.prototype),mn.prototype.constructor=mn,vn.prototype=Object.create(fn.prototype),vn.prototype.constructor=vn;var yn=0;function _n(){Object.defineProperty(this,"id",{value:yn++}),this.uuid=yt.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=0,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=We,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.userData={},this.needsUpdate=!0}_n.prototype=Object.assign(Object.create(je.prototype),{constructor:_n,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearCoat&&(n.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(n.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),0!==this.side&&(n.side=this.side),0!==this.vertexColors&&(n.vertexColors=this.vertexColors),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var r=i(e.textures),a=i(e.images);r.length>0&&(n.textures=r),a.length>0&&(n.images=a)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,n=null;if(null!==t){var i=t.length;n=new Array(i);for(var r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});function En(e){_n.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function bn(e,t){this.origin=void 0!==e?e:new bt,this.direction=void 0!==t?t:new bt}function Tn(e,t,n){this.a=void 0!==e?e:new bt,this.b=void 0!==t?t:new bt,this.c=void 0!==n?n:new bt}function Sn(e){_n.call(this),this.type="MeshBasicMaterial",this.color=new Gt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function wn(e,t){Xt.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new fn,this.material=void 0!==t?t:new Sn({color:16777215*Math.random()}),this.drawMode=0,this.updateMorphTargets()}function An(e,t,n,i){var r,a,o=new Gt(0),s=0,l=null,c=0;function u(e,n){t.buffers.color.setClear(e.r,e.g,e.b,n,i)}return{getClearColor:function(){return o},setClearColor:function(e,t){o.set(e),u(o,s=void 0!==t?t:1)},getClearAlpha:function(){return s},setClearAlpha:function(e){u(o,s=e)},render:function(t,i,d,h){var f=i.background,p=e.vr,g=p.getSession&&p.getSession();if(g&&"additive"===g.environmentBlendMode&&(f=null),null===f?(u(o,s),l=null,c=0):f&&f.isColor&&(u(f,1),h=!0,l=null,c=0),(e.autoClear||h)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),f&&(f.isCubeTexture||f.isWebGLRenderTargetCube)){void 0===a&&((a=new wn(new gn(1,1,1),new En({type:"BackgroundCubeMaterial",uniforms:Bt(jt.cube.uniforms),vertexShader:jt.cube.vertexShader,fragmentShader:jt.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),a.geometry.removeAttribute("uv"),a.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.tCube.value}}),n.update(a));var m=f.isWebGLRenderTargetCube?f.texture:f;a.material.uniforms.tCube.value=m,a.material.uniforms.tFlip.value=f.isWebGLRenderTargetCube?1:-1,(l!==f||c!==m.version)&&(a.material.needsUpdate=!0,l=f,c=m.version),t.unshift(a,a.geometry,a.material,0,0,null)}else f&&f.isTexture&&(void 0===r&&((r=new wn(new vn(2,2),new En({type:"BackgroundMaterial",uniforms:Bt(jt.background.uniforms),vertexShader:jt.background.vertexShader,fragmentShader:jt.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),Object.defineProperty(r.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(r)),r.material.uniforms.t2D.value=f,!0===f.matrixAutoUpdate&&f.updateMatrix(),r.material.uniforms.uvTransform.value.copy(f.matrix),(l!==f||c!==f.version)&&(r.material.needsUpdate=!0,l=f,c=f.version),t.unshift(r,r.geometry,r.material,0,0,null))}}}function Rn(e,t,n,i){var r;this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r)},this.renderInstances=function(a,o,s){var l;if(i.isWebGL2)l=e;else if(null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[i.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](r,o,s,a.maxInstancedCount),n.update(s,r,a.maxInstancedCount)}}function xn(e,t,n){var i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext,o=void 0!==n.precision?n.precision:"highp",s=r(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var l=!0===n.logarithmicDepthBuffer,c=e.getParameter(34930),u=e.getParameter(35660),d=e.getParameter(3379),h=e.getParameter(34076),f=e.getParameter(34921),p=e.getParameter(36347),g=e.getParameter(36348),m=e.getParameter(36349),v=u>0,y=a||!!t.get("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:function(){if(void 0!==i)return i;var n=t.get("EXT_texture_filter_anisotropic");return i=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:h,maxAttributes:f,maxVertexUniforms:p,maxVaryings:g,maxFragmentUniforms:m,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:a?e.getParameter(36183):0}}function In(){var e=this,t=null,n=0,i=!1,r=!1,a=new Ot,o=new Tt,s={value:null,needsUpdate:!1};function l(){s.value!==t&&(s.value=t,s.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function c(t,n,i,r){var l=null!==t?t.length:0,c=null;if(0!==l){if(c=s.value,!0!==r||null===c){var u=i+4*l,d=n.matrixWorldInverse;o.getNormalMatrix(d),(null===c||c.length<u)&&(c=new Float32Array(u));for(var h=0,f=i;h!==l;++h,f+=4)a.copy(t[h]).applyMatrix4(d,o),a.normal.toArray(c,f),c[f+3]=a.constant}s.value=c,s.needsUpdate=!0}return e.numPlanes=l,c}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,r,a){var o=0!==e.length||r||0!==n||i;return i=r,t=c(e,a,0),n=e.length,o},this.beginShadows=function(){r=!0,c(null)},this.endShadows=function(){r=!1,l()},this.setState=function(e,a,o,u,d,h){if(!i||null===e||0===e.length||r&&!o)r?c(null):l();else{var f=r?0:n,p=4*f,g=d.clippingState||null;s.value=g,g=c(e,u,p,h);for(var m=0;m!==p;++m)g[m]=t[m];d.clippingState=g,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=f}}}function Ln(e){var t={};return{get:function(n){if(void 0!==t[n])return t[n];var i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return null===i&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),t[n]=i,i}}}function Mn(e,t,n){var i={},r={};function a(e){var o=e.target,s=i[o.id];for(var l in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[l]);o.removeEventListener("dispose",a),delete i[o.id];var c=r[s.id];c&&(t.remove(c),delete r[s.id]),n.memory.geometries--}return{get:function(e,t){var r=i[t.id];return r||(t.addEventListener("dispose",a),t.isBufferGeometry?r=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new fn).setFromObject(e)),r=t._bufferGeometry),i[t.id]=r,n.memory.geometries++,r)},update:function(e){var n=e.index,i=e.attributes;for(var r in null!==n&&t.update(n,34963),i)t.update(i[r],34962);var a=e.morphAttributes;for(var r in a)for(var o=a[r],s=0,l=o.length;s<l;s++)t.update(o[s],34962)},getWireframeAttribute:function(e){var n=r[e.id];if(n)return n;var i,a=[],o=e.index,s=e.attributes;if(null!==o)for(var l=0,c=(i=o.array).length;l<c;l+=3){var u=i[l+0],d=i[l+1],h=i[l+2];a.push(u,d,d,h,h,u)}else for(l=0,c=(i=s.position.array).length/3-1;l<c;l+=3){u=l+0,d=l+1,h=l+2;a.push(u,d,d,h,h,u)}return n=new(dn(a)>65535?sn:an)(a,1),t.update(n,34963),r[e.id]=n,n}}}function Cn(e,t,n,i){var r,a,o;this.setMode=function(e){r=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,i){e.drawElements(r,i,a,t*o),n.update(i,r)},this.renderInstances=function(s,l,c){var u;if(i.isWebGL2)u=e;else if(null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[i.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](r,c,a,l*o,s.maxInstancedCount),n.update(c,r,s.maxInstancedCount)}}function Pn(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,i){switch(i=i||1,t.calls++,n){case 4:t.triangles+=i*(e/3);break;case 5:case 6:t.triangles+=i*(e-2);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Dn(e,t){return Math.abs(t[1])-Math.abs(e[1])}function On(e){var t={},n=new Float32Array(8);return{update:function(i,r,a,o){var s=i.morphTargetInfluences,l=s.length,c=t[r.id];if(void 0===c){c=[];for(var u=0;u<l;u++)c[u]=[u,0];t[r.id]=c}var d=a.morphTargets&&r.morphAttributes.position,h=a.morphNormals&&r.morphAttributes.normal;for(u=0;u<l;u++){0!==(f=c[u])[1]&&(d&&r.removeAttribute("morphTarget"+u),h&&r.removeAttribute("morphNormal"+u))}for(u=0;u<l;u++){(f=c[u])[0]=u,f[1]=s[u]}for(c.sort(Dn),u=0;u<8;u++){var f;if(f=c[u]){var p=f[0],g=f[1];if(g){d&&r.addAttribute("morphTarget"+u,d[p]),h&&r.addAttribute("morphNormal"+u,h[p]),n[u]=g;continue}}n[u]=0}o.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function Nn(e,t){var n={};return{update:function(i){var r=t.render.frame,a=i.geometry,o=e.get(i,a);return n[o.id]!==r&&(a.isGeometry&&o.updateFromObject(i),e.update(o),n[o.id]=r),o},dispose:function(){n={}}}}function kn(e,t,n,i,r,a,o,s,l,c){e=void 0!==e?e:[],t=void 0!==t?t:301,o=void 0!==o?o:st,Rt.call(this,e,t,n,i,r,a,o,s,l,c),this.flipY=!1}function Fn(e,t,n,i){Rt.call(this,null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=Qe,this.minFilter=Qe,this.wrapR=Ke,this.generateMipmaps=!1,this.flipY=!1}function Bn(e,t,n,i){Rt.call(this,null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=Qe,this.minFilter=Qe,this.wrapR=Ke,this.generateMipmaps=!1,this.flipY=!1}En.prototype=Object.create(_n.prototype),En.prototype.constructor=En,En.prototype.isShaderMaterial=!0,En.prototype.copy=function(e){return _n.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Bt(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},En.prototype.toJSON=function(e){var t=_n.prototype.toJSON.call(this,e);for(var n in t.uniforms={},this.uniforms){var i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var r={};for(var a in this.extensions)!0===this.extensions[a]&&(r[a]=!0);return Object.keys(r).length>0&&(t.extensions=r),t},Object.assign(bn.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new bt),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new bt;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new bt),t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new bt;return function(t){var n=e.subVectors(t,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(n).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new bt,t=new bt,n=new bt;return function(i,r,a,o){e.copy(i).add(r).multiplyScalar(.5),t.copy(r).sub(i).normalize(),n.copy(this.origin).sub(e);var s,l,c,u,d=.5*i.distanceTo(r),h=-this.direction.dot(t),f=n.dot(this.direction),p=-n.dot(t),g=n.lengthSq(),m=Math.abs(1-h*h);if(m>0)if(l=h*f-p,u=d*m,(s=h*p-f)>=0)if(l>=-u)if(l<=u){var v=1/m;c=(s*=v)*(s+h*(l*=v)+2*f)+l*(h*s+l+2*p)+g}else l=d,c=-(s=Math.max(0,-(h*l+f)))*s+l*(l+2*p)+g;else l=-d,c=-(s=Math.max(0,-(h*l+f)))*s+l*(l+2*p)+g;else l<=-u?c=-(s=Math.max(0,-(-h*d+f)))*s+(l=s>0?-d:Math.min(Math.max(-d,-p),d))*(l+2*p)+g:l<=u?(s=0,c=(l=Math.min(Math.max(-d,-p),d))*(l+2*p)+g):c=-(s=Math.max(0,-(h*d+f)))*s+(l=s>0?d:Math.min(Math.max(-d,-p),d))*(l+2*p)+g;else l=h>0?-d:d,c=-(s=Math.max(0,-(h*l+f)))*s+l*(l+2*p)+g;return a&&a.copy(this.direction).multiplyScalar(s).add(this.origin),o&&o.copy(t).multiplyScalar(l).add(e),c}}(),intersectSphere:function(){var e=new bt;return function(t,n){e.subVectors(t.center,this.origin);var i=e.dot(this.direction),r=e.dot(e)-i*i,a=t.radius*t.radius;if(r>a)return null;var o=Math.sqrt(a-r),s=i-o,l=i+o;return s<0&&l<0?null:s<0?this.at(l,n):this.at(s,n)}}(),intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var n,i,r,a,o,s,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,d=this.origin;return l>=0?(n=(e.min.x-d.x)*l,i=(e.max.x-d.x)*l):(n=(e.max.x-d.x)*l,i=(e.min.x-d.x)*l),c>=0?(r=(e.min.y-d.y)*c,a=(e.max.y-d.y)*c):(r=(e.max.y-d.y)*c,a=(e.min.y-d.y)*c),n>a||r>i||((r>n||n!=n)&&(n=r),(a<i||i!=i)&&(i=a),u>=0?(o=(e.min.z-d.z)*u,s=(e.max.z-d.z)*u):(o=(e.max.z-d.z)*u,s=(e.min.z-d.z)*u),n>s||o>i)||((o>n||n!=n)&&(n=o),(s<i||i!=i)&&(i=s),i<0)?null:this.at(n>=0?n:i,t)},intersectsBox:function(){var e=new bt;return function(t){return null!==this.intersectBox(t,e)}}(),intersectTriangle:function(){var e=new bt,t=new bt,n=new bt,i=new bt;return function(r,a,o,s,l){t.subVectors(a,r),n.subVectors(o,r),i.crossVectors(t,n);var c,u=this.direction.dot(i);if(u>0){if(s)return null;c=1}else{if(!(u<0))return null;c=-1,u=-u}e.subVectors(this.origin,r);var d=c*this.direction.dot(n.crossVectors(e,n));if(d<0)return null;var h=c*this.direction.dot(t.cross(e));if(h<0||d+h>u)return null;var f=-c*e.dot(i);return f<0?null:this.at(f/u,l)}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(Tn,{getNormal:function(){var e=new bt;return function(t,n,i,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new bt),r.subVectors(i,n),e.subVectors(t,n),r.cross(e);var a=r.lengthSq();return a>0?r.multiplyScalar(1/Math.sqrt(a)):r.set(0,0,0)}}(),getBarycoord:function(){var e=new bt,t=new bt,n=new bt;return function(i,r,a,o,s){e.subVectors(o,r),t.subVectors(a,r),n.subVectors(i,r);var l=e.dot(e),c=e.dot(t),u=e.dot(n),d=t.dot(t),h=t.dot(n),f=l*d-c*c;if(void 0===s&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),s=new bt),0===f)return s.set(-2,-1,-1);var p=1/f,g=(d*u-c*h)*p,m=(l*h-c*u)*p;return s.set(1-g-m,m,g)}}(),containsPoint:function(){var e=new bt;return function(t,n,i,r){return Tn.getBarycoord(t,n,i,r,e),e.x>=0&&e.y>=0&&e.x+e.y<=1}}(),getUV:function(){var e=new bt;return function(t,n,i,r,a,o,s,l){return this.getBarycoord(t,n,i,r,e),l.set(0,0),l.addScaledVector(a,e.x),l.addScaledVector(o,e.y),l.addScaledVector(s,e.z),l}}(),isFrontFacing:function(){var e=new bt,t=new bt;return function(n,i,r,a){return e.subVectors(r,i),t.subVectors(n,i),e.cross(t).dot(a)<0}}()}),Object.assign(Tn.prototype,{set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new bt,t=new bt;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new bt),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return Tn.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new bt),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return Tn.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,n,i,r){return Tn.getUV(e,this.a,this.b,this.c,t,n,i,r)},containsPoint:function(e){return Tn.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return Tn.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(){var e=new bt,t=new bt,n=new bt,i=new bt,r=new bt,a=new bt;return function(o,s){void 0===s&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),s=new bt);var l,c,u=this.a,d=this.b,h=this.c;e.subVectors(d,u),t.subVectors(h,u),i.subVectors(o,u);var f=e.dot(i),p=t.dot(i);if(f<=0&&p<=0)return s.copy(u);r.subVectors(o,d);var g=e.dot(r),m=t.dot(r);if(g>=0&&m<=g)return s.copy(d);var v=f*m-g*p;if(v<=0&&f>=0&&g<=0)return l=f/(f-g),s.copy(u).addScaledVector(e,l);a.subVectors(o,h);var y=e.dot(a),_=t.dot(a);if(_>=0&&y<=_)return s.copy(h);var E=y*p-f*_;if(E<=0&&p>=0&&_<=0)return c=p/(p-_),s.copy(u).addScaledVector(t,c);var b=g*_-y*m;if(b<=0&&m-g>=0&&y-_>=0)return n.subVectors(h,d),c=(m-g)/(m-g+(y-_)),s.copy(d).addScaledVector(n,c);var T=1/(b+E+v);return l=E*T,c=v*T,s.copy(u).addScaledVector(e,l).addScaledVector(t,c)}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),Sn.prototype=Object.create(_n.prototype),Sn.prototype.constructor=Sn,Sn.prototype.isMeshBasicMaterial=!0,Sn.prototype.copy=function(e){return _n.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},wn.prototype=Object.assign(Object.create(Xt.prototype),{constructor:wn,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return Xt.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,n,i=this.geometry;if(i.isBufferGeometry){var r=i.morphAttributes,a=Object.keys(r);if(a.length>0){var o=r[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)n=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var s=i.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(){var e=new kt,t=new bn,n=new Dt,i=new bt,r=new bt,a=new bt,o=new bt,s=new bt,l=new bt,c=new bt,u=new bt,d=new bt,h=new _t,f=new _t,p=new _t,g=new bt,m=new bt;function v(e,t,n,i,r,a,o,s){if(null===(1===t.side?i.intersectTriangle(o,a,r,!0,s):i.intersectTriangle(r,a,o,2!==t.side,s)))return null;m.copy(s),m.applyMatrix4(e.matrixWorld);var l=n.ray.origin.distanceTo(m);return l<n.near||l>n.far?null:{distance:l,point:m.clone(),object:e}}function y(e,t,n,m,y,_,E,b,T,S){i.fromBufferAttribute(y,b),r.fromBufferAttribute(y,T),a.fromBufferAttribute(y,S);var w=e.morphTargetInfluences;if(t.morphTargets&&_&&w){c.set(0,0,0),u.set(0,0,0),d.set(0,0,0);for(var A=0,R=_.length;A<R;A++){var x=w[A],I=_[A];0!==x&&(o.fromBufferAttribute(I,b),s.fromBufferAttribute(I,T),l.fromBufferAttribute(I,S),c.addScaledVector(o.sub(i),x),u.addScaledVector(s.sub(r),x),d.addScaledVector(l.sub(a),x))}i.add(c),r.add(u),a.add(d)}var L=v(e,t,n,m,i,r,a,g);if(L){E&&(h.fromBufferAttribute(E,b),f.fromBufferAttribute(E,T),p.fromBufferAttribute(E,S),L.uv=Tn.getUV(g,i,r,a,h,f,p,new _t));var M=new qt(b,T,S);Tn.getNormal(i,r,a,M.normal),L.face=M}return L}return function(i,r){var a,o=this.geometry,s=this.material,l=this.matrixWorld;if(void 0!==s&&(null===o.boundingSphere&&o.computeBoundingSphere(),n.copy(o.boundingSphere),n.applyMatrix4(l),!1!==i.ray.intersectsSphere(n)&&(e.getInverse(l),t.copy(i.ray).applyMatrix4(e),null===o.boundingBox||!1!==t.intersectsBox(o.boundingBox))))if(o.isBufferGeometry){var c,u,d,m,_,E,b,T,S,w=o.index,A=o.attributes.position,R=o.morphAttributes.position,x=o.attributes.uv,I=o.groups,L=o.drawRange;if(null!==w)if(Array.isArray(s))for(m=0,E=I.length;m<E;m++)for(S=s[(T=I[m]).materialIndex],_=Math.max(T.start,L.start),b=Math.min(T.start+T.count,L.start+L.count);_<b;_+=3)c=w.getX(_),u=w.getX(_+1),d=w.getX(_+2),(a=y(this,S,i,t,A,R,x,c,u,d))&&(a.faceIndex=Math.floor(_/3),a.face.materialIndex=T.materialIndex,r.push(a));else for(m=Math.max(0,L.start),E=Math.min(w.count,L.start+L.count);m<E;m+=3)c=w.getX(m),u=w.getX(m+1),d=w.getX(m+2),(a=y(this,s,i,t,A,R,x,c,u,d))&&(a.faceIndex=Math.floor(m/3),r.push(a));else if(void 0!==A)if(Array.isArray(s))for(m=0,E=I.length;m<E;m++)for(S=s[(T=I[m]).materialIndex],_=Math.max(T.start,L.start),b=Math.min(T.start+T.count,L.start+L.count);_<b;_+=3)(a=y(this,S,i,t,A,R,x,c=_,u=_+1,d=_+2))&&(a.faceIndex=Math.floor(_/3),a.face.materialIndex=T.materialIndex,r.push(a));else for(m=Math.max(0,L.start),E=Math.min(A.count,L.start+L.count);m<E;m+=3)(a=y(this,s,i,t,A,R,x,c=m,u=m+1,d=m+2))&&(a.faceIndex=Math.floor(m/3),r.push(a))}else if(o.isGeometry){var M,C,P,D,O=Array.isArray(s),N=o.vertices,k=o.faces,F=o.faceVertexUvs[0];F.length>0&&(D=F);for(var B=0,U=k.length;B<U;B++){var V=k[B],G=O?s[V.materialIndex]:s;if(void 0!==G&&(M=N[V.a],C=N[V.b],P=N[V.c],a=v(this,G,i,t,M,C,P,g))){if(D&&D[B]){var H=D[B];h.copy(H[0]),f.copy(H[1]),p.copy(H[2]),a.uv=Tn.getUV(g,M,C,P,h,f,p,new _t)}a.face=V,a.faceIndex=B,r.push(a)}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),kn.prototype=Object.create(Rt.prototype),kn.prototype.constructor=kn,kn.prototype.isCubeTexture=!0,Object.defineProperty(kn.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),Fn.prototype=Object.create(Rt.prototype),Fn.prototype.constructor=Fn,Fn.prototype.isDataTexture2DArray=!0,Bn.prototype=Object.create(Rt.prototype),Bn.prototype.constructor=Bn,Bn.prototype.isDataTexture3D=!0;var Un=new Rt,Vn=new Fn,Gn=new Bn,Hn=new kn,jn=[],zn=[],Zn=new Float32Array(16),qn=new Float32Array(9),Wn=new Float32Array(4);function Yn(e,t,n){var i=e[0];if(i<=0||i>0)return e;var r=t*n,a=jn[r];if(void 0===a&&(a=new Float32Array(r),jn[r]=a),0!==t){i.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(a,s)}return a}function Kn(e,t){if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function Xn(e,t){for(var n=0,i=t.length;n<i;n++)e[n]=t[n]}function Qn(e,t){var n=zn[t];void 0===n&&(n=new Int32Array(t),zn[t]=n);for(var i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function Jn(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function $n(e,t){var n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Kn(n,t))return;e.uniform2fv(this.addr,t),Xn(n,t)}}function ei(e,t){var n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)(n[0]!==t.r||n[1]!==t.g||n[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Kn(n,t))return;e.uniform3fv(this.addr,t),Xn(n,t)}}function ti(e,t){var n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z||n[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Kn(n,t))return;e.uniform4fv(this.addr,t),Xn(n,t)}}function ni(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(Kn(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Xn(n,t)}else{if(Kn(n,i))return;Wn.set(i),e.uniformMatrix2fv(this.addr,!1,Wn),Xn(n,i)}}function ii(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(Kn(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Xn(n,t)}else{if(Kn(n,i))return;qn.set(i),e.uniformMatrix3fv(this.addr,!1,qn),Xn(n,i)}}function ri(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(Kn(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Xn(n,t)}else{if(Kn(n,i))return;Zn.set(i),e.uniformMatrix4fv(this.addr,!1,Zn),Xn(n,i)}}function ai(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(t||Un,r)}function oi(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||Vn,r)}function si(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||Gn,r)}function li(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTextureCube(t||Hn,r)}function ci(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function ui(e,t){var n=this.cache;Kn(n,t)||(e.uniform2iv(this.addr,t),Xn(n,t))}function di(e,t){var n=this.cache;Kn(n,t)||(e.uniform3iv(this.addr,t),Xn(n,t))}function hi(e,t){var n=this.cache;Kn(n,t)||(e.uniform4iv(this.addr,t),Xn(n,t))}function fi(e,t){e.uniform1fv(this.addr,t)}function pi(e,t){e.uniform1iv(this.addr,t)}function gi(e,t){e.uniform2iv(this.addr,t)}function mi(e,t){e.uniform3iv(this.addr,t)}function vi(e,t){e.uniform4iv(this.addr,t)}function yi(e,t){var n=Yn(t,this.size,2);e.uniform2fv(this.addr,n)}function _i(e,t){var n=Yn(t,this.size,3);e.uniform3fv(this.addr,n)}function Ei(e,t){var n=Yn(t,this.size,4);e.uniform4fv(this.addr,n)}function bi(e,t){var n=Yn(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Ti(e,t){var n=Yn(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Si(e,t){var n=Yn(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function wi(e,t,n){var i=t.length,r=Qn(n,i);e.uniform1iv(this.addr,r);for(var a=0;a!==i;++a)n.safeSetTexture2D(t[a]||Un,r[a])}function Ai(e,t,n){var i=t.length,r=Qn(n,i);e.uniform1iv(this.addr,r);for(var a=0;a!==i;++a)n.safeSetTextureCube(t[a]||Hn,r[a])}function Ri(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Jn;case 35664:return $n;case 35665:return ei;case 35666:return ti;case 35674:return ni;case 35675:return ii;case 35676:return ri;case 35678:case 36198:return ai;case 35679:return si;case 35680:return li;case 36289:return oi;case 5124:case 35670:return ci;case 35667:case 35671:return ui;case 35668:case 35672:return di;case 35669:case 35673:return hi}}(t.type)}function xi(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return fi;case 35664:return yi;case 35665:return _i;case 35666:return Ei;case 35674:return bi;case 35675:return Ti;case 35676:return Si;case 35678:return wi;case 35680:return Ai;case 5124:case 35670:return pi;case 35667:case 35671:return gi;case 35668:case 35672:return mi;case 35669:case 35673:return vi}}(t.type)}function Ii(e){this.id=e,this.seq=[],this.map={}}xi.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Xn(t,e)},Ii.prototype.setValue=function(e,t,n){for(var i=this.seq,r=0,a=i.length;r!==a;++r){var o=i[r];o.setValue(e,t[o.id],n)}};var Li=/([\w\d_]+)(\])?(\[|\.)?/g;function Mi(e,t){e.seq.push(t),e.map[t.id]=t}function Ci(e,t,n){var i=e.name,r=i.length;for(Li.lastIndex=0;;){var a=Li.exec(i),o=Li.lastIndex,s=a[1],l="]"===a[2],c=a[3];if(l&&(s|=0),void 0===c||"["===c&&o+2===r){Mi(n,void 0===c?new Ri(s,e,t):new xi(s,e,t));break}var u=n.map[s];void 0===u&&Mi(n,u=new Ii(s)),n=u}}function Pi(e,t){this.seq=[],this.map={};for(var n=e.getProgramParameter(t,35718),i=0;i<n;++i){var r=e.getActiveUniform(t,i);Ci(r,e.getUniformLocation(t,r.name),this)}}function Di(e,t,n,i){var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),!0===i&&(!1===e.getShaderParameter(r,35713)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(r)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",35633===t?"vertex":"fragment",e.getShaderInfoLog(r),function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(n))),r}Pi.prototype.setValue=function(e,t,n,i){var r=this.map[t];void 0!==r&&r.setValue(e,n,i)},Pi.prototype.setOptional=function(e,t,n){var i=t[n];void 0!==i&&this.setValue(e,n,i)},Pi.upload=function(e,t,n,i){for(var r=0,a=t.length;r!==a;++r){var o=t[r],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,i)}},Pi.seqWithValue=function(e,t){for(var n=[],i=0,r=e.length;i!==r;++i){var a=e[i];a.id in t&&n.push(a)}return n};var Oi=0;function Ni(e){switch(e){case vt:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function ki(e,t){var n=Ni(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Fi(e,t){var n=Ni(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Bi(e,t){var n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="Uncharted2";break;case 4:n="OptimizedCineon";break;case 5:n="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Ui(e){return""!==e}function Vi(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function Gi(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function Hi(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(e,t){var n=Ft[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return Hi(n)})}function ji(e){return e.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(e,t,n,i){for(var r="",a=parseInt(t);a<parseInt(n);a++)r+=i.replace(/\[ i \]/g,"[ "+a+" ]");return r})}function zi(e,t,n,i,r,a,o,s){var l=e.context,c=i.defines,u=r.vertexShader,d=r.fragmentShader,h="SHADOWMAP_TYPE_BASIC";1===a.shadowMapType?h="SHADOWMAP_TYPE_PCF":2===a.shadowMapType&&(h="SHADOWMAP_TYPE_PCF_SOFT");var f="ENVMAP_TYPE_CUBE",p="ENVMAP_MODE_REFLECTION",g="ENVMAP_BLENDING_MULTIPLY";if(a.envMap){switch(i.envMap.mapping){case 301:case 302:f="ENVMAP_TYPE_CUBE";break;case 306:case 307:f="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:f="ENVMAP_TYPE_EQUIREC";break;case 305:f="ENVMAP_TYPE_SPHERE"}switch(i.envMap.mapping){case 302:case 304:p="ENVMAP_MODE_REFRACTION"}switch(i.combine){case 0:g="ENVMAP_BLENDING_MULTIPLY";break;case 1:g="ENVMAP_BLENDING_MIX";break;case 2:g="ENVMAP_BLENDING_ADD"}}var m,v,y=e.gammaFactor>0?e.gammaFactor:1,_=o.isWebGL2?"":function(e,t,n){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap&&!t.objectSpaceNormalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&n.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&n.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&n.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ui).join("\n")}(i.extensions,a,t),E=function(e){var t=[];for(var n in e){var i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(c),b=l.createProgram();if(i.isRawShaderMaterial?((m=[E].filter(Ui).join("\n")).length>0&&(m+="\n"),(v=[_,E].filter(Ui).join("\n")).length>0&&(v+="\n")):(m=["precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+r.name,E,a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+y,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+p:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+h:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ui).join("\n"),v=[_,"precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+r.name,E,a.alphaTest?"#define ALPHATEST "+a.alphaTest+(a.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+y,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.matcap?"#define USE_MATCAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+f:"",a.envMap?"#define "+p:"",a.envMap?"#define "+g:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+h:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",a.envMap&&(o.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",0!==a.toneMapping?"#define TONE_MAPPING":"",0!==a.toneMapping?Ft.tonemapping_pars_fragment:"",0!==a.toneMapping?Bi("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.outputEncoding||a.mapEncoding||a.matcapEncoding||a.envMapEncoding||a.emissiveMapEncoding?Ft.encodings_pars_fragment:"",a.mapEncoding?ki("mapTexelToLinear",a.mapEncoding):"",a.matcapEncoding?ki("matcapTexelToLinear",a.matcapEncoding):"",a.envMapEncoding?ki("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMapEncoding?ki("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.outputEncoding?Fi("linearToOutputTexel",a.outputEncoding):"",a.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Ui).join("\n")),u=Gi(u=Vi(u=Hi(u),a),a),d=Gi(d=Vi(d=Hi(d),a),a),u=ji(u),d=ji(d),o.isWebGL2&&!i.isRawShaderMaterial){var T=!1,S=/^\s*#version\s+300\s+es\s*\n/;i.isShaderMaterial&&null!==u.match(S)&&null!==d.match(S)&&(T=!0,u=u.replace(S,""),d=d.replace(S,"")),m=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+m,v=["#version 300 es\n","#define varying in",T?"":"out highp vec4 pc_fragColor;",T?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v}var w,A,R=v+d,x=Di(l,35633,m+u,e.debug.checkShaderErrors),I=Di(l,35632,R,e.debug.checkShaderErrors);if(l.attachShader(b,x),l.attachShader(b,I),void 0!==i.index0AttributeName?l.bindAttribLocation(b,0,i.index0AttributeName):!0===a.morphTargets&&l.bindAttribLocation(b,0,"position"),l.linkProgram(b),e.debug.checkShaderErrors){var L=l.getProgramInfoLog(b).trim(),M=l.getShaderInfoLog(x).trim(),C=l.getShaderInfoLog(I).trim(),P=!0,D=!0;!1===l.getProgramParameter(b,35714)?(P=!1,console.error("THREE.WebGLProgram: shader error: ",l.getError(),"35715",l.getProgramParameter(b,35715),"gl.getProgramInfoLog",L,M,C)):""!==L?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",L):(""===M||""===C)&&(D=!1),D&&(this.diagnostics={runnable:P,material:i,programLog:L,vertexShader:{log:M,prefix:m},fragmentShader:{log:C,prefix:v}})}return l.deleteShader(x),l.deleteShader(I),this.getUniforms=function(){return void 0===w&&(w=new Pi(l,b)),w},this.getAttributes=function(){return void 0===A&&(A=function(e,t){for(var n={},i=e.getProgramParameter(t,35721),r=0;r<i;r++){var a=e.getActiveAttrib(t,r).name;n[a]=e.getAttribLocation(t,a)}return n}(l,b)),A},this.destroy=function(){l.deleteProgram(b),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.name=r.name,this.id=Oi++,this.code=n,this.usedTimes=1,this.program=b,this.vertexShader=x,this.fragmentShader=I,this}function Zi(e,t,n,i){var r=[],a={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},o=["precision","supportsVertexTextures","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function s(e,t){var n;return e?e.isTexture?n=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),n=e.texture.encoding):n=vt,n===vt&&t&&(n=3007),n}this.getParameters=function(t,i,r,o,l,c,u){var d=a[t.type],h=u.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(n.floatVertexTextures)return 1024;var i=n.maxVertexUniforms,r=Math.floor((i-20)/4),a=Math.min(r,t.length);return a<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+a+"."),0):a}(u):0,f=n.precision;null!==t.precision&&((f=n.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",f,"instead."));var p=e.getRenderTarget();return{shaderID:d,precision:f,supportsVertexTextures:n.vertexTextures,outputEncoding:s(p?p.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:s(t.map,e.gammaInput),matcap:!!t.matcap,matcapEncoding:s(t.matcap,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:s(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(306===t.envMap.mapping||307===t.envMap.mapping),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:s(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:1===t.normalMapType,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexTangents:t.normalMap&&t.vertexTangents,vertexColors:t.vertexColors,fog:!!o,useFog:t.fog,fogExp:o&&o.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:n.logarithmicDepthBuffer,skinning:t.skinning&&h>0,maxBones:h,useVertexTexture:n.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:i.directional.length,numPointLights:i.point.length,numSpotLights:i.spot.length,numRectAreaLights:i.rectArea.length,numHemiLights:i.hemi.length,numClippingPlanes:l,numClipIntersection:c,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.receiveShadow&&r.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:2===t.side,flipSided:1===t.side,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCode=function(t,n){var i=[];if(n.shaderID?i.push(n.shaderID):(i.push(t.fragmentShader),i.push(t.vertexShader)),void 0!==t.defines)for(var r in t.defines)i.push(r),i.push(t.defines[r]);for(var a=0;a<o.length;a++)i.push(n[o[a]]);return i.push(t.onBeforeCompile.toString()),i.push(e.gammaOutput),i.push(e.gammaFactor),i.join()},this.acquireProgram=function(i,a,o,s){for(var l,c=0,u=r.length;c<u;c++){var d=r[c];if(d.code===s){++(l=d).usedTimes;break}}return void 0===l&&(l=new zi(e,t,s,i,a,o,n),r.push(l)),l},this.releaseProgram=function(e){if(0===--e.usedTimes){var t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),e.destroy()}},this.programs=r}function qi(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function Wi(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Yi(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Ki(){var e=[],t=0,n=[],i=[],r={id:-1};function a(n,i,a,o,s,l){var c=e[t];return void 0===c?(c={id:n.id,object:n,geometry:i,material:a,program:a.program||r,groupOrder:o,renderOrder:n.renderOrder,z:s,group:l},e[t]=c):(c.id=n.id,c.object=n,c.geometry=i,c.material=a,c.program=a.program||r,c.groupOrder=o,c.renderOrder=n.renderOrder,c.z=s,c.group=l),t++,c}return{opaque:n,transparent:i,init:function(){t=0,n.length=0,i.length=0},push:function(e,t,r,o,s,l){var c=a(e,t,r,o,s,l);(!0===r.transparent?i:n).push(c)},unshift:function(e,t,r,o,s,l){var c=a(e,t,r,o,s,l);(!0===r.transparent?i:n).unshift(c)},sort:function(){n.length>1&&n.sort(Wi),i.length>1&&i.sort(Yi)}}}function Xi(){var e={};function t(n){var i=n.target;i.removeEventListener("dispose",t),delete e[i.id]}return{get:function(n,i){var r,a=e[n.id];return void 0===a?(r=new Ki,e[n.id]={},e[n.id][i.id]=r,n.addEventListener("dispose",t)):void 0===(r=a[i.id])&&(r=new Ki,a[i.id]=r),r},dispose:function(){e={}}}}function Qi(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new bt,color:new Gt,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new _t};break;case"SpotLight":n={position:new bt,direction:new bt,color:new Gt,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new _t};break;case"PointLight":n={position:new bt,color:new Gt,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new _t,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":n={direction:new bt,skyColor:new Gt,groundColor:new Gt};break;case"RectAreaLight":n={color:new Gt,position:new bt,halfWidth:new bt,halfHeight:new bt}}return e[t.id]=n,n}}}var Ji=0;function $i(){for(var e=new Qi,t={id:Ji++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},n=0;n<9;n++)t.probe.push(new bt);var i=new bt,r=new kt,a=new kt;return{setup:function(n,o,s){for(var l=0,c=0,u=0,d=0;d<9;d++)t.probe[d].set(0,0,0);for(var h=0,f=0,p=0,g=0,m=0,v=s.matrixWorldInverse,y=(d=0,n.length);d<y;d++){var _=n[d],E=_.color,b=_.intensity,T=_.distance,S=_.shadow&&_.shadow.map?_.shadow.map.texture:null;if(_.isAmbientLight)l+=E.r*b,c+=E.g*b,u+=E.b*b;else if(_.isLightProbe)for(var w=0;w<9;w++)t.probe[w].addScaledVector(_.sh.coefficients[w],b);else if(_.isDirectionalLight){if((R=e.get(_)).color.copy(_.color).multiplyScalar(_.intensity),R.direction.setFromMatrixPosition(_.matrixWorld),i.setFromMatrixPosition(_.target.matrixWorld),R.direction.sub(i),R.direction.transformDirection(v),R.shadow=_.castShadow,_.castShadow){var A=_.shadow;R.shadowBias=A.bias,R.shadowRadius=A.radius,R.shadowMapSize=A.mapSize}t.directionalShadowMap[h]=S,t.directionalShadowMatrix[h]=_.shadow.matrix,t.directional[h]=R,h++}else if(_.isSpotLight){if((R=e.get(_)).position.setFromMatrixPosition(_.matrixWorld),R.position.applyMatrix4(v),R.color.copy(E).multiplyScalar(b),R.distance=T,R.direction.setFromMatrixPosition(_.matrixWorld),i.setFromMatrixPosition(_.target.matrixWorld),R.direction.sub(i),R.direction.transformDirection(v),R.coneCos=Math.cos(_.angle),R.penumbraCos=Math.cos(_.angle*(1-_.penumbra)),R.decay=_.decay,R.shadow=_.castShadow,_.castShadow){A=_.shadow;R.shadowBias=A.bias,R.shadowRadius=A.radius,R.shadowMapSize=A.mapSize}t.spotShadowMap[p]=S,t.spotShadowMatrix[p]=_.shadow.matrix,t.spot[p]=R,p++}else if(_.isRectAreaLight){(R=e.get(_)).color.copy(E).multiplyScalar(b),R.position.setFromMatrixPosition(_.matrixWorld),R.position.applyMatrix4(v),a.identity(),r.copy(_.matrixWorld),r.premultiply(v),a.extractRotation(r),R.halfWidth.set(.5*_.width,0,0),R.halfHeight.set(0,.5*_.height,0),R.halfWidth.applyMatrix4(a),R.halfHeight.applyMatrix4(a),t.rectArea[g]=R,g++}else if(_.isPointLight){if((R=e.get(_)).position.setFromMatrixPosition(_.matrixWorld),R.position.applyMatrix4(v),R.color.copy(_.color).multiplyScalar(_.intensity),R.distance=_.distance,R.decay=_.decay,R.shadow=_.castShadow,_.castShadow){A=_.shadow;R.shadowBias=A.bias,R.shadowRadius=A.radius,R.shadowMapSize=A.mapSize,R.shadowCameraNear=A.camera.near,R.shadowCameraFar=A.camera.far}t.pointShadowMap[f]=S,t.pointShadowMatrix[f]=_.shadow.matrix,t.point[f]=R,f++}else if(_.isHemisphereLight){var R;(R=e.get(_)).direction.setFromMatrixPosition(_.matrixWorld),R.direction.transformDirection(v),R.direction.normalize(),R.skyColor.copy(_.color).multiplyScalar(b),R.groundColor.copy(_.groundColor).multiplyScalar(b),t.hemi[m]=R,m++}}t.ambient[0]=l,t.ambient[1]=c,t.ambient[2]=u,t.directional.length=h,t.spot.length=p,t.rectArea.length=g,t.point.length=f,t.hemi.length=m,t.hash.stateID=t.id,t.hash.directionalLength=h,t.hash.pointLength=f,t.hash.spotLength=p,t.hash.rectAreaLength=g,t.hash.hemiLength=m,t.hash.shadowsLength=o.length},state:t}}function er(){var e=new $i,t=[],n=[];return{init:function(){t.length=0,n.length=0},state:{lightsArray:t,shadowsArray:n,lights:e},setupLights:function(i){e.setup(t,n,i)},pushLight:function(e){t.push(e)},pushShadow:function(e){n.push(e)}}}function tr(){var e={};function t(n){var i=n.target;i.removeEventListener("dispose",t),delete e[i.id]}return{get:function(n,i){var r;return void 0===e[n.id]?(r=new er,e[n.id]={},e[n.id][i.id]=r,n.addEventListener("dispose",t)):void 0===e[n.id][i.id]?(r=new er,e[n.id][i.id]=r):r=e[n.id][i.id],r},dispose:function(){e={}}}}function nr(e){_n.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function ir(e){_n.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new bt,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}function rr(e,t,n){for(var i=new Nt,r=new kt,a=new _t,o=new _t(n,n),s=new bt,l=new bt,c=new Array(4),u=new Array(4),d={},h={0:1,1:0,2:2},f=[new bt(1,0,0),new bt(-1,0,0),new bt(0,0,1),new bt(0,0,-1),new bt(0,1,0),new bt(0,-1,0)],p=[new bt(0,1,0),new bt(0,1,0),new bt(0,1,0),new bt(0,1,0),new bt(0,0,1),new bt(0,0,-1)],g=[new xt,new xt,new xt,new xt,new xt,new xt],m=0;4!==m;++m){var v=!!(1&m),y=!!(2&m),_=new nr({depthPacking:3201,morphTargets:v,skinning:y});c[m]=_;var E=new ir({morphTargets:v,skinning:y});u[m]=E}var b=this;function T(t,n,i,r,a,o){var s=t.geometry,l=null,f=c,p=t.customDepthMaterial;if(i&&(f=u,p=t.customDistanceMaterial),p)l=p;else{var g=!1;n.morphTargets&&(s&&s.isBufferGeometry?g=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:s&&s.isGeometry&&(g=s.morphTargets&&s.morphTargets.length>0)),t.isSkinnedMesh&&!1===n.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t);var m=0;g&&(m|=1),t.isSkinnedMesh&&n.skinning&&(m|=2),l=f[m]}if(e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length){var v=l.uuid,y=n.uuid,_=d[v];void 0===_&&(_={},d[v]=_);var E=_[y];void 0===E&&(E=l.clone(),_[y]=E),l=E}return l.visible=n.visible,l.wireframe=n.wireframe,l.side=null!=n.shadowSide?n.shadowSide:h[n.side],l.clipShadows=n.clipShadows,l.clippingPlanes=n.clippingPlanes,l.clipIntersection=n.clipIntersection,l.wireframeLinewidth=n.wireframeLinewidth,l.linewidth=n.linewidth,i&&l.isMeshDistanceMaterial&&(l.referencePosition.copy(r),l.nearDistance=a,l.farDistance=o),l}function S(n,r,a,o){if(!1!==n.visible){if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&n.castShadow&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);var s=t.update(n),c=n.material;if(Array.isArray(c))for(var u=s.groups,d=0,h=u.length;d<h;d++){var f=u[d],p=c[f.materialIndex];if(p&&p.visible){var g=T(n,p,o,l,a.near,a.far);e.renderBufferDirect(a,null,s,g,n,f)}}else if(c.visible){g=T(n,c,o,l,a.near,a.far);e.renderBufferDirect(a,null,s,g,n,null)}}for(var m=n.children,v=0,y=m.length;v<y;v++)S(m[v],r,a,o)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,n,c){if(!1!==b.enabled&&(!1!==b.autoUpdate||!1!==b.needsUpdate)&&0!==t.length){var u=e.getRenderTarget(),d=e.getActiveCubeFace(),h=e.getActiveMipMapLevel(),m=e.state;m.setBlending(0),m.buffers.color.setClear(1,1,1,1),m.buffers.depth.setTest(!0),m.setScissorTest(!1);for(var v,y=0,_=t.length;y<_;y++){var E=t[y],T=E.shadow,w=E&&E.isPointLight;if(void 0!==T){var A=T.camera;if(a.copy(T.mapSize),a.min(o),w){var R=a.x,x=a.y;g[0].set(2*R,x,R,x),g[1].set(0,x,R,x),g[2].set(3*R,x,R,x),g[3].set(R,x,R,x),g[4].set(3*R,0,R,x),g[5].set(R,0,R,x),a.x*=4,a.y*=2}if(null===T.map){var I={minFilter:Qe,magFilter:Qe,format:lt};T.map=new It(a.x,a.y,I),T.map.texture.name=E.name+".shadowMap",A.updateProjectionMatrix()}T.isSpotLightShadow&&T.update(E);var L=T.map,M=T.matrix;l.setFromMatrixPosition(E.matrixWorld),A.position.copy(l),w?(v=6,M.makeTranslation(-l.x,-l.y,-l.z)):(v=1,s.setFromMatrixPosition(E.target.matrixWorld),A.lookAt(s),A.updateMatrixWorld(),M.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),M.multiply(A.projectionMatrix),M.multiply(A.matrixWorldInverse)),e.setRenderTarget(L),e.clear();for(var C=0;C<v;C++){if(w){s.copy(A.position),s.add(f[C]),A.up.copy(p[C]),A.lookAt(s),A.updateMatrixWorld();var P=g[C];m.viewport(P)}r.multiplyMatrices(A.projectionMatrix,A.matrixWorldInverse),i.setFromMatrix(r),S(n,c,A,w)}}else console.warn("THREE.WebGLShadowMap:",E,"has no shadow.")}b.needsUpdate=!1,e.setRenderTarget(u,d,h)}}}function ar(e,t,n,i){var r=new function(){var t=!1,n=new xt,i=null,r=new xt(0,0,0,0);return{setMask:function(n){i!==n&&!t&&(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,a,o,s){!0===s&&(t*=o,i*=o,a*=o),n.set(t,i,a,o),!1===r.equals(n)&&(e.clearColor(t,i,a,o),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},a=new function(){var t=!1,n=null,i=null,r=null;return{setTest:function(e){e?U(2929):V(2929)},setMask:function(i){n!==i&&!t&&(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:default:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517)}else e.depthFunc(515);i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},o=new function(){var t=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,c=null;return{setTest:function(e){e?U(2960):V(2960)},setMask:function(i){n!==i&&!t&&(e.stencilMask(i),n=i)},setFunc:function(t,n,o){(i!==t||r!==n||a!==o)&&(e.stencilFunc(t,n,o),i=t,r=n,a=o)},setOp:function(t,n,i){(o!==t||s!==n||l!==i)&&(e.stencilOp(t,n,i),o=t,s=n,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,c=null}}},s=e.getParameter(34921),l=new Uint8Array(s),c=new Uint8Array(s),u=new Uint8Array(s),d={},h=null,f=null,p=null,g=null,m=null,v=null,y=null,_=null,E=null,b=null,T=!1,S=null,w=null,A=null,R=null,x=null,I=e.getParameter(35661),L=!1,M=0,C=e.getParameter(7938);-1!==C.indexOf("WebGL")?(M=parseFloat(/^WebGL\ ([0-9])/.exec(C)[1]),L=M>=1):-1!==C.indexOf("OpenGL ES")&&(M=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(C)[1]),L=M>=2);var P=null,D={},O=new xt,N=new xt;function k(t,n,i){var r=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var o=0;o<i;o++)e.texImage2D(n+o,0,6408,1,1,0,6408,5121,r);return a}var F={};function B(n,r){(l[n]=1,0===c[n]&&(e.enableVertexAttribArray(n),c[n]=1),u[n]!==r)&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),u[n]=r)}function U(t){!0!==d[t]&&(e.enable(t),d[t]=!0)}function V(t){!1!==d[t]&&(e.disable(t),d[t]=!1)}function G(t,i,r,a,o,s,l,c){if(0!==t){if(p||(U(3042),p=!0),5===t)o=o||i,s=s||r,l=l||a,(i!==m||o!==_)&&(e.blendEquationSeparate(n.convert(i),n.convert(o)),m=i,_=o),(r!==v||a!==y||s!==E||l!==b)&&(e.blendFuncSeparate(n.convert(r),n.convert(a),n.convert(s),n.convert(l)),v=r,y=a,E=s,b=l),g=t,T=null;else if(t!==g||c!==T){if((m!==We||_!==We)&&(e.blendEquation(32774),m=We,_=We),c)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}v=null,y=null,E=null,b=null,g=t,T=c}}else p&&(V(3042),p=!1)}function H(t){S!==t&&(t?e.frontFace(2304):e.frontFace(2305),S=t)}function j(t){0!==t?(U(2884),t!==w&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):V(2884),w=t}function z(t,n,i){t?(U(32823),(R!==n||x!==i)&&(e.polygonOffset(n,i),R=n,x=i)):V(32823)}function Z(t){void 0===t&&(t=33984+I-1),P!==t&&(e.activeTexture(t),P=t)}return F[3553]=k(3553,3553,1),F[34067]=k(34067,34069,6),r.setClear(0,0,0,1),a.setClear(1),o.setClear(0),U(2929),a.setFunc(3),H(!1),j(1),U(2884),G(0),{buffers:{color:r,depth:a,stencil:o},initAttributes:function(){for(var e=0,t=l.length;e<t;e++)l[e]=0},enableAttribute:function(e){B(e,0)},enableAttributeAndDivisor:B,disableUnusedAttributes:function(){for(var t=0,n=c.length;t!==n;++t)c[t]!==l[t]&&(e.disableVertexAttribArray(t),c[t]=0)},enable:U,disable:V,getCompressedTextureFormats:function(){if(null===h&&(h=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")||t.get("WEBGL_compressed_texture_astc")))for(var n=e.getParameter(34467),i=0;i<n.length;i++)h.push(n[i]);return h},useProgram:function(t){return f!==t&&(e.useProgram(t),f=t,!0)},setBlending:G,setMaterial:function(e,t){2===e.side?V(2884):U(2884);var n=1===e.side;t&&(n=!n),H(n),1===e.blending&&!1===e.transparent?G(0):G(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),a.setFunc(e.depthFunc),a.setTest(e.depthTest),a.setMask(e.depthWrite),r.setMask(e.colorWrite),z(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:H,setCullFace:j,setLineWidth:function(t){t!==A&&(L&&e.lineWidth(t),A=t)},setPolygonOffset:z,setScissorTest:function(e){e?U(3089):V(3089)},activeTexture:Z,bindTexture:function(t,n){null===P&&Z();var i=D[P];void 0===i&&(i={type:void 0,texture:void 0},D[P]=i),(i.type!==t||i.texture!==n)&&(e.bindTexture(t,n||F[t]),i.type=t,i.texture=n)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===O.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),O.copy(t))},viewport:function(t){!1===N.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),N.copy(t))},reset:function(){for(var t=0;t<c.length;t++)1===c[t]&&(e.disableVertexAttribArray(t),c[t]=0);d={},h=null,P=null,D={},f=null,g=null,S=null,w=null,r.reset(),a.reset(),o.reset()}}}function or(e,t,n,i,r,a,o){var s,l={},c=typeof OffscreenCanvas<"u";function u(e,t){return c?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function d(e,t,n,i){var r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){var a=t?yt.floorPowerOfTwo:Math.floor,o=a(r*e.width),l=a(r*e.height);void 0===s&&(s=u(o,l));var c=n?u(o,l):s;return c.width=o,c.height=l,c.getContext("2d").drawImage(e,0,0,o,l),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+l+")."),c}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function h(e){return yt.isPowerOfTwo(e.width)&&yt.isPowerOfTwo(e.height)}function f(e,t){return e.generateMipmaps&&t&&e.minFilter!==Qe&&e.minFilter!==et}function p(t,n,r,a){e.generateMipmap(t),i.get(n).__maxMipLevel=Math.log(Math.max(r,a))*Math.LOG2E}function g(e,n){if(!r.isWebGL2)return e;var i=e;return 6403===e&&(5126===n&&(i=33326),5131===n&&(i=33325),5121===n&&(i=33321)),6407===e&&(5126===n&&(i=34837),5131===n&&(i=34843),5121===n&&(i=32849)),6408===e&&(5126===n&&(i=34836),5131===n&&(i=34842),5121===n&&(i=32856)),33325===i||33326===i||34842===i||34836===i?t.get("EXT_color_buffer_float"):(34843===i||34837===i)&&console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),i}function m(e){return e===Qe||e===Je||e===$e?9728:9729}function v(t){var n=t.target;n.removeEventListener("dispose",v),function(t){var n=i.get(t);void 0!==n.__webglInit&&(e.deleteTexture(n.__webglTexture),i.remove(t))}(n),n.isVideoTexture&&delete l[n.id],o.memory.textures--}function y(t){var n=t.target;n.removeEventListener("dispose",y),function(t){var n=i.get(t),r=i.get(t.texture);if(t){if(void 0!==r.__webglTexture&&e.deleteTexture(r.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLRenderTargetCube)for(var a=0;a<6;a++)e.deleteFramebuffer(n.__webglFramebuffer[a]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[a]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer);i.remove(t.texture),i.remove(t)}}(n),o.memory.textures--}var _=0;function E(e,t){var r=i.get(e);if(e.isVideoTexture&&function(e){var t=e.id,n=o.render.frame;l[t]!==n&&(l[t]=n,e.update())}(e),e.version>0&&r.__version!==e.version){var a=e.image;if(void 0===a)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==a.complete)return void A(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,r.__webglTexture)}function b(t,o){var s=i.get(t);if(6===t.image.length)if(t.version>0&&s.__version!==t.version){w(s,t),n.activeTexture(33984+o),n.bindTexture(34067,s.__webglTexture),e.pixelStorei(37440,t.flipY);for(var l=t&&t.isCompressedTexture,c=t.image[0]&&t.image[0].isDataTexture,u=[],m=0;m<6;m++)u[m]=l||c?c?t.image[m].image:t.image[m]:d(t.image[m],!1,!0,r.maxCubemapSize);var v=u[0],y=h(v)||r.isWebGL2,_=a.convert(t.format),E=a.convert(t.type),b=g(_,E);S(34067,t,y);for(m=0;m<6;m++)if(l)for(var T,A=u[m].mipmaps,R=0,x=A.length;R<x;R++)T=A[R],t.format!==lt&&t.format!==st?n.getCompressedTextureFormats().indexOf(_)>-1?n.compressedTexImage2D(34069+m,R,b,T.width,T.height,0,T.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+m,R,b,T.width,T.height,0,_,E,T.data);else c?n.texImage2D(34069+m,0,b,u[m].width,u[m].height,0,_,E,u[m].data):n.texImage2D(34069+m,0,b,_,E,u[m]);s.__maxMipLevel=l?A.length-1:0,f(t,y)&&p(34067,t,v.width,v.height),s.__version=t.version,t.onUpdate&&t.onUpdate(t)}else n.activeTexture(33984+o),n.bindTexture(34067,s.__webglTexture)}function T(e,t){n.activeTexture(33984+t),n.bindTexture(34067,i.get(e).__webglTexture)}function S(n,o,s){var l;if(s?(e.texParameteri(n,10242,a.convert(o.wrapS)),e.texParameteri(n,10243,a.convert(o.wrapT)),(32879===n||35866===n)&&e.texParameteri(n,32882,a.convert(o.wrapR)),e.texParameteri(n,10240,a.convert(o.magFilter)),e.texParameteri(n,10241,a.convert(o.minFilter))):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),(32879===n||35866===n)&&e.texParameteri(n,32882,33071),(o.wrapS!==Ke||o.wrapT!==Ke)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,m(o.magFilter)),e.texParameteri(n,10241,m(o.minFilter)),o.minFilter!==Qe&&o.minFilter!==et&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),l=t.get("EXT_texture_filter_anisotropic")){if(o.type===rt&&null===t.get("OES_texture_float_linear")||o.type===at&&null===(r.isWebGL2||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||i.get(o).__currentAnisotropy)&&(e.texParameterf(n,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,r.getMaxAnisotropy())),i.get(o).__currentAnisotropy=o.anisotropy)}}function w(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",v),t.__webglTexture=e.createTexture(),o.memory.textures++)}function A(t,i,o){var s=3553;i.isDataTexture2DArray&&(s=35866),i.isDataTexture3D&&(s=32879),w(t,i),n.activeTexture(33984+o),n.bindTexture(s,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment);var l=function(e){return!r.isWebGL2&&(e.wrapS!==Ke||e.wrapT!==Ke||e.minFilter!==Qe&&e.minFilter!==et)}(i)&&!1===h(i.image),c=d(i.image,l,!1,r.maxTextureSize),u=h(c)||r.isWebGL2,m=a.convert(i.format),v=a.convert(i.type),y=g(m,v);S(s,i,u);var _,E=i.mipmaps;if(i.isDepthTexture){if(y=6402,i.type===rt){if(!r.isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");y=36012}else r.isWebGL2&&(y=33189);i.format===ct&&6402===y&&i.type!==it&&1014!==i.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=it,v=a.convert(i.type)),i.format===ut&&(y=34041,i.type!==ot&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=ot,v=a.convert(i.type))),n.texImage2D(3553,0,y,c.width,c.height,0,m,v,null)}else if(i.isDataTexture)if(E.length>0&&u){for(var b=0,T=E.length;b<T;b++)_=E[b],n.texImage2D(3553,b,y,_.width,_.height,0,m,v,_.data);i.generateMipmaps=!1,t.__maxMipLevel=E.length-1}else n.texImage2D(3553,0,y,c.width,c.height,0,m,v,c.data),t.__maxMipLevel=0;else if(i.isCompressedTexture){for(b=0,T=E.length;b<T;b++)_=E[b],i.format!==lt&&i.format!==st?n.getCompressedTextureFormats().indexOf(m)>-1?n.compressedTexImage2D(3553,b,y,_.width,_.height,0,_.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,b,y,_.width,_.height,0,m,v,_.data);t.__maxMipLevel=E.length-1}else if(i.isDataTexture2DArray)n.texImage3D(35866,0,y,c.width,c.height,c.depth,0,m,v,c.data),t.__maxMipLevel=0;else if(i.isDataTexture3D)n.texImage3D(32879,0,y,c.width,c.height,c.depth,0,m,v,c.data),t.__maxMipLevel=0;else if(E.length>0&&u){for(b=0,T=E.length;b<T;b++)_=E[b],n.texImage2D(3553,b,y,m,v,_);i.generateMipmaps=!1,t.__maxMipLevel=E.length-1}else n.texImage2D(3553,0,y,m,v,c),t.__maxMipLevel=0;f(i,u)&&p(3553,i,c.width,c.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}function R(t,r,o,s){var l=a.convert(r.texture.format),c=a.convert(r.texture.type),u=g(l,c);n.texImage2D(s,0,u,r.width,r.height,0,l,c,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,o,s,i.get(r.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function x(t,n,i){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){if(i){var r=L(n);e.renderbufferStorageMultisample(36161,r,33189,n.width,n.height)}else e.renderbufferStorage(36161,33189,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(i){r=L(n);e.renderbufferStorageMultisample(36161,r,34041,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{var o=g(a.convert(n.texture.format),a.convert(n.texture.type));if(i){r=L(n);e.renderbufferStorageMultisample(36161,r,o,n.width,n.height)}else e.renderbufferStorage(36161,o,n.width,n.height)}e.bindRenderbuffer(36161,null)}function I(t){var n=i.get(t),r=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,n){if(n&&n.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(n.depthTexture).__webglTexture||n.depthTexture.image.width!==n.width||n.depthTexture.image.height!==n.height)&&(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),E(n.depthTexture,0);var r=i.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===ct)e.framebufferTexture2D(36160,36096,3553,r,0);else{if(n.depthTexture.format!==ut)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,r,0)}}(n.__webglFramebuffer,t)}else if(r){n.__webglDepthbuffer=[];for(var a=0;a<6;a++)e.bindFramebuffer(36160,n.__webglFramebuffer[a]),n.__webglDepthbuffer[a]=e.createRenderbuffer(),x(n.__webglDepthbuffer[a],t)}else e.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),x(n.__webglDepthbuffer,t);e.bindFramebuffer(36160,null)}function L(e){return r.isWebGL2&&e.isWebGLMultisampleRenderTarget?Math.min(r.maxSamples,e.samples):0}var M=!1,C=!1;this.allocateTextureUnit=function(){var e=_;return e>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+r.maxTextures),_+=1,e},this.resetTextureUnits=function(){_=0},this.setTexture2D=E,this.setTexture2DArray=function(e,t){var r=i.get(e);e.version>0&&r.__version!==e.version?A(r,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(e,t){var r=i.get(e);e.version>0&&r.__version!==e.version?A(r,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=b,this.setTextureCubeDynamic=T,this.setupRenderTarget=function(t){var s=i.get(t),l=i.get(t.texture);t.addEventListener("dispose",y),l.__webglTexture=e.createTexture(),o.memory.textures++;var c=!0===t.isWebGLRenderTargetCube,u=!0===t.isWebGLMultisampleRenderTarget,d=h(t)||r.isWebGL2;if(c){s.__webglFramebuffer=[];for(var m=0;m<6;m++)s.__webglFramebuffer[m]=e.createFramebuffer()}else if(s.__webglFramebuffer=e.createFramebuffer(),u)if(r.isWebGL2){s.__webglMultisampledFramebuffer=e.createFramebuffer(),s.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,s.__webglColorRenderbuffer);var v=g(a.convert(t.texture.format),a.convert(t.texture.type)),_=L(t);e.renderbufferStorageMultisample(36161,_,v,t.width,t.height),e.bindFramebuffer(36160,s.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(s.__webglDepthRenderbuffer=e.createRenderbuffer(),x(s.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(c){n.bindTexture(34067,l.__webglTexture),S(34067,t.texture,d);for(m=0;m<6;m++)R(s.__webglFramebuffer[m],t,36064,34069+m);f(t.texture,d)&&p(34067,t.texture,t.width,t.height),n.bindTexture(34067,null)}else n.bindTexture(3553,l.__webglTexture),S(3553,t.texture,d),R(s.__webglFramebuffer,t,36064,3553),f(t.texture,d)&&p(3553,t.texture,t.width,t.height),n.bindTexture(3553,null);t.depthBuffer&&I(t)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(f(t,h(e)||r.isWebGL2)){var a=e.isWebGLRenderTargetCube?34067:3553,o=i.get(t).__webglTexture;n.bindTexture(a,o),p(a,t,e.width,e.height),n.bindTexture(a,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(r.isWebGL2){var n=i.get(t);e.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,n.__webglFramebuffer);var a=t.width,o=t.height,s=16384;t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024),e.blitFramebuffer(0,0,a,o,0,0,a,o,s,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===M&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),M=!0),e=e.texture),E(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLRenderTargetCube&&(!1===C&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),C=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?b(e,t):T(e,t)}}function sr(e,t,n){return{convert:function(e){var i;if(e===Ye)return 10497;if(e===Ke)return 33071;if(e===Xe)return 33648;if(e===Qe)return 9728;if(e===Je)return 9984;if(e===$e)return 9986;if(e===et)return 9729;if(1007===e)return 9985;if(e===tt)return 9987;if(e===nt)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1019===e)return 33635;if(1010===e)return 5120;if(1011===e)return 5122;if(e===it)return 5123;if(1013===e)return 5124;if(1014===e)return 5125;if(e===rt)return 5126;if(e===at){if(n.isWebGL2)return 5131;if(null!==(i=t.get("OES_texture_half_float")))return i.HALF_FLOAT_OES}if(1021===e)return 6406;if(e===st)return 6407;if(e===lt)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(e===ct)return 6402;if(e===ut)return 34041;if(1028===e)return 6403;if(e===We)return 32774;if(101===e)return 32778;if(102===e)return 32779;if(200===e)return 0;if(201===e)return 1;if(202===e)return 768;if(203===e)return 769;if(204===e)return 770;if(205===e)return 771;if(206===e)return 772;if(207===e)return 773;if(208===e)return 774;if(209===e)return 775;if(210===e)return 776;if((33776===e||33777===e||33778===e||33779===e)&&null!==(i=t.get("WEBGL_compressed_texture_s3tc"))){if(33776===e)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===e)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===e)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===e)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((35840===e||35841===e||35842===e||35843===e)&&null!==(i=t.get("WEBGL_compressed_texture_pvrtc"))){if(35840===e)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===e)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===e)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===e)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e&&null!==(i=t.get("WEBGL_compressed_texture_etc1")))return i.COMPRESSED_RGB_ETC1_WEBGL;if((37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e)&&null!==(i=t.get("WEBGL_compressed_texture_astc")))return e;if(103===e||104===e){if(n.isWebGL2){if(103===e)return 32775;if(104===e)return 32776}if(null!==(i=t.get("EXT_blend_minmax"))){if(103===e)return i.MIN_EXT;if(104===e)return i.MAX_EXT}}if(e===ot){if(n.isWebGL2)return 34042;if(null!==(i=t.get("WEBGL_depth_texture")))return i.UNSIGNED_INT_24_8_WEBGL}return 0}}}function lr(){Xt.call(this),this.type="Group"}function cr(){Xt.call(this),this.type="Camera",this.matrixWorldInverse=new kt,this.projectionMatrix=new kt,this.projectionMatrixInverse=new kt}function ur(e,t,n,i){cr.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==i?i:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function dr(e){ur.call(this),this.cameras=e||[]}nr.prototype=Object.create(_n.prototype),nr.prototype.constructor=nr,nr.prototype.isMeshDepthMaterial=!0,nr.prototype.copy=function(e){return _n.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},ir.prototype=Object.create(_n.prototype),ir.prototype.constructor=ir,ir.prototype.isMeshDistanceMaterial=!0,ir.prototype.copy=function(e){return _n.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},lr.prototype=Object.assign(Object.create(Xt.prototype),{constructor:lr,isGroup:!0}),cr.prototype=Object.assign(Object.create(Xt.prototype),{constructor:cr,isCamera:!0,copy:function(e,t){return Xt.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new bt),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){Xt.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),ur.prototype=Object.assign(Object.create(cr.prototype),{constructor:ur,isPerspectiveCamera:!0,copy:function(e,t){return cr.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*yt.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*yt.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*yt.RAD2DEG*Math.atan(Math.tan(.5*yt.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,i,r,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*yt.DEG2RAD*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;r+=a.offsetX*i/o,t-=a.offsetY*n/s,i*=a.width/o,n*=a.height/s}var l=this.filmOffset;0!==l&&(r+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Xt.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),dr.prototype=Object.assign(Object.create(ur.prototype),{constructor:dr,isArrayCamera:!0});var hr,fr=new bt,pr=new bt;function gr(e,t,n){fr.setFromMatrixPosition(t.matrixWorld),pr.setFromMatrixPosition(n.matrixWorld);var i=fr.distanceTo(pr),r=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=r[14]/(r[10]-1),s=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],d=(a[8]+1)/a[0],h=o*u,f=o*d,p=i/(-u+d),g=p*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(g),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var m=o+p,v=s+p,y=h-g,_=f+(i-g),E=l*s/v*m,b=c*s/v*m;e.projectionMatrix.makePerspective(y,_,E,b,m,v)}function mr(e){var t,n,i=this,r=null,a=null,o=null,s=[],l=new kt,c=new kt,u=1,d="local-floor";typeof window<"u"&&"VRFrameData"in window&&(a=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",b,!1));var h=new kt,f=new Et,p=new bt,g=new ur;g.viewport=new xt,g.layers.enable(1);var m=new ur;m.viewport=new xt,m.layers.enable(2);var v=new dr([g,m]);function y(){return null!==r&&!0===r.isPresenting}v.layers.enable(1),v.layers.enable(2);var _,E=new _t;function b(){if(y()){var a=r.getEyeParameters("left");t=2*a.renderWidth*u,n=a.renderHeight*u,_=e.getPixelRatio(),e.getSize(E),e.setDrawingBufferSize(t,n,1),g.viewport.set(0,0,t/2,n),m.viewport.set(t/2,0,t/2,n),A.start()}else i.enabled&&e.setDrawingBufferSize(E.width,E.height,_),A.stop()}var T=[];function S(e){for(var t=navigator.getGamepads&&navigator.getGamepads(),n=0,i=0,r=t.length;n<r;n++){var a=t[n];if(a&&("Daydream Controller"===a.id||"Gear VR Controller"===a.id||"Oculus Go Controller"===a.id||"OpenVR Gamepad"===a.id||a.id.startsWith("Oculus Touch")||a.id.startsWith("Spatial Controller"))){if(i===e)return a;i++}}}function w(e,i){null!==i&&4===i.length&&e.set(i[0]*t,i[1]*n,i[2]*t,i[3]*n)}this.enabled=!1,this.getController=function(e){var t=s[e];return void 0===t&&((t=new lr).matrixAutoUpdate=!1,t.visible=!1,s[e]=t),t},this.getDevice=function(){return r},this.setDevice=function(e){void 0!==e&&(r=e),A.setContext(e)},this.setFramebufferScaleFactor=function(e){u=e},this.setReferenceSpaceType=function(e){d=e},this.setPoseTarget=function(e){void 0!==e&&(o=e)},this.getCamera=function(e){var t="local-floor"===d?1.6:0;if(!1===y())return e.position.set(0,t,0),e.rotation.set(0,0,0),e;if(r.depthNear=e.near,r.depthFar=e.far,r.getFrameData(a),"local-floor"===d){var n=r.stageParameters;n?l.fromArray(n.sittingToStandingTransform):l.makeTranslation(0,t,0)}var i=a.pose,u=null!==o?o:e;u.matrix.copy(l),u.matrix.decompose(u.position,u.quaternion,u.scale),null!==i.orientation&&(f.fromArray(i.orientation),u.quaternion.multiply(f)),null!==i.position&&(f.setFromRotationMatrix(l),p.fromArray(i.position),p.applyQuaternion(f),u.position.add(p)),u.updateMatrixWorld(),g.near=e.near,m.near=e.near,g.far=e.far,m.far=e.far,g.matrixWorldInverse.fromArray(a.leftViewMatrix),m.matrixWorldInverse.fromArray(a.rightViewMatrix),c.getInverse(l),"local-floor"===d&&(g.matrixWorldInverse.multiply(c),m.matrixWorldInverse.multiply(c));var _=u.parent;null!==_&&(h.getInverse(_.matrixWorld),g.matrixWorldInverse.multiply(h),m.matrixWorldInverse.multiply(h)),g.matrixWorld.getInverse(g.matrixWorldInverse),m.matrixWorld.getInverse(m.matrixWorldInverse),g.projectionMatrix.fromArray(a.leftProjectionMatrix),m.projectionMatrix.fromArray(a.rightProjectionMatrix),gr(v,g,m);var E=r.getLayers();if(E.length){var b=E[0];w(g.viewport,b.leftBounds),w(m.viewport,b.rightBounds)}return function(){for(var e=0;e<s.length;e++){var t=s[e],n=S(e);if(void 0!==n&&void 0!==n.pose){if(null===n.pose)return;var i=n.pose;!1===i.hasPosition&&t.position.set(.2,-.6,-.05),null!==i.position&&t.position.fromArray(i.position),null!==i.orientation&&t.quaternion.fromArray(i.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(l),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0,t.visible=!0;var r="Daydream Controller"===n.id?0:1;void 0===T[e]&&(T[e]=!1),T[e]!==n.buttons[r].pressed&&(T[e]=n.buttons[r].pressed,!0===T[e]?t.dispatchEvent({type:"selectstart"}):(t.dispatchEvent({type:"selectend"}),t.dispatchEvent({type:"select"})))}else t.visible=!1}}(),v},this.getStandingMatrix=function(){return l},this.isPresenting=y;var A=new zt;this.setAnimationLoop=function(e){A.setAnimationLoop(e),y()&&A.start()},this.submitFrame=function(){y()&&r.submitFrame()},this.dispose=function(){typeof window<"u"&&window.removeEventListener("vrdisplaypresentchange",b)},this.setFrameOfReferenceType=function(){console.warn("THREE.WebVRManager: setFrameOfReferenceType() has been deprecated.")}}function vr(e){var t=e.context,n=null,i=null,r="local-floor",a=null,o=[],s=[];function l(){return null!==n&&null!==i}var c=new ur;c.layers.enable(1),c.viewport=new xt;var u=new ur;u.layers.enable(2),u.viewport=new xt;var d=new dr([c,u]);function h(e){for(var t=0;t<o.length;t++)s[t]===e.inputSource&&o[t].dispatchEvent({type:e.type})}function f(){e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),v.stop()}function p(e){i=e,v.setContext(n),v.start()}function g(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}d.layers.enable(1),d.layers.enable(2),this.enabled=!1,this.getController=function(e){var t=o[e];return void 0===t&&((t=new lr).matrixAutoUpdate=!1,t.visible=!1,o[e]=t),t},this.setFramebufferScaleFactor=function(e){},this.setReferenceSpaceType=function(e){r=e},this.getSession=function(){return n},this.setSession=function(e){null!==(n=e)&&(n.addEventListener("select",h),n.addEventListener("selectstart",h),n.addEventListener("selectend",h),n.addEventListener("end",f),n.updateRenderState({baseLayer:new XRWebGLLayer(n,t)}),n.requestReferenceSpace(r).then(p),s=n.inputSources,n.addEventListener("inputsourceschange",function(){s=n.inputSources,console.log(s);for(var e=0;e<o.length;e++){o[e].userData.inputSource=s[e]}}))},this.getCamera=function(e){if(l()){var t=e.parent,n=d.cameras;g(d,t);for(var i=0;i<n.length;i++)g(n[i],t);e.matrixWorld.copy(d.matrixWorld);for(var r=e.children,a=(i=0,r.length);i<a;i++)r[i].updateMatrixWorld(!0);return gr(d,c,u),d}return e},this.isPresenting=l;var m=null;var v=new zt;v.setAnimationLoop(function(t,r){if(null!==(a=r.getViewerPose(i))){var l=a.views,c=n.renderState.baseLayer;e.setFramebuffer(c.framebuffer);for(var u=0;u<l.length;u++){var h=l[u],f=c.getViewport(h),p=h.transform.inverse.matrix,g=d.cameras[u];g.matrix.fromArray(p).getInverse(g.matrix),g.projectionMatrix.fromArray(h.projectionMatrix),g.viewport.set(f.x,f.y,f.width,f.height),0===u&&d.matrix.copy(g.matrix)}}for(u=0;u<o.length;u++){var v=o[u],y=s[u];if(y){var _=r.getPose(y.targetRaySpace,i);if(null!==_){v.matrix.fromArray(_.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.visible=!0;continue}}v.visible=!1}m&&m(t)}),this.setAnimationLoop=function(e){m=e},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new kt},this.getDevice=function(){console.warn("THREE.WebXRManager: getDevice() has been deprecated.")},this.setDevice=function(){console.warn("THREE.WebXRManager: setDevice() has been deprecated.")},this.setFrameOfReferenceType=function(){console.warn("THREE.WebXRManager: setFrameOfReferenceType() has been deprecated.")},this.submitFrame=function(){}}function yr(e){console.log("THREE.WebGLRenderer","105");var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==e.context?e.context:null,i=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,d=null,h=null;this.domElement=t,this.context=null,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=1,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var f,p,g,m,v,y,_,E,b,T,S,w,A,R,x,I,L,M,C=this,P=!1,D=null,O=0,N=0,k=null,F=null,B=-1,U={geometry:null,program:null,wireframe:!1},V=null,G=null,H=new xt,j=new xt,z=null,Z=t.width,q=t.height,W=1,Y=new xt(0,0,Z,q),K=new xt(0,0,Z,q),X=!1,Q=new Nt,J=new In,$=!1,ee=!1,te=new kt,ne=new bt;function ie(){return null===k?W:1}try{var re={alpha:i,depth:r,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u,xrCompatible:!0};if(t.addEventListener("webglcontextlost",le,!1),t.addEventListener("webglcontextrestored",ce,!1),null===(f=n||t.getContext("webgl",re)||t.getContext("experimental-webgl",re)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===f.getShaderPrecisionFormat&&(f.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function ae(){p=new Ln(f),(g=new xn(f,p,e)).isWebGL2||(p.get("WEBGL_depth_texture"),p.get("OES_texture_float"),p.get("OES_texture_half_float"),p.get("OES_texture_half_float_linear"),p.get("OES_standard_derivatives"),p.get("OES_element_index_uint"),p.get("ANGLE_instanced_arrays")),p.get("OES_texture_float_linear"),M=new sr(f,p,g),(m=new ar(f,p,M,g)).scissor(j.copy(K).multiplyScalar(W)),m.viewport(H.copy(Y).multiplyScalar(W)),v=new Pn,y=new qi,_=new or(f,p,m,y,g,M,v),E=new Zt(f),b=new Mn(f,E,v),T=new Nn(b,v),x=new On(f),S=new Zi(C,p,g),w=new Xi,A=new tr,R=new An(C,m,T,s),I=new Rn(f,p,v,g),L=new Cn(f,p,v,g),v.programs=S.programs,C.context=f,C.capabilities=g,C.extensions=p,C.properties=y,C.renderLists=w,C.state=m,C.info=v}ae();var oe=typeof navigator<"u"&&"xr"in navigator&&"supportsSession"in navigator.xr?new vr(C):new mr(C);this.vr=oe;var se=new rr(C,T,g.maxTextureSize);function le(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),P=!0}function ce(){console.log("THREE.WebGLRenderer: Context Restored."),P=!1,ae()}function ue(e){var t=e.target;t.removeEventListener("dispose",ue),function(e){de(e),y.remove(e)}(t)}function de(e){var t=y.get(e).program;e.program=void 0,void 0!==t&&S.releaseProgram(t)}this.shadowMap=se,this.getContext=function(){return f},this.getContextAttributes=function(){return f.getContextAttributes()},this.forceContextLoss=function(){var e=p.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=p.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return W},this.setPixelRatio=function(e){void 0!==e&&(W=e,this.setSize(Z,q,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new _t),e.set(Z,q)},this.setSize=function(e,n,i){oe.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Z=e,q=n,t.width=e*W,t.height=n*W,!1!==i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new _t),e.set(Z*W,q*W)},this.setDrawingBufferSize=function(e,n,i){Z=e,q=n,W=i,t.width=e*i,t.height=n*i,this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new xt),e.copy(H)},this.getViewport=function(e){return e.copy(Y)},this.setViewport=function(e,t,n,i){e.isVector4?Y.set(e.x,e.y,e.z,e.w):Y.set(e,t,n,i),m.viewport(H.copy(Y).multiplyScalar(W))},this.getScissor=function(e){return e.copy(K)},this.setScissor=function(e,t,n,i){e.isVector4?K.set(e.x,e.y,e.z,e.w):K.set(e,t,n,i),m.scissor(j.copy(K).multiplyScalar(W))},this.getScissorTest=function(){return X},this.setScissorTest=function(e){m.setScissorTest(X=e)},this.getClearColor=function(){return R.getClearColor()},this.setClearColor=function(){R.setClearColor.apply(R,arguments)},this.getClearAlpha=function(){return R.getClearAlpha()},this.setClearAlpha=function(){R.setClearAlpha.apply(R,arguments)},this.clear=function(e,t,n){var i=0;(void 0===e||e)&&(i|=16384),(void 0===t||t)&&(i|=256),(void 0===n||n)&&(i|=1024),f.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",le,!1),t.removeEventListener("webglcontextrestored",ce,!1),w.dispose(),A.dispose(),y.dispose(),T.dispose(),oe.dispose(),fe.stop()},this.renderBufferImmediate=function(e,t){m.initAttributes();var n=y.get(e);e.hasPositions&&!n.position&&(n.position=f.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=f.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=f.createBuffer()),e.hasColors&&!n.color&&(n.color=f.createBuffer());var i=t.getAttributes();e.hasPositions&&(f.bindBuffer(34962,n.position),f.bufferData(34962,e.positionArray,35048),m.enableAttribute(i.position),f.vertexAttribPointer(i.position,3,5126,!1,0,0)),e.hasNormals&&(f.bindBuffer(34962,n.normal),f.bufferData(34962,e.normalArray,35048),m.enableAttribute(i.normal),f.vertexAttribPointer(i.normal,3,5126,!1,0,0)),e.hasUvs&&(f.bindBuffer(34962,n.uv),f.bufferData(34962,e.uvArray,35048),m.enableAttribute(i.uv),f.vertexAttribPointer(i.uv,2,5126,!1,0,0)),e.hasColors&&(f.bindBuffer(34962,n.color),f.bufferData(34962,e.colorArray,35048),m.enableAttribute(i.color),f.vertexAttribPointer(i.color,3,5126,!1,0,0)),m.disableUnusedAttributes(),f.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,i,r,a){var o=r.isMesh&&r.matrixWorld.determinant()<0;m.setMaterial(i,o);var s=ye(e,t,i,r),l=!1;(U.geometry!==n.id||U.program!==s.id||U.wireframe!==(!0===i.wireframe))&&(U.geometry=n.id,U.program=s.id,U.wireframe=!0===i.wireframe,l=!0),r.morphTargetInfluences&&(x.update(r,n,i,s),l=!0);var c=n.index,u=n.attributes.position,d=1;!0===i.wireframe&&(c=b.getWireframeAttribute(n),d=2);var h,v=I;null!==c&&(h=E.get(c),(v=L).setIndex(h)),l&&(function(e,t,n){if(n&&n.isInstancedBufferGeometry&&!g.isWebGL2&&null===p.get("ANGLE_instanced_arrays"))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");m.initAttributes();var i=n.attributes,r=t.getAttributes(),a=e.defaultAttributeValues;for(var o in r){var s=r[o];if(s>=0){var l=i[o];if(void 0!==l){var c=l.normalized,u=l.itemSize,d=E.get(l);if(void 0===d)continue;var h=d.buffer,v=d.type,y=d.bytesPerElement;if(l.isInterleavedBufferAttribute){var _=l.data,b=_.stride,T=l.offset;_&&_.isInstancedInterleavedBuffer?(m.enableAttributeAndDivisor(s,_.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=_.meshPerAttribute*_.count)):m.enableAttribute(s),f.bindBuffer(34962,h),f.vertexAttribPointer(s,u,v,c,b*y,T*y)}else l.isInstancedBufferAttribute?(m.enableAttributeAndDivisor(s,l.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=l.meshPerAttribute*l.count)):m.enableAttribute(s),f.bindBuffer(34962,h),f.vertexAttribPointer(s,u,v,c,0,0)}else if(void 0!==a){var S=a[o];if(void 0!==S)switch(S.length){case 2:f.vertexAttrib2fv(s,S);break;case 3:f.vertexAttrib3fv(s,S);break;case 4:f.vertexAttrib4fv(s,S);break;default:f.vertexAttrib1fv(s,S)}}}}m.disableUnusedAttributes()}(i,s,n),null!==c&&f.bindBuffer(34963,h.buffer));var y=1/0;null!==c?y=c.count:void 0!==u&&(y=u.count);var _=n.drawRange.start*d,T=n.drawRange.count*d,S=null!==a?a.start*d:0,w=null!==a?a.count*d:1/0,A=Math.max(_,S),R=Math.min(y,_+T,S+w)-1,M=Math.max(0,R-A+1);if(0!==M){if(r.isMesh)if(!0===i.wireframe)m.setLineWidth(i.wireframeLinewidth*ie()),v.setMode(1);else switch(r.drawMode){case 0:v.setMode(4);break;case 1:v.setMode(5);break;case 2:v.setMode(6)}else if(r.isLine){var C=i.linewidth;void 0===C&&(C=1),m.setLineWidth(C*ie()),r.isLineSegments?v.setMode(1):r.isLineLoop?v.setMode(2):v.setMode(3)}else r.isPoints?v.setMode(0):r.isSprite&&v.setMode(4);n&&n.isInstancedBufferGeometry?n.maxInstancedCount>0&&v.renderInstances(n,A,M):v.render(A,M)}},this.compile=function(e,t){(h=A.get(e,t)).init(),e.traverse(function(e){e.isLight&&(h.pushLight(e),e.castShadow&&h.pushShadow(e))}),h.setupLights(t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var n=0;n<t.material.length;n++)ve(t.material[n],e.fog,t);else ve(t.material,e.fog,t)})};var he=null;var fe=new zt;function pe(e,t,n,i){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLight)h.pushLight(e),e.castShadow&&h.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||Q.intersectsSprite(e)){i&&ne.setFromMatrixPosition(e.matrixWorld).applyMatrix4(te);var r=T.update(e);(a=e.material).visible&&d.push(e,r,a,n,ne.z,null)}}else if(e.isImmediateRenderObject)i&&ne.setFromMatrixPosition(e.matrixWorld).applyMatrix4(te),d.push(e,null,e.material,n,ne.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||Q.intersectsObject(e))){i&&ne.setFromMatrixPosition(e.matrixWorld).applyMatrix4(te);r=T.update(e);var a=e.material;if(Array.isArray(a))for(var o=r.groups,s=0,l=o.length;s<l;s++){var c=o[s],u=a[c.materialIndex];u&&u.visible&&d.push(e,r,u,n,ne.z,c)}else a.visible&&d.push(e,r,a,n,ne.z,null)}var f=e.children;for(s=0,l=f.length;s<l;s++)pe(f[s],t,n,i)}}function ge(e,t,n,i){for(var r=0,a=e.length;r<a;r++){var o=e[r],s=o.object,l=o.geometry,c=void 0===i?o.material:i,u=o.group;if(n.isArrayCamera){G=n;for(var d=n.cameras,f=0,p=d.length;f<p;f++){var g=d[f];s.layers.test(g.layers)&&(m.viewport(H.copy(g.viewport)),h.setupLights(g),me(s,t,g,l,c,u))}}else G=null,me(s,t,n,l,c,u)}}function me(e,t,n,i,r,a){if(e.onBeforeRender(C,t,n,i,r,a),h=A.get(t,G||n),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){m.setMaterial(r);var o=ye(n,t.fog,r,e);U.geometry=null,U.program=null,U.wireframe=!1,function(e,t){e.render(function(e){C.renderBufferImmediate(e,t)})}(e,o)}else C.renderBufferDirect(n,t.fog,i,r,e,a);e.onAfterRender(C,t,n,i,r,a),h=A.get(t,G||n)}function ve(e,t,n){var i=y.get(e),r=h.state.lights,a=h.state.shadowsArray,o=i.lightsHash,s=r.state.hash,l=S.getParameters(e,r.state,a,t,J.numPlanes,J.numIntersection,n),c=S.getProgramCode(e,l),u=i.program,d=!0;if(void 0===u)e.addEventListener("dispose",ue);else if(u.code!==c)de(e);else if(o.stateID!==s.stateID||o.directionalLength!==s.directionalLength||o.pointLength!==s.pointLength||o.spotLength!==s.spotLength||o.rectAreaLength!==s.rectAreaLength||o.hemiLength!==s.hemiLength||o.shadowsLength!==s.shadowsLength)o.stateID=s.stateID,o.directionalLength=s.directionalLength,o.pointLength=s.pointLength,o.spotLength=s.spotLength,o.rectAreaLength=s.rectAreaLength,o.hemiLength=s.hemiLength,o.shadowsLength=s.shadowsLength,d=!1;else{if(void 0!==l.shaderID)return;d=!1}if(d){if(l.shaderID){var f=jt[l.shaderID];i.shader={name:e.type,uniforms:Bt(f.uniforms),vertexShader:f.vertexShader,fragmentShader:f.fragmentShader}}else i.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(i.shader,C),c=S.getProgramCode(e,l),u=S.acquireProgram(e,i.shader,l,c),i.program=u,e.program=u}var p=u.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var g=0;g<C.maxMorphTargets;g++)p["morphTarget"+g]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(g=0;g<C.maxMorphNormals;g++)p["morphNormal"+g]>=0&&e.numSupportedMorphNormals++}var m=i.shader.uniforms;(!e.isShaderMaterial&&!e.isRawShaderMaterial||!0===e.clipping)&&(i.numClippingPlanes=J.numPlanes,i.numIntersection=J.numIntersection,m.clippingPlanes=J.uniform),i.fog=t,void 0===o&&(i.lightsHash=o={}),o.stateID=s.stateID,o.directionalLength=s.directionalLength,o.pointLength=s.pointLength,o.spotLength=s.spotLength,o.rectAreaLength=s.rectAreaLength,o.hemiLength=s.hemiLength,o.shadowsLength=s.shadowsLength,e.lights&&(m.ambientLightColor.value=r.state.ambient,m.lightProbe.value=r.state.probe,m.directionalLights.value=r.state.directional,m.spotLights.value=r.state.spot,m.rectAreaLights.value=r.state.rectArea,m.pointLights.value=r.state.point,m.hemisphereLights.value=r.state.hemi,m.directionalShadowMap.value=r.state.directionalShadowMap,m.directionalShadowMatrix.value=r.state.directionalShadowMatrix,m.spotShadowMap.value=r.state.spotShadowMap,m.spotShadowMatrix.value=r.state.spotShadowMatrix,m.pointShadowMap.value=r.state.pointShadowMap,m.pointShadowMatrix.value=r.state.pointShadowMatrix);var v=i.program.getUniforms(),_=Pi.seqWithValue(v.seq,m);i.uniformsList=_}function ye(e,t,n,i){_.resetTextureUnits();var r=y.get(n),a=h.state.lights,o=r.lightsHash,s=a.state.hash;if($&&(ee||e!==V)){var l=e===V&&n.id===B;J.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,e,r,l)}!1===n.needsUpdate&&(void 0===r.program||n.fog&&r.fog!==t||n.lights&&(o.stateID!==s.stateID||o.directionalLength!==s.directionalLength||o.pointLength!==s.pointLength||o.spotLength!==s.spotLength||o.rectAreaLength!==s.rectAreaLength||o.hemiLength!==s.hemiLength||o.shadowsLength!==s.shadowsLength)||void 0!==r.numClippingPlanes&&(r.numClippingPlanes!==J.numPlanes||r.numIntersection!==J.numIntersection))&&(n.needsUpdate=!0),n.needsUpdate&&(ve(n,t,i),n.needsUpdate=!1);var c=!1,u=!1,d=!1,p=r.program,v=p.getUniforms(),E=r.shader.uniforms;if(m.useProgram(p.program)&&(c=!0,u=!0,d=!0),n.id!==B&&(B=n.id,u=!0),c||V!==e){if(v.setValue(f,"projectionMatrix",e.projectionMatrix),g.logarithmicDepthBuffer&&v.setValue(f,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),V!==e&&(V=e,u=!0,d=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshStandardMaterial||n.envMap){var b=v.map.cameraPosition;void 0!==b&&b.setValue(f,ne.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.skinning)&&v.setValue(f,"viewMatrix",e.matrixWorldInverse)}if(n.skinning){v.setOptional(f,i,"bindMatrix"),v.setOptional(f,i,"bindMatrixInverse");var T=i.skeleton;if(T){var S=T.bones;if(g.floatVertexTextures){if(void 0===T.boneTexture){var w=Math.sqrt(4*S.length);w=yt.ceilPowerOfTwo(w),w=Math.max(w,4);var A=new Float32Array(w*w*4);A.set(T.boneMatrices);var R=new Ct(A,w,w,lt,rt);R.needsUpdate=!0,T.boneMatrices=A,T.boneTexture=R,T.boneTextureSize=w}v.setValue(f,"boneTexture",T.boneTexture,_),v.setValue(f,"boneTextureSize",T.boneTextureSize)}else v.setOptional(f,T,"boneMatrices")}}return u&&(v.setValue(f,"toneMappingExposure",C.toneMappingExposure),v.setValue(f,"toneMappingWhitePoint",C.toneMappingWhitePoint),n.lights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.pointLights.needsUpdate=t,e.spotLights.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(E,d),t&&n.fog&&function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(E,t),n.isMeshBasicMaterial?_e(E,n):n.isMeshLambertMaterial?(_e(E,n),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(E,n)):n.isMeshPhongMaterial?(_e(E,n),n.isMeshToonMaterial?function(e,t){Ee(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(E,n):Ee(E,n)):n.isMeshStandardMaterial?(_e(E,n),n.isMeshPhysicalMaterial?function(e,t){be(e,t),e.reflectivity.value=t.reflectivity,e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness}(E,n):be(E,n)):n.isMeshMatcapMaterial?(_e(E,n),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(E,n)):n.isMeshDepthMaterial?(_e(E,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(E,n)):n.isMeshDistanceMaterial?(_e(E,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(E,n)):n.isMeshNormalMaterial?(_e(E,n),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(E,n)):n.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(E,n),n.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(E,n)):n.isPointsMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*W,e.scale.value=.5*q,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(E,n):n.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(E,n):n.isShadowMaterial&&(E.color.value.copy(n.color),E.opacity.value=n.opacity),void 0!==E.ltc_1&&(E.ltc_1.value=Ht.LTC_1),void 0!==E.ltc_2&&(E.ltc_2.value=Ht.LTC_2),Pi.upload(f,r.uniformsList,E,_)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Pi.upload(f,r.uniformsList,E,_),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&v.setValue(f,"center",i.center),v.setValue(f,"modelViewMatrix",i.modelViewMatrix),v.setValue(f,"normalMatrix",i.normalMatrix),v.setValue(f,"modelMatrix",i.matrixWorld),p}function _e(e,t){var n;e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=y.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?n=t.map:t.specularMap?n=t.specularMap:t.displacementMap?n=t.displacementMap:t.normalMap?n=t.normalMap:t.bumpMap?n=t.bumpMap:t.roughnessMap?n=t.roughnessMap:t.metalnessMap?n=t.metalnessMap:t.alphaMap?n=t.alphaMap:t.emissiveMap&&(n=t.emissiveMap),void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}function Ee(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function be(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}fe.setAnimationLoop(function(e){oe.isPresenting()||he&&he(e)}),typeof window<"u"&&fe.setContext(window),this.setAnimationLoop=function(e){he=e,oe.setAnimationLoop(e),fe.start()},this.render=function(e,t){var n,i;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),i=arguments[3]),t&&t.isCamera){if(!P){U.geometry=null,U.program=null,U.wireframe=!1,B=-1,V=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),oe.enabled&&(t=oe.getCamera(t)),(h=A.get(e,t)).init(),e.onBeforeRender(C,e,t,n||k),te.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),Q.setFromMatrix(te),ee=this.localClippingEnabled,$=J.init(this.clippingPlanes,ee,t),(d=w.get(e,t)).init(),pe(e,t,0,C.sortObjects),!0===C.sortObjects&&d.sort(),$&&J.beginShadows();var r=h.state.shadowsArray;se.render(r,e,t),h.setupLights(t),$&&J.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),R.render(d,e,t,i);var a=d.opaque,o=d.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;a.length&&ge(a,e,t,s),o.length&&ge(o,e,t,s)}else a.length&&ge(a,e,t),o.length&&ge(o,e,t);e.onAfterRender(C,e,t),null!==k&&(_.updateRenderTargetMipmap(k),_.updateMultisampleRenderTarget(k)),m.buffers.depth.setTest(!0),m.buffers.depth.setMask(!0),m.buffers.color.setMask(!0),m.setPolygonOffset(!1),oe.enabled&&oe.submitFrame(),d=null,h=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){D!==e&&f.bindFramebuffer(36160,e),D=e},this.getActiveCubeFace=function(){return O},this.getActiveMipMapLevel=function(){return N},this.getRenderTarget=function(){return k},this.setRenderTarget=function(e,t,n){k=e,O=t,N=n,e&&void 0===y.get(e).__webglFramebuffer&&_.setupRenderTarget(e);var i=D,r=!1;if(e){var a=y.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(i=a[t||0],r=!0):i=e.isWebGLMultisampleRenderTarget?y.get(e).__webglMultisampledFramebuffer:a,H.copy(e.viewport),j.copy(e.scissor),z=e.scissorTest}else H.copy(Y).multiplyScalar(W),j.copy(K).multiplyScalar(W),z=X;if(F!==i&&(f.bindFramebuffer(36160,i),F=i),m.viewport(H),m.scissor(j),m.setScissorTest(z),r){var o=y.get(e.texture);f.framebufferTexture2D(36160,36064,34069+(t||0),o.__webglTexture,n||0)}},this.readRenderTargetPixels=function(e,t,n,i,r,a,o){if(e&&e.isWebGLRenderTarget){var s=y.get(e).__webglFramebuffer;if(e.isWebGLRenderTargetCube&&void 0!==o&&(s=s[o]),s){var l=!1;s!==F&&(f.bindFramebuffer(36160,s),l=!0);try{var c=e.texture,u=c.format,d=c.type;if(u!==lt&&M.convert(u)!==f.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(d===nt||M.convert(d)===f.getParameter(35738)||d===rt&&(g.isWebGL2||p.get("OES_texture_float")||p.get("WEBGL_color_buffer_float"))||d===at&&(g.isWebGL2?p.get("EXT_color_buffer_float"):p.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===f.checkFramebufferStatus(36160)?t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&f.readPixels(t,n,i,r,M.convert(u),M.convert(d),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{l&&f.bindFramebuffer(36160,F)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,n){var i=t.image.width,r=t.image.height,a=M.convert(t.format);_.setTexture2D(t,0),f.copyTexImage2D(3553,n||0,a,e.x,e.y,i,r,0)},this.copyTextureToTexture=function(e,t,n,i){var r=t.image.width,a=t.image.height,o=M.convert(n.format),s=M.convert(n.type);_.setTexture2D(n,0),t.isDataTexture?f.texSubImage2D(3553,i||0,e.x,e.y,r,a,o,s,t.image.data):f.texSubImage2D(3553,i||0,e.x,e.y,o,s,t.image)}}function _r(e,t){this.name="",this.color=new Gt(e),this.density=void 0!==t?t:25e-5}function Er(e,t,n){this.name="",this.color=new Gt(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3}function br(){Xt.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function Tr(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Sr(e,t,n,i){this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===i}function wr(e){_n.call(this),this.type="SpriteMaterial",this.color=new Gt(16777215),this.map=null,this.rotation=0,this.sizeAttenuation=!0,this.lights=!1,this.transparent=!0,this.setValues(e)}function Ar(e){if(Xt.call(this),this.type="Sprite",void 0===hr){hr=new fn;var t=new Tr(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);hr.setIndex([0,1,2,0,2,3]),hr.addAttribute("position",new Sr(t,3,0,!1)),hr.addAttribute("uv",new Sr(t,2,3,!1))}this.geometry=hr,this.material=void 0!==e?e:new wr,this.center=new _t(.5,.5)}function Rr(){Xt.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function xr(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),wn.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new kt,this.bindMatrixInverse=new kt}function Ir(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new kt)}}function Lr(){Xt.call(this),this.type="Bone"}function Mr(e){_n.call(this),this.type="LineBasicMaterial",this.color=new Gt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}function Cr(e,t,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),Xt.call(this),this.type="Line",this.geometry=void 0!==e?e:new fn,this.material=void 0!==t?t:new Mr({color:16777215*Math.random()})}function Pr(e,t){Cr.call(this,e,t),this.type="LineSegments"}function Dr(e,t){Cr.call(this,e,t),this.type="LineLoop"}function Or(e){_n.call(this),this.type="PointsMaterial",this.color=new Gt(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function Nr(e,t){Xt.call(this),this.type="Points",this.geometry=void 0!==e?e:new fn,this.material=void 0!==t?t:new Or({color:16777215*Math.random()})}function kr(e,t,n,i,r,a,o,s,l){Rt.call(this,e,t,n,i,r,a,o,s,l),this.format=void 0!==o?o:st,this.minFilter=void 0!==a?a:et,this.magFilter=void 0!==r?r:et,this.generateMipmaps=!1}function Fr(e,t,n,i,r,a,o,s,l,c,u,d){Rt.call(this,null,a,o,s,l,c,i,r,u,d),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function Br(e,t,n,i,r,a,o,s,l){Rt.call(this,e,t,n,i,r,a,o,s,l),this.needsUpdate=!0}function Ur(e,t,n,i,r,a,o,s,l,c){if((c=void 0!==c?c:ct)!==ct&&c!==ut)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===ct&&(n=it),void 0===n&&c===ut&&(n=ot),Rt.call(this,null,i,r,a,o,s,c,n,l),this.image={width:e,height:t},this.magFilter=void 0!==o?o:Qe,this.minFilter=void 0!==s?s:Qe,this.flipY=!1,this.generateMipmaps=!1}function Vr(e){fn.call(this),this.type="WireframeGeometry";var t,n,i,r,a,o,s,l,c,u,d=[],h=[0,0],f={},p=["a","b","c"];if(e&&e.isGeometry){var g=e.faces;for(t=0,i=g.length;t<i;t++){var m=g[t];for(n=0;n<3;n++)s=m[p[n]],l=m[p[(n+1)%3]],h[0]=Math.min(s,l),h[1]=Math.max(s,l),void 0===f[c=h[0]+","+h[1]]&&(f[c]={index1:h[0],index2:h[1]})}for(c in f)o=f[c],u=e.vertices[o.index1],d.push(u.x,u.y,u.z),u=e.vertices[o.index2],d.push(u.x,u.y,u.z)}else if(e&&e.isBufferGeometry){var v,y,_,E,b,T,S;if(u=new bt,null!==e.index){for(v=e.attributes.position,y=e.index,0===(_=e.groups).length&&(_=[{start:0,count:y.count,materialIndex:0}]),r=0,a=_.length;r<a;++r)for(t=b=(E=_[r]).start,i=b+E.count;t<i;t+=3)for(n=0;n<3;n++)s=y.getX(t+n),l=y.getX(t+(n+1)%3),h[0]=Math.min(s,l),h[1]=Math.max(s,l),void 0===f[c=h[0]+","+h[1]]&&(f[c]={index1:h[0],index2:h[1]});for(c in f)o=f[c],u.fromBufferAttribute(v,o.index1),d.push(u.x,u.y,u.z),u.fromBufferAttribute(v,o.index2),d.push(u.x,u.y,u.z)}else for(t=0,i=(v=e.attributes.position).count/3;t<i;t++)for(n=0;n<3;n++)T=3*t+n,u.fromBufferAttribute(v,T),d.push(u.x,u.y,u.z),S=3*t+(n+1)%3,u.fromBufferAttribute(v,S),d.push(u.x,u.y,u.z)}this.addAttribute("position",new ln(d,3))}function Gr(e,t,n){Jt.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n},this.fromBufferGeometry(new Hr(e,t,n)),this.mergeVertices()}function Hr(e,t,n){fn.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:n};var i,r,a=[],o=[],s=[],l=[],c=1e-5,u=new bt,d=new bt,h=new bt,f=new bt,p=new bt;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var g=t+1;for(i=0;i<=n;i++){var m=i/n;for(r=0;r<=t;r++){var v=r/t;e(v,m,d),o.push(d.x,d.y,d.z),v-c>=0?(e(v-c,m,h),f.subVectors(d,h)):(e(v+c,m,h),f.subVectors(h,d)),m-c>=0?(e(v,m-c,h),p.subVectors(d,h)):(e(v,m+c,h),p.subVectors(h,d)),u.crossVectors(f,p).normalize(),s.push(u.x,u.y,u.z),l.push(v,m)}}for(i=0;i<n;i++)for(r=0;r<t;r++){var y=i*g+r,_=i*g+r+1,E=(i+1)*g+r+1,b=(i+1)*g+r;a.push(y,_,b),a.push(_,E,b)}this.setIndex(a),this.addAttribute("position",new ln(o,3)),this.addAttribute("normal",new ln(s,3)),this.addAttribute("uv",new ln(l,2))}function jr(e,t,n,i){Jt.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i},this.fromBufferGeometry(new zr(e,t,n,i)),this.mergeVertices()}function zr(e,t,n,i){fn.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i},n=n||1;var r=[],a=[];function o(e,t,n,i){var r,a,o=Math.pow(2,i),l=[];for(r=0;r<=o;r++){l[r]=[];var c=e.clone().lerp(n,r/o),u=t.clone().lerp(n,r/o),d=o-r;for(a=0;a<=d;a++)l[r][a]=0===a&&r===o?c:c.clone().lerp(u,a/d)}for(r=0;r<o;r++)for(a=0;a<2*(o-r)-1;a++){var h=Math.floor(a/2);a%2==0?(s(l[r][h+1]),s(l[r+1][h]),s(l[r][h])):(s(l[r][h+1]),s(l[r+1][h+1]),s(l[r+1][h]))}}function s(e){r.push(e.x,e.y,e.z)}function l(t,n){var i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function c(e,t,n,i){i<0&&1===e.x&&(a[t]=e.x-1),0===n.x&&0===n.z&&(a[t]=i/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}function d(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(function(e){for(var n=new bt,i=new bt,r=new bt,a=0;a<t.length;a+=3)l(t[a+0],n),l(t[a+1],i),l(t[a+2],r),o(n,i,r,e)})(i=i||0),function(e){for(var t=new bt,n=0;n<r.length;n+=3)t.x=r[n+0],t.y=r[n+1],t.z=r[n+2],t.normalize().multiplyScalar(e),r[n+0]=t.x,r[n+1]=t.y,r[n+2]=t.z}(n),function(){for(var e=new bt,t=0;t<r.length;t+=3){e.x=r[t+0],e.y=r[t+1],e.z=r[t+2];var n=u(e)/2/Math.PI+.5,i=d(e)/Math.PI+.5;a.push(n,1-i)}(function(){for(var e=new bt,t=new bt,n=new bt,i=new bt,o=new _t,s=new _t,l=new _t,d=0,h=0;d<r.length;d+=9,h+=6){e.set(r[d+0],r[d+1],r[d+2]),t.set(r[d+3],r[d+4],r[d+5]),n.set(r[d+6],r[d+7],r[d+8]),o.set(a[h+0],a[h+1]),s.set(a[h+2],a[h+3]),l.set(a[h+4],a[h+5]),i.copy(e).add(t).add(n).divideScalar(3);var f=u(i);c(o,h+0,e,f),c(s,h+2,t,f),c(l,h+4,n,f)}})(),function(){for(var e=0;e<a.length;e+=6){var t=a[e+0],n=a[e+2],i=a[e+4],r=Math.max(t,n,i),o=Math.min(t,n,i);r>.9&&o<.1&&(t<.2&&(a[e+0]+=1),n<.2&&(a[e+2]+=1),i<.2&&(a[e+4]+=1))}}()}(),this.addAttribute("position",new ln(r,3)),this.addAttribute("normal",new ln(r.slice(),3)),this.addAttribute("uv",new ln(a,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}function Zr(e,t){Jt.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new qr(e,t)),this.mergeVertices()}function qr(e,t){zr.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Wr(e,t){Jt.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Yr(e,t)),this.mergeVertices()}function Yr(e,t){zr.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Kr(e,t){Jt.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Xr(e,t)),this.mergeVertices()}function Xr(e,t){var n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1];zr.call(this,i,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Qr(e,t){Jt.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Jr(e,t)),this.mergeVertices()}function Jr(e,t){var n=(1+Math.sqrt(5))/2,i=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i];zr.call(this,r,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function $r(e,t,n,i,r,a){Jt.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r},void 0!==a&&console.warn("THREE.TubeGeometry: taper has been removed.");var o=new ea(e,t,n,i,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals,this.fromBufferGeometry(o),this.mergeVertices()}function ea(e,t,n,i,r){fn.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r},t=t||64,n=n||1,i=i||8,r=r||!1;var a=e.computeFrenetFrames(t,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;var o,s,l=new bt,c=new bt,u=new _t,d=new bt,h=[],f=[],p=[],g=[];function m(r){d=e.getPointAt(r/t,d);var o=a.normals[r],u=a.binormals[r];for(s=0;s<=i;s++){var p=s/i*Math.PI*2,g=Math.sin(p),m=-Math.cos(p);c.x=m*o.x+g*u.x,c.y=m*o.y+g*u.y,c.z=m*o.z+g*u.z,c.normalize(),f.push(c.x,c.y,c.z),l.x=d.x+n*c.x,l.y=d.y+n*c.y,l.z=d.z+n*c.z,h.push(l.x,l.y,l.z)}}(function(){for(o=0;o<t;o++)m(o);m(!1===r?t:0),function(){for(o=0;o<=t;o++)for(s=0;s<=i;s++)u.x=o/t,u.y=s/i,p.push(u.x,u.y)}(),function(){for(s=1;s<=t;s++)for(o=1;o<=i;o++){var e=(i+1)*(s-1)+(o-1),n=(i+1)*s+(o-1),r=(i+1)*s+o,a=(i+1)*(s-1)+o;g.push(e,n,a),g.push(n,r,a)}}()})(),this.setIndex(g),this.addAttribute("position",new ln(h,3)),this.addAttribute("normal",new ln(f,3)),this.addAttribute("uv",new ln(p,2))}function ta(e,t,n,i,r,a,o){Jt.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:a},void 0!==o&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new na(e,t,n,i,r,a)),this.mergeVertices()}function na(e,t,n,i,r,a){fn.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:a},e=e||1,t=t||.4,n=Math.floor(n)||64,i=Math.floor(i)||8,r=r||2,a=a||3;var o,s,l=[],c=[],u=[],d=[],h=new bt,f=new bt,p=new bt,g=new bt,m=new bt,v=new bt,y=new bt;for(o=0;o<=n;++o){var _=o/n*r*Math.PI*2;for(x(_,r,a,e,p),x(_+.01,r,a,e,g),v.subVectors(g,p),y.addVectors(g,p),m.crossVectors(v,y),y.crossVectors(m,v),m.normalize(),y.normalize(),s=0;s<=i;++s){var E=s/i*Math.PI*2,b=-t*Math.cos(E),T=t*Math.sin(E);h.x=p.x+(b*y.x+T*m.x),h.y=p.y+(b*y.y+T*m.y),h.z=p.z+(b*y.z+T*m.z),c.push(h.x,h.y,h.z),f.subVectors(h,p).normalize(),u.push(f.x,f.y,f.z),d.push(o/n),d.push(s/i)}}for(s=1;s<=n;s++)for(o=1;o<=i;o++){var S=(i+1)*(s-1)+(o-1),w=(i+1)*s+(o-1),A=(i+1)*s+o,R=(i+1)*(s-1)+o;l.push(S,w,R),l.push(w,A,R)}function x(e,t,n,i,r){var a=Math.cos(e),o=Math.sin(e),s=n/t*e,l=Math.cos(s);r.x=i*(2+l)*.5*a,r.y=i*(2+l)*o*.5,r.z=i*Math.sin(s)*.5}this.setIndex(l),this.addAttribute("position",new ln(c,3)),this.addAttribute("normal",new ln(u,3)),this.addAttribute("uv",new ln(d,2))}function ia(e,t,n,i,r){Jt.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},this.fromBufferGeometry(new ra(e,t,n,i,r)),this.mergeVertices()}function ra(e,t,n,i,r){fn.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},e=e||1,t=t||.4,n=Math.floor(n)||8,i=Math.floor(i)||6,r=r||2*Math.PI;var a,o,s=[],l=[],c=[],u=[],d=new bt,h=new bt,f=new bt;for(a=0;a<=n;a++)for(o=0;o<=i;o++){var p=o/i*r,g=a/n*Math.PI*2;h.x=(e+t*Math.cos(g))*Math.cos(p),h.y=(e+t*Math.cos(g))*Math.sin(p),h.z=t*Math.sin(g),l.push(h.x,h.y,h.z),d.x=e*Math.cos(p),d.y=e*Math.sin(p),f.subVectors(h,d).normalize(),c.push(f.x,f.y,f.z),u.push(o/i),u.push(a/n)}for(a=1;a<=n;a++)for(o=1;o<=i;o++){var m=(i+1)*a+o-1,v=(i+1)*(a-1)+o-1,y=(i+1)*(a-1)+o,_=(i+1)*a+o;s.push(m,v,_),s.push(v,y,_)}this.setIndex(s),this.addAttribute("position",new ln(l,3)),this.addAttribute("normal",new ln(c,3)),this.addAttribute("uv",new ln(u,2))}Object.assign(_r.prototype,{isFogExp2:!0,clone:function(){return new _r(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Er.prototype,{isFog:!0,clone:function(){return new Er(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),br.prototype=Object.assign(Object.create(Xt.prototype),{constructor:br,isScene:!0,copy:function(e,t){return Xt.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=Xt.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Tr.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Tr.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.stride:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(var i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Object.defineProperties(Sr.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Sr.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this},setXYZW:function(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}}),wr.prototype=Object.create(_n.prototype),wr.prototype.constructor=wr,wr.prototype.isSpriteMaterial=!0,wr.prototype.copy=function(e){return _n.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this},Ar.prototype=Object.assign(Object.create(Xt.prototype),{constructor:Ar,isSprite:!0,raycast:function(){var e=new bt,t=new bt,n=new bt,i=new _t,r=new _t,a=new kt,o=new bt,s=new bt,l=new bt,c=new _t,u=new _t,d=new _t;function h(e,t,n,o,s,l){i.subVectors(e,n).addScalar(.5).multiply(o),void 0!==s?(r.x=l*i.x-s*i.y,r.y=s*i.x+l*i.y):r.copy(i),e.copy(t),e.x+=r.x,e.y+=r.y,e.applyMatrix4(a)}return function(i,r){t.setFromMatrixScale(this.matrixWorld),a.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld),n.setFromMatrixPosition(this.modelViewMatrix);var f,p,g=this.material.rotation;0!==g&&(p=Math.cos(g),f=Math.sin(g));var m=this.center;h(o.set(-.5,-.5,0),n,m,t,f,p),h(s.set(.5,-.5,0),n,m,t,f,p),h(l.set(.5,.5,0),n,m,t,f,p),c.set(0,0),u.set(1,0),d.set(1,1);var v=i.ray.intersectTriangle(o,s,l,!1,e);if(null!==v||(h(s.set(-.5,.5,0),n,m,t,f,p),u.set(0,1),null!==(v=i.ray.intersectTriangle(o,l,s,!1,e)))){var y=i.ray.origin.distanceTo(e);y<i.near||y>i.far||r.push({distance:y,point:e.clone(),uv:Tn.getUV(e,o,s,l,c,u,d,new _t),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return Xt.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}}),Rr.prototype=Object.assign(Object.create(Xt.prototype),{constructor:Rr,isLOD:!0,copy:function(e){Xt.prototype.copy.call(this,e,!1);for(var t=e.levels,n=0,i=t.length;n<i;n++){var r=t[n];this.addLevel(r.object.clone(),r.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var n=this.levels,i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,object:e}),this.add(e),this},getObjectForDistance:function(e){for(var t=this.levels,n=1,i=t.length;n<i&&!(e<t[n].distance);n++);return t[n-1].object},raycast:function(){var e=new bt;return function(t,n){e.setFromMatrixPosition(this.matrixWorld);var i=t.ray.origin.distanceTo(e);this.getObjectForDistance(i).raycast(t,n)}}(),update:function(){var e=new bt,t=new bt;return function(n){var i=this.levels;if(i.length>1){e.setFromMatrixPosition(n.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var r=e.distanceTo(t);i[0].object.visible=!0;for(var a=1,o=i.length;a<o&&r>=i[a].distance;a++)i[a-1].object.visible=!1,i[a].object.visible=!0;for(;a<o;a++)i[a].object.visible=!1}}}(),toJSON:function(e){var t=Xt.prototype.toJSON.call(this,e);t.object.levels=[];for(var n=this.levels,i=0,r=n.length;i<r;i++){var a=n[i];t.object.levels.push({object:a.object.uuid,distance:a.distance})}return t}}),xr.prototype=Object.assign(Object.create(wn.prototype),{constructor:xr,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new xt,t=this.geometry.attributes.skinWeight,n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);var r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){wn.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Object.assign(Ir.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new kt;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},pose:function(){var e,t,n;for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){var e=new kt,t=new kt;return function(){for(var n=this.bones,i=this.boneInverses,r=this.boneMatrices,a=this.boneTexture,o=0,s=n.length;o<s;o++){var l=n[o]?n[o].matrixWorld:t;e.multiplyMatrices(l,i[o]),e.toArray(r,16*o)}void 0!==a&&(a.needsUpdate=!0)}}(),clone:function(){return new Ir(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,n=this.bones.length;t<n;t++){var i=this.bones[t];if(i.name===e)return i}}}),Lr.prototype=Object.assign(Object.create(Xt.prototype),{constructor:Lr,isBone:!0}),Mr.prototype=Object.create(_n.prototype),Mr.prototype.constructor=Mr,Mr.prototype.isLineBasicMaterial=!0,Mr.prototype.copy=function(e){return _n.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},Cr.prototype=Object.assign(Object.create(Xt.prototype),{constructor:Cr,isLine:!0,computeLineDistances:function(){var e=new bt,t=new bt;return function(){var n=this.geometry;if(n.isBufferGeometry)if(null===n.index){for(var i=n.attributes.position,r=[0],a=1,o=i.count;a<o;a++)e.fromBufferAttribute(i,a-1),t.fromBufferAttribute(i,a),r[a]=r[a-1],r[a]+=e.distanceTo(t);n.addAttribute("lineDistance",new ln(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(n.isGeometry){var s=n.vertices;(r=n.lineDistances)[0]=0;for(a=1,o=s.length;a<o;a++)r[a]=r[a-1],r[a]+=s[a-1].distanceTo(s[a])}return this}}(),raycast:function(){var e=new kt,t=new bn,n=new Dt;return function(i,r){var a=i.linePrecision,o=this.geometry,s=this.matrixWorld;if(null===o.boundingSphere&&o.computeBoundingSphere(),n.copy(o.boundingSphere),n.applyMatrix4(s),n.radius+=a,!1!==i.ray.intersectsSphere(n)){e.getInverse(s),t.copy(i.ray).applyMatrix4(e);var l=a/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l,u=new bt,d=new bt,h=new bt,f=new bt,p=this&&this.isLineSegments?2:1;if(o.isBufferGeometry){var g=o.index,m=o.attributes.position.array;if(null!==g)for(var v=g.array,y=0,_=v.length-1;y<_;y+=p){var E=v[y],b=v[y+1];if(u.fromArray(m,3*E),d.fromArray(m,3*b),!(t.distanceSqToSegment(u,d,f,h)>c))f.applyMatrix4(this.matrixWorld),(w=i.ray.origin.distanceTo(f))<i.near||w>i.far||r.push({distance:w,point:h.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}else for(y=0,_=m.length/3-1;y<_;y+=p){if(u.fromArray(m,3*y),d.fromArray(m,3*y+3),!(t.distanceSqToSegment(u,d,f,h)>c))f.applyMatrix4(this.matrixWorld),(w=i.ray.origin.distanceTo(f))<i.near||w>i.far||r.push({distance:w,point:h.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}else if(o.isGeometry){var T=o.vertices,S=T.length;for(y=0;y<S-1;y+=p){var w;if(!(t.distanceSqToSegment(T[y],T[y+1],f,h)>c))f.applyMatrix4(this.matrixWorld),(w=i.ray.origin.distanceTo(f))<i.near||w>i.far||r.push({distance:w,point:h.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Pr.prototype=Object.assign(Object.create(Cr.prototype),{constructor:Pr,isLineSegments:!0,computeLineDistances:function(){var e=new bt,t=new bt;return function(){var n=this.geometry;if(n.isBufferGeometry)if(null===n.index){for(var i=n.attributes.position,r=[],a=0,o=i.count;a<o;a+=2)e.fromBufferAttribute(i,a),t.fromBufferAttribute(i,a+1),r[a]=0===a?0:r[a-1],r[a+1]=r[a]+e.distanceTo(t);n.addAttribute("lineDistance",new ln(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(n.isGeometry){var s=n.vertices;for(r=n.lineDistances,a=0,o=s.length;a<o;a+=2)e.copy(s[a]),t.copy(s[a+1]),r[a]=0===a?0:r[a-1],r[a+1]=r[a]+e.distanceTo(t)}return this}}()}),Dr.prototype=Object.assign(Object.create(Cr.prototype),{constructor:Dr,isLineLoop:!0}),Or.prototype=Object.create(_n.prototype),Or.prototype.constructor=Or,Or.prototype.isPointsMaterial=!0,Or.prototype.copy=function(e){return _n.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this},Nr.prototype=Object.assign(Object.create(Xt.prototype),{constructor:Nr,isPoints:!0,raycast:function(){var e=new kt,t=new bn,n=new Dt;return function(i,r){var a=this,o=this.geometry,s=this.matrixWorld,l=i.params.Points.threshold;if(null===o.boundingSphere&&o.computeBoundingSphere(),n.copy(o.boundingSphere),n.applyMatrix4(s),n.radius+=l,!1!==i.ray.intersectsSphere(n)){e.getInverse(s),t.copy(i.ray).applyMatrix4(e);var c=l/((this.scale.x+this.scale.y+this.scale.z)/3),u=c*c,d=new bt,h=new bt;if(o.isBufferGeometry){var f=o.index,p=o.attributes.position.array;if(null!==f)for(var g=f.array,m=0,v=g.length;m<v;m++){var y=g[m];d.fromArray(p,3*y),b(d,y)}else{m=0;for(var _=p.length/3;m<_;m++)d.fromArray(p,3*m),b(d,m)}}else{var E=o.vertices;for(m=0,_=E.length;m<_;m++)b(E[m],m)}}function b(e,n){var o=t.distanceSqToPoint(e);if(o<u){t.closestPointToPoint(e,h),h.applyMatrix4(s);var l=i.ray.origin.distanceTo(h);if(l<i.near||l>i.far)return;r.push({distance:l,distanceToRay:Math.sqrt(o),point:h.clone(),index:n,face:null,object:a})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),kr.prototype=Object.assign(Object.create(Rt.prototype),{constructor:kr,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Fr.prototype=Object.create(Rt.prototype),Fr.prototype.constructor=Fr,Fr.prototype.isCompressedTexture=!0,Br.prototype=Object.create(Rt.prototype),Br.prototype.constructor=Br,Br.prototype.isCanvasTexture=!0,Ur.prototype=Object.create(Rt.prototype),Ur.prototype.constructor=Ur,Ur.prototype.isDepthTexture=!0,Vr.prototype=Object.create(fn.prototype),Vr.prototype.constructor=Vr,Gr.prototype=Object.create(Jt.prototype),Gr.prototype.constructor=Gr,Hr.prototype=Object.create(fn.prototype),Hr.prototype.constructor=Hr,jr.prototype=Object.create(Jt.prototype),jr.prototype.constructor=jr,zr.prototype=Object.create(fn.prototype),zr.prototype.constructor=zr,Zr.prototype=Object.create(Jt.prototype),Zr.prototype.constructor=Zr,qr.prototype=Object.create(zr.prototype),qr.prototype.constructor=qr,Wr.prototype=Object.create(Jt.prototype),Wr.prototype.constructor=Wr,Yr.prototype=Object.create(zr.prototype),Yr.prototype.constructor=Yr,Kr.prototype=Object.create(Jt.prototype),Kr.prototype.constructor=Kr,Xr.prototype=Object.create(zr.prototype),Xr.prototype.constructor=Xr,Qr.prototype=Object.create(Jt.prototype),Qr.prototype.constructor=Qr,Jr.prototype=Object.create(zr.prototype),Jr.prototype.constructor=Jr,$r.prototype=Object.create(Jt.prototype),$r.prototype.constructor=$r,ea.prototype=Object.create(fn.prototype),ea.prototype.constructor=ea,ea.prototype.toJSON=function(){var e=fn.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},ta.prototype=Object.create(Jt.prototype),ta.prototype.constructor=ta,na.prototype=Object.create(fn.prototype),na.prototype.constructor=na,ia.prototype=Object.create(Jt.prototype),ia.prototype.constructor=ia,ra.prototype=Object.create(fn.prototype),ra.prototype.constructor=ra;var aa=function(e,t,n){n=n||2;var i,r,a,o,s,l,c,u=t&&t.length,d=u?t[0]*n:e.length,h=oa(e,0,d,n,!0),f=[];if(!h)return f;if(u&&(h=function(e,t,n,i){var r,a,o,s,l,c=[];for(r=0,a=t.length;r<a;r++)o=t[r]*i,s=r<a-1?t[r+1]*i:e.length,(l=oa(e,o,s,i,!1))===l.next&&(l.steiner=!0),c.push(ma(l));for(c.sort(fa),r=0;r<c.length;r++)pa(c[r],n),n=sa(n,n.next);return n}(e,t,h,n)),e.length>80*n){i=a=e[0],r=o=e[1];for(var p=n;p<d;p+=n)(s=e[p])<i&&(i=s),(l=e[p+1])<r&&(r=l),s>a&&(a=s),l>o&&(o=l);c=0!==(c=Math.max(a-i,o-r))?1/c:0}return la(h,f,n,i,r,c),f};function oa(e,t,n,i,r){var a,o;if(r===function(e,t,n,i){for(var r=0,a=t,o=n-i;a<n;a+=i)r+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return r}(e,t,n,i)>0)for(a=t;a<n;a+=i)o=wa(a,e[a],e[a+1],o);else for(a=n-i;a>=t;a-=i)o=wa(a,e[a],e[a+1],o);return o&&Ea(o,o.next)&&(Aa(o),o=o.next),o}function sa(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!Ea(i,i.next)&&0!==_a(i.prev,i,i.next))i=i.next;else{if(Aa(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function la(e,t,n,i,r,a,o){if(e){!o&&a&&function(e,t,n,i){var r=e;do{null===r.z&&(r.z=ga(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,a,o,s,l,c=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,i=n,s=0,t=0;t<c&&(s++,i=i.nextZ);t++);for(l=c;s>0||l>0&&i;)0!==s&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,l--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;n=i}a.nextZ=null,c*=2}while(o>1)}(r)}(e,i,r,a);for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?ua(e,i,r,a):ca(e))t.push(s.i/n),t.push(e.i/n),t.push(l.i/n),Aa(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?la(e=da(e,t,n),t,n,i,r,a,2):2===o&&ha(e,t,n,i,r,a):la(sa(e),t,n,i,r,a,1);break}}}function ca(e){var t=e.prev,n=e,i=e.next;if(_a(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(va(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&_a(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function ua(e,t,n,i){var r=e.prev,a=e,o=e.next;if(_a(r,a,o)>=0)return!1;for(var s=r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,l=r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,c=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,u=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,d=ga(s,l,t,n,i),h=ga(c,u,t,n,i),f=e.nextZ;f&&f.z<=h;){if(f!==e.prev&&f!==e.next&&va(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&_a(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(f=e.prevZ;f&&f.z>=d;){if(f!==e.prev&&f!==e.next&&va(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&_a(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0}function da(e,t,n){var i=e;do{var r=i.prev,a=i.next.next;!Ea(r,a)&&ba(r,i,i.next,a)&&Ta(r,a)&&Ta(a,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(a.i/n),Aa(i),Aa(i.next),i=e=a),i=i.next}while(i!==e);return i}function ha(e,t,n,i,r,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&ya(o,s)){var l=Sa(o,s);return o=sa(o,o.next),l=sa(l,l.next),la(o,t,n,i,r,a),void la(l,t,n,i,r,a)}s=s.next}o=o.next}while(o!==e)}function fa(e,t){return e.x-t.x}function pa(e,t){if(t=function(e,t){var n,i=t,r=e.x,a=e.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>o){if(o=s,s===r){if(a===i.y)return i;if(a===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===o)return n.prev;var l,c=n,u=n.x,d=n.y,h=1/0;for(i=n.next;i!==c;)r>=i.x&&i.x>=u&&r!==i.x&&va(a<d?r:o,a,u,d,a<d?o:r,a,i.x,i.y)&&((l=Math.abs(a-i.y)/(r-i.x))<h||l===h&&i.x>n.x)&&Ta(i,e)&&(n=i,h=l),i=i.next;return n}(e,t),t){var n=Sa(t,e);sa(n,n.next)}}function ga(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ma(e){var t=e,n=e;do{t.x<n.x&&(n=t),t=t.next}while(t!==e);return n}function va(e,t,n,i,r,a,o,s){return(r-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(i-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(r-o)*(i-s)>=0}function ya(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&ba(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&Ta(e,t)&&Ta(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)}function _a(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Ea(e,t){return e.x===t.x&&e.y===t.y}function ba(e,t,n,i){return!!(Ea(e,t)&&Ea(n,i)||Ea(e,i)&&Ea(n,t))||_a(e,t,n)>0!=_a(e,t,i)>0&&_a(n,i,e)>0!=_a(n,i,t)>0}function Ta(e,t){return _a(e.prev,e,e.next)<0?_a(e,t,e.next)>=0&&_a(e,e.prev,t)>=0:_a(e,t,e.prev)<0||_a(e,e.next,t)<0}function Sa(e,t){var n=new Ra(e.i,e.x,e.y),i=new Ra(t.i,t.x,t.y),r=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function wa(e,t,n,i){var r=new Ra(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Aa(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Ra(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var xa={area:function(e){for(var t=e.length,n=0,i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n},isClockWise:function(e){return xa.area(e)<0},triangulateShape:function(e,t){var n=[],i=[],r=[];Ia(e),La(n,e);var a=e.length;t.forEach(Ia);for(var o=0;o<t.length;o++)i.push(a),a+=t[o].length,La(n,t[o]);var s=aa(n,i);for(o=0;o<s.length;o+=3)r.push(s.slice(o,o+3));return r}};function Ia(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function La(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}function Ma(e,t){Jt.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new Ca(e,t)),this.mergeVertices()}function Ca(e,t){fn.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var n=this,i=[],r=[],a=0,o=e.length;a<o;a++){s(e[a])}function s(e){var a=[],o=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:100,c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:6,d=void 0!==t.bevelSize?t.bevelSize:u-2,h=void 0!==t.bevelOffset?t.bevelOffset:0,f=void 0!==t.bevelSegments?t.bevelSegments:3,p=t.extrudePath,g=void 0!==t.UVGenerator?t.UVGenerator:Pa;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);var m,v,y,_,E,b=!1;p&&(m=p.getSpacedPoints(s),b=!0,c=!1,v=p.computeFrenetFrames(s,!1),y=new bt,_=new bt,E=new bt),c||(f=0,u=0,d=0,h=0);var T,S,w,A=e.extractPoints(o),R=A.shape,x=A.holes;if(!xa.isClockWise(R))for(R=R.reverse(),S=0,w=x.length;S<w;S++)T=x[S],xa.isClockWise(T)&&(x[S]=T.reverse());var I=xa.triangulateShape(R,x),L=R;for(S=0,w=x.length;S<w;S++)T=x[S],R=R.concat(T);function M(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var C,P,D,O,N,k,F=R.length,B=I.length;function U(e,t,n){var i,r,a,o=e.x-t.x,s=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=o*o+s*s,d=o*c-s*l;if(Math.abs(d)>Number.EPSILON){var h=Math.sqrt(u),f=Math.sqrt(l*l+c*c),p=t.x-s/h,g=t.y+o/h,m=((n.x-c/f-p)*c-(n.y+l/f-g)*l)/(o*c-s*l),v=(i=p+o*m-e.x)*i+(r=g+s*m-e.y)*r;if(v<=2)return new _t(i,r);a=Math.sqrt(v/2)}else{var y=!1;o>Number.EPSILON?l>Number.EPSILON&&(y=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(c)&&(y=!0),y?(i=-s,r=o,a=Math.sqrt(u)):(i=o,r=s,a=Math.sqrt(u/2))}return new _t(i/a,r/a)}for(var V=[],G=0,H=L.length,j=H-1,z=G+1;G<H;G++,j++,z++)j===H&&(j=0),z===H&&(z=0),V[G]=U(L[G],L[j],L[z]);var Z,q,W=[],Y=V.concat();for(S=0,w=x.length;S<w;S++){for(T=x[S],Z=[],G=0,j=(H=T.length)-1,z=G+1;G<H;G++,j++,z++)j===H&&(j=0),z===H&&(z=0),Z[G]=U(T[G],T[j],T[z]);W.push(Z),Y=Y.concat(Z)}for(C=0;C<f;C++){for(D=C/f,O=u*Math.cos(D*Math.PI/2),P=d*Math.sin(D*Math.PI/2)+h,G=0,H=L.length;G<H;G++)X((N=M(L[G],V[G],P)).x,N.y,-O);for(S=0,w=x.length;S<w;S++)for(T=x[S],Z=W[S],G=0,H=T.length;G<H;G++)X((N=M(T[G],Z[G],P)).x,N.y,-O)}for(P=d+h,G=0;G<F;G++)N=c?M(R[G],Y[G],P):R[G],b?(_.copy(v.normals[0]).multiplyScalar(N.x),y.copy(v.binormals[0]).multiplyScalar(N.y),E.copy(m[0]).add(_).add(y),X(E.x,E.y,E.z)):X(N.x,N.y,0);for(q=1;q<=s;q++)for(G=0;G<F;G++)N=c?M(R[G],Y[G],P):R[G],b?(_.copy(v.normals[q]).multiplyScalar(N.x),y.copy(v.binormals[q]).multiplyScalar(N.y),E.copy(m[q]).add(_).add(y),X(E.x,E.y,E.z)):X(N.x,N.y,l/s*q);for(C=f-1;C>=0;C--){for(D=C/f,O=u*Math.cos(D*Math.PI/2),P=d*Math.sin(D*Math.PI/2)+h,G=0,H=L.length;G<H;G++)X((N=M(L[G],V[G],P)).x,N.y,l+O);for(S=0,w=x.length;S<w;S++)for(T=x[S],Z=W[S],G=0,H=T.length;G<H;G++)N=M(T[G],Z[G],P),b?X(N.x,N.y+m[s-1].y,m[s-1].x+O):X(N.x,N.y,l+O)}function K(e,t){var n,i;for(G=e.length;--G>=0;){n=G,(i=G-1)<0&&(i=e.length-1);var r=0,a=s+2*f;for(r=0;r<a;r++){var o=F*r,l=F*(r+1);J(t+n+o,t+i+o,t+i+l,t+n+l)}}}function X(e,t,n){a.push(e),a.push(t),a.push(n)}function Q(e,t,r){$(e),$(t),$(r);var a=i.length/3,o=g.generateTopUV(n,i,a-3,a-2,a-1);ee(o[0]),ee(o[1]),ee(o[2])}function J(e,t,r,a){$(e),$(t),$(a),$(t),$(r),$(a);var o=i.length/3,s=g.generateSideWallUV(n,i,o-6,o-3,o-2,o-1);ee(s[0]),ee(s[1]),ee(s[3]),ee(s[1]),ee(s[2]),ee(s[3])}function $(e){i.push(a[3*e+0]),i.push(a[3*e+1]),i.push(a[3*e+2])}function ee(e){r.push(e.x),r.push(e.y)}(function(){var e=i.length/3;if(c){var t=0,r=F*t;for(G=0;G<B;G++)Q((k=I[G])[2]+r,k[1]+r,k[0]+r);for(r=F*(t=s+2*f),G=0;G<B;G++)Q((k=I[G])[0]+r,k[1]+r,k[2]+r)}else{for(G=0;G<B;G++)Q((k=I[G])[2],k[1],k[0]);for(G=0;G<B;G++)Q((k=I[G])[0]+F*s,k[1]+F*s,k[2]+F*s)}n.addGroup(e,i.length/3-e,0)})(),function(){var e=i.length/3,t=0;for(K(L,t),t+=L.length,S=0,w=x.length;S<w;S++)K(T=x[S],t),t+=T.length;n.addGroup(e,i.length/3-e,1)}()}this.addAttribute("position",new ln(i,3)),this.addAttribute("uv",new ln(r,2)),this.computeVertexNormals()}Ma.prototype=Object.create(Jt.prototype),Ma.prototype.constructor=Ma,Ma.prototype.toJSON=function(){var e=Jt.prototype.toJSON.call(this);return Da(this.parameters.shapes,this.parameters.options,e)},Ca.prototype=Object.create(fn.prototype),Ca.prototype.constructor=Ca,Ca.prototype.toJSON=function(){var e=fn.prototype.toJSON.call(this);return Da(this.parameters.shapes,this.parameters.options,e)};var Pa={generateTopUV:function(e,t,n,i,r){var a=t[3*n],o=t[3*n+1],s=t[3*i],l=t[3*i+1],c=t[3*r],u=t[3*r+1];return[new _t(a,o),new _t(s,l),new _t(c,u)]},generateSideWallUV:function(e,t,n,i,r,a){var o=t[3*n],s=t[3*n+1],l=t[3*n+2],c=t[3*i],u=t[3*i+1],d=t[3*i+2],h=t[3*r],f=t[3*r+1],p=t[3*r+2],g=t[3*a],m=t[3*a+1],v=t[3*a+2];return Math.abs(s-u)<.01?[new _t(o,1-l),new _t(c,1-d),new _t(h,1-p),new _t(g,1-v)]:[new _t(s,1-l),new _t(u,1-d),new _t(f,1-p),new _t(m,1-v)]}};function Da(e,t,n){if(n.shapes=[],Array.isArray(e))for(var i=0,r=e.length;i<r;i++){var a=e[i];n.shapes.push(a.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}function Oa(e,t){Jt.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new Na(e,t)),this.mergeVertices()}function Na(e,t){var n=(t=t||{}).font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Jt;var i=n.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),Ca.call(this,i,t),this.type="TextBufferGeometry"}function ka(e,t,n,i,r,a,o){Jt.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new Fa(e,t,n,i,r,a,o)),this.mergeVertices()}function Fa(e,t,n,i,r,a,o){fn.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:a,thetaLength:o},e=e||1,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI,a=void 0!==a?a:0,o=void 0!==o?o:Math.PI;var s,l,c=Math.min(a+o,Math.PI),u=0,d=[],h=new bt,f=new bt,p=[],g=[],m=[],v=[];for(l=0;l<=n;l++){var y=[],_=l/n,E=0;for(0==l&&0==a?E=.5/t:l==n&&c==Math.PI&&(E=-.5/t),s=0;s<=t;s++){var b=s/t;h.x=-e*Math.cos(i+b*r)*Math.sin(a+_*o),h.y=e*Math.cos(a+_*o),h.z=e*Math.sin(i+b*r)*Math.sin(a+_*o),g.push(h.x,h.y,h.z),f.copy(h).normalize(),m.push(f.x,f.y,f.z),v.push(b+E,1-_),y.push(u++)}d.push(y)}for(l=0;l<n;l++)for(s=0;s<t;s++){var T=d[l][s+1],S=d[l][s],w=d[l+1][s],A=d[l+1][s+1];(0!==l||a>0)&&p.push(T,S,A),(l!==n-1||c<Math.PI)&&p.push(S,w,A)}this.setIndex(p),this.addAttribute("position",new ln(g,3)),this.addAttribute("normal",new ln(m,3)),this.addAttribute("uv",new ln(v,2))}function Ba(e,t,n,i,r,a){Jt.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:a},this.fromBufferGeometry(new Ua(e,t,n,i,r,a)),this.mergeVertices()}function Ua(e,t,n,i,r,a){fn.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:a},e=e||.5,t=t||1,r=void 0!==r?r:0,a=void 0!==a?a:2*Math.PI,n=void 0!==n?Math.max(3,n):8;var o,s,l,c=[],u=[],d=[],h=[],f=e,p=(t-e)/(i=void 0!==i?Math.max(1,i):1),g=new bt,m=new _t;for(s=0;s<=i;s++){for(l=0;l<=n;l++)o=r+l/n*a,g.x=f*Math.cos(o),g.y=f*Math.sin(o),u.push(g.x,g.y,g.z),d.push(0,0,1),m.x=(g.x/t+1)/2,m.y=(g.y/t+1)/2,h.push(m.x,m.y);f+=p}for(s=0;s<i;s++){var v=s*(n+1);for(l=0;l<n;l++){var y=o=l+v,_=o+n+1,E=o+n+2,b=o+1;c.push(y,_,b),c.push(_,E,b)}}this.setIndex(c),this.addAttribute("position",new ln(u,3)),this.addAttribute("normal",new ln(d,3)),this.addAttribute("uv",new ln(h,2))}function Va(e,t,n,i){Jt.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},this.fromBufferGeometry(new Ga(e,t,n,i)),this.mergeVertices()}function Ga(e,t,n,i){fn.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t)||12,n=n||0,i=i||2*Math.PI,i=yt.clamp(i,0,2*Math.PI);var r,a,o,s=[],l=[],c=[],u=1/t,d=new bt,h=new _t;for(a=0;a<=t;a++){var f=n+a*u*i,p=Math.sin(f),g=Math.cos(f);for(o=0;o<=e.length-1;o++)d.x=e[o].x*p,d.y=e[o].y,d.z=e[o].x*g,l.push(d.x,d.y,d.z),h.x=a/t,h.y=o/(e.length-1),c.push(h.x,h.y)}for(a=0;a<t;a++)for(o=0;o<e.length-1;o++){var m=r=o+a*e.length,v=r+e.length,y=r+e.length+1,_=r+1;s.push(m,v,_),s.push(v,y,_)}if(this.setIndex(s),this.addAttribute("position",new ln(l,3)),this.addAttribute("uv",new ln(c,2)),this.computeVertexNormals(),i===2*Math.PI){var E=this.attributes.normal.array,b=new bt,T=new bt,S=new bt;for(r=t*e.length*3,a=0,o=0;a<e.length;a++,o+=3)b.x=E[o+0],b.y=E[o+1],b.z=E[o+2],T.x=E[r+o+0],T.y=E[r+o+1],T.z=E[r+o+2],S.addVectors(b,T).normalize(),E[o+0]=E[r+o+0]=S.x,E[o+1]=E[r+o+1]=S.y,E[o+2]=E[r+o+2]=S.z}}function Ha(e,t){Jt.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new ja(e,t)),this.mergeVertices()}function ja(e,t){fn.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var n=[],i=[],r=[],a=[],o=0,s=0;if(!1===Array.isArray(e))c(e);else for(var l=0;l<e.length;l++)c(e[l]),this.addGroup(o,s,l),o+=s,s=0;function c(e){var o,l,c,u=i.length/3,d=e.extractPoints(t),h=d.shape,f=d.holes;for(!1===xa.isClockWise(h)&&(h=h.reverse()),o=0,l=f.length;o<l;o++)c=f[o],!0===xa.isClockWise(c)&&(f[o]=c.reverse());var p=xa.triangulateShape(h,f);for(o=0,l=f.length;o<l;o++)c=f[o],h=h.concat(c);for(o=0,l=h.length;o<l;o++){var g=h[o];i.push(g.x,g.y,0),r.push(0,0,1),a.push(g.x,g.y)}for(o=0,l=p.length;o<l;o++){var m=p[o],v=m[0]+u,y=m[1]+u,_=m[2]+u;n.push(v,y,_),s+=3}}this.setIndex(n),this.addAttribute("position",new ln(i,3)),this.addAttribute("normal",new ln(r,3)),this.addAttribute("uv",new ln(a,2))}function za(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,i=e.length;n<i;n++){var r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}function Za(e,t){fn.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var n,i,r,a,o=[],s=Math.cos(yt.DEG2RAD*t),l=[0,0],c={},u=["a","b","c"];e.isBufferGeometry?(a=new Jt).fromBufferGeometry(e):a=e.clone(),a.mergeVertices(),a.computeFaceNormals();for(var d=a.vertices,h=a.faces,f=0,p=h.length;f<p;f++)for(var g=h[f],m=0;m<3;m++)n=g[u[m]],i=g[u[(m+1)%3]],l[0]=Math.min(n,i),l[1]=Math.max(n,i),void 0===c[r=l[0]+","+l[1]]?c[r]={index1:l[0],index2:l[1],face1:f,face2:void 0}:c[r].face2=f;for(r in c){var v=c[r];if(void 0===v.face2||h[v.face1].normal.dot(h[v.face2].normal)<=s){var y=d[v.index1];o.push(y.x,y.y,y.z),y=d[v.index2],o.push(y.x,y.y,y.z)}}this.addAttribute("position",new ln(o,3))}function qa(e,t,n,i,r,a,o,s){Jt.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:a,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new Wa(e,t,n,i,r,a,o,s)),this.mergeVertices()}function Wa(e,t,n,i,r,a,o,s){fn.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:a,thetaStart:o,thetaLength:s};var l=this;e=void 0!==e?e:1,t=void 0!==t?t:1,n=n||1,i=Math.floor(i)||8,r=Math.floor(r)||1,a=void 0!==a&&a,o=void 0!==o?o:0,s=void 0!==s?s:2*Math.PI;var c=[],u=[],d=[],h=[],f=0,p=[],g=n/2,m=0;function v(n){var r,a,p,v=new _t,y=new bt,_=0,E=!0===n?e:t,b=!0===n?1:-1;for(a=f,r=1;r<=i;r++)u.push(0,g*b,0),d.push(0,b,0),h.push(.5,.5),f++;for(p=f,r=0;r<=i;r++){var T=r/i*s+o,S=Math.cos(T),w=Math.sin(T);y.x=E*w,y.y=g*b,y.z=E*S,u.push(y.x,y.y,y.z),d.push(0,b,0),v.x=.5*S+.5,v.y=.5*w*b+.5,h.push(v.x,v.y),f++}for(r=0;r<i;r++){var A=a+r,R=p+r;!0===n?c.push(R,R+1,A):c.push(R+1,R,A),_+=3}l.addGroup(m,_,!0===n?1:2),m+=_}(function(){var a,v,y=new bt,_=new bt,E=0,b=(t-e)/n;for(v=0;v<=r;v++){var T=[],S=v/r,w=S*(t-e)+e;for(a=0;a<=i;a++){var A=a/i,R=A*s+o,x=Math.sin(R),I=Math.cos(R);_.x=w*x,_.y=-S*n+g,_.z=w*I,u.push(_.x,_.y,_.z),y.set(x,b,I).normalize(),d.push(y.x,y.y,y.z),h.push(A,1-S),T.push(f++)}p.push(T)}for(a=0;a<i;a++)for(v=0;v<r;v++){var L=p[v][a],M=p[v+1][a],C=p[v+1][a+1],P=p[v][a+1];c.push(L,M,P),c.push(M,C,P),E+=6}l.addGroup(m,E,0),m+=E})(),!1===a&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.addAttribute("position",new ln(u,3)),this.addAttribute("normal",new ln(d,3)),this.addAttribute("uv",new ln(h,2))}function Ya(e,t,n,i,r,a,o){qa.call(this,0,e,t,n,i,r,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:a,thetaLength:o}}function Ka(e,t,n,i,r,a,o){Wa.call(this,0,e,t,n,i,r,a,o),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:a,thetaLength:o}}function Xa(e,t,n,i){Jt.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},this.fromBufferGeometry(new Qa(e,t,n,i)),this.mergeVertices()}function Qa(e,t,n,i){fn.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},e=e||1,t=void 0!==t?Math.max(3,t):8,n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI;var r,a,o=[],s=[],l=[],c=[],u=new bt,d=new _t;for(s.push(0,0,0),l.push(0,0,1),c.push(.5,.5),a=0,r=3;a<=t;a++,r+=3){var h=n+a/t*i;u.x=e*Math.cos(h),u.y=e*Math.sin(h),s.push(u.x,u.y,u.z),l.push(0,0,1),d.x=(s[r]/e+1)/2,d.y=(s[r+1]/e+1)/2,c.push(d.x,d.y)}for(r=1;r<=t;r++)o.push(r,r+1,0);this.setIndex(o),this.addAttribute("position",new ln(s,3)),this.addAttribute("normal",new ln(l,3)),this.addAttribute("uv",new ln(c,2))}Oa.prototype=Object.create(Jt.prototype),Oa.prototype.constructor=Oa,Na.prototype=Object.create(Ca.prototype),Na.prototype.constructor=Na,ka.prototype=Object.create(Jt.prototype),ka.prototype.constructor=ka,Fa.prototype=Object.create(fn.prototype),Fa.prototype.constructor=Fa,Ba.prototype=Object.create(Jt.prototype),Ba.prototype.constructor=Ba,Ua.prototype=Object.create(fn.prototype),Ua.prototype.constructor=Ua,Va.prototype=Object.create(Jt.prototype),Va.prototype.constructor=Va,Ga.prototype=Object.create(fn.prototype),Ga.prototype.constructor=Ga,Ha.prototype=Object.create(Jt.prototype),Ha.prototype.constructor=Ha,Ha.prototype.toJSON=function(){var e=Jt.prototype.toJSON.call(this);return za(this.parameters.shapes,e)},ja.prototype=Object.create(fn.prototype),ja.prototype.constructor=ja,ja.prototype.toJSON=function(){var e=fn.prototype.toJSON.call(this);return za(this.parameters.shapes,e)},Za.prototype=Object.create(fn.prototype),Za.prototype.constructor=Za,qa.prototype=Object.create(Jt.prototype),qa.prototype.constructor=qa,Wa.prototype=Object.create(fn.prototype),Wa.prototype.constructor=Wa,Ya.prototype=Object.create(qa.prototype),Ya.prototype.constructor=Ya,Ka.prototype=Object.create(Wa.prototype),Ka.prototype.constructor=Ka,Xa.prototype=Object.create(Jt.prototype),Xa.prototype.constructor=Xa,Qa.prototype=Object.create(fn.prototype),Qa.prototype.constructor=Qa;var Ja=Object.freeze({WireframeGeometry:Vr,ParametricGeometry:Gr,ParametricBufferGeometry:Hr,TetrahedronGeometry:Zr,TetrahedronBufferGeometry:qr,OctahedronGeometry:Wr,OctahedronBufferGeometry:Yr,IcosahedronGeometry:Kr,IcosahedronBufferGeometry:Xr,DodecahedronGeometry:Qr,DodecahedronBufferGeometry:Jr,PolyhedronGeometry:jr,PolyhedronBufferGeometry:zr,TubeGeometry:$r,TubeBufferGeometry:ea,TorusKnotGeometry:ta,TorusKnotBufferGeometry:na,TorusGeometry:ia,TorusBufferGeometry:ra,TextGeometry:Oa,TextBufferGeometry:Na,SphereGeometry:ka,SphereBufferGeometry:Fa,RingGeometry:Ba,RingBufferGeometry:Ua,PlaneGeometry:mn,PlaneBufferGeometry:vn,LatheGeometry:Va,LatheBufferGeometry:Ga,ShapeGeometry:Ha,ShapeBufferGeometry:ja,ExtrudeGeometry:Ma,ExtrudeBufferGeometry:Ca,EdgesGeometry:Za,ConeGeometry:Ya,ConeBufferGeometry:Ka,CylinderGeometry:qa,CylinderBufferGeometry:Wa,CircleGeometry:Xa,CircleBufferGeometry:Qa,BoxGeometry:pn,BoxBufferGeometry:gn});function $a(e){_n.call(this),this.type="ShadowMaterial",this.color=new Gt(0),this.transparent=!0,this.setValues(e)}function eo(e){En.call(this,e),this.type="RawShaderMaterial"}function to(e){_n.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Gt(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Gt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new _t(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function no(e){to.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}function io(e){_n.call(this),this.type="MeshPhongMaterial",this.color=new Gt(16777215),this.specular=new Gt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Gt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new _t(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function ro(e){io.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function ao(e){_n.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new _t(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function oo(e){_n.call(this),this.type="MeshLambertMaterial",this.color=new Gt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Gt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function so(e){_n.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Gt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new _t(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.lights=!1,this.setValues(e)}function lo(e){Mr.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}$a.prototype=Object.create(_n.prototype),$a.prototype.constructor=$a,$a.prototype.isShadowMaterial=!0,$a.prototype.copy=function(e){return _n.prototype.copy.call(this,e),this.color.copy(e.color),this},eo.prototype=Object.create(En.prototype),eo.prototype.constructor=eo,eo.prototype.isRawShaderMaterial=!0,to.prototype=Object.create(_n.prototype),to.prototype.constructor=to,to.prototype.isMeshStandardMaterial=!0,to.prototype.copy=function(e){return _n.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},no.prototype=Object.create(to.prototype),no.prototype.constructor=no,no.prototype.isMeshPhysicalMaterial=!0,no.prototype.copy=function(e){return to.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},io.prototype=Object.create(_n.prototype),io.prototype.constructor=io,io.prototype.isMeshPhongMaterial=!0,io.prototype.copy=function(e){return _n.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},ro.prototype=Object.create(io.prototype),ro.prototype.constructor=ro,ro.prototype.isMeshToonMaterial=!0,ro.prototype.copy=function(e){return io.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},ao.prototype=Object.create(_n.prototype),ao.prototype.constructor=ao,ao.prototype.isMeshNormalMaterial=!0,ao.prototype.copy=function(e){return _n.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},oo.prototype=Object.create(_n.prototype),oo.prototype.constructor=oo,oo.prototype.isMeshLambertMaterial=!0,oo.prototype.copy=function(e){return _n.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},so.prototype=Object.create(_n.prototype),so.prototype.constructor=so,so.prototype.isMeshMatcapMaterial=!0,so.prototype.copy=function(e){return _n.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},lo.prototype=Object.create(Mr.prototype),lo.prototype.constructor=lo,lo.prototype.isLineDashedMaterial=!0,lo.prototype.copy=function(e){return Mr.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var co=Object.freeze({ShadowMaterial:$a,SpriteMaterial:wr,RawShaderMaterial:eo,ShaderMaterial:En,PointsMaterial:Or,MeshPhysicalMaterial:no,MeshStandardMaterial:to,MeshPhongMaterial:io,MeshToonMaterial:ro,MeshNormalMaterial:ao,MeshLambertMaterial:oo,MeshDepthMaterial:nr,MeshDistanceMaterial:ir,MeshBasicMaterial:Sn,MeshMatcapMaterial:so,LineDashedMaterial:lo,LineBasicMaterial:Mr,Material:_n}),uo={arraySlice:function(e,t,n){return uo.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),i=0;i!==t;++i)n[i]=i;return n.sort(function(t,n){return e[t]-e[n]}),n},sortedArray:function(e,t,n){for(var i=e.length,r=new e.constructor(i),a=0,o=0;o!==i;++a)for(var s=n[a]*t,l=0;l!==t;++l)r[o++]=e[s+l];return r},flattenJSON:function(e,t,n,i){for(var r=1,a=e[0];void 0!==a&&void 0===a[i];)a=e[r++];if(void 0!==a){var o=a[i];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[i])&&(t.push(a.time),n.push.apply(n,o)),a=e[r++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[i])&&(t.push(a.time),o.toArray(n,n.length)),a=e[r++]}while(void 0!==a);else do{void 0!==(o=a[i])&&(t.push(a.time),n.push(o)),a=e[r++]}while(void 0!==a)}}};function ho(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function fo(e,t,n,i){ho.call(this,e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function po(e,t,n,i){ho.call(this,e,t,n,i)}function go(e,t,n,i){ho.call(this,e,t,n,i)}function mo(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=uo.convertArray(t,this.TimeBufferType),this.values=uo.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}function vo(e,t,n){mo.call(this,e,t,n)}function yo(e,t,n,i){mo.call(this,e,t,n,i)}function _o(e,t,n,i){mo.call(this,e,t,n,i)}function Eo(e,t,n,i){ho.call(this,e,t,n,i)}function bo(e,t,n,i){mo.call(this,e,t,n,i)}function To(e,t,n,i){mo.call(this,e,t,n,i)}function So(e,t,n,i){mo.call(this,e,t,n,i)}function wo(e,t,n){this.name=e,this.tracks=n,this.duration=void 0!==t?t:-1,this.uuid=yt.generateUUID(),this.duration<0&&this.resetDuration()}function Ao(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return _o;case"vector":case"vector2":case"vector3":case"vector4":return So;case"color":return yo;case"quaternion":return bo;case"bool":case"boolean":return vo;case"string":return To}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],i=[];uo.flattenJSON(e.keys,n,i,"value"),e.times=n,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(ho.prototype,{evaluate:function(e){var t=this.parameterPositions,n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{var a;n:{i:if(!(e<i)){for(var o=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,r)}if(n===o)break;if(r=i,e<(i=t[++n]))break t}a=t.length;break n}if(e>=r)break e;var s=t[1];e<s&&(n=2,r=s);for(o=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===o)break;if(i=r,e>=(r=t[--n-1]))break t}a=n,n=0}for(;n<a;){var l=n+a>>>1;e<t[l]?a=l:n=l+1}if(i=t[n],void 0===(r=t[n-1]))return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,r,e)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i,a=0;a!==i;++a)t[a]=n[r+a];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(ho.prototype,{beforeStart_:ho.prototype.copySampleValue_,afterEnd_:ho.prototype.copySampleValue_}),fo.prototype=Object.assign(Object.create(ho.prototype),{constructor:fo,DefaultSettings_:{endingStart:pt,endingEnd:pt},intervalChanged_:function(e,t,n){var i=this.parameterPositions,r=e-2,a=e+1,o=i[r],s=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case gt:r=e,o=2*t-n;break;case mt:o=t+i[r=i.length-2]-i[r+1];break;default:r=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case gt:a=e,s=2*n-t;break;case mt:a=1,s=n+i[1]-i[0];break;default:a=e-1,s=t}var l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-n),this._offsetPrev=r*c,this._offsetNext=a*c},interpolate_:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,h=this._weightNext,f=(n-t)/(i-t),p=f*f,g=p*f,m=-d*g+2*d*p-d*f,v=(1+d)*g+(-1.5-2*d)*p+(-.5+d)*f+1,y=(-1-h)*g+(1.5+h)*p+.5*f,_=h*g-h*p,E=0;E!==o;++E)r[E]=m*a[c+E]+v*a[l+E]+y*a[s+E]+_*a[u+E];return r}}),po.prototype=Object.assign(Object.create(ho.prototype),{constructor:po,interpolate_:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=(n-t)/(i-t),u=1-c,d=0;d!==o;++d)r[d]=a[l+d]*u+a[s+d]*c;return r}}),go.prototype=Object.assign(Object.create(ho.prototype),{constructor:go,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(mo,{toJSON:function(e){var t,n=e.constructor;if(void 0!==n.toJSON)t=n.toJSON(e);else{t={name:e.name,times:uo.convertArray(e.times,Array),values:uo.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}),Object.assign(mo.prototype,{constructor:mo,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:ht,InterpolantFactoryMethodDiscrete:function(e){return new go(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new po(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new fo(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case dt:t=this.InterpolantFactoryMethodDiscrete;break;case ht:t=this.InterpolantFactoryMethodLinear;break;case ft:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return dt;case this.InterpolantFactoryMethodLinear:return ht;case this.InterpolantFactoryMethodSmooth:return ft}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]*=e;return this},trim:function(e,t){for(var n=this.times,i=n.length,r=0,a=i-1;r!==i&&n[r]<e;)++r;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==r||a!==i){r>=a&&(r=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=uo.arraySlice(n,r,a),this.values=uo.arraySlice(this.values,r*o,a*o)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==r;o++){var s=n[o];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==i&&uo.isTypedArray(i)){o=0;for(var l=i.length;o!==l;++o){var c=i[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),e=!1;break}}}return e},optimize:function(){for(var e=this.times,t=this.values,n=this.getValueSize(),i=this.getInterpolation()===ft,r=1,a=e.length-1,o=1;o<a;++o){var s=!1,l=e[o];if(l!==e[o+1]&&(1!==o||l!==l[0]))if(i)s=!0;else for(var c=o*n,u=c-n,d=c+n,h=0;h!==n;++h){var f=t[c+h];if(f!==t[u+h]||f!==t[d+h]){s=!0;break}}if(s){if(o!==r){e[r]=e[o];var p=o*n,g=r*n;for(h=0;h!==n;++h)t[g+h]=t[p+h]}++r}}if(a>0){e[r]=e[a];for(p=a*n,g=r*n,h=0;h!==n;++h)t[g+h]=t[p+h];++r}return r!==e.length&&(this.times=uo.arraySlice(e,0,r),this.values=uo.arraySlice(t,0,r*n)),this},clone:function(){var e=uo.arraySlice(this.times,0),t=uo.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}),vo.prototype=Object.assign(Object.create(mo.prototype),{constructor:vo,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:dt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),yo.prototype=Object.assign(Object.create(mo.prototype),{constructor:yo,ValueTypeName:"color"}),_o.prototype=Object.assign(Object.create(mo.prototype),{constructor:_o,ValueTypeName:"number"}),Eo.prototype=Object.assign(Object.create(ho.prototype),{constructor:Eo,interpolate_:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=(n-t)/(i-t),c=s+o;s!==c;s+=4)Et.slerpFlat(r,0,a,s-o,a,s,l);return r}}),bo.prototype=Object.assign(Object.create(mo.prototype),{constructor:bo,ValueTypeName:"quaternion",DefaultInterpolation:ht,InterpolantFactoryMethodLinear:function(e){return new Eo(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),To.prototype=Object.assign(Object.create(mo.prototype),{constructor:To,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:dt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),So.prototype=Object.assign(Object.create(mo.prototype),{constructor:So,ValueTypeName:"vector"}),Object.assign(wo,{parse:function(e){for(var t=[],n=e.tracks,i=1/(e.fps||1),r=0,a=n.length;r!==a;++r)t.push(Ao(n[r]).scale(i));return new wo(e.name,e.duration,t)},toJSON:function(e){for(var t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},r=0,a=n.length;r!==a;++r)t.push(mo.toJSON(n[r]));return i},CreateFromMorphTargetSequence:function(e,t,n,i){for(var r=t.length,a=[],o=0;o<r;o++){var s=[],l=[];s.push((o+r-1)%r,o,(o+1)%r),l.push(0,1,0);var c=uo.getKeyframeOrder(s);s=uo.sortedArray(s,1,c),l=uo.sortedArray(l,1,c),!i&&0===s[0]&&(s.push(r),l.push(l[0])),a.push(new _o(".morphTargetInfluences["+t[o].name+"]",s,l).scale(1/n))}return new wo(e,-1,a)},findByName:function(e,t){var n=e;if(!Array.isArray(e)){var i=e;n=i.geometry&&i.geometry.animations||i.animations}for(var r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){for(var i={},r=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],l=s.name.match(r);if(l&&l.length>1){var c=i[d=l[1]];c||(i[d]=c=[]),c.push(s)}}var u=[];for(var d in i)u.push(wo.CreateFromMorphTargetSequence(d,i[d],t,n));return u},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,i,r){if(0!==n.length){var a=[],o=[];uo.flattenJSON(n,a,o,i),0!==a.length&&r.push(new e(t,a,o))}},i=[],r=e.name||"default",a=e.length||-1,o=e.fps||30,s=e.hierarchy||[],l=0;l<s.length;l++){var c=s[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var u={},d=0;d<c.length;d++)if(c[d].morphTargets)for(var h=0;h<c[d].morphTargets.length;h++)u[c[d].morphTargets[h]]=-1;for(var f in u){var p=[],g=[];for(h=0;h!==c[d].morphTargets.length;++h){var m=c[d];p.push(m.time),g.push(m.morphTarget===f?1:0)}i.push(new _o(".morphTargetInfluence["+f+"]",p,g))}a=u.length*o}else{var v=".bones["+t[l].name+"]";n(So,v+".position",c,"pos",i),n(bo,v+".quaternion",c,"rot",i),n(So,v+".scale",c,"scl",i)}}return 0===i.length?null:new wo(r,a,i)}}),Object.assign(wo.prototype,{resetDuration:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new wo(this.name,this.duration,e)}});var Ro={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function xo(e,t,n){var i=this,r=!1,a=0,o=0,s=void 0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===r&&void 0!==i.onStart&&i.onStart(e,a,o),r=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,o),a===o&&(r=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this}}var Io=new xo,Lo={};function Mo(e){this.manager=void 0!==e?e:Io}function Co(e){this.manager=void 0!==e?e:Io}function Po(e){this.manager=void 0!==e?e:Io}function Do(e){this.manager=void 0!==e?e:Io}function Oo(){this.type="Curve",this.arcLengthDivisions=200}function No(e,t,n,i,r,a,o,s){Oo.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=i||1,this.aStartAngle=r||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}function ko(e,t,n,i,r,a){No.call(this,e,t,n,n,i,r,a),this.type="ArcCurve"}function Fo(){var e=0,t=0,n=0,i=0;function r(r,a,o,s){e=r,t=o,n=-3*r+3*a-2*o-s,i=2*r-2*a+o+s}return{initCatmullRom:function(e,t,n,i,a){r(t,n,a*(n-e),a*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,a,o,s){var l=(t-e)/a-(n-e)/(a+o)+(n-t)/o,c=(n-t)/o-(i-t)/(o+s)+(i-n)/s;r(t,n,l*=o,c*=o)},calc:function(r){var a=r*r;return e+t*r+n*a+i*(a*r)}}}Object.assign(Mo.prototype,{load:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,a=Ro.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a;if(void 0===Lo[e]){var o=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(o){var s=o[1],l=!!o[2],c=o[3];c=decodeURIComponent(c),l&&(c=atob(c));try{var u,d=(this.responseType||"").toLowerCase();switch(d){case"arraybuffer":case"blob":for(var h=new Uint8Array(c.length),f=0;f<c.length;f++)h[f]=c.charCodeAt(f);u="blob"===d?new Blob([h.buffer],{type:s}):h.buffer;break;case"document":var p=new DOMParser;u=p.parseFromString(c,s);break;case"json":u=JSON.parse(c);break;default:u=c}setTimeout(function(){t&&t(u),r.manager.itemEnd(e)},0)}catch(t){setTimeout(function(){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)},0)}}else{Lo[e]=[],Lo[e].push({onLoad:t,onProgress:n,onError:i});var g=new XMLHttpRequest;for(var m in g.open("GET",e,!0),g.addEventListener("load",function(t){var n=this.response;Ro.add(e,n);var i=Lo[e];if(delete Lo[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var a=0,o=i.length;a<o;a++){(s=i[a]).onLoad&&s.onLoad(n)}r.manager.itemEnd(e)}else{for(a=0,o=i.length;a<o;a++){var s;(s=i[a]).onError&&s.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}},!1),g.addEventListener("progress",function(t){for(var n=Lo[e],i=0,r=n.length;i<r;i++){var a=n[i];a.onProgress&&a.onProgress(t)}},!1),g.addEventListener("error",function(t){var n=Lo[e];delete Lo[e];for(var i=0,a=n.length;i<a;i++){var o=n[i];o.onError&&o.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),g.addEventListener("abort",function(t){var n=Lo[e];delete Lo[e];for(var i=0,a=n.length;i<a;i++){var o=n[i];o.onError&&o.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),void 0!==this.responseType&&(g.responseType=this.responseType),void 0!==this.withCredentials&&(g.withCredentials=this.withCredentials),g.overrideMimeType&&g.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)g.setRequestHeader(m,this.requestHeader[m]);g.send(null)}return r.manager.itemStart(e),g}Lo[e].push({onLoad:t,onProgress:n,onError:i})},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Object.assign(function(e){this.manager=void 0!==e?e:Io}.prototype,{load:function(e,t,n,i){var r=this,a=new Mo(r.manager);a.setPath(r.path),a.load(e,function(e){t(r.parse(JSON.parse(e)))},n,i)},parse:function(e){for(var t=[],n=0;n<e.length;n++){var i=wo.parse(e[n]);t.push(i)}return t},setPath:function(e){return this.path=e,this}}),Object.assign(function(e){this.manager=void 0!==e?e:Io,this._parser=null}.prototype,{load:function(e,t,n,i){var r=this,a=[],o=new Fr;o.image=a;var s=new Mo(this.manager);function l(l){s.load(e[l],function(e){var n=r._parser(e,!0);a[l]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(c+=1)&&(1===n.mipmapCount&&(o.minFilter=et),o.format=n.format,o.needsUpdate=!0,t&&t(o))},n,i)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(e))for(var c=0,u=0,d=e.length;u<d;++u)l(u);else s.load(e,function(e){var n=r._parser(e,!0);if(n.isCubemap)for(var i=n.mipmaps.length/n.mipmapCount,s=0;s<i;s++){a[s]={mipmaps:[]};for(var l=0;l<n.mipmapCount;l++)a[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+l]),a[s].format=n.format,a[s].width=n.width,a[s].height=n.height}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=et),o.format=n.format,o.needsUpdate=!0,t&&t(o)},n,i);return o},setPath:function(e){return this.path=e,this}}),Object.assign(function(e){this.manager=void 0!==e?e:Io,this._parser=null}.prototype,{load:function(e,t,n,i){var r=this,a=new Ct,o=new Mo(this.manager);return o.setResponseType("arraybuffer"),o.setPath(this.path),o.load(e,function(e){var n=r._parser(e);n&&(void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:Ke,a.wrapT=void 0!==n.wrapT?n.wrapT:Ke,a.magFilter=void 0!==n.magFilter?n.magFilter:et,a.minFilter=void 0!==n.minFilter?n.minFilter:tt,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps),1===n.mipmapCount&&(a.minFilter=et),a.needsUpdate=!0,t&&t(a,n))},n,i),a},setPath:function(e){return this.path=e,this}}),Object.assign(Co.prototype,{crossOrigin:"anonymous",load:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,a=Ro.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),Ro.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(e),o.src=e,o},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Po.prototype,{crossOrigin:"anonymous",load:function(e,t,n,i){var r=new kn,a=new Co(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(n){a.load(e[n],function(e){r.images[n]=e,6===++o&&(r.needsUpdate=!0,t&&t(r))},void 0,i)}for(var l=0;l<e.length;++l)s(l);return r},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Do.prototype,{crossOrigin:"anonymous",load:function(e,t,n,i){var r=new Rt,a=new Co(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(n){r.image=n;var i=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);r.format=i?st:lt,r.needsUpdate=!0,void 0!==t&&t(r)},n,i),r},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Oo.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n,i=[],r=this.getPoint(0),a=0;for(i.push(0),n=1;n<=e;n++)a+=(t=this.getPoint(n/e)).distanceTo(r),i.push(a),r=t;return this.cacheArcLengths=i,i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var n,i=this.getLengths(),r=0,a=i.length;n=t||e*i[a-1];for(var o,s=0,l=a-1;s<=l;)if((o=i[r=Math.floor(s+(l-s)/2)]-n)<0)s=r+1;else{if(!(o>0)){l=r;break}l=r-1}if(i[r=l]===n)return r/(a-1);var c=i[r];return(r+(n-c)/(i[r+1]-c))/(a-1)},getTangent:function(e){var t=1e-4,n=e-t,i=e+t;n<0&&(n=0),i>1&&(i=1);var r=this.getPoint(n);return this.getPoint(i).clone().sub(r).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var n,i,r,a=new bt,o=[],s=[],l=[],c=new bt,u=new kt;for(n=0;n<=e;n++)i=n/e,o[n]=this.getTangentAt(i),o[n].normalize();s[0]=new bt,l[0]=new bt;var d=Number.MAX_VALUE,h=Math.abs(o[0].x),f=Math.abs(o[0].y),p=Math.abs(o[0].z);for(h<=d&&(d=h,a.set(1,0,0)),f<=d&&(d=f,a.set(0,1,0)),p<=d&&a.set(0,0,1),c.crossVectors(o[0],a).normalize(),s[0].crossVectors(o[0],c),l[0].crossVectors(o[0],s[0]),n=1;n<=e;n++)s[n]=s[n-1].clone(),l[n]=l[n-1].clone(),c.crossVectors(o[n-1],o[n]),c.length()>Number.EPSILON&&(c.normalize(),r=Math.acos(yt.clamp(o[n-1].dot(o[n]),-1,1)),s[n].applyMatrix4(u.makeRotationAxis(c,r))),l[n].crossVectors(o[n],s[n]);if(!0===t)for(r=Math.acos(yt.clamp(s[0].dot(s[e]),-1,1)),r/=e,o[0].dot(c.crossVectors(s[0],s[e]))>0&&(r=-r),n=1;n<=e;n++)s[n].applyMatrix4(u.makeRotationAxis(o[n],r*n)),l[n].crossVectors(o[n],s[n]);return{tangents:o,normals:s,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),No.prototype=Object.create(Oo.prototype),No.prototype.constructor=No,No.prototype.isEllipseCurve=!0,No.prototype.getPoint=function(e,t){for(var n=t||new _t,i=2*Math.PI,r=this.aEndAngle-this.aStartAngle,a=Math.abs(r)<Number.EPSILON;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=a?0:i),!0===this.aClockwise&&!a&&(r===i?r=-i:r-=i);var o=this.aStartAngle+e*r,s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),d=s-this.aX,h=l-this.aY;s=d*c-h*u+this.aX,l=d*u+h*c+this.aY}return n.set(s,l)},No.prototype.copy=function(e){return Oo.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},No.prototype.toJSON=function(){var e=Oo.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},No.prototype.fromJSON=function(e){return Oo.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},ko.prototype=Object.create(No.prototype),ko.prototype.constructor=ko,ko.prototype.isArcCurve=!0;var Bo=new bt,Uo=new Fo,Vo=new Fo,Go=new Fo;function Ho(e,t,n,i){Oo.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=n||"centripetal",this.tension=i||.5}function jo(e,t,n,i,r){var a=.5*(i-t),o=.5*(r-n),s=e*e;return(2*n-2*i+a+o)*(e*s)+(-3*n+3*i-2*a-o)*s+a*e+n}function zo(e,t,n,i){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function Zo(e,t,n,i,r){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}function qo(e,t,n,i){Oo.call(this),this.type="CubicBezierCurve",this.v0=e||new _t,this.v1=t||new _t,this.v2=n||new _t,this.v3=i||new _t}function Wo(e,t,n,i){Oo.call(this),this.type="CubicBezierCurve3",this.v0=e||new bt,this.v1=t||new bt,this.v2=n||new bt,this.v3=i||new bt}function Yo(e,t){Oo.call(this),this.type="LineCurve",this.v1=e||new _t,this.v2=t||new _t}function Ko(e,t){Oo.call(this),this.type="LineCurve3",this.v1=e||new bt,this.v2=t||new bt}function Xo(e,t,n){Oo.call(this),this.type="QuadraticBezierCurve",this.v0=e||new _t,this.v1=t||new _t,this.v2=n||new _t}function Qo(e,t,n){Oo.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new bt,this.v1=t||new bt,this.v2=n||new bt}function Jo(e){Oo.call(this),this.type="SplineCurve",this.points=e||[]}Ho.prototype=Object.create(Oo.prototype),Ho.prototype.constructor=Ho,Ho.prototype.isCatmullRomCurve3=!0,Ho.prototype.getPoint=function(e,t){var n,i,r,a,o=t||new bt,s=this.points,l=s.length,c=(l-(this.closed?0:1))*e,u=Math.floor(c),d=c-u;if(this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/l)+1)*l:0===d&&u===l-1&&(u=l-2,d=1),this.closed||u>0?n=s[(u-1)%l]:(Bo.subVectors(s[0],s[1]).add(s[0]),n=Bo),i=s[u%l],r=s[(u+1)%l],this.closed||u+2<l?a=s[(u+2)%l]:(Bo.subVectors(s[l-1],s[l-2]).add(s[l-1]),a=Bo),"centripetal"===this.curveType||"chordal"===this.curveType){var h="chordal"===this.curveType?.5:.25,f=Math.pow(n.distanceToSquared(i),h),p=Math.pow(i.distanceToSquared(r),h),g=Math.pow(r.distanceToSquared(a),h);p<1e-4&&(p=1),f<1e-4&&(f=p),g<1e-4&&(g=p),Uo.initNonuniformCatmullRom(n.x,i.x,r.x,a.x,f,p,g),Vo.initNonuniformCatmullRom(n.y,i.y,r.y,a.y,f,p,g),Go.initNonuniformCatmullRom(n.z,i.z,r.z,a.z,f,p,g)}else"catmullrom"===this.curveType&&(Uo.initCatmullRom(n.x,i.x,r.x,a.x,this.tension),Vo.initCatmullRom(n.y,i.y,r.y,a.y,this.tension),Go.initCatmullRom(n.z,i.z,r.z,a.z,this.tension));return o.set(Uo.calc(d),Vo.calc(d),Go.calc(d)),o},Ho.prototype.copy=function(e){Oo.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Ho.prototype.toJSON=function(){var e=Oo.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},Ho.prototype.fromJSON=function(e){Oo.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push((new bt).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},qo.prototype=Object.create(Oo.prototype),qo.prototype.constructor=qo,qo.prototype.isCubicBezierCurve=!0,qo.prototype.getPoint=function(e,t){var n=t||new _t,i=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(Zo(e,i.x,r.x,a.x,o.x),Zo(e,i.y,r.y,a.y,o.y)),n},qo.prototype.copy=function(e){return Oo.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},qo.prototype.toJSON=function(){var e=Oo.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},qo.prototype.fromJSON=function(e){return Oo.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Wo.prototype=Object.create(Oo.prototype),Wo.prototype.constructor=Wo,Wo.prototype.isCubicBezierCurve3=!0,Wo.prototype.getPoint=function(e,t){var n=t||new bt,i=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(Zo(e,i.x,r.x,a.x,o.x),Zo(e,i.y,r.y,a.y,o.y),Zo(e,i.z,r.z,a.z,o.z)),n},Wo.prototype.copy=function(e){return Oo.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Wo.prototype.toJSON=function(){var e=Oo.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Wo.prototype.fromJSON=function(e){return Oo.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Yo.prototype=Object.create(Oo.prototype),Yo.prototype.constructor=Yo,Yo.prototype.isLineCurve=!0,Yo.prototype.getPoint=function(e,t){var n=t||new _t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Yo.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Yo.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Yo.prototype.copy=function(e){return Oo.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Yo.prototype.toJSON=function(){var e=Oo.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Yo.prototype.fromJSON=function(e){return Oo.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Ko.prototype=Object.create(Oo.prototype),Ko.prototype.constructor=Ko,Ko.prototype.isLineCurve3=!0,Ko.prototype.getPoint=function(e,t){var n=t||new bt;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Ko.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Ko.prototype.copy=function(e){return Oo.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Ko.prototype.toJSON=function(){var e=Oo.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Ko.prototype.fromJSON=function(e){return Oo.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Xo.prototype=Object.create(Oo.prototype),Xo.prototype.constructor=Xo,Xo.prototype.isQuadraticBezierCurve=!0,Xo.prototype.getPoint=function(e,t){var n=t||new _t,i=this.v0,r=this.v1,a=this.v2;return n.set(zo(e,i.x,r.x,a.x),zo(e,i.y,r.y,a.y)),n},Xo.prototype.copy=function(e){return Oo.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Xo.prototype.toJSON=function(){var e=Oo.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Xo.prototype.fromJSON=function(e){return Oo.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Qo.prototype=Object.create(Oo.prototype),Qo.prototype.constructor=Qo,Qo.prototype.isQuadraticBezierCurve3=!0,Qo.prototype.getPoint=function(e,t){var n=t||new bt,i=this.v0,r=this.v1,a=this.v2;return n.set(zo(e,i.x,r.x,a.x),zo(e,i.y,r.y,a.y),zo(e,i.z,r.z,a.z)),n},Qo.prototype.copy=function(e){return Oo.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Qo.prototype.toJSON=function(){var e=Oo.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Qo.prototype.fromJSON=function(e){return Oo.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Jo.prototype=Object.create(Oo.prototype),Jo.prototype.constructor=Jo,Jo.prototype.isSplineCurve=!0,Jo.prototype.getPoint=function(e,t){var n=t||new _t,i=this.points,r=(i.length-1)*e,a=Math.floor(r),o=r-a,s=i[0===a?a:a-1],l=i[a],c=i[a>i.length-2?i.length-1:a+1],u=i[a>i.length-3?i.length-1:a+2];return n.set(jo(o,s.x,l.x,c.x,u.x),jo(o,s.y,l.y,c.y,u.y)),n},Jo.prototype.copy=function(e){Oo.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push(i.clone())}return this},Jo.prototype.toJSON=function(){var e=Oo.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var i=this.points[t];e.points.push(i.toArray())}return e},Jo.prototype.fromJSON=function(e){Oo.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push((new _t).fromArray(i))}return this};var $o=Object.freeze({ArcCurve:ko,CatmullRomCurve3:Ho,CubicBezierCurve:qo,CubicBezierCurve3:Wo,EllipseCurve:No,LineCurve:Yo,LineCurve3:Ko,QuadraticBezierCurve:Xo,QuadraticBezierCurve3:Qo,SplineCurve:Jo});function es(){Oo.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function ts(e){es.call(this),this.type="Path",this.currentPoint=new _t,e&&this.setFromPoints(e)}function ns(e){ts.call(this,e),this.uuid=yt.generateUUID(),this.type="Shape",this.holes=[]}function is(e,t){Xt.call(this),this.type="Light",this.color=new Gt(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function rs(e,t,n){is.call(this,e,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Xt.DefaultUp),this.updateMatrix(),this.groundColor=new Gt(t)}function as(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new _t(512,512),this.map=null,this.matrix=new kt}function os(){as.call(this,new ur(50,1,.5,500))}function ss(e,t,n,i,r,a){is.call(this,e,t),this.type="SpotLight",this.position.copy(Xt.DefaultUp),this.updateMatrix(),this.target=new Xt,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==i?i:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==a?a:1,this.shadow=new os}function ls(e,t,n,i){is.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==i?i:1,this.shadow=new as(new ur(90,1,.5,500))}function cs(e,t,n,i,r,a){cr.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==n?n:1,this.bottom=void 0!==i?i:-1,this.near=void 0!==r?r:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function us(){as.call(this,new cs(-5,5,5,-5,.5,500))}function ds(e,t){is.call(this,e,t),this.type="DirectionalLight",this.position.copy(Xt.DefaultUp),this.updateMatrix(),this.target=new Xt,this.shadow=new us}function hs(e,t){is.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function fs(e,t,n,i){is.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==i?i:10}function ps(e){this.manager=void 0!==e?e:Io,this.textures={}}es.prototype=Object.assign(Object.create(Oo.prototype),{constructor:es,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Yo(t,e))},getPoint:function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),i=0;i<n.length;){if(n[i]>=t){var r=n[i]-t,a=this.curves[i],o=a.getLength(),s=0===o?0:1-r/o;return a.getPointAt(s)}i++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,n=[],i=0,r=this.curves;i<r.length;i++)for(var a=r[i],o=a&&a.isEllipseCurve?2*e:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e,s=a.getPoints(o),l=0;l<s.length;l++){var c=s[l];t&&t.equals(c)||(n.push(c),t=c)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(e){Oo.prototype.copy.call(this,e),this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Oo.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,n=this.curves.length;t<n;t++){var i=this.curves[t];e.curves.push(i.toJSON())}return e},fromJSON:function(e){Oo.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var i=e.curves[t];this.curves.push((new $o[i.type]).fromJSON(i))}return this}}),ts.prototype=Object.assign(Object.create(es.prototype),{constructor:ts,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var n=new Yo(this.currentPoint.clone(),new _t(e,t));this.curves.push(n),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,n,i){var r=new Xo(this.currentPoint.clone(),new _t(e,t),new _t(n,i));this.curves.push(r),this.currentPoint.set(n,i)},bezierCurveTo:function(e,t,n,i,r,a){var o=new qo(this.currentPoint.clone(),new _t(e,t),new _t(n,i),new _t(r,a));this.curves.push(o),this.currentPoint.set(r,a)},splineThru:function(e){var t=new Jo([this.currentPoint.clone()].concat(e));this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,n,i,r,a){var o=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+o,t+s,n,i,r,a)},absarc:function(e,t,n,i,r,a){this.absellipse(e,t,n,n,i,r,a)},ellipse:function(e,t,n,i,r,a,o,s){var l=this.currentPoint.x,c=this.currentPoint.y;this.absellipse(e+l,t+c,n,i,r,a,o,s)},absellipse:function(e,t,n,i,r,a,o,s){var l=new No(e,t,n,i,r,a,o,s);if(this.curves.length>0){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var u=l.getPoint(1);this.currentPoint.copy(u)},copy:function(e){return es.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=es.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return es.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),ns.prototype=Object.assign(Object.create(ts.prototype),{constructor:ns,getPointsHoles:function(e){for(var t=[],n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){ts.prototype.copy.call(this,e),this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var i=e.holes[t];this.holes.push(i.clone())}return this},toJSON:function(){var e=ts.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,n=this.holes.length;t<n;t++){var i=this.holes[t];e.holes.push(i.toJSON())}return e},fromJSON:function(e){ts.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var i=e.holes[t];this.holes.push((new ts).fromJSON(i))}return this}}),is.prototype=Object.assign(Object.create(Xt.prototype),{constructor:is,isLight:!0,copy:function(e){return Xt.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=Xt.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),rs.prototype=Object.assign(Object.create(is.prototype),{constructor:rs,isHemisphereLight:!0,copy:function(e){return is.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(as.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),os.prototype=Object.assign(Object.create(as.prototype),{constructor:os,isSpotLightShadow:!0,update:function(e){var t=this.camera,n=2*yt.RAD2DEG*e.angle,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(n!==t.fov||i!==t.aspect||r!==t.far)&&(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix())}}),ss.prototype=Object.assign(Object.create(is.prototype),{constructor:ss,isSpotLight:!0,copy:function(e){return is.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),ls.prototype=Object.assign(Object.create(is.prototype),{constructor:ls,isPointLight:!0,copy:function(e){return is.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),cs.prototype=Object.assign(Object.create(cr.prototype),{constructor:cs,isOrthographicCamera:!0,copy:function(e,t){return cr.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,i,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=n-e,a=n+e,o=i+t,s=i-t;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),c=this.zoom/(this.view.height/this.view.fullHeight),u=(this.right-this.left)/this.view.width,d=(this.top-this.bottom)/this.view.height;a=(r+=u*(this.view.offsetX/l))+u*(this.view.width/l),s=(o-=d*(this.view.offsetY/c))-d*(this.view.height/c)}this.projectionMatrix.makeOrthographic(r,a,o,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Xt.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),us.prototype=Object.assign(Object.create(as.prototype),{constructor:us}),ds.prototype=Object.assign(Object.create(is.prototype),{constructor:ds,isDirectionalLight:!0,copy:function(e){return is.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),hs.prototype=Object.assign(Object.create(is.prototype),{constructor:hs,isAmbientLight:!0}),fs.prototype=Object.assign(Object.create(is.prototype),{constructor:fs,isRectAreaLight:!0,copy:function(e){return is.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=is.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),Object.assign(ps.prototype,{load:function(e,t,n,i){var r=this,a=new Mo(r.manager);a.setPath(r.path),a.load(e,function(e){t(r.parse(JSON.parse(e)))},n,i)},parse:function(e){var t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var i=new co[e.type];if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&i.specular.setHex(e.specular),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearCoat&&(i.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(i.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.vertexColors&&(i.vertexColors=e.vertexColors),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),1!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(i.skinning=e.skinning),void 0!==e.morphTargets&&(i.morphTargets=e.morphTargets),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.uniforms)for(var r in e.uniforms){var a=e.uniforms[r];switch(i.uniforms[r]={},a.type){case"t":i.uniforms[r].value=n(a.value);break;case"c":i.uniforms[r].value=(new Gt).setHex(a.value);break;case"v2":i.uniforms[r].value=(new _t).fromArray(a.value);break;case"v3":i.uniforms[r].value=(new bt).fromArray(a.value);break;case"v4":i.uniforms[r].value=(new xt).fromArray(a.value);break;case"m3":i.uniforms[r].value=(new Tt).fromArray(a.value);case"m4":i.uniforms[r].value=(new kt).fromArray(a.value);break;default:i.uniforms[r].value=a.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var o in e.extensions)i.extensions[o]=e.extensions[o];if(void 0!==e.shading&&(i.flatShading=1===e.shading),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=n(e.map)),void 0!==e.matcap&&(i.matcap=n(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=n(e.alphaMap),i.transparent=!0),void 0!==e.bumpMap&&(i.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){var s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),i.normalScale=(new _t).fromArray(s)}return void 0!==e.displacementMap&&(i.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=n(e.specularMap)),void 0!==e.envMap&&(i.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.lightMap&&(i.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=n(e.gradientMap)),i},setPath:function(e){return this.path=e,this},setTextures:function(e){return this.textures=e,this}});var gs=function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)};function ms(){fn.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function vs(e,t,n,i){"number"==typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),$t.call(this,e,t,n),this.meshPerAttribute=i||1}function ys(e){this.manager=void 0!==e?e:Io}ms.prototype=Object.assign(Object.create(fn.prototype),{constructor:ms,isInstancedBufferGeometry:!0,copy:function(e){return fn.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=fn.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}}),vs.prototype=Object.assign(Object.create($t.prototype),{constructor:vs,isInstancedBufferAttribute:!0,copy:function(e){return $t.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=$t.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),Object.assign(ys.prototype,{load:function(e,t,n,i){var r=this,a=new Mo(r.manager);a.setPath(r.path),a.load(e,function(e){t(r.parse(JSON.parse(e)))},n,i)},parse:function(e){var t=e.isInstancedBufferGeometry?new ms:new fn,n=e.data.index;if(void 0!==n){var i=new _s[n.type](n.array);t.setIndex(new $t(i,1))}var r=e.data.attributes;for(var a in r){var o=r[a],s=(i=new _s[o.type](o.array),new(o.isInstancedBufferAttribute?vs:$t)(i,o.itemSize,o.normalized));void 0!==o.name&&(s.name=o.name),t.addAttribute(a,s)}var l=e.data.morphAttributes;if(l)for(var a in l){for(var c=l[a],u=[],d=0,h=c.length;d<h;d++){o=c[d],s=new $t(i=new _s[o.type](o.array),o.itemSize,o.normalized);void 0!==o.name&&(s.name=o.name),u.push(s)}t.morphAttributes[a]=u}var f=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==f){d=0;for(var p=f.length;d!==p;++d){var g=f[d];t.addGroup(g.start,g.count,g.materialIndex)}}var m=e.data.boundingSphere;if(void 0!==m){var v=new bt;void 0!==m.center&&v.fromArray(m.center),t.boundingSphere=new Dt(v,m.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t},setPath:function(e){return this.path=e,this}});var _s={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:typeof Uint8ClampedArray<"u"?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Es(e){this.manager=void 0!==e?e:Io,this.resourcePath=""}Object.assign(Es.prototype,{crossOrigin:"anonymous",load:function(e,t,n,i){var r=this,a=void 0===this.path?gs(e):this.path;this.resourcePath=this.resourcePath||a;var o=new Mo(r.manager);o.setPath(this.path),o.load(e,function(n){var a=null;try{a=JSON.parse(n)}catch(t){return void 0!==i&&i(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var o=a.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?r.parse(a,t):console.error("THREE.ObjectLoader: Can't load "+e)},n,i)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){var n=this.parseShape(e.shapes),i=this.parseGeometries(e.geometries,n),r=this.parseImages(e.images,function(){void 0!==t&&t(s)}),a=this.parseTextures(e.textures,r),o=this.parseMaterials(e.materials,a),s=this.parseObject(e.object,i,o);return e.animations&&(s.animations=this.parseAnimations(e.animations)),(void 0===e.images||0===e.images.length)&&void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var n=0,i=e.length;n<i;n++){var r=(new ns).fromJSON(e[n]);t[r.uuid]=r}return t},parseGeometries:function(e,t){var n={};if(void 0!==e)for(var i=new ys,r=0,a=e.length;r<a;r++){var o,s=e[r];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new Ja[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":o=new Ja[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new Ja[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new Ja[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new Ja[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new Ja[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new Ja[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new Ja[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new Ja[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new Ja[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new Ja[s.type]((new $o[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new Ja[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new Ja[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var l=[],c=0,u=s.shapes.length;c<u;c++){var d=t[s.shapes[c]];l.push(d)}o=new Ja[s.type](l,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(l=[],c=0,u=s.shapes.length;c<u;c++){d=t[s.shapes[c]];l.push(d)}var h=s.options.extrudePath;void 0!==h&&(s.options.extrudePath=(new $o[h.type]).fromJSON(h)),o=new Ja[s.type](l,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":o=i.parse(s);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE)o=(new THREE.LegacyJSONLoader).parse(s,this.resourcePath).geometry;else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),!0===o.isBufferGeometry&&void 0!==s.userData&&(o.userData=s.userData),n[s.uuid]=o}return n},parseMaterials:function(e,t){var n={},i={};if(void 0!==e){var r=new ps;r.setTextures(t);for(var a=0,o=e.length;a<o;a++){var s=e[a];if("MultiMaterial"===s.type){for(var l=[],c=0;c<s.materials.length;c++){var u=s.materials[c];void 0===n[u.uuid]&&(n[u.uuid]=r.parse(u)),l.push(n[u.uuid])}i[s.uuid]=l}else void 0===n[s.uuid]&&(n[s.uuid]=r.parse(s)),i[s.uuid]=n[s.uuid]}}return i},parseAnimations:function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],r=wo.parse(i);void 0!==i.uuid&&(r.uuid=i.uuid),t.push(r)}return t},parseImages:function(e,t){var n=this,i={};function r(e){return n.manager.itemStart(e),a.load(e,function(){n.manager.itemEnd(e)},void 0,function(){n.manager.itemError(e),n.manager.itemEnd(e)})}if(void 0!==e&&e.length>0){var a=new Co(new xo(t));a.setCrossOrigin(this.crossOrigin);for(var o=0,s=e.length;o<s;o++){var l=e[o],c=l.url;if(Array.isArray(c)){i[l.uuid]=[];for(var u=0,d=c.length;u<d;u++){var h=c[u],f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h)?h:n.resourcePath+h;i[l.uuid].push(r(f))}}else{f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:n.resourcePath+l.url;i[l.uuid]=r(f)}}}return i},parseTextures:function(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var i={};if(void 0!==e)for(var r=0,a=e.length;r<a;r++){var o,s=e[r];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(o=Array.isArray(t[s.image])?new kn(t[s.image]):new Rt(t[s.image])).needsUpdate=!0,o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.mapping&&(o.mapping=n(s.mapping,bs)),void 0!==s.offset&&o.offset.fromArray(s.offset),void 0!==s.repeat&&o.repeat.fromArray(s.repeat),void 0!==s.center&&o.center.fromArray(s.center),void 0!==s.rotation&&(o.rotation=s.rotation),void 0!==s.wrap&&(o.wrapS=n(s.wrap[0],Ts),o.wrapT=n(s.wrap[1],Ts)),void 0!==s.format&&(o.format=s.format),void 0!==s.type&&(o.type=s.type),void 0!==s.encoding&&(o.encoding=s.encoding),void 0!==s.minFilter&&(o.minFilter=n(s.minFilter,Ss)),void 0!==s.magFilter&&(o.magFilter=n(s.magFilter,Ss)),void 0!==s.anisotropy&&(o.anisotropy=s.anisotropy),void 0!==s.flipY&&(o.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(o.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(o.unpackAlignment=s.unpackAlignment),i[s.uuid]=o}return i},parseObject:function(e,t,n){var i;function r(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function a(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],i=0,r=e.length;i<r;i++){var a=e[i];void 0===n[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),t.push(n[a])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}switch(e.type){case"Scene":i=new br,void 0!==e.background&&Number.isInteger(e.background)&&(i.background=new Gt(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?i.fog=new Er(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new _r(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":i=new ur(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(i.focus=e.focus),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.filmGauge&&(i.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(i.filmOffset=e.filmOffset),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new cs(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new hs(e.color,e.intensity);break;case"DirectionalLight":i=new ds(e.color,e.intensity);break;case"PointLight":i=new ls(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new fs(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new ss(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":i=new rs(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var o=r(e.geometry),s=a(e.material);i=o.bones&&o.bones.length>0?new xr(o,s):new wn(o,s),void 0!==e.drawMode&&i.setDrawMode(e.drawMode);break;case"LOD":i=new Rr;break;case"Line":i=new Cr(r(e.geometry),a(e.material),e.mode);break;case"LineLoop":i=new Dr(r(e.geometry),a(e.material));break;case"LineSegments":i=new Pr(r(e.geometry),a(e.material));break;case"PointCloud":case"Points":i=new Nr(r(e.geometry),a(e.material));break;case"Sprite":i=new Ar(a(e.material));break;case"Group":i=new lr;break;default:i=new Xt}if(i.uuid=e.uuid,void 0!==e.name&&(i.name=e.name),void 0!==e.matrix?(i.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.quaternion&&i.quaternion.fromArray(e.quaternion),void 0!==e.scale&&i.scale.fromArray(e.scale)),void 0!==e.castShadow&&(i.castShadow=e.castShadow),void 0!==e.receiveShadow&&(i.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(i.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(i.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&i.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(i.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.frustumCulled&&(i.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(i.renderOrder=e.renderOrder),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.layers&&(i.layers.mask=e.layers),void 0!==e.children)for(var l=e.children,c=0;c<l.length;c++)i.add(this.parseObject(l[c],t,n));if("LOD"===e.type)for(var u=e.levels,d=0;d<u.length;d++){var h=u[d],f=i.getObjectByProperty("uuid",h.object);void 0!==f&&i.addLevel(f,h.distance)}return i}});var bs={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Ts={RepeatWrapping:Ye,ClampToEdgeWrapping:Ke,MirroredRepeatWrapping:Xe},Ss={NearestFilter:Qe,NearestMipMapNearestFilter:Je,NearestMipMapLinearFilter:$e,LinearFilter:et,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:tt};function ws(e){typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==e?e:Io,this.options=void 0}function As(){this.type="ShapePath",this.color=new Gt,this.subPaths=[],this.currentPath=null}function Rs(e){this.type="Font",this.data=e}function xs(e,t,n,i,r){var a=r.glyphs[e]||r.glyphs["?"];if(a){var o,s,l,c,u,d,h,f,p=new As;if(a.o)for(var g=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),m=0,v=g.length;m<v;){switch(g[m++]){case"m":o=g[m++]*t+n,s=g[m++]*t+i,p.moveTo(o,s);break;case"l":o=g[m++]*t+n,s=g[m++]*t+i,p.lineTo(o,s);break;case"q":l=g[m++]*t+n,c=g[m++]*t+i,u=g[m++]*t+n,d=g[m++]*t+i,p.quadraticCurveTo(u,d,l,c);break;case"b":l=g[m++]*t+n,c=g[m++]*t+i,u=g[m++]*t+n,d=g[m++]*t+i,h=g[m++]*t+n,f=g[m++]*t+i,p.bezierCurveTo(u,d,h,f,l,c)}}return{offsetX:a.ha*t,path:p}}}function Is(){}ws.prototype={constructor:ws,setOptions:function(e){return this.options=e,this},load:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,a=Ro.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a;fetch(e).then(function(e){return e.blob()}).then(function(e){return void 0===r.options?createImageBitmap(e):createImageBitmap(e,r.options)}).then(function(n){Ro.add(e,n),t&&t(n),r.manager.itemEnd(e)}).catch(function(t){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}),r.manager.itemStart(e)},setCrossOrigin:function(){return this},setPath:function(e){return this.path=e,this}},Object.assign(As.prototype,{moveTo:function(e,t){this.currentPath=new ts,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,n,i){this.currentPath.quadraticCurveTo(e,t,n,i)},bezierCurveTo:function(e,t,n,i,r,a){this.currentPath.bezierCurveTo(e,t,n,i,r,a)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function n(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n],a=new ns;a.curves=r.curves,t.push(a)}return t}function i(e,t){for(var n=t.length,i=!1,r=n-1,a=0;a<n;r=a++){var o=t[r],s=t[a],l=s.x-o.x,c=s.y-o.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(o=t[a],l=-l,s=t[r],c=-c),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var u=c*(e.x-o.x)-l*(e.y-o.y);if(0===u)return!0;if(u<0)continue;i=!i}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return i}var r=xa.isClockWise,a=this.subPaths;if(0===a.length)return[];if(!0===t)return n(a);var o,s,l,c=[];if(1===a.length)return s=a[0],(l=new ns).curves=s.curves,c.push(l),c;var u=!r(a[0].getPoints());u=e?!u:u;var d,h=[],f=[],p=[],g=0;f[g]=void 0,p[g]=[];for(var m=0,v=a.length;m<v;m++)o=r(d=(s=a[m]).getPoints()),(o=e?!o:o)?(!u&&f[g]&&g++,f[g]={s:new ns,p:d},f[g].s.curves=s.curves,u&&g++,p[g]=[]):p[g].push({h:s,p:d[0]});if(!f[0])return n(a);if(f.length>1){for(var y=!1,_=[],E=0,b=f.length;E<b;E++)h[E]=[];for(E=0,b=f.length;E<b;E++)for(var T=p[E],S=0;S<T.length;S++){for(var w=T[S],A=!0,R=0;R<f.length;R++)i(w.p,f[R].p)&&(E!==R&&_.push({froms:E,tos:R,hole:S}),A?(A=!1,h[R].push(w)):y=!0);A&&h[E].push(w)}_.length>0&&(y||(p=h))}m=0;for(var x,I=f.length;m<I;m++){l=f[m].s,c.push(l);for(var L=0,M=(x=p[m]).length;L<M;L++)l.holes.push(x[L].h)}return c}}),Object.assign(Rs.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var n=[],i=function(e,t,n){for(var i=Array.from?Array.from(e):String(e).split(""),r=t/n.resolution,a=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,o=[],s=0,l=0,c=0;c<i.length;c++){var u=i[c];if("\n"===u)s=0,l-=a;else{var d=xs(u,r,s,l,n);s+=d.offsetX,o.push(d.path)}}return o}(e,t,this.data),r=0,a=i.length;r<a;r++)Array.prototype.push.apply(n,i[r].toShapes());return n}}),Object.assign(function(e){this.manager=void 0!==e?e:Io}.prototype,{load:function(e,t,n,i){var r=this,a=new Mo(this.manager);a.setPath(this.path),a.load(e,function(e){var n;try{n=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}var i=r.parse(n);t&&t(i)},n,i)},parse:function(e){return new Rs(e)},setPath:function(e){return this.path=e,this}}),Is.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,n=0,i=t.length;n<i;n+=2){var r=t[n],a=t[n+1];if(r.test(e))return a}return null}},Object.assign(Is.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(e,t,n){for(var i=[],r=0;r<e.length;++r)i[r]=this.createMaterial(e[r],t,n);return i},createMaterial:function(){var e={NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},t=new Gt,n=new Do,i=new ps;return function(r,a,o){var s={};function l(e,t,i,r,l){var c,u=a+e,d=Is.Handlers.get(u);null!==d?c=d.load(u):(n.setCrossOrigin(o),c=n.load(u)),void 0!==t&&(c.repeat.fromArray(t),1!==t[0]&&(c.wrapS=Ye),1!==t[1]&&(c.wrapT=Ye)),void 0!==i&&c.offset.fromArray(i),void 0!==r&&("repeat"===r[0]&&(c.wrapS=Ye),"mirror"===r[0]&&(c.wrapS=Xe),"repeat"===r[1]&&(c.wrapT=Ye),"mirror"===r[1]&&(c.wrapT=Xe)),void 0!==l&&(c.anisotropy=l);var h=yt.generateUUID();return s[h]=c,h}var c={uuid:yt.generateUUID(),type:"MeshLambertMaterial"};for(var u in r){var d=r[u];switch(u){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"DbgName":c.name=d;break;case"blending":c.blending=e[d];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",u,"is no longer supported.");break;case"colorDiffuse":c.color=t.fromArray(d).getHex();break;case"colorSpecular":c.specular=t.fromArray(d).getHex();break;case"colorEmissive":c.emissive=t.fromArray(d).getHex();break;case"specularCoef":c.shininess=d;break;case"shading":"basic"===d.toLowerCase()&&(c.type="MeshBasicMaterial"),"phong"===d.toLowerCase()&&(c.type="MeshPhongMaterial"),"standard"===d.toLowerCase()&&(c.type="MeshStandardMaterial");break;case"mapDiffuse":c.map=l(d,r.mapDiffuseRepeat,r.mapDiffuseOffset,r.mapDiffuseWrap,r.mapDiffuseAnisotropy);break;case"mapEmissive":c.emissiveMap=l(d,r.mapEmissiveRepeat,r.mapEmissiveOffset,r.mapEmissiveWrap,r.mapEmissiveAnisotropy);break;case"mapLight":c.lightMap=l(d,r.mapLightRepeat,r.mapLightOffset,r.mapLightWrap,r.mapLightAnisotropy);break;case"mapAO":c.aoMap=l(d,r.mapAORepeat,r.mapAOOffset,r.mapAOWrap,r.mapAOAnisotropy);break;case"mapBump":c.bumpMap=l(d,r.mapBumpRepeat,r.mapBumpOffset,r.mapBumpWrap,r.mapBumpAnisotropy);break;case"mapBumpScale":c.bumpScale=d;break;case"mapNormal":c.normalMap=l(d,r.mapNormalRepeat,r.mapNormalOffset,r.mapNormalWrap,r.mapNormalAnisotropy);break;case"mapNormalFactor":c.normalScale=d;break;case"mapSpecular":c.specularMap=l(d,r.mapSpecularRepeat,r.mapSpecularOffset,r.mapSpecularWrap,r.mapSpecularAnisotropy);break;case"mapMetalness":c.metalnessMap=l(d,r.mapMetalnessRepeat,r.mapMetalnessOffset,r.mapMetalnessWrap,r.mapMetalnessAnisotropy);break;case"mapRoughness":c.roughnessMap=l(d,r.mapRoughnessRepeat,r.mapRoughnessOffset,r.mapRoughnessWrap,r.mapRoughnessAnisotropy);break;case"mapAlpha":c.alphaMap=l(d,r.mapAlphaRepeat,r.mapAlphaOffset,r.mapAlphaWrap,r.mapAlphaAnisotropy);break;case"flipSided":c.side=1;break;case"doubleSided":c.side=2;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),c.opacity=d;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":c[u]=d;break;case"vertexColors":!0===d&&(c.vertexColors=2),"face"===d&&(c.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",u,d)}}return"MeshBasicMaterial"===c.type&&delete c.emissive,"MeshPhongMaterial"!==c.type&&delete c.specular,c.opacity<1&&(c.transparent=!0),i.setTextures(s),i.parse(c)}}()});var Ls,Ms=function(){return void 0===Ls&&(Ls=new(window.AudioContext||window.webkitAudioContext)),Ls};function Cs(e){this.manager=void 0!==e?e:Io}function Ps(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new bt)}function Ds(e,t){is.call(this,void 0,t),this.sh=void 0!==e?e:new Ps}function Os(e,t,n){Ds.call(this,void 0,n);var i=(new Gt).set(e),r=(new Gt).set(t),a=new bt(i.r,i.g,i.b),o=new bt(r.r,r.g,r.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(s),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(l)}function Ns(e,t){Ds.call(this,void 0,t);var n=(new Gt).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}function ks(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ur,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ur,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}Object.assign(Cs.prototype,{load:function(e,t,n,i){var r=new Mo(this.manager);r.setResponseType("arraybuffer"),r.setPath(this.path),r.load(e,function(e){var n=e.slice(0);Ms().decodeAudioData(n,function(e){t(e)})},n,i)},setPath:function(e){return this.path=e,this}}),Object.assign(Ps.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var n=e.x,i=e.y,r=e.z,a=this.coefficients;return t=.282095*a[0],t+=.488603*a[1]*i,t+=.488603*a[2]*r,t+=.488603*a[3]*n,t+=1.092548*a[4]*(n*i),t+=1.092548*a[5]*(i*r),t+=.315392*a[6]*(3*r*r-1),t+=1.092548*a[7]*(n*r),t+=.546274*a[8]*(n*n-i*i)},getIrradianceAt:function(e,t){var n=e.x,i=e.y,r=e.z,a=this.coefficients;return t=.886227*a[0],t+=2*a[1]*.511664*i,t+=2*a[2]*.511664*r,t+=2*a[3]*.511664*n,t+=2*a[4]*.429043*n*i,t+=2*a[5]*.429043*i*r,t+=a[6]*(.743125*r*r-.247708),t+=2*a[7]*.429043*n*r,t+=.429043*a[8]*(n*n-i*i)},add:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},scale:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this},equals:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(e){for(var t=this.coefficients,n=0;n<9;n++)t[n].fromArray(e,3*n);return this},toArray:function(){for(var e=[],t=this.coefficients,n=0;n<9;n++)t[n].toArray(e,3*n);return e}}),Object.assign(Ps,{getBasisAt:function(e,t){var n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}),Ds.prototype=Object.assign(Object.create(is.prototype),{constructor:Ds,isLightProbe:!0,copy:function(e){return is.prototype.copy.call(this,e),this.sh.copy(e.sh),this.intensity=e.intensity,this},toJSON:function(e){return is.prototype.toJSON.call(this,e)}}),Os.prototype=Object.assign(Object.create(Ds.prototype),{constructor:Os,isHemisphereLightProbe:!0,copy:function(e){return Ds.prototype.copy.call(this,e),this},toJSON:function(e){return Ds.prototype.toJSON.call(this,e)}}),Ns.prototype=Object.assign(Object.create(Ds.prototype),{constructor:Ns,isAmbientLightProbe:!0,copy:function(e){return Ds.prototype.copy.call(this,e),this},toJSON:function(e){return Ds.prototype.toJSON.call(this,e)}}),Object.assign(ks.prototype,{update:function(){var e,t,n,i,r,a,o,s,l=new kt,c=new kt;return function(u){if(e!==this||t!==u.focus||n!==u.fov||i!==u.aspect*this.aspect||r!==u.near||a!==u.far||o!==u.zoom||s!==this.eyeSep){e=this,t=u.focus,n=u.fov,i=u.aspect*this.aspect,r=u.near,a=u.far,o=u.zoom;var d,h,f=u.projectionMatrix.clone(),p=(s=this.eyeSep/2)*r/t,g=r*Math.tan(yt.DEG2RAD*n*.5)/o;c.elements[12]=-s,l.elements[12]=s,d=-g*i+p,h=g*i+p,f.elements[0]=2*r/(h-d),f.elements[8]=(h+d)/(h-d),this.cameraL.projectionMatrix.copy(f),d=-g*i-p,h=g*i-p,f.elements[0]=2*r/(h-d),f.elements[8]=(h+d)/(h-d),this.cameraR.projectionMatrix.copy(f)}this.cameraL.matrixWorld.copy(u.matrixWorld).multiply(c),this.cameraR.matrixWorld.copy(u.matrixWorld).multiply(l)}}()});var Fs=90;function Bs(e,t,n,i){Xt.call(this),this.type="CubeCamera";var r=new ur(Fs,1,e,t);r.up.set(0,-1,0),r.lookAt(new bt(1,0,0)),this.add(r);var a=new ur(Fs,1,e,t);a.up.set(0,-1,0),a.lookAt(new bt(-1,0,0)),this.add(a);var o=new ur(Fs,1,e,t);o.up.set(0,0,1),o.lookAt(new bt(0,1,0)),this.add(o);var s=new ur(Fs,1,e,t);s.up.set(0,0,-1),s.lookAt(new bt(0,-1,0)),this.add(s);var l=new ur(Fs,1,e,t);l.up.set(0,-1,0),l.lookAt(new bt(0,0,1)),this.add(l);var c=new ur(Fs,1,e,t);c.up.set(0,-1,0),c.lookAt(new bt(0,0,-1)),this.add(c),i=i||{format:st,magFilter:et,minFilter:et},this.renderTarget=new Mt(n,n,i),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var n=e.getRenderTarget(),i=this.renderTarget,u=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,a),e.setRenderTarget(i,2),e.render(t,o),e.setRenderTarget(i,3),e.render(t,s),e.setRenderTarget(i,4),e.render(t,l),i.texture.generateMipmaps=u,e.setRenderTarget(i,5),e.render(t,c),e.setRenderTarget(n)},this.clear=function(e,t,n,i){for(var r=e.getRenderTarget(),a=this.renderTarget,o=0;o<6;o++)e.setRenderTarget(a,o),e.clear(t,n,i);e.setRenderTarget(r)}}function Us(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function Vs(){Xt.call(this),this.type="AudioListener",this.context=Ms(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0}function Gs(e){Xt.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function Hs(e){Gs.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function js(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function zs(e,t,n){this.binding=e,this.valueSize=n;var i,r=Float64Array;switch(t){case"quaternion":i=this._slerp;break;case"string":case"bool":r=Array,i=this._select;break;default:i=this._lerp}this.buffer=new r(4*n),this._mixBufferRegion=i,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Bs.prototype=Object.create(Xt.prototype),Bs.prototype.constructor=Bs,Object.assign(Us.prototype,{start:function(){this.startTime=(typeof performance>"u"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=(typeof performance>"u"?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}),Vs.prototype=Object.assign(Object.create(Xt.prototype),{constructor:Vs,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(){var e=new bt,t=new Et,n=new bt,i=new bt,r=new Us;return function(a){Xt.prototype.updateMatrixWorld.call(this,a);var o=this.context.listener,s=this.up;if(this.timeDelta=r.getDelta(),this.matrixWorld.decompose(e,t,n),i.set(0,0,-1).applyQuaternion(t),o.positionX){var l=this.context.currentTime+this.timeDelta;o.positionX.linearRampToValueAtTime(e.x,l),o.positionY.linearRampToValueAtTime(e.y,l),o.positionZ.linearRampToValueAtTime(e.z,l),o.forwardX.linearRampToValueAtTime(i.x,l),o.forwardY.linearRampToValueAtTime(i.y,l),o.forwardZ.linearRampToValueAtTime(i.z,l),o.upX.linearRampToValueAtTime(s.x,l),o.upY.linearRampToValueAtTime(s.y,l),o.upZ.linearRampToValueAtTime(s.z,l)}else o.setPosition(e.x,e.y,e.z),o.setOrientation(i.x,i.y,i.z,s.x,s.y,s.z)}}()}),Gs.prototype=Object.assign(Object.create(Xt.prototype),{constructor:Gs,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}),Hs.prototype=Object.assign(Object.create(Gs.prototype),{constructor:Hs,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(){var e=new bt,t=new Et,n=new bt,i=new bt;return function(r){if(Xt.prototype.updateMatrixWorld.call(this,r),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(e,t,n),i.set(0,0,1).applyQuaternion(t);var a=this.panner;if(a.positionX){var o=this.context.currentTime+this.listener.timeDelta;a.positionX.linearRampToValueAtTime(e.x,o),a.positionY.linearRampToValueAtTime(e.y,o),a.positionZ.linearRampToValueAtTime(e.z,o),a.orientationX.linearRampToValueAtTime(i.x,o),a.orientationY.linearRampToValueAtTime(i.y,o),a.orientationZ.linearRampToValueAtTime(i.z,o)}else a.setPosition(e.x,e.y,e.z),a.setOrientation(i.x,i.y,i.z)}}}()}),Object.assign(js.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}),Object.assign(zs.prototype,{accumulate:function(e,t){var n=this.buffer,i=this.valueSize,r=e*i+i,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==i;++o)n[r+o]=n[o];a=t}else{var s=t/(a+=t);this._mixBufferRegion(n,r,0,s,i)}this.cumulativeWeight=a},apply:function(e){var t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,a=this.binding;if(this.cumulativeWeight=0,r<1){var o=3*t;this._mixBufferRegion(n,i,o,1-r,t)}for(var s=t,l=t+t;s!==l;++s)if(n[s]!==n[s+t]){a.setValue(n,i);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,n=this.valueSize,i=3*n;e.getValue(t,i);for(var r=n,a=i;r!==a;++r)t[r]=t[i+r%n];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,n,i,r){if(i>=.5)for(var a=0;a!==r;++a)e[t+a]=e[n+a]},_slerp:function(e,t,n,i){Et.slerpFlat(e,t,e,t,e,n,i)},_lerp:function(e,t,n,i,r){for(var a=1-i,o=0;o!==r;++o){var s=t+o;e[s]=e[s]*a+e[n+o]*i}}});var Zs,qs,Ws="\\[\\]\\.:\\/";function Ys(e,t,n){var i=n||Ks.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}function Ks(e,t,n){this.path=t,this.parsedPath=n||Ks.parseTrackName(t),this.node=Ks.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function Xs(e,t,n){this._mixer=e,this._clip=t,this._localRoot=n||null;for(var i=t.tracks,r=i.length,a=new Array(r),o={endingStart:pt,endingEnd:pt},s=0;s!==r;++s){var l=i[s].createInterpolant(null);a[s]=l,l.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Qs(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Js(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function $s(e,t,n){Tr.call(this,e,t),this.meshPerAttribute=n||1}function el(e,t,n,i){this.ray=new bn(e,t),this.near=n||0,this.far=i||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function tl(e,t){return e.distance-t.distance}function nl(e,t,n,i){if(!1!==e.visible&&(e.raycast(t,n),!0===i))for(var r=e.children,a=0,o=r.length;a<o;a++)nl(r[a],t,n,!0)}function il(e,t){this.min=void 0!==e?e:new _t(1/0,1/0),this.max=void 0!==t?t:new _t(-1/0,-1/0)}function rl(e,t){this.start=void 0!==e?e:new bt,this.end=void 0!==t?t:new bt}function al(e){Xt.call(this),this.material=e,this.render=function(){}}function ol(e,t,n,i){this.object=e,this.size=void 0!==t?t:1;var r=void 0!==n?n:16711680,a=void 0!==i?i:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=3*s.faces.length:s&&s.isBufferGeometry&&(o=s.attributes.normal.count);var l=new fn,c=new ln(2*o*3,3);l.addAttribute("position",c),Pr.call(this,l,new Mr({color:r,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}function sl(e,t){Xt.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var n=new fn,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],r=0,a=1;r<32;r++,a++){var o=r/32*Math.PI*2,s=a/32*Math.PI*2;i.push(Math.cos(o),Math.sin(o),1,Math.cos(s),Math.sin(s),1)}n.addAttribute("position",new ln(i,3));var l=new Mr({fog:!1});this.cone=new Pr(n,l),this.add(this.cone),this.update()}function ll(e){var t=[];e&&e.isBone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,ll(e.children[n]));return t}function cl(e){for(var t=ll(e),n=new fn,i=[],r=[],a=new Gt(0,0,1),o=new Gt(0,1,0),s=0;s<t.length;s++){var l=t[s];l.parent&&l.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(a.r,a.g,a.b),r.push(o.r,o.g,o.b))}n.addAttribute("position",new ln(i,3)),n.addAttribute("color",new ln(r,3));var c=new Mr({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});Pr.call(this,n,c),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function ul(e,t,n){this.light=e,this.light.updateMatrixWorld(),this.color=n;var i=new Fa(t,4,2),r=new Sn({wireframe:!0,fog:!1});wn.call(this,i,r),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function dl(e,t){this.type="RectAreaLightHelper",this.light=e,this.color=t;var n=new fn;n.addAttribute("position",new ln([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),n.computeBoundingSphere();var i=new Mr({fog:!1});Cr.call(this,n,i);var r=new fn;r.addAttribute("position",new ln([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),r.computeBoundingSphere(),this.add(new wn(r,new Sn({side:1,fog:!1}))),this.update()}function hl(e,t,n){Xt.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;var i=new Yr(t);i.rotateY(.5*Math.PI),this.material=new Sn({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=2);var r=i.getAttribute("position"),a=new Float32Array(3*r.count);i.addAttribute("color",new $t(a,3)),this.add(new wn(i,this.material)),this.update()}function fl(e,t){this.lightProbe=e,this.size=t;var n={GAMMA_OUTPUT:""},i=new En({defines:n,uniforms:{sh:{value:this.lightProbe.sh.coefficients},intensity:{value:this.lightProbe.intensity}},vertexShader:["varying vec3 vNormal;","void main() {","\tvNormal = normalize( normalMatrix * normal );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define RECIPROCAL_PI 0.318309886","vec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {","\t// matrix is assumed to be orthogonal","\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );","}","vec3 linearToOutput( in vec3 a ) {","\t#ifdef GAMMA_OUTPUT","\t\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );","\t#else","\t\treturn a;","\t#endif","}","// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf","vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {","\t// normal is assumed to have unit length","\tfloat x = normal.x, y = normal.y, z = normal.z;","\t// band 0","\tvec3 result = shCoefficients[ 0 ] * 0.886227;","\t// band 1","\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;","\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;","\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;","\t// band 2","\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;","\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;","\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );","\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;","\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );","\treturn result;","}","uniform vec3 sh[ 9 ]; // sh coefficients","uniform float intensity; // light probe intensity","varying vec3 vNormal;","void main() {","\tvec3 normal = normalize( vNormal );","\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );","\tvec3 irradiance = shGetIrradianceAt( worldNormal, sh );","\tvec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;","\toutgoingLight = linearToOutput( outgoingLight );","\tgl_FragColor = vec4( outgoingLight, 1.0 );","}"].join("\n")}),r=new Fa(1,32,16);wn.call(this,r,i),this.onBeforeRender()}function pl(e,t,n,i){e=e||10,t=t||10,n=new Gt(void 0!==n?n:4473924),i=new Gt(void 0!==i?i:8947848);for(var r=t/2,a=e/t,o=e/2,s=[],l=[],c=0,u=0,d=-o;c<=t;c++,d+=a){s.push(-o,0,d,o,0,d),s.push(d,0,-o,d,0,o);var h=c===r?n:i;h.toArray(l,u),u+=3,h.toArray(l,u),u+=3,h.toArray(l,u),u+=3,h.toArray(l,u),u+=3}var f=new fn;f.addAttribute("position",new ln(s,3)),f.addAttribute("color",new ln(l,3));var p=new Mr({vertexColors:2});Pr.call(this,f,p)}function gl(e,t,n,i,r,a){e=e||10,t=t||16,n=n||8,i=i||64,r=new Gt(void 0!==r?r:4473924),a=new Gt(void 0!==a?a:8947848);var o,s,l,c,u,d,h,f=[],p=[];for(c=0;c<=t;c++)l=c/t*(2*Math.PI),o=Math.sin(l)*e,s=Math.cos(l)*e,f.push(0,0,0),f.push(o,0,s),h=1&c?r:a,p.push(h.r,h.g,h.b),p.push(h.r,h.g,h.b);for(c=0;c<=n;c++)for(h=1&c?r:a,d=e-e/n*c,u=0;u<i;u++)l=u/i*(2*Math.PI),o=Math.sin(l)*d,s=Math.cos(l)*d,f.push(o,0,s),p.push(h.r,h.g,h.b),l=(u+1)/i*(2*Math.PI),o=Math.sin(l)*d,s=Math.cos(l)*d,f.push(o,0,s),p.push(h.r,h.g,h.b);var g=new fn;g.addAttribute("position",new ln(f,3)),g.addAttribute("color",new ln(p,3));var m=new Mr({vertexColors:2});Pr.call(this,g,m)}function ml(e,t,n,i){this.audio=e,this.range=t||1,this.divisionsInnerAngle=n||16,this.divisionsOuterAngle=i||2;var r=new fn,a=this.divisionsInnerAngle+2*this.divisionsOuterAngle,o=new Float32Array(3*(3*a+3));r.addAttribute("position",new $t(o,3));var s=new Mr({color:65280}),l=new Mr({color:16776960});Cr.call(this,r,[l,s]),this.update()}function vl(e,t,n,i){this.object=e,this.size=void 0!==t?t:1;var r=void 0!==n?n:16776960,a=void 0!==i?i:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var l=new fn,c=new ln(2*o*3,3);l.addAttribute("position",c),Pr.call(this,l,new Mr({color:r,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}function yl(e,t,n){Xt.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);var i=new fn;i.addAttribute("position",new ln([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var r=new Mr({fog:!1});this.lightPlane=new Cr(i,r),this.add(this.lightPlane),(i=new fn).addAttribute("position",new ln([0,0,0,0,0,1],3)),this.targetLine=new Cr(i,r),this.add(this.targetLine),this.update()}function _l(e){var t=new fn,n=new Mr({color:16777215,vertexColors:1}),i=[],r=[],a={},o=new Gt(16755200),s=new Gt(16711680),l=new Gt(43775),c=new Gt(16777215),u=new Gt(3355443);function d(e,t,n){h(e,n),h(t,n)}function h(e,t){i.push(0,0,0),r.push(t.r,t.g,t.b),void 0===a[e]&&(a[e]=[]),a[e].push(i.length/3-1)}d("n1","n2",o),d("n2","n4",o),d("n4","n3",o),d("n3","n1",o),d("f1","f2",o),d("f2","f4",o),d("f4","f3",o),d("f3","f1",o),d("n1","f1",o),d("n2","f2",o),d("n3","f3",o),d("n4","f4",o),d("p","n1",s),d("p","n2",s),d("p","n3",s),d("p","n4",s),d("u1","u2",l),d("u2","u3",l),d("u3","u1",l),d("c","t",c),d("p","c",u),d("cn1","cn2",u),d("cn3","cn4",u),d("cf1","cf2",u),d("cf3","cf4",u),t.addAttribute("position",new ln(i,3)),t.addAttribute("color",new ln(r,3)),Pr.call(this,t,n),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}function El(e,t){this.object=e,void 0===t&&(t=16776960);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new fn;r.setIndex(new $t(n,1)),r.addAttribute("position",new $t(i,3)),Pr.call(this,r,new Mr({color:t})),this.matrixAutoUpdate=!1,this.update()}function bl(e,t){this.type="Box3Helper",this.box=e;var n=void 0!==t?t:16776960,i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new fn;r.setIndex(new $t(i,1)),r.addAttribute("position",new ln([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Pr.call(this,r,new Mr({color:n})),this.geometry.computeBoundingSphere()}function Tl(e,t,n){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var i=void 0!==n?n:16776960,r=new fn;r.addAttribute("position",new ln([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),Cr.call(this,r,new Mr({color:i}));var a=new fn;a.addAttribute("position",new ln([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),a.computeBoundingSphere(),this.add(new wn(a,new Sn({color:i,opacity:.2,transparent:!0,depthWrite:!1})))}function Sl(e,t,n,i,r,a){Xt.call(this),void 0===e&&(e=new bt(0,0,1)),void 0===t&&(t=new bt(0,0,0)),void 0===n&&(n=1),void 0===i&&(i=16776960),void 0===r&&(r=.2*n),void 0===a&&(a=.2*r),void 0===Zs&&((Zs=new fn).addAttribute("position",new ln([0,0,0,0,1,0],3)),(qs=new Wa(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Cr(Zs,new Mr({color:i})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new wn(qs,new Sn({color:i})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,a)}function wl(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new fn;n.addAttribute("position",new ln(t,3)),n.addAttribute("color",new ln([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var i=new Mr({vertexColors:2});Pr.call(this,n,i)}function Al(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Ho.call(this,e),this.type="catmullrom"}Object.assign(Ys.prototype,{getValue:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)},setValue:function(e,t){for(var n=this._bindings,i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign(Ks,{Composite:Ys,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new Ks.Composite(e,t,n):new Ks(e,t,n)},sanitizeNodeName:function(){var e=new RegExp("["+Ws+"]","g");return function(t){return t.replace(/\s/g,"_").replace(e,"")}}(),parseTrackName:function(){var e="[^"+Ws+"]",t="[^"+Ws.replace("\\.","")+"]",n=/((?:WC+[\/:])*)/.source.replace("WC",e),i=/(WCOD+)?/.source.replace("WCOD",t),r=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",e),a=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",e),o=new RegExp("^"+n+i+r+a+"$"),s=["material","materials","bones"];return function(e){var t=o.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var r=n.nodeName.substring(i+1);-1!==s.indexOf(r)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}}(),findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var i=function(e){for(var n=0;n<e.length;n++){var r=e[n];if(r.name===t||r.uuid===t)return r;var a=i(r.children);if(a)return a}return null},r=i(e.children);if(r)return r}return null}}),Object.assign(Ks.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)e[t++]=n[i]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++]},function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,n=t.objectName,i=t.propertyName,r=t.propertyIndex;if(e||(e=Ks.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(n){var a=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var o=0;o<e.length;o++)if(e[o].name===a){a=o;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==a){if(void 0===e[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[a]}}var s=e[i];if(void 0!==s){var l=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var c=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(e.geometry.morphAttributes.position[o].name===r){r=o;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(o=0;o<this.node.geometry.morphTargets.length;o++)if(e.geometry.morphTargets[o].name===r){r=o;break}}}c=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(c=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else{var u=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+i+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(Ks.prototype,{_getValue_unbound:Ks.prototype.getValue,_setValue_unbound:Ks.prototype.setValue}),Object.assign(function(){this.uuid=yt.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,i=this._indicesByUUID,r=this._paths,a=this._parsedPaths,o=this._bindings,s=o.length,l=void 0,c=0,u=arguments.length;c!==u;++c){var d=arguments[c],h=d.uuid,f=i[h];if(void 0===f){f=t++,i[h]=f,e.push(d);for(var p=0,g=s;p!==g;++p)o[p].push(new Ks(d,r[p],a[p]))}else if(f<n){l=e[f];var m=--n,v=e[m];i[v.uuid]=f,e[f]=v,i[h]=m,e[m]=d;for(p=0,g=s;p!==g;++p){var y=o[p],_=y[m],E=y[f];y[f]=_,void 0===E&&(E=new Ks(d,r[p],a[p])),y[m]=E}}else e[f]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,r=i.length,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],l=s.uuid,c=n[l];if(void 0!==c&&c>=t){var u=t++,d=e[u];n[d.uuid]=c,e[c]=d,n[l]=u,e[u]=s;for(var h=0,f=r;h!==f;++h){var p=i[h],g=p[u],m=p[c];p[c]=g,p[u]=m}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,i=this._indicesByUUID,r=this._bindings,a=r.length,o=0,s=arguments.length;o!==s;++o){var l=arguments[o].uuid,c=i[l];if(void 0!==c)if(delete i[l],c<n){var u=--n,d=e[u],h=e[v=--t];i[d.uuid]=c,e[c]=d,i[h.uuid]=u,e[u]=h,e.pop();for(var f=0,p=a;f!==p;++f){var g=(y=r[f])[u],m=y[v];y[c]=g,y[u]=m,y.pop()}}else{var v;i[(h=e[v=--t]).uuid]=c,e[c]=h,e.pop();for(f=0,p=a;f!==p;++f){var y;(y=r[f])[c]=y[v],y.pop()}}}this.nCachedObjects_=n},subscribe_:function(e,t){var n=this._bindingsIndicesByPath,i=n[e],r=this._bindings;if(void 0!==i)return r[i];var a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,u=new Array(l);i=r.length,n[e]=i,a.push(e),o.push(t),r.push(u);for(var d=c,h=s.length;d!==h;++d){var f=s[d];u[d]=new Ks(f,e,t)}return u},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){var i=this._paths,r=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];t[e[o]]=n,a[n]=s,a.pop(),r[n]=r[o],r.pop(),i[n]=i[o],i.pop()}}}),Object.assign(Xs.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var i=this._clip.duration,r=e._clip.duration,a=r/i,o=i/r;e.warp(1,a,t),this.warp(o,1,t)}return this},crossFadeTo:function(e,t,n){return e.crossFadeFrom(this,t,n)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,n){var i=this._mixer,r=i.time,a=this._timeScaleInterpolant,o=this.timeScale;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,l=a.sampleValues;return s[0]=r,s[1]=r+n,l[0]=e/o,l[1]=t/o,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,n,i){if(this.enabled){var r=this._startTime;if(null!==r){var a=(e-r)*n;if(a<0||0===n)return;this._startTime=null,t=n*a}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var l=this._interpolants,c=this._propertyBindings,u=0,d=l.length;u!==d;++u)l[u].evaluate(o),c[u].accumulate(i,s)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,n=this._clip.duration,i=this.loop,r=this._loopCount,a=2202===i;if(0===e)return-1===r||!a||1&~r?t:n-t;if(2200===i){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=n)t=n;else{if(!(t<0)){this.time=t;break e}t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),t>=n||t<0){var o=Math.floor(t/n);t-=n*o,r+=Math.abs(o);var s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?n:0,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var l=e<0;this._setEndings(l,!l,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=t;if(a&&!(1&~r))return n-t}return t},_setEndings:function(e,t,n){var i=this._interpolantSettings;n?(i.endingStart=gt,i.endingEnd=gt):(i.endingStart=e?this.zeroSlopeAtStart?gt:pt:mt,i.endingEnd=t?this.zeroSlopeAtEnd?gt:pt:mt)},_scheduleFading:function(e,t,n){var i=this._mixer,r=i.time,a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=r,s[0]=t,o[1]=r+e,s[1]=n,this}}),Qs.prototype=Object.assign(Object.create(je.prototype),{constructor:Qs,_bindAction:function(e,t){var n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,a=e._propertyBindings,o=e._interpolants,s=n.uuid,l=this._bindingsByRootAndName,c=l[s];void 0===c&&(c={},l[s]=c);for(var u=0;u!==r;++u){var d=i[u],h=d.name,f=c[h];if(void 0!==f)a[u]=f;else{if(void 0!==(f=a[u])){null===f._cacheIndex&&(++f.referenceCount,this._addInactiveBinding(f,s,h));continue}var p=t&&t._propertyBindings[u].binding.parsedPath;++(f=new zs(Ks.create(n,h,p),d.ValueTypeName,d.getValueSize())).referenceCount,this._addInactiveBinding(f,s,h),a[u]=f}o[u].resultBuffer=f.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}for(var r=e._propertyBindings,a=0,o=r.length;a!==o;++a){var s=r[a];0===s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0===--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,n){var i=this._actions,r=this._actionsByClip,a=r[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[n]=e},_removeInactiveAction:function(e){var t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;var r=e._clip.uuid,a=this._actionsByClip,o=a[r],s=o.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete a[r],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0===--r.referenceCount&&this._removeInactiveBinding(r)}},_lendAction:function(e){var t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_takeBackAction:function(e){var t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_addInactiveBinding:function(e,t,n){var i=this._bindingsByRootAndName,r=i[t],a=this._bindings;void 0===r&&(r={},i[t]=r),r[n]=e,e._cacheIndex=a.length,a.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,a=this._bindingsByRootAndName,o=a[i],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete o[r];e:{for(var c in o)break e;delete a[i]}},_lendBinding:function(e){var t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_takeBackBinding:function(e){var t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new po(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=n),n},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var n=t||this._root,i=n.uuid,r="string"==typeof e?wo.findByName(n,e):e,a=null!==r?r.uuid:e,o=this._actionsByClip[a],s=null;if(void 0!==o){var l=o.actionByRoot[i];if(void 0!==l)return l;s=o.knownActions[0],null===r&&(r=s._clip)}if(null===r)return null;var c=new Xs(this,r,t);return this._bindAction(c,s),this._addInactiveAction(c,a,i),c},existingAction:function(e,t){var n=t||this._root,i=n.uuid,r="string"==typeof e?wo.findByName(n,e):e,a=r?r.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[i]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,n=this._bindings,i=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var r=0;r!==t;++r)e[r].reset();for(r=0;r!==i;++r)n[r].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),a=this._accuIndex^=1,o=0;o!==n;++o){t[o]._update(i,e,r,a)}var s=this._bindings,l=this._nActiveBindings;for(o=0;o!==l;++o)s[o].apply(a);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){for(var a=r.knownActions,o=0,s=a.length;o!==s;++o){var l=a[o];this._deactivateAction(l);var c=l._cacheIndex,u=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,t[c]=u,t.pop(),this._removeInactiveBindingsForAction(l)}delete i[n]}},uncacheRoot:function(e){var t=e.uuid,n=this._actionsByClip;for(var i in n){var r=n[i].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var a=this._bindingsByRootAndName[t];if(void 0!==a)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}),Js.prototype.clone=function(){return new Js(void 0===this.value.clone?this.value:this.value.clone())},$s.prototype=Object.assign(Object.create(Tr.prototype),{constructor:$s,isInstancedInterleavedBuffer:!0,copy:function(e){return Tr.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(el.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,n){var i=n||[];return nl(e,this,i,t),i.sort(tl),i},intersectObjects:function(e,t,n){var i=n||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var r=0,a=e.length;r<a;r++)nl(e[r],this,i,t);return i.sort(tl),i}}),Object.assign(function(e,t,n){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==n?n:0,this}.prototype,{set:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){var e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(yt.clamp(t/this.radius,-1,1))),this}}),Object.assign(function(e,t,n){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==n?n:0,this}.prototype,{set:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}}),Object.assign(il.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new _t;return function(t,n){var i=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new _t),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new _t),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new _t),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new _t),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new _t;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(rl.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new bt),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new bt),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new bt),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new bt,t=new bt;return function(n,i){e.subVectors(n,this.start),t.subVectors(this.end,this.start);var r=t.dot(t),a=t.dot(e)/r;return i&&(a=yt.clamp(a,0,1)),a}}(),closestPointToPoint:function(e,t,n){var i=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new bt),this.delta(n).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),al.prototype=Object.create(Xt.prototype),al.prototype.constructor=al,al.prototype.isImmediateRenderObject=!0,ol.prototype=Object.create(Pr.prototype),ol.prototype.constructor=ol,ol.prototype.update=function(){var e=new bt,t=new bt,n=new Tt;return function(){var i=["a","b","c"];this.object.updateMatrixWorld(!0),n.getNormalMatrix(this.object.matrixWorld);var r=this.object.matrixWorld,a=this.geometry.attributes.position,o=this.object.geometry;if(o&&o.isGeometry)for(var s=o.vertices,l=o.faces,c=0,u=0,d=l.length;u<d;u++)for(var h=l[u],f=0,p=h.vertexNormals.length;f<p;f++){var g=s[h[i[f]]],m=h.vertexNormals[f];e.copy(g).applyMatrix4(r),t.copy(m).applyMatrix3(n).normalize().multiplyScalar(this.size).add(e),a.setXYZ(c,e.x,e.y,e.z),c+=1,a.setXYZ(c,t.x,t.y,t.z),c+=1}else if(o&&o.isBufferGeometry){var v=o.attributes.position,y=o.attributes.normal;for(c=0,f=0,p=v.count;f<p;f++)e.set(v.getX(f),v.getY(f),v.getZ(f)).applyMatrix4(r),t.set(y.getX(f),y.getY(f),y.getZ(f)),t.applyMatrix3(n).normalize().multiplyScalar(this.size).add(e),a.setXYZ(c,e.x,e.y,e.z),c+=1,a.setXYZ(c,t.x,t.y,t.z),c+=1}a.needsUpdate=!0}}(),sl.prototype=Object.create(Xt.prototype),sl.prototype.constructor=sl,sl.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},sl.prototype.update=function(){var e=new bt;return function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,n=t*Math.tan(this.light.angle);this.cone.scale.set(n,n,t),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),cl.prototype=Object.create(Pr.prototype),cl.prototype.constructor=cl,cl.prototype.updateMatrixWorld=function(){var e=new bt,t=new kt,n=new kt;return function(i){var r=this.bones,a=this.geometry,o=a.getAttribute("position");n.getInverse(this.root.matrixWorld);for(var s=0,l=0;s<r.length;s++){var c=r[s];c.parent&&c.parent.isBone&&(t.multiplyMatrices(n,c.matrixWorld),e.setFromMatrixPosition(t),o.setXYZ(l,e.x,e.y,e.z),t.multiplyMatrices(n,c.parent.matrixWorld),e.setFromMatrixPosition(t),o.setXYZ(l+1,e.x,e.y,e.z),l+=2)}a.getAttribute("position").needsUpdate=!0,Xt.prototype.updateMatrixWorld.call(this,i)}}(),ul.prototype=Object.create(wn.prototype),ul.prototype.constructor=ul,ul.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},ul.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},dl.prototype=Object.create(Cr.prototype),dl.prototype.constructor=dl,dl.prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}},dl.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()},hl.prototype=Object.create(Xt.prototype),hl.prototype.constructor=hl,hl.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},hl.prototype.update=function(){var e=new bt,t=new Gt,n=new Gt;return function(){var i=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var r=i.geometry.getAttribute("color");t.copy(this.light.color),n.copy(this.light.groundColor);for(var a=0,o=r.count;a<o;a++){var s=a<o/2?t:n;r.setXYZ(a,s.r,s.g,s.b)}r.needsUpdate=!0}i.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),fl.prototype=Object.create(wn.prototype),fl.prototype.constructor=fl,fl.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},fl.prototype.onBeforeRender=function(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity},pl.prototype=Object.assign(Object.create(Pr.prototype),{constructor:pl,copy:function(e){return Pr.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),gl.prototype=Object.create(Pr.prototype),gl.prototype.constructor=gl,ml.prototype=Object.create(Cr.prototype),ml.prototype.constructor=ml,ml.prototype.update=function(){var e,t,n=this.audio,i=this.range,r=this.divisionsInnerAngle,a=this.divisionsOuterAngle,o=yt.degToRad(n.panner.coneInnerAngle),s=yt.degToRad(n.panner.coneOuterAngle),l=o/2,c=s/2,u=0,d=0,h=this.geometry,f=h.attributes.position;function p(n,r,a,o){var s=(r-n)/a;for(f.setXYZ(u,0,0,0),d++,e=n;e<r;e+=s)t=u+d,f.setXYZ(t,Math.sin(e)*i,0,Math.cos(e)*i),f.setXYZ(t+1,Math.sin(Math.min(e+s,r))*i,0,Math.cos(Math.min(e+s,r))*i),f.setXYZ(t+2,0,0,0),d+=3;h.addGroup(u,d,o),u+=d,d=0}h.clearGroups(),p(-c,-l,a,0),p(-l,l,r,1),p(l,c,a,0),f.needsUpdate=!0,o===s&&(this.material[0].visible=!1)},ml.prototype.dispose=function(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()},vl.prototype=Object.create(Pr.prototype),vl.prototype.constructor=vl,vl.prototype.update=function(){var e=new bt,t=new bt,n=new Tt;return function(){this.object.updateMatrixWorld(!0),n.getNormalMatrix(this.object.matrixWorld);for(var i=this.object.matrixWorld,r=this.geometry.attributes.position,a=this.object.geometry,o=a.vertices,s=a.faces,l=0,c=0,u=s.length;c<u;c++){var d=s[c],h=d.normal;e.copy(o[d.a]).add(o[d.b]).add(o[d.c]).divideScalar(3).applyMatrix4(i),t.copy(h).applyMatrix3(n).normalize().multiplyScalar(this.size).add(e),r.setXYZ(l,e.x,e.y,e.z),l+=1,r.setXYZ(l,t.x,t.y,t.z),l+=1}r.needsUpdate=!0}}(),yl.prototype=Object.create(Xt.prototype),yl.prototype.constructor=yl,yl.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},yl.prototype.update=function(){var e=new bt,t=new bt,n=new bt;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),n.subVectors(t,e),this.lightPlane.lookAt(t),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(t),this.targetLine.scale.z=n.length()}}(),_l.prototype=Object.create(Pr.prototype),_l.prototype.constructor=_l,_l.prototype.update=function(){var e,t,n=new bt,i=new cr;function r(r,a,o,s){n.set(a,o,s).unproject(i);var l=t[r];if(void 0!==l)for(var c=e.getAttribute("position"),u=0,d=l.length;u<d;u++)c.setXYZ(l[u],n.x,n.y,n.z)}return function(){e=this.geometry,t=this.pointMap;i.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),r("c",0,0,-1),r("t",0,0,1),r("n1",-1,-1,-1),r("n2",1,-1,-1),r("n3",-1,1,-1),r("n4",1,1,-1),r("f1",-1,-1,1),r("f2",1,-1,1),r("f3",-1,1,1),r("f4",1,1,1),r("u1",.7,1.1,-1),r("u2",-.7,1.1,-1),r("u3",0,2,-1),r("cf1",-1,0,1),r("cf2",1,0,1),r("cf3",0,-1,1),r("cf4",0,1,1),r("cn1",-1,0,-1),r("cn2",1,0,-1),r("cn3",0,-1,-1),r("cn4",0,1,-1),e.getAttribute("position").needsUpdate=!0}}(),El.prototype=Object.create(Pr.prototype),El.prototype.constructor=El,El.prototype.update=function(){var e=new Pt;return function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&e.setFromObject(this.object),!e.isEmpty()){var n=e.min,i=e.max,r=this.geometry.attributes.position,a=r.array;a[0]=i.x,a[1]=i.y,a[2]=i.z,a[3]=n.x,a[4]=i.y,a[5]=i.z,a[6]=n.x,a[7]=n.y,a[8]=i.z,a[9]=i.x,a[10]=n.y,a[11]=i.z,a[12]=i.x,a[13]=i.y,a[14]=n.z,a[15]=n.x,a[16]=i.y,a[17]=n.z,a[18]=n.x,a[19]=n.y,a[20]=n.z,a[21]=i.x,a[22]=n.y,a[23]=n.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),El.prototype.setFromObject=function(e){return this.object=e,this.update(),this},El.prototype.copy=function(e){return Pr.prototype.copy.call(this,e),this.object=e.object,this},El.prototype.clone=function(){return(new this.constructor).copy(this)},bl.prototype=Object.create(Pr.prototype),bl.prototype.constructor=bl,bl.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),Xt.prototype.updateMatrixWorld.call(this,e))},Tl.prototype=Object.create(Cr.prototype),Tl.prototype.constructor=Tl,Tl.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?1:0,this.lookAt(this.plane.normal),Xt.prototype.updateMatrixWorld.call(this,e)},Sl.prototype=Object.create(Xt.prototype),Sl.prototype.constructor=Sl,Sl.prototype.setDirection=function(){var e,t=new bt;return function(n){n.y>.99999?this.quaternion.set(0,0,0,1):n.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(n.z,0,-n.x).normalize(),e=Math.acos(n.y),this.quaternion.setFromAxisAngle(t,e))}}(),Sl.prototype.setLength=function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},Sl.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},Sl.prototype.copy=function(e){return Xt.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},Sl.prototype.clone=function(){return(new this.constructor).copy(this)},wl.prototype=Object.create(Pr.prototype),wl.prototype.constructor=wl,Oo.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Oo.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(es.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new Jt,n=0,i=e.length;n<i;n++){var r=e[n];t.vertices.push(new bt(r.x,r.y,r.z||0))}return t}}),Object.assign(ts.prototype,{fromPoints:function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Object.create(Ho.prototype),Object.create(Ho.prototype),Al.prototype=Object.create(Ho.prototype),Object.assign(Al.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),pl.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},cl.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Is.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),gs(e)}}),Object.assign(Es.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(il.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Pt.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),rl.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(yt,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),yt.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),yt.ceilPowerOfTwo(e)}}),Object.assign(Tt.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(kt.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function(){return void 0===e&&(e=new bt),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,i,r,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,n,r,a)}}),Ot.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Et.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(bn.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Tn.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Tn,{barycoordFromPoint:function(e,t,n,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Tn.getBarycoord(e,t,n,i,r)},normal:function(e,t,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Tn.getNormal(e,t,n,i)}}),Object.assign(ns.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Ma(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ha(this,e)}}),Object.assign(_t.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(bt.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(xt.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Jt.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(Xt.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(Xt.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(Rr.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Ir.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),xr.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Oo.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),ur.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(is.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties($t.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(fn.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(fn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.assign(Ca.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(Js.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(_n.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Gt}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}}}),Object.defineProperties(io.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(En.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(yr.prototype,{clearTarget:function(e,t,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,i)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")}}),Object.defineProperties(yr.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(rr.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Mt.prototype,{activeCubeFace:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeCubeFace has been removed. It is now the second parameter of WebGLRenderer.setRenderTarget().")}},activeMipMapLevel:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeMipMapLevel has been removed. It is now the third parameter of WebGLRenderer.setRenderTarget().")}}}),Object.defineProperties(It.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(mr.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}}),Gs.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new Cs).load(e,function(e){t.setBuffer(e)}),this},js.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Bs.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},wt.crossOrigin=void 0,wt.loadTexture=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var r=new Do;r.setCrossOrigin(this.crossOrigin);var a=r.load(e,n,void 0,i);return t&&(a.mapping=t),a},wt.loadTextureCube=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var r=new Po;r.setCrossOrigin(this.crossOrigin);var a=r.load(e,n,void 0,i);return t&&(a.mapping=t),a},wt.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},wt.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const Rl="0.12.1",xl={three:"^0.105.2"},Il=Rl.split(".")[1],Ll=Rl,Ml=xl.three.split(".")[1],Cl=xl.three.replace(/[^0-9.]/g,""),Pl={ORBIT:0,DEVICEORIENTATION:1},Dl={UNKNOWN:0,NORMAL:1,CARDBOARD:2,STEREO:3},Ol={Info:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABAAAAAQADq8/hgAAADBklEQVR42u2bP08UQRiHnzFaSYCI/xoksdBIqGwIiYWRUBISExpCQ0ej38FWOmlIKKhoMPEbaCxsrrHiYrQgOSlQEaICrT+LHSPZzNzt3s3c3Hn7lHvLzvv82L2dm30XKioqKgYY062BJF0HpoA7wARwBbhsPz4DjoEG8AnYNcZ8Sx1Op8IXJM1KWpdUV3nq9m9nJV1I7VNGfEzSM0mNNqR9NOwxx1L7NRMflbQm6SSgeJ4TO8Zoat+8/LKkg4jieQ4kLaf2RtKwpJ0uiufZkTScSn5S0l5C+b/sSZrstvyMpKPU5uc4kjTTjkvpeYCkaeA1/+7hvcIZMGuMqUULQNIU8Aa4ltrWwyHwyBizGzwASSPAe+B2assW7AH3jTE/i+xcZoa12Qfy2Bo3i+5cKABl99zF1GYlWFTBeULLS0DZrOsDcDNggTXgc27bLWA64BhfgHvGmB8dHUXZ1DM0S45xliKMs9bKr+klIOkqsBrwv9JtVq1DewEAT4Ch1BYdMGQdygeg7Df4SmqDAKyoyXpCszPgITCeuvoAjFuX0gE8jljUdv7bCtiOOJ7XpdUZ8L/gdXHOA5QtYH5NXXVgbrgWWn1nwFTqaiPgdPIFcDd1tRFwOl307DwRuZgXwLvctgfA04hjOp18AcReZ6sZY16e3yDpUuQxnU6+S2AkcjEpcDr1zxOXSPgCKLSa0mc4nXwB/EpdbQScTr4AGqmrjYDTyRfAx9TVRsDp5Aug8LJyH+F0cgZg58z11BUHpO5ruGh2G3ybuuqAeF2aBfAqddUB8bq0OgP2U1cegH3aOQOMMb+BrdTVB2DLupQLwLIOnKY26IBT6+ClaQDGmO/ARmqLDtiwDn7HVkcY+EdjNoTlCI+tYhO2iUppm6HKslPUq2qQKHpUe8AFsjaUXuUQWCgqXyoAG8IuME/WkNRrnAHzZfqDSgdgQ6gBc2Td3b3CMTBXtkOsIzTIjZLnQhjcVtlcEIPZLJ0LoVvt8s/Va+3yuSAG84UJRxB98cpM9dJURUVFxSDzBxKde4Lk3/h2AAAAAElFTkSuQmCC",Arrow:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABAAAAAQADq8/hgAAADPklEQVR42u2bMUscQRiG30/SRaJEI1ZKUiRErNIELRUbQYSAnX8hpVUgkDYp0wgWVjYW+QcJaQzYpLojJIXhtDDEKBpj65ti58ixmdmb2ZvZ7+T2AUHudmfmeXf2bnb3O6CmpqZmgJGqOiI5AWAWwEMA0wDuArht3r4CcAagBeAbgIaI/NQOp1fhIZKLJN+SbDKcptl3keSQtk+I+BjJVyRbJaRdtEybY9p+ReKjJN+QvIwonufS9DGq7ZuXXyd5nFA8zzHJdW1vkLxDcrdC8Ty7JO9oyc+QPFCUb3NAcqZq+TmSp9rmHZySnCvjErwOIPkUwHv8+w7vF64ALIrIfrIASM4C+ADgnratgxMACyLSiB4AyREAnwE80LbswgGAJyJy4bNxyApr6wbIw4xxy3djrwCYfeeuaZsFsEbPdULXU4DZqusLgMkEA21P05EEbf8A8FhEzos28pkBLxLKL5s/r/M1kEkz9vKQHGeatf05yfmOfubNa7G5JDle5NhtBjwHMBz5yFwAWBaRT+0XzP8pZsKwcQiH2fX8Ycojb+kzxUw4ZJn7CSQXqpRPHMKCq7+iZJ71Mvdy/DftXSQ6HcJdSDaqPPKW/mPOBO+lcbvzCU35RCFM2PpwnQKzZQfdgfe0dxH5dLA6uQJ4pC2fIASrkyuA6X6QjxyC1ckVQNn7bNHlI4ZgdXIFUObiJJl8pBCsTjGfuIwA2Cv4FN7xbYjkjqsRAHuIePXoCiDF1Zk2VidXAL+1R5sAq5MrgJb2aBNgdXIF8FV7tAmwOrkCCFs73wysTtYATHFCU3vEEWm6Ci6KvgY/ao86Ik6XogDeaY86Ik6XbjPgSHvkEThCwQy45XpDRK5JbgN4GWkgUyR9H65MRQxgW0SunZ5FezK7pfwd8e8MV8UfAPdF5Jdrg8JrAbPjprZFD2wWyQP6j8ZSEufRmGlgQ9umBBvd5IOgbjFUKLu+XnWBhG+rpsFVZGUo/coJgFVf+aAATAgNACvICpL6jSsAKyH1QcEBmBD2ASwhq+7uF84ALIVWiPUEB7lQsiOEwS2VzQUxmMXSuRCqKpd/zX4rl88FMZg/mLAEcSN+MlP/aKqmpqZmkPkL0hSjwOpNKxwAAAAASUVORK5CYII=",FullscreenEnter:"data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz4KICAgIDxwYXRoIGQ9Ik03IDE0SDV2NWg1di0ySDd2LTN6bS0yLTRoMlY3aDNWNUg1djV6bTEyIDdoLTN2Mmg1di01aC0ydjN6TTE0IDV2MmgzdjNoMlY1aC01eiIvPgo8L3N2Zz4=",FullscreenLeave:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggc3R5bGU9ImZpbGw6I2ZmZiIgZD0iTTE0LDE0SDE5VjE2SDE2VjE5SDE0VjE0TTUsMTRIMTBWMTlIOFYxNkg1VjE0TTgsNUgxMFYxMEg1VjhIOFY1TTE5LDhWMTBIMTRWNUgxNlY4SDE5WiIgLz48L3N2Zz4=",VideoPlay:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggc3R5bGU9ImZpbGw6I2ZmZiIgZD0iTTgsNS4xNFYxOS4xNEwxOSwxMi4xNEw4LDUuMTRaIiAvPjwvc3ZnPg==",VideoPause:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggc3R5bGU9ImZpbGw6I2ZmZiIgZD0iTTE0LDE5LjE0SDE4VjUuMTRIMTRNNiwxOS4xNEgxMFY1LjE0SDZWMTkuMTRaIiAvPjwvc3ZnPg==",WhiteTile:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIABAMAAAAGVsnJAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAB1WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOkNvbXByZXNzaW9uPjE8L3RpZmY6Q29tcHJlc3Npb24+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOlBob3RvbWV0cmljSW50ZXJwcmV0YXRpb24+MjwvdGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KAtiABQAAACRQTFRFAAAAAAAABgYGBwcHHh4eKysrx8fHy8vLzMzM7OzsAAAABgYG+q7SZgAAAAp0Uk5TAP7+/v7+/v7+/iJx/a8AAAOwSURBVHja7d0hbsNAEAVQo6SFI6XEcALDcgNLvUBvEBQVhpkWVYWlhSsVFS7t5QIshRt695lEASZP+8c7a1kzDL1fz+/zyuvzp6FbvoddrL6uDd1yGZ5eXldeb18N3fIx7A+58prmhm65DfvDcd0952lu6JabFbD/zVprZj1lzcys+fj9z8xTZtbT8rv8yWlu6BYAIgAAAAAAAAAAAABAM6QXEAEAAAAAAAAAgJ2gnaAIiIA3Q2qAGgAAAAAAAAAAAAAAAAAAAAAAAAAAQJsADkVFAAAAAAA8Bj0GRUAEREAEREAEREAEREAEAAAAAAAAAAB2gnaCIiACPplRA9QANUAERAAAAEVQERQBERCBVlfAcZ3aeZobusUKMGBhV6KUElHGKBERJR6/fxExRkQZl9/lT8S1oVsuhqyYMmPKjCkzvfcCpsxohrwY0Q06EAEAAAAAAAAAAACgGdILiAAAAAAAAAAAwE7QTlAERMCbITVADQAAAAAAAAAAAAAAAAAAAAAAAAAAwKmwQ1ERAAAAAACPQY9BERABERABERABERABERABAAAAAAAAAICdoJ2gCIiAT2bUADVADRABEQAAQBFUBEVABERgEyvAlJm+V4ApM6bMmDJjyowpM6bMdN0LmDKjGfJiRDfoQAQAAAAAAAAAAACAZkgvIAIAAAAAAAAAADtBO0EREAFvhtQANQAAAAAAAAAAAAAAAAAAAAAAAAAAAKfCDkVFAAAAAAA8Bj0GRUAEREAEREAEREAEREAEAAAAAAAAAAB2gnaCIiACPplRA9QANUAERAAAAEVQERQBERCBTawAU2b6XgGmzJgyY8qMKTOmzJgy03UvYMqMZsiLEd2gAxEAAAAAAAAAAAAAmiG9gAgAAAAAAAAAAOwE7QRFQAS8GVID1AAAAAAAAAAAAAAAAAAAAAAAAAAAAJwKOxQVAQAAAADwGPQYFAEREAEREAEREAEREAERAAAAAAAAAADYCdoJioAI+GRGDVAD1AAREAEAABRBRVAEREAENrECTJnpewWYMmPKjCkzpsyYMmPKTNe9gCkzmiEvRnSDDkQAAAAAAAAAAAAAaIb0AiIAAAAAAAAAALATtBMUARHwZkgNUAMAAAAAAAAAAAAAAAAAAAAAAAAAAHAq7FBUBAAAAADAY9BjUAREQAREQAREQAREQAREAAAAAAAAAABgJ2gnKAIi4JMZNUANUANEQAQAAFAEFUEREAER2MQKMGWm7xVgyowpM50PWen9ugNGXz1XaocAFgAAAABJRU5ErkJggg==",Setting:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABAAAAAQADq8/hgAAADn0lEQVR42u2bzUsVURjGnyO6CPzAMnTjppAo3LTwH1CqTfaxbeOiRS37A0wXtROFVi1aRBs3LWohSIGbQAQXViBGRhG0UIRKUCpK7q/FnOB2uc6cOXNmRnGe3eW+H8/7zLln3vNxpQoVKlQ4wjBFJAFOSRqX1O7osivpvjHmU1nChBZglvSYLYJbS0EanCvIJzWK+gnsyH34/8OuMaYjb265jwCgz6N4SWq3vodbAEmnS/KtBDgoAgyU5BteAOAkMAPcBroc7PskDWfgN+wyDwBdltMMcDI3tYBnde/pHeARMNTErgd4APzweP834oeN1dMkz5DlsFNn/yyv4kdiSK4At4AO4CqwGaDwRmza2B0210qM7YhrXU59ANAq6bWkwQTTn5KO5fIE0uVYlXTeGLOXFMx1DrjlULwKKN41x6DlnIjEEQCckPRe0okCiguJr5LOGGO+xhm5jICJQ1i8LOeJJKPYEQAMKvrtt5ZdjSf2FM0Fq/sZJI2A6UNcvCz36TiDfUcAcE1SPu/U6Mm8k/TFfu6XdFb5iX3dGPM8lQfwNod3+TowBnQ3yddtv1vPIe+b1JIBiwEJ1IAJ208k5W21trWA+V/5CHAcmAtU/A2P/DcCiTAHHE8tgCVhgLvAXgYCk17Jo/yTGfLuWe7Zd72AC8CWB4n3OAz7mLytNkZabAEXMhfeQKYfWEpJZCxA3rGUOZeA/qDF15FpAz47EvlNk9neI2e3jeWCz0BbmvipNkSMMX8kuSZYM8Z8zyqAjbHmaN5mOeYjgIXrU93MWrxHrNQjrqiDkQMLHwG+OdqF3NN3jeXKzU8AoF1SzdH8XKhJUO7HZDXLMbwAwICkJUULFxe0SbqSVQAbw3Xi7Ze0ZLmGAzAKbHs0JGU1QtvAaIjCW4B7ZOvJy2qFa5a730RPtBiaz0CgnkiZi6F5fBZDVMvho7EhcuS3xJJ2hV9IupgTqaLw0hhzab8vq23xOG/r+LDsKjLgYVzxUnU0ltwK2wDezUyJmEwqXgp/PL4rvxthaeCSI+zxuA10J8ZkWdJNSb2SLkvayKHwDRu71+ZajrG941J8agALDQ3GU/a/IvMkYCPzmCbtLNEVmacNtgs5iP9fYVNEV1Q6Hez7yNZSL+J2SarTcpqiyV2iUkG0IvPFvbz5FbEn+KEk3wMjwMeSfCsBXFBdly9CAPk9ydyffpECuB5tZfVJjaKWueOSfinln6YK4lahQoUKRxd/AcRPGTcQCAUQAAAAAElFTkSuQmCC",ChevronRight:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTguNTksMTYuNThMMTMuMTcsMTJMOC41OSw3LjQxTDEwLDZMMTYsMTJMMTAsMThMOC41OSwxNi41OFoiIC8+PC9zdmc+",Check:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTIxLDdMOSwxOUwzLjUsMTMuNUw0LjkxLDEyLjA5TDksMTYuMTdMMTkuNTksNS41OUwyMSw3WiIgLz48L3N2Zz4=",ViewIndicator:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBpZD0idmlldy1pbmRpY2F0b3IiIGhlaWdodD0iMzAiIHdpZHRoPSIzMCIgdmlld0JveD0iLTIuNSAtMSAzMCAzMCI+Cgk8c3R5bGUgdHlwZT0idGV4dC9jc3MiPi5zdDB7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLW1pdGVybGltaXQ6MTA7ZmlsbDpub25lO30uc3Qxe3N0cm9rZS13aWR0aDo2O3N0cm9rZS1taXRlcmxpbWl0OjEwO30KCTwvc3R5bGU+Cgk8Zz4KCQk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNIDEyLjUgMCBBIDEyLjUgMTIuNSAwIDAgMCAtMTIuNSAwIEEgMTIuNSAxMi41IDAgMCAwIDEyLjUgMCIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxMywxNS41KSI+PC9wYXRoPgoJCTxwYXRoIGNsYXNzPSJzdDIiIGQ9Ik0gMTMgMCBMIDEwIDIgTCAxNiAyIFoiPjwvcGF0aD4KCQk8cGF0aCBjbGFzcz0ic3QyIiBkPSJNIDIgMCBBIDIgMiAwIDAgMCAtMiAwIEEgMiAyIDAgMCAwIDIgMCIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxMywxNS41KSI+PC9wYXRoPgoJCTxwYXRoIGNsYXNzPSJzdDEiIGlkPSJpbmRpY2F0b3IiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMTMsMTUuNSkiPjwvcGF0aD4KCTwvZz4KPC9zdmc+"},Nl={load:function(e){let t,n,i,r,a,o,s,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{},c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{},u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{};Ro.enabled=!0;for(let t in Ol)Ol.hasOwnProperty(t)&&e===Ol[t]&&(s=t);if(t=Ro.get(s||e),void 0!==t)return l&&setTimeout(function(){c({loaded:1,total:1}),l(t)},0),t;a=window.URL||window.webkitURL,o=document.createElementNS("http://www.w3.org/1999/xhtml","img"),Ro.add(s||e,o);const d=()=>{a.revokeObjectURL(o.src),l(o)};if(0===e.indexOf("data:"))return o.addEventListener("load",d,!1),o.src=e,o;o.crossOrigin=void 0!==this.crossOrigin?this.crossOrigin:"",n=new window.XMLHttpRequest,n.open("GET",e,!0),"test"!==process.env.npm_lifecycle_event&&(n.onreadystatechange=function(){4===this.readyState&&this.status>=400&&u()}),n.responseType="arraybuffer",n.addEventListener("error",u),n.addEventListener("progress",e=>{if(!e)return;const{loaded:t,total:n,lengthComputable:i}=e;i&&c({loaded:t,total:n})}),n.addEventListener("loadend",e=>{if(!e)return;const{currentTarget:{response:t}}=e;i=new Uint8Array(t),r=new window.Blob([i]),o.addEventListener("load",d,!1),o.src=a.createObjectURL(r)}),n.send(null)}},kl={load:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{},n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;var r=new Rt;return Nl.load(e,function(n){r.image=n;const i=e.search(/\.(jpg|jpeg)$/)>0||0===e.search(/^data\:image\/jpeg/);r.format=i?st:lt,r.needsUpdate=!0,t(r)},n,i),r}},Fl={load:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{},i=arguments.length>3?arguments[3]:void 0;var r,a,o,s,l;return r=new kn([]),a=0,o={},s={},e.map(function(e,c){Nl.load(e,function(e){r.images[c]=e,6===++a&&(r.needsUpdate=!0,t(r))},function(e){for(var t in o[c]={loaded:e.loaded,total:e.total},s.loaded=0,s.total=0,l=0,o)l++,s.loaded+=o[t].loaded,s.total+=o[t].total;l<6&&(s.total=s.total/l*6),n(s)},i)}),r}};function Bl(e){this.constraints=Object.assign({video:{width:{ideal:1920},height:{ideal:1080},facingMode:{exact:"environment"}},audio:!1},e),this.container=null,this.scene=null,this.element=null,this.devices=[],this.stream=null,this.ratioScalar=1,this.videoDeviceIndex=0}function Ul(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16777215,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1500;this.dpr=window.devicePixelRatio;const{canvas:i,context:r}=this.createCanvas(),a=new wr({color:e,map:this.createCanvasTexture(i)});Ar.call(this,a),this.canvasWidth=i.width,this.canvasHeight=i.height,this.context=r,this.color=e instanceof Gt?e:new Gt(e),this.autoSelect=t,this.dwellTime=n,this.rippleDuration=500,this.position.z=-10,this.center.set(.5,.5),this.scale.set(.5,.5,1),this.startTimestamp=null,this.timerId=null,this.callback=null,this.frustumCulled=!1,this.updateCanvasArcByProgress(0)}Bl.prototype=Object.assign(Object.create(je.prototype),{setContainer:function(e){this.container=e},setScene:function(e){this.scene=e},enumerateDevices:function(){const e=this.devices,t=new Promise(t=>{t(e)});return e.length>0?t:window.navigator.mediaDevices.enumerateDevices()},switchNextVideoDevice:function(){const e=this.stop.bind(this),t=this.start.bind(this),n=this.setVideDeviceIndex.bind(this);let i=this.videoDeviceIndex;this.getDevices("video").then(r=>{e(),i++,i>=r.length?(n(0),i--):n(i),t(r[i])})},getDevices:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"video";const t=this.devices;return this.enumerateDevices().then(e=>e.map(e=>(t.includes(e)||t.push(e),e))).then(t=>{const n=new RegExp(e,"i");return t.filter(e=>n.test(e.kind))})},getUserMedia:function(e){const t=this.setMediaStream.bind(this),n=this.playVideo.bind(this);return window.navigator.mediaDevices.getUserMedia(e).then(t).then(n).catch(e=>{console.warn("PANOLENS.Media: ".concat(e))})},setVideDeviceIndex:function(e){this.videoDeviceIndex=e},start:function(e){const t=this.constraints,n=this.getUserMedia.bind(this);return this.element=this.createVideoElement(),this.getDevices().then(i=>{if(!i||0===i.length)throw Error("no video device found");const r=e||i[0];return t.video.deviceId=r.deviceId,n(t)})},stop:function(){const e=this.stream;e&&e.active&&(e.getTracks()[0].stop(),window.removeEventListener("resize",this.onWindowResize.bind(this)),this.element=null,this.stream=null)},setMediaStream:function(e){this.stream=e,this.element.srcObject=e,this.scene&&(this.scene.background=this.createVideoTexture()),window.addEventListener("resize",this.onWindowResize.bind(this))},playVideo:function(){const{element:e}=this;e&&(e.play(),this.dispatchEvent({type:"play"}))},pauseVideo:function(){const{element:e}=this;e&&(e.pause(),this.dispatchEvent({type:"pause"}))},createVideoTexture:function(){const e=this.element,t=new kr(e);return t.generateMipmaps=!1,t.minFilter=et,t.magFilter=et,t.format=st,t.center.set(.5,.5),e.addEventListener("canplay",this.onWindowResize.bind(this)),t},createVideoElement:function(){const e=this.dispatchEvent.bind(this),t=document.createElement("video");return t.setAttribute("autoplay",""),t.setAttribute("muted",""),t.setAttribute("playsinline",""),t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.objectPosition="center",t.style.objectFit="cover",t.style.display=this.scene?"none":"",t.addEventListener("canplay",()=>e({type:"canplay"})),t},onWindowResize:function(){if(this.element&&this.element.videoWidth&&this.element.videoHeight&&this.scene){const{clientWidth:e,clientHeight:t}=this.container,n=this.scene.background,{videoWidth:i,videoHeight:r}=this.element,a=r/i*(this.container?e/t:1)*this.ratioScalar;e>t?n.repeat.set(a,1):n.repeat.set(1,1/a)}}}),Ul.prototype=Object.assign(Object.create(Ar.prototype),{constructor:Ul,setColor:function(e){this.material.color.copy(e instanceof Gt?e:new Gt(e))},createCanvasTexture:function(e){const t=new Br(e);return t.minFilter=et,t.magFilter=et,t.generateMipmaps=!1,t},createCanvas:function(){const e=document.createElement("canvas"),t=e.getContext("2d"),n=this.dpr;return e.width=32*n,e.height=32*n,t.scale(n,n),t.shadowBlur=5,t.shadowColor="rgba(200,200,200,0.9)",{canvas:e,context:t}},updateCanvasArcByProgress:function(e){const t=this.context,{canvasWidth:n,canvasHeight:i,material:r}=this,a=this.dpr,o=e*Math.PI*2,s=this.color.getStyle(),l=.5*n/a,c=.5*i/a;t.clearRect(0,0,n,i),t.beginPath(),0===e?(t.arc(l,c,n/16,0,2*Math.PI),t.fillStyle=s,t.fill()):(t.arc(l,c,n/4-3,-Math.PI/2,-Math.PI/2+o),t.strokeStyle=s,t.lineWidth=3,t.stroke()),t.closePath(),r.map.needsUpdate=!0},ripple:function(){const e=this.context,{canvasWidth:t,canvasHeight:n,material:i}=this,r=this.rippleDuration,a=performance.now(),o=this.color,s=this.dpr,l=.5*t/s,c=.5*n/s,u=()=>{const d=window.requestAnimationFrame(u),h=(performance.now()-a)/r,f=1-h>0?1-h:0,p=h*t*.5/s;e.clearRect(0,0,t,n),e.beginPath(),e.arc(l,c,p,0,2*Math.PI),e.fillStyle="rgba(".concat(255*o.r,", ").concat(255*o.g,", ").concat(255*o.b,", ").concat(f,")"),e.fill(),e.closePath(),h>=1&&(window.cancelAnimationFrame(d),this.updateCanvasArcByProgress(0),this.dispatchEvent({type:"reticle-ripple-end"})),i.map.needsUpdate=!0};this.dispatchEvent({type:"reticle-ripple-start"}),u()},show:function(){this.visible=!0},hide:function(){this.visible=!1},start:function(e){this.autoSelect&&(this.dispatchEvent({type:"reticle-start"}),this.startTimestamp=performance.now(),this.callback=e,this.update())},end:function(){this.startTimestamp&&(window.cancelAnimationFrame(this.timerId),this.updateCanvasArcByProgress(0),this.callback=null,this.timerId=null,this.startTimestamp=null,this.dispatchEvent({type:"reticle-end"}))},update:function(){this.timerId=window.requestAnimationFrame(this.update.bind(this));const e=(performance.now()-this.startTimestamp)/this.dwellTime;this.updateCanvasArcByProgress(e),this.dispatchEvent({type:"reticle-update",progress:e}),e>=1&&(window.cancelAnimationFrame(this.timerId),this.callback&&this.callback(),this.end(),this.ripple())}});var Vl=function(e,t){return e(t={exports:{}},t.exports),t.exports}(function(e,t){var n=function(){this._tweens={},this._tweensAddedDuringUpdate={}};n.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var n=Object.keys(this._tweens);if(0===n.length)return!1;for(e=void 0!==e?e:r.now();n.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<n.length;i++){var a=this._tweens[n[i]];a&&!1===a.update(e)&&(a._isPlaying=!1,t||delete this._tweens[n[i]])}n=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var i,r=new n;r.Group=n,r._nextId=0,r.nextId=function(){return r._nextId++},typeof self>"u"&&typeof process<"u"&&process.hrtime?r.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:typeof self<"u"&&void 0!==self.performance&&void 0!==self.performance.now?r.now=self.performance.now.bind(self.performance):void 0!==Date.now?r.now=Date.now:r.now=function(){return(new Date).getTime()},r.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=r.Easing.Linear.None,this._interpolationFunction=r.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onRepeatCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||r,this._id=r.nextId()},r.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},duration:function(e){return this._duration=e,this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?r.now()+parseFloat(e):e:r.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array||(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(1/0),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onRepeat:function(e){return this._onRepeatCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,n,i;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),n=(e-this._startTime)/this._duration,n=0===this._duration||n>1?1:n,i=this._easingFunction(n),this._valuesEnd)if(void 0!==this._valuesStart[t]){var r=this._valuesStart[t]||0,a=this._valuesEnd[t];a instanceof Array?this._object[t]=this._interpolationFunction(a,i):("string"==typeof a&&(a="+"===a.charAt(0)||"-"===a.charAt(0)?r+parseFloat(a):parseFloat(a)),"number"==typeof a&&(this._object[t]=r+(a-r)*i))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object,n),1===n){if(this._repeat>0){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var o=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=o}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,null!==this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,l=this._chainedTweens.length;s<l;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}return!0}},r.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-r.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*r.Easing.Bounce.In(2*e):.5*r.Easing.Bounce.Out(2*e-1)+.5}}},r.Interpolation={Linear:function(e,t){var n=e.length-1,i=n*t,a=Math.floor(i),o=r.Interpolation.Utils.Linear;return t<0?o(e[0],e[1],i):t>1?o(e[n],e[n-1],n-i):o(e[a],e[a+1>n?n:a+1],i-a)},Bezier:function(e,t){for(var n=0,i=e.length-1,a=Math.pow,o=r.Interpolation.Utils.Bernstein,s=0;s<=i;s++)n+=a(1-t,i-s)*a(t,s)*e[s]*o(i,s);return n},CatmullRom:function(e,t){var n=e.length-1,i=n*t,a=Math.floor(i),o=r.Interpolation.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(a=Math.floor(i=n*(1+t))),o(e[(a-1+n)%n],e[a],e[(a+1)%n],e[(a+2)%n],i-a)):t<0?e[0]-(o(e[0],e[0],e[1],e[1],-i)-e[0]):t>1?e[n]-(o(e[n],e[n],e[n-1],e[n-1],i-n)-e[n]):o(e[a?a-1:0],e[a],e[n<a+1?n:a+1],e[n<a+2?n:a+2],i-a)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=r.Interpolation.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:(i=[1],function(e){var t=1;if(i[e])return i[e];for(var n=e;n>1;n--)t*=n;return i[e]=t,t}),CatmullRom:function(e,t,n,i,r){var a=.5*(n-e),o=.5*(i-t),s=r*r;return(2*t-2*n+a+o)*(r*s)+(-3*t+3*n-2*a-o)*s+a*r+t}}},e.exports=r});function Gl(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;t=t||Ol.Info,Ar.call(this),this.type="infospot",this.animated=void 0===n||n,this.isHovering=!1,this.frustumCulled=!1,this.element=null,this.toPanorama=null,this.cursorStyle=null,this.mode=Dl.NORMAL,this.scale.set(e,e,1),this.rotation.y=Math.PI,this.container=null,this.originalRaycast=this.raycast,this.HANDLER_FOCUS=null,this.material.side=2,this.material.depthTest=!1,this.material.transparent=!0,this.material.opacity=0,this.scaleUpAnimation=new Vl.Tween,this.scaleDownAnimation=new Vl.Tween;const i=function(t){if(!this.material)return;const n=t.image.width/t.image.height,i=new bt;t.image.width=t.image.naturalWidth||64,t.image.height=t.image.naturalHeight||64,this.scale.set(n*e,e,1),i.copy(this.scale),this.scaleUpAnimation=new Vl.Tween(this.scale).to({x:1.3*i.x,y:1.3*i.y},500).easing(Vl.Easing.Elastic.Out),this.scaleDownAnimation=new Vl.Tween(this.scale).to({x:i.x,y:i.y},500).easing(Vl.Easing.Elastic.Out),this.material.map=t,this.material.needsUpdate=!0}.bind(this);this.showAnimation=new Vl.Tween(this.material).to({opacity:1},500).onStart(this.enableRaycast.bind(this,!0)).easing(Vl.Easing.Quartic.Out),this.hideAnimation=new Vl.Tween(this.material).to({opacity:0},500).onStart(this.enableRaycast.bind(this,!1)).easing(Vl.Easing.Quartic.Out),this.addEventListener("click",this.onClick),this.addEventListener("hover",this.onHover),this.addEventListener("hoverenter",this.onHoverStart),this.addEventListener("hoverleave",this.onHoverEnd),this.addEventListener("panolens-dual-eye-effect",this.onDualEyeEffect),this.addEventListener("panolens-container",this.setContainer.bind(this)),this.addEventListener("dismiss",this.onDismiss),this.addEventListener("panolens-infospot-focus",this.setFocusMethod),kl.load(t,i)}function Hl(e){e||console.warn("PANOLENS.Widget: No container specified"),je.call(this),this.DEFAULT_TRANSITION="all 0.27s ease",this.TOUCH_ENABLED=!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch),this.PREVENT_EVENT_HANDLER=function(e){e.preventDefault(),e.stopPropagation()},this.container=e,this.barElement=null,this.fullscreenElement=null,this.videoElement=null,this.settingElement=null,this.mainMenu=null,this.activeMainItem=null,this.activeSubMenu=null,this.mask=null}function jl(e,t){wn.call(this,e,t),this.type="panorama",this.ImageQualityLow=1,this.ImageQualityFair=2,this.ImageQualityMedium=3,this.ImageQualityHigh=4,this.ImageQualitySuperHigh=5,this.animationDuration=1e3,this.defaultInfospotSize=350,this.container=void 0,this.loaded=!1,this.linkedSpots=[],this.isInfospotVisible=!1,this.linkingImageURL=void 0,this.linkingImageScale=void 0,this.material.side=1,this.material.opacity=0,this.scale.x*=-1,this.renderOrder=-1,this.active=!1,this.infospotAnimation=new Vl.Tween(this).to({},this.animationDuration/2),this.addEventListener("load",this.fadeIn.bind(this)),this.addEventListener("panolens-container",this.setContainer.bind(this)),this.addEventListener("click",this.onClick.bind(this)),this.setupTransitions()}function zl(e,t,n){const i=t||new Fa(5e3,60,40),r=n||new Sn({opacity:0,transparent:!0});jl.call(this,i,r),this.src=e,this.radius=5e3}function Zl(){const e=new fn,t=new Sn({color:0,opacity:0,transparent:!0});e.addAttribute("position",new $t(new Float32Array,1)),jl.call(this,e,t)}function ql(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=Object.assign({},jt.cube),n=new gn(1e4,1e4,1e4),i=new En({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:t.uniforms,side:1,transparent:!0});jl.call(this,n,i),this.images=e,this.edgeLength=1e4,this.material.uniforms.opacity.value=0}function Wl(){const e=[];for(let t=0;t<6;t++)e.push(Ol.WhiteTile);ql.call(this,e)}function Yl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new Fa(5e3,60,40),i=new Sn({opacity:0,transparent:!0});jl.call(this,n,i),this.src=e,this.options={videoElement:document.createElement("video"),loop:!0,muted:!0,autoplay:!1,playsinline:!0,crossOrigin:"anonymous"},Object.assign(this.options,t),this.videoElement=this.options.videoElement,this.videoProgress=0,this.radius=5e3,this.addEventListener("leave",this.pauseVideo.bind(this)),this.addEventListener("enter-fade-start",this.resumeVideoProgress.bind(this)),this.addEventListener("video-toggle",this.toggleVideo.bind(this)),this.addEventListener("video-time",this.setVideoCurrentTime.bind(this))}function Kl(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._parameters=t,this._zoom=null,this._panoId=null,this._panoClient=new google.maps.StreetViewService,this._count=0,this._total=0,this._canvas=[],this._ctx=[],this._wc=0,this._hc=0,this.result=null,this.rotation=0,this.copyright="",this.onSizeChange=null,this.onPanoramaLoad=null,this.levelsW=[1,2,4,7,13,26],this.levelsH=[1,1,2,4,7,13],this.widths=[416,832,1664,3328,6656,13312],this.heights=[416,416,832,1664,3328,6656],this.maxW=6656,this.maxH=6656;try{const t=document.createElement("canvas");e=t.getContext("experimental-webgl"),e||(e=t.getContext("webgl"))}catch(e){}this.maxW=Math.max(e.getParameter(e.MAX_TEXTURE_SIZE),this.maxW),this.maxH=Math.max(e.getParameter(e.MAX_TEXTURE_SIZE),this.maxH)}function Xl(e,t){zl.call(this),this.panoId=e,this.gsvLoader=null,this.loadRequested=!1,this.setupGoogleMapAPI(t)}Gl.prototype=Object.assign(Object.create(Ar.prototype),{constructor:Gl,setContainer:function(e){let t;e instanceof HTMLElement?t=e:e&&e.container&&(t=e.container),t&&this.element&&t.appendChild(this.element),this.container=t},getContainer:function(){return this.container},onClick:function(e){this.element&&this.getContainer()&&(this.onHoverStart(e),this.lockHoverElement())},onDismiss:function(){this.element&&(this.unlockHoverElement(),this.onHoverEnd())},onHover:function(){},onHoverStart:function(e){if(!this.getContainer())return;const t=this.cursorStyle||(this.mode===Dl.NORMAL?"pointer":"default"),{scaleDownAnimation:n,scaleUpAnimation:i,element:r}=this;if(this.isHovering=!0,this.container.style.cursor=t,this.animated&&(n.stop(),i.start()),r&&e.mouseEvent.clientX>=0&&e.mouseEvent.clientY>=0){const{left:e,right:t,style:n}=r;this.mode===Dl.CARDBOARD||this.mode===Dl.STEREO?(n.display="none",e.style.display="block",t.style.display="block",r._width=e.clientWidth,r._height=e.clientHeight):(n.display="block",e&&(e.style.display="none"),t&&(t.style.display="none"),r._width=r.clientWidth,r._height=r.clientHeight)}},onHoverEnd:function(){if(!this.getContainer())return;const{scaleDownAnimation:e,scaleUpAnimation:t,element:n}=this;if(this.isHovering=!1,this.container.style.cursor="default",this.animated&&(t.stop(),e.start()),n&&!this.element.locked){const{left:e,right:t,style:i}=n;i.display="none",e&&(e.style.display="none"),t&&(t.style.display="none"),this.unlockHoverElement()}},onDualEyeEffect:function(e){if(!this.getContainer())return;let t,n,i;this.mode=e.mode,t=this.element,n=this.container.clientWidth/2,i=this.container.clientHeight/2,t&&(!t.left&&!t.right&&(t.left=t.cloneNode(!0),t.right=t.cloneNode(!0)),this.mode===Dl.CARDBOARD||this.mode===Dl.STEREO?(t.left.style.display=t.style.display,t.right.style.display=t.style.display,t.style.display="none"):(t.style.display=t.left.style.display,t.left.style.display="none",t.right.style.display="none"),this.translateElement(n,i),this.container.appendChild(t.left),this.container.appendChild(t.right))},translateElement:function(e,t){if(!this.element._width||!this.element._height||!this.getContainer())return;let n,i,r,a,o,s,l;l=this.container,r=this.element,a=r._width/2,o=r._height/2,s=void 0!==r.verticalDelta?r.verticalDelta:40,n=e-a,i=t-o-s,this.mode!==Dl.CARDBOARD&&this.mode!==Dl.STEREO||!r.left||!r.right||e===l.clientWidth/2&&t===l.clientHeight/2?this.setElementStyle("transform",r,"translate("+n+"px, "+i+"px)"):(n=l.clientWidth/4-a+(e-l.clientWidth/2),i=l.clientHeight/2-o-s+(t-l.clientHeight/2),this.setElementStyle("transform",r.left,"translate("+n+"px, "+i+"px)"),n+=l.clientWidth/2,this.setElementStyle("transform",r.right,"translate("+n+"px, "+i+"px)"))},setElementStyle:function(e,t,n){const i=t.style;"transform"===e&&(i.webkitTransform=i.msTransform=i.transform=n)},setText:function(e){this.element&&(this.element.textContent=e)},setCursorHoverStyle:function(e){this.cursorStyle=e},addHoverText:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40;this.element||(this.element=document.createElement("div"),this.element.style.display="none",this.element.style.color="#fff",this.element.style.top=0,this.element.style.maxWidth="50%",this.element.style.maxHeight="50%",this.element.style.textShadow="0 0 3px #000000",this.element.style.fontFamily='"Trebuchet MS", Helvetica, sans-serif',this.element.style.position="absolute",this.element.classList.add("panolens-infospot"),this.element.verticalDelta=t),this.setText(e)},addHoverElement:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40;this.element||(this.element=e.cloneNode(!0),this.element.style.display="none",this.element.style.top=0,this.element.style.position="absolute",this.element.classList.add("panolens-infospot"),this.element.verticalDelta=t)},removeHoverElement:function(){this.element&&(this.element.left&&(this.container.removeChild(this.element.left),this.element.left=null),this.element.right&&(this.container.removeChild(this.element.right),this.element.right=null),this.container.removeChild(this.element),this.element=null)},lockHoverElement:function(){this.element&&(this.element.locked=!0)},unlockHoverElement:function(){this.element&&(this.element.locked=!1)},enableRaycast:function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.raycast=e?this.originalRaycast:()=>{}},show:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const{animated:t,hideAnimation:n,showAnimation:i,material:r}=this;t?(n.stop(),i.delay(e).start()):(this.enableRaycast(!0),r.opacity=1)},hide:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const{animated:t,hideAnimation:n,showAnimation:i,material:r,element:a}=this;if(a){const{style:e}=a;e.display="none"}t?(i.stop(),n.delay(e).start()):(this.enableRaycast(!1),r.opacity=0)},setFocusMethod:function(e){e&&(this.HANDLER_FOCUS=e.method)},focus:function(e,t){this.HANDLER_FOCUS&&(this.HANDLER_FOCUS(this.position,e,t),this.onDismiss())},dispose:function(){const{geometry:e,material:t}=this,{map:n}=t;this.removeHoverElement(),this.parent&&this.parent.remove(this),n&&(n.dispose(),t.map=null),e&&(e.dispose(),this.geometry=null),t&&(t.dispose(),this.material=null)}}),Hl.prototype=Object.assign(Object.create(je.prototype),{constructor:Hl,addControlBar:function(){if(this.container){var e,t,n,i,r=this;i="linear-gradient(bottom, rgba(0,0,0,0.2), rgba(0,0,0,0))",(e=document.createElement("div")).style.width="100%",e.style.height="44px",e.style.float="left",e.style.transform=e.style.webkitTransform=e.style.msTransform="translateY(-100%)",e.style.background="-webkit-"+i,e.style.background="-moz-"+i,e.style.background="-o-"+i,e.style.background="-ms-"+i,e.style.background=i,e.style.transition=this.DEFAULT_TRANSITION,e.style.pointerEvents="none",e.isHidden=!1,e.toggle=function(){e.isHidden=!e.isHidden,t=e.isHidden?"translateY(0)":"translateY(-100%)",n=e.isHidden?0:1,e.style.transform=e.style.webkitTransform=e.style.msTransform=t,e.style.opacity=n};var a=this.createDefaultMenu();this.mainMenu=this.createMainMenu(a),e.appendChild(this.mainMenu);var o=this.createMask();this.mask=o,this.container.appendChild(o),e.dispose=function(){r.fullscreenElement&&(e.removeChild(r.fullscreenElement),r.fullscreenElement.dispose(),r.fullscreenElement=null),r.settingElement&&(e.removeChild(r.settingElement),r.settingElement.dispose(),r.settingElement=null),r.videoElement&&(e.removeChild(r.videoElement),r.videoElement.dispose(),r.videoElement=null)},this.container.appendChild(e),this.mask.addEventListener("mousemove",this.PREVENT_EVENT_HANDLER,!0),this.mask.addEventListener("mouseup",this.PREVENT_EVENT_HANDLER,!0),this.mask.addEventListener("mousedown",this.PREVENT_EVENT_HANDLER,!0),this.mask.addEventListener(r.TOUCH_ENABLED?"touchend":"click",function(e){e.preventDefault(),e.stopPropagation(),r.mask.hide(),r.settingElement.deactivate()},!1),this.addEventListener("control-bar-toggle",e.toggle),this.barElement=e}else console.warn("Widget container not set")},createDefaultMenu:function(){var e,t=this;return e=function(e,n){return function(){t.dispatchEvent({type:"panolens-viewer-handler",method:e,data:n})}},[{title:"Control",subMenu:[{title:this.TOUCH_ENABLED?"Touch":"Mouse",handler:e("enableControl",Pl.ORBIT)},{title:"Sensor",handler:e("enableControl",Pl.DEVICEORIENTATION)}]},{title:"Mode",subMenu:[{title:"Normal",handler:e("disableEffect")},{title:"Cardboard",handler:e("enableEffect",Dl.CARDBOARD)},{title:"Stereoscopic",handler:e("enableEffect",Dl.STEREO)}]}]},addControlButton:function(e){let t;switch(e){case"fullscreen":t=this.createFullscreenButton(),this.fullscreenElement=t;break;case"setting":t=this.createSettingButton(),this.settingElement=t;break;case"video":t=this.createVideoControl(),this.videoElement=t;break;default:return}t&&this.barElement.appendChild(t)},createMask:function(){const e=document.createElement("div");return e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.width="100%",e.style.height="100%",e.style.background="transparent",e.style.display="none",e.show=function(){this.style.display="block"},e.hide=function(){this.style.display="none"},e},createSettingButton:function(){let e,t=this;return e=this.createCustomItem({style:{backgroundImage:'url("'+Ol.Setting+'")',webkitTransition:this.DEFAULT_TRANSITION,transition:this.DEFAULT_TRANSITION},onTap:function(e){e.preventDefault(),e.stopPropagation(),t.mainMenu.toggle(),this.activated?this.deactivate():this.activate()}}),e.activate=function(){this.style.transform="rotate3d(0,0,1,90deg)",this.activated=!0,t.mask.show()},e.deactivate=function(){this.style.transform="rotate3d(0,0,0,0)",this.activated=!1,t.mask.hide(),t.mainMenu&&t.mainMenu.visible&&t.mainMenu.hide(),t.activeSubMenu&&t.activeSubMenu.visible&&t.activeSubMenu.hide(),t.mainMenu&&t.mainMenu._width&&(t.mainMenu.changeSize(t.mainMenu._width),t.mainMenu.unslideAll())},e.activated=!1,e},createFullscreenButton:function(){let e,t,n=this,i=!1,r=!0;const{container:a}=this;if(t="panolens-style-addon",document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled){if(document.addEventListener("fullscreenchange",o,!1),document.addEventListener("webkitfullscreenchange",o,!1),document.addEventListener("mozfullscreenchange",o,!1),document.addEventListener("MSFullscreenChange",o,!1),e=this.createCustomItem({style:{backgroundImage:'url("'+Ol.FullscreenEnter+'")'},onTap:function(e){e.preventDefault(),e.stopPropagation(),r=!1,i?(document.exitFullscreen&&document.exitFullscreen(),document.msExitFullscreen&&document.msExitFullscreen(),document.mozCancelFullScreen&&document.mozCancelFullScreen(),document.webkitExitFullscreen&&document.webkitExitFullscreen(),i=!1):(a.requestFullscreen&&a.requestFullscreen(),a.msRequestFullscreen&&a.msRequestFullscreen(),a.mozRequestFullScreen&&a.mozRequestFullScreen(),a.webkitRequestFullscreen&&a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),i=!0),this.style.backgroundImage=i?'url("'+Ol.FullscreenLeave+'")':'url("'+Ol.FullscreenEnter+'")'}}),!document.querySelector(t)){const e=document.createElement("style");e.id=t,e.innerHTML=":-webkit-full-screen { width: 100% !important; height: 100% !important }",document.body.appendChild(e)}return e}function o(){r&&(i=!i,e.style.backgroundImage=i?'url("'+Ol.FullscreenLeave+'")':'url("'+Ol.FullscreenEnter+'")'),n.dispatchEvent({type:"panolens-viewer-handler",method:"onWindowResize"}),r=!0}},createVideoControl:function(){const e=document.createElement("span");return e.style.display="none",e.show=function(){e.style.display=""},e.hide=function(){e.style.display="none",e.controlButton.paused=!0,e.controlButton.update()},e.controlButton=this.createVideoControlButton(),e.seekBar=this.createVideoControlSeekbar(),e.appendChild(e.controlButton),e.appendChild(e.seekBar),e.dispose=function(){e.removeChild(e.controlButton),e.removeChild(e.seekBar),e.controlButton.dispose(),e.controlButton=null,e.seekBar.dispose(),e.seekBar=null},this.addEventListener("video-control-show",e.show),this.addEventListener("video-control-hide",e.hide),e},createVideoControlButton:function(){const e=this;const t=this.createCustomItem({style:{float:"left",backgroundImage:'url("'+Ol.VideoPlay+'")'},onTap:function(n){n.preventDefault(),n.stopPropagation(),e.dispatchEvent({type:"panolens-viewer-handler",method:"toggleVideoPlay",data:!this.paused}),this.paused=!this.paused,t.update()}});return t.paused=!0,t.update=function(e){this.paused=void 0!==e?e:this.paused,this.style.backgroundImage='url("'+(this.paused?Ol.VideoPlay:Ol.VideoPause)+'")'},t},createVideoControlSeekbar:function(){let e,t,n,i,r,a,o=this,s=!1;function l(e){e.stopPropagation(),s=!0,i=e.clientX||e.changedTouches&&e.changedTouches[0].clientX,r=parseInt(t.style.width)/100,o.container.addEventListener("mousemove",c,{passive:!0}),o.container.addEventListener("mouseup",u,{passive:!0}),o.container.addEventListener("touchmove",c,{passive:!0}),o.container.addEventListener("touchend",u,{passive:!0})}function c(t){s&&(a=((t.clientX||t.changedTouches&&t.changedTouches[0].clientX)-i)/e.clientWidth,a=r+a,a=a>1?1:a<0?0:a,e.setProgress(a),o.dispatchEvent({type:"panolens-viewer-handler",method:"setVideoCurrentTime",data:a}))}function u(e){e.stopPropagation(),s=!1,d()}function d(){o.container.removeEventListener("mousemove",c,!1),o.container.removeEventListener("mouseup",u,!1),o.container.removeEventListener("touchmove",c,!1),o.container.removeEventListener("touchend",u,!1)}return t=document.createElement("div"),t.style.width="0%",t.style.height="100%",t.style.backgroundColor="#fff",n=document.createElement("div"),n.style.float="right",n.style.width="14px",n.style.height="14px",n.style.transform="translate(7px, -5px)",n.style.borderRadius="50%",n.style.backgroundColor="#ddd",n.addEventListener("mousedown",l,{passive:!0}),n.addEventListener("touchstart",l,{passive:!0}),t.appendChild(n),e=this.createCustomItem({style:{float:"left",width:"30%",height:"4px",marginTop:"20px",backgroundColor:"rgba(188,188,188,0.8)"},onTap:function(t){if(t.preventDefault(),t.stopPropagation(),t.target===n)return;const i=t.changedTouches&&t.changedTouches.length>0?(t.changedTouches[0].pageX-t.target.getBoundingClientRect().left)/this.clientWidth:t.offsetX/this.clientWidth;o.dispatchEvent({type:"panolens-viewer-handler",method:"setVideoCurrentTime",data:i}),e.setProgress(t.offsetX/this.clientWidth)},onDispose:function(){d(),t=null,n=null}}),e.appendChild(t),e.setProgress=function(e){t.style.width=100*e+"%"},this.addEventListener("video-update",function(t){e.setProgress(t.percentage)}),e.progressElement=t,e.progressElementControl=n,e},createMenuItem:function(e){const t=this,n=document.createElement("a");return n.textContent=e,n.style.display="block",n.style.padding="10px",n.style.textDecoration="none",n.style.cursor="pointer",n.style.pointerEvents="auto",n.style.transition=this.DEFAULT_TRANSITION,n.slide=function(e){this.style.transform="translateX("+(e?"":"-")+"100%)"},n.unslide=function(){this.style.transform="translateX(0)"},n.setIcon=function(e){this.icon&&(this.icon.style.backgroundImage="url("+e+")")},n.setSelectionTitle=function(e){this.selection&&(this.selection.textContent=e)},n.addSelection=function(e){const t=document.createElement("span");return t.style.fontSize="13px",t.style.fontWeight="300",t.style.float="right",this.selection=t,this.setSelectionTitle(e),this.appendChild(t),this},n.addIcon=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ol.ChevronRight,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=document.createElement("span");return i.style.float=t?"left":"right",i.style.width="17px",i.style.height="17px",i.style["margin"+(t?"Right":"Left")]="12px",i.style.backgroundSize="cover",n&&(i.style.transform="rotateZ(180deg)"),this.icon=i,this.setIcon(e),this.appendChild(i),this},n.addSubMenu=function(e,n){return this.subMenu=t.createSubMenu(e,n),this},n.addEventListener("mouseenter",function(){this.style.backgroundColor="#e0e0e0"},!1),n.addEventListener("mouseleave",function(){this.style.backgroundColor="#fafafa"},!1),n},createMenuItemHeader:function(e){const t=this.createMenuItem(e);return t.style.borderBottom="1px solid #333",t.style.paddingBottom="15px",t},createMainMenu:function(e){let t=this,n=this.createMenu();function i(e){e.preventDefault(),e.stopPropagation();let n=t.mainMenu,i=this.subMenu;n.hide(),n.slideAll(),n.parentElement.appendChild(i),t.activeMainItem=this,t.activeSubMenu=i,window.requestAnimationFrame(function(){n.changeSize(i.clientWidth),i.show(),i.unslideAll()})}n._width=200,n.changeSize(n._width);for(var r=0;r<e.length;r++){var a=n.addItem(e[r].title);if(a.style.paddingLeft="20px",a.addIcon().addEventListener(t.TOUCH_ENABLED?"touchend":"click",i,!1),e[r].subMenu&&e[r].subMenu.length>0){var o=e[r].subMenu[0].title;a.addSelection(o).addSubMenu(e[r].title,e[r].subMenu)}}return n},createSubMenu:function(e,t){let n,i=this,r=this.createMenu();function a(e){e.preventDefault(),e.stopPropagation(),n=i.mainMenu,n.changeSize(n._width),n.unslideAll(),n.show(),r.slideAll(!0),r.hide(),"header"!==this.type&&(r.setActiveItem(this),i.activeMainItem.setSelectionTitle(this.textContent),this.handler&&this.handler())}r.items=t,r.activeItem=null,r.addHeader(e).addIcon(void 0,!0,!0).addEventListener(i.TOUCH_ENABLED?"touchend":"click",a,!1);for(let e=0;e<t.length;e++){const n=r.addItem(t[e].title);n.style.fontWeight=300,n.handler=t[e].handler,n.addIcon(" ",!0),n.addEventListener(i.TOUCH_ENABLED?"touchend":"click",a,!1),r.activeItem||r.setActiveItem(n)}return r.slideAll(!0),r},createMenu:function(){const e=this,t=document.createElement("span"),n=t.style;return n.padding="5px 0",n.position="fixed",n.bottom="100%",n.right="14px",n.backgroundColor="#fafafa",n.fontFamily="Helvetica Neue",n.fontSize="14px",n.visibility="hidden",n.opacity=0,n.boxShadow="0 0 12pt rgba(0,0,0,0.25)",n.borderRadius="2px",n.overflow="hidden",n.willChange="width, height, opacity",n.pointerEvents="auto",n.transition=this.DEFAULT_TRANSITION,t.visible=!1,t.changeSize=function(e,t){e&&(this.style.width=e+"px"),t&&(this.style.height=t+"px")},t.show=function(){this.style.opacity=1,this.style.visibility="visible",this.visible=!0},t.hide=function(){this.style.opacity=0,this.style.visibility="hidden",this.visible=!1},t.toggle=function(){this.visible?this.hide():this.show()},t.slideAll=function(e){for(let n=0;n<t.children.length;n++)t.children[n].slide&&t.children[n].slide(e)},t.unslideAll=function(){for(let e=0;e<t.children.length;e++)t.children[e].unslide&&t.children[e].unslide()},t.addHeader=function(t){const n=e.createMenuItemHeader(t);return n.type="header",this.appendChild(n),n},t.addItem=function(t){const n=e.createMenuItem(t);return n.type="item",this.appendChild(n),n},t.setActiveItem=function(e){this.activeItem&&this.activeItem.setIcon(" "),e.setIcon(Ol.Check),this.activeItem=e},t.addEventListener("mousemove",this.PREVENT_EVENT_HANDLER,!0),t.addEventListener("mouseup",this.PREVENT_EVENT_HANDLER,!0),t.addEventListener("mousedown",this.PREVENT_EVENT_HANDLER,!0),t},createCustomItem:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this,n=e.element||document.createElement("span"),{onDispose:i}=e;return n.style.cursor="pointer",n.style.float="right",n.style.width="44px",n.style.height="100%",n.style.backgroundSize="60%",n.style.backgroundRepeat="no-repeat",n.style.backgroundPosition="center",n.style.webkitUserSelect=n.style.MozUserSelect=n.style.userSelect="none",n.style.position="relative",n.style.pointerEvents="auto",n.addEventListener(t.TOUCH_ENABLED?"touchstart":"mouseenter",function(){n.style.filter=n.style.webkitFilter="drop-shadow(0 0 5px rgba(255,255,255,1))"},{passive:!0}),n.addEventListener(t.TOUCH_ENABLED?"touchend":"mouseleave",function(){n.style.filter=n.style.webkitFilter=""},{passive:!0}),this.mergeStyleOptions(n,e.style),e.onTap&&n.addEventListener(t.TOUCH_ENABLED?"touchend":"click",e.onTap,!1),n.dispose=function(){n.removeEventListener(t.TOUCH_ENABLED?"touchend":"click",e.onTap,!1),i&&e.onDispose()},n},mergeStyleOptions:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(let n in t)t.hasOwnProperty(n)&&(e.style[n]=t[n]);return e},dispose:function(){this.barElement&&(this.container.removeChild(this.barElement),this.barElement.dispose(),this.barElement=null)}}),jl.prototype=Object.assign(Object.create(wn.prototype),{constructor:jl,add:function(e){let t;if(arguments.length>1){for(var n=0;n<arguments.length;n++)this.add(arguments[n]);return this}if(e instanceof Gl){if(t=e,e.dispatchEvent){const{container:t}=this;t&&e.dispatchEvent({type:"panolens-container",container:t}),e.dispatchEvent({type:"panolens-infospot-focus",method:function(e,t,n){this.dispatchEvent({type:"panolens-viewer-handler",method:"tweenControlCenter",data:[e,t,n]})}.bind(this)})}}else t=new Xt,t.scale.x=-1,t.scalePlaceHolder=!0,t.add(e);Xt.prototype.add.call(this,t)},load:function(){this.onLoad()},onClick:function(e){e.intersects&&0===e.intersects.length&&this.traverse(function(e){e.dispatchEvent({type:"dismiss"})})},setContainer:function(e){let t;e instanceof HTMLElement?t=e:e&&e.container&&(t=e.container),t&&(this.children.forEach(function(e){e instanceof Gl&&e.dispatchEvent&&e.dispatchEvent({type:"panolens-container",container:t})}),this.container=t)},onLoad:function(){this.loaded=!0,this.dispatchEvent({type:"load"})},onProgress:function(e){this.dispatchEvent({type:"progress",progress:e})},onError:function(){this.dispatchEvent({type:"error"})},getZoomLevel:function(){let e;return e=window.innerWidth<=800?this.ImageQualityFair:window.innerWidth>800&&window.innerWidth<=1280?this.ImageQualityMedium:window.innerWidth>1280&&window.innerWidth<=1920?this.ImageQualityHigh:window.innerWidth>1920?this.ImageQualitySuperHigh:this.ImageQualityLow,e},updateTexture:function(e){this.material.map=e,this.material.needsUpdate=!0},toggleInfospotVisibility:function(e,t){t=void 0!==t?t:0;const n=void 0!==e?e:!this.isInfospotVisible;this.traverse(function(e){e instanceof Gl&&(n?e.show(t):e.hide(t))}),this.isInfospotVisible=n,this.infospotAnimation.onComplete(function(){this.dispatchEvent({type:"infospot-animation-complete",visible:n})}.bind(this)).delay(t).start()},setLinkingImage:function(e,t){this.linkingImageURL=e,this.linkingImageScale=t},link:function(e,t,n,i){let r,a;if(this.visible=!0,!t)return void console.warn("Please specify infospot position for linking");r=void 0!==n?n:void 0!==e.linkingImageScale?e.linkingImageScale:300,a=i||(e.linkingImageURL?e.linkingImageURL:Ol.Arrow);const o=new Gl(r,a);o.position.copy(t),o.toPanorama=e,o.addEventListener("click",function(){this.dispatchEvent({type:"panolens-viewer-handler",method:"setPanorama",data:e})}.bind(this)),this.linkedSpots.push(o),this.add(o),this.visible=!1},reset:function(){this.children.length=0},setupTransitions:function(){this.fadeInAnimation=new Vl.Tween(this.material).easing(Vl.Easing.Quartic.Out).onStart(function(){this.visible=!0,this.dispatchEvent({type:"enter-fade-start"})}.bind(this)),this.fadeOutAnimation=new Vl.Tween(this.material).easing(Vl.Easing.Quartic.Out).onComplete(function(){this.visible=!1,this.dispatchEvent({type:"leave-complete"})}.bind(this)),this.enterTransition=new Vl.Tween(this).easing(Vl.Easing.Quartic.Out).onComplete(function(){this.dispatchEvent({type:"enter-complete"})}.bind(this)).start(),this.leaveTransition=new Vl.Tween(this).easing(Vl.Easing.Quartic.Out)},onFadeAnimationUpdate:function(){const e=this.material.opacity,{uniforms:t}=this.material;t&&t.opacity&&(t.opacity.value=e)},fadeIn:function(e){e=e>=0?e:this.animationDuration,this.fadeOutAnimation.stop(),this.fadeInAnimation.to({opacity:1},e).onUpdate(this.onFadeAnimationUpdate.bind(this)).onComplete(function(){this.toggleInfospotVisibility(!0,e/2),this.dispatchEvent({type:"enter-fade-complete"})}.bind(this)).start()},fadeOut:function(e){e=e>=0?e:this.animationDuration,this.fadeInAnimation.stop(),this.fadeOutAnimation.to({opacity:0},e).onUpdate(this.onFadeAnimationUpdate.bind(this)).start()},onEnter:function(){const e=this.animationDuration;this.leaveTransition.stop(),this.enterTransition.to({},e).onStart(function(){this.dispatchEvent({type:"enter-start"}),this.loaded?this.fadeIn(e):this.load()}.bind(this)).start(),this.dispatchEvent({type:"enter"}),this.children.forEach(e=>{e.dispatchEvent({type:"panorama-enter"})}),this.active=!0},onLeave:function(){const e=this.animationDuration;this.enterTransition.stop(),this.leaveTransition.to({},e).onStart(function(){this.dispatchEvent({type:"leave-start"}),this.fadeOut(e),this.toggleInfospotVisibility(!1)}.bind(this)).start(),this.dispatchEvent({type:"leave"}),this.children.forEach(e=>{e.dispatchEvent({type:"panorama-leave"})}),this.active=!1},dispose:function(){this.infospotAnimation.stop(),this.fadeInAnimation.stop(),this.fadeOutAnimation.stop(),this.enterTransition.stop(),this.leaveTransition.stop(),this.dispatchEvent({type:"panolens-viewer-handler",method:"onPanoramaDispose",data:this}),function e(t){const{geometry:n,material:i}=t;for(var r=t.children.length-1;r>=0;r--)e(t.children[r]),t.remove(t.children[r]);t instanceof Gl&&t.dispose(),n&&(n.dispose(),t.geometry=null),i&&(i.dispose(),t.material=null)}(this),this.parent&&this.parent.remove(this)}}),zl.prototype=Object.assign(Object.create(jl.prototype),{constructor:zl,load:function(e){(e=e||this.src)?"string"==typeof e?kl.load(e,this.onLoad.bind(this),this.onProgress.bind(this),this.onError.bind(this)):e instanceof HTMLImageElement&&this.onLoad(new Rt(e)):console.warn("Image source undefined")},onLoad:function(e){e.minFilter=e.magFilter=et,e.needsUpdate=!0,this.updateTexture(e),window.requestAnimationFrame(jl.prototype.onLoad.bind(this))},reset:function(){jl.prototype.reset.call(this)},dispose:function(){const{material:{map:e}}=this;Ro.remove(this.src),e&&e.dispose(),jl.prototype.dispose.call(this)}}),Zl.prototype=Object.assign(Object.create(jl.prototype),{constructor:Zl}),ql.prototype=Object.assign(Object.create(jl.prototype),{constructor:ql,load:function(){Fl.load(this.images,this.onLoad.bind(this),this.onProgress.bind(this),this.onError.bind(this))},onLoad:function(e){this.material.uniforms.tCube.value=e,jl.prototype.onLoad.call(this)},dispose:function(){const{value:e}=this.material.uniforms.tCube;this.images.forEach(e=>{Ro.remove(e)}),e instanceof kn&&e.dispose(),jl.prototype.dispose.call(this)}}),Wl.prototype=Object.assign(Object.create(ql.prototype),{constructor:Wl}),Yl.prototype=Object.assign(Object.create(jl.prototype),{constructor:Yl,isMobile:function(){let e=!1;return t=window.navigator.userAgent||window.navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e;var t},load:function(){const{muted:e,loop:t,autoplay:n,playsinline:i,crossOrigin:r}=this.options,a=this.videoElement,o=this.material,s=this.onProgress.bind(this),l=this.onLoad.bind(this);a.loop=t,a.autoplay=n,a.playsinline=i,a.crossOrigin=r,a.muted=e,i&&(a.setAttribute("playsinline",""),a.setAttribute("webkit-playsinline",""));const c=function(){this.setVideoTexture(a),n&&this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!1}),this.isMobile()&&(a.pause(),n&&e?this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!1}):this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!0}));window.requestAnimationFrame(()=>{o.map.needsUpdate=!0,s({loaded:1,total:1}),l()})};if(a.readyState>2)c.call(this);else{if(0===a.querySelectorAll("source").length){const e=document.createElement("source");e.src=this.src,a.appendChild(e)}a.load()}a.addEventListener("loadeddata",c.bind(this)),a.addEventListener("timeupdate",function(){this.videoProgress=a.duration>=0?a.currentTime/a.duration:0,this.dispatchEvent({type:"panolens-viewer-handler",method:"onVideoUpdate",data:this.videoProgress})}.bind(this)),a.addEventListener("ended",function(){t||(this.resetVideo(),this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!0}))}.bind(this),!1)},setVideoTexture:function(e){if(!e)return;const t=new kr(e);t.minFilter=et,t.magFilter=et,t.format=st,this.updateTexture(t)},reset:function(){this.videoElement=void 0,jl.prototype.reset.call(this)},isVideoPaused:function(){return this.videoElement.paused},toggleVideo:function(){const e=this.videoElement;e&&e[e.paused?"play":"pause"]()},setVideoCurrentTime:function(e){let{percentage:t}=e;const n=this.videoElement;n&&!Number.isNaN(t)&&1!==t&&(n.currentTime=n.duration*t,this.dispatchEvent({type:"panolens-viewer-handler",method:"onVideoUpdate",data:t}))},playVideo:function(){const e=this.videoElement,t=this.playVideo.bind(this),n=this.dispatchEvent.bind(this);e&&e.paused&&e.play().then(()=>{n({type:"play"})}).catch(e=>{window.requestAnimationFrame(t),n({type:"play-error",error:e})})},pauseVideo:function(){const e=this.videoElement;e&&!e.paused&&e.pause(),this.dispatchEvent({type:"pause"})},resumeVideoProgress:function(){const e=this.videoElement;e.readyState>=4&&e.autoplay&&!this.isMobile()?(this.playVideo(),this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!1})):(this.pauseVideo(),this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!0})),this.setVideoCurrentTime({percentage:this.videoProgress})},resetVideo:function(){this.videoElement&&this.setVideoCurrentTime({percentage:0})},isVideoMuted:function(){return this.videoElement.muted},muteVideo:function(){const e=this.videoElement;e&&!e.muted&&(e.muted=!0),this.dispatchEvent({type:"volumechange"})},unmuteVideo:function(){const e=this.videoElement;e&&this.isVideoMuted()&&(e.muted=!1),this.dispatchEvent({type:"volumechange"})},getVideoElement:function(){return this.videoElement},dispose:function(){const{material:{map:e}}=this;this.pauseVideo(),this.removeEventListener("leave",this.pauseVideo.bind(this)),this.removeEventListener("enter-fade-start",this.resumeVideoProgress.bind(this)),this.removeEventListener("video-toggle",this.toggleVideo.bind(this)),this.removeEventListener("video-time",this.setVideoCurrentTime.bind(this)),e&&e.dispose(),jl.prototype.dispose.call(this)}}),Object.assign(Kl.prototype,{constructor:Kl,setProgress:function(e,t){this.onProgress&&this.onProgress({loaded:e,total:t})},adaptTextureToZoom:function(){const e=this.widths[this._zoom],t=this.heights[this._zoom],n=this.maxW,i=this.maxH;this._wc=Math.ceil(e/n),this._hc=Math.ceil(t/i);for(let r=0;r<this._hc;r++)for(let a=0;a<this._wc;a++){const o=document.createElement("canvas");a<this._wc-1?o.width=n:o.width=e-n*a,r<this._hc-1?o.height=i:o.height=t-i*r,this._canvas.push(o),this._ctx.push(o.getContext("2d"))}},composeFromTile:function(e,t,n){const i=this.maxW,r=this.maxH;e*=512,t*=512;const a=Math.floor(e/i),o=Math.floor(t/r);e-=a*i,t-=o*r,this._ctx[o*this._wc+a].drawImage(n,0,0,n.width,n.height,e,t,512,512),this.progress()},progress:function(){this._count++,this.setProgress(this._count,this._total),this._count===this._total&&(this.canvas=this._canvas,this.panoId=this._panoId,this.zoom=this._zoom,this.onPanoramaLoad&&this.onPanoramaLoad(this._canvas[0]))},composePanorama:function(){this.setProgress(0,1);const e=this.levelsW[this._zoom],t=this.levelsH[this._zoom],n=this;this._count=0,this._total=e*t;const{useWebGL:i}=this._parameters;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const e="https://geo0.ggpht.com/cbk?cb_client=maps_sv.tactile&authuser=0&hl=en&output=tile&zoom="+this._zoom+"&x="+t+"&y="+r+"&panoid="+this._panoId+"&nbt&fover=2";(function(t,r){if(i){const i=kl.load(e,null,function(){n.composeFromTile(t,r,i)})}else{const i=new Image;i.addEventListener("load",function(){n.composeFromTile(t,r,this)}),i.crossOrigin="",i.src=e}})(t,r)}},load:function(e){this.loadPano(e)},loadPano:function(e){const t=this;this._panoClient.getPanoramaById(e,function(e,n){n===google.maps.StreetViewStatus.OK&&(t.result=e,t.copyright=e.copyright,t._panoId=e.location.pano,t.composePanorama())})},setZoom:function(e){this._zoom=e,this.adaptTextureToZoom()}}),Xl.prototype=Object.assign(Object.create(zl.prototype),{constructor:Xl,load:function(e){this.loadRequested=!0,(e=e||this.panoId||{})&&this.gsvLoader&&this.loadGSVLoader(e)},setupGoogleMapAPI:function(e){const t=document.createElement("script");t.src="https://maps.googleapis.com/maps/api/js?",t.src+=e?"key="+e:"",t.onreadystatechange=this.setGSVLoader.bind(this),t.onload=this.setGSVLoader.bind(this),document.querySelector("head").appendChild(t)},setGSVLoader:function(){this.gsvLoader=new Kl,this.loadRequested&&this.load()},getGSVLoader:function(){return this.gsvLoader},loadGSVLoader:function(e){this.loadRequested=!1,this.gsvLoader.onProgress=this.onProgress.bind(this),this.gsvLoader.onPanoramaLoad=this.onLoad.bind(this),this.gsvLoader.setZoom(this.getZoomLevel()),this.gsvLoader.load(e),this.gsvLoader.loaded=!0},onLoad:function(e){zl.prototype.onLoad.call(this,new Rt(e))},reset:function(){this.gsvLoader=void 0,zl.prototype.reset.call(this)}});const Ql={uniforms:{tDiffuse:{value:new Rt},resolution:{value:1},transform:{value:new kt},zoom:{value:1},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float resolution;","uniform mat4 transform;","uniform float zoom;","uniform float opacity;","varying vec2 vUv;","const float PI = 3.141592653589793;","void main(){","vec2 position = -1.0 +  2.0 * vUv;","position *= vec2( zoom * resolution, zoom * 0.5 );","float x2y2 = position.x * position.x + position.y * position.y;","vec3 sphere_pnt = vec3( 2. * position, x2y2 - 1. ) / ( x2y2 + 1. );","sphere_pnt = vec3( transform * vec4( sphere_pnt, 1.0 ) );","vec2 sampleUV = vec2(","(atan(sphere_pnt.y, sphere_pnt.x) / PI + 1.0) * 0.5,","(asin(sphere_pnt.z) / PI + 0.5)",");","gl_FragColor = texture2D( tDiffuse, sampleUV );","gl_FragColor.a *= opacity;","}"].join("\n")};function Jl(){let e=arguments.length>1?arguments[1]:void 0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;"image"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image")&&zl.call(this,e,this.createGeometry(t,n),this.createMaterial(t)),this.size=t,this.ratio=n,this.EPS=1e-6,this.frameId=null,this.dragging=!1,this.userMouse=new _t,this.quatA=new Et,this.quatB=new Et,this.quatCur=new Et,this.quatSlerp=new Et,this.vectorX=new bt(1,0,0),this.vectorY=new bt(0,1,0),this.addEventListener("window-resize",this.onWindowResize)}function $l(e,t,n){Jl.call(this,"image",e,t,n)}function ec(e){const t=new Fa(5e3,60,40),n=new Sn({visible:!1});jl.call(this,t,n),this.media=new Bl(e),this.radius=5e3,this.addEventListener("enter",this.start.bind(this)),this.addEventListener("leave",this.stop.bind(this)),this.addEventListener("panolens-container",this.onPanolensContainer.bind(this)),this.addEventListener("panolens-scene",this.onPanolensScene.bind(this))}function tc(e,t){this.object=e,this.domElement=void 0!==t?t:document,this.frameId=null,this.enabled=!0,this.target=new bt,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.noRotate=!1,this.rotateSpeed=-.15,this.noPan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.momentumDampingFactor=.9,this.momentumScalingFactor=-.005,this.momentumKeydownFactor=20,this.minFov=30,this.maxFov=120,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:ze,ZOOM:Ze,PAN:qe};var n,i,r,a,o,s=this,l=1e-7,c=1e-4,u=new _t,d=new _t,h=new _t,f=new _t,p=new _t,g=new _t,m=new bt,v=new bt,y=new _t,_=new _t,E=new _t,b=0,T=0,S=0,w=0,A=1,R=new bt,x=new bt,I=new Et,L=0,M=0,C=!1,P=-1,D=0,O=1,N=2,k=3,F=4,B=5,U=P;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom;var V=(new Et).setFromUnitVectors(e.up,new bt(0,1,0)),G=V.clone().inverse(),H={type:"change"},j={type:"start"},z={type:"end"};function Z(){return 2*Math.PI/60/60*s.autoRotateSpeed}function q(){return Math.pow(.95,s.zoomSpeed)}function W(e){if(C=!1,L=M=0,!1!==s.enabled){if(e.preventDefault(),e.button===s.mouseButtons.ORBIT){if(!0===s.noRotate)return;U=D,u.set(e.clientX,e.clientY)}else if(e.button===s.mouseButtons.ZOOM){if(!0===s.noZoom)return;U=O,y.set(e.clientX,e.clientY)}else if(e.button===s.mouseButtons.PAN){if(!0===s.noPan)return;U=N,f.set(e.clientX,e.clientY)}U!==P&&(document.addEventListener("mousemove",Y,!1),document.addEventListener("mouseup",K,!1),s.dispatchEvent(j)),s.update()}}function Y(e){if(!1!==s.enabled){e.preventDefault();var t=s.domElement===document?s.domElement.body:s.domElement;if(U===D){if(!0===s.noRotate)return;d.set(e.clientX,e.clientY),h.subVectors(d,u),s.rotateLeft(2*Math.PI*h.x/t.clientWidth*s.rotateSpeed),s.rotateUp(2*Math.PI*h.y/t.clientHeight*s.rotateSpeed),u.copy(d),n&&(L=e.clientX-n.clientX,M=e.clientY-n.clientY),n=e}else if(U===O){if(!0===s.noZoom)return;_.set(e.clientX,e.clientY),E.subVectors(_,y),E.y>0?s.dollyIn():E.y<0&&s.dollyOut(),y.copy(_)}else if(U===N){if(!0===s.noPan)return;p.set(e.clientX,e.clientY),g.subVectors(p,f),s.pan(g.x,g.y),f.copy(p)}U!==P&&s.update()}}function K(){C=!0,n=void 0,!1!==s.enabled&&(document.removeEventListener("mousemove",Y,!1),document.removeEventListener("mouseup",K,!1),s.dispatchEvent(z),U=P)}function X(e){if(!1!==s.enabled&&!0!==s.noZoom&&U===P){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?(s.object.fov=s.object.fov<s.maxFov?s.object.fov+1:s.maxFov,s.object.updateProjectionMatrix()):t<0&&(s.object.fov=s.object.fov>s.minFov?s.object.fov-1:s.minFov,s.object.updateProjectionMatrix()),s.update(),s.dispatchEvent(H),s.dispatchEvent(j),s.dispatchEvent(z)}}function Q(e){switch(e.keyCode){case s.keys.UP:i=!1;break;case s.keys.BOTTOM:r=!1;break;case s.keys.LEFT:a=!1;break;case s.keys.RIGHT:o=!1}}function J(e){if(!1!==s.enabled&&!0!==s.noKeys&&!0!==s.noRotate){switch(e.keyCode){case s.keys.UP:i=!0;break;case s.keys.BOTTOM:r=!0;break;case s.keys.LEFT:a=!0;break;case s.keys.RIGHT:o=!0}(i||r||a||o)&&(C=!0,i&&(M=-s.rotateSpeed*s.momentumKeydownFactor),r&&(M=s.rotateSpeed*s.momentumKeydownFactor),a&&(L=-s.rotateSpeed*s.momentumKeydownFactor),o&&(L=s.rotateSpeed*s.momentumKeydownFactor))}}function $(e){if(C=!1,L=M=0,!1!==s.enabled){switch(e.touches.length){case 1:if(!0===s.noRotate)return;U=k,u.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(!0===s.noZoom)return;U=F;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);y.set(0,i);break;case 3:if(!0===s.noPan)return;U=B,f.set(e.touches[0].pageX,e.touches[0].pageY);break;default:U=P}U!==P&&s.dispatchEvent(j)}}function ee(e){if(!1!==s.enabled){e.preventDefault(),e.stopPropagation();var t=s.domElement===document?s.domElement.body:s.domElement;switch(e.touches.length){case 1:if(!0===s.noRotate||U!==k)return;d.set(e.touches[0].pageX,e.touches[0].pageY),h.subVectors(d,u),s.rotateLeft(2*Math.PI*h.x/t.clientWidth*s.rotateSpeed),s.rotateUp(2*Math.PI*h.y/t.clientHeight*s.rotateSpeed),u.copy(d),n&&(L=e.touches[0].pageX-n.pageX,M=e.touches[0].pageY-n.pageY),n={pageX:e.touches[0].pageX,pageY:e.touches[0].pageY},s.update();break;case 2:if(!0===s.noZoom||U!==F)return;var i=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(i*i+r*r);_.set(0,a),E.subVectors(_,y),E.y<0?(s.object.fov=s.object.fov<s.maxFov?s.object.fov+1:s.maxFov,s.object.updateProjectionMatrix()):E.y>0&&(s.object.fov=s.object.fov>s.minFov?s.object.fov-1:s.minFov,s.object.updateProjectionMatrix()),y.copy(_),s.update(),s.dispatchEvent(H);break;case 3:if(!0===s.noPan||U!==B)return;p.set(e.touches[0].pageX,e.touches[0].pageY),g.subVectors(p,f),s.pan(g.x,g.y),f.copy(p),s.update();break;default:U=P}}}function te(){C=!0,n=void 0,!1!==s.enabled&&(s.dispatchEvent(z),U=P)}this.setLastQuaternion=function(e){I.copy(e),s.object.quaternion.copy(e)},this.getLastPosition=function(){return x},this.rotateLeft=function(e){void 0===e&&(e=Z()),w-=e},this.rotateUp=function(e){void 0===e&&(e=Z()),S-=e},this.panLeft=function(e){var t=this.object.matrix.elements;m.set(t[0],t[1],t[2]),m.multiplyScalar(-e),R.add(m)},this.panUp=function(e){var t=this.object.matrix.elements;m.set(t[4],t[5],t[6]),m.multiplyScalar(e),R.add(m)},this.pan=function(e,t){var n=s.domElement===document?s.domElement.body:s.domElement;if(s.object instanceof ur){var i=s.object.position.clone().sub(s.target).length();i*=Math.tan(s.object.fov/2*Math.PI/180),s.panLeft(2*e*i/n.clientHeight),s.panUp(2*t*i/n.clientHeight)}else s.object instanceof cs?(s.panLeft(e*(s.object.right-s.object.left)/n.clientWidth),s.panUp(t*(s.object.top-s.object.bottom)/n.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.momentum=function(){if(C){if(Math.abs(L)<c&&Math.abs(M)<c)return void(C=!1);M*=this.momentumDampingFactor,L*=this.momentumDampingFactor,w-=this.momentumScalingFactor*L,S-=this.momentumScalingFactor*M}},this.dollyIn=function(e){void 0===e&&(e=q()),s.object instanceof ur?A/=e:s.object instanceof cs?(s.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*e)),s.object.updateProjectionMatrix(),s.dispatchEvent(H)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.dollyOut=function(e){void 0===e&&(e=q()),s.object instanceof ur?A*=e:s.object instanceof cs?(s.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/e)),s.object.updateProjectionMatrix(),s.dispatchEvent(H)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.update=function(e){var t=this.object.position;v.copy(t).sub(this.target),v.applyQuaternion(V),b=Math.atan2(v.x,v.z),T=Math.atan2(Math.sqrt(v.x*v.x+v.z*v.z),v.y),this.autoRotate&&U===P&&this.rotateLeft(Z()),this.momentum(),b+=w,T+=S,b=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,b)),T=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,T)),T=Math.max(l,Math.min(Math.PI-l,T));var n=v.length()*A;n=Math.max(this.minDistance,Math.min(this.maxDistance,n)),this.target.add(R),v.x=n*Math.sin(T)*Math.sin(b),v.y=n*Math.cos(T),v.z=n*Math.sin(T)*Math.cos(b),v.applyQuaternion(G),t.copy(this.target).add(v),this.object.lookAt(this.target),w=0,S=0,A=1,R.set(0,0,0),(x.distanceToSquared(this.object.position)>l||8*(1-I.dot(this.object.quaternion))>l)&&(!0!==e&&this.dispatchEvent(H),x.copy(this.object.position),I.copy(this.object.quaternion))},this.reset=function(){U=P,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(H),this.update()},this.getPolarAngle=function(){return T},this.getAzimuthalAngle=function(){return b},this.dispose=function(){this.domElement.removeEventListener("mousedown",W),this.domElement.removeEventListener("mousewheel",X),this.domElement.removeEventListener("DOMMouseScroll",X),this.domElement.removeEventListener("touchstart",$),this.domElement.removeEventListener("touchend",te),this.domElement.removeEventListener("touchmove",ee),window.removeEventListener("keyup",Q),window.removeEventListener("keydown",J)},this.domElement.addEventListener("mousedown",W,{passive:!1}),this.domElement.addEventListener("mousewheel",X,{passive:!1}),this.domElement.addEventListener("DOMMouseScroll",X,{passive:!1}),this.domElement.addEventListener("touchstart",$,{passive:!1}),this.domElement.addEventListener("touchend",te,{passive:!1}),this.domElement.addEventListener("touchmove",ee,{passive:!1}),window.addEventListener("keyup",Q,{passive:!1}),window.addEventListener("keydown",J,{passive:!1}),this.update()}function nc(e,t){var n=this,i={type:"change"},r=0,a=0,o=0,s=0;this.camera=e,this.camera.rotation.reorder("YXZ"),this.domElement=void 0!==t?t:document,this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alpha=0,this.alphaOffsetAngle=0;var l=function(e){n.deviceOrientation=e},c=function(){n.screenOrientation=window.orientation||0},u=function(e){e.preventDefault(),e.stopPropagation(),o=e.touches[0].pageX,s=e.touches[0].pageY},d=function(e){e.preventDefault(),e.stopPropagation(),r+=yt.degToRad((e.touches[0].pageX-o)/4),a+=yt.degToRad((s-e.touches[0].pageY)/4),n.updateAlphaOffsetAngle(r),o=e.touches[0].pageX,s=e.touches[0].pageY};this.connect=function(){c(),window.addEventListener("orientationchange",c,{passive:!0}),window.addEventListener("deviceorientation",l,{passive:!0}),window.addEventListener("deviceorientation",this.update.bind(this),{passive:!0}),n.domElement.addEventListener("touchstart",u,{passive:!1}),n.domElement.addEventListener("touchmove",d,{passive:!1}),n.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",c,!1),window.removeEventListener("deviceorientation",l,!1),window.removeEventListener("deviceorientation",this.update.bind(this),!1),n.domElement.removeEventListener("touchstart",u,!1),n.domElement.removeEventListener("touchmove",d,!1),n.enabled=!1},this.update=function(e){if(!1!==n.enabled){var t=n.deviceOrientation.alpha?yt.degToRad(n.deviceOrientation.alpha)+n.alphaOffsetAngle:0,r=n.deviceOrientation.beta?yt.degToRad(n.deviceOrientation.beta):0,o=n.deviceOrientation.gamma?yt.degToRad(n.deviceOrientation.gamma):0,s=n.screenOrientation?yt.degToRad(n.screenOrientation):0;(function(e,t,i,r,o){var s,l=new bt(0,0,1),c=new Wt,u=new Et,d=new Et(-Math.sqrt(.5),0,0,Math.sqrt(.5)),h=new Et,f=new Et;0==n.screenOrientation?(s=new bt(1,0,0),h.setFromAxisAngle(s,-a)):180==n.screenOrientation?(s=new bt(1,0,0),h.setFromAxisAngle(s,a)):90==n.screenOrientation?(s=new bt(0,1,0),h.setFromAxisAngle(s,a)):-90==n.screenOrientation&&(s=new bt(0,1,0),h.setFromAxisAngle(s,-a)),d.multiply(h),d.multiply(f),c.set(i,t,-r,"YXZ"),e.setFromEuler(c),e.multiply(d),e.multiply(u.setFromAxisAngle(l,-o))})(n.camera.quaternion,t,r,o,s),n.alpha=t,!0!==e&&n.dispatchEvent(i)}},this.updateAlphaOffsetAngle=function(e){this.alphaOffsetAngle=e,this.update()},this.dispose=function(){this.disconnect()},this.connect()}function ic(e){var t=new cs(-1,1,1,-1,0,1),n=new br,i=new ks;i.aspect=.5;var r=new It(512,512,{minFilter:et,magFilter:Qe,format:lt});r.scissorTest=!0,r.texture.generateMipmaps=!1;var a=new _t(.441,.156),o=new vn(1,1,10,20).removeAttribute("normal").toNonIndexed(),s=o.attributes.position.array,l=o.attributes.uv.array;o.attributes.position.count*=2,o.attributes.uv.count*=2;var c=new Float32Array(2*s.length);c.set(s),c.set(s,s.length);var u=new Float32Array(2*l.length);u.set(l),u.set(l,l.length);for(var d=new _t,h=s.length/3,f=0,p=c.length/3;f<p;f++){d.x=c[3*f+0],d.y=c[3*f+1];var g=d.dot(d),m=1.5+(a.x+a.y*g)*g,v=f<h?0:1;c[3*f+0]=d.x/m*1.5-.5+v,c[3*f+1]=d.y/m*3,u[2*f]=.5*(u[2*f]+v)}o.attributes.position.array=c,o.attributes.uv.array=u;var y=new wn(o,new Sn({map:r.texture}));n.add(y),this.setSize=function(t,n){e.setSize(t,n);var i=e.getPixelRatio();r.setSize(t*i,n*i)},this.render=function(a,o){a.updateMatrixWorld(),null===o.parent&&o.updateMatrixWorld(),i.update(o);var s=r.width/2,l=r.height;e.autoClear&&e.clear(),r.scissor.set(0,0,s,l),r.viewport.set(0,0,s,l),e.setRenderTarget(r),e.render(a,i.cameraL),e.clearDepth(),r.scissor.set(s,0,s,l),r.viewport.set(s,0,s,l),e.setRenderTarget(r),e.render(a,i.cameraR),e.clearDepth(),e.setRenderTarget(null),e.render(n,t)}}Jl.prototype=Object.assign(Object.create(zl.prototype),{constructor:Jl,add:function(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}e instanceof Gl&&(e.material.depthTest=!1),zl.prototype.add.call(this,e)},createGeometry:function(e,t){return new vn(e,e*t)},createMaterial:function(e){const t=Object.assign({},Ql),n=t.uniforms;return n.zoom.value=e,n.opacity.value=0,new En({uniforms:n,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,side:1,transparent:!0})},registerMouseEvents:function(){this.container.addEventListener("mousedown",this.onMouseDown.bind(this),{passive:!0}),this.container.addEventListener("mousemove",this.onMouseMove.bind(this),{passive:!0}),this.container.addEventListener("mouseup",this.onMouseUp.bind(this),{passive:!0}),this.container.addEventListener("touchstart",this.onMouseDown.bind(this),{passive:!0}),this.container.addEventListener("touchmove",this.onMouseMove.bind(this),{passive:!0}),this.container.addEventListener("touchend",this.onMouseUp.bind(this),{passive:!0}),this.container.addEventListener("mousewheel",this.onMouseWheel.bind(this),{passive:!1}),this.container.addEventListener("DOMMouseScroll",this.onMouseWheel.bind(this),{passive:!1}),this.container.addEventListener("contextmenu",this.onContextMenu.bind(this),{passive:!0})},unregisterMouseEvents:function(){this.container.removeEventListener("mousedown",this.onMouseDown.bind(this),!1),this.container.removeEventListener("mousemove",this.onMouseMove.bind(this),!1),this.container.removeEventListener("mouseup",this.onMouseUp.bind(this),!1),this.container.removeEventListener("touchstart",this.onMouseDown.bind(this),!1),this.container.removeEventListener("touchmove",this.onMouseMove.bind(this),!1),this.container.removeEventListener("touchend",this.onMouseUp.bind(this),!1),this.container.removeEventListener("mousewheel",this.onMouseWheel.bind(this),!1),this.container.removeEventListener("DOMMouseScroll",this.onMouseWheel.bind(this),!1),this.container.removeEventListener("contextmenu",this.onContextMenu.bind(this),!1)},onMouseDown:function(e){switch(e.touches&&e.touches.length||1){case 1:const t=e.clientX>=0?e.clientX:e.touches[0].clientX,n=e.clientY>=0?e.clientY:e.touches[0].clientY;this.dragging=!0,this.userMouse.set(t,n);break;case 2:const i=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(i*i+r*r);this.userMouse.pinchDistance=a}this.onUpdateCallback()},onMouseMove:function(e){switch(e.touches&&e.touches.length||1){case 1:const t=e.clientX>=0?e.clientX:e.touches[0].clientX,n=e.clientY>=0?e.clientY:e.touches[0].clientY,i=.4*yt.degToRad(t-this.userMouse.x),r=.4*yt.degToRad(n-this.userMouse.y);this.dragging&&(this.quatA.setFromAxisAngle(this.vectorY,i),this.quatB.setFromAxisAngle(this.vectorX,r),this.quatCur.multiply(this.quatA).multiply(this.quatB),this.userMouse.set(t,n));break;case 2:const a=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,s=Math.sqrt(a*a+o*o);this.addZoomDelta(this.userMouse.pinchDistance-s)}},onMouseUp:function(){this.dragging=!1},onMouseWheel:function(e){e.preventDefault(),e.stopPropagation();let t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),this.addZoomDelta(t),this.onUpdateCallback()},addZoomDelta:function(e){const t=this.material.uniforms,n=.1*this.size,i=10*this.size;t.zoom.value+=e,t.zoom.value<=n?t.zoom.value=n:t.zoom.value>=i&&(t.zoom.value=i)},onUpdateCallback:function(){this.frameId=window.requestAnimationFrame(this.onUpdateCallback.bind(this)),this.quatSlerp.slerp(this.quatCur,.1),this.material&&this.material.uniforms.transform.value.makeRotationFromQuaternion(this.quatSlerp),!this.dragging&&1-this.quatSlerp.clone().dot(this.quatCur)<this.EPS&&window.cancelAnimationFrame(this.frameId)},reset:function(){this.quatCur.set(0,0,0,1),this.quatSlerp.set(0,0,0,1),this.onUpdateCallback()},onLoad:function(e){this.material.uniforms.resolution.value=this.container.clientWidth/this.container.clientHeight,this.registerMouseEvents(),this.onUpdateCallback(),this.dispatchEvent({type:"panolens-viewer-handler",method:"disableControl"}),zl.prototype.onLoad.call(this,e)},onLeave:function(){this.unregisterMouseEvents(),this.dispatchEvent({type:"panolens-viewer-handler",method:"enableControl",data:Pl.ORBIT}),window.cancelAnimationFrame(this.frameId),zl.prototype.onLeave.call(this)},onWindowResize:function(){this.material.uniforms.resolution.value=this.container.clientWidth/this.container.clientHeight},onContextMenu:function(){this.dragging=!1},dispose:function(){this.unregisterMouseEvents(),zl.prototype.dispose.call(this)}}),$l.prototype=Object.assign(Object.create(Jl.prototype),{constructor:$l,onLoad:function(e){this.updateTexture(e),Jl.prototype.onLoad.call(this,e)},updateTexture:function(e){e.minFilter=e.magFilter=et,this.material.uniforms.tDiffuse.value=e},dispose:function(){const e=this.material.uniforms.tDiffuse;e&&e.value&&e.value.dispose(),Jl.prototype.dispose.call(this)}}),ec.prototype=Object.assign(Object.create(jl.prototype),{constructor:ec,onPanolensContainer:function(e){let{container:t}=e;this.media.setContainer(t)},onPanolensScene:function(e){let{scene:t}=e;this.media.setScene(t)},start:function(){return this.media.start()},stop:function(){this.media.stop()}}),tc.prototype=Object.assign(Object.create(je.prototype),{constructor:tc}),nc.prototype=Object.assign(Object.create(je.prototype),{constructor:nc});const rc=function(e){var t=new ks;t.aspect=.5;var n=new _t;this.setEyeSeparation=function(e){t.eyeSep=e},this.setSize=function(t,n){e.setSize(t,n)},this.render=function(i,r){i.updateMatrixWorld(),null===r.parent&&r.updateMatrixWorld(),t.update(r),e.getSize(n),e.autoClear&&e.clear(),e.setScissorTest(!0),e.setScissor(0,0,n.width/2,n.height),e.setViewport(0,0,n.width/2,n.height),e.render(i,t.cameraL),e.setScissor(n.width/2,0,n.width/2,n.height),e.setViewport(n.width/2,0,n.width/2,n.height),e.render(i,t.cameraR),e.setScissorTest(!1)}};function ac(e){let t;(e=e||{}).controlBar=void 0===e.controlBar||e.controlBar,e.controlButtons=e.controlButtons||["fullscreen","setting","video"],e.autoHideControlBar=void 0!==e.autoHideControlBar&&e.autoHideControlBar,e.autoHideInfospot=void 0===e.autoHideInfospot||e.autoHideInfospot,e.horizontalView=void 0!==e.horizontalView&&e.horizontalView,e.clickTolerance=e.clickTolerance||10,e.cameraFov=e.cameraFov||60,e.reverseDragging=e.reverseDragging||!1,e.enableReticle=e.enableReticle||!1,e.dwellTime=e.dwellTime||1500,e.autoReticleSelect=void 0===e.autoReticleSelect||e.autoReticleSelect,e.viewIndicator=void 0!==e.viewIndicator&&e.viewIndicator,e.indicatorSize=e.indicatorSize||30,e.output=e.output?e.output:"none",e.autoRotate=e.autoRotate||!1,e.autoRotateSpeed=e.autoRotateSpeed||2,e.autoRotateActivationDuration=e.autoRotateActivationDuration||5e3,this.options=e,e.container?(t=e.container,t._width=t.clientWidth,t._height=t.clientHeight):(t=document.createElement("div"),t.classList.add("panolens-container"),t.style.width="100%",t.style.height="100%",t._width=window.innerWidth,t._height=window.innerHeight,document.body.appendChild(t)),this.container=t,this.camera=e.camera||new ur(this.options.cameraFov,this.container.clientWidth/this.container.clientHeight,1,1e4),this.scene=e.scene||new br,this.renderer=e.renderer||new yr({alpha:!0,antialias:!1}),this.sceneReticle=new br,this.viewIndicatorSize=this.options.indicatorSize,this.reticle={},this.tempEnableReticle=this.options.enableReticle,this.mode=Dl.NORMAL,this.panorama=null,this.widget=null,this.hoverObject=null,this.infospot=null,this.pressEntityObject=null,this.pressObject=null,this.raycaster=new el,this.raycasterPoint=new _t,this.userMouse=new _t,this.updateCallbacks=[],this.requestAnimationId=null,this.cameraFrustum=new Nt,this.cameraViewProjectionMatrix=new kt,this.autoRotateRequestId=null,this.outputDivElement=null,this.touchSupported="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,this.HANDLER_MOUSE_DOWN=this.onMouseDown.bind(this),this.HANDLER_MOUSE_UP=this.onMouseUp.bind(this),this.HANDLER_MOUSE_MOVE=this.onMouseMove.bind(this),this.HANDLER_WINDOW_RESIZE=this.onWindowResize.bind(this),this.HANDLER_KEY_DOWN=this.onKeyDown.bind(this),this.HANDLER_KEY_UP=this.onKeyUp.bind(this),this.HANDLER_TAP=this.onTap.bind(this,{clientX:this.container.clientWidth/2,clientY:this.container.clientHeight/2}),this.OUTPUT_INFOSPOT=!1,this.tweenLeftAnimation=new Vl.Tween,this.tweenUpAnimation=new Vl.Tween,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.setClearColor(0,0),this.renderer.autoClear=!1,this.renderer.domElement.classList.add("panolens-canvas"),this.renderer.domElement.style.display="block",this.container.style.backgroundColor="#000",this.container.appendChild(this.renderer.domElement),this.OrbitControls=new tc(this.camera,this.container),this.OrbitControls.id="orbit",this.OrbitControls.minDistance=1,this.OrbitControls.noPan=!0,this.OrbitControls.autoRotate=this.options.autoRotate,this.OrbitControls.autoRotateSpeed=this.options.autoRotateSpeed,this.DeviceOrientationControls=new nc(this.camera,this.container),this.DeviceOrientationControls.id="device-orientation",this.DeviceOrientationControls.enabled=!1,this.camera.position.z=1,this.options.passiveRendering&&console.warn("passiveRendering is now deprecated"),this.controls=[this.OrbitControls,this.DeviceOrientationControls],this.control=this.OrbitControls,this.CardboardEffect=new ic(this.renderer),this.CardboardEffect.setSize(this.container.clientWidth,this.container.clientHeight),this.StereoEffect=new rc(this.renderer),this.StereoEffect.setSize(this.container.clientWidth,this.container.clientHeight),this.effect=this.CardboardEffect,this.addReticle(),this.options.horizontalView&&(this.OrbitControls.minPolarAngle=Math.PI/2,this.OrbitControls.maxPolarAngle=Math.PI/2),!1!==this.options.controlBar&&this.addDefaultControlBar(this.options.controlButtons),this.options.viewIndicator&&this.addViewIndicator(),this.options.reverseDragging&&this.reverseDraggingDirection(),this.options.enableReticle?this.enableReticleControl():this.registerMouseAndTouchEvents(),"overlay"===this.options.output&&this.addOutputElement(),this.registerEventListeners(),this.animate.call(this)}ac.prototype=Object.assign(Object.create(je.prototype),{constructor:ac,add:function(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}this.scene.add(e),e.addEventListener&&e.addEventListener("panolens-viewer-handler",this.eventHandler.bind(this)),e instanceof jl&&e.dispatchEvent&&e.dispatchEvent({type:"panolens-container",container:this.container}),e instanceof ec&&e.dispatchEvent({type:"panolens-scene",scene:this.scene}),"panorama"===e.type&&(this.addPanoramaEventListener(e),this.panorama||this.setPanorama(e))},remove:function(e){e.removeEventListener&&e.removeEventListener("panolens-viewer-handler",this.eventHandler.bind(this)),this.scene.remove(e)},addDefaultControlBar:function(e){if(this.widget)return void console.warn("Default control bar exists");const t=new Hl(this.container);t.addEventListener("panolens-viewer-handler",this.eventHandler.bind(this)),t.addControlBar(),e.forEach(e=>{t.addControlButton(e)}),this.widget=t},setPanorama:function(e){const t=this.panorama;if("panorama"===e.type&&t!==e){this.hideInfospot();const n=function(){t&&t.onLeave(),e.removeEventListener("enter-fade-start",n)};e.addEventListener("enter-fade-start",n),(this.panorama=e).onEnter()}},eventHandler:function(e){e.method&&this[e.method]&&this[e.method](e.data)},dispatchEventToChildren:function(e){this.scene.traverse(function(t){t.dispatchEvent&&t.dispatchEvent(e)})},activateWidgetItem:function(e,t){const n=this.widget.mainMenu,i=n.children[0],r=n.children[1];let a;if(void 0!==e){switch(e){case 0:default:a=i.subMenu.children[1];break;case 1:a=i.subMenu.children[2]}i.subMenu.setActiveItem(a),i.setSelectionTitle(a.textContent)}if(void 0!==t){switch(t){case Dl.CARDBOARD:a=r.subMenu.children[2];break;case Dl.STEREO:a=r.subMenu.children[3];break;default:a=r.subMenu.children[1]}r.subMenu.setActiveItem(a),r.setSelectionTitle(a.textContent)}},enableEffect:function(e){if(this.mode===e)return;if(e===Dl.NORMAL)return void this.disableEffect();this.mode=e;const t=this.camera.fov;switch(e){case Dl.CARDBOARD:this.effect=this.CardboardEffect,this.enableReticleControl();break;case Dl.STEREO:this.effect=this.StereoEffect,this.enableReticleControl();break;default:this.effect=null,this.disableReticleControl()}this.activateWidgetItem(void 0,this.mode),this.dispatchEventToChildren({type:"panolens-dual-eye-effect",mode:this.mode}),this.camera.fov=t+.01,this.effect.setSize(this.container.clientWidth,this.container.clientHeight),this.render(),this.camera.fov=t,this.dispatchEvent({type:"mode-change",mode:this.mode})},disableEffect:function(){this.mode!==Dl.NORMAL&&(this.mode=Dl.NORMAL,this.disableReticleControl(),this.activateWidgetItem(void 0,this.mode),this.dispatchEventToChildren({type:"panolens-dual-eye-effect",mode:this.mode}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.render(),this.dispatchEvent({type:"mode-change",mode:this.mode}))},enableReticleControl:function(){this.reticle.visible||(this.tempEnableReticle=!0,this.unregisterMouseAndTouchEvents(),this.reticle.show(),this.registerReticleEvent(),this.updateReticleEvent())},disableReticleControl:function(){this.tempEnableReticle=!1,this.options.enableReticle?this.updateReticleEvent():(this.reticle.hide(),this.unregisterReticleEvent(),this.registerMouseAndTouchEvents())},enableAutoRate:function(){this.options.autoRotate=!0,this.OrbitControls.autoRotate=!0},disableAutoRate:function(){clearTimeout(this.autoRotateRequestId),this.options.autoRotate=!1,this.OrbitControls.autoRotate=!1},toggleVideoPlay:function(e){this.panorama instanceof Yl&&this.panorama.dispatchEvent({type:"video-toggle",pause:e})},setVideoCurrentTime:function(e){this.panorama instanceof Yl&&this.panorama.dispatchEvent({type:"video-time",percentage:e})},onVideoUpdate:function(e){const{widget:t}=this;t&&t.dispatchEvent({type:"video-update",percentage:e})},addUpdateCallback:function(e){e&&this.updateCallbacks.push(e)},removeUpdateCallback:function(e){const t=this.updateCallbacks.indexOf(e);e&&t>=0&&this.updateCallbacks.splice(t,1)},showVideoWidget:function(){const{widget:e}=this;e&&e.dispatchEvent({type:"video-control-show"})},hideVideoWidget:function(){const{widget:e}=this;e&&e.dispatchEvent({type:"video-control-hide"})},updateVideoPlayButton:function(e){const{widget:t}=this;t&&t.videoElement&&t.videoElement.controlButton&&t.videoElement.controlButton.update(e)},addPanoramaEventListener:function(e){e.addEventListener("enter-fade-start",this.setCameraControl.bind(this)),e instanceof Yl&&(e.addEventListener("enter-fade-start",this.showVideoWidget.bind(this)),e.addEventListener("leave",function(){this.panorama instanceof Yl||this.hideVideoWidget.call(this)}.bind(this)))},setCameraControl:function(){this.OrbitControls.target.copy(this.panorama.position)},getControl:function(){return this.control},getScene:function(){return this.scene},getCamera:function(){return this.camera},getRenderer:function(){return this.renderer},getContainer:function(){return this.container},getControlId:function(){return this.control.id},getNextControlId:function(){return this.controls[this.getNextControlIndex()].id},getNextControlIndex:function(){const e=this.controls,t=this.control,n=e.indexOf(t)+1;return n>=e.length?0:n},setCameraFov:function(e){this.camera.fov=e,this.camera.updateProjectionMatrix()},enableControl:function(e){switch(e=e>=0&&e<this.controls.length?e:0,this.control.enabled=!1,this.control=this.controls[e],this.control.enabled=!0,e){case Pl.ORBIT:this.camera.position.copy(this.panorama.position),this.camera.position.z+=1;break;case Pl.DEVICEORIENTATION:this.camera.position.copy(this.panorama.position)}this.control.update(),this.activateWidgetItem(e,void 0)},disableControl:function(){this.control.enabled=!1},toggleNextControl:function(){this.enableControl(this.getNextControlIndex())},getScreenVector:function(e){const t=e.clone(),n=this.container.clientWidth/2,i=this.container.clientHeight/2;return t.project(this.camera),t.x=t.x*n+n,t.y=-t.y*i+i,t.z=0,t},checkSpriteInViewport:function(e){return this.camera.matrixWorldInverse.getInverse(this.camera.matrixWorld),this.cameraViewProjectionMatrix.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),this.cameraFrustum.setFromMatrix(this.cameraViewProjectionMatrix),e.visible&&this.cameraFrustum.intersectsSprite(e)},reverseDraggingDirection:function(){this.OrbitControls.rotateSpeed*=-1,this.OrbitControls.momentumScalingFactor*=-1},addReticle:function(){this.reticle=new Ul(16777215,!0,this.options.dwellTime),this.reticle.hide(),this.camera.add(this.reticle),this.sceneReticle.add(this.camera)},tweenControlCenter:function(e,t,n){if(this.control!==this.OrbitControls)return;let i,r,a,o,s,l,c,u,d,h;e instanceof Array&&(t=e[1],n=e[2],e=e[0]),t=void 0!==t?t:1e3,n=n||Vl.Easing.Exponential.Out,i=this,o=this.camera.getWorldDirection(new bt),s=o.clone(),u=this.panorama.getWorldPosition(new bt).sub(this.camera.getWorldPosition(new bt)),l=e.clone(),l.x*=-1,l.add(u).normalize(),c=l.clone(),o.y=0,l.y=0,r=Math.atan2(l.z,l.x)-Math.atan2(o.z,o.x),r=r>Math.PI?r-2*Math.PI:r,r=r<-Math.PI?r+2*Math.PI:r,a=Math.abs(s.angleTo(o)+(s.y*c.y<=0?c.angleTo(l):-c.angleTo(l))),a*=c.y<s.y?1:-1,d={left:0,up:0},h={left:0,up:0},this.tweenLeftAnimation.stop(),this.tweenUpAnimation.stop(),this.tweenLeftAnimation=new Vl.Tween(d).to({left:r},t).easing(n).onUpdate(function(e){i.control.rotateLeft(e.left-h.left),h.left=e.left}).start(),this.tweenUpAnimation=new Vl.Tween(d).to({up:a},t).easing(n).onUpdate(function(e){i.control.rotateUp(e.up-h.up),h.up=e.up}).start()},tweenControlCenterByObject:function(e,t,n){let i=!1;if(e.traverseAncestors(function(e){e.scalePlaceHolder&&(i=!0)}),i){const i=new bt(-1,1,1);this.tweenControlCenter(e.getWorldPosition(new bt).multiply(i),t,n)}else this.tweenControlCenter(e.getWorldPosition(new bt),t,n)},onWindowResize:function(e,t){let n,i;const r=this.container.classList.contains("panolens-container")||this.container.isFullscreen;if(void 0!==e&&void 0!==t)n=e,i=t,this.container._width=e,this.container._height=t;else{const e=/(android)/i.test(window.navigator.userAgent),t=e?Math.min(document.documentElement.clientWidth,window.innerWidth||0):Math.max(document.documentElement.clientWidth,window.innerWidth||0),a=e?Math.min(document.documentElement.clientHeight,window.innerHeight||0):Math.max(document.documentElement.clientHeight,window.innerHeight||0);n=r?t:this.container.clientWidth,i=r?a:this.container.clientHeight,this.container._width=n,this.container._height=i}this.camera.aspect=n/i,this.camera.updateProjectionMatrix(),this.renderer.setSize(n,i),(this.options.enableReticle||this.tempEnableReticle)&&this.updateReticleEvent(),this.dispatchEvent({type:"window-resize",width:n,height:i}),this.scene.traverse(function(e){e.dispatchEvent&&e.dispatchEvent({type:"window-resize",width:n,height:i})})},addOutputElement:function(){const e=document.createElement("div");e.style.position="absolute",e.style.right="10px",e.style.top="10px",e.style.color="#fff",this.container.appendChild(e),this.outputDivElement=e},outputPosition:function(){const e=this.raycaster.intersectObject(this.panorama,!0);if(e.length>0){const t=e[0].point.clone(),n=new bt(-1,1,1),i=this.panorama.getWorldPosition(new bt);t.sub(i).multiply(n);const r={x:t.x.toFixed(2),y:t.y.toFixed(2),z:t.z.toFixed(2)},a="".concat(r.x,", ").concat(r.y,", ").concat(r.z);if(0===t.length())return;switch(this.options.output){case"event":this.dispatchEvent({type:"position-output",position:r});break;case"console":console.info(a);break;case"overlay":this.outputDivElement.textContent=a}}},onMouseDown:function(e){e.preventDefault(),this.userMouse.x=e.clientX>=0?e.clientX:e.touches[0].clientX,this.userMouse.y=e.clientY>=0?e.clientY:e.touches[0].clientY,this.userMouse.type="mousedown",this.onTap(e)},onMouseMove:function(e){e.preventDefault(),this.userMouse.type="mousemove",this.onTap(e)},onMouseUp:function(e){let t=!1;this.userMouse.type="mouseup";const n=this.userMouse.x>=e.clientX-this.options.clickTolerance&&this.userMouse.x<=e.clientX+this.options.clickTolerance&&this.userMouse.y>=e.clientY-this.options.clickTolerance&&this.userMouse.y<=e.clientY+this.options.clickTolerance||e.changedTouches&&this.userMouse.x>=e.changedTouches[0].clientX-this.options.clickTolerance&&this.userMouse.x<=e.changedTouches[0].clientX+this.options.clickTolerance&&this.userMouse.y>=e.changedTouches[0].clientY-this.options.clickTolerance&&this.userMouse.y<=e.changedTouches[0].clientY+this.options.clickTolerance?"click":void 0;if((!e||!e.target||e.target.classList.contains("panolens-canvas"))&&(e.preventDefault(),t=e.changedTouches&&1===e.changedTouches.length?this.onTap({clientX:e.changedTouches[0].clientX,clientY:e.changedTouches[0].clientY},n):this.onTap(e,n),this.userMouse.type="none",!t&&"click"===n)){const{options:{autoHideInfospot:e,autoHideControlBar:t},panorama:n,toggleControlBar:i}=this;e&&n&&n.toggleInfospotVisibility(),t&&i()}},onTap:function(e,t){const{left:n,top:i}=this.container.getBoundingClientRect(),{clientWidth:r,clientHeight:a}=this.container;if(this.raycasterPoint.x=(e.clientX-n)/r*2-1,this.raycasterPoint.y=-(e.clientY-i)/a*2+1,this.raycaster.setFromCamera(this.raycasterPoint,this.camera),!this.panorama)return;("mousedown"!==e.type&&this.touchSupported||this.OUTPUT_INFOSPOT)&&this.outputPosition();const o=this.raycaster.intersectObjects(this.panorama.children,!0),s=this.getConvertedIntersect(o),l=o.length>0?o[0].object:void 0;if("mouseup"===this.userMouse.type&&(s&&this.pressEntityObject===s&&this.pressEntityObject.dispatchEvent&&this.pressEntityObject.dispatchEvent({type:"pressstop-entity",mouseEvent:e}),this.pressEntityObject=void 0),"mouseup"===this.userMouse.type&&(l&&this.pressObject===l&&this.pressObject.dispatchEvent&&this.pressObject.dispatchEvent({type:"pressstop",mouseEvent:e}),this.pressObject=void 0),"click"===t?(this.panorama.dispatchEvent({type:"click",intersects:o,mouseEvent:e}),s&&s.dispatchEvent&&s.dispatchEvent({type:"click-entity",mouseEvent:e}),l&&l.dispatchEvent&&l.dispatchEvent({type:"click",mouseEvent:e})):(this.panorama.dispatchEvent({type:"hover",intersects:o,mouseEvent:e}),(this.hoverObject&&o.length>0&&this.hoverObject!==s||this.hoverObject&&0===o.length)&&(this.hoverObject.dispatchEvent&&(this.hoverObject.dispatchEvent({type:"hoverleave",mouseEvent:e}),this.reticle.end()),this.hoverObject=void 0),s&&o.length>0&&(this.hoverObject!==s&&(this.hoverObject=s,this.hoverObject.dispatchEvent&&(this.hoverObject.dispatchEvent({type:"hoverenter",mouseEvent:e}),(this.options.autoReticleSelect&&this.options.enableReticle||this.tempEnableReticle)&&this.reticle.start(this.onTap.bind(this,e,"click")))),"mousedown"===this.userMouse.type&&this.pressEntityObject!=s&&(this.pressEntityObject=s,this.pressEntityObject.dispatchEvent&&this.pressEntityObject.dispatchEvent({type:"pressstart-entity",mouseEvent:e})),"mousedown"===this.userMouse.type&&this.pressObject!=l&&(this.pressObject=l,this.pressObject.dispatchEvent&&this.pressObject.dispatchEvent({type:"pressstart",mouseEvent:e})),("mousemove"===this.userMouse.type||this.options.enableReticle)&&(l&&l.dispatchEvent&&l.dispatchEvent({type:"hover",mouseEvent:e}),this.pressEntityObject&&this.pressEntityObject.dispatchEvent&&this.pressEntityObject.dispatchEvent({type:"pressmove-entity",mouseEvent:e}),this.pressObject&&this.pressObject.dispatchEvent&&this.pressObject.dispatchEvent({type:"pressmove",mouseEvent:e}))),!s&&this.pressEntityObject&&this.pressEntityObject.dispatchEvent&&(this.pressEntityObject.dispatchEvent({type:"pressstop-entity",mouseEvent:e}),this.pressEntityObject=void 0),!l&&this.pressObject&&this.pressObject.dispatchEvent&&(this.pressObject.dispatchEvent({type:"pressstop",mouseEvent:e}),this.pressObject=void 0)),l&&l instanceof Gl){if(this.infospot=l,"click"===t)return!0}else this.infospot&&this.hideInfospot();this.options.autoRotate&&"mousemove"!==this.userMouse.type&&(clearTimeout(this.autoRotateRequestId),this.control===this.OrbitControls&&(this.OrbitControls.autoRotate=!1,this.autoRotateRequestId=window.setTimeout(this.enableAutoRate.bind(this),this.options.autoRotateActivationDuration)))},getConvertedIntersect:function(e){let t;for(let n=0;n<e.length;n++)if(e[n].distance>=0&&e[n].object&&!e[n].object.passThrough){if(e[n].object.entity&&e[n].object.entity.passThrough)continue;if(e[n].object.entity&&!e[n].object.entity.passThrough){t=e[n].object.entity;break}t=e[n].object;break}return t},hideInfospot:function(){this.infospot&&(this.infospot.onHoverEnd(),this.infospot=void 0)},toggleControlBar:function(){const{widget:e}=this;e&&e.dispatchEvent({type:"control-bar-toggle"})},onKeyDown:function(e){this.options.output&&"none"!==this.options.output&&"Control"===e.key&&(this.OUTPUT_INFOSPOT=!0)},onKeyUp:function(){this.OUTPUT_INFOSPOT=!1},update:function(){Vl.update(),this.updateCallbacks.forEach(function(e){e()}),this.control.update(),this.scene.traverse(function(e){if(e instanceof Gl&&e.element&&(this.hoverObject===e||"none"!==e.element.style.display||e.element.left&&"none"!==e.element.left.style.display||e.element.right&&"none"!==e.element.right.style.display))if(this.checkSpriteInViewport(e)){const{x:t,y:n}=this.getScreenVector(e.getWorldPosition(new bt));e.translateElement(t,n)}else e.onDismiss()}.bind(this))},render:function(){this.mode===Dl.CARDBOARD||this.mode===Dl.STEREO?(this.renderer.clear(),this.effect.render(this.scene,this.camera),this.effect.render(this.sceneReticle,this.camera)):(this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.renderer.clearDepth(),this.renderer.render(this.sceneReticle,this.camera))},animate:function(){this.requestAnimationId=window.requestAnimationFrame(this.animate.bind(this)),this.onChange()},onChange:function(){this.update(),this.render()},registerMouseAndTouchEvents:function(){const e={passive:!1};this.container.addEventListener("mousedown",this.HANDLER_MOUSE_DOWN,e),this.container.addEventListener("mousemove",this.HANDLER_MOUSE_MOVE,e),this.container.addEventListener("mouseup",this.HANDLER_MOUSE_UP,e),this.container.addEventListener("touchstart",this.HANDLER_MOUSE_DOWN,e),this.container.addEventListener("touchend",this.HANDLER_MOUSE_UP,e)},unregisterMouseAndTouchEvents:function(){this.container.removeEventListener("mousedown",this.HANDLER_MOUSE_DOWN,!1),this.container.removeEventListener("mousemove",this.HANDLER_MOUSE_MOVE,!1),this.container.removeEventListener("mouseup",this.HANDLER_MOUSE_UP,!1),this.container.removeEventListener("touchstart",this.HANDLER_MOUSE_DOWN,!1),this.container.removeEventListener("touchend",this.HANDLER_MOUSE_UP,!1)},registerReticleEvent:function(){this.addUpdateCallback(this.HANDLER_TAP)},unregisterReticleEvent:function(){this.removeUpdateCallback(this.HANDLER_TAP)},updateReticleEvent:function(){const e=this.container.clientWidth/2+this.container.offsetLeft,t=this.container.clientHeight/2;this.removeUpdateCallback(this.HANDLER_TAP),this.HANDLER_TAP=this.onTap.bind(this,{clientX:e,clientY:t}),this.addUpdateCallback(this.HANDLER_TAP)},registerEventListeners:function(){window.addEventListener("resize",this.HANDLER_WINDOW_RESIZE,!0),window.addEventListener("keydown",this.HANDLER_KEY_DOWN,!0),window.addEventListener("keyup",this.HANDLER_KEY_UP,!0)},unregisterEventListeners:function(){window.removeEventListener("resize",this.HANDLER_WINDOW_RESIZE,!0),window.removeEventListener("keydown",this.HANDLER_KEY_DOWN,!0),window.removeEventListener("keyup",this.HANDLER_KEY_UP,!0)},dispose:function(){this.tweenLeftAnimation.stop(),this.tweenUpAnimation.stop(),this.unregisterEventListeners(),function e(t){for(let n=t.children.length-1;n>=0;n--)e(t.children[n]),t.remove(t.children[n]);t instanceof jl||t instanceof Gl?(t.dispose(),t=null):t.dispatchEvent&&t.dispatchEvent("dispose")}(this.scene),this.widget&&(this.widget.dispose(),this.widget=null),Ro&&Ro.enabled&&Ro.clear()},destroy:function(){this.dispose(),this.render(),window.cancelAnimationFrame(this.requestAnimationId)},onPanoramaDispose:function(e){e instanceof Yl&&this.hideVideoWidget(),e===this.panorama&&(this.panorama=null)},loadAsyncRequest:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};const n=new window.XMLHttpRequest;n.onloadend=function(e){t(e)},n.open("GET",e,!0),n.send(null)},addViewIndicator:function(){const e=this;this.loadAsyncRequest(Ol.ViewIndicator,function(t){if(0===t.loaded)return;const n=t.target.responseXML.documentElement;n.style.width=e.viewIndicatorSize+"px",n.style.height=e.viewIndicatorSize+"px",n.style.position="absolute",n.style.top="10px",n.style.left="10px",n.style.opacity="0.5",n.style.cursor="pointer",n.id="panolens-view-indicator-container",e.container.appendChild(n);const i=n.querySelector("#indicator");e.addUpdateCallback(function(){e.radius=.225*e.viewIndicatorSize,e.currentPanoAngle=e.camera.rotation.y-yt.degToRad(90),e.fovAngle=yt.degToRad(e.camera.fov),e.leftAngle=-e.currentPanoAngle-e.fovAngle/2,e.rightAngle=-e.currentPanoAngle+e.fovAngle/2,e.leftX=e.radius*Math.cos(e.leftAngle),e.leftY=e.radius*Math.sin(e.leftAngle),e.rightX=e.radius*Math.cos(e.rightAngle),e.rightY=e.radius*Math.sin(e.rightAngle),e.indicatorD="M "+e.leftX+" "+e.leftY+" A "+e.radius+" "+e.radius+" 0 0 1 "+e.rightX+" "+e.rightY,e.leftX&&e.leftY&&e.rightX&&e.rightY&&e.radius&&i.setAttribute("d",e.indicatorD)}),n.addEventListener("mouseenter",function(){this.style.opacity="1"}),n.addEventListener("mouseleave",function(){this.style.opacity="0.5"})})},appendControlItem:function(e){const t=this.widget.createCustomItem(e);return"video"===e.group?this.widget.videoElement.appendChild(t):this.widget.barElement.appendChild(t),t},clearAllCache:function(){Ro.clear()}}),"105"!=Ml&&console.warn("three.js version is not matched. Please consider use the target revision ".concat(Ml)),window.TWEEN=Vl;const oc=Object.freeze(Object.defineProperty({__proto__:null,BasicPanorama:Wl,CONTROLS:Pl,CameraPanorama:ec,CubePanorama:ql,CubeTextureLoader:Fl,DataImage:Ol,EmptyPanorama:Zl,GoogleStreetviewPanorama:Xl,ImageLittlePlanet:$l,ImageLoader:Nl,ImagePanorama:zl,Infospot:Gl,LittlePlanet:Jl,MODES:Dl,Media:Bl,Panorama:jl,REVISION:Il,Reticle:Ul,THREE_REVISION:Ml,THREE_VERSION:Cl,TextureLoader:kl,VERSION:Ll,VideoPanorama:Yl,Viewer:ac,Widget:Hl},Symbol.toStringTag,{value:"Module"}));var sc={exports:{}},lc=typeof window<"u"?window:typeof X<"u"?X:typeof self<"u"?self:{};const cc=function(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var n=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var i=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,i.get?i:{enumerable:!0,get:function(){return e[t]}})}),n}(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var uc,dc=typeof X<"u"?X:typeof window<"u"?window:{},hc=cc;typeof document<"u"?uc=document:(uc=dc["__GLOBAL_DOCUMENT_CACHE@4"])||(uc=dc["__GLOBAL_DOCUMENT_CACHE@4"]=hc);var fc=uc,pc=Object.create||function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return e.prototype=t,new e}}();function gc(e,t){this.name="ParsingError",this.code=e.code,this.message=t||e.message}function mc(e){function t(e,t,n,i){return 3600*(0|e)+60*(0|t)+(0|n)+(0|i)/1e3}var n=e.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return n?n[3]?t(n[1],n[2],n[3].replace(":",""),n[4]):n[1]>59?t(n[1],n[2],0,n[4]):t(0,n[1],n[2],n[4]):null}function vc(){this.values=pc(null)}function yc(e,t,n,i){var r=i?e.split(i):[e];for(var a in r)if("string"==typeof r[a]){var o=r[a].split(n);if(2===o.length)t(o[0].trim(),o[1].trim())}}function _c(e,t,n){var i=e;function r(){var t=mc(e);if(null===t)throw new gc(gc.Errors.BadTimeStamp,"Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function a(){e=e.replace(/^\s+/,"")}if(a(),t.startTime=r(),a(),"--\x3e"!==e.substr(0,3))throw new gc(gc.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.substr(3),a(),t.endTime=r(),a(),function(e,t){var i=new vc;yc(e,function(e,t){switch(e){case"region":for(var r=n.length-1;r>=0;r--)if(n[r].id===t){i.set(e,n[r].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":var a=t.split(","),o=a[0];i.integer(e,o),i.percent(e,o)&&i.set("snapToLines",!1),i.alt(e,o,["auto"]),2===a.length&&i.alt("lineAlign",a[1],["start","center","end"]);break;case"position":a=t.split(","),i.percent(e,a[0]),2===a.length&&i.alt("positionAlign",a[1],["start","center","end"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start","center","end","left","right"])}},/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");try{t.line=i.get("line","auto")}catch(e){}t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100);try{t.align=i.get("align","center")}catch(e){t.align=i.get("align","middle")}try{t.position=i.get("position","auto")}catch(e){t.position=i.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},t.align)}t.positionAlign=i.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},t.align)}(e,t)}gc.prototype=pc(Error.prototype),gc.prototype.constructor=gc,gc.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},vc.prototype={set:function(e,t){!this.get(e)&&""!==t&&(this.values[e]=t)},get:function(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,n){for(var i=0;i<n.length;++i)if(t===n[i]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t),t>=0&&t<=100))&&(this.set(e,t),!0)}};var Ec=fc.createElement&&fc.createElement("textarea"),bc={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},Tc={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},Sc={v:"title",lang:"lang"},wc={rt:"ruby"};function Ac(e,t){function n(){if(!t)return null;var e,n=t.match(/^([^<]*)(<[^>]*>?)?/);return e=n[1]?n[1]:n[2],t=t.substr(e.length),e}function i(e){return Ec.innerHTML=e,e=Ec.textContent,Ec.textContent="",e}function r(e,t){return!wc[t.localName]||wc[t.localName]===e.localName}function a(t,n){var i=bc[t];if(!i)return null;var r=e.document.createElement(i),a=Sc[t];return a&&n&&(r[a]=n.trim()),r}for(var o,s=e.document.createElement("div"),l=s,c=[];null!==(o=n());)if("<"!==o[0])l.appendChild(e.document.createTextNode(i(o)));else{if("/"===o[1]){c.length&&c[c.length-1]===o.substr(2).replace(">","")&&(c.pop(),l=l.parentNode);continue}var u,d=mc(o.substr(1,o.length-2));if(d){u=e.document.createProcessingInstruction("timestamp",d),l.appendChild(u);continue}var h=o.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!h||!(u=a(h[1],h[3]))||!r(l,u))continue;if(h[2]){var f=h[2].split(".");f.forEach(function(e){var t=/^bg_/.test(e),n=t?e.slice(3):e;if(Tc.hasOwnProperty(n)){var i=t?"background-color":"color",r=Tc[n];u.style[i]=r}}),u.className=f.join(" ")}c.push(h[1]),l.appendChild(u),l=u}return s}var Rc=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function xc(e){for(var t=0;t<Rc.length;t++){var n=Rc[t];if(e>=n[0]&&e<=n[1])return!0}return!1}function Ic(e){var t=[],n="";if(!e||!e.childNodes)return"ltr";function i(e,t){for(var n=t.childNodes.length-1;n>=0;n--)e.push(t.childNodes[n])}function r(e){if(!e||!e.length)return null;var t=e.pop(),n=t.textContent||t.innerText;if(n){var a=n.match(/^.*(\n|\r)/);return a?(e.length=0,a[0]):n}return"ruby"===t.tagName?r(e):t.childNodes?(i(e,t),r(e)):void 0}for(i(t,e);n=r(t);)for(var a=0;a<n.length;a++)if(xc(n.charCodeAt(a)))return"rtl";return"ltr"}function Lc(){}function Mc(e,t,n){Lc.call(this),this.cue=t,this.cueDiv=Ac(e,t.text);var i={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(i,this.cueDiv),this.div=e.document.createElement("div"),i={direction:Ic(this.cueDiv),writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:"middle"===t.align?"center":t.align,font:n.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(i),this.div.appendChild(this.cueDiv);var r=0;switch(t.positionAlign){case"start":case"line-left":r=t.position;break;case"center":r=t.position-t.size/2;break;case"end":case"line-right":r=t.position-t.size}""===t.vertical?this.applyStyles({left:this.formatStyle(r,"%"),width:this.formatStyle(t.size,"%")}):this.applyStyles({top:this.formatStyle(r,"%"),height:this.formatStyle(t.size,"%")}),this.move=function(e){this.applyStyles({top:this.formatStyle(e.top,"px"),bottom:this.formatStyle(e.bottom,"px"),left:this.formatStyle(e.left,"px"),right:this.formatStyle(e.right,"px"),height:this.formatStyle(e.height,"px"),width:this.formatStyle(e.width,"px")})}}function Cc(e){var t,n,i,r;if(e.div){n=e.div.offsetHeight,i=e.div.offsetWidth,r=e.div.offsetTop;var a=(a=e.div.childNodes)&&(a=a[0])&&a.getClientRects&&a.getClientRects();e=e.div.getBoundingClientRect(),t=a?Math.max(a[0]&&a[0].height||0,e.height/a.length):0}this.left=e.left,this.right=e.right,this.top=e.top||r,this.height=e.height||n,this.bottom=e.bottom||r+(e.height||n),this.width=e.width||i,this.lineHeight=void 0!==t?t:e.lineHeight}function Pc(e,t,n,i){var r=new Cc(t),a=t.cue,o=function(e){if("number"==typeof e.line&&(e.snapToLines||e.line>=0&&e.line<=100))return e.line;if(!e.track||!e.track.textTrackList||!e.track.textTrackList.mediaElement)return-1;for(var t=e.track,n=t.textTrackList,i=0,r=0;r<n.length&&n[r]!==t;r++)"showing"===n[r].mode&&i++;return-1*++i}(a),s=[];if(a.snapToLines){var l;switch(a.vertical){case"":s=["+y","-y"],l="height";break;case"rl":s=["+x","-x"],l="width";break;case"lr":s=["-x","+x"],l="width"}var c=r.lineHeight,u=c*Math.round(o),d=n[l]+c,h=s[0];Math.abs(u)>d&&(u=u<0?-1:1,u*=Math.ceil(d/c)*c),o<0&&(u+=""===a.vertical?n.height:n.width,s=s.reverse()),r.move(h,u)}else{var f=r.lineHeight/n.height*100;switch(a.lineAlign){case"center":o-=f/2;break;case"end":o-=f}switch(a.vertical){case"":t.applyStyles({top:t.formatStyle(o,"%")});break;case"rl":t.applyStyles({left:t.formatStyle(o,"%")});break;case"lr":t.applyStyles({right:t.formatStyle(o,"%")})}s=["+y","-x","+x","-y"],r=new Cc(t)}var p=function(e,t){for(var r,a=new Cc(e),o=1,s=0;s<t.length;s++){for(;e.overlapsOppositeAxis(n,t[s])||e.within(n)&&e.overlapsAny(i);)e.move(t[s]);if(e.within(n))return e;var l=e.intersectPercentage(n);o>l&&(r=new Cc(e),o=l),e=new Cc(a)}return r||a}(r,s);t.move(p.toCSSCompatValues(n))}function Dc(){}Lc.prototype.applyStyles=function(e,t){for(var n in t=t||this.div,e)e.hasOwnProperty(n)&&(t.style[n]=e[n])},Lc.prototype.formatStyle=function(e,t){return 0===e?0:e+t},Mc.prototype=pc(Lc.prototype),Mc.prototype.constructor=Mc,Cc.prototype.move=function(e,t){switch(t=void 0!==t?t:this.lineHeight,e){case"+x":this.left+=t,this.right+=t;break;case"-x":this.left-=t,this.right-=t;break;case"+y":this.top+=t,this.bottom+=t;break;case"-y":this.top-=t,this.bottom-=t}},Cc.prototype.overlaps=function(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top},Cc.prototype.overlapsAny=function(e){for(var t=0;t<e.length;t++)if(this.overlaps(e[t]))return!0;return!1},Cc.prototype.within=function(e){return this.top>=e.top&&this.bottom<=e.bottom&&this.left>=e.left&&this.right<=e.right},Cc.prototype.overlapsOppositeAxis=function(e,t){switch(t){case"+x":return this.left<e.left;case"-x":return this.right>e.right;case"+y":return this.top<e.top;case"-y":return this.bottom>e.bottom}},Cc.prototype.intersectPercentage=function(e){return Math.max(0,Math.min(this.right,e.right)-Math.max(this.left,e.left))*Math.max(0,Math.min(this.bottom,e.bottom)-Math.max(this.top,e.top))/(this.height*this.width)},Cc.prototype.toCSSCompatValues=function(e){return{top:this.top-e.top,bottom:e.bottom-this.bottom,left:this.left-e.left,right:e.right-this.right,height:this.height,width:this.width}},Cc.getSimpleBoxPosition=function(e){var t=e.div?e.div.offsetHeight:e.tagName?e.offsetHeight:0,n=e.div?e.div.offsetWidth:e.tagName?e.offsetWidth:0,i=e.div?e.div.offsetTop:e.tagName?e.offsetTop:0;return{left:(e=e.div?e.div.getBoundingClientRect():e.tagName?e.getBoundingClientRect():e).left,right:e.right,top:e.top||i,height:e.height||t,bottom:e.bottom||i+(e.height||t),width:e.width||n}},Dc.StringDecoder=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}},Dc.convertCueToDOMTree=function(e,t){return e&&t?Ac(e,t):null};Dc.processCues=function(e,t,n){if(!e||!t||!n)return null;for(;n.firstChild;)n.removeChild(n.firstChild);var i=e.document.createElement("div");if(i.style.position="absolute",i.style.left="0",i.style.right="0",i.style.top="0",i.style.bottom="0",i.style.margin="1.5%",n.appendChild(i),function(e){for(var t=0;t<e.length;t++)if(e[t].hasBeenReset||!e[t].displayState)return!0;return!1}(t)){var r=[],a=Cc.getSimpleBoxPosition(i),o={font:Math.round(.05*a.height*100)/100+"px sans-serif"};!function(){for(var n,s,l=0;l<t.length;l++)s=t[l],n=new Mc(e,s,o),i.appendChild(n.div),Pc(0,n,a,r),s.displayState=n.div,r.push(Cc.getSimpleBoxPosition(n))}()}else for(var s=0;s<t.length;s++)i.appendChild(t[s].displayState)},Dc.Parser=function(e,t,n){n||(n=t,t={}),t||(t={}),this.window=e,this.vttjs=t,this.state="INITIAL",this.buffer="",this.decoder=n||new TextDecoder("utf8"),this.regionList=[]},Dc.Parser.prototype={reportOrThrowError:function(e){if(!(e instanceof gc))throw e;this.onparsingerror&&this.onparsingerror(e)},parse:function(e){var t=this;function n(){for(var e=t.buffer,n=0;n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;var i=e.substr(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.substr(n),i}function i(e){e.match(/X-TIMESTAMP-MAP/)?yc(e,function(e,n){if("X-TIMESTAMP-MAP"===e)!function(e){var n=new vc;yc(e,function(e,t){switch(e){case"MPEGT":n.integer(e+"S",t);break;case"LOCA":n.set(e+"L",mc(t))}},/[^\d]:/,/,/),t.ontimestampmap&&t.ontimestampmap({MPEGTS:n.get("MPEGTS"),LOCAL:n.get("LOCAL")})}(n)},/=/):yc(e,function(e,n){if("Region"===e)!function(e){var n=new vc;if(yc(e,function(e,t){switch(e){case"id":n.set(e,t);break;case"width":n.percent(e,t);break;case"lines":n.integer(e,t);break;case"regionanchor":case"viewportanchor":var i=t.split(",");if(2!==i.length)break;var r=new vc;if(r.percent("x",i[0]),r.percent("y",i[1]),!r.has("x")||!r.has("y"))break;n.set(e+"X",r.get("x")),n.set(e+"Y",r.get("y"));break;case"scroll":n.alt(e,t,["up"])}},/=/,/\s/),n.has("id")){var i=new(t.vttjs.VTTRegion||t.window.VTTRegion);i.width=n.get("width",100),i.lines=n.get("lines",3),i.regionAnchorX=n.get("regionanchorX",0),i.regionAnchorY=n.get("regionanchorY",100),i.viewportAnchorX=n.get("viewportanchorX",0),i.viewportAnchorY=n.get("viewportanchorY",100),i.scroll=n.get("scroll",""),t.onregion&&t.onregion(i),t.regionList.push({id:n.get("id"),region:i})}}(n)},/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var r;if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var a=(r=n()).match(/^WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new gc(gc.Errors.BadSignature);t.state="HEADER"}for(var o=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:r=n(),t.state){case"HEADER":/:/.test(r)?i(r):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;t.cue=new(t.vttjs.VTTCue||t.window.VTTCue)(0,0,"");try{t.cue.align="center"}catch(e){t.cue.align="middle"}if(t.state="CUE",-1===r.indexOf("--\x3e")){t.cue.id=r;continue}case"CUE":try{_c(r,t.cue,t.regionList)}catch(e){t.reportOrThrowError(e),t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var s=-1!==r.indexOf("--\x3e");if(!r||s&&(o=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=r.replace(/\u2028/g,"\n").replace(/u2029/g,"\n");continue;case"BADCUE":r||(t.state="ID");continue}}}catch(e){t.reportOrThrowError(e),"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state)throw new gc(gc.Errors.BadSignature)}catch(t){e.reportOrThrowError(t)}return e.onflush&&e.onflush(),this}};var Oc=Dc,Nc={"":1,lr:1,rl:1},kc={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function Fc(e){return"string"==typeof e&&(!!kc[e.toLowerCase()]&&e.toLowerCase())}function Bc(e,t,n){this.hasBeenReset=!1;var i="",r=!1,a=e,o=t,s=n,l=null,c="",u=!0,d="auto",h="start",f="auto",p="auto",g=100,m="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return i},set:function(e){i=""+e}},pauseOnExit:{enumerable:!0,get:function(){return r},set:function(e){r=!!e}},startTime:{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");a=e,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");o=e,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return s},set:function(e){s=""+e,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return l},set:function(e){l=e,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return c},set:function(e){var t=function(e){return"string"==typeof e&&!!Nc[e.toLowerCase()]&&e.toLowerCase()}(e);if(!1===t)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");c=t,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return u},set:function(e){u=!!e,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return d},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("Line: an invalid number or illegal string was specified.");d=e,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return h},set:function(e){var t=Fc(e);t?(h=t,this.hasBeenReset=!0):console.warn("lineAlign: an invalid or illegal string was specified.")}},position:{enumerable:!0,get:function(){return f},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");f=e,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return p},set:function(e){var t=Fc(e);t?(p=t,this.hasBeenReset=!0):console.warn("positionAlign: an invalid or illegal string was specified.")}},size:{enumerable:!0,get:function(){return g},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");g=e,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return m},set:function(e){var t=Fc(e);if(!t)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");m=t,this.hasBeenReset=!0}}}),this.displayState=void 0}Bc.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)};var Uc=Bc,Vc={"":!0,up:!0};function Gc(e){return"number"==typeof e&&e>=0&&e<=100}var Hc=function(){var e=100,t=3,n=0,i=100,r=0,a=100,o="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return e},set:function(t){if(!Gc(t))throw new Error("Width must be between 0 and 100.");e=t}},lines:{enumerable:!0,get:function(){return t},set:function(e){if("number"!=typeof e)throw new TypeError("Lines must be set to a number.");t=e}},regionAnchorY:{enumerable:!0,get:function(){return i},set:function(e){if(!Gc(e))throw new Error("RegionAnchorX must be between 0 and 100.");i=e}},regionAnchorX:{enumerable:!0,get:function(){return n},set:function(e){if(!Gc(e))throw new Error("RegionAnchorY must be between 0 and 100.");n=e}},viewportAnchorY:{enumerable:!0,get:function(){return a},set:function(e){if(!Gc(e))throw new Error("ViewportAnchorY must be between 0 and 100.");a=e}},viewportAnchorX:{enumerable:!0,get:function(){return r},set:function(e){if(!Gc(e))throw new Error("ViewportAnchorX must be between 0 and 100.");r=e}},scroll:{enumerable:!0,get:function(){return o},set:function(e){var t=function(e){return"string"==typeof e&&!!Vc[e.toLowerCase()]&&e.toLowerCase()}(e);!1===t?console.warn("Scroll: an invalid or illegal string was specified."):o=t}}})},jc=lc,zc=sc.exports={WebVTT:Oc,VTTCue:Uc,VTTRegion:Hc};jc.vttjs=zc,jc.WebVTT=zc.WebVTT;var Zc=zc.VTTCue,qc=zc.VTTRegion,Wc=jc.VTTCue,Yc=jc.VTTRegion;zc.shim=function(){jc.VTTCue=Zc,jc.VTTRegion=qc},zc.restore=function(){jc.VTTCue=Wc,jc.VTTRegion=Yc},jc.VTTCue||zc.shim();var Kc=sc.exports;const Xc=i({__proto__:null,default:Q(Kc)},[Kc]);var Qc=function(e,t){var n=/[\u0020\t\f]/,i=/[^\u0020\t\f]/,r=(e=e,0),a=function(e){t(e,r+1)};function o(t){for(;null!=e[r]&&t.test(e[r]);)r++}function s(t){for(var n="";null!=e[r]&&t.test(e[r]);)n+=e[r],r++;return n}function l(){var t,n,i,o,l="minutes";if(null!=e[r])if(/\d/.test(e[r]))if(((t=s(/\d/)).length>2||parseInt(t,10)>59)&&(l="hours"),":"==e[r])if(r++,2==(n=s(/\d/)).length){if("hours"==l||":"==e[r]){if(":"!=e[r])return void a("No seconds found or minutes is greater than 59.");if(r++,2!=(i=s(/\d/)).length)return void a("Must be exactly two digits.")}else i=n,n=t,t="0";if("."==e[r])if(r++,3==(o=s(/\d/)).length)if(parseInt(n,10)>59)a("You cannot have more than 59 minutes.");else{if(!(parseInt(i,10)>59))return 60*parseInt(t,10)*60+60*parseInt(n,10)+parseInt(i,10)+parseInt(o,10)/1e3;a("You cannot have more than 59 seconds.")}else a("Milliseconds must be given in three digits.");else a('No decimal separator (".") found.')}else a("Must be exactly two digits.");else a("No time unit separator found.");else a("Timestamp must start with a character in the range 0-9.");else a("No timestamp found.")}this.parse=function(t,s){if(o(n),t.startTime=l(),null!=t.startTime){if(t.startTime<s&&a("Start timestamp is not greater than or equal to start timestamp of previous cue."),i.test(e[r])&&a("Timestamp not separated from '--\x3e' by whitespace."),o(n),"-"!=e[r])return void a("No valid timestamp separator found.");if(r++,"-"!=e[r])return void a("No valid timestamp separator found.");if(r++,">"!=e[r])return void a("No valid timestamp separator found.");if(r++,i.test(e[r])&&a("'--\x3e' not separated from timestamp by whitespace."),o(n),t.endTime=l(),null!=t.endTime)return t.endTime<=t.startTime&&a("End timestamp is not greater than start timestamp."),i.test(e[r]),o(n),function(e,t){for(var i=e.split(n),r=[],o=0;o<i.length;o++)if(""!=i[o]){var s=i[o].indexOf(":"),l=i[o].slice(0,s);if(value=i[o].slice(s+1),-1!=r.indexOf(l)&&a("Duplicate setting."),r.push(l),""==value)return void a("No value for setting defined.");if("vertical"==l){if("rl"!=value&&"lr"!=value){a("Writing direction can only be set to 'rl' or 'rl'.");continue}t.direction=value}else if("line"==l){if(!/\d/.test(value)){a("Line position takes a number or percentage.");continue}if(-1!=value.indexOf("-",1)){a("Line position can only have '-' at the start.");continue}if(-1!=value.indexOf("%")&&value.indexOf("%")!=value.length-1){a("Line position can only have '%' at the end.");continue}if("-"==value[0]&&"%"==value[value.length-1]){a("Line position cannot be a negative percentage.");continue}if("%"==value[value.length-1]){if(parseInt(value,10)>100){a("Line position cannot be >100%.");continue}t.snapToLines=!1}t.linePosition=parseInt(value,10)}else if("position"==l){if("%"!=value[value.length-1]){a("Text position must be a percentage.");continue}if(parseInt(value,10)>100){a("Size cannot be >100%.");continue}t.textPosition=parseInt(value,10)}else if("size"==l){if("%"!=value[value.length-1]){a("Size must be a percentage.");continue}if(parseInt(value,10)>100){a("Size cannot be >100%.");continue}t.size=parseInt(value,10)}else if("align"==l){var c=["start","middle","end","left","right"];if(-1==c.indexOf(value)){a("Alignment can only be set to one of "+c.join(", ")+".");continue}t.alignment=value}else a("Invalid setting.")}}(e.substring(r),t),!0}},this.parseTimestamp=function(){var t=l();if(null==e[r])return t;a("Timestamp must not have trailing characters.")}},Jc=function(e,t,n){var i=0,r=function(e){"metadata"!=n&&t(e,i+1)};function a(){for(var t="data",n="",a="",o=[];null!=e[i-1]||0==i;){var s=e[i];if("data"==t)if("&"==s)a=s,t="escape";else if("<"==s&&""==n)t="tag";else{if("<"==s||null==s)return["text",n];n+=s}else if("escape"==t)if("&"==s)r("Incorrect escape."),n+=a,a=s;else if(/[abglmnsprt]/.test(s))a+=s;else if(";"==s)"&amp"==a?n+="&":"&lt"==a?n+="<":"&gt"==a?n+=">":"&lrm"==a?n+="‎":"&rlm"==a?n+="‏":"&nbsp"==a?n+=" ":(r("Incorrect escape."),n+=a+";"),t="data";else{if("<"==s||null==s)return r("Incorrect escape."),["text",n+=a];r("Incorrect escape."),n+=a+s,t="data"}else if("tag"==t)if("\t"==s||"\n"==s||"\f"==s||" "==s)t="start tag annotation";else if("."==s)t="start tag class";else if("/"==s)t="end tag";else if(/\d/.test(s))n=s,t="timestamp tag";else{if(">"==s||null==s)return">"==s&&i++,["start tag","",[],""];n=s,t="start tag"}else if("start tag"==t)if("\t"==s||"\f"==s||" "==s)t="start tag annotation";else if("\n"==s)a=s,t="start tag annotation";else if("."==s)t="start tag class";else{if(">"==s||null==s)return">"==s&&i++,["start tag",n,[],""];n+=s}else if("start tag class"==t)if("\t"==s||"\f"==s||" "==s)o.push(a),a="",t="start tag annotation";else if("\n"==s)o.push(a),a=s,t="start tag annotation";else if("."==s)o.push(a),a="";else{if(">"==s||null==s)return">"==s&&i++,o.push(a),["start tag",n,o,""];a+=s}else if("start tag annotation"==t){if(">"==s||null==s)return">"==s&&i++,["start tag",n,o,a=a.split(/[\u0020\t\f\r\n]+/).filter(function(e){if(e)return!0}).join(" ")];a+=s}else if("end tag"==t){if(">"==s||null==s)return">"==s&&i++,["end tag",n];n+=s}else if("timestamp tag"==t){if(">"==s||null==s)return">"==s&&i++,["timestamp",n];n+=s}else r("Never happens.");i++}}this.parse=function(t,o){var s={children:[]},l=s,c=[];function u(e){l.children.push({type:"object",name:e[1],classes:e[2],children:[],parent:l}),l=l.children[l.children.length-1]}function d(e){for(var t=l;t;){if(t.name==e)return!0;t=t.parent}}for(;null!=e[i];){var h=a();if("text"==h[0])l.children.push({type:"text",value:h[1],parent:l});else if("start tag"==h[0]){"chapters"==n&&r("Start tags not allowed in chapter title text.");var f=h[1];"v"!=f&&"lang"!=f&&""!=h[3]&&r("Only <v> and <lang> can have an annotation."),"c"==f||"i"==f||"b"==f||"u"==f||"ruby"==f||"rt"==f&&"ruby"==l.name?u(h):"v"==f?(d("v")&&r("<v> cannot be nested inside itself."),u(h),l.value=h[3],h[3]||r("<v> requires an annotation.")):"lang"==f?(u(h),l.value=h[3]):r("Incorrect start tag.")}else if("end tag"==h[0])"chapters"==n&&r("End tags not allowed in chapter title text."),h[1]==l.name?l=l.parent:"ruby"==h[1]&&"rt"==l.name?l=l.parent.parent:r("Incorrect end tag.");else if("timestamp"==h[0]){"chapters"==n&&r("Timestamp not allowed in chapter title text.");var p=new Qc(h[1],r).parseTimestamp();null!=p&&((p<=t||p>=o)&&r("Timestamp must be between start timestamp and end timestamp."),c.length>0&&c[c.length-1]>=p&&r("Timestamp must be greater than any previous timestamp."),l.children.push({type:"timestamp",value:p,parent:l}),c.push(p))}}for(;l.parent;)"v"!=l.name&&r("Required end tag missing."),l=l.parent;return s}};const $c=Object.freeze(Object.defineProperty({__proto__:null,default:function(){this.parse=function(e,t){var n=Date.now(),i=0,r=e.split(/\r\n|\r|\n/),a=!1,o=[],s=[];function l(e,t){s.push({message:e,line:i+1,col:t})}var c=r[i],u=c.length,d="WEBVTT",h=0,f=6;for("\ufeff"===c[0]&&(h=1,f+=1),(u<f||c.indexOf(d)!==0+h||u>f&&" "!==c[f]&&"\t"!==c[f])&&l('No valid signature. (File needs to start with "WEBVTT".)'),i++;""!=r[i]&&null!=r[i];){if(l("No blank line after the signature."),-1!=r[i].indexOf("--\x3e")){a=!0;break}i++}for(;null!=r[i];){for(var p;!a&&""==r[i];)i++;if(!a&&null==r[i])break;p={id:"",startTime:0,endTime:0,pauseOnExit:!1,direction:"horizontal",snapToLines:!0,linePosition:"auto",textPosition:50,size:100,alignment:"middle",text:"",tree:null};var g=!0;if(-1==r[i].indexOf("--\x3e")){if(p.id=r[i],/^NOTE($|[ \t])/.test(p.id)){for(i++;""!=r[i]&&null!=r[i];)-1!=r[i].indexOf("--\x3e")&&l("Cannot have timestamp in a comment."),i++;continue}if(""==r[++i]||null==r[i]){l("Cue identifier cannot be standalone.");continue}-1==r[i].indexOf("--\x3e")&&(g=!1,l("Cue identifier needs to be followed by timestamp."))}a=!1;var m=new Qc(r[i],l),v=0;if(o.length>0&&(v=o[o.length-1].startTime),!g||m.parse(p,v)){for(i++;""!=r[i]&&null!=r[i];){if(-1!=r[i].indexOf("--\x3e")){l("Blank line missing before cue."),a=!0;break}""!=p.text&&(p.text+="\n"),p.text+=r[i],i++}var y=new Jc(p.text,l,t);p.tree=y.parse(p.startTime,p.endTime),o.push(p)}else for(p=null,i++;""!=r[i]&&null!=r[i];){if(-1!=r[i].indexOf("--\x3e")){a=!0;break}i++}}return o.sort(function(e,t){return e.startTime<t.startTime?-1:e.startTime>t.startTime?1:e.endTime>t.endTime?-1:e.endTime<t.endTime?1:0}),{cues:o,errors:s,time:Date.now()-n}}}},Symbol.toStringTag,{value:"Module"})),eu=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},tu=Number.isSafeInteger||function(e){return"number"==typeof e&&Math.abs(e)<=nu},nu=Number.MAX_SAFE_INTEGER||9007199254740991;let iu=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),ru=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",e.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",e.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.ASSET_LIST_LOAD_ERROR="assetListLoadError",e.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",e.ASSET_LIST_PARSING_ERROR="assetListParsingError",e.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.ATTACH_MEDIA_ERROR="attachMediaError",e.UNKNOWN="unknown",e}({}),au=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.MEDIA_ENDED="hlsMediaEnded",e.STALL_RESOLVED="hlsStallResolved",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFERED_TO_END="hlsBufferedToEnd",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",e.ASSET_LIST_LOADING="hlsAssetListLoading",e.ASSET_LIST_LOADED="hlsAssetListLoaded",e.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",e.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",e.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",e.INTERSTITIAL_STARTED="hlsInterstitialStarted",e.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",e.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",e.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",e.INTERSTITIAL_ENDED="hlsInterstitialEnded",e.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",e.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",e.EVENT_CUE_ENTER="hlsEventCueEnter",e}({});var ou="manifest",su="level",lu="audioTrack",cu="subtitleTrack",uu={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class du{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class hu{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new du(e),this.fast_=new du(t),this.defaultTTFB_=i,this.ttfb_=new du(e)}update(e,t){const{slow_:n,fast_:i,ttfb_:r}=this;n.halfLife!==e&&(this.slow_=new du(e,n.getEstimate(),n.getTotalWeight())),i.halfLife!==t&&(this.fast_=new du(t,i.getEstimate(),i.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new du(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){const n=(e=Math.max(e,this.minDelayMs_))/1e3,i=8*t/n;this.fast_.sample(n,i),this.slow_.sample(n,i)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function fu(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pu(){return pu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},pu.apply(null,arguments)}function gu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function mu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gu(Object(n),!0).forEach(function(t){fu(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gu(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class vu{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n="[".concat(e,"]:");this.trace=yu,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const yu=function(){},_u={trace:yu,debug:yu,log:yu,warn:yu,info:yu,error:yu};function Eu(){return pu({},_u)}function bu(e,t,n){return t[e]?t[e].bind(t):function(e,t){const n=self.console[e];return n?n.bind(self.console,"".concat(t?"["+t+"] ":"","[").concat(e,"] >")):yu}(e,n)}const Tu=Eu();const Su=Tu;function wu(){return typeof self>"u"?void 0:(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function Au(e,t){const n=Object.keys(e),i=Object.keys(t),r=n.length,a=i.length;return!r||!a||r===a&&!n.some(e=>-1===i.indexOf(e))}function Ru(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(typeof TextDecoder<"u"){const n=new TextDecoder("utf-8").decode(e);if(t){const e=n.indexOf("\0");return-1!==e?n.substring(0,e):n}return n.replace(/\0/g,"")}const n=e.length;let i,r,a,o="",s=0;for(;s<n;){if(i=e[s++],0===i&&t)return o;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(i);break;case 12:case 13:r=e[s++],o+=String.fromCharCode((31&i)<<6|63&r);break;case 14:r=e[s++],a=e[s++],o+=String.fromCharCode((15&i)<<12|(63&r)<<6|63&a)}}return o}function xu(e){let t="";for(let n=0;n<e.length;n++){let i=e[n].toString(16);i.length<2&&(i="0"+i),t+=i}return t}function Iu(e){return Uint8Array.from(e.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var Lu,Mu={exports:{}};var Cu=(Lu||(Lu=1,function(e){var t,n,i,r,a;t=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,r=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var r=a.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=a.normalizePath(r.path),a.buildURLFromParts(r)}var o=a.parseURL(t);if(!o)throw new Error("Error trying to parse relative URL.");if(o.scheme)return i.alwaysNormalize?(o.path=a.normalizePath(o.path),a.buildURLFromParts(o)):t;var s=a.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var l=n.exec(s.path);s.netLoc=l[1],s.path=l[2]}s.netLoc&&!s.path&&(s.path="/");var c={scheme:s.scheme,netLoc:o.netLoc,path:null,params:o.params,query:o.query,fragment:o.fragment};if(!o.netLoc&&(c.netLoc=s.netLoc,"/"!==o.path[0]))if(o.path){var u=s.path,d=u.substring(0,u.lastIndexOf("/")+1)+o.path;c.path=a.normalizePath(d)}else c.path=s.path,o.params||(c.params=s.params,o.query||(c.query=s.query));return null===c.path&&(c.path=i.alwaysNormalize?a.normalizePath(o.path):o.path),a.buildURLFromParts(c)},parseURL:function(e){var n=t.exec(e);return n?{scheme:n[1]||"",netLoc:n[2]||"",path:n[3]||"",params:n[4]||"",query:n[5]||"",fragment:n[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(i,"");e.length!==(e=e.replace(r,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=a}(Mu)),Mu.exports);class Pu{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Du="audio",Ou="video",Nu="audiovideo";class ku{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,"string"==typeof e&&(e={url:e}),this.base=e,function(e,t){const n=Vu(e,t);n&&(n.enumerable=!0,Object.defineProperty(e,t,n))}(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let i;i=1===n.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(n[1]),this._byteRange=[i,parseInt(n[0])+i]}get baseurl(){return this.base.url}get byteRange(){return null===this._byteRange?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return null===this._streams&&(this._streams={[Du]:null,[Ou]:null,[Nu]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return null!==this._stats}get hasStreams(){return null!==this._streams}get stats(){return null===this._stats&&(this._stats=new Pu),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Cu.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Du]=null,e[Ou]=null,e[Nu]=null}}function Fu(e){return"initSegment"!==e.sn}class Bu extends ku{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(eu(e)&&eu(t))return t-e}return null}get bitrate(){return this.byteLength?8*this.byteLength/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const e=Object.keys(this.levelkeys);if(1===e.length){const t=this._decryptdata=this.levelkeys[e[0]]||null;if(t)return t.getDecryptData(this.sn)}}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;const e=eu(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){var t;const e=Object.keys(this.levelkeys),n=e.length;if(n>1||1===n&&null!=(t=this.levelkeys[e[0]])&&t.encrypted)return!0}return!1}get programDateTime(){return null===this._programDateTime&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){eu(e)?this._programDateTime=e:this._programDateTime=this.rawProgramDateTime=null}get ref(){return Fu(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,n,i,r){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const{elementaryStreams:o}=this,s=o[e];s?(s.startPTS=Math.min(s.startPTS,t),s.endPTS=Math.max(s.endPTS,n),s.startDTS=Math.min(s.startDTS,i),s.endDTS=Math.max(s.endDTS,r)):o[e]={startPTS:t,endPTS:n,startDTS:i,endDTS:r,partial:a}}}class Uu extends ku{constructor(e,t,n,i,r){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function Vu(e,t){const n=Object.getPrototypeOf(e);if(n){return Object.getOwnPropertyDescriptor(n,t)||Vu(n,t)}}const Gu=Math.pow(2,32)-1,Hu=[].push,ju={video:1,audio:2,id3:3,text:4};function zu(e){return String.fromCharCode.apply(null,e)}function Zu(e,t){const n=e[t]<<8|e[t+1];return n<0?65536+n:n}function qu(e,t){const n=Yu(e,t);return n<0?4294967296+n:n}function Wu(e,t){let n=qu(e,t);return n*=Math.pow(2,32),n+=qu(e,t+4),n}function Yu(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function Ku(e,t){const n=[];if(!t.length)return n;const i=e.byteLength;for(let r=0;r<i;){const a=qu(e,r),o=a>1?r+a:i;if(zu(e.subarray(r+4,r+8))===t[0])if(1===t.length)n.push(e.subarray(r+8,o));else{const i=Ku(e.subarray(r+8,o),t.slice(1));i.length&&Hu.apply(n,i)}r=o}return n}function Xu(e){const t=[],n=e[0];let i=8;const r=qu(e,i);i+=4;let a=0,o=0;0===n?(a=qu(e,i),o=qu(e,i+4),i+=8):(a=Wu(e,i),o=Wu(e,i+8),i+=16),i+=2;let s=e.length+o;const l=Zu(e,i);i+=2;for(let n=0;n<l;n++){let n=i;const a=qu(e,n);n+=4;const o=2147483647&a;if((2147483648&a)>>>31==1)return Su.warn("SIDX has hierarchical references (not supported)"),null;const l=qu(e,n);n+=4,t.push({referenceSize:o,subsegmentDuration:l,info:{duration:l/r,start:s,end:s+o-1}}),s+=o,n+=4,i=n}return{earliestPresentationTime:a,timescale:r,version:n,referencesCount:l,references:t}}function Qu(e){const t=[],n=Ku(e,["moov","trak"]);for(let e=0;e<n.length;e++){const i=n[e],r=Ku(i,["tkhd"])[0];if(r){let e=r[0];const n=qu(r,0===e?12:20),a=Ku(i,["mdia","mdhd"])[0];if(a){e=a[0];const r=qu(a,0===e?12:20),o=Ku(i,["mdia","hdlr"])[0];if(o){const e=zu(o.subarray(8,12)),a={soun:Du,vide:Ou}[e],s=Ju(Ku(i,["mdia","minf","stbl","stsd"])[0]);a?(t[n]={timescale:r,type:a,stsd:s},t[a]=mu({timescale:r,id:n},s)):t[n]={timescale:r,type:e,stsd:s}}}}}return Ku(e,["moov","mvex","trex"]).forEach(e=>{const n=qu(e,4),i=t[n];i&&(i.default={duration:qu(e,12),flags:qu(e,20)})}),t}function Ju(e){const t=e.subarray(8),n=t.subarray(86),i=zu(t.subarray(4,8));let r,a=i;const o="enca"===i||"encv"===i;if(o){const e=Ku(t,[i])[0].subarray("enca"===i?28:78);Ku(e,["sinf"]).forEach(e=>{const t=Ku(e,["schm"])[0];if(t){const n=zu(t.subarray(4,8));if("cbcs"===n||"cenc"===n){const t=Ku(e,["frma"])[0];t&&(a=zu(t))}}})}const s=a;switch(a){case"avc1":case"avc2":case"avc3":case"avc4":{const e=Ku(n,["avcC"])[0];e&&e.length>3&&(a+="."+td(e[1])+td(e[2])+td(e[3]),r=$u("avc1"===s?"dva1":"dvav",n));break}case"mp4a":{const e=Ku(t,[i])[0],n=Ku(e.subarray(28),["esds"])[0];if(n&&n.length>7){let e=4;if(3!==n[e++])break;e=ed(n,e),e+=2;const t=n[e++];if(128&t&&(e+=2),64&t&&(e+=n[e++]),4!==n[e++])break;e=ed(n,e);const i=n[e++];if(64!==i)break;if(a+="."+td(i),e+=12,5!==n[e++])break;e=ed(n,e);const r=n[e++];let o=(248&r)>>3;31===o&&(o+=1+((7&r)<<3)+((224&n[e])>>5)),a+="."+o}break}case"hvc1":case"hev1":{const e=Ku(n,["hvcC"])[0];if(e&&e.length>12){const t=e[1],n=["","A","B","C"][t>>6],i=31&t,r=qu(e,2),o=(32&t)>>5?"H":"L",s=e[12],l=e.subarray(6,12);a+="."+n+i,a+="."+function(e){let t=0;for(let n=0;n<32;n++)t|=(e>>n&1)<<31-n;return t>>>0}(r).toString(16).toUpperCase(),a+="."+o+s;let c="";for(let e=l.length;e--;){const t=l[e];(t||c)&&(c="."+t.toString(16).toUpperCase()+c)}a+=c}r=$u("hev1"==s?"dvhe":"dvh1",n);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":a=$u(a,n)||a;break;case"vp09":{const e=Ku(n,["vpcC"])[0];if(e&&e.length>6){const t=e[4],n=e[5],i=e[6]>>4&15;a+="."+nd(t)+"."+nd(n)+"."+nd(i)}break}case"av01":{const e=Ku(n,["av1C"])[0];if(e&&e.length>2){const t=e[1]>>>5,i=31&e[1],o=e[2]>>>7?"H":"M",s=(64&e[2])>>6,l=(32&e[2])>>5,c=2===t&&s?l?12:10:s?10:8,u=(16&e[2])>>4,d=(8&e[2])>>3,h=(4&e[2])>>2,f=3&e[2];a+="."+t+"."+nd(i)+o+"."+nd(c)+"."+u+"."+d+h+f+"."+nd(1)+"."+nd(1)+"."+nd(1)+".0",r=$u("dav1",n)}break}}return{codec:a,encrypted:o,supplemental:r}}function $u(e,t){const n=Ku(t,["dvvC"]),i=n.length?n[0]:Ku(t,["dvcC"])[0];if(i){const t=i[2]>>1&127,n=i[2]<<5&32|i[3]>>3&31;return e+"."+nd(t)+"."+nd(n)}}function ed(e,t){const n=t+5;for(;128&e[t++]&&t<n;);return t}function td(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function nd(e){return(e<10?"0":"")+e}function id(e){const t=Ku(e,["schm"])[0];if(t){const n=zu(t.subarray(4,8));if("cbcs"===n||"cenc"===n)return Ku(e,["schi","tenc"])[0]}return null}function rd(e,t){const n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function ad(e,t){const n=[],i=t.samples,r=t.timescale,a=t.id;let o=!1;return Ku(i,["moof"]).map(s=>{const l=s.byteOffset-8;Ku(s,["traf"]).map(s=>{const c=Ku(s,["tfdt"]).map(e=>{const t=e[0];let n=qu(e,4);return 1===t&&(n*=Math.pow(2,32),n+=qu(e,8)),n/r})[0];return void 0!==c&&(e=c),Ku(s,["tfhd"]).map(c=>{const u=qu(c,4),d=16777215&qu(c,0);let h=0;const f=!!(16&d);let p=0;const g=!!(32&d);let m=8;u===a&&(!!(1&d)&&(m+=8),!!(2&d)&&(m+=4),!!(8&d)&&(h=qu(c,m),m+=4),f&&(p=qu(c,m),m+=4),g&&(m+=4),"video"===t.type&&(o=od(t.codec)),Ku(s,["trun"]).map(a=>{const s=a[0],c=16777215&qu(a,0),u=!!(1&c);let d=0;const f=!!(4&c),g=!!(256&c);let m=0;const v=!!(512&c);let y=0;const _=!!(1024&c),E=!!(2048&c);let b=0;const T=qu(a,4);let S=8;u&&(d=qu(a,S),S+=4),f&&(S+=4);let w=d+l;for(let l=0;l<T;l++){if(g?(m=qu(a,S),S+=4):m=h,v?(y=qu(a,S),S+=4):y=p,_&&(S+=4),E&&(b=0===s?qu(a,S):Yu(a,S),S+=4),t.type===Ou){let t=0;for(;t<y;){const a=qu(i,w);if(w+=4,sd(o,i[w])){ld(i.subarray(w,w+a),o?2:1,e+b/r,n)}w+=a,t+=a+4}}e+=m/r}}))})})}),n}function od(e){if(!e)return!1;const t=e.substring(0,4);return"hvc1"===t||"hev1"===t||"dvh1"===t||"dvhe"===t}function sd(e,t){if(e){const e=t>>1&63;return 39===e||40===e}return 6==(31&t)}function ld(e,t,n,i){const r=cd(e);let a=0;a+=t;let o=0,s=0,l=0;for(;a<r.length;){o=0;do{if(a>=r.length)break;l=r[a++],o+=l}while(255===l);s=0;do{if(a>=r.length)break;l=r[a++],s+=l}while(255===l);const e=r.length-a;let t=a;if(s<e)a+=s;else if(s>e){Su.error("Malformed SEI payload. ".concat(s," is too small, only ").concat(e," bytes left to parse."));break}if(4===o){if(181===r[t++]){const e=Zu(r,t);if(t+=2,49===e){const e=qu(r,t);if(t+=4,1195456820===e){const e=r[t++];if(3===e){const a=r[t++],s=64&a,l=s?2+3*(31&a):0,c=new Uint8Array(l);if(s){c[0]=a;for(let e=1;e<l;e++)c[e]=r[t++]}i.push({type:e,payloadType:o,pts:n,bytes:c})}}}}}else if(5===o&&s>16){const e=[];for(let n=0;n<16;n++){const i=r[t++].toString(16);e.push(1==i.length?"0"+i:i),(3===n||5===n||7===n||9===n)&&e.push("-")}const a=s-16,l=new Uint8Array(a);for(let e=0;e<a;e++)l[e]=r[t++];i.push({payloadType:o,pts:n,uuid:e.join(""),userData:Ru(l),userDataBytes:l})}}}function cd(e){const t=e.byteLength,n=[];let i=1;for(;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(n.push(i+2),i+=2):i++;if(0===n.length)return e;const r=t-n.length,a=new Uint8Array(r);let o=0;for(i=0;i<r;o++,i++)o===n[0]&&(o++,n.shift()),a[i]=e[o];return a}function ud(e,t,n){if(16!==e.byteLength)throw new RangeError("Invalid system id");let i,r,a;i=0,r=new Uint8Array,a=new Uint8Array;const o=new Uint8Array(4);return n.byteLength>0&&new DataView(o.buffer).setUint32(0,n.byteLength,!1),function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const r=n.length;let a=8,o=r;for(;o--;)a+=n[o].byteLength;const s=new Uint8Array(a);for(s[0]=a>>24&255,s[1]=a>>16&255,s[2]=a>>8&255,s[3]=255&a,s.set(e,4),o=0,a=8;o<r;o++)s.set(n[o],a),a+=n[o].byteLength;return s}([112,115,115,104],new Uint8Array([0,0,0,0]),e,a,r,o,n)}function dd(e){const t=e.getUint32(0),n=e.byteOffset,i=e.byteLength;if(i<t)return{offset:n,size:i};if(1886614376!==e.getUint32(4))return{offset:n,size:t};const r=e.getUint32(8)>>>24;if(0!==r&&1!==r)return{offset:n,size:t};const a=e.buffer,o=xu(new Uint8Array(a,n+12,16));let s=null,l=null,c=0;if(0===r)c=28;else{const r=e.getUint32(28);if(!r||i<32+16*r)return{offset:n,size:t};s=[];for(let e=0;e<r;e++)s.push(new Uint8Array(a,n+32+16*e,16));c=32+16*r}if(!c)return{offset:n,size:t};const u=e.getUint32(c);return t-32<u?{offset:n,size:t}:(l=new Uint8Array(a,n+c+4,u),{version:r,systemId:o,kids:s,data:l,offset:n,size:t})}const hd=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),fd={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function pd(e,t){const n=fd[t];return!!n&&!!n[e.slice(0,4)]}function gd(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return!e.split(",").some(e=>!md(e,t,n))}function md(e,t){var n;const i=wu(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]);return null!=(n=null==i?void 0:i.isTypeSupported(vd(e,t)))&&n}function vd(e,t){return"".concat(t,"/mp4;codecs=").concat(e)}function yd(e){if(e){const t=e.substring(0,4);return fd.video[t]}return 2}function _d(e){const t=hd();return e.split(",").reduce((e,n)=>{const i=t&&od(n)?9:fd.video[n];return i?(2*i+e)/(e?3:2):(fd.audio[n]+e)/(e?2:1)},0)}const Ed={};const bd=/flac|opus|mp4a\.40\.34/i;function Td(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.replace(bd,e=>function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Ed[e])return Ed[e];const n={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[e];for(let r=0;r<n.length;r++){var i;if(md(n[r],"audio",t))return Ed[e]=n[r],n[r];if("mp3"===n[r]&&null!=(i=wu(t))&&i.isTypeSupported("audio/mpeg"))return""}return e}(e.toLowerCase(),t))}function Sd(e,t){if(e&&(e.length>4||-1!==["ac-3","ec-3","alac","fLaC","Opus"].indexOf(e))&&(wd(e,"audio")||wd(e,"video")))return e;if(t){const n=t.split(",");if(n.length>1){if(e)for(let t=n.length;t--;)if(n[t].substring(0,4)===e.substring(0,4))return n[t];return n[0]}}return t||e}function wd(e,t){return pd(e,t)&&md(e,t)}function Ad(e){if(e.startsWith("av01.")){const t=e.split("."),n=["0","111","01","01","01","0"];for(let e=t.length;e>4&&e<10;e++)t[e]=n[e-4];return t.join(".")}return e}function Rd(e){const t=wu(e)||{isTypeSupported:()=>!1};return{mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:t.isTypeSupported('audio/mp4; codecs="ac-3"')}}function xd(e){return e.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const Id={supported:!1,smooth:!1,powerEfficient:!1},Ld={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function Md(e,t){return{supported:!1,configurations:t,decodingInfoResults:[Id],error:e}}function Cd(e,t,n,i,r,a){const o=e.videoCodec,s=e.audioCodec?e.audioGroups:null,l=null==a?void 0:a.audioCodec,c=null==a?void 0:a.channels,u=c?parseInt(c):l?1/0:2;let d=null;if(null!=s&&s.length)try{d=1===s.length&&s[0]?t.groups[s[0]].channels:s.reduce((e,n)=>{if(n){const i=t.groups[n];if(!i)throw new Error("Audio track group ".concat(n," not found"));Object.keys(i.channels).forEach(t=>{e[t]=(e[t]||0)+i.channels[t]})}return e},{2:0})}catch(e){return!0}return void 0!==o&&(o.split(",").some(e=>od(e))||e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(i,30)||"SDR"!==e.videoRange&&e.videoRange!==n||e.bitrate>Math.max(r,8e6))||!!d&&eu(u)&&Object.keys(d).some(e=>parseInt(e)>u)}function Pd(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const r=e.videoCodec;if(!r&&!e.audioCodec||!n)return Promise.resolve(Ld);const a=[],o=function(e){var t;const n=null==(t=e.videoCodec)?void 0:t.split(","),i=Od(e),r=e.width||640,a=e.height||480,o=e.frameRate||30,s=e.videoRange.toLowerCase();return n?n.map(e=>{const t={contentType:vd(Ad(e),"video"),width:r,height:a,bitrate:i,framerate:o};return"sdr"!==s&&(t.transferFunction=s),t}):[]}(e),s=o.length,l=function(e,t,n){var i;const r=null==(i=e.audioCodec)?void 0:i.split(","),a=Od(e);return r&&e.audioGroups?e.audioGroups.reduce((e,i)=>{var o;const s=i?null==(o=t.groups[i])?void 0:o.tracks:null;return s?s.reduce((e,t)=>{if(t.groupId===i){const i=parseFloat(t.channels||"");r.forEach(t=>{const r={contentType:vd(t,"audio"),bitrate:n?Dd(t,a):a};i&&(r.channels=""+i),e.push(r)})}return e},e):e},[]):[]}(e,t,s>0),c=l.length;for(let e=s||1*c||1;e--;){const t={type:"media-source"};if(s&&(t.video=o[e%s]),c){t.audio=l[e%c];const n=t.audio.bitrate;t.video&&n&&(t.video.bitrate-=n)}a.push(t)}if(r){const e=navigator.userAgent;if(r.split(",").some(e=>od(e))&&hd())return Promise.resolve(Md(new Error("Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (".concat(e,")")),a))}return Promise.all(a.map(e=>{const t=function(e){let t="";const{audio:n,video:i}=e;if(i){const e=xd(i.contentType);t+="".concat(e,"_r").concat(i.height,"x").concat(i.width,"f").concat(Math.ceil(i.framerate)).concat(i.transferFunction||"sd","_").concat(Math.ceil(i.bitrate/1e5))}if(n){const e=xd(n.contentType);t+="".concat(i?"_":"").concat(e,"_c").concat(n.channels)}return t}(e);return i[t]||(i[t]=n.decodingInfo(e))})).then(e=>({supported:!e.some(e=>!e.supported),configurations:a,decodingInfoResults:e})).catch(e=>({supported:!1,configurations:a,decodingInfoResults:[],error:e}))}function Dd(e,t){if(t<=1)return 1;let n=128e3;return"ec-3"===e?n=768e3:"ac-3"===e&&(n=64e4),Math.min(t/2,n)}function Od(e){return 1e3*Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)/1e3)||1}const Nd=["NONE","TYPE-0","TYPE-1",null];const kd=["SDR","PQ","HLG"];var Fd={No:"",Yes:"YES",v2:"v2"};function Bd(e){const{canSkipUntil:t,canSkipDateRanges:n,age:i}=e;return t&&i<t/2?n?Fd.v2:Fd.Yes:Fd.No}class Ud{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Vd{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(e=>!!e).map(e=>e.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=null==(t=e.supplemental)?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=",".concat(n.substring(0,4)))}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Gd(this._audioGroups,e)}hasSubtitleGroup(e){return Gd(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t)if("audio"===e){let e=this._audioGroups;e||(e=this._audioGroups=[]),-1===e.indexOf(t)&&e.push(t)}else if("text"===e){let e=this._subtitleGroups;e||(e=this._subtitleGroups=[]),-1===e.indexOf(t)&&e.push(t)}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return null==(e=this.audioGroups)?void 0:e[0]}get textGroupId(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}addFallback(){}}function Gd(e,t){return!(!t||!e)&&-1!==e.indexOf(t)}function Hd(e,t){let n=!1,i=[];if(e&&(n="SDR"!==e,i=[e]),t){i=t.allowedVideoRanges||kd.slice(0);const e="SDR"!==i.join("")&&!t.videoCodec;n=void 0!==t.preferHDR?t.preferHDR:e&&function(){if("function"==typeof matchMedia){const e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}(),n||(i=["SDR"])}return{preferHDR:n,allowedVideoRanges:i}}const jd=(e,t)=>JSON.stringify(e,(e=>{const t=new WeakSet;return(n,i)=>{if(e&&(i=e(n,i)),"object"==typeof i&&null!==i){if(t.has(i))return;t.add(i)}return i}})(t));function zd(e,t){Su.log('[abr] start candidates with "'.concat(e,'" ignored because ').concat(t))}function Zd(e){return e.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const i=t.channels||"2";return n.channels[i]=(n.channels[i]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function qd(e){if(!e)return e;const{lang:t,assocLang:n,characteristics:i,channels:r,audioCodec:a}=e;return{lang:t,assocLang:n,characteristics:i,channels:r,audioCodec:a}}function Wd(e,t,n){if("attrs"in e){const n=t.indexOf(e);if(-1!==n)return n}for(let i=0;i<t.length;i++){if(Yd(e,t[i],n))return i}return-1}function Yd(e,t,n){const{groupId:i,name:r,lang:a,assocLang:o,default:s}=e,l=e.forced;return(void 0===i||t.groupId===i)&&(void 0===r||t.name===r)&&(void 0===a||function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"--";return e.length===t.length?e===t:e.startsWith(t)||t.startsWith(e)}(a,t.lang))&&(void 0===a||t.assocLang===o)&&(void 0===s||t.default===s)&&(void 0===l||t.forced===l)&&(!("characteristics"in e)||function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e.split(","),i=t.split(",");return n.length===i.length&&!n.some(e=>-1===i.indexOf(e))}(e.characteristics||"",t.characteristics))&&(void 0===n||n(e,t))}function Kd(e,t){const{audioCodec:n,channels:i}=e;return!(void 0!==n&&(t.audioCodec||"").substring(0,4)!==n.substring(0,4)||void 0!==i&&i!==(t.channels||"2"))}function Xd(e,t,n){for(let i=t;i>-1;i--)if(n(e[i]))return i;for(let i=t+1;i<e.length;i++)if(n(e[i]))return i;return-1}function Qd(e,t){var n;return!!e&&e!==(null==(n=t.loadLevelObj)?void 0:n.uri)}class Jd extends vu{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=e=>{var t;const{fragCurrent:n,partCurrent:i,hls:r}=this,{autoLevelEnabled:a,media:o}=r;if(!n||!o)return;const s=performance.now(),l=i?i.stats:n.stats,c=i?i.duration:n.duration,u=s-l.loading.start,d=r.minAutoLevel,h=n.level,f=this._nextAutoLevel;if(l.aborted||l.loaded&&l.loaded===l.total||h<=d)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!a)return;const p=f>-1&&f!==h,g=!!e||p;if(!g&&(o.paused||!o.playbackRate||!o.readyState))return;const m=r.mainForwardBufferInfo;if(!g&&null===m)return;const v=this.bwEstimator.getEstimateTTFB(),y=Math.abs(o.playbackRate);if(u<=Math.max(v,c/(2*y)*1e3))return;const _=m?m.len/y:0,E=l.loading.first?l.loading.first-l.loading.start:-1,b=l.loaded&&E>-1,T=this.getBwEstimate(),S=r.levels,w=S[h],A=Math.max(l.loaded,Math.round(c*(n.bitrate||w.averageBitrate)/8));let R=b?u-E:u;R<1&&b&&(R=Math.min(u,8*l.loaded/T));const x=b?1e3*l.loaded/R:0,I=v/1e3,L=x?(A-l.loaded)/x:8*A/T+I;if(L<=_)return;const M=x?8*x:T,C=!0===(null==(t=(null==e?void 0:e.details)||this.hls.latestLevelDetails)?void 0:t.live),P=this.hls.config.abrBandWidthUpFactor;let D,O=Number.POSITIVE_INFINITY;for(D=h-1;D>d;D--){const e=S[D].maxBitrate,t=!S[D].details||C;if(O=this.getTimeToLoadFrag(I,M,c*e,t),O<Math.min(_,c+I))break}if(O>=L||O>10*c)return;b?this.bwEstimator.sample(u-Math.min(v,E),l.loaded):this.bwEstimator.sampleTTFB(u);const N=S[D].maxBitrate;this.getBwEstimate()*P>N&&this.resetEstimator(N);const k=this.findBestLevel(N,d,D,0,_,1,1);k>-1&&(D=k),this.warn("Fragment ".concat(n.sn).concat(i?" part "+i.index:""," of level ").concat(h," is loading too slowly;\n      Fragment duration: ").concat(n.duration.toFixed(3),"\n      Time to underbuffer: ").concat(_.toFixed(3)," s\n      Estimated load time for current fragment: ").concat(L.toFixed(3)," s\n      Estimated load time for down switch fragment: ").concat(O.toFixed(3)," s\n      TTFB estimate: ").concat(0|E," ms\n      Current BW estimate: ").concat(eu(T)?0|T:"Unknown"," bps\n      New BW estimate: ").concat(0|this.getBwEstimate()," bps\n      Switching to level ").concat(D," @ ").concat(0|N," bps")),r.nextLoadLevel=r.nextAutoLevel=D,this.clearTimer();const F=()=>{if(this.clearTimer(),this.fragCurrent===n&&this.hls.loadLevel===D&&D>0){const e=this.getStarvationDelay();if(this.warn("Aborting inflight request ".concat(D>0?"and switching down":"","\n      Fragment duration: ").concat(n.duration.toFixed(3)," s\n      Time to underbuffer: ").concat(e.toFixed(3)," s")),n.abortRequests(),this.fragCurrent=this.partCurrent=null,D>d){let t=this.findBestLevel(this.hls.levels[d].bitrate,d,D,0,e,1,1);-1===t&&(t=d),this.hls.nextLoadLevel=this.hls.nextAutoLevel=t,this.resetEstimator(this.hls.levels[t].bitrate)}}};p||L>2*O?F():this.timer=self.setInterval(F,1e3*O),r.trigger(au.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:i,stats:l})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log("setting initial bwe to ".concat(e)),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new hu(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(au.MANIFEST_LOADING,this.onManifestLoading,this),e.on(au.FRAG_LOADING,this.onFragLoading,this),e.on(au.FRAG_LOADED,this.onFragLoaded,this),e.on(au.FRAG_BUFFERED,this.onFragBuffered,this),e.on(au.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(au.LEVEL_LOADED,this.onLevelLoaded,this),e.on(au.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(au.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(au.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(au.MANIFEST_LOADING,this.onManifestLoading,this),e.off(au.FRAG_LOADING,this.onFragLoading,this),e.off(au.FRAG_LOADED,this.onFragLoaded,this),e.off(au.FRAG_BUFFERED,this.onFragBuffered,this),e.off(au.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(au.LEVEL_LOADED,this.onLevelLoaded,this),e.off(au.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(au.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(au.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){var i;if(!n.bitrateTest)this.fragCurrent=n,this.partCurrent=null!=(i=t.part)?i:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case ru.BUFFER_ADD_CODEC_ERROR:case ru.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case ru.FRAG_LOAD_TIMEOUT:{const e=t.frag,{fragCurrent:n,partCurrent:i}=this;if(e&&n&&e.sn===n.sn&&e.level===n.level){const t=performance.now(),n=i?i.stats:e.stats,r=t-n.loading.start,a=n.loading.first?n.loading.first-n.loading.start:-1;if(n.loaded&&a>-1){const e=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(r-Math.min(e,a),n.loaded)}else this.bwEstimator.sampleTTFB(r)}break}}}getTimeToLoadFrag(e,t,n,i){return e+n/t+(i?e+this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const n=this.hls.config,{loading:i}=t.stats,r=i.end-i.first;eu(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,t){let{frag:n,part:i}=t;const r=i?i.stats:n.stats;if(n.type===uu.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(n)){if(this.clearTimer(),n.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const e=i?i.duration:n.duration,t=this.hls.levels[n.level],a=(t.loaded?t.loaded.bytes:0)+r.loaded,o=(t.loaded?t.loaded.duration:0)+e;t.loaded={bytes:a,duration:o},t.realBitrate=Math.round(8*a/o)}if(n.bitrateTest){const e={stats:r,frag:n,part:i,id:n.type};this.onFragBuffered(au.FRAG_BUFFERED,e),n.bitrateTest=!1}else this.lastLoadedFragLevel=n.level}}onFragBuffered(e,t){const{frag:n,part:i}=t,r=null!=i&&i.stats.loaded?i.stats:n.stats;if(r.aborted||this.ignoreFragment(n))return;const a=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,r.loaded),r.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==uu.MAIN||"initSegment"===e.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,r=this.findBestLevel(n,t,e,0,i,1,1);if(r>-1)return r;const a=this.hls.firstLevel,o=Math.min(Math.max(a,t),e);return this.warn("Could not find best starting auto level. Defaulting to first in playlist ".concat(a," clamped to ").concat(o)),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(!(-1===e||t&&n&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return e;const i=t&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,i)&&t[e].loadError<=t[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return"".concat(this.getBwEstimate(),"_").concat(this.getStarvationDelay().toFixed(2))}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:i,config:r,minAutoLevel:a}=n,o=t?t.duration:e?e.duration:0,s=this.getBwEstimate(),l=this.getStarvationDelay();let c=r.abrBandWidthFactor,u=r.abrBandWidthUpFactor;if(l){const e=this.findBestLevel(s,a,i,l,0,c,u);if(e>=0)return this.rebufferNotice=-1,e}let d=o?Math.min(o,r.maxStarvationDelay):r.maxStarvationDelay;if(!l){const e=this.bitrateTestDelay;e&&(d=(o?Math.min(o,r.maxLoadingDelay):r.maxLoadingDelay)-e,this.info("bitrate test took ".concat(Math.round(1e3*e),"ms, set first fragment max fetchDuration to ").concat(Math.round(1e3*d)," ms")),c=u=1)}const h=this.findBestLevel(s,a,i,l,d,c,u);if(this.rebufferNotice!==h&&(this.rebufferNotice=h,this.info("".concat(l?"rebuffering expected":"buffer is empty",", optimal quality level ").concat(h))),h>-1)return h;const f=n.levels[a],p=n.loadLevelObj;return p&&(null==f?void 0:f.bitrate)<p.bitrate?a:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,i,r,a,o){var s;const l=i+r,c=this.lastLoadedFragLevel,u=-1===c?this.hls.firstLevel:c,{fragCurrent:d,partCurrent:h}=this,{levels:f,allAudioTracks:p,loadLevel:g,config:m}=this.hls;if(1===f.length)return 0;const v=f[u],y=!(null==(s=this.hls.latestLevelDetails)||!s.live),_=-1===g||-1===c;let E,b="SDR",T=(null==v?void 0:v.frameRate)||0;const{audioPreference:S,videoPreference:w}=m,A=this.audioTracksByGroup||(this.audioTracksByGroup=Zd(p));let R=-1;if(_){if(-1!==this.firstSelection)return this.firstSelection;const i=this.codecTiers||(this.codecTiers=function(e,t,n,i){return e.slice(n,i+1).reduce((e,n,i)=>{if(!n.codecSet)return e;const r=n.audioGroups;let a=e[n.codecSet];a||(e[n.codecSet]=a={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:i,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!r,fragmentError:0}),a.minBitrate=Math.min(a.minBitrate,n.bitrate);const o=Math.min(n.height,n.width);return a.minHeight=Math.min(a.minHeight,o),a.minFramerate=Math.min(a.minFramerate,n.frameRate),a.minIndex=Math.min(a.minIndex,i),a.maxScore=Math.max(a.maxScore,n.score),a.fragmentError+=n.fragmentError,a.videoRanges[n.videoRange]=(a.videoRanges[n.videoRange]||0)+1,r&&r.forEach(e=>{if(!e)return;const n=t.groups[e];n&&(a.hasDefaultAudio=a.hasDefaultAudio||t.hasDefaultAudio?n.hasDefault:n.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(n.channels).forEach(e=>{a.channels[e]=(a.channels[e]||0)+n.channels[e]}))}),e},{})}(f,A,t,n)),r=function(e,t,n,i,r){const a=Object.keys(e),o=null==i?void 0:i.channels,s=null==i?void 0:i.audioCodec,l=null==r?void 0:r.videoCodec,c=o&&2===parseInt(o);let u=!1,d=!1,h=1/0,f=1/0,p=1/0,g=1/0,m=0,v=[];const{preferHDR:y,allowedVideoRanges:_}=Hd(t,r);for(let t=a.length;t--;){const n=e[a[t]];u||(u=n.channels[2]>0),h=Math.min(h,n.minHeight),f=Math.min(f,n.minFramerate),p=Math.min(p,n.minBitrate),_.filter(e=>n.videoRanges[e]>0).length>0&&(d=!0)}h=eu(h)?h:0,f=eu(f)?f:0;const E=Math.max(1080,h),b=Math.max(30,f);p=eu(p)?p:n,n=Math.max(p,n),d||(t=void 0);const T=a.length>1;return{codecSet:a.reduce((t,i)=>{const r=e[i];if(i===t)return t;if(v=d?_.filter(e=>r.videoRanges[e]>0):[],T){if(r.minBitrate>n)return zd(i,"min bitrate of ".concat(r.minBitrate," > current estimate of ").concat(n)),t;if(!r.hasDefaultAudio)return zd(i,"no renditions with default or auto-select sound found"),t;if(s&&i.indexOf(s.substring(0,4))%5!=0)return zd(i,'audio codec preference "'.concat(s,'" not found')),t;if(o&&!c){if(!r.channels[o])return zd(i,"no renditions with ".concat(o," channel sound found (channels options: ").concat(Object.keys(r.channels),")")),t}else if((!s||c)&&u&&0===r.channels[2])return zd(i,"no renditions with stereo sound found"),t;if(r.minHeight>E)return zd(i,"min resolution of ".concat(r.minHeight," > maximum of ").concat(E)),t;if(r.minFramerate>b)return zd(i,"min framerate of ".concat(r.minFramerate," > maximum of ").concat(b)),t;if(!v.some(e=>r.videoRanges[e]>0))return zd(i,"no variants with VIDEO-RANGE of ".concat(jd(v)," found")),t;if(l&&i.indexOf(l.substring(0,4))%5!=0)return zd(i,'video codec preference "'.concat(l,'" not found')),t;if(r.maxScore<m)return zd(i,"max score of ".concat(r.maxScore," < selected max of ").concat(m)),t}return t&&(_d(i)>=_d(t)||r.fragmentError>e[t].fragmentError)?t:(g=r.minIndex,m=r.maxScore,i)},void 0),videoRanges:v,preferHDR:y,minFramerate:f,minBitrate:p,minIndex:g}}(i,b,e,S,w),{codecSet:a,videoRanges:o,minFramerate:s,minBitrate:l,minIndex:c,preferHDR:u}=r;R=c,E=a,b=u?o[o.length-1]:o[0],T=s,e=Math.max(e,l),this.log("picked start tier ".concat(jd(r)))}else E=null==v?void 0:v.codecSet,b=null==v?void 0:v.videoRange;const x=h?h.duration:d?d.duration:0,I=this.bwEstimator.getEstimateTTFB()/1e3,L=[];for(let s=n;s>=t;s--){var M;const t=f[s],d=s>u;if(!t)continue;if(m.useMediaCapabilities&&!t.supportedResult&&!t.supportedPromise){const n=navigator.mediaCapabilities;"function"==typeof(null==n?void 0:n.decodingInfo)&&Cd(t,A,b,T,e,S)?(t.supportedPromise=Pd(t,A,n,this.supportedCache),t.supportedPromise.then(e=>{if(!this.hls)return;t.supportedResult=e;const n=this.hls.levels,i=n.indexOf(t);e.error?this.warn('MediaCapabilities decodingInfo error: "'.concat(e.error,'" for level ').concat(i," ").concat(jd(e))):e.supported?e.decodingInfoResults.some(e=>!1===e.smooth||!1===e.powerEfficient)&&this.log("MediaCapabilities decodingInfo for level ".concat(i," not smooth or powerEfficient: ").concat(jd(e))):(this.warn("Unsupported MediaCapabilities decodingInfo result for level ".concat(i," ").concat(jd(e))),i>-1&&n.length>1&&(this.log("Removing unsupported level ".concat(i)),this.hls.removeLevel(i),-1===this.hls.loadLevel&&(this.hls.nextLoadLevel=0)))}).catch(e=>{this.warn("Error handling MediaCapabilities decodingInfo: ".concat(e))})):t.supportedResult=Ld}if((E&&t.codecSet!==E||b&&t.videoRange!==b||d&&T>t.frameRate||!d&&T>0&&T<t.frameRate||null!=(M=t.supportedResult)&&null!=(M=M.decodingInfoResults)&&M.some(e=>!1===e.smooth))&&(!_||s!==R)){L.push(s);continue}const p=t.details,v=(h?null==p?void 0:p.partTarget:null==p?void 0:p.averagetargetduration)||x;let w;w=d?o*e:a*e;const C=x&&i>=2*x&&0===r?t.averageBitrate:t.maxBitrate,P=this.getTimeToLoadFrag(I,w,C*v,void 0===p);if(w>=C&&(s===c||0===t.loadError&&0===t.fragmentError)&&(P<=I||!eu(P)||y&&!this.bitrateTestDelay||P<l)){const e=this.forcedAutoLevel;return s!==g&&(-1===e||e!==g)&&(L.length&&this.trace("Skipped level(s) ".concat(L.join(",")," of ").concat(n,' max with CODECS and VIDEO-RANGE:"').concat(f[L[0]].codecs,'" ').concat(f[L[0]].videoRange,'; not compatible with "').concat(E,'" ').concat(b)),this.info("switch candidate:".concat(u,"->").concat(s," adjustedbw(").concat(Math.round(w),")-bitrate=").concat(Math.round(w-C)," ttfb:").concat(I.toFixed(1)," avgDuration:").concat(v.toFixed(1)," maxFetchDuration:").concat(l.toFixed(1)," fetchDuration:").concat(P.toFixed(1)," firstSelection:").concat(_," codecSet:").concat(t.codecSet," videoRange:").concat(t.videoRange," hls.loadLevel:").concat(g))),_&&(this.firstSelection=s),s}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}}const $d=function(e,t){let n=0,i=e.length-1,r=null,a=null;for(;n<=i;){r=(n+i)/2|0,a=e[r];const o=t(a);if(o>0)n=r+1;else{if(!(o<0))return a;i=r-1}}return null};function eh(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.005,a=null;if(e){a=t[1+e.sn-t[0].sn]||null;const i=e.endDTS-n;i>0&&i<15e-7&&(n+=15e-7),a&&e.level!==a.level&&a.end<=e.end&&(a=t[2+e.sn-t[0].sn]||null)}else 0===n&&0===t[0].start&&(a=t[0]);if(a&&((!e||e.level===a.level)&&0===th(n,i,a)||function(e,t,n){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){const i=t.tagList.reduce((e,t)=>("INF"===t[0]&&(e+=parseFloat(t[1])),e),n);return e.start<=i}return!1}(a,e,Math.min(r,i))))return a;const o=$d(t,th.bind(null,n,i));return!o||o===e&&a?a:o}function th(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(n.start<=e&&n.start+n.duration>e)return 0;const i=Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-i<=e?1:n.start-i>e&&n.start?-1:0}function nh(e,t,n){const i=1e3*Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-i>e}function ih(e,t,n){if(e&&e.startCC<=t&&e.endCC>=t){let i=e.fragments;const{fragmentHint:r}=e;let a;return r&&(i=i.concat(r)),$d(i,e=>e.cc<t?1:e.cc>t?-1:(a=e,e.end<=n?1:e.start>n?-1:0)),a||null}return null}function rh(e){switch(e.details){case ru.FRAG_LOAD_TIMEOUT:case ru.KEY_LOAD_TIMEOUT:case ru.LEVEL_LOAD_TIMEOUT:case ru.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function ah(e){return e.details.startsWith("key")}function oh(e){return ah(e)&&!!e.frag&&!e.frag.decryptdata}function sh(e,t){const n=rh(t);return e.default["".concat(n?"timeout":"error","Retry")]}function lh(e,t){const n="linear"===e.backoff?1:Math.pow(2,t);return Math.min(n*e.retryDelayMs,e.maxRetryDelayMs)}function ch(e){return mu(mu({},e),{errorRetry:null,timeoutRetry:null})}function uh(e,t,n,i){if(!e)return!1;const r=null==i?void 0:i.code,a=t<e.maxNumRetry&&(function(e){return dh(e)||!!e&&(e<400||e>499)}(r)||!!n);return e.shouldRetry?e.shouldRetry(e,t,n,i,a):a}function dh(e){return 0===e&&!1===navigator.onLine}var hh={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},fh={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class ph extends vu{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(au.ERROR,this.onError,this),e.on(au.MANIFEST_LOADING,this.onManifestLoading,this),e.on(au.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(au.ERROR,this.onError,this),e.off(au.ERROR,this.onErrorOut,this),e.off(au.MANIFEST_LOADING,this.onManifestLoading,this),e.off(au.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(null==e?void 0:e.type)===uu.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,n=t.currentLevel;return null!=(e=t.loadLevelObj)&&e.details||-1===n?t.loadLevel:n}variantHasKey(e,t){if(e){var n;if(null!=(n=e.details)&&n.hasKey(t))return!0;const i=e.audioGroups;if(i)return this.hls.allAudioTracks.filter(e=>i.indexOf(e.groupId)>=0).some(e=>{var n;return null==(n=e.details)?void 0:n.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const i=this.hls,r=t.context;switch(t.details){case ru.FRAG_LOAD_ERROR:case ru.FRAG_LOAD_TIMEOUT:case ru.KEY_LOAD_ERROR:case ru.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case ru.FRAG_PARSING_ERROR:if(null!=(n=t.frag)&&n.gap)return void(t.errorAction=gh());case ru.FRAG_GAP:case ru.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=hh.SendAlternateToPenaltyBox);case ru.LEVEL_EMPTY_ERROR:case ru.LEVEL_PARSING_ERROR:{var a;const e=t.parent===uu.MAIN?t.level:i.loadLevel;t.details===ru.LEVEL_EMPTY_ERROR&&null!=(a=t.context)&&null!=(a=a.levelDetails)&&a.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case ru.LEVEL_LOAD_ERROR:case ru.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==r?void 0:r.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level)));case ru.AUDIO_TRACK_LOAD_ERROR:case ru.AUDIO_TRACK_LOAD_TIMEOUT:case ru.SUBTITLE_LOAD_ERROR:case ru.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const e=i.loadLevelObj;if(e&&(r.type===lu&&e.hasAudioGroup(r.groupId)||r.type===cu&&e.hasSubtitleGroup(r.groupId)))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=hh.SendAlternateToPenaltyBox,void(t.errorAction.flags=fh.MoveAllAlternatesMatchingHost)}return;case ru.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:return void(t.errorAction={action:hh.SendAlternateToPenaltyBox,flags:fh.MoveAllAlternatesMatchingHDCP});case ru.KEY_SYSTEM_SESSION_UPDATE_FAILED:case ru.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case ru.KEY_SYSTEM_NO_SESSION:return void(t.errorAction={action:hh.SendAlternateToPenaltyBox,flags:fh.MoveAllAlternatesMatchingKey});case ru.BUFFER_ADD_CODEC_ERROR:case ru.REMUX_ALLOC_ERROR:case ru.BUFFER_APPEND_ERROR:var o;if(!t.errorAction)t.errorAction=this.getLevelSwitchAction(t,null!=(o=t.level)?o:i.loadLevel);return;case ru.INTERNAL_EXCEPTION:case ru.BUFFER_APPENDING_ERROR:case ru.BUFFER_FULL_ERROR:case ru.LEVEL_SWITCH_ERROR:case ru.BUFFER_STALLED_ERROR:case ru.BUFFER_SEEK_OVER_HOLE:case ru.BUFFER_NUDGE_ON_STALL:return void(t.errorAction=gh())}t.type===iu.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=gh())}getPlaylistRetryOrSwitchAction(e,t){const n=sh(this.hls.config.playlistLoadPolicy,e),i=this.playlistError++;if(uh(n,i,rh(e),e.response))return{action:hh.RetryRequest,flags:fh.None,retryConfig:n,retryCount:i};const r=this.getLevelSwitchAction(e,t);return n&&(r.retryConfig=n,r.retryCount=i),r}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),i=t.levels[n],{fragLoadPolicy:r,keyLoadPolicy:a}=t.config,o=sh(ah(e)?a:r,e),s=t.levels.reduce((e,t)=>e+t.fragmentError,0);if(i&&(e.details!==ru.FRAG_GAP&&i.fragmentError++,!oh(e)&&uh(o,s,rh(e),e.response)))return{action:hh.RetryRequest,flags:fh.None,retryConfig:o,retryCount:s};const l=this.getLevelSwitchAction(e,n);return o&&(l.retryConfig=o,l.retryCount=s),l}getLevelSwitchAction(e,t){const n=this.hls;null==t&&(t=n.loadLevel);const i=this.hls.levels[t];if(i){var r,a;const t=e.details;i.loadError++,t===ru.BUFFER_APPEND_ERROR&&i.fragmentError++;let l=-1;const{levels:c,loadLevel:u,minAutoLevel:d,maxAutoLevel:h}=n;!n.autoLevelEnabled&&!n.config.preserveManualLevelOnError&&(n.loadLevel=-1);const f=null==(r=e.frag)?void 0:r.type,p=(f===uu.AUDIO&&t===ru.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(t===ru.BUFFER_ADD_CODEC_ERROR||t===ru.BUFFER_APPEND_ERROR))&&c.some(e=>{let{audioCodec:t}=e;return i.audioCodec!==t}),g="video"===e.sourceBufferName&&(t===ru.BUFFER_ADD_CODEC_ERROR||t===ru.BUFFER_APPEND_ERROR)&&c.some(e=>{let{codecSet:t,audioCodec:n}=e;return i.codecSet!==t&&i.audioCodec===n}),{type:m,groupId:v}=null!=(a=e.context)?a:{};for(let n=c.length;n--;){const r=(n+u)%c.length;if(r!==u&&r>=d&&r<=h&&0===c[r].loadError){var o,s;const n=c[r];if(t===ru.FRAG_GAP&&f===uu.MAIN&&e.frag){const t=c[r].details;if(t){const n=eh(e.frag,t.fragments,e.frag.start);if(null!=n&&n.gap)continue}}else{if(m===lu&&n.hasAudioGroup(v)||m===cu&&n.hasSubtitleGroup(v))continue;if(f===uu.AUDIO&&null!=(o=i.audioGroups)&&o.some(e=>n.hasAudioGroup(e))||f===uu.SUBTITLE&&null!=(s=i.subtitleGroups)&&s.some(e=>n.hasSubtitleGroup(e))||p&&i.audioCodec===n.audioCodec||g&&i.codecSet===n.codecSet||!p&&i.codecSet!==n.codecSet)continue}l=r;break}}if(l>-1&&n.loadLevel!==l)return e.levelRetry=!0,this.playlistError=0,{action:hh.SendAlternateToPenaltyBox,flags:fh.None,nextAutoLevel:l}}return{action:hh.SendAlternateToPenaltyBox,flags:fh.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch(null==(n=t.errorAction)?void 0:n.action){case hh.DoNothing:break;case hh.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===ru.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn('MediaSource ended after "'.concat(t.sourceBufferName,'" sourceBuffer append error. Attempting to recover from media error.')),this.hls.recoverMediaError()):t.fatal=!0}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:i}=n,r=n.nextAutoLevel;switch(i){case fh.None:this.switchLevel(e,r);break;case fh.MoveAllAlternatesMatchingHDCP:{const i=this.getVariantLevelIndex(e.frag),r=t.levels[i],a=null==r?void 0:r.attrs["HDCP-LEVEL"];if(n.hdcpLevel=a,"NONE"===a)this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(a){t.maxHdcpLevel=Nd[Nd.indexOf(a)-1],n.resolved=!0,this.warn('Restricting playback to HDCP-LEVEL of "'.concat(t.maxHdcpLevel,'" or lower'));break}}case fh.MoveAllAlternatesMatchingKey:{const t=e.decryptdata;if(t){const i=this.hls.levels,r=i.length;for(let n=r;n--;)if(this.variantHasKey(i[n],t)){var a,o;this.log("Banned key found in level ".concat(n," (").concat(i[n].bitrate,'bps) or audio group "').concat(null==(a=i[n].audioGroups)?void 0:a.join(","),'" (').concat(null==(o=e.frag)?void 0:o.type," fragment) ").concat(xu(t.keyId||[]))),i[n].fragmentError++,i[n].loadError++,this.log("Removing level ".concat(n," with key error (").concat(e.error,")")),this.hls.removeLevel(n)}const s=e.frag;if(this.hls.levels.length<r)n.resolved=!0;else if(s&&s.type!==uu.MAIN){const e=s.decryptdata;e&&!t.matches(e)&&(n.resolved=!0)}}break}}n.resolved||this.switchLevel(e,r)}switchLevel(e,t){if(void 0!==t&&e.errorAction&&(this.warn("switching to level ".concat(t," after ").concat(e.details)),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===ru.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&"audiovideo"!==e.sourceBufferName)){const t=xd(e.mimeType),n=this.hls.levels;for(let i=n.length;i--;)n[i]["".concat(e.sourceBufferName,"Codec")]===t&&(this.log("Removing level ".concat(i," for ").concat(e.details,' ("').concat(t,'" not supported)')),this.hls.removeLevel(i))}}}function gh(e){const t={action:hh.DoNothing,flags:fh.None};return e&&(t.resolved=!0),t}var mh="NOT_LOADED",vh="APPENDING",yh="PARTIAL",_h="OK";class Eh{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(au.MANIFEST_LOADING,this.onManifestLoading,this),e.on(au.BUFFER_APPENDED,this.onBufferAppended,this),e.on(au.FRAG_BUFFERED,this.onFragBuffered,this),e.on(au.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(au.MANIFEST_LOADING,this.onManifestLoading,this),e.off(au.BUFFER_APPENDED,this.onBufferAppended,this),e.off(au.FRAG_BUFFERED,this.onFragBuffered,this),e.off(au.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let t=n.length;t--;){const i=n[t];if(!i)break;if(i.start<=e&&e<=i.end&&i.loaded)return i}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:i}=this,r=Object.keys(i);for(let a=r.length;a--;){const o=i[r[a]];if((null==o?void 0:o.body.type)===t&&(!n||o.buffered)){const t=o.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,n,i,r){this.timeRanges&&(this.timeRanges[e]=t);const a=(null==i?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(i=>{const o=this.fragments[i];if(!o||a>=o.body.sn)return;if(!o.buffered&&(!o.loaded||r))return void(o.body.type===n&&this.removeFragment(o.body));const s=o.range[e];if(s){if(0===s.time.length)return void this.removeFragment(o.body);s.time.some(e=>{const n=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return n&&this.removeFragment(o.body),n})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||"initSegment"===e.frag.sn)return;const n=e.frag,i=Th(n),r=this.fragments[i];if(!r||r.buffered&&n.gap)return;const a=!n.relurl;Object.keys(t).forEach(i=>{const o=n.elementaryStreams[i];if(!o)return;const s=t[i],l=a||!0===o.partial;r.range[i]=this.getBufferedTimes(n,e.part,l,s)}),r.loaded=null,Object.keys(r.range).length?(r.buffered=!0,(r.body.endList=n.endList||r.body.endList)&&(this.endListFragments[r.body.type]=r),bh(r)||this.removeParts(n.sn-1,n.type)):this.removeFragment(r.body)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=Sh(n,t=>t.fragment.sn>=e))}fragBuffered(e,t){const n=Th(e);let i=this.fragments[n];!i&&t&&(i=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,n,i){const r={time:[],partial:n},a=e.start,o=e.end,s=e.minEndPTS||o,l=e.maxStartPTS||a;for(let e=0;e<i.length;e++){const t=i.start(e)-this.bufferPadding,n=i.end(e)+this.bufferPadding;if(l>=t&&s<=n){r.time.push({startPTS:Math.max(a,i.start(e)),endPTS:Math.min(o,i.end(e))});break}if(a<n&&o>t){const t=Math.max(a,i.start(e)),n=Math.min(o,i.end(e));n>t&&(r.partial=!0,r.time.push({startPTS:t,endPTS:n}))}else if(o<=t)break}return r}getPartialFragment(e){let t,n,i,r=null,a=0;const{bufferPadding:o,fragments:s}=this;return Object.keys(s).forEach(l=>{const c=s[l];c&&bh(c)&&(n=c.body.start-o,i=c.body.end+o,e>=n&&e<=i&&(t=Math.min(e-n,i-e),a<=t&&(r=c.body,a=t)))}),r}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||bh(t))}getState(e){const t=Th(e),n=this.fragments[t];return n?n.buffered?bh(n)?yh:_h:vh:mh}isTimeBuffered(e,t,n){let i,r;for(let a=0;a<n.length;a++){if(i=n.start(a)-this.bufferPadding,r=n.end(a)+this.bufferPadding,e>=i&&t<=r)return!0;if(t<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if("initSegment"===t.frag.sn||t.frag.bitrateTest)return;const n=t.frag,i=t.part?null:t,r=Th(n);this.fragments[r]={body:n,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:i,timeRanges:r,type:a}=t;if("initSegment"===n.sn)return;const o=n.type;if(i){let e=this.activePartLists[o];e||(this.activePartLists[o]=e=[]),e.push(i)}this.timeRanges=r;const s=r[a];this.detectEvictedFragments(a,s,o,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Th(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let i=n.length;i--;){const r=t[n[i]];if((null==r?void 0:r.body.type)===e)return!0}return!1}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,n,i,r){i&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o)return;const s=o.body;s.type!==n||i&&!s.gap||s.start<t&&s.end>e&&(o.buffered||r)&&this.removeFragment(s)})}removeFragment(e){const t=Th(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const t=e.sn;this.activePartLists[e.type]=Sh(n,e=>e.fragment.sn!==t)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=null==(e=this.hls)||null==(e=e.latestLevelDetails)?void 0:e.partList;t&&t.forEach(e=>e.clearElementaryStreamInfo())}}function bh(e){var t,n,i;return e.buffered&&!!(e.body.gap||null!=(t=e.range.video)&&t.partial||null!=(n=e.range.audio)&&n.partial||null!=(i=e.range.audiovideo)&&i.partial)}function Th(e){return"".concat(e.type,"_").concat(e.level,"_").concat(e.sn)}function Sh(e,t){return e.filter(e=>{const n=t(e);return n||e.clearElementaryStreamInfo(),n})}var wh=0,Ah=1;class Rh{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case wh:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Ah:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error("[AESCrypto] invalid aes mode ".concat(this.aesMode))}}}class xh{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let e=0;e<4;e++)n[e]=t.getUint32(4*e);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,i=n[0],r=n[1],a=n[2],o=n[3],s=this.invSubMix,l=s[0],c=s[1],u=s[2],d=s[3],h=new Uint32Array(256);let f=0,p=0,g=0;for(g=0;g<256;g++)h[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){let n=p^p<<1^p<<2^p<<3^p<<4;n=n>>>8^255&n^99,e[f]=n,t[n]=f;const s=h[f],g=h[s],m=h[g];let v=257*h[n]^16843008*n;i[f]=v<<24|v>>>8,r[f]=v<<16|v>>>16,a[f]=v<<8|v>>>24,o[f]=v,v=16843009*m^65537*g^257*s^16843008*f,l[n]=v<<24|v>>>8,c[n]=v<<16|v>>>16,u[n]=v<<8|v>>>24,d[n]=v,f?(f=s^h[h[h[m^s]]],p^=h[h[p]]):f=p=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,i=0;for(;i<t.length&&n;)n=t[i]===this.key[i],i++;if(n)return;this.key=t;const r=this.keySize=t.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);const a=this.ksRows=4*(r+6+1);let o,s;const l=this.keySchedule=new Uint32Array(a),c=this.invKeySchedule=new Uint32Array(a),u=this.sBox,d=this.rcon,h=this.invSubMix,f=h[0],p=h[1],g=h[2],m=h[3];let v,y;for(o=0;o<a;o++)o<r?v=l[o]=t[o]:(y=v,o%r===0?(y=y<<8|y>>>24,y=u[y>>>24]<<24|u[y>>>16&255]<<16|u[y>>>8&255]<<8|u[255&y],y^=d[o/r|0]<<24):r>6&&o%r===4&&(y=u[y>>>24]<<24|u[y>>>16&255]<<16|u[y>>>8&255]<<8|u[255&y]),l[o]=v=(l[o-r]^y)>>>0);for(s=0;s<a;s++)o=a-s,y=3&s?l[o]:l[o-4],c[s]=s<4||o<=4?y:f[u[y>>>24]]^p[u[y>>>16&255]]^g[u[y>>>8&255]]^m[u[255&y]],c[s]=c[s]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,n){const i=this.keySize+6,r=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,s=o[0],l=o[1],c=o[2],u=o[3],d=this.uint8ArrayToUint32Array_(n);let h=d[0],f=d[1],p=d[2],g=d[3];const m=new Int32Array(e),v=new Int32Array(m.length);let y,_,E,b,T,S,w,A,R,x,I,L,M,C;const P=this.networkToHostOrderSwap;for(;t<m.length;){for(R=P(m[t]),x=P(m[t+1]),I=P(m[t+2]),L=P(m[t+3]),T=R^r[0],S=L^r[1],w=I^r[2],A=x^r[3],M=4,C=1;C<i;C++)y=s[T>>>24]^l[S>>16&255]^c[w>>8&255]^u[255&A]^r[M],_=s[S>>>24]^l[w>>16&255]^c[A>>8&255]^u[255&T]^r[M+1],E=s[w>>>24]^l[A>>16&255]^c[T>>8&255]^u[255&S]^r[M+2],b=s[A>>>24]^l[T>>16&255]^c[S>>8&255]^u[255&w]^r[M+3],T=y,S=_,w=E,A=b,M+=4;y=a[T>>>24]<<24^a[S>>16&255]<<16^a[w>>8&255]<<8^a[255&A]^r[M],_=a[S>>>24]<<24^a[w>>16&255]<<16^a[A>>8&255]<<8^a[255&T]^r[M+1],E=a[w>>>24]<<24^a[A>>16&255]<<16^a[T>>8&255]<<8^a[255&S]^r[M+2],b=a[A>>>24]<<24^a[T>>16&255]<<16^a[S>>8&255]<<8^a[255&w]^r[M+3],v[t]=P(y^h),v[t+1]=P(b^f),v[t+2]=P(E^p),v[t+3]=P(_^g),h=R,f=x,p=I,g=L,t+=4}return v.buffer}}class Ih{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=function(e){switch(e){case wh:return"AES-CBC";case Ah:return"AES-CTR";default:throw new Error("[FastAESKey] invalid aes mode ".concat(e))}}(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}class Lh{constructor(e){let{removePKCS7Padding:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(e){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function(e){const t=e.byteLength,n=t&&new DataView(e.buffer).getUint8(t-1);return n?e.slice(0,t-n):e}(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,i){return this.useSoftware?new Promise((r,a)=>{const o=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(o,t,n,i);const s=this.flush();s?r(s.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,i)}softwareDecrypt(e,t,n,i){const{currentIV:r,currentResult:a,remainderData:o}=this;if(i!==wh||16!==t.byteLength)return Su.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),o&&(e=rd(o,e),this.remainderData=null);const s=this.getValidChunk(e);if(!s.length)return null;r&&(n=r);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new xh),l.expandKey(t);const c=a;return this.currentResult=l.decrypt(s.buffer,0,n),this.currentIV=s.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,n,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,i));this.key=t,this.fastAesKey=new Ih(this.subtle,t,i)}return this.fastAesKey.expandKey().then(t=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new Rh(this.subtle,new Uint8Array(n),i).decrypt(e.buffer,t)):Promise.reject(new Error("web crypto not initialized"))).catch(r=>(Su.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, ".concat(r.name,": ").concat(r.message)),this.onWebCryptoError(e,t,n,i)))}onWebCryptoError(e,t,n,i){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,i);const r=this.flush();if(r)return r.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%16;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(Su.log("[decrypter]: ".concat(e)),this.logEnabled=!1)}}const Mh=Math.pow(2,17);class Ch{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new Oh({type:iu.NETWORK_ERROR,details:ru.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a ".concat(n?"part list":"url")),networkDetails:null}));this.abort();const i=this.config,r=i.fLoader,a=i.loader;return new Promise((o,s)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some(e=>"GAP"===e[0]))return void s(Dh(e));e.gap=!1}const l=this.loader=r?new r(i):new a(i),c=Ph(e);e.loader=l;const u=ch(i.fragLoadPolicy.default),d={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:Mh};e.stats=l.stats;const h={onSuccess:(t,n,i,r)=>{this.resetLoader(e,l);let a=t.data;i.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(a.slice(0,16)),a=a.slice(16)),o({frag:e,part:null,payload:a,networkDetails:r})},onError:(t,i,r,a)=>{this.resetLoader(e,l),s(new Oh({type:iu.NETWORK_ERROR,details:ru.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:mu({url:n,data:void 0},t),error:new Error("HTTP Error ".concat(t.code," ").concat(t.text)),networkDetails:r,stats:a}))},onAbort:(t,n,i)=>{this.resetLoader(e,l),s(new Oh({type:iu.NETWORK_ERROR,details:ru.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:i,stats:t}))},onTimeout:(t,n,i)=>{this.resetLoader(e,l),s(new Oh({type:iu.NETWORK_ERROR,details:ru.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error("Timeout after ".concat(d.timeout,"ms")),networkDetails:i,stats:t}))}};t&&(h.onProgress=(n,i,r,a)=>t({frag:e,part:null,payload:r,networkDetails:a})),l.load(c,d,h)})}loadPart(e,t,n){this.abort();const i=this.config,r=i.fLoader,a=i.loader;return new Promise((o,s)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void s(Dh(e,t));const l=this.loader=r?new r(i):new a(i),c=Ph(e,t);e.loader=l;const u=ch(i.fragLoadPolicy.default),d={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Mh};t.stats=l.stats,l.load(c,d,{onSuccess:(i,r,a,s)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const c={frag:e,part:t,payload:i.data,networkDetails:s};n(c),o(c)},onError:(n,i,r,a)=>{this.resetLoader(e,l),s(new Oh({type:iu.NETWORK_ERROR,details:ru.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:mu({url:c.url,data:void 0},n),error:new Error("HTTP Error ".concat(n.code," ").concat(n.text)),networkDetails:r,stats:a}))},onAbort:(n,i,r)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),s(new Oh({type:iu.NETWORK_ERROR,details:ru.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:r,stats:n}))},onTimeout:(n,i,r)=>{this.resetLoader(e,l),s(new Oh({type:iu.NETWORK_ERROR,details:ru.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error("Timeout after ".concat(d.timeout,"ms")),networkDetails:r,stats:n}))}})})}updateStatsFromPart(e,t){const n=e.stats,i=t.stats,r=i.total;if(n.loaded+=i.loaded,r){const i=Math.round(e.duration/t.duration),a=Math.min(Math.round(n.loaded/r),i),o=(i-a)*Math.round(n.loaded/a);n.total=n.loaded+o}else n.total=Math.max(n.loaded,n.total);const a=n.loading,o=i.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Ph(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=t||e,i={frag:e,part:t,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},r=n.byteRangeStartOffset,a=n.byteRangeEndOffset;if(eu(r)&&eu(a)){var o;let t=r,n=a;if("initSegment"===e.sn&&function(e){return"AES-128"===e||"AES-256"===e}(null==(o=e.decryptdata)?void 0:o.method)){const e=a-r;e%16&&(n=a+(16-e%16)),0!==r&&(i.resetIV=!0,t=r-16)}i.rangeStart=t,i.rangeEnd=n}return i}function Dh(e,t){const n=new Error("GAP ".concat(e.gap?"tag":"attribute"," found")),i={type:iu.MEDIA_ERROR,details:ru.FRAG_GAP,fatal:!1,frag:e,error:n,networkDetails:null};return t&&(i.part=t),(t||e).stats.aborted=!0,new Oh(i)}class Oh extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Nh extends vu{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class kh{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=n,this.size=i,this.part=r,this.partial=a}}const Fh={length:0,start:()=>0,end:()=>0};class Bh{static isBuffered(e,t){if(e){const n=Bh.getBuffered(e);for(let e=n.length;e--;)if(t>=n.start(e)&&t<=n.end(e))return!0}return!1}static bufferedRanges(e){if(e){const t=Bh.getBuffered(e);return Bh.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const i=Bh.bufferedRanges(e);if(i.length)return Bh.bufferedInfo(i,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((e,t)=>e.start-t.start||t.end-e.end);let i=-1,r=[];if(n)for(let a=0;a<e.length;a++){t>=e[a].start&&t<=e[a].end&&(i=a);const o=r.length;if(o){const t=r[o-1].end;e[a].start-t<n?e[a].end>t&&(r[o-1].end=e[a].end):r.push(e[a])}else r.push(e[a])}else r=e;let a,o=0,s=t,l=t;for(let e=0;e<r.length;e++){const c=r[e].start,u=r[e].end;if(-1===i&&t>=c&&t<=u&&(i=e),t+n>=c&&t<u)s=c,l=u,o=l-t;else if(t+n<c){a=c;break}}return{len:o,start:s||0,end:l||0,nextStart:a,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||Fh}catch(e){return Su.log("failed to get media.buffered",e),Fh}}}const Uh=/\{\$([a-zA-Z0-9-_]+)\}/g;function Vh(e){return Uh.test(e)}function Gh(e,t){if(null!==e.variableList||e.hasVariableRefs){const n=e.variableList;return t.replace(Uh,t=>{const i=t.substring(2,t.length-1),r=null==n?void 0:n[i];return void 0===r?(e.playlistParsingError||(e.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'.concat(i,'"'))),t):r})}return t}function Hh(e,t,n){let i,r,a=e.variableList;if(a||(e.variableList=a={}),"QUERYPARAM"in t){i=t.QUERYPARAM;try{const e=new self.URL(n).searchParams;if(!e.has(i))throw new Error('"'.concat(i,'" does not match any query parameter in URI: "').concat(n,'"'));r=e.get(i)}catch(t){e.playlistParsingError||(e.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: ".concat(t.message)))}}else i=t.NAME,r=t.VALUE;i in a?e.playlistParsingError||(e.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'.concat(i,'"'))):a[i]=r||""}function jh(e,t,n){const i=t.IMPORT;if(n&&i in n){let t=e.variableList;t||(e.variableList=t={}),t[i]=n[i]}else e.playlistParsingError||(e.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'.concat(i,'"')))}const zh=/^(\d+)x(\d+)$/,Zh=/(.+?)=(".*?"|.*?)(?:,|$)/g;class qh{constructor(e,t){"string"==typeof e&&(e=qh.parseAttrList(e,t)),pu(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>"X-"===e.substring(0,2))}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const n=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)n[e]=parseInt(t.slice(2*e,2*e+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((e,t)=>(e[t.toLowerCase()]=!0,e),t)}bool(e){return"YES"===this[e]}decimalResolution(e){const t=zh.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const i={};for(Zh.lastIndex=0;null!==(n=Zh.exec(e));){const r=n[1].trim();let a=n[2];const o=0===a.indexOf('"')&&a.lastIndexOf('"')===a.length-1;let s=!1;if(o)a=a.slice(1,-1);else switch(r){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":s=!0}if(t&&(o||s))a=Gh(t,a);else if(!s&&!o)switch(r){case"CLOSED-CAPTIONS":if("NONE"===a)break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Su.warn("".concat(e,": attribute ").concat(r," is missing quotes"))}i[r]=a}return i}}function Wh(e){return"ID"!==e&&"CLASS"!==e&&"CUE"!==e&&"START-DATE"!==e&&"DURATION"!==e&&"END-DATE"!==e&&"END-ON-NEXT"!==e}function Yh(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e||"SCTE35-CMD"===e}class Kh{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(null==t?void 0:t.tagAnchor)||null,this.tagOrder=null!=(i=null==t?void 0:t.tagOrder)?i:n,t){const n=t.attr;for(const t in n)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==n[t]){Su.warn('DATERANGE tag attribute: "'.concat(t,'" does not match for tags with ID: "').concat(e.ID,'"')),this._badValueForSameId=t;break}e=pu(new qh({}),n,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=(null==t?void 0:t.endDate)||new Date(this.attr["END-DATE"]);eu(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return void 0===e?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return null===e||null===e.programDateTime?(Su.warn('Expected tagAnchor Fragment with PDT set for DateRange "'.concat(this.id,'": ').concat(e)),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return null!==t?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*t):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(eu(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return"com.apple.hls.interstitial"===this.class}get isValid(){return!!this.id&&!this._badValueForSameId&&eu(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}class Xh{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return!!this.fragments.length&&eu(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?1e3*(this.driftEnd-this.driftStart)/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(-1!==t){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Qh(e,t){return e.length===t.length&&!e.some((e,n)=>e!==t[n])}function Jh(e,t){return!e&&!t||!(!e||!t)&&Qh(e,t)}function $h(e){return"AES-128"===e||"AES-256"===e||"AES-256-CTR"===e}function ef(e){switch(e){case"AES-128":case"AES-256":return wh;case"AES-256-CTR":return Ah;default:throw new Error("invalid full segment method ".concat(e))}}function tf(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}function nf(e){return Uint8Array.from(unescape(encodeURIComponent(e)),e=>e.charCodeAt(0))}function rf(e){const t=function(e,t,n){const i=e[t];e[t]=e[n],e[n]=i};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}function af(e){const t=e.split(":");let n=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),i=e[e.length-1].split(",");if(2===i.length){const t="base64"===i[0],r=i[1];t?(e.splice(-1,1),n=tf(r)):n=function(e){const t=nf(e).subarray(0,16),n=new Uint8Array(16);return n.set(t,16-t.length),n}(r)}}return n}const of=typeof self<"u"?self:void 0;var sf={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},lf={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function cf(e){switch(e){case lf.FAIRPLAY:return sf.FAIRPLAY;case lf.PLAYREADY:return sf.PLAYREADY;case lf.WIDEVINE:return sf.WIDEVINE;case lf.CLEARKEY:return sf.CLEARKEY}}function uf(e){switch(e){case sf.FAIRPLAY:return lf.FAIRPLAY;case sf.PLAYREADY:return lf.PLAYREADY;case sf.WIDEVINE:return lf.WIDEVINE;case sf.CLEARKEY:return lf.CLEARKEY}}function df(e){const{drmSystems:t,widevineLicenseUrl:n}=e,i=t?[sf.FAIRPLAY,sf.WIDEVINE,sf.PLAYREADY,sf.CLEARKEY].filter(e=>!!t[e]):[];return!i[sf.WIDEVINE]&&n&&i.push(sf.WIDEVINE),i}const hf=function(e){return null!=of&&null!=(e=of.navigator)&&e.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();let ff={};class pf{static clearKeyUriToKeyIdMap(){ff={}}static setKeyIdForUri(e,t){ff[e]=t}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5?arguments[5]:void 0;this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=i,this.iv=r,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&!$h(e),null!=a&&a.startsWith("0x")&&(this.keyId=new Uint8Array(Iu(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Qh(e.keyFormatVersions,this.keyFormatVersions)&&Jh(e.iv,this.iv)&&Jh(e.keyId,this.keyId)}isSupported(){if(this.method){if($h(this.method)||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case lf.FAIRPLAY:case lf.WIDEVINE:case lf.PLAYREADY:case lf.CLEARKEY:return-1!==["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if($h(this.method)){let t=this.iv;return t||("number"!=typeof e&&(Su.warn('missing IV for initialization segment with method="'.concat(this.method,'" - compliance issue')),e=0),t=function(e){const t=new Uint8Array(16);for(let n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t}(e)),new pf(this.method,this.uri,"identity",this.keyFormatVersions,t)}if(this.pssh&&this.keyId)return this;const t=af(this.uri);if(t)switch(this.keyFormat){case lf.WIDEVINE:if(this.pssh=t,!this.keyId){const e=function(e){const t=[];if(e instanceof ArrayBuffer){const n=e.byteLength;let i=0;for(;i+32<n;){const n=dd(new DataView(e,i));t.push(n),i+=n.size}}return t}(t.buffer);if(e.length){var n;const t=e[0];this.keyId=null!=(n=t.kids)&&n.length?t.kids[0]:null}}if(!this.keyId){const e=t.length-22;this.keyId=t.subarray(e,e+16)}break;case lf.PLAYREADY:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=ud(e,0,t),this.keyId=function(e){const t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),n=String.fromCharCode.apply(null,Array.from(t)),i=n.substring(n.indexOf("<"),n.length),r=(new DOMParser).parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(r){const e=r.childNodes[0]?r.childNodes[0].nodeValue:r.getAttribute("VALUE");if(e){const t=tf(e).subarray(0,16);return rf(t),t}}return null}(t);break}default:{let e=t.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e=ff[this.uri];if(!e){const t=Object.keys(ff).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16),new DataView(e.buffer,12,4).setUint32(0,t),pf.setKeyIdForUri(this.uri,e)}this.keyId=e}return this}}const gf=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,mf=/#EXT-X-MEDIA:(.*)/g,vf=/^#EXT(?:INF|-X-TARGETDURATION):/m,yf=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),_f=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Ef{static findGroup(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.id===t)return i}}static resolve(e,t){return Cu.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return vf.test(e)}static parseMasterPlaylist(e,t){const n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:Vh(e)},i=[];if(gf.lastIndex=0,!e.startsWith("#EXTM3U"))return n.playlistParsingError=new Error("no EXTM3U delimiter"),n;let r;for(;null!=(r=gf.exec(e));)if(r[1]){var a;const e=new qh(r[1],n),o=Gh(n,r[2]),s={attrs:e,bitrate:e.decimalInteger("BANDWIDTH")||e.decimalInteger("AVERAGE-BANDWIDTH"),name:e.NAME,url:Ef.resolve(o,t)},l=e.decimalResolution("RESOLUTION");l&&(s.width=l.width,s.height=l.height),Af(e.CODECS,s);const c=e["SUPPLEMENTAL-CODECS"];c&&(s.supplemental={},Af(c,s.supplemental)),null!=(a=s.unknownCodecs)&&a.length||i.push(s),n.levels.push(s)}else if(r[3]){const e=r[3],i=r[4];switch(e){case"SESSION-DATA":{const e=new qh(i,n),t=e["DATA-ID"];t&&(null===n.sessionData&&(n.sessionData={}),n.sessionData[t]=e);break}case"SESSION-KEY":{const e=Sf(i,t,n);e.encrypted&&e.isSupported()?(null===n.sessionKeys&&(n.sessionKeys=[]),n.sessionKeys.push(e)):Su.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'.concat(i,'"'));break}case"DEFINE":Hh(n,new qh(i,n),t);break;case"CONTENT-STEERING":{const e=new qh(i,n);n.contentSteering={uri:Ef.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":n.startTimeOffset=wf(i)}}const o=i.length>0&&i.length<n.levels.length;return n.levels=o?i:n.levels,0===n.levels.length&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(e,t,n){let i;const r={},a=n.levels,o={AUDIO:a.map(e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec})),SUBTITLES:a.map(e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec})),"CLOSED-CAPTIONS":[]};let s=0;for(mf.lastIndex=0;null!==(i=mf.exec(e));){const e=new qh(i[1],n),a=e.TYPE;if(a){const n=o[a],i=r[a]||[];r[a]=i;const l=e.LANGUAGE,c=e["ASSOC-LANGUAGE"],u=e.CHANNELS,d=e.CHARACTERISTICS,h=e["INSTREAM-ID"],f={attrs:e,bitrate:0,id:s++,groupId:e["GROUP-ID"]||"",name:e.NAME||l||"",type:a,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:l,url:e.URI?Ef.resolve(e.URI,t):""};if(c&&(f.assocLang=c),u&&(f.channels=u),d&&(f.characteristics=d),h&&(f.instreamId=h),null!=n&&n.length){const e=Ef.findGroup(n,f.groupId)||n[0];Rf(f,e,"audioCodec"),Rf(f,e,"textCodec")}i.push(f)}}return r}static parseLevelPlaylist(e,t,n,i,r,a){var o;const s={url:t},l=new Xh(t),c=l.fragments,u=[];let d,h,f,p,g=null,m=0,v=0,y=0,_=0,E=0,b=null,T=new Bu(i,s),S=-1,w=!1,A=null;if(yf.lastIndex=0,l.m3u8=e,l.hasVariableRefs=Vh(e),"#EXTM3U"!==(null==(o=yf.exec(e))?void 0:o[0]))return l.playlistParsingError=new Error("Missing format identifier #EXTM3U"),l;for(;null!==(d=yf.exec(e));){w&&(w=!1,T=new Bu(i,s),T.playlistOffset=y,T.setStart(y),T.sn=m,T.cc=_,E&&(T.bitrate=E),T.level=n,g&&(T.initSegment=g,g.rawProgramDateTime&&(T.rawProgramDateTime=g.rawProgramDateTime,g.rawProgramDateTime=null),A&&(T.setByteRange(A),A=null)));const e=d[1];if(e){T.duration=parseFloat(e);const t=(" "+d[2]).slice(1);T.title=t||null,T.tagList.push(t?["INF",e,t]:["INF",e])}else if(d[3]){if(eu(T.duration)){T.playlistOffset=y,T.setStart(y),f&&Lf(T,f,l),T.sn=m,T.level=n,T.cc=_,c.push(T);const e=(" "+d[3]).slice(1);T.relurl=Gh(l,e),xf(T,b,u),b=T,y+=T.duration,m++,v=0,w=!0}}else{if(d=d[0].match(_f),!d){Su.warn("No matches on slow regex match for level playlist!");continue}for(h=1;h<d.length&&void 0===d[h];h++);const e=(" "+d[h]).slice(1),r=(" "+d[h+1]).slice(1),o=d[h+2]?(" "+d[h+2]).slice(1):null;switch(e){case"BYTERANGE":b?T.setByteRange(r,b):T.setByteRange(r);break;case"PROGRAM-DATE-TIME":T.rawProgramDateTime=r,T.tagList.push(["PROGRAM-DATE-TIME",r]),-1===S&&(S=c.length);break;case"PLAYLIST-TYPE":l.type&&Mf(l,e,d),l.type=r.toUpperCase();break;case"MEDIA-SEQUENCE":0!==l.startSN?Mf(l,e,d):c.length>0&&Cf(l,e,d),m=l.startSN=parseInt(r);break;case"SKIP":{l.skippedSegments&&Mf(l,e,d);const t=new qh(r,l),n=t.decimalInteger("SKIPPED-SEGMENTS");if(eu(n)){l.skippedSegments+=n;for(let e=n;e--;)c.push(null);m+=n}const i=t.enumeratedString("RECENTLY-REMOVED-DATERANGES");i&&(l.recentlyRemovedDateranges=(l.recentlyRemovedDateranges||[]).concat(i.split("\t")));break}case"TARGETDURATION":0!==l.targetduration&&Mf(l,e,d),l.targetduration=Math.max(parseInt(r),1);break;case"VERSION":null!==l.version&&Mf(l,e,d),l.version=parseInt(r);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":l.live||Mf(l,e,d),l.live=!1;break;case"#":(r||o)&&T.tagList.push(o?[r,o]:[r]);break;case"DISCONTINUITY":_++,T.tagList.push(["DIS"]);break;case"GAP":T.gap=!0,T.tagList.push([e]);break;case"BITRATE":T.tagList.push([e,r]),E=1e3*parseInt(r),eu(E)?T.bitrate=E:E=0;break;case"DATERANGE":{const e=new qh(r,l),t=new Kh(e,l.dateRanges[e.ID],l.dateRangeTagCount);l.dateRangeTagCount++,t.isValid||l.skippedSegments?l.dateRanges[t.id]=t:Su.warn('Ignoring invalid DATERANGE tag: "'.concat(r,'"')),T.tagList.push(["EXT-X-DATERANGE",r]);break}case"DEFINE":{const e=new qh(r,l);"IMPORT"in e?jh(l,e,a):Hh(l,e,t)}break;case"DISCONTINUITY-SEQUENCE":0!==l.startCC?Mf(l,e,d):c.length>0&&Cf(l,e,d),l.startCC=_=parseInt(r);break;case"KEY":{const e=Sf(r,t,l);if(e.isSupported()){if("NONE"===e.method){f=void 0;break}f||(f={});const t=f[e.keyFormat];null!=t&&t.matches(e)||(t&&(f=pu({},f)),f[e.keyFormat]=e)}else Su.warn('[Keys] Ignoring unsupported EXT-X-KEY tag: "'.concat(r,'"'));break}case"START":l.startTimeOffset=wf(r);break;case"MAP":{const e=new qh(r,l);if(T.duration){const t=new Bu(i,s);If(t,e,n,f),g=t,T.initSegment=g,g.rawProgramDateTime&&!T.rawProgramDateTime&&(T.rawProgramDateTime=g.rawProgramDateTime)}else{const t=T.byteRangeEndOffset;if(t){const e=T.byteRangeStartOffset;A="".concat(t-e,"@").concat(e)}else A=null;If(T,e,n,f),g=T,w=!0}g.cc=_;break}case"SERVER-CONTROL":p&&Mf(l,e,d),p=new qh(r),l.canBlockReload=p.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=p.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=l.canSkipUntil>0&&p.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=p.optionalFloat("PART-HOLD-BACK",0),l.holdBack=p.optionalFloat("HOLD-BACK",0);break;case"PART-INF":{l.partTarget&&Mf(l,e,d);const t=new qh(r);l.partTarget=t.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=l.partList;e||(e=l.partList=[]);const t=v>0?e[e.length-1]:void 0,n=v++,i=new qh(r,l),a=new Uu(i,T,s,n,t);e.push(a),T.duration+=a.duration;break}case"PRELOAD-HINT":{const e=new qh(r,l);l.preloadHint=e;break}case"RENDITION-REPORT":{const e=new qh(r,l);l.renditionReports=l.renditionReports||[],l.renditionReports.push(e);break}default:Su.warn("line parsed but not handled: ".concat(d))}}}b&&!b.relurl?(c.pop(),y-=b.duration,l.partList&&(l.fragmentHint=b)):l.partList&&(xf(T,b,u),T.cc=_,l.fragmentHint=T,f&&Lf(T,f,l)),l.targetduration||(l.playlistParsingError=new Error("Missing Target Duration"));const R=c.length,x=c[0],I=c[R-1];if(y+=l.skippedSegments*l.targetduration,y>0&&R&&I){l.averagetargetduration=y/R;const e=I.sn;l.endSN="initSegment"!==e?e:0,l.live||(I.endList=!0),S>0&&(function(e,t){let n=e[t];for(let i=t;i--;){const t=e[i];if(!t)return;t.programDateTime=n.programDateTime-1e3*t.duration,n=t}}(c,S),x&&u.unshift(x))}return l.fragmentHint&&(y+=l.fragmentHint.duration),l.totalduration=y,u.length&&l.dateRangeTagCount&&x&&bf(u,l),l.endCC=_,l}}function bf(e,t){let n=e.length;if(!n){if(!t.hasProgramDateTime)return;{const i=t.fragments[t.fragments.length-1];e.push(i),n++}}const i=e[n-1],r=t.live?1/0:t.totalduration,a=Object.keys(t.dateRanges);for(let s=a.length;s--;){const l=t.dateRanges[a[s]],c=l.startDate.getTime();l.tagAnchor=i.ref;for(let i=n;i--;){var o;if((null==(o=e[i])?void 0:o.sn)<t.startSN)break;const n=Tf(t,c,e,i,r);if(-1!==n){l.tagAnchor=t.fragments[n].ref;break}}}}function Tf(e,t,n,i,r){const a=n[i];if(a){const s=a.programDateTime;if(t>=s||0===i){var o;if(t<=s+1e3*(((null==(o=n[i+1])?void 0:o.start)||r)-a.start)){const r=n[i].sn-e.startSN;if(r<0)return-1;const a=e.fragments;if(a.length>n.length){for(let o=(n[i+1]||a[a.length-1]).sn-e.startSN;o>r;o--){const e=a[o].programDateTime;if(t>=e&&t<e+1e3*a[o].duration)return o}}return r}}}return-1}function Sf(e,t,n){var i,r;const a=new qh(e,n),o=null!=(i=a.METHOD)?i:"",s=a.URI,l=a.hexadecimalInteger("IV"),c=a.KEYFORMATVERSIONS,u=null!=(r=a.KEYFORMAT)?r:"identity";s&&a.IV&&!l&&Su.error("Invalid IV: ".concat(a.IV));const d=s?Ef.resolve(s,t):"",h=(c||"1").split("/").map(Number).filter(Number.isFinite);return new pf(o,d,u,h,l,a.KEYID)}function wf(e){const t=new qh(e).decimalFloatingPoint("TIME-OFFSET");return eu(t)?t:null}function Af(e,t){let n=(e||"").split(/[ ,]+/).filter(e=>e);["video","audio","text"].forEach(e=>{const i=n.filter(t=>pd(t,e));i.length&&(t["".concat(e,"Codec")]=i.map(e=>e.split("/")[0]).join(","),n=n.filter(e=>-1===i.indexOf(e)))}),t.unknownCodecs=n}function Rf(e,t,n){const i=t[n];i&&(e[n]=i)}function xf(e,t,n){e.rawProgramDateTime?n.push(e):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime)}function If(e,t,n,i){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=n,e.sn="initSegment",i&&(e.levelkeys=i),e.initSegment=null}function Lf(e,t,n){e.levelkeys=t;const{encryptedFragments:i}=n;(!i.length||i[i.length-1].levelkeys!==t)&&Object.keys(t).some(e=>t[e].isCommonEncryption)&&i.push(e)}function Mf(e,t,n){e.playlistParsingError=new Error("#EXT-X-".concat(t," must not appear more than once (").concat(n[0],")"))}function Cf(e,t,n){e.playlistParsingError=new Error("#EXT-X-".concat(t," must appear before the first Media Segment (").concat(n[0],")"))}function Pf(e,t){const n=t.startPTS;if(eu(n)){let i,r=0;t.sn>e.sn?(r=n-e.start,i=e):(r=e.start-n,i=t),i.duration!==r&&i.setDuration(r)}else t.sn>e.sn?e.cc===t.cc&&e.minEndPTS?t.setStart(e.start+(e.minEndPTS-e.start)):t.setStart(e.start+e.duration):t.setStart(Math.max(e.start-t.duration,0))}function Df(e,t,n,i,r,a,o){i-n<=0&&(o.warn("Fragment should have a positive duration",t),i=n+t.duration,a=r+t.duration);let s=n,l=i;const c=t.startPTS,u=t.endPTS;if(eu(c)){const d=Math.abs(c-n);e&&d>e.totalduration?o.warn("media timestamps and playlist times differ by ".concat(d,"s for level ").concat(t.level," ").concat(e.url)):eu(t.deltaPTS)?t.deltaPTS=Math.max(d,t.deltaPTS):t.deltaPTS=d,s=Math.max(n,c),n=Math.min(n,c),r=void 0!==t.startDTS?Math.min(r,t.startDTS):r,l=Math.min(i,u),i=Math.max(i,u),a=void 0!==t.endDTS?Math.max(a,t.endDTS):a}const d=n-t.start;0!==t.start&&t.setStart(n),t.setDuration(i-t.start),t.startPTS=n,t.maxStartPTS=s,t.startDTS=r,t.endPTS=i,t.minEndPTS=l,t.endDTS=a;const h=t.sn;if(!e||h<e.startSN||h>e.endSN)return 0;let f;const p=h-e.startSN,g=e.fragments;for(g[p]=t,f=p;f>0;f--)Pf(g[f],g[f-1]);for(f=p;f<g.length-1;f++)Pf(g[f],g[f+1]);return e.fragmentHint&&Pf(g[g.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,d}function Of(e,t,n){if(e===t)return;let i=null;const r=e.fragments;for(let e=r.length-1;e>=0;e--){const t=r[e].initSegment;if(t){i=t;break}}let a;e.fragmentHint&&delete e.fragmentHint.endPTS,function(e,t,n){const i=t.skippedSegments,r=Math.max(e.startSN,t.startSN)-t.startSN,a=(e.fragmentHint?1:0)+(i?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,o=t.startSN-e.startSN,s=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let c=r;c<=a;c++){const r=l[o+c];let a=s[c];if(i&&!a&&r&&(a=t.fragments[c]=r),r&&a){n(r,a,c,s);const i=r.relurl,o=a.relurl;if(i&&jf(i,o))return void(t.playlistParsingError=Nf("media sequence mismatch ".concat(a.sn,":"),e,t,r,a));if(r.cc!==a.cc)return void(t.playlistParsingError=Nf("discontinuity sequence mismatch (".concat(r.cc,"!=").concat(a.cc,")"),e,t,r,a))}}}(e,t,(e,n,r,o)=>{if((!t.startCC||t.skippedSegments)&&n.cc!==e.cc){const i=e.cc-n.cc;for(let e=r;e<o.length;e++)o[e].cc+=i;t.endCC=o[o.length-1].cc}eu(e.startPTS)&&eu(e.endPTS)&&(n.setStart(n.startPTS=e.startPTS),n.startDTS=e.startDTS,n.maxStartPTS=e.maxStartPTS,n.endPTS=e.endPTS,n.endDTS=e.endDTS,n.minEndPTS=e.minEndPTS,n.setDuration(e.endPTS-e.startPTS),n.duration&&(a=n),t.PTSKnown=t.alignedSliding=!0),e.hasStreams&&(n.elementaryStreams=e.elementaryStreams),n.loader=e.loader,e.hasStats&&(n.stats=e.stats),e.initSegment&&(n.initSegment=e.initSegment,i=e.initSegment)});const o=t.fragments,s=t.fragmentHint?o.concat(t.fragmentHint):o;if(i&&s.forEach(e=>{var t;e&&(!e.initSegment||e.initSegment.relurl===(null==(t=i)?void 0:t.relurl))&&(e.initSegment=i)}),t.skippedSegments){if(t.deltaUpdateFailed=o.some(e=>!e),t.deltaUpdateFailed){n.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)o.shift();t.startSN=o[0].sn}else{t.canSkipDateRanges&&(t.dateRanges=function(e,t,n){const{dateRanges:i,recentlyRemovedDateranges:r}=t,a=pu({},e);r&&r.forEach(e=>{delete a[e]});const o=Object.keys(a).length;return o?(Object.keys(i).forEach(e=>{const t=a[e],r=new Kh(i[e].attr,t);r.isValid?(a[e]=r,t||(r.tagOrder+=o)):n.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'.concat(jd(i[e].attr),'"'))}),a):i}(e.dateRanges,t,n));const i=e.fragments.filter(e=>e.rawProgramDateTime);if(e.hasProgramDateTime&&!t.hasProgramDateTime)for(let e=1;e<s.length;e++)null===s[e].programDateTime&&xf(s[e],s[e-1],i);bf(i,t)}t.endCC=o[o.length-1].cc}if(!t.startCC){var l;const n=Uf(e,t.startSN-1);t.startCC=null!=(l=null==n?void 0:n.cc)?l:o[0].cc}(function(e,t,n){if(e&&t){let i=0;for(let r=0,a=e.length;r<=a;r++){const a=e[r],o=t[r+i];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?n(a,o):i--}}})(e.partList,t.partList,(e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats}),a?Df(t,a,a.startPTS,a.endPTS,a.startDTS,a.endDTS,n):kf(e,t),o.length&&(t.totalduration=t.edge-o[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const c=t.advancedDateTime;if(t.advanced&&c){const e=t.edge;t.driftStart||(t.driftStartTime=c,t.driftStart=e),t.driftEndTime=c,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime;-1===t.requestScheduled&&(t.requestScheduled=e.requestScheduled)}function Nf(e,t,n,i,r){return new Error("".concat(e," ").concat(r.url,"\nPlaylist starting @").concat(t.startSN,"\n").concat(t.m3u8,"\n\nPlaylist starting @").concat(n.startSN,"\n").concat(n.m3u8))}function kf(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=t.startSN+t.skippedSegments-e.startSN,r=e.fragments,a=i>=0;let o=0;if(a&&i<r.length)o=r[i].start;else if(a&&t.startSN===e.endSN+1)o=e.fragmentEnd;else if(a&&n)o=e.fragmentStart+i*t.levelTargetDuration;else{if(t.skippedSegments||0!==t.fragmentStart)return;o=e.fragmentStart}Ff(t,o)}function Ff(e,t){if(t){const n=e.fragments;for(let i=e.skippedSegments;i<n.length;i++)n[i].addStart(t);e.fragmentHint&&e.fragmentHint.addStart(t)}}function Bf(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=1e3*e.targetduration;if(e.updated){const i=e.fragments;if(i.length&&4*n>t){const e=1e3*i[i.length-1].duration;e<n&&(n=e)}}else n/=2;return Math.round(n)}function Uf(e,t,n){if(!e)return null;let i=e.fragments[t-e.startSN];return i||(i=e.fragmentHint,i&&i.sn===t)?i:t<e.startSN&&n&&n.sn===t?n:null}function Vf(e,t,n){return e?Gf(e.partList,t,n):null}function Gf(e,t,n){if(e)for(let i=e.length;i--;){const r=e[i];if(r.index===n&&r.fragment.sn===t)return r}return null}function Hf(e){e.forEach((e,t)=>{var n;null==(n=e.details)||n.fragments.forEach(e=>{e.level=t,e.initSegment&&(e.initSegment.level=t)})})}function jf(e,t){return!(e===t||!t)&&zf(e)!==zf(t)}function zf(e){return e.replace(/\?[^?]*$/,"")}function Zf(e,t){for(let i=0,r=e.length;i<r;i++){var n;if((null==(n=e[i])?void 0:n.cc)===t)return e[i]}return null}function qf(e,t){const n=e.start+t;e.startPTS=n,e.setStart(n),e.endPTS=n+e.duration}function Wf(e,t){const n=t.fragments;for(let t=0,i=n.length;t<i;t++)qf(n[t],e);t.fragmentHint&&qf(t.fragmentHint,e),t.alignedSliding=!0}function Yf(e,t){if(!function(e,t){return!!(e&&t.startCC<e.endCC&&t.endCC>e.startCC)}(t,e))return;const n=Math.min(t.endCC,e.endCC),i=Zf(t.fragments,n),r=Zf(e.fragments,n);if(!i||!r)return;Su.log("Aligning playlist at start of dicontinuity sequence ".concat(n));Wf(i.start-r.start,e)}function Kf(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const n=e.fragments,i=t.fragments;if(!n.length||!i.length)return;let r,a;const o=Math.min(t.endCC,e.endCC);t.startCC<o&&e.startCC<o&&(r=Zf(i,o),a=Zf(n,o)),(!r||!a)&&(r=i[Math.floor(i.length/2)],a=Zf(n,r.cc)||n[Math.floor(n.length/2)]);const s=r.programDateTime,l=a.programDateTime;if(!s||!l)return;Wf((l-s)/1e3-(a.start-r.start),e)}function Xf(e,t,n){Qf(e,t,n),e.addEventListener(t,n)}function Qf(e,t,n){e.removeEventListener(t,n)}const Jf=function(e){let t="";const n=e.length;for(let i=0;i<n;i++)t+="[".concat(e.start(i).toFixed(3),"-").concat(e.end(i).toFixed(3),"]");return t},$f="STOPPED",ep="IDLE",tp="KEY_LOADING",np="FRAG_LOADING",ip="FRAG_LOADING_WAITING_RETRY",rp="WAITING_TRACK",ap="PARSING",op="PARSED",sp="ENDED",lp="ERROR",cp="WAITING_INIT_PTS",up="WAITING_LEVEL";class dp extends Nh{constructor(e,t,n,i,r){super(i,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=$f,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:e,fragCurrent:t,media:n,mediaBuffer:i,state:r}=this,a=n?n.currentTime:0,o=Bh.bufferInfo(i||n,a,e.maxBufferHole),s=!o.len;if(this.log("Media seeking to ".concat(eu(a)?a.toFixed(3):a,", state: ").concat(r,", ").concat(s?"out of":"in"," buffer")),this.state===sp)this.resetLoadingState();else if(t){const n=e.maxFragLookUpTolerance,i=t.start-n,r=t.start+t.duration+n;if(s||r<o.start||i>o.end){const e=a>r;(a<i||e)&&(e&&t.loader&&(this.log("Cancelling fragment load for seek (sn: ".concat(t.sn,")")),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(n){this.fragmentTracker.removeFragmentsInRange(a,1/0,this.playlistType,!0);if(a>this.lastCurrentTime&&(this.lastCurrentTime=a),!this.loadingParts){const e=Math.max(o.end,a),t=this.shouldLoadParts(this.getLevelDetails(),e);t&&(this.log("LL-Part loading ON after seeking to ".concat(a.toFixed(2)," with buffer @").concat(e.toFixed(2))),this.loadingParts=t)}}this.hls.hasEnoughToStart||(this.log("Setting ".concat(s?"startPosition":"nextLoadPosition"," to ").concat(a," for seek without enough to start")),this.nextLoadPosition=a,s&&(this.startPosition=a)),s&&this.state===ep&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=r,this.hls=e,this.fragmentLoader=new Ch(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Lh(e.config)}registerListeners(){const{hls:e}=this;e.on(au.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(au.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(au.MANIFEST_LOADING,this.onManifestLoading,this),e.on(au.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(au.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(au.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(au.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(au.MANIFEST_LOADING,this.onManifestLoading,this),e.off(au.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(au.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===$f)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=$f}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return-1===t&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,i=this.config.timelineOffset||0;if(n<=i)return!1;const r=e.buffered;this.config.maxBufferHole&&r&&r.length>1&&(e=Bh.bufferedInfo(r,e.start,0));const a=e.nextStart;if(a&&a>i&&a<t.edge||this.media.currentTime<e.start)return!1;const o=t.partList;if(null!=o&&o.length){const e=o[o.length-1];return Bh.isBuffered(this.media,e.start+e.duration/2)}const s=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(s)}getLevelDetails(){if(this.levels&&null!==this.levelLastLoaded)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;var t;return e?(null==(t=this.getLevelDetails())?void 0:t.appliedTimelineOffset)||e:0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;Xf(n,"seeking",this.onMediaSeeking),Xf(n,"ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===$f&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,i=this.media;if(null!==i){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Qf(i,"seeking",this.onMediaSeeking),Qf(i,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n)return this.resetLoadingState(),void this.resetTransmuxer();this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=$f,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){this._doFragLoad(e,t,n,e=>{const t=e.frag;if(this.fragContextChanged(t))return this.warn("".concat(t.type," sn: ").concat(t.sn).concat(e.part?" part: "+e.part.index:""," of ").concat(this.fragInfo(t,!1,e.part),") was dropped during download.")),void this.fragmentTracker.removeFragment(t);t.stats.chunkCount++,this._handleFragmentLoadProgress(e)}).then(e=>{if(!e)return;const t=this.state,n=e.frag;this.fragContextChanged(n)?(t===np||!this.fragCurrent&&t===ap)&&(this.fragmentTracker.removeFragment(n),this.state=ep):("payload"in e&&(this.log("Loaded ".concat(n.type," sn: ").concat(n.sn," of ").concat(this.playlistLabel()," ").concat(n.level)),this.hls.trigger(au.FRAG_LOADED,e)),this._handleFragmentLoadComplete(e))}).catch(t=>{this.state===$f||this.state===lp||(this.warn("Frag error: ".concat((null==t?void 0:t.message)||t)),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===vh){const t=e.type,i=this.getFwdBufferInfo(this.mediaBuffer,t),r=Math.max(e.duration,i?i.len:this.config.maxBufferLength),a=this.backtrackFragment;(1===(a?e.sn-a.sn:0)||this.reduceMaxBufferLength(r,e.duration))&&n.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===yh&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(null==t?void 0:t.live)&&"EVENT"!==t.type&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t){if(!(e-t))return;const n={startOffset:e,endOffset:t,type:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null};this.hls.trigger(au.BUFFER_FLUSHING,n)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(e=>{const t=null==e?void 0:e.frag;if(!t||this.fragContextChanged(t)||!this.levels)throw new Error("init load aborted");return e}).then(e=>{const{hls:t}=this,{frag:n,payload:i}=e,r=n.decryptdata;if(i&&i.byteLength>0&&null!=r&&r.key&&r.iv&&$h(r.method)){const a=self.performance.now();return this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer,ef(r.method)).catch(e=>{throw t.trigger(au.ERROR,{type:iu.MEDIA_ERROR,details:ru.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:n}),e}).then(i=>{const r=self.performance.now();return t.trigger(au.FRAG_DECRYPTED,{frag:n,payload:i,stats:{tstart:a,tdecrypt:r}}),e.payload=i,this.completeInitSegmentLoad(e)})}return this.completeInitSegmentLoad(e)}).catch(t=>{this.state===$f||this.state===lp||(this.warn(t),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==$f&&(this.state=ep),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var n,i;const r=e.tracks;if(r&&!t.encrypted&&(null!=(n=r.audio)&&n.encrypted||null!=(i=r.video)&&i.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const e=this.media,n=new Error("Encrypted track with no key in ".concat(this.fragInfo(t)," (media ").concat(e?"attached mediaKeys: "+e.mediaKeys:"detached",")"));return this.warn(n.message),!(!e||e.mediaKeys)&&(this.hls.trigger(au.ERROR,{type:iu.KEY_SYSTEM_ERROR,details:ru.KEY_SYSTEM_NO_KEYS,fatal:!1,error:n,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered ".concat(e.type," sn: ").concat(e.sn).concat(t?" part: "+t.index:""," of ").concat(this.fragInfo(e,!1,t)," > buffer:").concat(n?Jf(Bh.getBuffered(n)):"(detached)",")")),Fu(e)){var i;if(e.type!==uu.SUBTITLE){const t=e.elementaryStreams;if(!Object.keys(t).some(e=>!!t[e]))return void(this.state=ep)}const t=null==(i=this.levels)?void 0:i[e.level];null!=t&&t.fragmentError&&(this.log("Resetting level fragment error count of ".concat(t.fragmentError," on frag buffered")),t.fragmentError=0)}this.state=ep}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:i,partsLoaded:r}=e,a=!r||0===r.length||r.some(e=>!e),o=new kh(n.level,n.sn,n.stats.chunkCount+1,0,i?i.index:-1,!a);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3?arguments[3]:void 0;var r;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error("frag load aborted, missing level".concat(a?"":" detail","s"));let o=null;if(!e.encrypted||null!=(r=e.decryptdata)&&r.key)e.encrypted||(o=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),o&&this.log("[eme] blocking frag load until media-keys acquired"));else if(this.log("Loading key for ".concat(e.sn," of [").concat(a.startSN,"-").concat(a.endSN,"], ").concat(this.playlistLabel()," ").concat(e.level)),this.state=tp,this.fragCurrent=e,o=this.keyLoader.load(e).then(e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(au.KEY_LOADED,e),this.state===tp&&(this.state=ep),e}),this.hls.trigger(au.KEY_LOADING,{frag:e}),null===this.fragCurrent)return this.log("context changed in KEY_LOADING"),Promise.resolve(null);const s=this.fragPrevious;if(Fu(e)&&(!s||e.sn!==s.sn)){const n=this.shouldLoadParts(t.details,e.end);n!==this.loadingParts&&(this.log("LL-Part loading ".concat(n?"ON":"OFF"," loading sn ").concat(null==s?void 0:s.sn,"->").concat(e.sn)),this.loadingParts=n)}if(n=Math.max(e.start,n||0),this.loadingParts&&Fu(e)){const r=a.partList;if(r&&i){n>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const s=this.getNextPart(r,e,n);if(s>-1){const l=r[s];let c;return e=this.fragCurrent=l.fragment,this.log("Loading ".concat(e.type," sn: ").concat(e.sn," part: ").concat(l.index," (").concat(s,"/").concat(r.length-1,") of ").concat(this.fragInfo(e,!1,l),") cc: ").concat(e.cc," [").concat(a.startSN,"-").concat(a.endSN,"], target: ").concat(parseFloat(n.toFixed(3)))),this.nextLoadPosition=l.start+l.duration,this.state=np,c=o?o.then(n=>!n||this.fragContextChanged(n.frag)?null:this.doFragPartsLoad(e,l,t,i)).catch(e=>this.handleFragLoadError(e)):this.doFragPartsLoad(e,l,t,i).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(au.FRAG_LOADING,{frag:e,part:l,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):c}if(!e.url||this.loadedEndOfParts(r,n))return Promise.resolve(null)}}var l;if(Fu(e)&&this.loadingParts)this.log("LL-Part loading OFF after next part miss @".concat(n.toFixed(2)," Check buffer at sn: ").concat(e.sn," loaded parts: ").concat(null==(l=a.partList)?void 0:l.filter(e=>e.loaded).map(e=>"[".concat(e.start,"-").concat(e.end,"]")))),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log("Loading ".concat(e.type," sn: ").concat(e.sn," of ").concat(this.fragInfo(e,!1),") cc: ").concat(e.cc," ").concat("["+a.startSN+"-"+a.endSN+"]",", target: ").concat(parseFloat(n.toFixed(3)))),eu(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=np;const c=this.config.progressive;let u;return u=c&&o?o.then(t=>!t||this.fragContextChanged(t.frag)?null:this.fragmentLoader.load(e,i)).catch(e=>this.handleFragLoadError(e)):Promise.all([this.fragmentLoader.load(e,c?i:void 0),o]).then(e=>{let[t]=e;return!c&&i&&i(t),t}).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(au.FRAG_LOADING,{frag:e,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):u}doFragPartsLoad(e,t,n,i){return new Promise((r,a)=>{var o;const s=[],l=null==(o=n.details)?void 0:o.partList,c=t=>{this.fragmentLoader.loadPart(e,t,i).then(i=>{s[t.index]=i;const a=i.part;this.hls.trigger(au.FRAG_LOADED,i);const o=Vf(n.details,e.sn,t.index+1)||Gf(l,e.sn,t.index+1);if(!o)return r({frag:e,part:a,partsLoaded:s});c(o)}).catch(a)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===ru.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===iu.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(au.ERROR,t)}else this.hls.trigger(au.ERROR,{type:iu.OTHER_ERROR,details:ru.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ap)return void(!this.fragCurrent&&this.state!==$f&&this.state!==lp&&(this.state=ep));const{frag:n,part:i,level:r}=t,a=self.performance.now();n.stats.parsing.end=a,i&&(i.stats.parsing.end=a);const o=this.getLevelDetails(),s=o&&n.sn>o.endSN||this.shouldLoadParts(o,n.end);s!==this.loadingParts&&(this.log("LL-Part loading ".concat(s?"ON":"OFF"," after parsing segment ending @").concat(n.end.toFixed(2))),this.loadingParts=s),this.updateLevelTiming(n,i,r,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const r=e.partList[0];if(r.fragment.type===uu.SUBTITLE)return!1;var i;if(t>=r.end+((null==(n=e.fragmentHint)?void 0:n.duration)||0))if((this.hls.hasEnoughToStart?(null==(i=this.media)?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:i,sn:r,part:a}=e;if(null==t||!t[i])return this.warn("Levels object was unset while buffering fragment ".concat(r," of ").concat(this.playlistLabel()," ").concat(i,". The current chunk will not be buffered.")),null;const o=t[i],s=o.details,l=a>-1?Vf(s,r,a):null,c=l?l.fragment:Uf(s,r,n);return c?(n&&n!==c&&(c.stats=n.stats),{frag:c,part:l,level:o}):null}bufferFragmentData(e,t,n,i,r){if(this.state!==ap)return;const{data1:a,data2:o}=e;let s=a;if(o&&(s=rd(a,o)),!s.length)return;const l=this.initPTS[t.cc],c=l?-l.baseTime/l.timescale:void 0,u={type:e.type,frag:t,part:n,chunkMeta:i,offset:c,parent:t.type,data:s};if(this.hls.trigger(au.BUFFER_APPENDING,u),e.dropped&&e.independent&&!n){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Bh.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const n=t.currentTime,i=Bh.bufferInfo(t,n,0),r=e.duration,a=Math.min(2*this.config.maxFragLookUpTolerance,.25*r),o=Math.max(Math.min(e.start-a,i.end-a),n+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){var n;const i=this.getLoadPosition();if(!eu(i))return null;const r=this.lastCurrentTime>i||null!=(n=this.media)&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,t,r)}getFwdBufferInfoAtPos(e,t,n,i){const r=Bh.bufferInfo(e,t,i);if(0===r.len&&void 0!==r.nextStart){const a=this.fragmentTracker.getBufferedFrag(t,n);if(a&&(r.nextStart<=a.end||a.gap)){const n=Math.max(Math.min(r.nextStart,a.end)-t,i);return Bh.bufferInfo(e,t,n)}}return r}getMaxBufferLength(e){const{config:t}=this;let n;return n=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,i=Math.max(Math.min(e-t,n.maxBufferLength),t),r=Math.max(e-3*t,n.maxMaxBufferLength/2,i);return r>=i&&(n.maxMaxBufferLength=r,this.warn("Reduce max buffer length to ".concat(r,"s")),!0)}getAppendedFrag(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:uu.MAIN;const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,i=n.length;if(!i)return null;const{config:r}=this,a=n[0].start,o=r.lowLatencyMode&&!!t.partList;let s=null;if(t.live){const n=r.initialLiveManifestSize;if(i<n)return this.warn("Not enough fragments to start playback (have: ".concat(i,", need: ").concat(n,")")),null;if(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<a){var l;o&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),s=this.getInitialLiveFragment(t);const n=this.hls.startPosition,i=this.hls.liveSyncPosition,r=s?(-1!==n&&n>=a?n:i)||s.start:e;this.log("Setting startPosition to ".concat(r," to match start frag at live edge. mainStart: ").concat(n," liveSyncPosition: ").concat(i," frag.start: ").concat(null==(l=s)?void 0:l.start)),this.startPosition=this.nextLoadPosition=r}}else e<=a&&(s=n[0]);if(!s){const n=this.loadingParts?t.partEnd:t.fragmentEnd;s=this.getFragmentAtPosition(e,n,t)}let c=this.filterReplacedPrimary(s,t);if(!c&&s){const e=s.sn-t.startSN;c=this.filterReplacedPrimary(n[e+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===_h||n===yh&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,i,r){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&n.nextStart)){const e=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,i,0);if(null!==e&&n.len+e.len>=r){const e=a.sn;return this.loopSn!==e&&(this.log('buffer full after gaps in "'.concat(i,'" playlist starting at sn: ').concat(e)),this.loopSn=e),null}}return this.loopSn=void 0,a}get primaryPrefetch(){var e;if(hp(this.config)&&(null==(e=this.hls.interstitialsManager)||null==(e=e.playingItem)?void 0:e.event))return!0;return!1}filterReplacedPrimary(e,t){if(!e)return e;if(hp(this.config)&&e.type!==uu.SUBTITLE){const n=this.hls.interstitialsManager,i=null==n?void 0:n.bufferingItem;if(i){const n=i.event;if(n){if(n.appendInPlace||Math.abs(e.start-i.start)>1||0===i.start)return null}else if(e.end<=i.start&&!1===(null==t?void 0:t.live)||e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}const r=null==n?void 0:n.playerQueue;if(r)for(let t=r.length;t--;){const n=r[t].interstitial;if(n.appendInPlace&&e.start>=n.startTime&&e.end<=n.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,n){let i=-1,r=!1,a=!0;for(let o=0,s=e.length;o<s;o++){const s=e[o];if(a=a&&!s.independent,i>-1&&n<s.start)break;const l=s.loaded;l?i=-1:(r||(s.independent||a)&&s.fragment===t)&&(s.fragment!==t&&this.warn("Need buffer at ".concat(n," but next unloaded part starts at ").concat(s.start)),i=o),r=l}return i}loadedEndOfParts(e,t){let n;for(let i=e.length;i--;){if(n=e[i],!n.loaded)return!1;if(t>n.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let i=null;if(n){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: ".concat(n.programDateTime)),i=function(e,t,n){if(null===t||!Array.isArray(e)||!e.length||!eu(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;for(let i=0;i<e.length;++i){const r=e[i];if(nh(t,n,r))return r}return null}(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const r=n.sn+1;if(r>=e.startSN&&r<=e.endSN){const a=t[r-e.startSN];n.cc===a.cc&&(i=a,this.log("Live playlist, switching playlist, load frag with next SN: ".concat(i.sn)))}i||(i=ih(e,n.cc,n.end),i&&this.log("Live playlist, switching playlist, load frag with same CC: ".concat(i.sn)))}}else{const t=this.hls.liveSyncPosition;null!==t&&(i=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,n){const{config:i}=this;let{fragPrevious:r}=this,{fragments:a,endSN:o}=n;const{fragmentHint:s}=n,{maxFragLookUpTolerance:l}=i,c=n.partList,u=!!(this.loadingParts&&null!=c&&c.length&&s);let d;if(u&&!this.bitrateTest&&c[c.length-1].fragment.sn===s.sn&&(a=a.concat(s),o=s.sn),e<t){var h;d=eh(r,a,e,e<this.lastCurrentTime||e>t-l||null!=(h=this.media)&&h.paused||!this.startFragRequested?0:l)}else d=a[a.length-1];if(d){const e=d.sn-n.startSN,t=this.fragmentTracker.getState(d);if((t===_h||t===yh&&d.gap)&&(r=d),r&&d.sn===r.sn&&(!u||c[0].fragment.sn>d.sn||!n.live)&&d.level===r.level){const t=a[e+1];d=d.sn<o&&this.fragmentTracker.getState(t)!==_h?t:null}}return d}alignPlaylists(e,t,n){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const r=e.fragmentStart,a=!t,o=e.alignedSliding&&eu(r);if(a||!o&&!r){!function(e,t){e&&(Yf(t,e),t.alignedSliding||Kf(t,e),!t.alignedSliding&&!t.skippedSegments&&kf(e,t,!1))}(n,e);const r=e.fragmentStart;return this.log("Live playlist sliding: ".concat(r.toFixed(2)," start-sn: ").concat(t?t.startSN:"na","->").concat(e.startSN," fragments: ").concat(i)),r}return r}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const i=this.timelineOffset;if(-1===n){const r=null!==this.startTimeOffset,a=r?this.startTimeOffset:e.startTimeOffset;null!==a&&eu(a)?(n=t+a,a<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log("Setting startPosition to ".concat(n," for start time offset ").concat(a," found in ").concat(r?"multivariant":"media"," playlist")),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log("Setting startPosition to -1 to start at live edge ".concat(n)),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+i}this.nextLoadPosition=n+i}getLoadPosition(){var e;const{media:t}=this;let n=0;return null!=(e=this.hls)&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Fu(e)&&e.stats.aborted&&(this.log("Fragment ".concat(e.sn).concat(t?" part "+t.index:""," of ").concat(this.playlistLabel()," ").concat(e.level," was aborted")),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==ip)&&(this.state=ep)}onFragmentOrKeyLoadError(e,t){var n;if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;var r;if(this.fragContextChanged(i))return void this.warn("Frag load error must match current frag to retry ".concat(i.url," > ").concat(null==(r=this.fragCurrent)?void 0:r.url));const a=t.details===ru.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(i,!0);const o=t.errorAction;if(!o)return void(this.state=lp);const{action:s,flags:l,retryCount:c=0,retryConfig:u}=o,d=!!u,h=d&&s===hh.RetryRequest,f=d&&!o.resolved&&l===fh.MoveAllAlternatesMatchingHost,p=null==(n=this.hls.latestLevelDetails)?void 0:n.live;if(!h&&f&&Fu(i)&&!i.endList&&p&&!oh(t))this.resetFragmentErrors(e),this.treatAsGap(i),o.resolved=!0;else if((h||f)&&c<u.maxNumRetry){var g;const n=dh(null==(g=t.response)?void 0:g.code),r=lh(u,c);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+r,this.state=ip,o.resolved=!0,n)return this.log("Waiting for connection (offline)"),this.retryDate=1/0,void(t.reason="offline");this.warn("Fragment ".concat(i.sn," of ").concat(e," ").concat(i.level," errored with ").concat(t.details,", retrying loading ").concat(c+1,"/").concat(u.maxNumRetry," in ").concat(r,"ms"))}else if(u){if(this.resetFragmentErrors(e),!(c<u.maxNumRetry))return void this.warn("".concat(t.details," reached or exceeded max retry (").concat(c,")"));!a&&s!==hh.RemoveAlternatePermanently&&(o.resolved=!0)}else this.state=s===hh.SendAlternateToPenaltyBox?up:lp;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!dh(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=ep)}reduceLengthAndFlushBuffer(e){if(this.state===ap||this.state===op){const t=e.frag,n=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,n),r=i&&i.len>.5;r&&this.reduceMaxBufferLength(i.len,(null==t?void 0:t.duration)||10);const a=!r;return a&&this.warn("Buffer full error while media.currentTime (".concat(this.getLoadPosition(),") is not buffered, flush ").concat(n," buffer")),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===uu.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==$f&&(this.state=ep)}afterBufferFlushed(e,t,n){if(!e)return;const i=Bh.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,n),this.state===sp&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==$f&&(this.state=ep)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;null!=t&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log("Loading context changed while buffering sn ".concat(e.sn," of ").concat(this.playlistLabel()," ").concat(-1===e.level?"<removed>":e.level,". This chunk will not be buffered.")),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,i){const r=n.details;if(r){var a;if(!Object.keys(e.elementaryStreams).reduce((t,a)=>{const o=e.elementaryStreams[a];if(o){const s=o.endPTS-o.startPTS;if(s<=0)return this.warn("Could not parse fragment ".concat(e.sn," ").concat(a," duration reliably (").concat(s,")")),t||!1;const l=i?0:Df(r,e,o.startPTS,o.endPTS,o.startDTS,o.endDTS,this);return this.hls.trigger(au.LEVEL_PTS_UPDATED,{details:r,level:n,drift:l,type:a,frag:e,start:o.startPTS,end:o.endPTS}),!0}return t},!1))if(0===n.fragmentError&&this.treatAsGap(e,n),null===(null==(a=this.transmuxer)?void 0:a.error)){const t=new Error("Found no media in fragment ".concat(e.sn," of ").concat(this.playlistLabel()," ").concat(e.level," resetting transmuxer to fallback to playlist timing"));if(this.warn(t.message),this.hls.trigger(au.ERROR,{type:iu.MEDIA_ERROR,details:ru.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:"Found no media in msn ".concat(e.sn," of ").concat(this.playlistLabel(),' "').concat(n.url,'"')}),!this.hls)return;this.resetTransmuxer()}this.state=op,this.log("Parsed ".concat(e.type," sn: ").concat(e.sn).concat(t?" part: "+t.index:""," of ").concat(this.fragInfo(e,!1,t),")")),this.hls.trigger(au.FRAG_PARSED,{frag:e,part:t})}else this.warn("level.details undefined")}playlistLabel(){return this.playlistType===uu.MAIN?"level":"track"}fragInfo(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;var i,r;return"".concat(this.playlistLabel()," ").concat(e.level," (").concat(n?"part":"frag",":[").concat((null!=(i=t&&!n?e.startPTS:(n||e).start)?i:NaN).toFixed(3),"-").concat((null!=(r=t&&!n?e.endPTS:(n||e).end)?r:NaN).toFixed(3),"]").concat(n&&"main"===e.type?"INDEPENDENT="+(n.independent?"YES":"NO"):"")}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;null==(e=this.transmuxer)||e.reset()}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log("".concat(t,"->").concat(e)))}get state(){return this._state}}function hp(e){return!!e.interstitialsController&&!1!==e.enableInterstitialPlayback}class fp{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;return e.length?(n=1===e.length?e[0]:function(e,t){const n=new Uint8Array(t);let i=0;for(let t=0;t<e.length;t++){const r=e[t];n.set(r,i),i+=r.length}return n}(e,t),this.reset(),n):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}var pp,gp={exports:{}};var mp=(pp||(pp=1,function(e){var t=Object.prototype.hasOwnProperty,n="~";function i(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,i,a,o){if("function"!=typeof i)throw new TypeError("The listener must be a function");var s=new r(i,a||e,o),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],s]:e._events[l].push(s):(e._events[l]=s,e._eventsCount++),e}function o(e,t){0===--e._eventsCount?e._events=new i:delete e._events[t]}function s(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,i,r=[];if(0===this._eventsCount)return r;for(i in e=this._events)t.call(e,i)&&r.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},s.prototype.listeners=function(e){var t=n?n+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,a=i.length,o=new Array(a);r<a;r++)o[r]=i[r].fn;return o},s.prototype.listenerCount=function(e){var t=n?n+e:e,i=this._events[t];return i?i.fn?1:i.length:0},s.prototype.emit=function(e,t,i,r,a,o){var s=n?n+e:e;if(!this._events[s])return!1;var l,c,u=this._events[s],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,i),!0;case 4:return u.fn.call(u.context,t,i,r),!0;case 5:return u.fn.call(u.context,t,i,r,a),!0;case 6:return u.fn.call(u.context,t,i,r,a,o),!0}for(c=1,l=new Array(d-1);c<d;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var h,f=u.length;for(c=0;c<f;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),d){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,i);break;case 4:u[c].fn.call(u[c].context,t,i,r);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];u[c].fn.apply(u[c].context,l)}}return!0},s.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,i,r){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return o(this,a),this;var s=this._events[a];if(s.fn)s.fn===t&&(!r||s.once)&&(!i||s.context===i)&&o(this,a);else{for(var l=0,c=[],u=s.length;l<u;l++)(s[l].fn!==t||r&&!s[l].once||i&&s[l].context!==i)&&c.push(s[l]);c.length?this._events[a]=1===c.length?c[0]:c:o(this,a)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&o(this,t)):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s}(gp)),gp.exports),vp=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(mp);const yp="1.6.12",_p={};function Ep(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function bp(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function Tp(e,t){let n=0;return n=(127&e[t])<<21,n|=(127&e[t+1])<<14,n|=(127&e[t+2])<<7,n|=127&e[t+3],n}function Sp(e,t){const n=t;let i=0;for(;bp(e,t);){i+=10;i+=Tp(e,t+6),Ep(e,t+10)&&(i+=10),t+=i}if(i>0)return e.subarray(n,n+i)}function wp(e,t){return 255===e[t]&&240==(246&e[t+1])}function Ap(e,t){return 1&e[t+1]?7:9}function Rp(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function xp(e,t){return t+1<e.length&&wp(e,t)}function Ip(e,t){if(xp(e,t)){const n=Ap(e,t);if(t+n>=e.length)return!1;const i=Rp(e,t);if(i<=n)return!1;const r=t+i;return r===e.length||xp(e,r)}return!1}function Lp(e,t,n,i,r){if(!e.samplerate){const a=function(e,t,n,i){const r=t[n+2],a=r>>2&15;if(a>12){const t=new Error("invalid ADTS sampling index:".concat(a));return void e.emit(au.ERROR,au.ERROR,{type:iu.MEDIA_ERROR,details:ru.FRAG_PARSING_ERROR,fatal:!0,error:t,reason:t.message})}const o=1+(r>>6&3),s=t[n+3]>>6&3|(1&r)<<2,l="mp4a.40."+o,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][a];let u=a;(5===o||29===o)&&(u-=3);const d=[o<<3|(14&u)>>1,(1&u)<<7|s<<3];return Su.log("manifest codec:".concat(i,", parsed codec:").concat(l,", channels:").concat(s,", rate:").concat(c," (ADTS object type:").concat(o," sampling index:").concat(a,")")),{config:d,samplerate:c,channelCount:s,codec:l,parsedCodec:l,manifestCodec:i}}(t,n,i,r);if(!a)return;pu(e,a)}}function Mp(e){return 9216e4/e}function Cp(e,t,n,i,r){const a=i+r*Mp(e.samplerate),o=function(e,t){const n=Ap(e,t);if(t+n<=e.length){const i=Rp(e,t)-n;if(i>0)return{headerLength:n,frameLength:i}}}(t,n);let s;if(o){const{frameLength:i,headerLength:r}=o,l=r+i,c=Math.max(0,n+l-t.length);c?(s=new Uint8Array(l-r),s.set(t.subarray(n+r,t.length),0)):s=t.subarray(n+r,n+l);const u={unit:s,pts:a};return c||e.samples.push(u),{sample:u,length:l,missing:c}}const l=t.length-n;return s=new Uint8Array(l),s.set(t.subarray(n,t.length),0),{sample:{unit:s,pts:a},length:l,missing:-1}}function Pp(e,t){return bp(e,t)&&Tp(e,t+6)+10<=e.length-t}function Dp(e){return function(e,t,n,i){const r=function(e){return e instanceof ArrayBuffer?e:e.buffer}(e);let a=1;"BYTES_PER_ELEMENT"in i&&(a=i.BYTES_PER_ELEMENT);const o=function(e){return e&&e.buffer instanceof ArrayBuffer&&void 0!==e.byteLength&&void 0!==e.byteOffset}(e)?e.byteOffset:0,s=(o+e.byteLength)/a,l=(o+t)/a,c=Math.floor(Math.max(0,Math.min(l,s))),u=Math.floor(Math.min(c+Math.max(n,0),s));return new i(r,c,u-c)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,Uint8Array)}function Op(e){const t={key:e.type,description:"",data:"",mimeType:null,pictureType:null};if(e.size<2)return;if(3!==e.data[0])return void console.log("Ignore frame with unrecognized character encoding");const n=e.data.subarray(1).indexOf(0);if(-1===n)return;const i=Ru(Dp(e.data,1,n)),r=e.data[2+n],a=e.data.subarray(3+n).indexOf(0);if(-1===a)return;const o=Ru(Dp(e.data,3+n,a));let s;return s="--\x3e"===i?Ru(Dp(e.data,4+n+a)):function(e){return e instanceof ArrayBuffer?e:0==e.byteOffset&&e.byteLength==e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer}(e.data.subarray(4+n+a)),t.mimeType=i,t.pictureType=r,t.description=o,t.data=s,t}function Np(e){return"PRIV"===e.type?function(e){if(e.size<2)return;const t=Ru(e.data,!0),n=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:n.buffer}}(e):"W"===e.type[0]?function(e){if("WXXX"===e.type){if(e.size<2)return;let t=1;const n=Ru(e.data.subarray(t),!0);t+=n.length+1;const i=Ru(e.data.subarray(t));return{key:e.type,info:n,data:i}}const t=Ru(e.data);return{key:e.type,info:"",data:t}}(e):"APIC"===e.type?Op(e):function(e){if(e.size<2)return;if("TXXX"===e.type){let t=1;const n=Ru(e.data.subarray(t),!0);t+=n.length+1;const i=Ru(e.data.subarray(t));return{key:e.type,info:n,data:i}}const t=Ru(e.data.subarray(1));return{key:e.type,info:"",data:t}}(e)}function kp(e){const t=String.fromCharCode(e[0],e[1],e[2],e[3]),n=Tp(e,4);return{type:t,size:n,data:e.subarray(10,10+n)}}function Fp(e){let t=0;const n=[];for(;bp(e,t);){const i=Tp(e,t+6);e[t+5]>>6&1&&(t+=10),t+=10;const r=t+i;for(;t+10<r;){const i=kp(e.subarray(t)),r=Np(i);r&&n.push(r),t+=i.size+10}Ep(e,t)&&(t+=10)}return n}function Bp(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info}function Up(e){if(8===e.data.byteLength){const t=new Uint8Array(e.data),n=1&t[3];let i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,n&&(i+=47721858.84),Math.round(i)}}function Vp(e){const t=Fp(e);for(let e=0;e<t.length;e++){const n=t[e];if(Bp(n))return Up(n)}}let Gp=function(e){return e.audioId3="org.id3",e.dateRange="com.apple.quicktime.HLS",e.emsg="https://aomedia.org/emsg/ID3",e.misbklv="urn:misb:KLV:bin:1910.1",e}({});function Hp(){return{type:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",id:-1,pid:-1,inputTimeScale:arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,sequenceNumber:-1,samples:[],dropped:0}}class jp{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=rd(this.cachedData,e),this.cachedData=null);let n,i=Sp(e,0),r=i?i.length:0;const a=this._audioTrack,o=this._id3Track,s=i?Vp(i):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&eu(s))&&(this.basePTS=zp(s,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),i&&i.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Gp.audioId3,duration:Number.POSITIVE_INFINITY});r<l;){if(this.canParse(e,r)){const t=this.appendFrame(a,e,r);t?(this.frameIndex++,this.lastPTS=t.sample.pts,r+=t.length,n=r):r=l}else Pp(e,r)?(i=Sp(e,r),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Gp.audioId3,duration:Number.POSITIVE_INFINITY}),r+=i.length,n=r):r++;if(r===l&&n!==l){const t=e.slice(n);this.cachedData?this.cachedData=rd(this.cachedData,t):this.cachedData=t}}return{audioTrack:a,videoTrack:Hp(),id3Track:o,textTrack:Hp()}}demuxSampleAes(e,t,n){return Promise.reject(new Error("[".concat(this,"] This demuxer does not support Sample-AES decryption")))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Hp(),id3Track:this._id3Track,textTrack:Hp()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const zp=(e,t,n)=>{if(eu(e))return 90*e;return 9e4*t+(n?9e4*n.baseTime/n.timescale:0)};let Zp=null;const qp=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Wp=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Yp=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Kp=[0,1,1,4];function Xp(e,t,n,i,r){if(n+24>t.length)return;const a=Qp(t,n);if(a&&n+a.frameLength<=t.length){const o=i+r*(9e4*a.samplesPerFrame/a.sampleRate),s={unit:t.subarray(n,n+a.frameLength),pts:o,dts:o};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(s),{sample:s,length:a.frameLength,missing:0}}}function Qp(e,t){const n=e[t+1]>>3&3,i=e[t+1]>>1&3,r=e[t+2]>>4&15,a=e[t+2]>>2&3;if(1!==n&&0!==r&&15!==r&&3!==a){const o=e[t+2]>>1&1,s=e[t+3]>>6,l=1e3*qp[14*(3===n?3-i:3===i?3:4)+r-1],c=Wp[3*(3===n?0:2===n?1:2)+a],u=3===s?1:2,d=Yp[n][i],h=Kp[i],f=8*d*h,p=Math.floor(d*l/c+o)*h;if(null===Zp){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Zp=e?parseInt(e[1]):0}return!!Zp&&Zp<=87&&2===i&&l>=224e3&&0===s&&(e[t+3]=128|e[t+3]),{sampleRate:c,channelCount:u,frameLength:p,samplesPerFrame:f}}}function Jp(e,t){return!(255!==e[t]||224&~e[t+1]||!(6&e[t+1]))}function $p(e,t){return t+1<e.length&&Jp(e,t)}function eg(e,t){if(t+1<e.length&&Jp(e,t)){const n=Qp(e,t);let i=4;null!=n&&n.frameLength&&(i=n.frameLength);const r=t+i;return r===e.length||$p(e,r)}return!1}const tg=(e,t)=>{let n=0,i=5;t+=i;const r=new Uint32Array(1),a=new Uint32Array(1),o=new Uint8Array(1);for(;i>0;){o[0]=e[t];const s=Math.min(i,8),l=8-s;a[0]=4278190080>>>24+l<<l,r[0]=(o[0]&a[0])>>l,n=n?n<<s|r[0]:r[0],t+=1,i-=s}return n};function ng(e,t,n,i,r){if(n+8>t.length||11!==t[n]||119!==t[n+1])return-1;const a=t[n+4]>>6;if(a>=3)return-1;const o=[48e3,44100,32e3][a],s=63&t[n+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*s+a];if(n+l>t.length)return-1;const c=t[n+6]>>5;let u=0;2===c?u+=2:(1&c&&1!==c&&(u+=2),4&c&&(u+=2));const d=(t[n+6]<<8|t[n+7])>>12-u&1,h=[2,1,2,3,3,4,4,5][c]+d,f=t[n+5]>>3,p=7&t[n+5],g=new Uint8Array([a<<6|f<<1|p>>2,(3&p)<<6|c<<3|d<<2|s>>4,s<<4&224]),m=i+r*(1536/o*9e4),v=t.subarray(n,n+l);return e.config=g,e.channelCount=h,e.samplerate=o,e.samples.push({unit:v,pts:m}),l}const ig=/\/emsg[-/]ID3/i;function rg(e,t){return eu(e.presentationTime)?e.presentationTime/e.timeScale:t+e.presentationTimeDelta/e.timeScale}class ag{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new Lh(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,wh)}decryptAacSample(e,t,n){const i=e[t].unit;if(i.length<=16)return;const r=i.subarray(16,i.length-i.length%16),a=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(a).then(r=>{const a=new Uint8Array(r);i.set(a,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)}).catch(n)}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length)return void n();if(!(e[t].unit.length<32||(this.decryptAacSample(e,t,n),this.decrypter.isSync())))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,n=new Int8Array(t);let i=0;for(let t=32;t<e.length-16;t+=160,i+=16)n.set(e.subarray(t,t+16),i);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let i=0;for(let t=32;t<e.length-16;t+=160,i+=16)e.set(n.subarray(i,i+16),t);return e}decryptAvcSample(e,t,n,i,r){const a=cd(r.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(o=>{r.data=this.getAvcDecryptedUnit(a,o),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,i)}).catch(i)}decryptAvcSamples(e,t,n,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length)return void i();const r=e[t].units;for(;!(n>=r.length);n++){const a=r[n];if(!(a.data.length<=48||1!==a.type&&5!==a.type||(this.decryptAvcSample(e,t,n,i,a),this.decrypter.isSync())))return}}}}class og{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n,i=this.VideoSample;if((!i||0===i.units.length)&&(i=e[e.length-1]),null!=(t=i)&&t.units){const e=i.units;n=e[e.length-1]}return n}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const n=t.samples,i=n.length;if(!i)return void t.dropped++;{const t=n[i-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}}parseNALu(e,t,n){const i=t.byteLength;let r=e.naluState||0;const a=r,o=[];let s,l,c,u=0,d=-1,h=0;for(-1===r&&(d=0,h=this.getNALuType(t,0),r=0,u=1);u<i;)if(s=t[u++],r)if(1!==r)if(s)if(1===s){if(l=u-r-1,d>=0){const e={data:t.subarray(d,l),type:h};o.push(e)}else{const n=this.getLastNalUnit(e.samples);n&&(a&&u<=4-a&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-a)),l>0&&(n.data=rd(n.data,t.subarray(0,l)),n.state=0))}u<i?(c=this.getNALuType(t,u),d=u,h=c,r=0):r=-1}else r=0;else r=3;else r=s?0:2;else r=s?0:1;if(d>=0&&r>=0){const e={data:t.subarray(d,i),type:h,state:r};o.push(e)}if(0===o.length){const n=this.getLastNalUnit(e.samples);n&&(n.data=rd(n.data,t))}return e.naluState=r,o}}class sg{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,i=new Uint8Array(4),r=Math.min(4,t);if(0===r)throw new Error("no bytes available");i.set(e.subarray(n,n+r)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&Su.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class lg extends og{parsePES(e,t,n,i){const r=this.parseNALu(e,n.data,i);let a,o=this.VideoSample,s=!1;n.data=null,o&&r.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),r.forEach(i=>{var r,l;switch(i.type){case 1:{let t=!1;a=!0;const r=i.data;if(s&&r.length>4){const e=this.readSliceType(r);(2===e||4===e||7===e||9===e)&&(t=!0)}var c;if(t)null!=(c=o)&&c.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null);o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.frame=!0,o.key=t;break}case 5:a=!0,null!=(r=o)&&r.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 6:a=!0,ld(i.data,1,n.pts,t.samples);break;case 7:{var u,d;a=!0,s=!0;const t=i.data,n=this.readSPS(t);if(!e.sps||e.width!==n.width||e.height!==n.height||(null==(u=e.pixelRatio)?void 0:u[0])!==n.pixelRatio[0]||(null==(d=e.pixelRatio)?void 0:d[1])!==n.pixelRatio[1]){e.width=n.width,e.height=n.height,e.pixelRatio=n.pixelRatio,e.sps=[t];const i=t.subarray(1,4);let r="avc1.";for(let e=0;e<3;e++){let t=i[e].toString(16);t.length<2&&(t="0"+t),r+=t}e.codec=r}break}case 8:a=!0,e.pps=[i.data];break;case 9:a=!0,e.audFound=!0,null!=(l=o)&&l.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:a=!0;break;default:a=!1}o&&a&&o.units.push(i)}),i&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return 31&e[t]}readSliceType(e){const t=new sg(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n,i=8,r=8;for(let a=0;a<e;a++)0!==r&&(n=t.readEG(),r=(i+n+256)%256),i=0===r?i:r}readSPS(e){const t=new sg(e);let n,i,r,a=0,o=0,s=0,l=0;const c=t.readUByte.bind(t),u=t.readBits.bind(t),d=t.readUEG.bind(t),h=t.readBoolean.bind(t),f=t.skipBits.bind(t),p=t.skipEG.bind(t),g=t.skipUEG.bind(t),m=this.skipScalingList.bind(this);c();const v=c();if(u(5),f(3),c(),g(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){const e=d();if(3===e&&f(1),g(),g(),f(1),h())for(i=3!==e?8:12,r=0;r<i;r++)h()&&m(r<6?16:64,t)}g();const y=d();if(0===y)d();else if(1===y)for(f(1),p(),p(),n=d(),r=0;r<n;r++)p();g(),f(1);const _=d(),E=d(),b=u(1);0===b&&f(1),f(1),h()&&(a=d(),o=d(),s=d(),l=d());let T=[1,1];if(h()&&h())switch(c()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[c()<<8|c(),c()<<8|c()]}return{width:Math.ceil(16*(_+1)-2*a-2*o),height:(2-b)*(E+1)*16-(b?2:4)*(s+l),pixelRatio:T}}}class cg extends og{constructor(){super(...arguments),this.initVPS=null}parsePES(e,t,n,i){const r=this.parseNALu(e,n.data,i);let a,o=this.VideoSample,s=!1;n.data=null,o&&r.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),r.forEach(i=>{var r,l;switch(i.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),o.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:var c;if(a=!0,s)null!=(c=o)&&c.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null);o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:a=!0,null!=(r=o)&&r.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 39:a=!0,ld(i.data,2,n.pts,t.samples);break;case 32:a=!0,e.vps||("object"!=typeof e.params&&(e.params={}),e.params=pu(e.params,this.readVPS(i.data)),this.initVPS=i.data),e.vps=[i.data];break;case 33:if(a=!0,s=!0,void 0!==e.vps&&e.vps[0]!==this.initVPS&&void 0!==e.sps&&!this.matchSPS(e.sps[0],i.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const t=this.readSPS(i.data);e.width=t.width,e.height=t.height,e.pixelRatio=t.pixelRatio,e.codec=t.codecString,e.sps=[],"object"!=typeof e.params&&(e.params={});for(const n in t.params)e.params[n]=t.params[n]}this.pushParameterSet(e.sps,i.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0;break;case 34:if(a=!0,"object"==typeof e.params){if(!e.pps){e.pps=[];const t=this.readPPS(i.data);for(const n in t)e.params[n]=t[n]}this.pushParameterSet(e.pps,i.data,e.vps)}break;case 35:a=!0,e.audFound=!0,null!=(l=o)&&l.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:a=!1}o&&a&&o.units.push(i)}),i&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(126&e[t])>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let i=0;i<e.byteLength;i++)i>=2&&3===e[i]&&0===e[i-1]&&0===e[i-2]||(t[n]=e[i],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new sg(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);return{numTemporalLayers:t.readBits(3)+1,temporalIdNested:t.readBoolean()}}readSPS(e){const t=new sg(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const i=t.readBits(2),r=t.readBoolean(),a=t.readBits(5),o=t.readUByte(),s=t.readUByte(),l=t.readUByte(),c=t.readUByte(),u=t.readUByte(),d=t.readUByte(),h=t.readUByte(),f=t.readUByte(),p=t.readUByte(),g=t.readUByte(),m=t.readUByte(),v=[],y=[];for(let e=0;e<n;e++)v.push(t.readBoolean()),y.push(t.readBoolean());if(n>0)for(let e=n;e<8;e++)t.readBits(2);for(let e=0;e<n;e++)v[e]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),y[e]&&t.readUByte();t.readUEG();const _=t.readUEG();3==_&&t.skipBits(1);const E=t.readUEG(),b=t.readUEG(),T=t.readBoolean();let S=0,w=0,A=0,R=0;T&&(S+=t.readUEG(),w+=t.readUEG(),A+=t.readUEG(),R+=t.readUEG());const x=t.readUEG(),I=t.readUEG(),L=t.readUEG();for(let e=t.readBoolean()?0:n;e<=n;e++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let e=0;e<4;e++)for(let n=0;n<(3===e?2:6);n++)if(t.readBoolean()){const n=Math.min(64,1<<4+(e<<1));e>1&&t.readEG();for(let e=0;e<n;e++)t.readEG()}else t.readUEG();t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const M=t.readUEG();let C=0;for(let e=0;e<M;e++){let n=!1;if(0!==e&&(n=t.readBoolean()),n){e===M&&t.readUEG(),t.readBoolean(),t.readUEG();let n=0;for(let e=0;e<=C;e++){const e=t.readBoolean();let i=!1;e||(i=t.readBoolean()),(e||i)&&n++}C=n}else{const e=t.readUEG(),n=t.readUEG();C=e+n;for(let n=0;n<e;n++)t.readUEG(),t.readBoolean();for(let e=0;e<n;e++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const e=t.readUEG();for(let n=0;n<e;n++){for(let e=0;e<L+4;e++)t.readBits(1);t.readBits(1)}}let P=0,D=1,O=1,N=!0,k=1,F=0;t.readBoolean(),t.readBoolean();let B=!1;if(t.readBoolean()){if(t.readBoolean()){const e=t.readUByte();e>0&&e<16?(D=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][e-1],O=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][e-1]):255===e&&(D=t.readBits(16),O=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),B=t.readBoolean(),B&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(k=t.readBits(32),F=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const e=t.readBoolean(),i=t.readBoolean();let r=!1;(e||i)&&(r=t.readBoolean(),r&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),r&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let a=0;a<=n;a++){N=t.readBoolean();let n=!1;N||t.readBoolean()?t.readEG():n=t.readBoolean();const a=n?1:t.readUEG()+1;if(e)for(let e=0;e<a;e++)t.readUEG(),t.readUEG(),r&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(i)for(let e=0;e<a;e++)t.readUEG(),t.readUEG(),r&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),P=t.readUEG())}let U=E,V=b;if(T){let e=1,t=1;1===_?e=t=2:2==_&&(e=2),U=E-e*w-e*S,V=b-t*R-t*A}const G=i?["A","B","C"][i]:"",H=o<<24|s<<16|l<<8|c;let j=0;for(let e=0;e<32;e++)j=(j|(H>>e&1)<<31-e)>>>0;let z=j.toString(16);return 1===a&&"2"===z&&(z="6"),{codecString:"hvc1.".concat(G).concat(a,".").concat(z,".").concat(r?"H":"L").concat(m,".B0"),params:{general_tier_flag:r,general_profile_idc:a,general_profile_space:i,general_profile_compatibility_flags:[o,s,l,c],general_constraint_indicator_flags:[u,d,h,f,p,g],general_level_idc:m,bit_depth:x+8,bit_depth_luma_minus8:x,bit_depth_chroma_minus8:I,min_spatial_segmentation_idc:P,chroma_format_idc:_,frame_rate:{fixed:N,fps:F/k}},width:U,height:V,pixelRatio:[D,O]}}readPPS(e){const t=new sg(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const n=t.readBoolean(),i=t.readBoolean();let r=1;return i&&n?r=0:i?r=3:n&&(r=2),{parallelismType:r}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const ug=188;class dg{constructor(e,t,n,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=i,this.videoParser=null}static probe(e,t){const n=dg.syncOffset(e);return n>0&&t.warn("MPEG2-TS detected but first sync word found @ offset ".concat(n)),-1!==n}static syncOffset(e){const t=e.length;let n=Math.min(940,t-ug)+1,i=0;for(;i<n;){let r=!1,a=-1,o=0;for(let s=i;s<t;s+=ug){if(71!==e[s]||t-s!==ug&&71!==e[s+ug]){if(o)return-1;break}if(o++,-1===a&&(a=s,0!==a&&(n=Math.min(a+18612,e.length-ug)+1)),r||(r=0===hg(e,s)),r&&o>1&&(0===a&&o>2||s+ug>n))return a}i++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:ju[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,n,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=dg.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=dg.createTrack("audio",i),this._id3Track=dg.createTrack("id3"),this._txtTrack=dg.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t){let n,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];i||(this.sampleAes=null);const a=this._videoTrack,o=this._audioTrack,s=this._id3Track,l=this._txtTrack;let c=a.pid,u=a.pesData,d=o.pid,h=s.pid,f=o.pesData,p=s.pesData,g=null,m=this.pmtParsed,v=this._pmtId,y=e.length;if(this.remainderData&&(y=(e=rd(this.remainderData,e)).length,this.remainderData=null),y<ug&&!r)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:s,textTrack:l};const _=Math.max(0,dg.syncOffset(e));y-=(y-_)%ug,y<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,y,e.buffer.byteLength-y));let E=0;for(let t=_;t<y;t+=ug)if(71===e[t]){const r=!!(64&e[t+1]),y=hg(e,t);let E;if((48&e[t+3])>>4>1){if(E=t+5+e[t+4],E===t+ug)continue}else E=t+4;switch(y){case c:r&&(u&&(n=vg(u,this.logger))&&(this.readyVideoParser(a.segmentCodec),null!==this.videoParser&&this.videoParser.parsePES(a,l,n,!1)),u={data:[],size:0}),u&&(u.data.push(e.subarray(E,t+ug)),u.size+=t+ug-E);break;case d:if(r){if(f&&(n=vg(f,this.logger)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,n);break;case"mp3":this.parseMPEGPES(o,n);break;case"ac3":this.parseAC3PES(o,n)}f={data:[],size:0}}f&&(f.data.push(e.subarray(E,t+ug)),f.size+=t+ug-E);break;case h:r&&(p&&(n=vg(p,this.logger))&&this.parseID3PES(s,n),p={data:[],size:0}),p&&(p.data.push(e.subarray(E,t+ug)),p.size+=t+ug-E);break;case 0:r&&(E+=e[E]+1),v=this._pmtId=fg(e,E);break;case v:{r&&(E+=e[E]+1);const n=pg(e,E,this.typeSupported,i,this.observer,this.logger);c=n.videoPid,c>0&&(a.pid=c,a.segmentCodec=n.segmentVideoCodec),d=n.audioPid,d>0&&(o.pid=d,o.segmentCodec=n.segmentAudioCodec),h=n.id3Pid,h>0&&(s.pid=h),null!==g&&!m&&(this.logger.warn("MPEG-TS PMT found at ".concat(t," after unknown PID '").concat(g,"'. Backtracking to sync byte @").concat(_," to parse all TS packets.")),g=null,t=_-188),m=this.pmtParsed=!0;break}case 17:case 8191:break;default:g=y}}else E++;E>0&&gg(this.observer,new Error("Found ".concat(E," TS packet/s that do not start with 0x47")),void 0,this.logger),a.pesData=u,o.pesData=f,s.pesData=p;const b={audioTrack:o,videoTrack:a,id3Track:s,textTrack:l};return r&&this.extractRemainingSamples(b),b}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:i,textTrack:r}=e,a=n.pesData,o=t.pesData,s=i.pesData;let l;if(a&&(l=vg(a,this.logger))?(this.readyVideoParser(n.segmentCodec),null!==this.videoParser&&(this.videoParser.parsePES(n,r,l,!0),n.pesData=null)):n.pesData=a,o&&(l=vg(o,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l)}t.pesData=null}else null!=o&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;s&&(l=vg(s,this.logger))?(this.parseID3PES(i,l),i.pesData=null):i.pesData=s}demuxSampleAes(e,t,n){const i=this.demux(e,n,!0,!this.config.progressive),r=this.sampleAes=new ag(this.observer,this.config,t);return this.decrypt(i,r)}readyVideoParser(e){null===this.videoParser&&("avc"===e?this.videoParser=new lg:"hevc"===e&&(this.videoParser=new cg))}decrypt(e,t){return new Promise(n=>{const{audioTrack:i,videoTrack:r}=e;i.samples&&"aac"===i.segmentCodec?t.decryptAacSamples(i.samples,0,()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,()=>{n(e)}):n(e)}):r.samples&&t.decryptAvcSamples(r.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const i=this.aacOverFlow;let r,a,o,s=t.data;if(i){this.aacOverFlow=null;const t=i.missing,r=i.sample.unit.byteLength;if(-1===t)s=rd(i.sample.unit,s);else{const a=r-t;i.sample.unit.set(s.subarray(0,t),a),e.samples.push(i.sample),n=i.missing}}for(r=n,a=s.length;r<a-1&&!xp(s,r);r++);if(r!==n){let e;const t=r<a-1;if(e=t?"AAC PES did not start with ADTS header,offset:".concat(r):"No ADTS header found in AAC PES",gg(this.observer,new Error(e),t,this.logger),!t)return}if(Lp(e,this.observer,s,r,this.audioCodec),void 0!==t.pts)o=t.pts;else{if(!i)return void this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=Mp(e.samplerate);o=i.sample.pts+t}}let l,c=0;for(;r<a;){if(l=Cp(e,s,r,o,c),r+=l.length,l.missing){this.aacOverFlow=l;break}for(c++;r<a-1&&!xp(s,r);r++);}}parseMPEGPES(e,t){const n=t.data,i=n.length;let r=0,a=0;const o=t.pts;if(void 0!==o)for(;a<i;)if($p(n,a)){const t=Xp(e,n,a,o,r);if(!t)break;a+=t.length,r++}else a++;else this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(e,t){{const n=t.data,i=t.pts;if(void 0===i)return void this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");const r=n.length;let a,o=0,s=0;for(;s<r&&(a=ng(e,n,s,i,o++))>0;)s+=a}}parseID3PES(e,t){if(void 0===t.pts)return void this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");const n=pu({},t,{type:this._videoTrack?Gp.emsg:Gp.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function hg(e,t){return((31&e[t+1])<<8)+e[t+2]}function fg(e,t){return(31&e[t+10])<<8|e[t+11]}function pg(e,t,n,i,r,a){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},s=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<s;){const s=hg(e,t),l=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!i){mg("ADTS AAC",a);break}case 15:-1===o.audioPid&&(o.audioPid=s);break;case 21:-1===o.id3Pid&&(o.id3Pid=s);break;case 219:if(!i){mg("H.264",a);break}case 27:-1===o.videoPid&&(o.videoPid=s);break;case 3:case 4:n.mpeg||n.mp3?-1===o.audioPid&&(o.audioPid=s,o.segmentAudioCodec="mp3"):a.log("MPEG audio found, not supported in this browser");break;case 193:if(!i){mg("AC-3",a);break}case 129:n.ac3?-1===o.audioPid&&(o.audioPid=s,o.segmentAudioCodec="ac3"):a.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===o.audioPid&&l>0){let i=t+5,r=l;for(;r>2;){if(106===e[i])!0!==n.ac3?a.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=s,o.segmentAudioCodec="ac3");const t=e[i+1]+2;i+=t,r-=t}}break;case 194:case 135:return gg(r,new Error("Unsupported EC-3 in M2TS found"),void 0,a),o;case 36:-1===o.videoPid&&(o.videoPid=s,o.segmentVideoCodec="hevc",a.log("HEVC in M2TS found"))}t+=l+5}return o}function gg(e,t,n,i){i.warn("parsing error: ".concat(t.message)),e.emit(au.ERROR,au.ERROR,{type:iu.MEDIA_ERROR,details:ru.FRAG_PARSING_ERROR,fatal:!1,levelRetry:n,error:t,reason:t.message})}function mg(e,t){t.log("".concat(e," with AES-128-CBC encryption found in unencrypted stream"))}function vg(e,t){let n,i,r,a,o,s=0;const l=e.data;if(!e||0===e.size)return null;for(;l[0].length<19&&l.length>1;)l[0]=rd(l[0],l[1]),l.splice(1,1);if(n=l[0],(n[0]<<16)+(n[1]<<8)+n[2]===1){if(i=(n[4]<<8)+n[5],i&&i>e.size-6)return null;const c=n[7];192&c&&(a=536870912*(14&n[9])+4194304*(255&n[10])+16384*(254&n[11])+128*(255&n[12])+(254&n[13])/2,64&c?(o=536870912*(14&n[14])+4194304*(255&n[15])+16384*(254&n[16])+128*(255&n[17])+(254&n[18])/2,a-o>54e5&&(t.warn("".concat(Math.round((a-o)/9e4),"s delta between PTS and DTS, align them")),a=o)):o=a),r=n[8];let u=r+9;if(e.size<=u)return null;e.size-=u;const d=new Uint8Array(e.size);for(let e=0,t=l.length;e<t;e++){n=l[e];let t=n.byteLength;if(u){if(u>t){u-=t;continue}n=n.subarray(u),t-=u,u=0}d.set(n,s),s+=t}return i&&(i-=r+3),{data:d,pts:a,dts:o,len:i}}return null}class yg{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const _g=Math.pow(2,32)-1;class Eg{static init(){let e;for(e in Eg.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},Eg.types)Eg.types.hasOwnProperty(e)&&(Eg.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Eg.HDLR_TYPES={video:t,audio:n};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);Eg.STTS=Eg.STSC=Eg.STCO=r,Eg.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Eg.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Eg.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Eg.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),s=new Uint8Array([0,0,0,1]);Eg.FTYP=Eg.box(Eg.types.ftyp,a,s,a,o),Eg.DINF=Eg.box(Eg.types.dinf,Eg.box(Eg.types.dref,i))}static box(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];let r=8,a=n.length;const o=a;for(;a--;)r+=n[a].byteLength;const s=new Uint8Array(r);for(s[0]=r>>24&255,s[1]=r>>16&255,s[2]=r>>8&255,s[3]=255&r,s.set(e,4),a=0,r=8;a<o;a++)s.set(n[a],r),r+=n[a].byteLength;return s}static hdlr(e){return Eg.box(Eg.types.hdlr,Eg.HDLR_TYPES[e])}static mdat(e){return Eg.box(Eg.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(_g+1)),i=Math.floor(t%(_g+1));return Eg.box(Eg.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))}static mdia(e){return Eg.box(Eg.types.mdia,Eg.mdhd(e.timescale||0,e.duration||0),Eg.hdlr(e.type),Eg.minf(e))}static mfhd(e){return Eg.box(Eg.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?Eg.box(Eg.types.minf,Eg.box(Eg.types.smhd,Eg.SMHD),Eg.DINF,Eg.stbl(e)):Eg.box(Eg.types.minf,Eg.box(Eg.types.vmhd,Eg.VMHD),Eg.DINF,Eg.stbl(e))}static moof(e,t,n){return Eg.box(Eg.types.moof,Eg.mfhd(e),Eg.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=Eg.trak(e[t]);return Eg.box.apply(null,[Eg.types.moov,Eg.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(Eg.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=Eg.trex(e[t]);return Eg.box.apply(null,[Eg.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(_g+1)),i=Math.floor(t%(_g+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Eg.box(Eg.types.mvhd,r)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let i,r;for(i=0;i<t.length;i++)r=t[i].flags,n[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return Eg.box(Eg.types.sdtp,n)}static stbl(e){return Eg.box(Eg.types.stbl,Eg.stsd(e),Eg.box(Eg.types.stts,Eg.STTS),Eg.box(Eg.types.stsc,Eg.STSC),Eg.box(Eg.types.stsz,Eg.STSZ),Eg.box(Eg.types.stco,Eg.STCO))}static avc1(e){let t,n,i,r=[],a=[];for(t=0;t<e.sps.length;t++)n=e.sps[t],i=n.byteLength,r.push(i>>>8&255),r.push(255&i),r=r.concat(Array.prototype.slice.call(n));for(t=0;t<e.pps.length;t++)n=e.pps[t],i=n.byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(n));const o=Eg.box(Eg.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|e.sps.length].concat(r).concat([e.pps.length]).concat(a))),s=e.width,l=e.height,c=e.pixelRatio[0],u=e.pixelRatio[1];return Eg.box(Eg.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,s>>8&255,255&s,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,Eg.box(Eg.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Eg.box(Eg.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,u>>24,u>>16&255,u>>8&255,255&u])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static mp4a(e){return Eg.box(Eg.types.mp4a,Eg.audioStsd(e),Eg.box(Eg.types.esds,Eg.esds(e)))}static mp3(e){return Eg.box(Eg.types[".mp3"],Eg.audioStsd(e))}static ac3(e){return Eg.box(Eg.types["ac-3"],Eg.audioStsd(e),Eg.box(Eg.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if("audio"===e.type){if("aac"===t)return Eg.box(Eg.types.stsd,Eg.STSD,Eg.mp4a(e));if("ac3"===t&&e.config)return Eg.box(Eg.types.stsd,Eg.STSD,Eg.ac3(e));if("mp3"===t&&"mp3"===e.codec)return Eg.box(Eg.types.stsd,Eg.STSD,Eg.mp3(e))}else{if(!e.pps||!e.sps)throw new Error("video track missing pps or sps");if("avc"===t)return Eg.box(Eg.types.stsd,Eg.STSD,Eg.avc1(e));if("hevc"===t&&e.vps)return Eg.box(Eg.types.stsd,Eg.STSD,Eg.hvc1(e))}throw new Error("unsupported ".concat(e.type," segment codec (").concat(t,"/").concat(e.codec,")"))}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),i=e.width||0,r=e.height||0,a=Math.floor(n/(_g+1)),o=Math.floor(n%(_g+1));return Eg.box(Eg.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,r>>8&255,255&r,0,0]))}static traf(e,t){const n=Eg.sdtp(e),i=e.id,r=Math.floor(t/(_g+1)),a=Math.floor(t%(_g+1));return Eg.box(Eg.types.traf,Eg.box(Eg.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),Eg.box(Eg.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,a>>24,a>>16&255,a>>8&255,255&a])),Eg.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,Eg.box(Eg.types.trak,Eg.tkhd(e),Eg.mdia(e))}static trex(e){const t=e.id;return Eg.box(Eg.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],i=n.length,r=12+16*i,a=new Uint8Array(r);let o,s,l,c,u,d;for(t+=8+r,a.set(["video"===e.type?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),o=0;o<i;o++)s=n[o],l=s.duration,c=s.size,u=s.flags,d=s.cts,a.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,c>>>24&255,c>>>16&255,c>>>8&255,255&c,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.paddingValue<<1|u.isNonSync,61440&u.degradPrio,15&u.degradPrio,d>>>24&255,d>>>16&255,d>>>8&255,255&d],12+16*o);return Eg.box(Eg.types.trun,a)}static initSegment(e){Eg.types||Eg.init();const t=Eg.moov(e);return rd(Eg.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),3|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let r=i.length;for(let e=0;e<n.length;e+=1){r+=3;for(let t=0;t<n[e].length;t+=1)r+=2+n[e][t].length}const a=new Uint8Array(r);a.set(i,0),r=i.length;const o=n.length-1;for(let e=0;e<n.length;e+=1){a.set(new Uint8Array([32+e|(e===o?128:0),0,n[e].length]),r),r+=3;for(let t=0;t<n[e].length;t+=1)a.set(new Uint8Array([n[e][t].length>>8,255&n[e][t].length]),r),r+=2,a.set(n[e][t],r),r+=n[e][t].length}const s=Eg.box(Eg.types.hvcC,a),l=e.width,c=e.height,u=e.pixelRatio[0],d=e.pixelRatio[1];return Eg.box(Eg.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,Eg.box(Eg.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Eg.box(Eg.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,d>>24,d>>16&255,d>>8&255,255&d])))}}Eg.types=void 0,Eg.HDLR_TYPES=void 0,Eg.STTS=void 0,Eg.STSC=void 0,Eg.STCO=void 0,Eg.STSZ=void 0,Eg.VMHD=void 0,Eg.SMHD=void 0,Eg.STSD=void 0,Eg.FTYP=void 0,Eg.DINF=void 0;function bg(e,t){const n=e*t*(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1);return arguments.length>3&&void 0!==arguments[3]&&arguments[3]?Math.round(n):n}function Tg(e){return bg(e,1e3,1/9e4,arguments.length>1&&void 0!==arguments[1]&&arguments[1])}let Sg,wg=null,Ag=null;function Rg(e,t,n,i){return{duration:t,size:n,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class xg extends vu{constructor(e,t,n,i){if(super("mp4-remuxer",i),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,null===wg){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);wg=e?parseInt(e[1]):0}if(null===Ag){const e=navigator.userAgent.match(/Safari\/(\d+)/i);Ag=e?parseInt(e[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.log("initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,i=e.reduce((e,i)=>{let r=i.pts,a=r-e;return a<-4294967296&&(t=!0,r=Ig(r,n),a=r-e),a>0?e:r},n);return t&&this.debug("PTS rollover detected"),i}remux(e,t,n,i,r,a,o,s){let l,c,u,d,h,f,p=r,g=r;const m=e.pid>-1,v=t.pid>-1,y=t.samples.length,_=e.samples.length>0,E=o&&y>0||y>1;if((!m||_)&&(!v||E)||this.ISGenerated||o){if(this.ISGenerated){var b,T,S,w;const e=this.videoTrackConfig;(e&&(t.width!==e.width||t.height!==e.height||(null==(b=t.pixelRatio)?void 0:b[0])!==(null==(T=e.pixelRatio)?void 0:T[0])||(null==(S=t.pixelRatio)?void 0:S[1])!==(null==(w=e.pixelRatio)?void 0:w[1]))||!e&&E||null===this.nextAudioTs&&_)&&this.resetInitSegment()}this.ISGenerated||(u=this.generateIS(e,t,r,a));const n=this.isVideoContiguous;let i,o=-1;if(E&&(o=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!n&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,o>0){this.warn("Dropped ".concat(o," out of ").concat(y," video samples due to a missing keyframe"));const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(o),t.dropped+=o,g+=(t.samples[0].pts-e)/t.inputTimeScale,i=g}else-1===o&&(this.warn("No keyframe found out of ".concat(y," video samples")),f=!1);if(this.ISGenerated){if(_&&E){const n=this.getVideoStartPts(t.samples),i=(Ig(e.samples[0].pts,n)-n)/t.inputTimeScale;p+=Math.max(0,i),g+=Math.max(0,-i)}if(_){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),u=this.generateIS(e,t,r,a)),c=this.remuxAudio(e,p,this.isAudioContiguous,a,v||E||s===uu.AUDIO?g:void 0),E){const i=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),u=this.generateIS(e,t,r,a)),l=this.remuxVideo(t,g,n,i)}}else E&&(l=this.remuxVideo(t,g,n,0));l&&(l.firstKeyFrame=o,l.independent=-1!==o,l.firstKeyFramePTS=i)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(h=Lg(n,r,this._initPTS,this._initDTS)),i.samples.length&&(d=Mg(i,r,this._initPTS))),{audio:c,video:l,initSegment:u,independent:f,text:d,id3:h}}generateIS(e,t,n,i){const r=e.samples,a=t.samples,o=this.typeSupported,s={},l=this._initPTS;let c,u,d,h=!l||i,f="audio/mp4",p=-1;if(h&&(c=u=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(f="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}s.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&o.mpeg?new Uint8Array(0):Eg.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(p=e.id,d=e.inputTimeScale,l&&d===l.timescale?h=!1:c=u=r[0].pts-Math.round(d*n))}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,s.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Eg.initSegment([t]),metadata:{width:t.width,height:t.height}},h)if(p=t.id,d=t.inputTimeScale,l&&d===l.timescale)h=!1;else{const e=this.getVideoStartPts(a),t=Math.round(d*n);u=Math.min(u,Ig(a[0].dts,e)-t),c=Math.min(c,e-t)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(s).length)return this.ISGenerated=!0,h?(l&&this.warn("Timestamps at playlist time: ".concat(i?"":"~").concat(n," ").concat(c/d," != initPTS: ").concat(l.baseTime/l.timescale," (").concat(l.baseTime,"/").concat(l.timescale,") trackId: ").concat(l.trackId)),this.log("Found initPTS at playlist time: ".concat(n," offset: ").concat(c/d," (").concat(c,"/").concat(d,") trackId: ").concat(p)),this._initPTS={baseTime:c,timescale:d,trackId:p},this._initDTS={baseTime:u,timescale:d,trackId:p}):c=d=void 0,{tracks:s,initPTS:c,timescale:d,trackId:p}}remuxVideo(e,t,n,i){const r=e.inputTimeScale,a=e.samples,o=[],s=a.length,l=this._initPTS,c=l.baseTime*r/l.timescale;let u,d,h=this.nextVideoTs,f=8,p=this.videoSampleDuration,g=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,v=!1;if(!n||null===h){const e=c+t*r,i=a[0].pts-Ig(a[0].dts,a[0].pts);wg&&null!==h&&Math.abs(e-i-(h+c))<15e3?n=!0:h=e-i-c}const y=h+c;for(let e=0;e<s;e++){const t=a[e];t.pts=Ig(t.pts,y),t.dts=Ig(t.dts,y),t.dts<a[e>0?e-1:e].dts&&(v=!0)}v&&a.sort(function(e,t){const n=e.dts-t.dts,i=e.pts-t.pts;return n||i}),u=a[0].dts,d=a[a.length-1].dts;const _=d-u,E=_?Math.round(_/(s-1)):p||e.inputTimeScale/30;if(n){const n=u-y,i=n>E,r=n<-1;if((i||r)&&(i?this.warn("".concat((e.segmentCodec||"").toUpperCase(),": ").concat(Tg(n,!0)," ms (").concat(n,"dts) hole between fragments detected at ").concat(t.toFixed(3))):this.warn("".concat((e.segmentCodec||"").toUpperCase(),": ").concat(Tg(-n,!0)," ms (").concat(n,"dts) overlapping between fragments detected at ").concat(t.toFixed(3))),!r||y>=a[0].pts||wg)){u=y;const e=a[0].pts-n;if(i)a[0].dts=u,a[0].pts=e;else{let t=!0;for(let i=0;i<a.length&&!(a[i].dts>e&&t);i++){const e=a[i].pts;if(a[i].dts-=n,a[i].pts-=n,i<a.length-1){const n=a[i+1].pts;t=n<=a[i].pts==n<=e}}}this.log("Video: Initial PTS/DTS adjusted: ".concat(Tg(e,!0),"/").concat(Tg(u,!0),", delta: ").concat(Tg(n,!0)," ms"))}}u=Math.max(0,u);let b=0,T=0,S=u;for(let e=0;e<s;e++){const t=a[e],n=t.units,i=n.length;let r=0;for(let e=0;e<i;e++)r+=n[e].data.length;T+=r,b+=i,t.length=r,t.dts<S?(t.dts=S,S+=E/4|0||1):S=t.dts,g=Math.min(t.pts,g),m=Math.max(t.pts,m)}d=a[s-1].dts;const w=T+4*b+8;let A;try{A=new Uint8Array(w)}catch(e){return void this.observer.emit(au.ERROR,au.ERROR,{type:iu.MUX_ERROR,details:ru.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:w,reason:"fail allocating video mdat ".concat(w)})}const R=new DataView(A.buffer);R.setUint32(0,w),A.set(Eg.types.mdat,4);let x=!1,I=Number.POSITIVE_INFINITY,L=Number.POSITIVE_INFINITY,M=Number.NEGATIVE_INFINITY,C=Number.NEGATIVE_INFINITY;for(let e=0;e<s;e++){const t=a[e],n=t.units;let l,u=0;for(let e=0,t=n.length;e<t;e++){const t=n[e],i=t.data,r=t.data.byteLength;R.setUint32(f,r),f+=4,A.set(i,f),f+=r,u+=4+r}if(e<s-1)p=a[e+1].dts-t.dts,l=a[e+1].pts-t.pts;else{const n=this.config,o=e>0?t.dts-a[e-1].dts:E;if(l=e>0?t.pts-a[e-1].pts:E,n.stretchShortVideoTrack&&null!==this.nextAudioTs){const e=Math.floor(n.maxBufferHole*r),a=(i?g+i*r:this.nextAudioTs+c)-t.pts;a>e?(p=a-o,p<0?p=o:x=!0,this.log("It is approximately ".concat(a/90," ms to the next segment; using duration ").concat(p/90," ms for the last video frame."))):p=o}else p=o}const d=Math.round(t.pts-t.dts);I=Math.min(I,p),M=Math.max(M,p),L=Math.min(L,l),C=Math.max(C,l),o.push(Rg(t.key,p,u,d))}if(o.length)if(wg){if(wg<70){const e=o[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(Ag&&C-L<M-I&&E/M<.025&&0===o[0].cts){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=u;for(let t=0,n=o.length;t<n;t++){const i=e+o[t].duration,r=e+o[t].cts;if(t<n-1){const e=i+o[t+1].cts;o[t].duration=e-r}else o[t].duration=t?o[t-1].duration:E;o[t].cts=0,e=i}}p=x||!p?E:p;const P=d+p;this.nextVideoTs=h=P-c,this.videoSampleDuration=p,this.isVideoContiguous=!0;const D={data1:Eg.moof(e.sequenceNumber++,u,pu(e,{samples:o})),data2:A,startPTS:(g-c)/r,endPTS:(m+p-c)/r,startDTS:(u-c)/r,endDTS:h/r,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,D}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(e,t,n,i,r){const a=e.inputTimeScale,o=a/(e.samplerate?e.samplerate:a),s=this.getSamplesPerFrame(e),l=s*o,c=this._initPTS,u="mp3"===e.segmentCodec&&this.typeSupported.mpeg,d=[],h=void 0!==r;let f=e.samples,p=u?0:8,g=this.nextAudioTs||-1;const m=c.baseTime*a/c.timescale,v=m+t*a;if(this.isAudioContiguous=n=n||f.length&&g>0&&(i&&Math.abs(v-(g+m))<9e3||Math.abs(Ig(f[0].pts,v)-(g+m))<20*l),f.forEach(function(e){e.pts=Ig(e.pts,v)}),!n||g<0){if(f=f.filter(e=>e.pts>=0),!f.length)return;g=0===r?0:i&&!h?Math.max(0,v-m):f[0].pts-m}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let n=0,i=g+m;n<f.length;n++){const r=f[n],o=r.pts,s=o-i,c=Math.abs(1e3*s/a);if(s<=-t*l&&h)0===n&&(this.warn("Audio frame @ ".concat((o/a).toFixed(3),"s overlaps marker by ").concat(Math.round(1e3*s/a)," ms.")),this.nextAudioTs=g=o-m,i=o);else if(s>=t*l&&c<1e4&&h){let t=Math.round(s/l);for(i=o-t*l;i<0&&t&&l;)t--,i+=l;0===n&&(this.nextAudioTs=g=i-m),this.warn("Injecting ".concat(t," audio frames @ ").concat(((i-m)/a).toFixed(3),"s due to ").concat(Math.round(1e3*s/a)," ms gap."));for(let a=0;a<t;a++){let t=yg.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);t||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),t=r.unit.subarray()),f.splice(n,0,{unit:t,pts:i}),i+=l,n++}}r.pts=i,i+=l}}let y,_=null,E=null,b=0,T=f.length;for(;T--;)b+=f[T].unit.byteLength;for(let t=0,i=f.length;t<i;t++){const i=f[t],r=i.unit;let a=i.pts;if(null!==E){d[t-1].duration=Math.round((a-E)/o)}else{if(n&&"aac"===e.segmentCodec&&(a=g+m),_=a,!(b>0))return;b+=p;try{y=new Uint8Array(b)}catch(e){return void this.observer.emit(au.ERROR,au.ERROR,{type:iu.MUX_ERROR,details:ru.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:b,reason:"fail allocating audio mdat ".concat(b)})}u||(new DataView(y.buffer).setUint32(0,b),y.set(Eg.types.mdat,4))}y.set(r,p);const l=r.byteLength;p+=l,d.push(Rg(!0,s,l,0)),E=a}const S=d.length;if(!S)return;const w=d[d.length-1];g=E-m,this.nextAudioTs=g+o*w.duration;const A=u?new Uint8Array(0):Eg.moof(e.sequenceNumber++,_/o,pu({},e,{samples:d}));e.samples=[];const R=(_-m)/a,x=g/a,I={data1:A,data2:y,startPTS:R,endPTS:x,startDTS:R,endDTS:x,type:"audio",hasAudio:!0,hasVideo:!1,nb:S};return this.isAudioContiguous=!0,I}}function Ig(e,t){let n;if(null===t)return e;for(n=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=n;return e}function Lg(e,t,n,i){const r=e.samples.length;if(!r)return;const a=e.inputTimeScale;for(let o=0;o<r;o++){const r=e.samples[o];r.pts=Ig(r.pts-n.baseTime*a/n.timescale,t*a)/a,r.dts=Ig(r.dts-i.baseTime*a/i.timescale,t*a)/a}const o=e.samples;return e.samples=[],{samples:o}}function Mg(e,t,n){const i=e.samples.length;if(!i)return;const r=e.inputTimeScale;for(let a=0;a<i;a++){const i=e.samples[a];i.pts=Ig(i.pts-n.baseTime*r/n.timescale,t*r)/r}e.samples.sort((e,t)=>e.pts-t.pts);const a=e.samples;return e.samples=[],{samples:a}}function Cg(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return void 0!==(null==e?void 0:e.start)?(e.start+(n?e.duration:0))/e.timescale:t}function Pg(e,t,n){const i=e.codec;return i&&i.length>4?i:t===Du?"ec-3"===i||"ac-3"===i||"alac"===i?i:"fLaC"===i||"Opus"===i?Td(i,!1):(n.warn('Unhandled audio codec "'.concat(i,'" in mp4 MAP')),i||"mp4a"):(n.warn('Unhandled video codec "'.concat(i,'" in mp4 MAP')),i||"avc1")}try{Sg=self.performance.now.bind(self.performance)}catch(e){Sg=Date.now}const Dg=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,i){const r=this.videoTrack=Hp("video",1),a=this.audioTrack=Hp("audio",1),o=this.txtTrack=Hp("text",1);if(this.id3Track=Hp("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const s=Qu(e);if(s.video){const{id:e,timescale:t,codec:n,supplemental:i}=s.video;r.id=e,r.timescale=o.timescale=t,r.codec=n,r.supplemental=i}if(s.audio){const{id:e,timescale:t,codec:n}=s.audio;a.id=e,a.timescale=t,a.codec=n}o.id=ju.text,r.sampleDuration=0,r.duration=a.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return function(e){const t=e.byteLength;for(let n=0;n<t;){const i=qu(e,n);if(i>8&&109===e[n+4]&&111===e[n+5]&&111===e[n+6]&&102===e[n+7])return!0;n=i>1?n+i:t}return!1}(e)}demux(e,t){this.timeOffset=t;let n=e;const i=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=rd(this.remainderData,e));const t=function(e){const t={valid:null,remainder:null},n=Ku(e,["moof"]);if(n.length<2)return t.remainder=e,t;const i=n[n.length-1];return t.valid=e.slice(0,i.byteOffset-8),t.remainder=e.slice(i.byteOffset-8),t}(n);this.remainderData=t.remainder,i.samples=t.valid||new Uint8Array}else i.samples=n;const a=this.extractID3Track(i,t);return r.samples=ad(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return n.samples=ad(e,t),{videoTrack:t,audioTrack:Hp(),id3Track:i,textTrack:Hp()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const i=Ku(e.samples,["emsg"]);i&&i.forEach(e=>{const i=function(e){const t=e[0];let n="",i="",r=0,a=0,o=0,s=0,l=0,c=0;if(0===t){for(;"\0"!==zu(e.subarray(c,c+1));)n+=zu(e.subarray(c,c+1)),c+=1;for(n+=zu(e.subarray(c,c+1)),c+=1;"\0"!==zu(e.subarray(c,c+1));)i+=zu(e.subarray(c,c+1)),c+=1;i+=zu(e.subarray(c,c+1)),c+=1,r=qu(e,12),a=qu(e,16),s=qu(e,20),l=qu(e,24),c=28}else if(1===t){c+=4,r=qu(e,c),c+=4;const t=qu(e,c);c+=4;const a=qu(e,c);for(c+=4,o=2**32*t+a,tu(o)||(o=Number.MAX_SAFE_INTEGER,Su.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),s=qu(e,c),c+=4,l=qu(e,c),c+=4;"\0"!==zu(e.subarray(c,c+1));)n+=zu(e.subarray(c,c+1)),c+=1;for(n+=zu(e.subarray(c,c+1)),c+=1;"\0"!==zu(e.subarray(c,c+1));)i+=zu(e.subarray(c,c+1)),c+=1;i+=zu(e.subarray(c,c+1)),c+=1}return{schemeIdUri:n,value:i,timeScale:r,presentationTime:o,presentationTimeDelta:a,eventDuration:s,id:l,payload:e.subarray(c,e.byteLength)}}(e);if(ig.test(i.schemeIdUri)){const e=rg(i,t);let r=4294967295===i.eventDuration?Number.POSITIVE_INFINITY:i.eventDuration/i.timeScale;r<=.001&&(r=Number.POSITIVE_INFINITY);const a=i.payload;n.samples.push({data:a,len:a.byteLength,dts:e,pts:e,type:Gp.emsg,duration:r})}else if(this.config.enableEmsgKLVMetadata&&i.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const e=rg(i,t);n.samples.push({data:i.payload,len:i.payload.byteLength,dts:e,pts:e,type:Gp.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}},remux:class extends vu{constructor(e,t,n,i){super("passthrough-remuxer",i),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,i){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,i),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:n,videoCodec:i}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const{audio:r,video:a}=this.initData=Qu(e);if(t)!function(e,t){if(!e||!t)return;const n=t.keyId;n&&t.isCommonEncryption&&Ku(e,["moov","trak"]).forEach(e=>{const t=Ku(e,["mdia","minf","stbl","stsd"])[0].subarray(8);let i=Ku(t,["enca"]);const r=i.length>0;r||(i=Ku(t,["encv"])),i.forEach(e=>{Ku(r?e.subarray(28):e.subarray(78),["sinf"]).forEach(e=>{const t=id(e);if(t){const e=t.subarray(8,24);e.some(e=>0!==e)||(Su.log("[eme] Patching keyId in 'enc".concat(r?"a":"v",">sinf>>tenc' box: ").concat(xu(e)," -> ").concat(xu(n))),t.set(n,8))}})})})}(e,t);else{const e=r||a;null!=e&&e.encrypted&&this.warn('Init segment with encrypted track with has no key ("'.concat(e.codec,'")!'))}r&&(n=Pg(r,Du,this)),a&&(i=Pg(a,Ou,this));const o={};r&&a?o.audiovideo={container:"video/mp4",codec:n+","+i,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:r?o.audio={container:"audio/mp4",codec:n,encrypted:r.encrypted,initSegment:e,id:"audio"}:a?o.video={container:"video/mp4",codec:i,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=o}remux(e,t,n,i,r,a){var o,s;let{initPTS:l,lastEndTime:c}=this;const u={audio:void 0,video:void 0,text:i,id3:n,initSegment:void 0};eu(c)||(c=this.lastEndTime=r||0);const d=t.samples;if(!d.length)return u;const h={initPTS:void 0,timescale:void 0,trackId:void 0};let f=this.initData;if(null!=(o=f)&&o.length||(this.generateInitSegment(d),f=this.initData),null==(s=f)||!s.length)return this.warn("Failed to generate initSegment."),u;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const p=function(e,t,n){const i={},r=Ku(e,["moof","traf"]);for(let e=0;e<r.length;e++){const a=r[e],o=Ku(a,["tfhd"])[0],s=qu(o,4),l=t[s];if(!l)continue;i[s]||(i[s]={start:NaN,duration:0,sampleCount:0,timescale:l.timescale,type:l.type});const c=i[s],u=Ku(a,["tfdt"])[0];if(u){const e=u[0];let t=qu(u,4);1===e&&(t===Gu?n.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(t*=Gu+1,t+=qu(u,8))),eu(t)&&(!eu(c.start)||t<c.start)&&(c.start=t)}const d=l.default,h=qu(o,0)|(null==d?void 0:d.flags);let f=(null==d?void 0:d.duration)||0;8&h&&(f=qu(o,2&h?12:8));const p=Ku(a,["trun"]);let g=c.start||0,m=0,v=f;for(let e=0;e<p.length;e++){const t=p[e],n=qu(t,4),i=c.sampleCount;c.sampleCount+=n;const r=1&t[3],a=4&t[3],o=1&t[2],s=2&t[2],l=4&t[2],u=8&t[2];let d=8,h=n;for(r&&(d+=4),a&&n&&(!(1&t[d+1])&&void 0===c.keyFrameIndex&&(c.keyFrameIndex=i),d+=4,o?(v=qu(t,d),d+=4):v=f,s&&(d+=4),u&&(d+=4),g+=v,m+=v,h--);h--;)o?(v=qu(t,d),d+=4):v=f,s&&(d+=4),l&&(1&t[d+1]||void 0===c.keyFrameIndex&&(c.keyFrameIndex=c.sampleCount-(h+1),c.keyFrameStart=g),d+=4),u&&(d+=4),g+=v,m+=v;!m&&f&&(m+=f*n)}c.duration+=m}if(!Object.keys(i).some(e=>i[e].duration)){let t=1/0,n=0;const r=Ku(e,["sidx"]);for(let e=0;e<r.length;e++){const i=Xu(r[e]);if(null!=i&&i.references){t=Math.min(t,i.earliestPresentationTime/i.timescale);const e=i.references.reduce((e,t)=>e+t.info.duration||0,0);n=Math.max(n,e+i.earliestPresentationTime/i.timescale)}}n&&eu(n)&&Object.keys(i).forEach(e=>{i[e].duration||(i[e].duration=n*i[e].timescale-i[e].start)})}return i}(d,f,this),g=f.audio?p[f.audio.id]:null,m=f.video?p[f.video.id]:null,v=Cg(m,1/0),y=Cg(g,1/0),_=Cg(m,0,!0),E=Cg(g,0,!0);let b=r,T=0;const S=g&&(!m||!l&&y<v||l&&l.trackId===f.audio.id),w=S?g:m;if(w){const e=w.timescale,t=w.start-r*e,n=S?f.audio.id:f.video.id;b=w.start/e,T=S?E-y:_-v,(a||!l)&&(function(e,t,n,i){if(null===e)return!0;const r=Math.max(i,1),a=t-e.baseTime/e.timescale;return Math.abs(a-n)>r}(l,b,r,T)||e!==l.timescale)&&(l&&this.warn("Timestamps at playlist time: ".concat(a?"":"~").concat(r," ").concat(t/e," != initPTS: ").concat(l.baseTime/l.timescale," (").concat(l.baseTime,"/").concat(l.timescale,") trackId: ").concat(l.trackId)),this.log("Found initPTS at playlist time: ".concat(r," offset: ").concat(b-r," (").concat(t,"/").concat(e,") trackId: ").concat(n)),l=null,h.initPTS=t,h.timescale=e,h.trackId=n)}else this.warn("No audio or video samples found for initPTS at playlist time: ".concat(r));l?(h.initPTS=l.baseTime,h.timescale=l.timescale,h.trackId=l.trackId):((!h.timescale||void 0===h.trackId||void 0===h.initPTS)&&(this.warn("Could not set initPTS"),h.initPTS=b,h.timescale=1,h.trackId=-1),this.initPTS=l={baseTime:h.initPTS,timescale:h.timescale,trackId:h.trackId});const A=b-l.baseTime/l.timescale,R=A+T;T>0?this.lastEndTime=R:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const x=!!f.audio,I=!!f.video;let L="";x&&(L+="audio"),I&&(L+="video");const M={data1:d,startPTS:A,startDTS:A,endPTS:R,endDTS:R,type:L,hasAudio:x,hasVideo:I,nb:1,dropped:0,encrypted:!!f.audio&&f.audio.encrypted||!!f.video&&f.video.encrypted};u.audio=x&&!I?M:void 0,u.video=I?M:void 0;const C=null==m?void 0:m.sampleCount;if(C){const e=m.keyFrameIndex,t=-1!==e;M.nb=C,M.dropped=0===e||this.isVideoContiguous?0:t?e:C,M.independent=t,M.firstKeyFrame=e,t&&m.keyFrameStart&&(M.firstKeyFramePTS=(m.keyFrameStart-l.baseTime)/l.timescale),this.isVideoContiguous||(u.independent=t),this.isVideoContiguous||(this.isVideoContiguous=t),M.dropped&&this.warn("fmp4 does not start with IDR: firstIDR ".concat(e,"/").concat(C," dropped: ").concat(M.dropped," start: ").concat(M.firstKeyFramePTS||"NA"))}return u.initSegment=h,u.id3=Lg(n,r,l,l),i.samples.length&&(u.text=Mg(i,r,l)),u}}},{demux:dg,remux:xg},{demux:class extends jp{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=Sp(e,0);let i=(null==n?void 0:n.length)||0;if(eg(e,i))return!1;for(let n=e.length;i<n;i++)if(Ip(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&wp(e,t)&&Rp(e,t)<=e.length-t}(e,t)}appendFrame(e,t,n){Lp(e,this.observer,t,n,e.manifestCodec);const i=Cp(e,t,n,this.basePTS,this.frameIndex);if(i&&0===i.missing)return i}},remux:xg},{demux:class extends jp{resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Sp(e,0);let n=(null==t?void 0:t.length)||0;if(t&&11===e[n]&&119===e[n+1]&&void 0!==Vp(t)&&tg(e,n)<=16)return!1;for(let t=e.length;n<t;n++)if(eg(e,n))return Su.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return Jp(e,t)&&4<=e.length-t}(e,t)}appendFrame(e,t,n){if(null!==this.basePTS)return Xp(e,t,n,this.basePTS,this.frameIndex)}},remux:xg}];Dg.splice(2,0,{demux:class extends jp{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const i=ng(e,t,n,this.basePTS,this.frameIndex);if(-1!==i)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;const t=Sp(e,0);if(!t)return!1;const n=t.length;return 11===e[n]&&119===e[n+1]&&void 0!==Vp(t)&&tg(e,n)<16}},remux:xg});class Og{constructor(e,t,n,i,r,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=r,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,i){const r=n.transmuxing;r.executeStart=Sg();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:s}=this;i&&(this.currentTransmuxState=i);const{contiguous:l,discontinuity:c,trackSwitch:u,accurateTimeOffset:d,timeOffset:h,initSegmentChange:f}=i||o,{audioCodec:p,videoCodec:g,defaultInitPts:m,duration:v,initSegmentData:y}=s,_=function(e,t){let n=null;return e.byteLength>0&&null!=(null==t?void 0:t.key)&&null!==t.iv&&null!=t.method&&(n=t),n}(a,t);if(_&&$h(_.method)){const e=this.getDecrypter(),t=ef(_.method);if(!e.isSync())return this.asyncResult=!0,this.decryptionPromise=e.webCryptoDecrypt(a,_.key.buffer,_.iv.buffer,t).then(e=>{const t=this.push(e,null,n);return this.decryptionPromise=null,t}),this.decryptionPromise;{let i=e.softwareDecrypt(a,_.key.buffer,_.iv.buffer,t);if(n.part>-1){const t=e.flush();i=t&&t.buffer}if(!i)return r.executeEnd=Sg(),Ng(n);a=new Uint8Array(i)}}const E=this.needsProbing(c,u);if(E){const e=this.configureTransmuxer(a);if(e)return this.logger.warn("[transmuxer] ".concat(e.message)),this.observer.emit(au.ERROR,au.ERROR,{type:iu.MEDIA_ERROR,details:ru.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),r.executeEnd=Sg(),Ng(n)}(c||u||f||E)&&this.resetInitSegment(y,p,g,v,t),(c||f||E)&&this.resetInitialTimestamp(m),l||this.resetContiguity();const b=this.transmux(a,_,h,d,n);this.asyncResult=kg(b);const T=this.currentTransmuxState;return T.contiguous=!0,T.discontinuity=!1,T.trackSwitch=!1,r.executeEnd=Sg(),b}flush(e){const t=e.transmuxing;t.executeStart=Sg();const{decrypter:n,currentTransmuxState:i,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then(()=>this.flush(e));const a=[],{timeOffset:o}=i;if(n){const t=n.flush();t&&a.push(this.push(t.buffer,null,e))}const{demuxer:s,remuxer:l}=this;if(!s||!l){t.executeEnd=Sg();const n=[Ng(e)];return this.asyncResult?Promise.resolve(n):n}const c=s.flush(o);return kg(c)?(this.asyncResult=!0,c.then(t=>(this.flushRemux(a,t,e),a))):(this.flushRemux(a,c,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,n){const{audioTrack:i,videoTrack:r,id3Track:a,textTrack:o}=t,{accurateTimeOffset:s,timeOffset:l}=this.currentTransmuxState;this.logger.log("[transmuxer.ts]: Flushed ".concat(this.id," sn: ").concat(n.sn).concat(n.part>-1?" part: "+n.part:""," of ").concat(this.id===uu.MAIN?"level":"track"," ").concat(n.level));const c=this.remuxer.remux(i,r,a,o,l,s,!0,this.id);e.push({remuxResult:c,chunkMeta:n}),n.transmuxing.executeEnd=Sg()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,i,r){const{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,t,n,i),o.resetInitSegment(e,t,n,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,i,r){let a;return a=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,n,i,r):this.transmuxUnencrypted(e,n,i,r),a}transmuxUnencrypted(e,t,n,i){const{audioTrack:r,videoTrack:a,id3Track:o,textTrack:s}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,a,o,s,t,n,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,n,i,r){return this.demuxer.demuxSampleAes(e,t,n).then(e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,n,i,!1,this.id),chunkMeta:r}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:i}=this;let r;for(let t=0,n=Dg.length;t<n;t++){var a;if(null!=(a=Dg[t].demux)&&a.probe(e,this.logger)){r=Dg[t];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,s=this.remuxer,l=r.remux,c=r.demux;(!s||!(s instanceof l))&&(this.remuxer=new l(n,t,i,this.logger)),(!o||!(o instanceof c))&&(this.demuxer=new c(n,t,i,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Lh(this.config)),e}}const Ng=e=>({remuxResult:{},chunkMeta:e});function kg(e){return"then"in e&&e.then instanceof Function}class Fg{constructor(e,t,n,i,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=i,this.defaultInitPts=r||null}}class Bg{constructor(e,t,n,i,r,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=i,this.timeOffset=r,this.initSegmentChange=a}}let Ug=0;class Vg{constructor(e,t,n,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Ug++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=e=>{const t=e.data,n=this.hls;if(n&&null!=t&&t.event&&t.instanceNo===this.instanceNo)switch(t.event){case"init":{var i;const e=null==(i=this.workerContext)?void 0:i.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":n.logger[t.data.logType]&&n.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.part=this.part,t.data.id=this.id,n.trigger(t.event,t.data)}},this.onWorkerError=e=>{if(!this.hls)return;const t=new Error("".concat(e.message,"  (").concat(e.filename,":").concat(e.lineno,")"));this.hls.config.enableWorker=!1,this.hls.logger.warn('Error in "'.concat(this.id,'" Web Worker, fallback to inline')),this.hls.trigger(au.ERROR,{type:iu.OTHER_ERROR,details:ru.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:t})};const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=n,this.onFlush=i;const a=(e,t)=>{(t=t||{}).frag=this.frag||void 0,e===au.ERROR&&(t.parent=this.id,t.part=this.part,this.error=t.error),this.hls.trigger(e,t)};this.observer=new vp,this.observer.on(au.FRAG_DECRYPTED,a),this.observer.on(au.ERROR,a);const o=Rd(r.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const n=this.hls.logger;if(r.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__){try{r.workerPath?(n.log("loading Web Worker ".concat(r.workerPath,' for "').concat(t,'"')),this.workerContext=function(e){const t=_p[e];if(t)return t.clientCount++,t;const n=new self.URL(e,self.location.href).href,i={worker:new self.Worker(n),scriptURL:n,clientCount:1};return _p[e]=i,i}(r.workerPath)):(n.log('injecting Web Worker for "'.concat(t,'"')),this.workerContext=function(){const e=_p[yp];if(e)return e.clientCount++,e;const t=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(".concat(__HLS_WORKER_BUNDLE__.toString(),")(true);")],{type:"text/javascript"}),n=self.URL.createObjectURL(t),i={worker:new self.Worker(n),objectURL:n,clientCount:1};return _p[yp]=i,i}());const{worker:e}=this.workerContext;e.addEventListener("message",this.onWorkerMessage),e.addEventListener("error",this.onWorkerError),e.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:o,id:t,config:jd(r)})}catch(i){n.warn('Error setting up "'.concat(t,'" Web Worker, fallback to inline'),i),this.terminateWorker(),this.error=null,this.transmuxer=new Og(this.observer,o,r,"",t,e.logger)}return}}this.transmuxer=new Og(this.observer,o,r,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Ug++;const t=this.hls.config,n=Rd(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:jd(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),function(e){const t=_p[e||yp];if(t&&1===t.clientCount--){const{worker:n,objectURL:i}=t;delete _p[e||yp],i&&self.URL.revokeObjectURL(i),n.terminate()}}(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,i,r,a,o,s,l,c){var u,d;l.transmuxing.start=self.performance.now();const{instanceNo:h,transmuxer:f}=this,p=a?a.start:r.start,g=r.decryptdata,m=this.frag,v=!(m&&r.cc===m.cc),y=!(m&&l.level===m.level),_=m?l.sn-m.sn:-1,E=this.part?l.part-this.part.index:-1,b=0===_&&l.id>1&&l.id===(null==m?void 0:m.stats.chunkCount),T=!y&&(1===_||0===_&&(1===E||b&&E<=0)),S=self.performance.now();(y||_||0===r.stats.parsing.start)&&(r.stats.parsing.start=S),a&&(E||!T)&&(a.stats.parsing.start=S);const w=!(m&&(null==(u=r.initSegment)?void 0:u.url)===(null==(d=m.initSegment)?void 0:d.url)),A=new Bg(v,T,s,y,p,w);if(!T||v||w){this.hls.logger.log("[transmuxer-interface]: Starting new transmux session for ".concat(r.type," sn: ").concat(l.sn).concat(l.part>-1?" part: "+l.part:""," ").concat(this.id===uu.MAIN?"level":"track",": ").concat(l.level," id: ").concat(l.id,"\n        discontinuity: ").concat(v,"\n        trackSwitch: ").concat(y,"\n        contiguous: ").concat(T,"\n        accurateTimeOffset: ").concat(s,"\n        timeOffset: ").concat(p,"\n        initSegmentChange: ").concat(w));const e=new Fg(n,i,t,o,c);this.configureTransmuxer(e)}if(this.frag=r,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:h,cmd:"demux",data:e,decryptdata:g,chunkMeta:l,state:A},e instanceof ArrayBuffer?[e]:[]);else if(f){const t=f.push(e,g,l,A);kg(t)?t.then(e=>{this.handleTransmuxComplete(e)}).catch(e=>{this.transmuxerError(e,l,"transmuxer-interface push error")}):this.handleTransmuxComplete(t)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const t=n.flush(e);kg(t)?t.then(t=>{this.handleFlushResult(t,e)}).catch(t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")}):this.handleFlushResult(t,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(au.ERROR,{type:iu.MEDIA_ERROR,details:ru.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(e=>{this.handleTransmuxComplete(e)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class Gg extends dp{constructor(e,t,n){super(e,t,n,"audio-stream-controller",uu.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(au.LEVEL_LOADED,this.onLevelLoaded,this),e.on(au.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(au.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(au.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(au.BUFFER_RESET,this.onBufferReset,this),e.on(au.BUFFER_CREATED,this.onBufferCreated,this),e.on(au.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(au.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(au.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(au.FRAG_LOADING,this.onFragLoading,this),e.on(au.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(au.LEVEL_LOADED,this.onLevelLoaded,this),e.off(au.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(au.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(au.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(au.BUFFER_RESET,this.onBufferReset,this),e.off(au.BUFFER_CREATED,this.onBufferCreated,this),e.off(au.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(au.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(au.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(au.FRAG_LOADING,this.onFragLoading,this),e.off(au.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,t){let{frag:n,id:i,initPTS:r,timescale:a,trackId:o}=t;if(i===uu.MAIN){const e=n.cc,t=this.fragCurrent;if(this.initPTS[e]={baseTime:r,timescale:a,trackId:o},this.log("InitPTS for cc: ".concat(e," found from main: ").concat(r/a," (").concat(r,"/").concat(a,") trackId: ").concat(o)),this.mainAnchor=n,this.state===cp){const t=this.waitingData;(!t&&!this.loadingParts||t&&t.frag.cc!==e)&&this.syncWithAnchor(n,null==t?void 0:t.frag)}else!this.hls.hasEnoughToStart&&t&&t.cc!==e?(t.abortRequests(),this.syncWithAnchor(n,t)):this.state===ep&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const i=(null==(n=this.mainFragLoading)?void 0:n.frag)||null;if(t&&(null==i?void 0:i.cc)===t.cc)return;const r=(i||e).cc,a=ih(this.getLevelDetails(),r,this.getLoadPosition());a&&(this.log("Syncing with main frag at ".concat(a.start," cc ").concat(a.cc)),this.startFragRequested=!1,this.nextLoadPosition=a.start,this.resetLoadingState(),this.state===ep&&this.doTickIdle())}startLoad(e,t){if(!this.levels)return this.startPosition=e,void(this.state=$f);const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),n>0&&-1===e?(this.log("Override startPosition with lastCurrentTime @".concat(n.toFixed(3))),e=n,this.state=ep):this.state=rp,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case ep:this.doTickIdle();break;case rp:{const{levels:e,trackId:t}=this,n=null==e?void 0:e[t],i=null==n?void 0:n.details;if(i&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(i))break;this.state=cp}break}case ip:this.checkRetryDate();break;case cp:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:i,complete:r}=e,a=this.mainAnchor;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.state=np;const e={frag:t,part:n,payload:i.flush().buffer,networkDetails:null};this._handleFragmentLoadProgress(e),r&&super._handleFragmentLoadComplete(e)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=ep}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:i,trackId:r}=this,a=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||null==n||!n[r])return;const o=n[r],s=o.details;if(!s||this.waitForLive(o)||this.waitForCdnTuneIn(s))return this.state=rp,void(this.startFragRequested=!1);const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,Du,uu.AUDIO));const c=this.getFwdBufferInfo(l,uu.AUDIO);if(null===c)return;if(!this.switchingTrack&&this._streamEnded(c,s))return t.trigger(au.BUFFER_EOS,{type:"audio"}),void(this.state=sp);const u=c.len,d=t.maxBufferLength,h=s.fragments,f=h[0].start,p=this.getLoadPosition(),g=this.flushing?p:c.end;if(this.switchingTrack&&i){const e=p;s.PTSKnown&&e<f&&(c.end>f||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=f+.05)}if(u>=d&&!this.switchingTrack&&g<h[h.length-1].start)return;let m=this.getNextFragment(g,s);if(m&&this.isLoopLoading(m,g)&&(m=this.getNextFragmentLoopLoading(m,s,c,uu.MAIN,d)),!m)return void(this.bufferFlushed=!0);let v=(null==(e=this.mainFragLoading)?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&v&&Fu(m)&&!m.endList&&(!s.live||!this.loadingParts&&g<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(v)===_h&&(this.mainFragLoading=v=null),v&&Fu(v))){if(m.start>v.end){const e=this.fragmentTracker.getFragAtPos(g,uu.MAIN);e&&e.end>v.end&&(v=e,this.mainFragLoading={frag:e,targetBufferTime:null})}if(m.start>v.end)return}this.loadFragment(m,o,g)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,t){let{audioTracks:n}=t;this.resetTransmuxer(),this.levels=n.map(e=>new Vd(e))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==$f&&(this.setInterval(100),this.state=ep,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(au.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:i}=this,{details:r,id:a,groupId:o,track:s}=t;if(!i)return void this.warn("Audio tracks reset while loading track ".concat(a,' "').concat(s.name,'" of "').concat(o,'"'));const l=this.mainDetails;if(!l||r.endCC>l.endCC||l.expired)return this.cachedTrackLoadedData=t,void(this.state!==$f&&(this.state=rp));this.cachedTrackLoadedData=null,this.log("Audio track ".concat(a,' "').concat(s.name,'" of "').concat(o,'" loaded [').concat(r.startSN,",").concat(r.endSN,"]").concat(r.lastPartSn?"[part-".concat(r.lastPartSn,"-").concat(r.lastPartIndex,"]"):"",",duration:").concat(r.totalduration));const c=i[a];let u=0;if(r.live||null!=(n=c.details)&&n.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;var d;if(c.details)u=this.alignPlaylists(r,c.details,null==(d=this.levelLastLoaded)?void 0:d.details);r.alignedSliding||(Yf(r,l),r.alignedSliding||Kf(r,l),u=r.fragmentStart)}c.details=r,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(l,u),this.hls.trigger(au.AUDIO_TRACK_UPDATED,{details:r,id:a,groupId:t.groupId}),this.state===rp&&!this.waitForCdnTuneIn(r)&&(this.state=ep),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:i,payload:r}=e,{config:a,trackId:o,levels:s}=this;if(!s)return void this.warn("Audio tracks were reset while fragment load was in progress. Fragment ".concat(n.sn," of level ").concat(n.level," will not be buffered"));const l=s[o];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const c=l.details;if(!c)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(n.start);const u=a.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let d=this.transmuxer;d||(d=this.transmuxer=new Vg(this.hls,uu.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[n.cc],f=null==(t=n.initSegment)?void 0:t.data;if(void 0!==h){const e=i?i.index:-1,t=-1!==e,a=new kh(n.level,n.sn,n.stats.chunkCount,r.byteLength,e,t);d.push(r,f,u,"",n,i,c.totalduration,!1,a,h)}else{this.log("Unknown video PTS for cc ".concat(n.cc,", waiting for video PTS before demuxing audio frag ").concat(n.sn," of [").concat(c.startSN," ,").concat(c.endSN,"],track ").concat(o));const{cache:e}=this.waitingData=this.waitingData||{frag:n,part:i,cache:new fp,complete:!1};e.push(new Uint8Array(r)),this.state!==$f&&(this.state=cp)}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===uu.MAIN&&Fu(t.frag)&&(this.mainFragLoading=t,this.state===ep&&this.tick())}onFragBuffered(e,t){const{frag:n,part:i}=t;if(n.type===uu.AUDIO)if(this.fragContextChanged(n))this.warn("Fragment ".concat(n.sn).concat(i?" p: "+i.index:""," of level ").concat(n.level," finished buffering, but was aborted. state: ").concat(this.state,", audioSwitch: ").concat(this.switchingTrack?this.switchingTrack.name:"false"));else{if(Fu(n)){this.fragPrevious=n;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(au.AUDIO_TRACK_SWITCHED,mu({},e)))}this.fragBufferedComplete(n,i),this.media&&this.tick()}else!this.audioOnly&&n.type===uu.MAIN&&!n.elementaryStreams.video&&!n.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null)}onError(e,t){var n;if(t.fatal)this.state=lp;else switch(t.details){case ru.FRAG_GAP:case ru.FRAG_PARSING_ERROR:case ru.FRAG_DECRYPT_ERROR:case ru.FRAG_LOAD_ERROR:case ru.FRAG_LOAD_TIMEOUT:case ru.KEY_LOAD_ERROR:case ru.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(uu.AUDIO,t);break;case ru.AUDIO_TRACK_LOAD_ERROR:case ru.AUDIO_TRACK_LOAD_TIMEOUT:case ru.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===rp&&(null==(n=t.context)?void 0:n.type)===lu&&(this.state=ep);break;case ru.BUFFER_ADD_CODEC_ERROR:case ru.BUFFER_APPEND_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case ru.BUFFER_FULL_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case ru.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushing(e,t){let{type:n}=t;n!==Ou&&(this.flushing=!0)}onBufferFlushed(e,t){let{type:n}=t;if(n!==Ou){this.flushing=!1,this.bufferFlushed=!0,this.state===sp&&(this.state=ep);const e=this.mediaBuffer||this.media;e&&(this.afterBufferFlushed(e,n,uu.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:i}=this,{remuxResult:r,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o)return void this.resetWhenMissingContext(a);const{frag:s,part:l,level:c}=o,{details:u}=c,{audio:d,text:h,id3:f,initSegment:p}=r;if(!this.fragContextChanged(s)&&u){if(this.state=ap,this.switchingTrack&&d&&this.completeAudioSwitch(this.switchingTrack),null!=p&&p.tracks){const e=s.initSegment||s;if(this.unhandledEncryptionError(p,s))return;this._bufferInitSegment(c,p.tracks,e,a),i.trigger(au.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:n,tracks:p.tracks})}if(d){const{startPTS:e,endPTS:t,startDTS:n,endDTS:i}=d;l&&(l.elementaryStreams[Du]={startPTS:e,endPTS:t,startDTS:n,endDTS:i}),s.setElementaryStreamInfo(Du,e,t,n,i),this.bufferFragmentData(d,s,l,a)}if(null!=f&&null!=(t=f.samples)&&t.length){const e=pu({id:n,frag:s,details:u},f);i.trigger(au.FRAG_PARSING_METADATA,e)}if(h){const e=pu({id:n,frag:s,details:u},h);i.trigger(au.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(s)}_bufferInitSegment(e,t,n,i){if(this.state!==ap||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const r=t.audio;r.id=uu.AUDIO;const a=e.audioCodec;this.log("Init audio buffer, container:".concat(r.container,", codecs[level/parsed]=[").concat(a,"/").concat(r.codec,"]")),a&&1===a.split(",").length&&(r.levelCodec=a),this.hls.trigger(au.BUFFER_CODECS,t);const o=r.initSegment;if(null!=o&&o.byteLength){const e={type:"audio",frag:n,part:null,chunkMeta:i,parent:n.type,data:o};this.hls.trigger(au.BUFFER_APPENDING,e)}this.tickImmediate()}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);var r;if(this.switchingTrack||i===mh||i===yh)if(Fu(e))if(null!=(r=t.details)&&r.live&&!this.initPTS[e.cc]){this.log("Waiting for video PTS in continuity counter ".concat(e.cc," of live stream before loading audio fragment ").concat(e.sn," of level ").concat(this.trackId)),this.state=cp;const n=this.mainDetails;n&&n.fragmentStart!==t.details.fragmentStart&&Kf(t.details,n)}else super.loadFragment(e,t,n);else this._loadInitSegment(e,t);else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:i,characteristics:r,audioCodec:a,channels:o}=this.bufferedTrack;Yd({name:t,lang:n,assocLang:i,characteristics:r,audioCodec:a,channels:o},e,Kd)||(Qd(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(au.AUDIO_TRACK_SWITCHED,mu({},e))}}class Hg extends vu{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const i=null==t?void 0:t.renditionReports;if(i){let r=-1;for(let n=0;n<i.length;n++){const a=i[n];let o;try{o=new self.URL(a.URI,t.url).href}catch(e){this.warn("Could not construct new URL for Rendition Report: ".concat(e)),o=a.URI||""}if(o===e){r=n;break}o===e.substring(0,o.length)&&(r=n)}if(-1!==r){const e=i[r],a=parseInt(e["LAST-MSN"])||t.lastPartSn;let o=parseInt(e["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);o>=0&&e>t.partTarget&&(o+=1)}const s=n&&Bd(n);return new Ud(a,o>=0?o:void 0,s)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: ".concat(e))}return e}playlistLoaded(e,t,n){const{details:i,stats:r}=t,a=self.performance.now(),o=r.loading.first?Math.max(0,a-r.loading.first):0;i.advancedDateTime=Date.now()-o;const s=this.hls.config.timelineOffset;if(s!==i.appliedTimelineOffset){const e=Math.max(s||0,0);i.appliedTimelineOffset=e,i.fragments.forEach(t=>{t.setStart(t.playlistOffset+e)})}if(i.live||null!=n&&n.live){const s="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(n),n&&i.fragments.length>0){Of(n,i,this);const e=i.playlistParsingError;if(e){this.warn(e);const n=this.hls;if(!n.config.ignorePlaylistParsingErrors){var l;const{networkDetails:a}=t;return void n.trigger(au.ERROR,{type:iu.NETWORK_ERROR,details:ru.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:e,reason:e.message,level:t.level||void 0,parent:null==(l=i.fragments[0])?void 0:l.type,networkDetails:a,stats:r})}i.playlistParsingError=null}}-1===i.requestScheduled&&(i.requestScheduled=r.loading.start);const c=this.hls.mainForwardBufferInfo,u=c?c.end-c.len:0,d=Bf(i,1e3*(i.edge-u));if(i.requestScheduled+d<a?i.requestScheduled=a:i.requestScheduled+=d,this.log("live playlist ".concat(e," ").concat(i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED")),!this.canLoad||!i.live)return;let h,f,p;if(i.canBlockReload&&i.endSN&&i.advanced){const e=this.hls.config.lowLatencyMode,r=i.lastPartSn,o=i.endSN,l=i.lastPartIndex,c=r===o;-1!==l?c?(f=o+1,p=e?0:l):(f=r,p=e?l+1:i.maxPartIndex):f=o+1;const u=i.age,d=u+i.ageHeader;let g=Math.min(d-i.partTarget,1.5*i.targetduration);if(g>0){if(d>3*i.targetduration)this.log("Playlist last advanced ".concat(u.toFixed(2),"s ago. Omitting segment and part directives.")),f=void 0,p=void 0;else if(null!=n&&n.tuneInGoal&&d-i.partTarget>n.tuneInGoal)this.warn("CDN Tune-in goal increased from: ".concat(n.tuneInGoal," to: ").concat(g," with playlist age: ").concat(i.age)),g=0;else{const e=Math.floor(g/i.targetduration);if(f+=e,void 0!==p){p+=Math.round(g%i.targetduration/i.partTarget)}this.log("CDN Tune-in age: ".concat(i.ageHeader,"s last advanced ").concat(u.toFixed(2),"s goal: ").concat(g," skip sn ").concat(e," to part ").concat(p))}i.tuneInGoal=g}if(h=this.getDeliveryDirectives(i,t.deliveryDirectives,f,p),e||!c)return i.requestScheduled=a,void this.loadingPlaylist(s,h)}else(i.canBlockReload||i.canSkipUntil)&&(h=this.getDeliveryDirectives(i,t.deliveryDirectives,f,p));h&&void 0!==f&&i.canBlockReload&&(i.requestScheduled=r.loading.first+Math.max(d-2*o,d/2)),this.scheduleLoading(s,h,i)}else this.clearTimer()}scheduleLoading(e,t,n){const i=n||e.details;if(!i)return void this.loadingPlaylist(e,t);const r=self.performance.now(),a=i.requestScheduled;if(r>=a)return void this.loadingPlaylist(e,t);const o=a-r;this.log("reload live playlist ".concat(e.name||e.bitrate+"bps"," in ").concat(Math.round(o)," ms")),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),o)}getDeliveryDirectives(e,t,n,i){let r=Bd(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,i=t.part,r=Fd.No),new Ud(n,i,r)}checkRetry(e){const t=e.details,n=rh(e),i=e.errorAction,{action:r,retryCount:a=0,retryConfig:o}=i||{},s=!!i&&!!o&&(r===hh.RetryRequest||!i.resolved&&r===hh.SendAlternateToPenaltyBox);if(s){var l;if(a>=o.maxNumRetry)return!1;if(n&&null!=(l=e.context)&&l.deliveryDirectives)this.warn("Retrying playlist loading ".concat(a+1,"/").concat(o.maxNumRetry,' after "').concat(t,'" without delivery-directives')),this.loadPlaylist();else{const e=lh(o,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),e),this.warn("Retrying playlist loading ".concat(a+1,"/").concat(o.maxNumRetry,' after "').concat(t,'" in ').concat(e,"ms"))}e.levelRetry=!0,i.resolved=!0}return s}}function jg(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!zg(e[n].attrs,t[n].attrs))return!1;return!0}function zg(e,t,n){const i=e["STABLE-RENDITION-ID"];return i&&!n?i===t["STABLE-RENDITION-ID"]:!(n||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>e[n]!==t[n])}function Zg(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}class qg extends Hg{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(au.MANIFEST_LOADING,this.onManifestLoading,this),e.on(au.MANIFEST_PARSED,this.onManifestParsed,this),e.on(au.LEVEL_LOADING,this.onLevelLoading,this),e.on(au.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(au.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(au.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(au.MANIFEST_LOADING,this.onManifestLoading,this),e.off(au.MANIFEST_PARSED,this.onManifestParsed,this),e.off(au.LEVEL_LOADING,this.onLevelLoading,this),e.off(au.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(au.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(au.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:i,details:r}=t,a=this.tracksInGroup[n];if(!a||a.groupId!==i)return void this.warn("Audio track with id:".concat(n," and group:").concat(i," not found in active group ").concat(null==a?void 0:a.groupId));const o=a.details;a.details=t.details,this.log("Audio track ".concat(n,' "').concat(a.name,'" lang:').concat(a.lang," group:").concat(i," loaded [").concat(r.startSN,"-").concat(r.endSN,"]")),n===this.trackId&&this.playlistLoaded(n,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,i=this.groupIds;let r=this.currentTrack;if(!n||(null==i?void 0:i.length)!==(null==n?void 0:n.length)||null!=n&&n.some(e=>-1===(null==i?void 0:i.indexOf(e)))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!n||-1!==n.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.audioPreference;if(!r&&t){const n=Wd(t,e,Kd);if(n>-1)r=e[n];else{const e=Wd(t,this.tracks);r=this.tracks[e]}}let i=this.findTrackId(r);-1===i&&r&&(i=this.findTrackId(null));const o={audioTracks:e};this.log("Updating audio tracks, ".concat(e.length," track(s) found in group(s): ").concat(null==n?void 0:n.join(","))),this.hls.trigger(au.AUDIO_TRACKS_UPDATED,o);const s=this.trackId;if(-1!==i&&-1===s)this.setAudioTrack(i);else if(e.length&&-1===s){var a;const t=new Error("No audio track selected for current audio group-ID(s): ".concat(null==(a=this.groupIds)?void 0:a.join(",")," track count: ").concat(e.length));this.warn(t.message),this.hls.trigger(au.ERROR,{type:iu.MEDIA_ERROR,details:ru.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}}onError(e,t){t.fatal||!t.context||t.context.type===lu&&t.context.id===this.trackId&&(!this.groupIds||-1!==this.groupIds.indexOf(t.context.groupId))&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const i=this.currentTrack;if(i&&Yd(e,i,Kd))return i;const r=Wd(e,this.tracksInGroup,Kd);if(r>-1){const e=this.tracksInGroup[r];return this.setAudioTrack(r),e}if(i){let i=t.loadLevel;-1===i&&(i=t.firstAutoLevel);const r=function(e,t,n,i,r){const a=t[i],o=t.reduce((e,t,n)=>{const i=t.uri;return(e[i]||(e[i]=[])).push(n),e},{})[a.uri];o.length>1&&(i=Math.max.apply(Math,o));const s=a.videoRange,l=a.frameRate,c=a.codecSet.substring(0,4),u=Xd(t,i,t=>{if(t.videoRange!==s||t.frameRate!==l||t.codecSet.substring(0,4)!==c)return!1;const i=t.audioGroups,a=n.filter(e=>!i||-1!==i.indexOf(e.groupId));return Wd(e,a,r)>-1});return u>-1?u:Xd(t,i,t=>{const i=t.audioGroups,a=n.filter(e=>!i||-1!==i.indexOf(e.groupId));return Wd(e,a,r)>-1})}(e,t.levels,n,i,Kd);if(-1===r)return null;t.nextLoadLevel=r}if(e.channels||e.audioCodec){const t=Wd(e,n);if(t>-1)return n[t]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn("Invalid audio track id: ".concat(e));this.selectDefaultTrack=!1;const n=this.currentTrack,i=t[e],r=i.details&&!i.details.live;if(e===this.trackId&&i===n&&r||(this.log("Switching to audio-track ".concat(e,' "').concat(i.name,'" lang:').concat(i.lang," group:").concat(i.groupId," channels:").concat(i.channels)),this.trackId=e,this.currentTrack=i,this.hls.trigger(au.AUDIO_TRACK_SWITCHING,mu({},i)),r))return;const a=this.switchParams(i.url,null==n?void 0:n.details,i.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const i=t[n];if((!this.selectDefaultTrack||i.default)&&(!e||Yd(e,i,Kd)))return n}if(e){const{name:n,lang:i,assocLang:r,characteristics:a,audioCodec:o,channels:s}=e;for(let e=0;e<t.length;e++){if(Yd({name:n,lang:i,assocLang:r,characteristics:a,audioCodec:o,channels:s},t[e],Kd))return e}for(let n=0;n<t.length;n++){const i=t[n];if(zg(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<t.length;n++){const i=t[n];if(zg(e.attrs,i.attrs,["LANGUAGE"]))return n}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Qd(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,i=e.groupId,r=this.getUrlWithDirectives(e.url,t),a=e.details,o=null==a?void 0:a.age;this.log("Loading audio-track ".concat(n,' "').concat(e.name,'" lang:').concat(e.lang," group:").concat(i).concat(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"").concat(o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""," ").concat(r)),this.hls.trigger(au.AUDIO_TRACK_LOADING,{url:r,id:n,groupId:i,deliveryDirectives:t||null,track:e})}}class Wg{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(null===this.queues||null===this.tracks)return;const i=this.queues[t];i.push(e),1===i.length&&!n&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){null!==this.queues&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=null==(t=e[0])?void 0:t.label;("async-blocker"===n||"async-blocker-prepend"===n)&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){null!==this.queues&&this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(null===this.queues||null===this.tracks)return;const t=this.queues[e];if(t.length){const i=t[0];try{i.execute()}catch(t){var n;if(i.onError(t),null===this.queues||null===this.tracks)return;const r=null==(n=this.tracks[e])?void 0:n.buffer;null!=r&&r.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){null!==this.queues&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return(null==(t=this.queues)?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return null===e||null===t?"<destroyed>":"\n".concat(this.list("video"),"\n").concat(this.list("audio"),"\n").concat(this.list("audiovideo"),"}")}list(e){var t,n;return null!=(t=this.queues)&&t[e]||null!=(n=this.tracks)&&n[e]?"".concat(e,": (").concat(this.listSbInfo(e),") ").concat(this.listOps(e)):""}listSbInfo(e){var t;const n=null==(t=this.tracks)?void 0:t[e],i=null==n?void 0:n.buffer;return i?"SourceBuffer".concat(i.updating?" updating":"").concat(n.ended?" ended":"").concat(n.ending?" ending":""):"none"}listOps(e){var t;return(null==(t=this.queues)?void 0:t[e].map(e=>e.label).join(", "))||""}}const Yg=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Kg="HlsJsTrackRemovedError";class Xg extends Error{constructor(e){super(e),this.name=Kg}}class Qg extends vu{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=e=>{var t;this.hls&&"open"===(null==(t=this.mediaSource)?void 0:t.readyState)&&this.hls.pauseBuffering()},this._onStartStreaming=e=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=e=>{const{media:t,mediaSource:n}=this;e&&this.log("Media source opened"),t&&n&&(n.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(au.MEDIA_ATTACHED,{media:t,mediaSource:n}),null!==this.mediaSource&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:e,_objectUrl:t}=this;e!==t&&this.error("Media element src was set while attaching MediaSource (".concat(t," > ").concat(e,")"))},this.hls=e,this.fragmentTracker=t,this.appendSource=function(e){return typeof self<"u"&&e===self.ManagedMediaSource}(wu(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(au.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(au.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(au.MANIFEST_LOADING,this.onManifestLoading,this),e.on(au.MANIFEST_PARSED,this.onManifestParsed,this),e.on(au.BUFFER_RESET,this.onBufferReset,this),e.on(au.BUFFER_APPENDING,this.onBufferAppending,this),e.on(au.BUFFER_CODECS,this.onBufferCodecs,this),e.on(au.BUFFER_EOS,this.onBufferEos,this),e.on(au.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(au.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(au.FRAG_PARSED,this.onFragParsed,this),e.on(au.FRAG_CHANGED,this.onFragChanged,this),e.on(au.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(au.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(au.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(au.MANIFEST_LOADING,this.onManifestLoading,this),e.off(au.MANIFEST_PARSED,this.onManifestParsed,this),e.off(au.BUFFER_RESET,this.onBufferReset,this),e.off(au.BUFFER_APPENDING,this.onBufferAppending,this),e.off(au.BUFFER_CODECS,this.onBufferCodecs,this),e.off(au.BUFFER_EOS,this.onBufferEos,this),e.off(au.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(au.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(au.FRAG_PARSED,this.onFragParsed,this),e.off(au.FRAG_CHANGED,this.onFragChanged,this),e.off(au.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const e=this.isUpdating();e||this.operationQueue.removeBlockers();const t=this.isQueued();(e||t)&&this.warn("Transfering MediaSource with".concat(t?" operations in queue":"").concat(e?" updating SourceBuffer(s)":""," ").concat(this.operationQueue)),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?pu(n,i.tracks):this.sourceBuffers.forEach(e=>{const[t]=e;t&&(n[t]=pu({},this.tracks[t]),this.removeBuffer(t)),e[0]=e[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log("".concat(i," bufferCodec event(s) expected.")),null!=(n=this.transferData)&&n.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media;this.transferData=this.overrides=void 0;const i=wu(this.appendSource);if(i){const e=!!t.mediaSource;(e||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const r=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(r),e)this._objectUrl=n.src,this.attachTransferred();else{const e=this._objectUrl=self.URL.createObjectURL(r);if(this.appendSource)try{n.removeAttribute("src");const t=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||t&&r instanceof t,Jg(n),function(e,t){const n=self.document.createElement("source");n.type="video/mp4",n.src=t,e.appendChild(n)}(n,e),n.load()}catch(t){n.src=e}else n.src=e}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log("".concat((null==(t=this.transferData)?void 0:t.mediaSource)===e?"transferred":"created"," media source: ").concat(null==(n=e.constructor)?void 0:n.name)),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,i=t.tracks,r=i?Object.keys(i):null,a=r?r.length:0,o=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(i&&r&&a){if(!this.tracksReady)return this.hls.config.startFragPrefetch=!0,void this.log("attachTransferred: waiting for SourceBuffer track info");if(this.log("attachTransferred: (bufferCodecEventsTotal ".concat(this.bufferCodecEventsTotal,")\nrequired tracks: ").concat(jd(n,(e,t)=>"initSegment"===e?void 0:t),";\ntransfer tracks: ").concat(jd(i,(e,t)=>"initSegment"===e?void 0:t),"}")),!Au(i,n)){t.mediaSource=null,t.tracks=void 0;const r=e.currentTime,a=this.details,o=Math.max(r,(null==a?void 0:a.fragments[0].start)||0);return o-r>1?void this.log("attachTransferred: waiting for playback to reach new tracks start time ".concat(r," -> ").concat(o)):(this.warn('attachTransferred: resetting MediaSource for incompatible tracks ("'.concat(Object.keys(i),'"->"').concat(Object.keys(n),'") start time: ').concat(o," currentTime: ").concat(r)),this.onMediaDetaching(au.MEDIA_DETACHING,{}),this.onMediaAttaching(au.MEDIA_ATTACHING,t),void(e.currentTime=o))}this.transferData=void 0,r.forEach(e=>{const t=e,n=i[t];if(n){const e=n.buffer;if(e){const i=this.fragmentTracker,r=n.id;if(i.hasFragments(r)||i.hasParts(r)){const n=Bh.getBuffered(e);i.detectEvictedFragments(t,n,r,null,!0)}const a=$g(t),o=[t,e];this.sourceBuffers[a]=o,e.updating&&this.operationQueue&&this.operationQueue.prependBlocker(t),this.trackSourceBuffer(t,n)}}}),o(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),o()}get mediaSourceOpenOrEnded(){var e;const t=null==(e=this.mediaSource)?void 0:e.readyState;return"open"===t||"ended"===t}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:r,_objectUrl:a}=this;if(r){if(this.log("media source ".concat(n?"transferring":"detaching")),n)this.sourceBuffers.forEach(e=>{let[t]=e;t&&this.removeBuffer(t)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const e="open"===r.readyState;try{const t=r.sourceBuffers;for(let n=t.length;n--;)e&&t[n].abort(),r.removeSourceBuffer(t[n]);e&&r.endOfStream()}catch(e){this.warn("onMediaDetaching: ".concat(e.message," while calling endOfStream"))}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),n||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(i.removeAttribute("src"),this.appendSource&&Jg(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(au.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(e=>{let[t]=e;t&&this.resetBuffer(t)}),this.initTracks()}resetBuffer(e){var t;const n=null==(t=this.tracks[e])?void 0:t.buffer;if(this.removeBuffer(e),n)try{var i;null!=(i=this.mediaSource)&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(t){this.warn("onBufferReset ".concat(e),t)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[$g(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new Wg(this.tracks)}onBufferCodecs(e,t){var n;const i=this.tracks,r=Object.keys(t);this.log('BUFFER_CODECS: "'.concat(r,'" (current SB count ').concat(this.sourceBufferCount,")"));const a="audiovideo"in t&&(i.audio||i.video)||i.audiovideo&&("audio"in t||"video"in t),o=!a&&this.sourceBufferCount&&this.media&&r.some(e=>!i[e]);a||o?this.warn('Unsupported transition between "'.concat(Object.keys(i),'" and "').concat(r,'" SourceBuffers')):(r.forEach(e=>{var n,r;const a=t[e],{id:o,codec:s,levelCodec:l,container:c,metadata:u,supplemental:d}=a;let h=i[e];const f=null==(n=this.transferData)||null==(n=n.tracks)?void 0:n[e],p=null!=f&&f.buffer?f:h,g=(null==p?void 0:p.pendingCodec)||(null==p?void 0:p.codec),m=null==p?void 0:p.levelCodec;h||(h=i[e]={buffer:void 0,listeners:[],codec:s,supplemental:d,container:c,levelCodec:l,metadata:u,id:o});const v=Sd(g,m),y=null==v?void 0:v.replace(Yg,"$1");let _=Sd(s,l);const E=null==(r=_)?void 0:r.replace(Yg,"$1");_&&v&&y!==E&&("audio"===e.slice(0,5)&&(_=Td(_,this.appendSource)),this.log("switching codec ".concat(g," to ").concat(_)),_!==(h.pendingCodec||h.codec)&&(h.pendingCodec=_),h.container=c,this.appendChangeType(e,c,_))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&"main"===(null==(n=t.audio)?void 0:n.id)&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks()))}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const i="".concat(t,";codecs=").concat(n),r={label:"change-type=".concat(i),execute:()=>{const r=this.tracks[e];if(r){const a=r.buffer;null!=a&&a.changeType&&(this.log("changing ".concat(e," sourceBuffer type to ").concat(i)),a.changeType(i),r.codec=n,r.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn("Failed to change ".concat(e," SourceBuffer type"),t)}};this.append(r,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,i=n+.05*e.duration;if(!0===(null==(t=this.fragmentTracker.getAppendedFrag(n,uu.MAIN))?void 0:t.gap))return;const r={label:"block-audio",execute:()=>{var e;const t=this.tracks.video;(this.lastVideoAppendEnd>i||null!=t&&t.buffer&&Bh.isBuffered(t.buffer,i)||!0===(null==(e=this.fragmentTracker.getAppendedFrag(i,uu.MAIN))?void 0:e.gap))&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:e=>{this.warn("Error executing block-audio operation",e)}};this.blockedAudioAppend={op:r,frag:e},this.append(r,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:i,type:r,parent:a,frag:o,part:s,chunkMeta:l,offset:c}=t,u=l.buffering[r],{sn:d,cc:h}=o,f=self.performance.now();u.start=f;const p=o.stats.buffering,g=s?s.stats.buffering:null;0===p.start&&(p.start=f),g&&0===g.start&&(g.start=f);const m=n.audio;let v=!1;"audio"===r&&"audio/mpeg"===(null==m?void 0:m.container)&&(v=!this.lastMpegAudioChunk||1===l.id||this.lastMpegAudioChunk.sn!==l.sn,this.lastMpegAudioChunk=l);const y=n.video,_=null==y?void 0:y.buffer;if(_&&"initSegment"!==d){const e=s||o,t=this.blockedAudioAppend;if("audio"!==r||"main"===a||this.blockedAudioAppend||y.ending||y.ended){if("video"===r){const n=e.end;if(t){const e=t.frag.start;(n>e||n<this.lastVideoAppendEnd||Bh.isBuffered(_,e))&&this.unblockAudio()}this.lastVideoAppendEnd=n}}else{const t=e.start+.05*e.duration,n=_.buffered,i=this.currentOp("video");n.length||i?!i&&!Bh.isBuffered(_,t)&&this.lastVideoAppendEnd<t&&this.blockAudio(e):this.blockAudio(e)}}const E=(s||o).start,b={label:"append-".concat(r),execute:()=>{var e;u.executeStart=self.performance.now();const t=null==(e=this.tracks[r])?void 0:e.buffer;t&&(v?this.updateTimestampOffset(t,E,.1,r,d,h):void 0!==c&&eu(c)&&this.updateTimestampOffset(t,c,1e-6,r,d,h)),this.appendExecutor(i,r)},onStart:()=>{},onComplete:()=>{const e=self.performance.now();u.executeEnd=u.end=e,0===p.first&&(p.first=e),g&&0===g.first&&(g.first=e);const t={};this.sourceBuffers.forEach(e=>{let[n,i]=e;n&&(t[n]=Bh.getBuffered(i))}),this.appendErrors[r]=0,"audio"===r||"video"===r?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(au.BUFFER_APPENDED,{type:r,frag:o,part:s,chunkMeta:l,parent:o.type,timeRanges:t})},onError:e=>{var t;const n={type:iu.MEDIA_ERROR,parent:o.type,details:ru.BUFFER_APPEND_ERROR,sourceBufferName:r,frag:o,part:s,chunkMeta:l,error:e,err:e,fatal:!1},i=null==(t=this.media)?void 0:t.error;if(e.code===DOMException.QUOTA_EXCEEDED_ERR||"QuotaExceededError"==e.name||"quota"in e)n.details=ru.BUFFER_FULL_ERROR;else if(e.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!i)n.errorAction=gh(!0);else if(e.name===Kg&&0===this.sourceBufferCount)n.errorAction=gh(!0);else{const e=++this.appendErrors[r];this.warn("Failed ".concat(e,"/").concat(this.hls.config.appendErrorMaxRetry,' times to append segment in "').concat(r,'" sourceBuffer (').concat(i||"no media error",")")),(e>=this.hls.config.appendErrorMaxRetry||i)&&(n.fatal=!0)}this.hls.trigger(au.ERROR,n)}};this.log('queuing "'.concat(r,'" append sn: ').concat(d).concat(s?" p: "+s.index:""," of ").concat(o.type===uu.MAIN?"level":"track"," ").concat(o.level," cc: ").concat(h)),this.append(b,r,this.isPending(this.tracks[r]))}getFlushOp(e,t,n){return this.log('queuing "'.concat(e,'" remove ').concat(t,"-").concat(n)),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(au.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn("Failed to remove ".concat(t,"-").concat(n,' from "').concat(e,'" SourceBuffer'),i)}}}onBufferFlushing(e,t){const{type:n,startOffset:i,endOffset:r}=t;n?this.append(this.getFlushOp(n,i,r),n):this.sourceBuffers.forEach(e=>{let[t]=e;t&&this.append(this.getFlushOp(t,i,r),t)})}onFragParsed(e,t){const{frag:n,part:i}=t,r=[],a=i?i.elementaryStreams:n.elementaryStreams;a[Nu]?r.push("audiovideo"):(a[Du]&&r.push("audio"),a[Ou]&&r.push("video"));0===r.length&&this.warn("Fragments must have at least one ElementaryStreamType set. type: ".concat(n.type," level: ").concat(n.level," sn: ").concat(n.sn)),this.blockBuffers(()=>{const e=self.performance.now();n.stats.buffering.end=e,i&&(i.stats.buffering.end=e);const t=i?i.stats:n.stats;this.hls.trigger(au.FRAG_BUFFERED,{frag:n,part:i,stats:t,id:n.type})},r).catch(e=>{this.warn("Fragment buffered callback ".concat(e)),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(e=>{let[t]=e;if(t){const e=this.tracks[t];if(e)return!e.ended||e.ending}return!1})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(e=>{let[n]=e;if(n){const e=this.tracks[n];(!t.type||t.type===n)&&(e.ending=!0,e.ended||(e.ended=!0,this.log("".concat(n," buffer reached EOS"))))}});const i=!1!==(null==(n=this.overrides)?void 0:n.endOfStream);this.sourceBufferCount>0&&!this.sourceBuffers.some(e=>{let[t]=e;var n;return t&&!(null!=(n=this.tracks[t])&&n.ended)})?i?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:e}=this;e&&"open"===e.readyState?(this.log("Calling mediaSource.endOfStream()"),e.endOfStream(),this.hls.trigger(au.BUFFERED_TO_END,void 0)):e&&this.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: ".concat(e.readyState))})):(this.tracksEnded(),this.hls.trigger(au.BUFFERED_TO_END,void 0)):"video"===t.type&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(e=>{let[t]=e;if(null!==t){const e=this.tracks[t];e&&(e.ending=!1)}})}onLevelUpdated(e,t){let{details:n}=t;n.fragments.length&&(this.details=n,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===ru.BUFFER_APPEND_ERROR&&t.frag){var n;const e=null==(n=t.errorAction)?void 0:n.nextAutoLevel;eu(e)&&e!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||null===t||!this.sourceBufferCount)return;const i=e.config,r=n.currentTime,a=t.levelTargetDuration,o=t.live&&null!==i.liveBackBufferLength?i.liveBackBufferLength:i.backBufferLength;if(eu(o)&&o>=0){const e=Math.max(o,a),t=Math.floor(r/a)*a-e;this.flushBackBuffer(r,a,t)}const s=i.frontBufferFlushThreshold;if(eu(s)&&s>0){const e=Math.max(i.maxBufferLength,s),t=Math.max(e,a),n=Math.floor(r/a)*a+t;this.flushFrontBuffer(r,a,n)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(e=>{let[t,i]=e;if(i){const e=Bh.getBuffered(i);if(e.length>0&&n>e.start(0)){var r;this.hls.trigger(au.BACK_BUFFER_REACHED,{bufferEnd:n});const e=this.tracks[t];if(null!=(r=this.details)&&r.live)this.hls.trigger(au.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(null!=e&&e.ended)return void this.log("Cannot flush ".concat(t," back buffer while SourceBuffer is in ended state"));this.hls.trigger(au.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:t})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(t=>{let[i,r]=t;if(r){const t=Bh.getBuffered(r),a=t.length;if(a<2)return;const o=t.start(a-1),s=t.end(a-1);if(n>o||e>=o&&e<=s)return;this.hls.trigger(au.BUFFER_FLUSHING,{startOffset:o,endOffset:1/0,type:i})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||"open"!==(null==n?void 0:n.readyState))return null;const i=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){const e=Math.max(0,t.fragmentStart);return{duration:1/0,start:e,end:Math.max(e,i)}}return{duration:1/0}}const r=null==(e=this.overrides)?void 0:e.duration;if(r)return eu(r)?{duration:r}:null;const a=this.media.duration;return i>(eu(n.duration)?n.duration:0)&&i>a||!eu(a)?{duration:i}:null}updateMediaSource(e){let{duration:t,start:n,end:i}=e;const r=this.mediaSource;!this.media||!r||"open"!==r.readyState||(r.duration!==t&&(eu(t)&&this.log("Updating MediaSource duration to ".concat(t.toFixed(3))),r.duration=t),void 0!==n&&void 0!==i&&(this.log("MediaSource duration is set to ".concat(r.duration,". Setting seekable range to ").concat(n,"-").concat(i,".")),r.setLiveSeekableRange(n,i)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log("checkPendingTracks (pending: ".concat(t," codec events expected: ").concat(e,") ").concat(jd(n))),this.tracksReady){var i;const e=null==(i=this.transferData)?void 0:i.tracks;e&&Object.keys(e).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(t=>{let[n,i]=t;if(n){const t=this.tracks[n];e[n]={buffer:i,container:t.container,codec:t.codec,supplemental:t.supplemental,levelCodec:t.levelCodec,id:t.id,metadata:t.metadata}}}),this.hls.trigger(au.BUFFER_CREATED,{tracks:e}),this.log("SourceBuffers created. Running queue: ".concat(this.operationQueue)),this.sourceBuffers.forEach(e=>{let[t]=e;this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(au.ERROR,{type:iu.MEDIA_ERROR,details:ru.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const r in e){const a=r,o=e[a];if(this.isPending(o)){const e=this.getTrackCodec(o,a),r="".concat(o.container,";codecs=").concat(e);o.codec=e,this.log("creating sourceBuffer(".concat(r,")").concat(this.currentOp(a)?" Queued":""," ").concat(jd(o)));try{const e=n.addSourceBuffer(r),i=$g(a),s=[a,e];t[i]=s,o.buffer=e}catch(e){var i;return this.error("error while trying to add sourceBuffer: ".concat(e.message)),this.shiftAndExecuteNext(a),null==(i=this.operationQueue)||i.removeBlockers(),delete this.tracks[a],void this.hls.trigger(au.ERROR,{type:iu.MEDIA_ERROR,details:ru.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,sourceBufferName:a,mimeType:r,parent:o.id})}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let i=e.codec;n&&("video"===t||"audiovideo"===t)&&gd(n,"video")&&(i=function(e,t){const n=[];if(e){const t=e.split(",");for(let e=0;e<t.length;e++)pd(t[e],"video")||n.push(t[e])}return t&&n.push(t),n.join(",")}(i,n));const r=Sd(i,e.levelCodec);return r?"audio"===t.slice(0,5)?Td(r,this.appendSource):r:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const i=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(e,t)=>{const n=t.removedRanges;null!=n&&n.length&&this.hls.trigger(au.BUFFER_FLUSHED,{type:e})})}get mediaSrc(){var e,t;const n=(null==(e=this.media)||null==(t=e.querySelector)?void 0:t.call(e,"source"))||this.media;return null==n?void 0:n.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if("closed"===(null==(t=this.mediaSource)?void 0:t.readyState))return void this.resetBuffer(e);const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const i=new Error("".concat(e," SourceBuffer error. MediaSource readyState: ").concat(null==(n=this.mediaSource)?void 0:n.readyState));this.error("".concat(i),t),this.hls.trigger(au.ERROR,{type:iu.MEDIA_ERROR,details:ru.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const r=this.currentOp(e);r&&r.onError(i)}updateTimestampOffset(e,t,n,i,r,a){const o=t-e.timestampOffset;Math.abs(o)>=n&&(this.log("Updating ".concat(i," SourceBuffer timestampOffset to ").concat(t," (sn: ").concat(r," cc: ").concat(a,")")),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:i,mediaSource:r}=this,a=this.tracks[e],o=null==a?void 0:a.buffer;if(!i||!r||!o)return this.warn("Attempting to remove from the ".concat(e," SourceBuffer, but it does not exist")),void this.shiftAndExecuteNext(e);const s=eu(i.duration)?i.duration:1/0,l=eu(r.duration)?r.duration:1/0,c=Math.max(0,t),u=Math.min(n,s,l);u>c&&(!a.ending||a.ended)?(a.ended=!1,this.log("Removing [".concat(c,",").concat(u,"] from the ").concat(e," SourceBuffer")),o.remove(c,u)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],i=null==n?void 0:n.buffer;if(!i)throw new Xg("Attempting to append to the ".concat(t," SourceBuffer, but it does not exist"));n.ending=!1,n.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(e=>{this.warn("SourceBuffer blocked callback ".concat(e)),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(e){this.warn("Callback run without blocking ".concat(this.operationQueue," ").concat(e))}}isUpdating(){return this.sourceBuffers.some(e=>{let[t,n]=e;return t&&n.updating})}isQueued(){return this.sourceBuffers.some(e=>{let[t]=e;return t&&!!this.currentOp(t)})}isPending(e){return!!e&&!e.buffer}blockBuffers(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sourceBufferTypes;if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,i=t.map(e=>this.appendBlocker(e));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then(t=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(e=>{var t;const n=null==(t=this.tracks[e])?void 0:t.buffer;!n||n.updating||this.shiftAndExecuteNext(e)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,t)=>{let[n]=t;return e+(n?1:0)},0)}get sourceBufferTypes(){return this.sourceBuffers.map(e=>{let[t]=e;return t}).filter(e=>!!e)}addBufferListener(e,t,n){const i=this.tracks[e];if(!i)return;const r=i.buffer;if(!r)return;const a=n.bind(this,e);i.listeners.push({event:t,listener:a}),r.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(e=>{n.removeEventListener(e.event,e.listener)}),t.listeners.length=0)}}function Jg(e){const t=e.querySelectorAll("source");[].slice.call(t).forEach(t=>{e.removeChild(t)})}function $g(e){return"audio"===e?1:0}class em{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(au.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(au.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(au.MANIFEST_PARSED,this.onManifestParsed,this),e.on(au.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(au.BUFFER_CODECS,this.onBufferCodecs,this),e.on(au.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(au.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(au.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(au.MANIFEST_PARSED,this.onManifestParsed,this),e.off(au.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(au.BUFFER_CODECS,this.onBufferCodecs,this),e.off(au.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&eu(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log("Setting autoLevelCapping to ".concat(n,": ").concat(e[n].height,"p@").concat(e[n].bitrate," for media ").concat(this.mediaWidth,"x").concat(this.mediaHeight)),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((t,n)=>this.isLevelAllowed(t)&&n<=e);return this.clientRect=null,em.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height)}static getMaxLevelByMediaSize(e,t,n){if(null==e||!e.length)return-1;const i=(e,t)=>!t||(e.width!==t.width||e.height!==t.height);let r=e.length-1;const a=Math.max(t,n);for(let t=0;t<e.length;t+=1){const n=e[t];if((n.width>=a||n.height>=a)&&i(n,e[t+1])){r=t;break}}return r}}const tm="m",nm="a",im="v",rm="av",am="i",om="tt",sm="h";class lm{constructor(e,t){Array.isArray(e)&&(e=e.map(e=>e instanceof lm?e:new lm(e))),this.value=e,this.params=t}}function cm(e,t,n,i){return new Error("failed to ".concat(e,' "').concat(function(e){return Array.isArray(e)?JSON.stringify(e):e instanceof Map?"Map{}":e instanceof Set?"Set{}":"object"==typeof e?JSON.stringify(e):String(e)}(t),'" as ').concat(n),{cause:i})}function um(e,t,n){return cm("serialize",e,t,n)}class dm{constructor(e){this.description=e}}const hm="Bare Item";function fm(e){if(!1===ArrayBuffer.isView(e))throw um(e,"Byte Sequence");return":".concat(function(e){return btoa(String.fromCharCode(...e))}(e),":")}function pm(e){if(function(e){return e<-999999999999999||999999999999999<e}(e))throw um(e,"Integer");return e.toString()}function gm(e,t){if(e<0)return-gm(-e,t);const n=Math.pow(10,t);if(Math.abs(e*n%1-.5)<Number.EPSILON){const t=Math.floor(e*n);return(t%2==0?t:t+1)/n}return Math.round(e*n)/n}function mm(e){const t=gm(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw um(e,"Decimal");const n=t.toString();return n.includes(".")?n:"".concat(n,".0")}const vm=/[\x00-\x1f\x7f]+/;function ym(e){const t=function(e){return e.description||e.toString().slice(7,-1)}(e);if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw um(t,"Token");return t}function _m(e){switch(typeof e){case"number":if(!eu(e))throw um(e,hm);return Number.isInteger(e)?pm(e):mm(e);case"string":return function(e){if(vm.test(e))throw um(e,"String");return'"'.concat(e.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),'"')}(e);case"symbol":return ym(e);case"boolean":return function(e){if("boolean"!=typeof e)throw um(e,"Boolean");return e?"?1":"?0"}(e);case"object":if(e instanceof Date)return function(e){return"@".concat(pm(e.getTime()/1e3))}(e);if(e instanceof Uint8Array)return fm(e);if(e instanceof dm)return ym(e);default:throw um(e,hm)}}function Em(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw um(e,"Key");return e}function bm(e){return null==e?"":Object.entries(e).map(e=>{let[t,n]=e;return!0===n?";".concat(Em(t)):";".concat(Em(t),"=").concat(_m(n))}).join("")}function Tm(e){return e instanceof lm?"".concat(_m(e.value)).concat(bm(e.params)):_m(e)}function Sm(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{whitespace:!0};if("object"!=typeof e||null==e)throw um(e,"Dict");const n=e instanceof Map?e.entries():Object.entries(e),i=null!=t&&t.whitespace?" ":"";return Array.from(n).map(e=>{let[t,n]=e;n instanceof lm||(n=new lm(n));let i=Em(t);return!0===n.value?i+=bm(n.params):(i+="=",Array.isArray(n.value)?i+=function(e){return"(".concat(e.value.map(Tm).join(" "),")").concat(bm(e.params))}(n):i+=Tm(n)),i}).join(",".concat(i))}function wm(e,t){return Sm(e,t)}const Am="CMCD-Object",Rm="CMCD-Request",xm="CMCD-Session",Im="CMCD-Status",Lm={br:Am,ab:Am,d:Am,ot:Am,tb:Am,tpb:Am,lb:Am,tab:Am,lab:Am,url:Am,pb:Rm,bl:Rm,tbl:Rm,dl:Rm,ltc:Rm,mtp:Rm,nor:Rm,nrr:Rm,rc:Rm,sn:Rm,sta:Rm,su:Rm,ttfb:Rm,ttfbb:Rm,ttlb:Rm,cmsdd:Rm,cmsds:Rm,smrt:Rm,df:Rm,cs:Rm,ts:Rm,cid:xm,pr:xm,sf:xm,sid:xm,st:xm,v:xm,msd:xm,bs:Im,bsd:Im,cdn:Im,rtp:Im,bg:Im,pt:Im,ec:Im,e:Im},Mm=Rm;function Cm(e,t){const n={};if(!e)return n;const i=Object.keys(e),r=t?function(e){return Object.keys(e).reduce((t,n)=>{var i;return null===(i=e[n])||void 0===i||i.forEach(e=>t[e]=n),t},{})}(t):{};return i.reduce((t,n)=>{var i;const a=Lm[n]||r[n]||Mm;return(null!==(i=t[a])&&void 0!==i?i:t[a]={})[n]=e[n],t},n)}const Pm="event";const Dm=e=>Math.round(e),Om=(e,t)=>Array.isArray(e)?e.map(e=>Om(e,t)):e instanceof lm&&"string"==typeof e.value?new lm(Om(e.value,t),e.params):(t.baseUrl&&(e=function(e,t){const n=new URL(e),i=new URL(t);if(n.origin!==i.origin)return e;const r=n.pathname.split("/").slice(1),a=i.pathname.split("/").slice(1,-1);for(;r[0]===a[0];)r.shift(),a.shift();for(;a.length;)a.shift(),r.unshift("..");return r.join("/")+n.search+n.hash}(e,t.baseUrl)),1===t.version?encodeURIComponent(e):e),Nm=e=>100*Dm(e/100),km={br:Dm,d:Dm,bl:Nm,dl:Nm,mtp:Nm,nor:(e,t)=>{let n=e;return t.version>=2&&(e instanceof lm&&"string"==typeof e.value?n=new lm([e]):"string"==typeof e&&(n=[e])),Om(n,t)},rtp:Nm,tb:Dm},Fm="request",Bm="response",Um=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],Vm=["e"],Gm=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Hm(e){return Gm.test(e)}const jm=["d","dl","nor","ot","rtp","su"];const zm=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];const Zm=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function qm(e){return Zm.includes(e)||Hm(e)}const Wm={[Bm]:function(e){return Um.includes(e)||jm.includes(e)||zm.includes(e)||Hm(e)},[Pm]:function(e){return Um.includes(e)||Vm.includes(e)||Hm(e)},[Fm]:function(e){return Um.includes(e)||jm.includes(e)||Hm(e)}};function Ym(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={};if(null==e||"object"!=typeof e)return n;const i=t.version||e.v||1,r=t.reportingMode||Fm,a=1===i?qm:Wm[r];let o=Object.keys(e).filter(a);const s=t.filter;"function"==typeof s&&(o=o.filter(s));const l=r===Bm||r===Pm;l&&!o.includes("ts")&&o.push("ts"),i>1&&!o.includes("v")&&o.push("v");const c=pu({},km,t.formatters),u={version:i,reportingMode:r,baseUrl:t.baseUrl};return o.sort().forEach(t=>{let r=e[t];const a=c[t];if("function"==typeof a&&(r=a(r,u)),"v"===t){if(1===i)return;r=i}"pr"==t&&1===r||(l&&"ts"===t&&!eu(r)&&(r=Date.now()),function(e){return"number"==typeof e?eu(e):null!=e&&""!==e&&!1!==e}(r)&&(function(e){return["ot","sf","st","e","sta"].includes(e)}(t)&&"string"==typeof r&&(r=new dm(r)),n[t]=r))}),n}function Km(e,t,n){return pu(e,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={};if(!e)return n;const i=Cm(Ym(e,t),null==t?void 0:t.customHeaderMap);return Object.entries(i).reduce((e,t)=>{let[n,i]=t;const r=wm(i,{whitespace:!1});return r&&(e[n]=r),e},n)}(t,n))}function Xm(e){if(!e)return"";const t=function(e){return e?wm(Ym(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),{whitespace:!1}):""}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return encodeURIComponent(t)}const Qm=/CMCD=[^&#]+/;function Jm(e,t,n){const i=function(e){if(!e)return"";const t=Xm(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return"".concat("CMCD","=").concat(t)}(t,n);if(!i)return e;if(Qm.test(e))return e.replace(Qm,i);const r=e.includes("?")?"&":"?";return"".concat(e).concat(r).concat(i)}class $m{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:tm,su:!this.initialized})}catch(e){this.hls.logger.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=e=>{try{const{frag:t,part:n}=e,i=this.hls.levels[t.level],r=this.getObjectType(t),a={d:1e3*(n||t).duration,ot:r};(r===im||r===nm||r==rm)&&(a.br=i.bitrate/1e3,a.tb=this.getTopBandwidth(r)/1e3,a.bl=this.getBufferLength(r));const o=n?this.getNextPart(n):this.getNextFrag(t);null!=o&&o.url&&o.url!==t.url&&(a.nor=o.url),this.apply(e,a)}catch(e){this.hls.logger.warn("Could not generate segment CMCD data.",e)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;null!=n&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=!0===n.useHeaders,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(au.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(au.MEDIA_DETACHED,this.onMediaDetached,this),e.on(au.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(au.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(au.MEDIA_DETACHED,this.onMediaDetached,this),e.off(au.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,i;this.audioBuffer=null==(n=t.tracks.audio)?void 0:n.buffer,this.videoBuffer=null==(i=t.tracks.video)?void 0:i.buffer}createData(){var e;return{v:1,sf:sm,sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};pu(t,this.createData());const n=t.ot===am||t.ot===im||t.ot===rm;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((e,n)=>(i.includes(n)&&(e[n]=t[n]),e),{}));const r={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),Km(e.headers,t,r)):e.url=Jm(e.url,t,r)}getNextFrag(e){var t;const n=null==(t=this.hls.levels[e.level])?void 0:t.details;if(n){const t=e.sn-n.startSN;return n.fragments[t+1]}}getNextPart(e){var t;const{index:n,fragment:i}=e,r=null==(t=this.hls.levels[i.level])||null==(t=t.details)?void 0:t.partList;if(r){const{sn:e}=i;for(let t=r.length-1;t>=0;t--){const i=r[t];if(i.index===n&&i.fragment.sn===e)return r[t+1]}}}getObjectType(e){const{type:t}=e;return"subtitle"===t?om:"initSegment"===e.sn?am:"audio"===t?nm:"main"===t?this.hls.audioTracks.length?im:rm:void 0}getTopBandwidth(e){let t,n=0;const i=this.hls;if(e===nm)t=i.audioTracks;else{const e=i.maxAutoLevel,n=e>-1?e+1:i.levels.length;t=i.levels.slice(0,n)}return t.forEach(e=>{e.bitrate>n&&(n=e.bitrate)}),n>0?n:NaN}getBufferLength(e){const t=this.media,n=e===nm?this.audioBuffer:this.videoBuffer;return n&&t?1e3*Bh.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len:NaN}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new n(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,n,i){t(e),this.loader.load(e,n,i)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new n(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,n,i){t(e),this.loader.load(e,n,i)}}}}class ev extends vu{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(au.MANIFEST_LOADING,this.onManifestLoading,this),e.on(au.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(au.MANIFEST_PARSED,this.onManifestParsed,this),e.on(au.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(au.MANIFEST_LOADING,this.onManifestLoading,this),e.off(au.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(au.MANIFEST_PARSED,this.onManifestParsed,this),e.off(au.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(t=>t!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;null!==n&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((null==n?void 0:n.action)===hh.SendAlternateToPenaltyBox&&n.flags===fh.MoveAllAlternatesMatchingHost){const e=this.levels;let i=this._pathwayPriority,r=this.pathwayId;if(t.context){const{groupId:n,pathwayId:i,type:a}=t.context;n&&e?r=this.getPathwayForGroupId(n,a,r):i&&(r=i)}r in this.penalizedPathways||(this.penalizedPathways[r]=performance.now()),!i&&e&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),n.resolved=this.pathwayId!==r),t.details!==ru.BUFFER_APPEND_ERROR||t.fatal?n.resolved||this.warn("Could not resolve ".concat(t.details,' ("').concat(t.error.message,'") with content-steering for Pathway: ').concat(r," levels: ").concat(e&&e.length," priorities: ").concat(jd(i)," penalized: ").concat(jd(this.penalizedPathways))):n.resolved=!0}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const n=e[0].pathwayId;this.log("No levels found in Pathway ".concat(this.pathwayId,'. Setting initial Pathway to "').concat(n,'"')),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log("Found ".concat(t.length,"/").concat(e.length,' levels in Pathway "').concat(this.pathwayId,'"')),t}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){let t;this._pathwayPriority=e;const n=this.penalizedPathways,i=performance.now();Object.keys(n).forEach(e=>{i-n[e]>3e5&&delete n[e]});for(let i=0;i<e.length;i++){const r=e[i];if(r in n)continue;if(r===this.pathwayId)return;const a=this.hls.nextLoadLevel,o=this.hls.levels[a];if(t=this.getLevelsForPathway(r),t.length>0){this.log('Setting Pathway to "'.concat(r,'"')),this.pathwayId=r,Hf(t),this.hls.trigger(au.LEVELS_UPDATED,{levels:t});const e=this.hls.levels[a];o&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==o.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==o.bitrate&&this.log("Unstable Pathways change from bitrate ".concat(o.bitrate," to ").concat(e.bitrate)),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,n){const i=this.getLevelsForPathway(n).concat(this.levels||[]);for(let n=0;n<i.length;n++)if(t===lu&&i[n].hasAudioGroup(e)||t===cu&&i[n].hasSubtitleGroup(e))return i[n].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},i={};e.forEach(e=>{const{ID:r,"BASE-ID":a,"URI-REPLACEMENT":o}=e;if(t.some(e=>e.pathwayId===r))return;const s=this.getLevelsForPathway(a).map(e=>{const t=new qh(e.attrs);t["PATHWAY-ID"]=r;const a=t.AUDIO&&"".concat(t.AUDIO,"_clone_").concat(r),s=t.SUBTITLES&&"".concat(t.SUBTITLES,"_clone_").concat(r);a&&(n[t.AUDIO]=a,t.AUDIO=a),s&&(i[t.SUBTITLES]=s,t.SUBTITLES=s);const l=nv(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",o),c=new Vd({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(let t=1;t<e.audioGroups.length;t++)c.addGroupId("audio","".concat(e.audioGroups[t],"_clone_").concat(r));if(e.subtitleGroups)for(let t=1;t<e.subtitleGroups.length;t++)c.addGroupId("text","".concat(e.subtitleGroups[t],"_clone_").concat(r));return c});t.push(...s),tv(this.audioTracks,n,o,r),tv(this.subtitleTracks,i,o,r)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;let i;this.loader&&this.loader.destroy(),this.loader=new n(t);try{i=new self.URL(e)}catch(t){return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: ".concat(e))}if("data:"!==i.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+e)}const r={responseType:"json",url:i.href},a=t.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},s={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(e,t,n,r)=>{this.log('Loaded steering manifest: "'.concat(i,'"'));const a=e.data;if(1!==(null==a?void 0:a.VERSION))return void this.log("Steering VERSION ".concat(a.VERSION," not supported!"));this.updated=performance.now(),this.timeToLoad=a.TTL;const{"RELOAD-URI":o,"PATHWAY-CLONES":s,"PATHWAY-PRIORITY":l}=a;if(o)try{this.uri=new self.URL(o,i).href}catch(e){return this.enabled=!1,void this.log("Failed to parse Steering Manifest RELOAD-URI: ".concat(o))}this.scheduleRefresh(this.uri||n.url),s&&this.clonePathways(s);const c={steeringManifest:a,url:i.toString()};this.hls.trigger(au.STEERING_MANIFEST_LOADED,c),l&&this.updatePathwayPriority(l)},onError:(e,t,n,i)=>{if(this.log("Error loading steering manifest: ".concat(e.code," ").concat(e.text," (").concat(t.url,")")),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log("Steering manifest ".concat(t.url," no longer available"));let r=1e3*this.timeToLoad;if(429===e.code){const e=this.loader;if("function"==typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(r=1e3*parseFloat(t))}return void this.log("Steering manifest ".concat(t.url," rate limited"))}this.scheduleRefresh(this.uri||t.url,r)},onTimeout:(e,t,n)=>{this.log("Timeout loading steering manifest (".concat(t.url,")")),this.scheduleRefresh(this.uri||t.url)}};this.log("Requesting steering manifest: ".concat(i)),this.loader.load(r,s,l)}scheduleRefresh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3*this.timeToLoad;this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var t;const n=null==(t=this.hls)?void 0:t.media;!n||n.ended?this.scheduleRefresh(e,1e3*this.timeToLoad):this.loadSteeringManifest(e)},t)}}function tv(e,t,n,i){e&&Object.keys(t).forEach(r=>{const a=e.filter(e=>e.groupId===r).map(e=>{const a=pu({},e);return a.details=void 0,a.attrs=new qh(a.attrs),a.url=a.attrs.URI=nv(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",n),a.groupId=a.attrs["GROUP-ID"]=t[r],a.attrs["PATHWAY-ID"]=i,a});e.push(...a)})}function nv(e,t,n,i){const{HOST:r,PARAMS:a,[n]:o}=i;let s;t&&(s=null==o?void 0:o[t],s&&(e=s));const l=new self.URL(e);return r&&!s&&(l.host=r),a&&Object.keys(a).sort().forEach(e=>{e&&l.searchParams.set(e,a[e])}),l.href}class iv extends vu{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=iv.CDMCleanupPromise?[iv.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=e=>{const{initDataType:t,initData:n}=e,i='"'.concat(e.type,'" event: init data type: "').concat(t,'"');if(this.debug(i),null!==n){if(!this.keyFormatPromise){let e=Object.keys(this.keySystemAccessPromises);e.length||(e=df(this.config));const t=e.map(uf).filter(e=>!!e);this.keyFormatPromise=this.getKeyFormatPromise(t)}this.keyFormatPromise.then(r=>{const a=cf(r);if("sinf"!==t||a!==sf.FAIRPLAY)return void this.log('Ignoring "'.concat(e.type,'" event with init data type: "').concat(t,'" for selected key-system ').concat(a));let o;try{const e=zu(new Uint8Array(n)),t=id(tf(JSON.parse(e).sinf));if(!t)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");o=new Uint8Array(t.subarray(8,24))}catch(e){return void this.warn("".concat(i," Failed to parse sinf: ").concat(e))}const s=xu(o),{keyIdToKeySessionPromise:l,mediaKeySessions:c}=this;let u=l[s];for(let e=0;e<c.length;e++){const i=c[e],r=i.decryptdata;if(!r.keyId)continue;const a=xu(r.keyId);if(Qh(o,r.keyId)||-1!==r.uri.replace(/-/g,"").indexOf(s)){if(u=l[a],!u)continue;if(r.pssh)break;delete l[a],r.pssh=new Uint8Array(n),r.keyId=o,u=l[s]=u.then(()=>this.generateRequestWithPreferredKeySession(i,t,n,"encrypted-event-key-match")),u.catch(e=>this.handleError(e));break}}u||this.handleError(new Error("Key ID ".concat(s," not encountered in playlist. Key-system sessions ").concat(c.length,".")))}).catch(e=>this.handleError(e))}},this.onWaitingForKey=e=>{this.log('"'.concat(e.type,'" event'))},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(au.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(au.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(au.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(au.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(au.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(au.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(au.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(au.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(au.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(au.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,i=null==t?void 0:t[e];return i?i.licenseUrl:e===sf.WIDEVINE&&n?n:void 0}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(void 0===t)throw new Error('no license server URL configured for key-system "'.concat(e,'"'));return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=null==t?void 0:t[e];if(n)return n.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'.concat(e,'"]'))}attemptKeySystemAccess(e){const t=this.hls.levels,n=(e,t,n)=>!!e&&n.indexOf(e)===t,i=t.map(e=>e.audioCodec).filter(n),r=t.map(e=>e.videoCodec).filter(n);return i.length+r.length===0&&r.push("avc1.42e01e"),new Promise((t,n)=>{const a=e=>{const o=e.shift();this.getMediaKeysPromise(o,i,r).then(e=>t({keySystem:o,mediaKeys:e})).catch(t=>{e.length?a(e):n(t instanceof ov?t:new ov({type:iu.KEY_SYSTEM_ERROR,details:ru.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))})};a(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if("function"!=typeof n){let e="Configured requestMediaKeySystemAccess is not a function ".concat(n);return null===hf&&"http:"===self.location.protocol&&(e="navigator.requestMediaKeySystemAccess is not available over insecure protocol ".concat(location.protocol)),Promise.reject(new Error(e))}return n(e,t)}getMediaKeysPromise(e,t,n){var i;const r=function(e,t,n,i){let r;switch(e){case sf.FAIRPLAY:r=["cenc","sinf"];break;case sf.WIDEVINE:case sf.PLAYREADY:r=["cenc"];break;case sf.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error("Unknown key-system: ".concat(e))}return function(e,t,n,i){return[{initDataTypes:e,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:t.map(e=>({contentType:"audio/mp4; codecs=".concat(e),robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:n.map(e=>({contentType:"video/mp4; codecs=".concat(e),robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}(r,t,n,i)}(e,t,n,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],o=null==(i=a)?void 0:i.keySystemAccess;if(!o){this.log('Requesting encrypted media "'.concat(e,'" key-system access with config: ').concat(jd(r))),o=this.requestMediaKeySystemAccess(e,r);const t=a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(t=>{this.log('Failed to obtain access to key-system "'.concat(e,'": ').concat(t))}),o.then(n=>{this.log('Access for key-system "'.concat(n.keySystem,'" obtained'));const i=this.fetchServerCertificate(e);this.log('Create media-keys for "'.concat(e,'"'));const r=t.mediaKeys=n.createMediaKeys().then(n=>(this.log('Media-keys created for "'.concat(e,'"')),t.hasMediaKeys=!0,i.then(t=>t?this.setMediaKeysServerCertificate(n,e,t):n)));return r.catch(t=>{this.error('Failed to create media-keys for "'.concat(e,'"}: ').concat(t))}),r})}return o.then(()=>a.mediaKeys)}createMediaKeySessionContext(e){let{decryptdata:t,keySystem:n,mediaKeys:i}=e;this.log('Creating key-system session "'.concat(n,'" keyId: ').concat(xu(t.keyId||[])," keyUri: ").concat(t.uri));const r=i.createSession(),a={decryptdata:t,keySystem:n,mediaKeys:i,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(a),a}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),i=rv(t),r="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(n,r,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const n=e.mediaKeysSession;return this.log('Updating key-session "'.concat(n.sessionId,'" for keyId ').concat(xu(e.decryptdata.keyId||[]),"\n      } (data length: ").concat(t.byteLength,")")),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(e=>{let{hasMediaKeys:t}=e;return!!t}).map(e=>{let{keySystem:t}=e;return uf(t)}).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(e=>{let{keySystem:t,mediaKeys:n}=e;return this.attemptSetMediaKeys(t,n)})}selectKeySystem(e){return new Promise((t,n)=>{this.getKeySystemSelectionPromise(e).then(e=>{let{keySystem:i}=e;const r=uf(i);r?t(r):n(new Error('Unable to find format for key-system "'.concat(i,'"')))}).catch(n)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: ".concat(e.sn," ").concat(e.type,": ").concat(e.level,") key formats ").concat(t.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=df(this.config),n=e.map(cf).filter(e=>!!e&&-1!==t.indexOf(e));return this.selectKeySystem(n)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let n=0;n<t.length;n++){const i=av(e,t[n]);if(i)return i}}loadKey(e){const t=e.keyInfo.decryptdata,n=rv(t),i=this.bannedKeyIds[n];if(i||"internal-error"===this.getKeyStatus(t)){const n=sv(i||"internal-error",t);return this.handleError(n,e.frag),Promise.reject(n)}const r="(keyId: ".concat(n,' format: "').concat(t.keyFormat,'" method: ').concat(t.method," uri: ").concat(t.uri,")");this.log("Starting session for key ".concat(r));const a=this.keyIdToKeySessionPromise[n];if(!a){const i=this.getKeySystemForKeyPromise(t).then(n=>{let{keySystem:i,mediaKeys:a}=n;return this.throwIfDestroyed(),this.log("Handle encrypted media sn: ".concat(e.frag.sn," ").concat(e.frag.type,": ").concat(e.frag.level," using key ").concat(r)),this.attemptSetMediaKeys(i,a).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:i,mediaKeys:a,decryptdata:t})))}).then(e=>{const n=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(e,"cenc",n,"playlist-key")});return i.catch(t=>this.handleError(t,e.frag)),this.keyIdToKeySessionPromise[n]=i,i}return a.catch(n=>{if(n instanceof ov){const i=mu({},n.data);"internal-error"===this.getKeyStatus(t)&&(i.decryptdata=t);const r=new ov(i,n.message);this.handleError(r,e.frag)}}),a}throwIfDestroyed(){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof ov){t&&(e.data.frag=t);const n=e.data.decryptdata;this.error("".concat(e.message).concat(n?" (".concat(xu(n.keyId||[]),")"):"")),this.hls.trigger(au.ERROR,e.data)}else this.error(e.message),this.hls.trigger(au.ERROR,{type:iu.KEY_SYSTEM_ERROR,details:ru.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=rv(e),n=this.keyIdToKeySessionPromise[t];if(!n){const t=cf(e.keyFormat),n=t?[t]:df(this.config);return this.attemptKeySystemAccess(n)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=df(this.config)),0===e.length)throw new ov({type:iu.KEY_SYSTEM_ERROR,details:ru.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options ".concat(jd({drmSystems:this.config.drmSystems})));return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'.concat(e,'"'));const i=Promise.all(n).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(i),i.then(()=>{this.log('Media-keys set for "'.concat(e,'"')),n.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(e=>-1===n.indexOf(e))})}generateRequestWithPreferredKeySession(e,t,n,i){var r;const a=null==(r=this.config.drmSystems)||null==(r=r[e.keySystem])?void 0:r.generateRequest;if(a)try{const i=a.call(this.hls,t,n,e);if(!i)throw new Error("Invalid response from configured generateRequest filter");t=i.initDataType,n=i.initData?i.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(e){if(this.warn(e.message),this.hls&&this.hls.config.debug)throw e}if(null===n)return this.log('Skipping key-session request for "'.concat(i,'" (no initData)')),Promise.resolve(e);const o=rv(e.decryptdata),s=e.decryptdata.uri;this.log('Generating key-session request for "'.concat(i,'" keyId: ').concat(o," URI: ").concat(s," (init data type: ").concat(t," length: ").concat(n.byteLength,")"));const l=new vp,c=e._onmessage=t=>{const n=e.mediaKeysSession;if(!n)return void l.emit("error",new Error("invalid state"));const{messageType:i,message:r}=t;this.log('"'.concat(i,'" message event for session "').concat(n.sessionId,'" message size: ').concat(r.byteLength)),"license-request"===i||"license-renewal"===i?this.renewLicense(e,r).catch(e=>{l.eventNames().length?l.emit("error",e):this.handleError(e)}):"license-release"===i?e.keySystem===sf.FAIRPLAY&&this.updateKeySession(e,nf("acknowledged")).then(()=>this.removeSession(e)).catch(e=>this.handleError(e)):this.warn('unhandled media key message type "'.concat(i,'"'))},u=(e,t)=>{let n;t.keyStatus=e,e.startsWith("usable")?l.emit("resolved"):"internal-error"===e||"output-restricted"===e||"output-downscaled"===e?n=sv(e,t.decryptdata):"expired"===e?n=new Error("key expired (keyId: ".concat(o,")")):"released"===e?n=new Error("key released"):"status-pending"===e||this.warn('unhandled key status change "'.concat(e,'" (keyId: ').concat(o,")")),n&&(l.eventNames().length?l.emit("error",n):this.handleError(n))},d=e._onkeystatuseschange=t=>{if(!e.mediaKeysSession)return void l.emit("error",new Error("invalid state"));const n=this.getKeyStatuses(e);if(!Object.keys(n).some(e=>"status-pending"!==n[e]))return;if("expired"===n[o])return this.log("Expired key ".concat(jd(n),' in key-session "').concat(e.mediaKeysSession.sessionId,'"')),void this.renewKeySession(e);let i=n[o];var r;i?u(i,e):(e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(r=e.keyStatusTimeouts)[o]||(r[o]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const t=this.getKeyStatus(e.decryptdata);if(t&&"status-pending"!==t)return this.log("No status for keyId ".concat(o,' in key-session "').concat(e.mediaKeysSession.sessionId,'". Using session key-status ').concat(t," from other session.")),u(t,e);this.log("key status for ".concat(o,' in key-session "').concat(e.mediaKeysSession.sessionId,'" timed out after 0ms')),i="internal-error",u(i,e)},0)),this.log("No status for keyId ".concat(o," (").concat(jd(n),").")))};Xf(e.mediaKeysSession,"message",c),Xf(e.mediaKeysSession,"keystatuseschange",d);const h=new Promise((e,t)=>{l.on("error",t),l.on("resolved",e)});return e.mediaKeysSession.generateRequest(t,n).then(()=>{this.log('Request generated for key-session "'.concat(e.mediaKeysSession.sessionId,'" keyId: ').concat(o," URI: ").concat(s))}).catch(t=>{throw new ov({type:iu.KEY_SYSTEM_ERROR,details:ru.KEY_SYSTEM_NO_SESSION,error:t,decryptdata:e.decryptdata,fatal:!1},"Error generating key-session request: ".concat(t))}).then(()=>h).catch(t=>(l.removeAllListeners(),this.removeSession(e).then(()=>{throw t}))).then(()=>(l.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((n,i)=>{if("string"==typeof i&&"object"==typeof n){const e=i;i=n,n=e}const r="buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i);e.keySystem===sf.PLAYREADY&&16===r.length&&rf(r);const a=xu(r);"internal-error"===n&&(this.bannedKeyIds[a]=n),this.log('key status change "'.concat(n,'" for keyStatuses keyId: ').concat(a,' key-session "').concat(e.mediaKeysSession.sessionId,'"')),t[a]=n}),t}fetchServerCertificate(e){const t=this.config,n=new(0,t.loader)(t),i=this.getServerCertificateUrl(e);return i?(this.log('Fetching server certificate for "'.concat(e,'"')),new Promise((r,a)=>{const o={responseType:"arraybuffer",url:i},s=t.certLoadPolicy.default,l={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,n,i)=>{r(e.data)},onError:(t,n,r,s)=>{a(new ov({type:iu.KEY_SYSTEM_ERROR,details:ru.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:mu({url:o.url,data:void 0},t)},'"'.concat(e,'" certificate request failed (').concat(i,"). Status: ").concat(t.code," (").concat(t.text,")")))},onTimeout:(t,n,r)=>{a(new ov({type:iu.KEY_SYSTEM_ERROR,details:ru.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:{url:o.url,data:void 0}},'"'.concat(e,'" certificate request timed out (').concat(i,")")))},onAbort:(e,t,n)=>{a(new Error("aborted"))}};n.load(o,l,c)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((i,r)=>{e.setServerCertificate(n).then(r=>{this.log("setServerCertificate ".concat(r?"success":"not supported by CDM"," (").concat(n.byteLength,') on "').concat(t,'"')),i(e)}).catch(e=>{r(new ov({type:iu.KEY_SYSTEM_ERROR,details:ru.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(t=>this.updateKeySession(e,new Uint8Array(t)).catch(t=>{throw new ov({type:iu.KEY_SYSTEM_ERROR,details:ru.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:t,fatal:!1},t.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=(new DOMParser).parseFromString(n,"application/xml"),r=i.querySelectorAll("HttpHeader");if(r.length>0){let t;for(let n=0,i=r.length;n<i;n++){var a,o;t=r[n];const i=null==(a=t.querySelector("name"))?void 0:a.textContent,s=null==(o=t.querySelector("value"))?void 0:o.textContent;i&&s&&e.setRequestHeader(i,s)}}const s=i.querySelector("Challenge"),l=null==s?void 0:s.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return nf(atob(l))}setupLicenseXHR(e,t,n,i){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,n,i)}).catch(a=>{if(!n.decryptdata)throw a;return e.open("POST",t,!0),r.call(this.hls,e,t,n,i)}).then(n=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:n||i})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((i,r)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log("Sending license request to URL: ".concat(a));const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(4===o.readyState)if(200===o.status){this._requestLicenseFailureCount=0;let t=o.response;this.log("License received ".concat(t instanceof ArrayBuffer?t.byteLength:t));const n=this.config.licenseResponseCallback;if(n)try{t=n.call(this.hls,o,a,e)}catch(e){this.error(e)}i(t)}else{const s=n.errorRetry,l=s?s.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||o.status>=400&&o.status<500)r(new ov({type:iu.KEY_SYSTEM_ERROR,details:ru.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},"License Request XHR failed (".concat(a,"). Status: ").concat(o.status," (").concat(o.statusText,")")));else{const n=l-this._requestLicenseFailureCount+1;this.warn("Retrying license request, ".concat(n," attempts left")),this.requestLicense(e,t).then(i,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,t).then(t=>{let{xhr:n,licenseChallenge:i}=t;e.keySystem==sf.PLAYREADY&&(i=this.unpackPlayReadyKeyMessage(n,i)),n.send(i)}).catch(r)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,Xf(n,"encrypted",this.onMediaEncrypted),Xf(n,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(Qf(e,"encrypted",this.onMediaEncrypted),Qf(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const t=this.media,n=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,pf.clearKeyUriToKeyIdMap();const i=n.length;iv.CDMCleanupPromise=Promise.all(n.map(e=>this.removeSession(e)).concat((null==t||null==(e=t.setMediaKeys(null))?void 0:e.catch(e=>{this.log("Could not clear media keys: ".concat(e)),this.hls&&this.hls.trigger(au.ERROR,{type:iu.OTHER_ERROR,details:ru.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error("Could not clear media keys: ".concat(e))})}))||Promise.resolve())).catch(e=>{this.log("Could not close sessions and clear media keys: ".concat(e)),this.hls&&this.hls.trigger(au.ERROR,{type:iu.OTHER_ERROR,details:ru.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close sessions and clear media keys: ".concat(e))})}).then(()=>{i&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null,this.bannedKeyIds={}}onManifestLoaded(e,t){let{sessionKeys:n}=t;if(n&&this.config.emeEnabled&&!this.keyFormatPromise){const e=n.reduce((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e),[]);this.log("Selecting key-system from session-keys ".concat(e.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n,decryptdata:i}=e;if(t){this.log('Remove licenses and keys and close session "'.concat(t.sessionId,'" keyId: ').concat(xu((null==i?void 0:i.keyId)||[]))),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);r>-1&&this.mediaKeySessions.splice(r,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(e=>self.clearTimeout(a[e]));const{drmSystemOptions:o}=this.config;return(function(e){var t;return!(!e||"persistent-license"!==e.sessionType&&(null==(t=e.sessionTypes)||!t.some(e=>"persistent-license"===e)))}(o)?new Promise((e,n)=>{self.setTimeout(()=>n(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(e).catch(n)}):Promise.resolve()).catch(e=>{this.log("Could not remove session: ".concat(e)),this.hls&&this.hls.trigger(au.ERROR,{type:iu.OTHER_ERROR,details:ru.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error("Could not remove session: ".concat(e))})}).then(()=>t.close()).catch(e=>{this.log("Could not close session: ".concat(e)),this.hls&&this.hls.trigger(au.ERROR,{type:iu.OTHER_ERROR,details:ru.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close session: ".concat(e))})})}return Promise.resolve()}}function rv(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return xu(e.keyId)}function av(e,t){return e.keyId&&t.mediaKeysSession.keyStatuses.has(e.keyId)?t.mediaKeysSession.keyStatuses.get(e.keyId):e.matches(t.decryptdata)?t.keyStatus:void 0}iv.CDMCleanupPromise=void 0;class ov extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function sv(e,t){const n="output-restricted"===e,i=n?ru.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:ru.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new ov({type:iu.KEY_SYSTEM_ERROR,details:i,fatal:!1,decryptdata:t},n?"HDCP level output restricted":'key status changed to "'.concat(e,'"'))}class lv{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(au.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(au.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(au.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(au.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const i=performance.now();if(t){if(this.lastTime){const e=i-this.lastTime,r=n-this.lastDroppedFrames,a=t-this.lastDecodedFrames,o=1e3*r/e,s=this.hls;if(s.trigger(au.FPS_DROP,{currentDropped:r,currentDecoded:a,totalDroppedFrames:n}),o>0&&r>s.config.fpsDroppedMonitoringThreshold*a){let e=s.currentLevel;s.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===s.autoLevelCapping||s.autoLevelCapping>=e)&&(e-=1,s.trigger(au.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:s.currentLevel}),s.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function cv(e,t){let n;try{n=new Event("addtrack")}catch(e){n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)}function uv(e,t){const n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error("addCue is failed for: ".concat(t))}catch(n){Su.debug("[texttrack-utils]: ".concat(n));try{const n=new self.TextTrackCue(t.startTime,t.endTime,t.text);n.id=t.id,e.addCue(n)}catch(e){Su.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: ".concat(e))}}"disabled"===n&&(e.mode=n)}function dv(e,t){const n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues)for(let n=e.cues.length;n--;)t&&e.cues[n].removeEventListener("enter",t),e.removeCue(e.cues[n]);"disabled"===n&&(e.mode=n)}function hv(e,t,n,i){const r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&e.cues.length>0){const r=function(e,t,n){const i=[],r=function(e,t){if(t<=e[0].startTime)return 0;const n=e.length-1;if(t>e[n].endTime)return-1;let i,r=0,a=n;for(;r<=a;)if(i=Math.floor((a+r)/2),t<e[i].startTime)a=i-1;else{if(!(t>e[i].startTime&&r<n))return i;r=i+1}return e[r].startTime-t<t-e[a].startTime?r:a}(e,t);if(r>-1)for(let a=r,o=e.length;a<o;a++){const r=e[a];if(r.startTime>=t&&r.endTime<=n)i.push(r);else if(r.startTime>n)return i}return i}(e.cues,t,n);for(let t=0;t<r.length;t++)(!i||i(r[t]))&&e.removeCue(r[t])}"disabled"===r&&(e.mode=r)}function fv(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n];("subtitles"===i.kind||"captions"===i.kind)&&i.label&&t.push(e[n])}return t}class pv extends Hg{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const t=fv(this.media.textTracks);for(let n=0;n<t.length;n++)if("hidden"===t[n].mode)e=t[n];else if("showing"===t[n].mode){e=t[n];break}const n=this.findTrackForTextTrack(e);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(au.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(au.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(au.MANIFEST_LOADING,this.onManifestLoading,this),e.on(au.MANIFEST_PARSED,this.onManifestParsed,this),e.on(au.LEVEL_LOADING,this.onLevelLoading,this),e.on(au.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(au.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(au.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(au.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(au.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(au.MANIFEST_LOADING,this.onManifestLoading,this),e.off(au.MANIFEST_PARSED,this.onManifestParsed,this),e.off(au.LEVEL_LOADING,this.onLevelLoading,this),e.off(au.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(au.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(au.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const i=!!t.transferMedia;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i||fv(n.textTracks).forEach(e=>{dv(e)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:i,details:r}=t,a=this.tracksInGroup[n];if(!a||a.groupId!==i)return void this.warn("Subtitle track with id:".concat(n," and group:").concat(i," not found in active group ").concat(null==a?void 0:a.groupId));const o=a.details;a.details=t.details,this.log("Subtitle track ".concat(n,' "').concat(a.name,'" lang:').concat(a.lang," group:").concat(i," loaded [").concat(r.startSN,"-").concat(r.endSN,"]")),n===this.trackId&&this.playlistLoaded(n,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,i=this.groupIds;let r=this.currentTrack;if(!n||(null==i?void 0:i.length)!==(null==n?void 0:n.length)||null!=n&&n.some(e=>-1===(null==i?void 0:i.indexOf(e)))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!n||-1!==n.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.subtitlePreference;if(!r&&t){this.selectDefaultTrack=!1;const n=Wd(t,e);if(n>-1)r=e[n];else{const e=Wd(t,this.tracks);r=this.tracks[e]}}let i=this.findTrackId(r);-1===i&&r&&(i=this.findTrackId(null));const a={subtitleTracks:e};this.log("Updating subtitle tracks, ".concat(e.length,' track(s) found in "').concat(null==n?void 0:n.join(","),'" group-id')),this.hls.trigger(au.SUBTITLE_TRACKS_UPDATED,a),-1!==i&&-1===this.trackId&&this.setSubtitleTrack(i)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const r=t[i];if((!n||r.default)&&(n||e)&&(!e||Yd(r,e)))return i}if(e){for(let n=0;n<t.length;n++){const i=t[n];if(zg(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<t.length;n++){const i=t[n];if(zg(e.attrs,i.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){if(Zg(t[n],e))return n}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===cu&&t.context.id===this.trackId&&(!this.groupIds||-1!==this.groupIds.indexOf(t.context.groupId))&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(-1===e.id)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&Yd(e,n))return n;const i=Wd(e,this.tracksInGroup);if(i>-1){const e=this.tracksInGroup[i];return this.setSubtitleTrack(i),e}if(n)return null;{const n=Wd(e,t);if(n>-1)return t[n]}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,i=e.groupId,r=this.getUrlWithDirectives(e.url,t),a=e.details,o=null==a?void 0:a.age;this.log("Loading subtitle ".concat(n,' "').concat(e.name,'" lang:').concat(e.lang," group:").concat(i).concat(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"").concat(o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""," ").concat(r)),this.hls.trigger(au.SUBTITLE_TRACK_LOADING,{url:r,id:n,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=fv(e.textTracks),n=this.currentTrack;let i;if(n&&(i=t.filter(e=>Zg(n,e))[0],i||this.warn('Unable to find subtitle TextTrack with name "'.concat(n.name,'" and language "').concat(n.lang,'"'))),[].slice.call(t).forEach(e=>{"disabled"!==e.mode&&e!==i&&(e.mode="disabled")}),i){const e=this.subtitleDisplay?"showing":"hidden";i.mode!==e&&(i.mode=e)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(e<-1||e>=t.length||!eu(e))return void this.warn("Invalid subtitle track id: ".concat(e));this.selectDefaultTrack=!1;const n=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i)return void this.hls.trigger(au.SUBTITLE_TRACK_SWITCH,{id:e});const r=!!i.details&&!i.details.live;if(e===this.trackId&&i===n&&r)return;this.log("Switching to subtitle-track ".concat(e)+(i?' "'.concat(i.name,'" lang:').concat(i.lang," group:").concat(i.groupId):""));const{id:a,groupId:o="",name:s,type:l,url:c}=i;this.hls.trigger(au.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:s,type:l,url:c});const u=this.switchParams(i.url,null==n?void 0:n.details,i.details);this.loadPlaylist(u)}}function gv(e){let t=5381,n=e.length;for(;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()}const mv=.025;let vv=function(e){return e[e.Point=0]="Point",e[e.Range=1]="Range",e}({});function yv(e,t,n){return"".concat(e.identifier,"-").concat(n+1,"-").concat(gv(t))}class _v{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,null==(e=this.assetListLoader)||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;return!(e<=0||isNaN(n))&&(0===n||((null==(t=this.assetList[e])?void 0:t.startOffset)||0)>n)}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Ev(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(0===this.startTime||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime;return t-Ev(t,e)<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=eu(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Ev(e,t)}return e}get appendInPlace(){return!!this.appendInPlaceStarted||!this.appendInPlaceDisabled&&!(this.cue.once||this.cue.pre||!this.startIsAligned||!(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<mv))}set appendInPlace(e){this.appendInPlaceStarted?this.resetOnResume=!e:this.appendInPlaceDisabled=!e}get timelineStart(){return null!==this._timelineStart?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return t=null!==this._duration?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return"RANGE"===this.dateRange.attr["X-TIMELINE-OCCUPIES"]?vv.Range:vv.Point}get supplementsPrimary(){return"PRIMARY"===this.dateRange.attr["X-TIMELINE-STYLE"]}get contentMayVary(){return"NO"!==this.dateRange.attr["X-CONTENT-MAY-VARY"]}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||null!==this.assetListResponse}toString(){return function(e){return'["'.concat(e.identifier,'" ').concat(e.cue.pre?"<pre>":e.cue.post?"<post>":"").concat(e.timelineStart.toFixed(2),"-").concat(e.resumeTime.toFixed(2),"]")}(this)}}function Ev(e,t){return e-t.start<t.duration/2&&!(Math.abs(e-(t.start+t.duration))<mv)?t.start:t.start+t.duration}function bv(e,t,n){const i=new self.URL(e,n);return"data:"!==i.protocol&&i.searchParams.set("_HLS_primary_id",t),i}function Tv(e,t){for(;null!=(n=e.assetList[++t])&&n.error;)var n;return t}function Sv(e){const t=e.timelineStart,n=e.duration||0;return'["'.concat(e.identifier,'" ').concat(t.toFixed(2),"-").concat((t+n).toFixed(2),"]")}class wv{constructor(e,t,n,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(au.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new e(t);this.interstitial=n,this.assetItem=i;const a=()=>{this.hasDetails=!0};r.once(au.LEVEL_LOADED,a),r.once(au.AUDIO_TRACK_LOADED,a),r.once(au.SUBTITLE_TRACK_LOADED,a),r.on(au.MEDIA_ATTACHING,(e,t)=>{let{media:n}=t;this.removeMediaListeners(),this.mediaAttached=n,this.interstitial.playoutLimit&&(n.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&r.on(au.BUFFER_APPENDED,()=>{const e=this.bufferedEnd;this.reachedPlayout(e)&&(this._bufferedEosTime=e,r.trigger(au.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=bv(t,e.config.primarySessionId||"").href}catch(e){}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if(null!=(t=this.hls)&&t.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),i=this.timelineOffset,r=Bh.bufferInfo(e,i,0);return this.getAssetTime(r.end)>=n-.02}reachedPlayout(e){const t=this.interstitial.playoutLimit;return this.startOffset+e>=t}get destroyed(){var e;return!(null!=(e=this.hls)&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return(null==(e=this.hls)?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Bh.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const n=t-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return(null==(e=this.hls)?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){var e;this.mediaAttached&&(null!=(e=this.hls)&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd))}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),null==(t=this.hls)||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,null==(e=this.hls)||e.detachMedia()}resumeBuffering(){var e;null==(e=this.hls)||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.hls)||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),(null==(e=this.hls)?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=e=>delete e.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){var i;null==(i=this.hls)||i.on(e,t)}once(e,t,n){var i;null==(i=this.hls)||i.once(e,t)}off(e,t,n){var i;null==(i=this.hls)||i.off(e,t)}toString(){var e;return"HlsAssetPlayer: ".concat(Sv(this.assetItem)," ").concat(null==(e=this.hls)?void 0:e.sessionId," ").concat(this.appendInPlace?"append-in-place":"")}}class Av extends vu{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[n]||(void 0===t&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&null!=(r=i[n])&&r.event;){var r;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let i=0;i<n.length;i++){let r=n[i];if(t&&"primary"!==t&&(r=r[t]),e===r.start||e>r.start&&e<r.end)return i}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let i=e;i<=t&&n[i];i++){const e=n[i].event;if(null!=e&&e.restrictions.jump&&!e.appendInPlace)return i}return-1}findEventIndex(e){const t=this.items;if(t)for(let i=t.length;i--;){var n;if((null==(n=t[i].event)?void 0:n.identifier)===e)return i}return-1}findAssetIndex(e,t){const n=e.assetList,i=n.length;if(i>1)for(let e=0;e<i;e++){const r=n[e];if(!r.error){const n=r.timelineStart;if(t===n||t>n&&(t<n+(r.duration||0)||e===i-1))return e}}return 0}get assetIdAtEnd(){var e;const t=null==(e=this.items)||null==(e=e[this.length-1])?void 0:e.event;if(t){const e=t.assetList,n=e[e.length-1];if(n)return n.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:i}=n,r=this.events,a=this.parseDateRanges(i,{url:n.url},t),o=Object.keys(i),s=r?r.filter(e=>!o.includes(e.identifier)):[];a.length&&a.sort((e,t)=>{const n=e.cue.pre,i=e.cue.post,r=t.cue.pre,a=t.cue.post;if(n&&!r)return-1;if(r&&!n||i&&!a)return 1;if(a&&!i)return-1;if(!(n||r||i||a)){const n=e.startTime,i=t.startTime;if(n!==i)return n-i}return e.dateRange.tagOrder-t.dateRange.tagOrder}),this.events=a,s.forEach(e=>{this.removeEvent(e)}),this.updateSchedule(e,s)}updateSchedule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=this.events||[];if(i.length||t.length||this.length<2){const r=this.items,a=this.parseSchedule(i,e);(n||t.length||(null==r?void 0:r.length)!==a.length||a.some((e,t)=>Math.abs(e.playout.start-r[t].playout.start)>.005||Math.abs(e.playout.end-r[t].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,r))}}parseDateRanges(e,t,n){const i=[],r=Object.keys(e);for(let a=0;a<r.length;a++){const o=r[a],s=e[o];if(s.isInterstitial){let e=this.eventMap[o];e?e.setDateRange(s):(e=new _v(s,t),this.eventMap[o]=e,!1===n&&(e.appendInPlace=n)),i.push(e)}}return i}parseSchedule(e,t){const n=[],i=t.main.details,r=i.live?1/0:i.edge;let a=0;if((e=e.filter(e=>!(e.error||e.cue.once&&e.hasPlayed))).length){this.resolveOffsets(e,t);let i=0,s=0;if(e.forEach((t,o)=>{const l=t.cue.pre,c=t.cue.post,u=e[o-1]||null,d=t.appendInPlace,h=c?r:t.startOffset,f=t.duration,p=t.timelineOccupancy===vv.Range?f:0,g=t.resumptionOffset,m=(null==u?void 0:u.startTime)===h,v=h+t.cumulativeDuration;let y=d?v+f:h+g;if(l||!c&&h<=0){const e=s;s+=p,t.timelineStart=v;const i=a;a+=f,n.push({event:t,start:v,end:y,playout:{start:i,end:a},integrated:{start:e,end:s}})}else{if(!(h<=r))return;{if(!m){const r=h-i;if(r>.033){const l=i,c=s;s+=r;const u=a;a+=r;const d={previousEvent:e[o-1]||null,nextEvent:t,start:l,end:l+r,playout:{start:u,end:a},integrated:{start:c,end:s}};n.push(d)}else r>0&&u&&(u.cumulativeDuration+=r,n[n.length-1].end=h)}c&&(y=v),t.timelineStart=v;const r=s;s+=p;const l=a;a+=f,n.push({event:t,start:v,end:y,playout:{start:l,end:a},integrated:{start:r,end:s}})}}const _=t.resumeTime;i=c||_>r?r:_}),i<r){var o;const e=i,t=s,l=r-i;s+=l;const c=a;a+=l,n.push({previousEvent:(null==(o=n[n.length-1])?void 0:o.event)||null,nextEvent:null,start:i,end:e+l,playout:{start:c,end:a},integrated:{start:t,end:s}})}this.setDurations(r,a,s)}else n.push({previousEvent:null,nextEvent:null,start:0,end:r,playout:{start:0,end:r},integrated:{start:0,end:r}}),this.setDurations(r,r,r);return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,i=n.live?1/0:n.edge;let r=0,a=-1;e.forEach((o,s)=>{const l=o.cue.pre,c=o.cue.post,u=l?0:c?i:o.startTime;this.updateAssetDurations(o),a===u?o.cumulativeDuration=r:(r=0,a=u),!c&&o.snapOptions.in&&(o.resumeAnchor=eh(null,n.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)),!o.appendInPlace&&s+1<e.length&&e[s+1].startTime-e[s].resumeTime<.033&&(e[s+1].appendInPlace=!1,e[s+1].appendInPlace&&this.warn("Could not change append strategy for abutting event ".concat(o)));const d=eu(o.resumeOffset)?o.resumeOffset:o.duration;r+=d})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,i=e.startTime+e.resumptionOffset;return Math.abs(n-i)>mv?(this.log('"'.concat(e.identifier,'" resumption ').concat(n," not aligned with estimated timeline end ").concat(i)),!1):!Object.keys(t).some(i=>{const r=t[i].details,a=r.edge;if(n>=a)return this.log('"'.concat(e.identifier,'" resumption ').concat(n," past ").concat(i," playlist end ").concat(a)),!1;const o=eh(null,r.fragments,n);if(!o)return this.log('"'.concat(e.identifier,'" resumption ').concat(n," does not align with any fragments in ").concat(i," playlist (").concat(r.fragStart,"-").concat(r.fragmentEnd,")")),!0;const s="audio"===i?.175:0;return!(Math.abs(o.start-n)<mv+s||Math.abs(o.end-n)<mv+s)&&(this.log('"'.concat(e.identifier,'" resumption ').concat(n," not aligned with ").concat(i," fragment bounds (").concat(o.start,"-").concat(o.end," sn: ").concat(o.sn," cc: ").concat(o.cc,")")),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,i=!1,r=!1;for(let a=0;a<e.assetList.length;a++){const o=e.assetList[a],s=t+n;o.startOffset=n,o.timelineStart=s,i||(i=null===o.duration),r||(r=!!o.error);n+=o.error?0:o.duration||0}e.duration=i&&!r?Math.max(n,e.duration):n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Rv(e){return"[".concat(e.event?'"'+e.event.identifier+'"':"primary",": ").concat(e.start.toFixed(2),"-").concat(e.end.toFixed(2),"]")}class xv{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let i;try{i=bv(n,this.hls.sessionId,e.baseUrl)}catch(t){const i=this.assignAssetListError(e,ru.ASSET_LIST_LOAD_ERROR,t,n);return void this.hls.trigger(au.ERROR,i)}t&&"data:"!==i.protocol&&i.searchParams.set("_HLS_start_offset",""+t);const r=this.hls.config,a=new(0,r.loader)(r),o={responseType:"json",url:i.href},s=r.interstitialAssetListLoadPolicy.default,l={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(t,n,i,r)=>{const a=t.data,o=null==a?void 0:a.ASSETS;if(!Array.isArray(o)){const t=this.assignAssetListError(e,ru.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),i.url,n,r);return void this.hls.trigger(au.ERROR,t)}e.assetListResponse=a,this.hls.trigger(au.ASSET_LIST_LOADED,{event:e,assetListResponse:a,networkDetails:r})},onError:(t,n,i,r)=>{const a=this.assignAssetListError(e,ru.ASSET_LIST_LOAD_ERROR,new Error("Error loading X-ASSET-LIST: HTTP status ".concat(t.code," ").concat(t.text," (").concat(n.url,")")),n.url,r,i);this.hls.trigger(au.ERROR,a)},onTimeout:(t,n,i)=>{const r=this.assignAssetListError(e,ru.ASSET_LIST_LOAD_TIMEOUT,new Error("Timeout loading X-ASSET-LIST (".concat(n.url,")")),n.url,t,i);this.hls.trigger(au.ERROR,r)}};return a.load(o,l,c),this.hls.trigger(au.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,t,n,i,r,a){return e.error=n,{type:iu.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:n,networkDetails:a,stats:r}}}function Iv(e){null==e||e.play().catch(()=>{})}function Lv(e,t){return"[".concat(e,"] Advancing timeline position to ").concat(t)}class Mv extends dp{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",uu.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(au.LEVEL_LOADED,this.onLevelLoaded,this),e.on(au.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(au.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(au.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(au.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(au.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(au.LEVEL_LOADED,this.onLevelLoaded,this),e.off(au.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(au.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(au.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(au.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(au.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=ep,this.setInterval(500),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:i}=t;if(this.fragContextChanged(n)||(Fu(n)&&(this.fragPrevious=n),this.state=ep),!i)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let a;const o=n.start;for(let e=0;e<r.length;e++)if(o>=r[e].start&&o<=r[e].end){a=r[e];break}const s=n.start+n.duration;a?a.end=s:(a={start:o,end:s},r.push(a)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:i}=t;if(0===n&&i!==Number.POSITIVE_INFINITY){const e=i-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach(t=>{for(let n=0;n<t.length;)if(t[n].end<=e)t.shift();else{if(!(t[n].start<e))break;t[n].start=e,n++}}),this.fragmentTracker.removeFragmentsInRange(n,e,uu.SUBTITLE)}}onError(e,t){const n=t.frag;(null==n?void 0:n.type)===uu.SUBTITLE&&(t.details===ru.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==$f&&(this.state=ep))}onSubtitleTracksUpdated(e,t){let{subtitleTracks:n}=t;this.levels&&jg(this.levels,n)?this.levels=n.map(e=>new Vd(e)):(this.tracksBuffered=[],this.levels=n.map(e=>{const t=new Vd(e);return this.tracksBuffered[t.id]=[],t}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,uu.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,null==(n=this.levels)||!n.length||-1===this.currentTrackId)return void this.clearInterval();const i=this.levels[this.currentTrackId];null!=i&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==$f&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:i,levels:r}=this,{details:a,id:o}=t;if(!r)return void this.warn("Subtitle tracks were reset while loading level ".concat(o));const s=r[o];if(o>=r.length||!s)return;this.log("Subtitle track ".concat(o," loaded [").concat(a.startSN,",").concat(a.endSN,"]").concat(a.lastPartSn?"[part-".concat(a.lastPartSn,"-").concat(a.lastPartIndex,"]"):"",",duration:").concat(a.totalduration)),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(a.live||null!=(n=s.details)&&n.live){if(a.deltaUpdateFailed)return;const e=this.mainDetails;if(!e)return void(this.startFragRequested=!1);const t=e.fragments[0];var c;if(s.details)l=this.alignPlaylists(a,s.details,null==(c=this.levelLastLoaded)?void 0:c.details),0===l&&t&&(l=t.start,Ff(a,l));else a.hasProgramDateTime&&e.hasProgramDateTime?(Kf(a,e),l=a.fragmentStart):t&&(l=t.start,Ff(a,l));e&&!this.startFragRequested&&this.setStartPosition(e,l)}s.details=a,this.levelLastLoaded=s,o===i&&(this.hls.trigger(au.SUBTITLE_TRACK_UPDATED,{details:a,id:o,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===ep&&(eh(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),s.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,i=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&null!=i&&i.key&&i.iv&&$h(i.method)){const e=performance.now();this.decrypter.decrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer,ef(i.method)).catch(e=>{throw r.trigger(au.ERROR,{type:iu.MEDIA_ERROR,details:ru.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e}).then(n=>{const i=performance.now();r.trigger(au.FRAG_DECRYPTED,{frag:t,payload:n,stats:{tstart:e,tdecrypt:i}})}).catch(e=>{this.warn("".concat(e.name,": ").concat(e.message)),this.state=ep})}}doTick(){if(this.media){if(this.state===ep){const{currentTrackId:e,levels:t}=this,n=null==t?void 0:t[e];if(!n||!t.length||!n.details||this.waitForLive(n))return;const{config:i}=this,r=this.getLoadPosition(),a=Bh.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,i.maxBufferHole),{end:o,len:s}=a,l=n.details;if(s>this.hls.maxBufferLength+l.levelTargetDuration)return;const c=l.fragments,u=c.length,d=l.edge;let h=null;const f=this.fragPrevious;if(o<d){const e=i.maxFragLookUpTolerance,t=o>d-e?0:e;h=eh(f,c,Math.max(c[0].start,o),t),!h&&f&&f.start<c[0].start&&(h=c[0])}else h=c[u-1];if(h=this.filterReplacedPrimary(h,n.details),!h)return;const p=c[h.sn-l.startSN-1];if(p&&p.cc===h.cc&&this.fragmentTracker.getState(p)===mh&&(h=p),this.fragmentTracker.getState(h)===mh){const e=this.mapToInitFragWhenRequired(h);e&&this.loadFragment(e,n,o)}}}else this.state=ep}loadFragment(e,t,n){Fu(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new Cv(this.tracksBuffered[this.currentTrackId]||[])}}class Cv{constructor(e){this.buffered=void 0;const t=(t,n,i)=>{if((n>>>=0)>i-1)throw new DOMException("Failed to execute '".concat(t,"' on 'TimeRanges': The index provided (").concat(n,") is greater than the maximum bound (").concat(i,")"));return e[n][t]};this.buffered={get length(){return e.length},end:n=>t("end",n,e.length),start:n=>t("start",n,e.length)}}}const Pv={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Dv=e=>String.fromCharCode(Pv[e]||e),Ov=15,Nv=100,kv={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Fv={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Bv={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Uv={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Vv=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Gv{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n="function"==typeof t?t():t;Su.log("".concat(this.time," [").concat(e,"] ").concat(n))}}}const Hv=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class jv{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const i=t[n];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class zv{constructor(){this.uchar=" ",this.penState=new jv}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class Zv{constructor(e){this.chars=[],this.pos=0,this.currPenState=new jv,this.cueStartTime=null,this.logger=void 0;for(let e=0;e<Nv;e++)this.chars.push(new zv);this.logger=e}equals(e){for(let t=0;t<Nv;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Nv;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Nv;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Nv&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Nv)}moveCursor(e){const t=this.pos+e;if(e>1)for(let e=this.pos+1;e<t+1;e++)this.chars[e].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Dv(e);this.pos>=Nv?this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<Nv;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<Nv;n++){const i=this.chars[n].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class qv{constructor(e){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Ov;t++)this.rows.push(new Zv(e));this.logger=e}reset(){for(let e=0;e<Ov;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let n=0;n<Ov;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<Ov;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Ov;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+jd(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let e=0;e<Ov;e++)this.rows[e].clear();const e=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){const i=n.rows[e].cueStartTime,r=this.logger.time;if(null!==i&&null!==r&&i<r)for(let i=0;i<this.nrRollUpRows;i++)this.rows[t-this.nrRollUpRows+i+1].copy(n.rows[e+i])}}this.currRow=t;const n=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,i=Math.max(t-1,0);n.setCursor(e.indent),e.color=n.chars[i].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+jd(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",i=-1;for(let n=0;n<Ov;n++){const r=this.rows[n].getTextString();r&&(i=n+1,e?t.push("Row "+i+": '"+r+"'"):t.push(r.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n}getTextAndFormat(){return this.rows}}class Wv{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new qv(n),this.nonDisplayedMemory=new qv(n),this.lastOutputScreen=new qv(n),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[n]}this.logger.log(2,"MIDROW: "+jd(t)),this.writeScreen.setPen(t)}outputDataUpdate(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Yv{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;const i=this.logger=new Gv;this.channels=[null,new Wv(e,t,i),new Wv(e+1,n,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let e=0;e<t.length;e+=2){const n=127&t[e],i=127&t[e+1];let r=!1,a=null;if(0===n&&0===i)continue;this.logger.log(3,()=>"["+Hv([t[e],t[e+1]])+"] -> ("+Hv([n,i])+")");const o=this.cmdHistory;if(n>=16&&n<=31){if(Xv(n,i,o)){Kv(null,null,o),this.logger.log(3,()=>"Repeated command ("+Hv([n,i])+") is dropped");continue}Kv(n,i,this.cmdHistory),r=this.parseCmd(n,i),r||(r=this.parseMidrow(n,i)),r||(r=this.parsePAC(n,i)),r||(r=this.parseBackgroundAttributes(n,i))}else Kv(null,null,o);if(!r&&(a=this.parseChars(n,i),a)){const e=this.currentChannel;e&&e>0?this.channels[e].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!r&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Hv([n,i])+" orig: "+Hv([t[e],t[e+1]]))}}parseCmd(e,t){if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;const n=20===e||21===e||23===e?1:2,i=this.channels[n];return 20===e||21===e||28===e||29===e?32===t?i.ccRCL():33===t?i.ccBS():34===t?i.ccAOF():35===t?i.ccAON():36===t?i.ccDER():37===t?i.ccRU(2):38===t?i.ccRU(3):39===t?i.ccRU(4):40===t?i.ccFON():41===t?i.ccRDC():42===t?i.ccTR():43===t?i.ccRTD():44===t?i.ccEDM():45===t?i.ccCR():46===t?i.ccENM():47===t&&i.ccEOC():i.ccTO(t-32),this.currentChannel=n,!0}parseMidrow(e,t){let n=0;if((17===e||25===e)&&t>=32&&t<=47){if(n=17===e?1:2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[n];return!!i&&(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Hv([e,t])+")"),!0)}return!1}parsePAC(e,t){let n;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;const i=e<=23?1:2;n=t>=64&&t<=95?1===i?kv[e]:Bv[e]:1===i?Fv[e]:Uv[e];const r=this.channels[i];return!!r&&(r.setPAC(this.interpretPAC(n,t)),this.currentChannel=i,!0)}interpretPAC(e,t){let n;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,i.underline=!(1&~n),n<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((n-16)/2),i}parseChars(e,t){let n,i=null,r=null;if(e>=25?(n=2,r=e-8):(n=1,r=e),r>=17&&r<=19){let e;e=17===r?t+80:18===r?t+112:t+144,this.logger.log(2,()=>"Special char '"+Dv(e)+"' in channel "+n),i=[e]}else e>=32&&e<=127&&(i=0===t?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+Hv(i).join(",")),i}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;let n;const i={};16===e||24===e?(n=Math.floor((t-32)/2),i.background=Vv[n],t%2==1&&(i.background=i.background+"_semi")):45===t?i.background="transparent":(i.foreground="black",47===t&&(i.underline=!0));const r=e<=23?1:2;return this.channels[r].setBkgData(i),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Kv(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function Kv(e,t,n){n.a=e,n.b=t}function Xv(e,t,n){return n.a===e&&n.b===t}var Qv=function(){if(null!=of&&of.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function n(e,t){if("string"!=typeof t||!Array.isArray(e))return!1;const n=t.toLowerCase();return!!~e.indexOf(n)&&n}function i(e){return n(t,e)}function r(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];let r=1;for(;r<arguments.length;r++){const t=arguments[r];for(const n in t)e[n]=t[n]}return e}function a(t,a,o){const s=this,l={enumerable:!0};s.hasBeenReset=!1;let c="",u=!1,d=t,h=a,f=o,p=null,g="",m=!0,v="auto",y="start",_=50,E="middle",b=50,T="middle";Object.defineProperty(s,"id",r({},l,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(s,"pauseOnExit",r({},l,{get:function(){return u},set:function(e){u=!!e}})),Object.defineProperty(s,"startTime",r({},l,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",r({},l,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"text",r({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(s,"region",r({},l,{get:function(){return p},set:function(e){p=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"vertical",r({},l,{get:function(){return g},set:function(t){const i=function(t){return n(e,t)}(t);if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");g=i,this.hasBeenReset=!0}})),Object.defineProperty(s,"snapToLines",r({},l,{get:function(){return m},set:function(e){m=!!e,this.hasBeenReset=!0}})),Object.defineProperty(s,"line",r({},l,{get:function(){return v},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"lineAlign",r({},l,{get:function(){return y},set:function(e){const t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",r({},l,{get:function(){return _},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",r({},l,{get:function(){return E},set:function(e){const t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",r({},l,{get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"align",r({},l,{get:function(){return T},set:function(e){const t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");T=t,this.hasBeenReset=!0}})),s.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class Jv{decode(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function $v(e){function t(e,t,n,i){return 3600*(0|e)+60*(0|t)+(0|n)+parseFloat(i||0)}const n=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?t(n[2],n[3],0,n[4]):t(n[1],n[2],n[3],n[4]):null}class ey{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&""!==t&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let i=0;i<n.length;++i)if(t===n[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function ty(e,t,n,i){const r=i?e.split(i):[e];for(const e in r){if("string"!=typeof r[e])continue;const i=r[e].split(n);if(2!==i.length)continue;t(i[0],i[1])}}const ny=new Qv(0,0,""),iy="middle"===ny.align?"middle":"center";function ry(e,t,n){const i=e;function r(){const t=$v(e);if(null===t)throw new Error("Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function a(){e=e.replace(/^\s+/,"")}if(a(),t.startTime=r(),a(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.slice(3),a(),t.endTime=r(),a(),function(e,t){const i=new ey;ty(e,function(e,t){let r;switch(e){case"region":for(let r=n.length-1;r>=0;r--)if(n[r].id===t){i.set(e,n[r].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":r=t.split(","),i.integer(e,r[0]),i.percent(e,r[0])&&i.set("snapToLines",!1),i.alt(e,r[0],["auto"]),2===r.length&&i.alt("lineAlign",r[1],["start",iy,"end"]);break;case"position":r=t.split(","),i.percent(e,r[0]),2===r.length&&i.alt("positionAlign",r[1],["start",iy,"end","line-left","line-right","auto"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start",iy,"end","left","right"])}},/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");let r=i.get("line","auto");"auto"===r&&-1===ny.line&&(r=-1),t.line=r,t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100),t.align=i.get("align",iy);let a=i.get("position","auto");"auto"===a&&50===ny.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}(e,t)}function ay(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class oy{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Jv,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function n(){let e=t.buffer,n=0;for(e=ay(e);n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;const i=e.slice(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.slice(n),i}function i(e){ty(e,function(e,t){},/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=n();const i=e.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(null==i||!i[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let r=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(r?r=!1:e=n(),t.state){case"HEADER":/:/.test(e)?i(e):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new Qv(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{ry(e,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const n=-1!==e.indexOf("--\x3e");if(!e||n&&(r=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const sy=/\r\n|\n\r|\n|\r/g,ly=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.slice(n,n+t.length)===t};function cy(e,t,n){return gv(e.toString())+gv(t.toString())+gv(n)}function uy(e,t,n,i,r,a,o){const s=new oy,l=Ru(new Uint8Array(e)).trim().replace(sy,"\n").split("\n"),c=[],u=t?function(e){return bg(e,9e4,1/(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1))}(t.baseTime,t.timescale):0;let d,h="00:00.000",f=0,p=0,g=!0;s.oncue=function(e){const a=n[i];let o=n.ccOffset;const s=(f-u)/9e4;if(null!=a&&a.new&&(void 0!==p?o=n.ccOffset=a.start:function(e,t,n){let i=e[t],r=e[i.prevCC];if(!r||!r.new&&i.new)return e.ccOffset=e.presentationOffset=i.start,void(i.new=!1);for(;null!=(a=r)&&a.new;){var a;e.ccOffset+=i.start-r.start,i.new=!1,i=r,r=e[i.prevCC]}e.presentationOffset=n}(n,i,s)),s){if(!t)return void(d=new Error("Missing initPTS for VTT MPEGTS"));o=s-n.presentationOffset}const l=e.endTime-e.startTime,h=Ig(9e4*(e.startTime+o-p),9e4*r)/9e4;e.startTime=Math.max(h,0),e.endTime=Math.max(h+l,0);const g=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(g)),e.id||(e.id=cy(e.startTime,e.endTime,g)),e.endTime>0&&c.push(e)},s.onparsingerror=function(e){d=e},s.onflush=function(){d?o(d):a(c)},l.forEach(e=>{if(g){if(ly(e,"X-TIMESTAMP-MAP=")){g=!1,e.slice(16).split(",").forEach(e=>{ly(e,"LOCAL:")?h=e.slice(6):ly(e,"MPEGTS:")&&(f=parseInt(e.slice(7)))});try{p=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(eu(t)&&eu(n)&&eu(i)&&eu(r)))throw Error("Malformed X-TIMESTAMP-MAP: Local:".concat(e));return t+=1e3*n,t+=6e4*i,t+=36e5*r,t}(h)/1e3}catch(e){d=e}return}""===e&&(g=!1)}s.parse(e+"\n")}),s.flush()}const dy="stpp.ttml.im1t",hy=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,fy=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,py={left:"start",center:"center",right:"end",start:"start",end:"end"};function gy(e,t,n,i){const r=Ku(new Uint8Array(e),["mdat"]);if(0===r.length)return void i(new Error("Could not parse IMSC1 mdat"));const a=r.map(e=>Ru(e)),o=function(e,t){return bg(e,t,1/(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1),arguments.length>3&&void 0!==arguments[3]&&arguments[3])}(t.baseTime,1,t.timescale);try{a.forEach(e=>n(function(e,t){const n=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},r=Object.keys(i).reduce((e,t)=>(e[t]=n.getAttribute("ttp:".concat(t))||i[t],e),{}),a="preserve"!==n.getAttribute("xml:space"),o=vy(my(n,"styling","style")),s=vy(my(n,"layout","region")),l=my(n,"body","[begin]");return[].map.call(l,e=>{const n=yy(e,a);if(!n||!e.hasAttribute("begin"))return null;const i=by(e.getAttribute("begin"),r),l=by(e.getAttribute("dur"),r);let c=by(e.getAttribute("end"),r);if(null===i)throw Ey(e);if(null===c){if(null===l)throw Ey(e);c=i+l}const u=new Qv(i-t,c-t,n);u.id=cy(u.startTime,u.endTime,u.text);const d=function(e,t,n){const i="http://www.w3.org/ns/ttml#styling";let r=null;const a=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;return o&&n.hasOwnProperty(o)&&(r=n[o]),a.reduce((n,a)=>{const o=_y(t,i,a)||_y(e,i,a)||_y(r,i,a);return o&&(n[a]=o),n},{})}(s[e.getAttribute("region")],o[e.getAttribute("style")],o),{textAlign:h}=d;if(h){const e=py[h];e&&(u.lineAlign=e),u.align=h}return pu(u,d),u}).filter(e=>null!==e)}(e,o)))}catch(e){i(e)}}function my(e,t,n){const i=e.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(n)):[]}function vy(e){return e.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function yy(e,t){return[].slice.call(e.childNodes).reduce((e,n,i)=>{var r;return"br"===n.nodeName&&i?e+"\n":null!=(r=n.childNodes)&&r.length?yy(n,t):t?e+n.textContent.trim().replace(/\s+/g," "):e+n.textContent},"")}function _y(e,t,n){return e&&e.hasAttributeNS(t,n)?e.getAttributeNS(t,n):null}function Ey(e){return new Error("Could not parse ttml timestamp ".concat(e))}function by(e,t){if(!e)return null;let n=$v(e);return null===n&&(hy.test(e)?n=function(e,t){const n=hy.exec(e),i=(0|n[4])+(0|n[5])/t.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+i/t.frameRate}(e,t):fy.test(e)&&(n=function(e,t){const n=fy.exec(e),i=Number(n[1]);switch(n[2]){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}(e,t))),n}class Ty{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class Sy{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(au.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(au.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(au.MANIFEST_LOADING,this.onManifestLoading,this),e.on(au.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(au.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(au.FRAG_LOADING,this.onFragLoading,this),e.on(au.FRAG_LOADED,this.onFragLoaded,this),e.on(au.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(au.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(au.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(au.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(au.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(au.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(au.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(au.MANIFEST_LOADING,this.onManifestLoading,this),e.off(au.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(au.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(au.FRAG_LOADING,this.onFragLoading,this),e.off(au.FRAG_LOADED,this.onFragLoaded,this),e.off(au.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(au.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(au.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(au.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(au.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Ty(this,"textTrack1"),t=new Ty(this,"textTrack2"),n=new Ty(this,"textTrack3"),i=new Ty(this,"textTrack4");this.cea608Parser1=new Yv(1,e,t),this.cea608Parser2=new Yv(3,n,i)}addCues(e,t,n,i,r){let a=!1;for(let e=r.length;e--;){const i=r[e],o=Ry(i[0],i[1],t,n);if(o>=0&&(i[0]=Math.min(i[0],t),i[1]=Math.max(i[1],n),a=!0,o/(n-t)>.5))return}if(a||r.push([t,n]),this.config.renderTextTracksNatively){const r=this.captionsTracks[e];this.Cues.newCue(r,t,n,i)}else{const r=this.Cues.newCue(null,t,n,i);this.hls.trigger(au.CUES_PARSED,{type:"captions",cues:r,track:e})}}onInitPtsFound(e,t){let{frag:n,id:i,initPTS:r,timescale:a,trackId:o}=t;const{unparsedVttFrags:s}=this;i===uu.MAIN&&(this.initPTS[n.cc]={baseTime:r,timescale:a,trackId:o}),s.length&&(this.unparsedVttFrags=[],s.forEach(e=>{this.initPTS[e.frag.cc]?this.onFragLoaded(au.FRAG_LOADED,e):this.hls.trigger(au.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let i=0;i<n.textTracks.length;i++){const r=n.textTracks[i];if(Ay(r,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:i}=this,{label:r,languageCode:a}=t[e],o=this.getExistingTrack(r,a);if(o)n[e]=o,dv(n[e]),cv(n[e],i);else{const t=this.createTextTrack("captions",r,a);t&&(t[e]=!0,n[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(au.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}createTextTrack(e,t,n){const i=this.media;if(i)return i.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:i}=this;Object.keys(i).forEach(e=>{dv(i[e]),delete i[e]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let e=0;e<t.length;e++)dv(t[e])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],i=n.some(e=>e.textCodec===dy);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(jg(this.tracks,n))return void(this.tracks=n);if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const e=this.media,t=e?fv(e.textTracks):null;if(this.tracks.forEach((e,n)=>{let i;if(t){let n=null;for(let i=0;i<t.length;i++)if(t[i]&&Ay(t[i],e)){n=t[i],t[i]=null;break}n&&(i=n)}if(i)dv(i);else{const t=wy(e);i=this.createTextTrack(t,e.name,e.lang),i&&(i.mode="disabled")}i&&this.textTracks.push(i)}),null!=t&&t.length){const e=t.filter(e=>null!==e).map(e=>e.label);e.length&&this.hls.logger.warn("Media element contains unused subtitle tracks: ".concat(e.join(", "),". Replace media element for each source to clear TextTracks and captions menu."))}}else if(this.tracks.length){const e=this.tracks.map(e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}));this.hls.trigger(au.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const n="textTrack".concat(t[1]),i=this.captionsProperties[n];i&&(i.label=e.name,e.lang&&(i.languageCode=e.lang),i.media=e)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===uu.MAIN){var n,i;const{cea608Parser1:e,cea608Parser2:r,lastSn:a}=this,{cc:o,sn:s}=t.frag,l=null!=(n=null==(i=t.part)?void 0:i.index)?n:-1;e&&r&&(s!==a+1||s===a&&l!==this.lastPartIndex+1||o!==this.lastCc)&&(e.reset(),r.reset()),this.lastCc=o,this.lastSn=s,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:n,payload:i}=t;if(n.type===uu.SUBTITLE)if(i.byteLength){const e=n.decryptdata,r="stats"in t;if(null==e||!e.encrypted||r){const e=this.tracks[n.level],r=this.vttCCs;r[n.cc]||(r[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),e&&e.textCodec===dy?this._parseIMSC1(n,i):this._parseVTTs(t)}}else this.hls.trigger(au.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;gy(t,this.initPTS[e.cc],t=>{this._appendCues(t,e.level),n.trigger(au.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},t=>{n.logger.log("Failed to parse IMSC1: ".concat(t)),n.trigger(au.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})}_parseVTTs(e){var t;const{frag:n,payload:i}=e,{initPTS:r,unparsedVttFrags:a}=this,o=r.length-1;if(!r[n.cc]&&-1===o)return void a.push(e);const s=this.hls;uy(null!=(t=n.initSegment)&&t.data?rd(n.initSegment.data,new Uint8Array(i)).buffer:i,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,e=>{this._appendCues(e,n.level),s.trigger(au.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},t=>{const r="Missing initPTS for VTT MPEGTS"===t.message;r?a.push(e):this._fallbackToIMSC1(n,i),s.logger.log("Failed to parse VTT cue: ".concat(t)),!(r&&o>n.cc)&&s.trigger(au.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:t})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||gy(t,this.initPTS[e.cc],()=>{n.textCodec=dy,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[t];if(!n||"disabled"===n.mode)return;e.forEach(e=>uv(n,e))}else{const i=this.tracks[t];if(!i)return;const r=i.default?"default":"subtitles"+t;n.trigger(au.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===uu.SUBTITLE&&this.onFragLoaded(au.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:i}=t;if(n.type!==uu.MAIN||"NONE"!==this.closedCaptionsForLevel(n))for(let e=0;e<i.length;e++){const t=i[e].bytes;if(t){this.cea608Parser1||this.initCea608Parsers();const n=this.extractCea608Data(t);this.cea608Parser1.addData(i[e].pts,n[0]),this.cea608Parser2.addData(i[e].pts,n[1])}}}onBufferFlushing(e,t){let{startOffset:n,endOffset:i,endOffsetSubtitles:r,type:a}=t;const{media:o}=this;if(o&&!(o.currentTime<i)){if(!a||"video"===a){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>hv(e[t],n,i))}if(this.config.renderTextTracksNatively&&0===n&&void 0!==r){const{textTracks:e}=this;Object.keys(e).forEach(t=>hv(e[t],n,r))}}}extractCea608Data(e){const t=[[],[]],n=31&e[0];let i=2;for(let r=0;r<n;r++){const n=e[i++],r=127&e[i++],a=127&e[i++];if((0!==r||0!==a)&&4&n){const e=3&n;(0===e||1===e)&&(t[e].push(r),t[e].push(a))}}return t}}function wy(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function Ay(e,t){return!!e&&e.kind===wy(t)&&Zg(t,e)}function Ry(e,t,n,i){return Math.min(t,i)-Math.max(e,n)}const xy=/\s/,Iy={newCue(e,t,n,i){const r=[];let a,o,s,l,c;const u=self.VTTCue||self.TextTrackCue;for(let h=0;h<i.rows.length;h++)if(a=i.rows[h],s=!0,l=0,c="",!a.isEmpty()){var d;for(let e=0;e<a.chars.length;e++)xy.test(a.chars[e].uchar)&&s?l++:(c+=a.chars[e].uchar,s=!1);a.cueStartTime=t,t===n&&(n+=1e-4),l>=16?l--:l++;const i=ay(c.trim()),f=cy(t,n,i);null!=e&&null!=(d=e.cues)&&d.getCueById(f)||(o=new u(t,n,i),o.id=f,o.line=h+1,o.align="left",o.position=10+Math.min(80,10*Math.floor(8*l/32)),r.push(o))}return e&&r.length&&(r.sort((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line),r.forEach(t=>uv(e,t))),r}};function Ly(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}const My=/(\d+)-(\d+)\/(\d+)/;class Cy{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Py,this.controller=new self.AbortController,this.stats=new Pu}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const r=function(e,t){const n={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(pu({},e.headers))};return e.rangeEnd&&n.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),n}(e,this.controller.signal),a="arraybuffer"===e.responseType,o=a?"byteLength":"length",{maxTimeToFirstByteMs:s,maxLoadTimeMs:l}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),t.timeout=s&&eu(s)?s:l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},t.timeout),(kg(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(n=>{var r;this.response=this.loader=n;const o=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},l-(o-i.loading.start)),!n.ok){const{status:e,statusText:t}=n;throw new Dy(t||"fetch, bad network response",e,n)}i.loading.first=o,i.total=function(e){const t=e.get("Content-Range");if(t){const e=function(e){const t=My.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(eu(e))return e}const n=e.get("Content-Length");if(n)return parseInt(n)}(n.headers)||i.total;const s=null==(r=this.callbacks)?void 0:r.onProgress;return s&&eu(t.highWaterMark)?this.loadProgressively(n,i,e,t.highWaterMark,s):a?n.arrayBuffer():"json"===e.responseType?n.json():n.text()}).then(n=>{var r,a;const s=this.response;if(!s)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const l=n[o];l&&(i.loaded=i.total=l);const c={url:s.url,data:n,code:s.status},u=null==(r=this.callbacks)?void 0:r.onProgress;u&&!eu(t.highWaterMark)&&u(i,e,n,s),null==(a=this.callbacks)||a.onSuccess(c,i,e,s)}).catch(t=>{var n;if(self.clearTimeout(this.requestTimeout),i.aborted)return;const r=t&&t.code||0,a=t?t.message:null;null==(n=this.callbacks)||n.onError({code:r,text:a},e,t?t.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4?arguments[4]:void 0;const a=new fp,o=e.body.getReader(),s=()=>o.read().then(o=>{if(o.done)return a.dataLength&&r(t,n,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const l=o.value,c=l.length;return t.loaded+=c,c<i||a.dataLength?(a.push(l),a.dataLength>=i&&r(t,n,a.flush().buffer,e)):r(t,n,l.buffer,e),s()}).catch(()=>Promise.reject());return s()}}function Py(e,t){return new self.Request(e.url,t)}class Dy extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const Oy=/^age:\s*[\d.]+\s*$/im;class Ny{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Pu,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(this.loader===n&&!this.stats.aborted)return r(n,t.url)}).catch(e=>{if(this.loader===n&&!this.stats.aborted)return n.open("GET",t.url,!0),r(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(e=>{var r;null==(r=this.callbacks)||r.onError({code:n.status,text:e.message},t,n,i)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:a}=n.loadPolicy;if(i)for(const t in i)e.setRequestHeader(t,i[t]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=r&&eu(r)?r:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const i=t.readyState,r=this.config;if(!n.aborted&&i>=2&&(0===n.loading.first&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),4===i)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const i=t.status,l="text"===t.responseType?t.responseText:null;if(i>=200&&i<300){const r=null!=l?l:t.response;if(null!=r){var a,o;n.loading.end=Math.max(self.performance.now(),n.loading.first);const s="arraybuffer"===t.responseType?r.byteLength:r.length;n.loaded=n.total=s,n.bwEstimate=8e3*n.total/(n.loading.end-n.loading.first);const l=null==(a=this.callbacks)?void 0:a.onProgress;l&&l(n,e,r,t);const c={url:t.responseURL,data:r,code:i};return void(null==(o=this.callbacks)||o.onSuccess(c,n,e,t))}}const c=r.loadPolicy.errorRetry;var s;if(uh(c,n.retry,!1,{url:e.url,data:void 0,code:i}))this.retry(c);else Su.error("".concat(i," while loading ").concat(e.url)),null==(s=this.callbacks)||s.onError({code:i,text:t.statusText},e,t,n)}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry;if(uh(e,this.stats.retry,!0))this.retry(e);else{var t;Su.warn("timeout while loading ".concat(null==(t=this.context)?void 0:t.url));const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=lh(e,n.retry),n.retry++,Su.warn("".concat(status?"HTTP Status "+status:"Timeout"," while loading ").concat(null==t?void 0:t.url,", retrying ").concat(n.retry,"/").concat(e.maxNumRetry," in ").concat(this.retryDelay,"ms")),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&Oy.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp("^".concat(e,":\\s*[\\d.]+\\s*$"),"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const ky=mu(mu({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:6e7,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Ny,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Jd,bufferController:Qg,capLevelController:em,errorController:ph,fpsController:lv,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:hf,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:Iy,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:Mv,subtitleTrackController:pv,timelineController:Sy,audioStreamController:Gg,audioTrackController:qg,emeController:iv,cmcdController:$m,contentSteeringController:ev,interstitialsController:class extends vu{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled||!this.schedule)return;const t=e-this.timelinePos;if(Math.abs(t)<1/7056e5)return;const n=t<=-.01;this.timelinePos=e,this.bufferedPos=e;const i=this.playingItem;if(!i)return void this.checkBuffer();if(n&&this.schedule.resetErrorsInRange(e,e-t)&&this.updateSchedule(!0),this.checkBuffer(),n&&e<i.start||e>=i.end){var r;const t=this.findItemIndex(i);let a=this.schedule.findItemIndexAtTime(e);if(-1===a&&(a=t+(n?-1:1),this.log("seeked ".concat(n?"back ":"","to position not covered by schedule ").concat(e," (resolving from ").concat(t," to ").concat(a,")"))),!this.isInterstitial(i)&&null!=(r=this.media)&&r.paused&&(this.shouldPlay=!1),!n&&a>t){const e=this.schedule.findJumpRestrictedIndex(t+1,a);if(e>t)return void this.setSchedulePosition(e)}return void this.setSchedulePosition(a)}const a=this.playingAsset;if(!a){if(this.playingLastItem&&this.isInterstitial(i)){const t=i.event.assetList[0];t&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(e,t))}return}const o=a.timelineStart,s=a.duration||0;var l;(n&&e<o||e>=o+s)&&(null!=(l=i.event)&&l.appendInPlace&&(this.clearInterstitial(i.event,i),this.flushFrontBuffer(e)),this.setScheduleToAssetAtTime(e,a))},this.onTimeupdate=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled)return;if(!(e>this.timelinePos))return;this.timelinePos=e,e>this.bufferedPos&&this.checkBuffer();const t=this.playingItem;if(!t||this.playingLastItem)return;if(e>=t.end){this.timelinePos=t.end;const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}const n=this.playingAsset;if(!n)return;e>=n.timelineStart+(n.duration||0)&&this.setScheduleToAssetAtTime(e,n)},this.onScheduleUpdate=(e,t)=>{const n=this.schedule;if(!n)return;const i=this.playingItem,r=n.events||[],a=n.items||[],o=n.durations,s=e.map(e=>e.identifier),l=!(!r.length&&!s.length);(l||t)&&this.log("INTERSTITIALS_UPDATED (".concat(r.length,"): ").concat(r,"\nSchedule: ").concat(a.map(e=>Rv(e))," pos: ").concat(this.timelinePos)),s.length&&this.log("Removed events ".concat(s));let c=null,u=null;i&&(c=this.updateItem(i,this.timelinePos),this.itemsMatch(i,c)?this.playingItem=c:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const d=this.bufferingItem;if(d&&(u=this.updateItem(d,this.bufferedPos),this.itemsMatch(d,u)?this.bufferingItem=u:d.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(d.event,null))),e.forEach(e=>{e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,null)})}),this.playerQueue.forEach(e=>{if(e.interstitial.appendInPlace){const t=e.assetItem.timelineStart,n=e.timelineOffset-t;if(n)try{e.timelineOffset=t}catch(i){Math.abs(n)>mv&&this.warn("".concat(i,' ("').concat(e.assetId,'" ').concat(e.timelineOffset,"->").concat(t,")"))}}}),l||t){if(this.hls.trigger(au.INTERSTITIALS_UPDATED,{events:r.slice(0),schedule:a.slice(0),durations:o,removedIds:s}),this.isInterstitial(i)&&s.includes(i.event.identifier))return this.warn('Interstitial "'.concat(i.event.identifier,'" removed while playing')),void this.primaryFallback(i.event);i&&this.trimInPlace(c,i),d&&u!==c&&this.trimInPlace(u,d),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new xv(e),this.schedule=new Av(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(au.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(au.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(au.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(au.MANIFEST_LOADING,this.onManifestLoading,this),e.on(au.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(au.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(au.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(au.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(au.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(au.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(au.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(au.BUFFER_APPENDED,this.onBufferAppended,this),e.on(au.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(au.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(au.MEDIA_ENDED,this.onMediaEnded,this),e.on(au.ERROR,this.onError,this),e.on(au.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(au.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(au.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(au.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(au.MANIFEST_LOADING,this.onManifestLoading,this),e.off(au.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(au.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(au.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(au.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(au.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(au.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(au.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(au.BUFFER_CODECS,this.onBufferCodecs,this),e.off(au.BUFFER_APPENDED,this.onBufferAppended,this),e.off(au.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(au.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(au.MEDIA_ENDED,this.onMediaEnded,this),e.off(au.ERROR,this.onError,this),e.off(au.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;null==(e=this.getBufferingPlayer())||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.getBufferingPlayer())||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Qf(e,"play",this.onPlay),Qf(e,"pause",this.onPause),Qf(e,"seeking",this.onSeeking),Qf(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;Xf(n,"seeking",this.onSeeking),Xf(n,"timeupdate",this.onTimeupdate),Xf(n,"play",this.onPlay),Xf(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,null===n)this.checkStart();else if(!i){this.clearScheduleState();const e=this.findItemIndex(n);this.setSchedulePosition(e)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,i=this.media;if(this.media=null,!n&&(i&&this.removeMediaListeners(i),this.detachedData)){const e=this.getBufferingPlayer();e&&(this.log("Removing schedule state for detachedData and ".concat(e)),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,e.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=t=>t&&e.getAssetPlayer(t.identifier),i=(t,i,a,o,s)=>{if(t){let l=t[i].start;const c=t.event;if(c){if("playout"===i||c.timelineOccupancy!==vv.Point){const e=n(a);(null==e?void 0:e.interstitial)===c&&(l+=e.assetItem.startOffset+e[s])}}else{l+=("bufferedPos"===o?r():e[o])-t.start}return l}return 0},r=()=>{const t=e.bufferedPos;return t===Number.MAX_VALUE?a("primary"):Math.max(t,0)},a=t=>{var n,i;return null!=(n=e.primaryDetails)&&n.live?e.primaryDetails.edge:(null==(i=e.schedule)?void 0:i.durations[t])||0},o=(t,r)=>{var a,o;const s=e.effectivePlayingItem;if(null!=s&&null!=(a=s.event)&&a.restrictions.skip||!e.schedule)return;e.log("seek to ".concat(t,' "').concat(r,'"'));const l=e.effectivePlayingItem,c=e.schedule.findItemIndexAtTime(t,r),u=null==(o=e.schedule.items)?void 0:o[c],d=e.getBufferingPlayer(),h=null==d?void 0:d.interstitial,f=null==h?void 0:h.appendInPlace,p=l&&e.itemsMatch(l,u);if(l&&(f||p)){const a=n(e.playingAsset),o=(null==a?void 0:a.media)||e.primaryMedia;if(o){const n="primary"===r?o.currentTime:i(l,r,e.playingAsset,"timelinePos","currentTime"),s=t-n,c=(f?n:o.currentTime)+s;if(c>=0&&(!a||f||c<=a.duration))return void(o.currentTime=c)}}if(u){let n=t;if("primary"!==r){const e=t-u[r].start;n=u.start+e}const i=!e.isInterstitial(u);if(e.isInterstitial(l)&&!l.event.appendInPlace||!i&&!u.event.appendInPlace){if(l){const a=e.findItemIndex(l);if(c>a){const t=e.schedule.findJumpRestrictedIndex(a+1,c);if(t>a)return void e.setSchedulePosition(t)}let o=0;if(i)e.timelinePos=n,e.checkBuffer();else{const e=u.event.assetList,n=t-(u[r]||u).start;for(let t=e.length;t--;){const i=e[t];if(i.duration&&n>=i.startOffset&&n<i.startOffset+i.duration){o=t;break}}}e.setSchedulePosition(c,o)}}else{const t=e.media||(f?null==d?void 0:d.media:null);t&&(t.currentTime=n)}}},s=()=>{const n=e.effectivePlayingItem;if(e.isInterstitial(n))return n;const i=t();return e.isInterstitial(i)?i:null},l={get bufferedEnd(){const n=t(),r=e.bufferingItem;var a;return r&&r===n&&(i(r,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-r.playout.start||(null==(a=e.bufferingAsset)?void 0:a.startOffset))||0},get currentTime(){const t=s(),n=e.effectivePlayingItem;return n&&n===t?i(n,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-n.playout.start:0},set currentTime(t){const n=s(),i=e.effectivePlayingItem;i&&i===n&&o(t+i.playout.start,"playout")},get duration(){const e=s();return e?e.playout.end-e.playout.start:0},get assetPlayers(){var t;const n=null==(t=s())?void 0:t.event.assetList;return n?n.map(t=>e.getAssetPlayer(t.identifier)):[]},get playingIndex(){var t;const n=null==(t=s())?void 0:t.event;return n&&e.effectivePlayingAsset?n.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return s()}};return this.manager={get events(){var t;return(null==(t=e.schedule)||null==(t=t.events)?void 0:t.slice(0))||[]},get schedule(){var t;return(null==(t=e.schedule)||null==(t=t.items)?void 0:t.slice(0))||[]},get interstitialPlayer(){return s()?l:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const n=t();return e.findItemIndex(n)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const t=e.effectivePlayingItem;return e.findItemIndex(t)},primary:{get bufferedEnd(){return r()},get currentTime(){const t=e.timelinePos;return t>0?t:0},set currentTime(e){o(e,"primary")},get duration(){return a("primary")},get seekableStart(){var t;return(null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(e){o(e,"integrated")},get duration(){return a("integrated")},get seekableStart(){var t;return((t,n)=>{var i;if(0!==t&&"primary"!==n&&null!=(i=e.schedule)&&i.length){var r;const i=e.schedule.findItemIndexAtTime(t),a=null==(r=e.schedule.items)?void 0:r[i];if(a)return t+(a[n].start-a.start)}return t})((null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0,"integrated")}},skip:()=>{const t=e.effectivePlayingItem,n=null==t?void 0:t.event;if(n&&!n.restrictions.skip){const i=e.findItemIndex(t);if(n.appendInPlace){const e=t.playout.start+t.event.duration;o(e+.001,"playout")}else e.advanceAfterAssetEnded(n,i,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=null==(e=this.schedule)?void 0:e.items;return!!(this.playbackStarted&&t&&n)&&this.findItemIndex(t)===n.length-1}get playbackStarted(){return null!==this.effectivePlayingItem}get currentTime(){var e,t;if(null===this.mediaSelection)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let i=this.media;!i&&null!=(e=this.bufferingItem)&&null!=(e=e.event)&&e.appendInPlace&&(i=this.primaryMedia);const r=null==(t=i)?void 0:t.currentTime;return void 0!==r&&eu(r)?r:void 0}get primaryMedia(){var e;return this.media||(null==(e=this.detachedData)?void 0:e.media)||null}isInterstitial(e){return!(null==e||!e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,i=e.media;if(n&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i)return void(this.detachedData={media:i});const n=e.transferMedia();this.log("transfer MediaSource from ".concat(e," ").concat(jd(n))),this.detachedData=n}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var n,i;if(e.media===t)return;let r=null;const a=this.hls,o=e!==a,s=o&&e.interstitial.appendInPlace,l=null==(n=this.detachedData)?void 0:n.mediaSource;let c;if(a.media)s&&(r=a.transferMedia(),this.detachedData=r),c="Primary";else if(l){const e=this.getBufferingPlayer();e?(r=e.transferMedia(),c="".concat(e)):c="detached MediaSource"}else c="detached media";if(!r)if(l)r=this.detachedData,this.log("using detachedData: MediaSource ".concat(jd(r)));else if(!this.detachedData||a.media===t){const e=this.playerQueue;e.length>1&&e.forEach(e=>{if(o&&e.interstitial.appendInPlace!==s){const t=e.interstitial;this.clearInterstitial(e.interstitial,null),t.appendInPlace=!1,t.appendInPlace&&this.warn("Could not change append strategy for queued assets ".concat(t))}}),this.hls.detachMedia(),this.detachedData={media:t}}const u=r&&"mediaSource"in r&&"closed"!==(null==(i=r.mediaSource)?void 0:i.readyState),d=u&&r?r:t;this.log("".concat(u?"transfering MediaSource":"attaching media"," to ").concat(o?e:"Primary"," from ").concat(c," (media.currentTime: ").concat(t.currentTime,")"));const h=this.schedule;if(d===r&&h){const t=o&&e.assetId===h.assetIdAtEnd;d.overrides={duration:h.duration,endOfStream:!o||t,cueRemoval:!o}}e.attachMedia(d)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=null==e?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;-1===this.bufferedPos&&(this.bufferedPos=0);const n=this.timelinePos,i=this.effectivePlayingItem;if(-1===n){const n=this.hls.startPosition;if(this.log(Lv("checkStart",n)),this.timelinePos=n,t.length&&t[0].cue.pre){const n=e.findEventIndex(t[0].identifier);this.setSchedulePosition(n)}else if(n>=0||!this.primaryLive){const t=this.timelinePos=n>0?n:0,i=e.findItemIndexAtTime(t);this.setSchedulePosition(i)}}else if(i&&!this.playingItem){const t=e.findItemIndex(i);this.setSchedulePosition(t)}}advanceAssetBuffering(e,t){const n=e.event,i=n.findAssetIndex(t),r=Tv(n,i);if(n.isAssetPastPlayoutLimit(r)){if(this.schedule){var a;const t=null==(a=this.schedule.items)?void 0:a[this.findItemIndex(e)+1];t&&this.bufferedToItem(t)}}else this.bufferedToEvent(e,r)}advanceAfterAssetEnded(e,t,n){const i=Tv(e,n);if(e.isAssetPastPlayoutLimit(i)){if(this.schedule){const n=this.schedule.items;if(n){const i=t+1;if(i>=n.length)return void this.setSchedulePosition(-1);const r=e.resumeTime;this.timelinePos<r&&(this.log(Lv("advanceAfterAssetEnded",r)),this.timelinePos=r,e.appendInPlace&&this.advanceInPlace(r),this.checkBuffer(this.bufferedPos<r)),this.setSchedulePosition(i)}}}else{if(e.appendInPlace){const t=e.assetList[i];t&&this.advanceInPlace(t.timelineStart)}this.setSchedulePosition(t,i)}}setScheduleToAssetAtTime(e,t){const n=this.schedule;if(!n)return;const i=t.parentIdentifier,r=n.getEvent(i);if(r){const t=n.findEventIndex(i),a=n.findAssetIndex(r,e);this.advanceAfterAssetEnded(r,t,a-1)}}setSchedulePosition(e,t){var n;const i=null==(n=this.schedule)?void 0:n.items;if(!i||this.playbackDisabled)return;const r=e>=0?i[e]:null;this.log("setSchedulePosition ".concat(e,", ").concat(t," (").concat(r&&Rv(r),") pos: ").concat(this.timelinePos));const a=this.waitingItem||this.playingItem,o=this.playingLastItem;if(this.isInterstitial(a)){const n=a.event,c=this.playingAsset,u=null==c?void 0:c.identifier,d=u?this.getAssetPlayer(u):null;if(d&&u&&(!this.eventItemsMatch(a,r)||void 0!==t&&u!==n.assetList[t].identifier)){var s;const t=n.findAssetIndex(c);if(this.log("INTERSTITIAL_ASSET_ENDED ".concat(t+1,"/").concat(n.assetList.length," ").concat(Sv(c))),this.endedAsset=c,this.playingAsset=null,this.hls.trigger(au.INTERSTITIAL_ASSET_ENDED,{asset:c,assetListIndex:t,event:n,schedule:i.slice(0),scheduleIndex:e,player:d}),a!==this.playingItem)return void(this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(n,this.findItemIndex(this.playingItem),t));this.retreiveMediaSource(u,r),d.media&&(null==(s=this.detachedData)||!s.mediaSource)&&d.detachMedia()}if(!this.eventItemsMatch(a,r)&&(this.endedItem=a,this.playingItem=null,this.log("INTERSTITIAL_ENDED ".concat(n," ").concat(Rv(a))),n.hasPlayed=!0,this.hls.trigger(au.INTERSTITIAL_ENDED,{event:n,schedule:i.slice(0),scheduleIndex:e}),n.cue.once)){var l;this.updateSchedule();const e=null==(l=this.schedule)?void 0:l.items;if(r&&e){const n=this.findItemIndex(r);this.advanceSchedule(n,e,t,a,o)}return}}this.advanceSchedule(e,i,t,a,o)}advanceSchedule(e,t,n,i,r){const a=this.schedule;if(!a)return;const o=t[e]||null,s=this.primaryMedia,l=this.playerQueue;if(l.length&&l.forEach(t=>{const n=t.interstitial,i=a.findEventIndex(n.identifier);(i<e||i>e+1)&&this.clearInterstitial(n,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const r=o.event;if(void 0===n){const t=Tv(r,(n=a.findAssetIndex(r,this.timelinePos))-1);if(r.isAssetPastPlayoutLimit(t)||r.appendInPlace&&this.timelinePos===o.end)return void this.advanceAfterAssetEnded(r,e,n);n=t}const l=this.waitingItem;this.assetsBuffered(o,s)||this.setBufferingItem(o);let c=this.preloadAssets(r,n);if(this.eventItemsMatch(o,l||i)||(this.waitingItem=o,this.log("INTERSTITIAL_STARTED ".concat(Rv(o)," ").concat(r.appendInPlace?"append in place":"")),this.hls.trigger(au.INTERSTITIAL_STARTED,{event:r,schedule:t.slice(0),scheduleIndex:e})),!r.assetListLoaded)return void this.log("Waiting for ASSET-LIST to complete loading ".concat(r));if(r.assetListLoader&&(r.assetListLoader.destroy(),r.assetListLoader=void 0),!s)return void this.log("Waiting for attachMedia to start Interstitial ".concat(r));this.waitingItem=this.endedItem=null,this.playingItem=o;const u=r.assetList[n];if(!u)return void this.advanceAfterAssetEnded(r,e,n||0);if(c||(c=this.getAssetPlayer(u.identifier)),null===c||c.destroyed){const e=r.assetList.length;this.warn("asset ".concat(n+1,"/").concat(e," player destroyed ").concat(r)),c=this.createAssetPlayer(r,u,n),c.loadSource()}if(!this.eventItemsMatch(o,this.bufferingItem)&&r.appendInPlace&&this.isAssetBuffered(u))return;this.startAssetPlayer(c,n,t,e,s),this.shouldPlay&&Iv(c.media)}else o?(this.resumePrimary(o,e,i),this.shouldPlay&&Iv(this.hls.media)):r&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return!1===this.hls.config.enableInterstitialPlayback}get primaryDetails(){var e;return null==(e=this.mediaSelection)?void 0:e.main.details}get primaryLive(){var e;return!(null==(e=this.primaryDetails)||!e.live)}resumePrimary(e,t,n){var i,r;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log("resuming ".concat(Rv(e))),null==(i=this.detachedData)||!i.mediaSource){let n=this.timelinePos;(n<e.start||n>=e.end)&&(n=this.getPrimaryResumption(e,t),this.log(Lv("resumePrimary",n)),this.timelinePos=n),this.attachPrimary(n,e)}if(!n)return;const a=null==(r=this.schedule)?void 0:r.items;a&&(this.log("INTERSTITIALS_PRIMARY_RESUMED ".concat(Rv(e))),this.hls.trigger(au.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const e=this.primaryDetails;if(0===t)return this.hls.startPosition;if(e&&(n<e.fragmentStart||n>e.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return null!=t&&t.hls?t.hls.bufferedToEnd:Bh.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,i),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(Lv("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs(((null==(n=i.mainForwardBufferInfo)?void 0:n.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),null==(e=this.schedule)||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(au.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(au.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(-1===t.level||!this.schedule)return;const n=this.hls.levels[t.level];if(!n.details)return;const i=mu(mu({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i)return void(this.altSelection=mu(mu({},this.altSelection),{},{audio:n}));const r=mu(mu({},i),{},{audio:n});this.mediaSelection=r}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i)return void(this.altSelection=mu(mu({},this.altSelection),{},{subtitles:n}));const r=mu(mu({},i),{},{subtitles:n});this.mediaSelection=r}onAudioTrackSwitching(e,t){const n=qd(t);this.playerQueue.forEach(e=>{let{hls:i}=e;return i&&(i.setAudioOption(t)||i.setAudioOption(n))})}onSubtitleTrackSwitch(e,t){const n=qd(t);this.playerQueue.forEach(e=>{let{hls:i}=e;return i&&(i.setSubtitleOption(t)||-1!==t.id&&i.setSubtitleOption(n))})}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const e=this.timelinePos;this.bufferedPos=e,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let e=0;e<t.length;e++){const i=t[e];if(i.cue.post){var n;const e=this.schedule.findEventIndex(i.identifier),t=null==(n=this.schedule.items)?void 0:n[e];this.isInterstitial(t)&&this.eventItemsMatch(t,this.bufferingItem)&&this.bufferedToItem(t,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}else this.shouldPlay=!1}updateItem(e,t){var n;const i=null==(n=this.schedule)?void 0:n.items;if(e&&i){return i[this.findItemIndex(e,t)]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((t,n)=>{e.event.isAssetPastPlayoutLimit(n)&&this.clearAssetPlayer(t.identifier,null)});const n=e.end+.25,i=Bh.bufferInfo(this.primaryMedia,n,0);(i.end>n||(i.nextStart||0)>n)&&(this.log("trim buffered interstitial ".concat(Rv(e)," (was ").concat(Rv(t),")")),this.attachPrimary(n,null,!0),this.flushFrontBuffer(n))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===(null==(n=t.event)?void 0:n.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t;const n=this.mediaSelection;n&&(null==(t=this.schedule)||t.updateSchedule(n,[],e))}checkBuffer(e){var t;const n=null==(t=this.schedule)?void 0:t.items;if(!n)return;const i=Bh.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,n,e)}updateBufferedPos(e,t,n){const i=this.schedule,r=this.bufferingItem;if(this.bufferedPos>e||!i)return;if(1===t.length&&this.itemsMatch(t[0],r))return void(this.bufferedPos=e);const a=this.playingItem,o=this.findItemIndex(a);let s=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var l;const n=this.findItemIndex(r),i=Math.min(n+1,t.length-1),a=t[i];if((-1===s&&r&&e>=r.end||null!=(l=a.event)&&l.appendInPlace&&e+.01>=a.start)&&(s=i),this.isInterstitial(r)){const e=r.event;if(i-o>1&&!1===e.appendInPlace||0===e.assetList.length&&e.assetListLoader)return}if(this.bufferedPos=e,s>n&&s>o)this.bufferedToItem(a);else{const t=this.primaryDetails;this.primaryLive&&t&&e>t.edge-t.targetduration&&a.start<t.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(a)&&this.preloadAssets(a.event,0)}}else n&&a&&!this.itemsMatch(a,r)&&(s===o?this.bufferedToItem(a):s===o+1&&this.bufferedToItem(t[s]))}assetsBuffered(e,t){return 0!==e.event.assetList.length&&!e.event.assetList.some(e=>{const n=this.getAssetPlayer(e.identifier);return!(null!=n&&n.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,t)&&n){const{items:i,events:r}=n;if(!i||!r)return t;const a=this.isInterstitial(e),o=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const s=o?o.remaining:t?t.end-this.timelinePos:0;if(this.log("INTERSTITIALS_BUFFERED_TO_BOUNDARY ".concat(Rv(e))+(t?" (".concat(s.toFixed(2)," remaining)"):"")),!this.playbackDisabled)if(a){const t=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((e,n)=>{const i=this.getAssetPlayer(e.identifier);i&&(n===t&&i.loadSource(),i.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(e=>e.pauseBuffering());this.hls.trigger(au.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.setBufferingItem(e);if(!this.playbackDisabled)if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(null!==n){this.bufferingAsset=null;const t=this.detachedData;t&&t.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e)}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,i=0===n.assetList.length&&!n.assetListLoader,r=n.cue.once;if(i||!r){const e=this.preloadAssets(n,t);if(null!=e&&e.interstitial.appendInPlace){const t=this.primaryMedia;t&&this.bufferAssetPlayer(e,t)}}}preloadAssets(e,t){const n=e.assetUrl,i=e.assetList.length,r=0===i&&!e.assetListLoader,a=e.cue.once;if(r){const r=e.timelineStart;if(e.appendInPlace){var o;const t=this.playingItem;!this.isInterstitial(t)&&(null==t||null==(o=t.nextEvent)?void 0:o.identifier)===e.identifier&&this.flushFrontBuffer(r+.25)}let a,s=0;if(!this.playingItem&&this.primaryLive&&(s=this.hls.startPosition,-1===s&&(s=this.hls.liveSyncPosition||0)),s&&!e.cue.pre&&!e.cue.post){const e=s-r;e>0&&(a=Math.round(1e3*e)/1e3)}if(this.log("Load interstitial asset ".concat(t+1,"/").concat(n?1:i," ").concat(e).concat(a?" live-start: ".concat(s," start-offset: ").concat(a):"")),n)return this.createAsset(e,0,0,r,e.duration,n);const l=this.assetListLoader.loadAssetList(e,a);l&&(e.assetListLoader=l)}else if(!a&&i){for(let n=t;n<i;n++){const t=e.assetList[n],i=this.getAssetPlayerQueueIndex(t.identifier);(-1===i||this.playerQueue[i].destroyed)&&!t.error&&this.createAssetPlayer(e,t,n)}const n=e.assetList[t];if(n){const e=this.getAssetPlayer(n.identifier);return e&&e.loadSource(),e}}return null}flushFrontBuffer(e){const t=this.requiredTracks;t&&(this.log("Removing front buffer starting at ".concat(e)),Object.keys(t).forEach(t=>{this.hls.trigger(au.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:t})}))}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t)for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n];return null}createAsset(e,t,n,i,r,a){const o={parentIdentifier:e.identifier,identifier:yv(e,a,t),duration:r,startOffset:n,timelineStart:i,uri:a};return this.createAssetPlayer(e,o,t)}createAssetPlayer(e,t,n){const i=this.hls,r=i.userConfig;let a=r.videoPreference;const o=i.loadLevelObj||i.levels[i.currentLevel];(a||o)&&(a=pu({},a),o.videoCodec&&(a.videoCodec=o.videoCodec),o.videoRange&&(a.allowedVideoRanges=[o.videoRange]));const s=i.audioTracks[i.audioTrack],l=i.subtitleTracks[i.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const e=this.timelinePos-t.timelineStart;if(e>1){const n=t.duration;n&&e<n&&(c=e)}}const u=t.identifier,d=mu(mu({},r),{},{maxMaxBufferLength:Math.min(180,i.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:u,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:s||r.audioPreference,subtitlePreference:l||r.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(d.timelineOffset=t.timelineStart));const h=d.cmcd;null!=h&&h.sessionId&&h.contentId&&(d.cmcd=pu({},h,{contentId:gv(t.uri)})),this.getAssetPlayer(u)&&this.warn("Duplicate date range identifier ".concat(e," and asset ").concat(u));const f=new wv(this.HlsPlayerClass,d,e,t);this.playerQueue.push(f),e.assetList[n]=t;let p=!0;const g=i=>{if(i.live){var r;const t=new Error("Interstitials MUST be VOD assets ".concat(e)),i={fatal:!0,type:iu.OTHER_ERROR,details:ru.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},a=(null==(r=this.schedule)?void 0:r.findEventIndex(e.identifier))||-1;return void this.handleAssetItemError(i,e,a,n,t.message)}const a=i.edge-i.fragmentStart,o=t.duration;(p||null===o||a>o)&&(p=!1,this.log('Interstitial asset "'.concat(u,'" duration change ').concat(o," > ").concat(a)),t.duration=a,this.updateSchedule())};f.on(au.LEVEL_UPDATED,(e,t)=>{let{details:n}=t;return g(n)}),f.on(au.LEVEL_PTS_UPDATED,(e,t)=>{let{details:n}=t;return g(n)}),f.on(au.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const m=(e,t)=>{const n=this.getAssetPlayer(u);if(n&&t.tracks){n.off(au.BUFFER_CODECS,m),n.tracks=t.tracks;const e=this.primaryMedia;this.bufferingAsset===n.assetItem&&e&&!n.media&&this.bufferAssetPlayer(n,e)}};f.on(au.BUFFER_CODECS,m);f.on(au.BUFFERED_TO_END,()=>{var n;const i=this.getAssetPlayer(u);if(this.log("buffered to end of asset ".concat(i)),!i||!this.schedule)return;const r=this.schedule.findEventIndex(e.identifier),a=null==(n=this.schedule.items)?void 0:n[r];this.isInterstitial(a)&&this.advanceAssetBuffering(a,t)});const v=t=>()=>{if(!this.getAssetPlayer(u)||!this.schedule)return;this.shouldPlay=!0;const n=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,n,t)};return f.once(au.MEDIA_ENDED,v(n)),f.once(au.PLAYOUT_LIMIT_REACHED,v(1/0)),f.on(au.ERROR,(t,i)=>{if(!this.schedule)return;const r=this.getAssetPlayer(u);if(i.details===ru.BUFFER_STALLED_ERROR)return null!=r&&r.appendInPlace?void this.handleInPlaceStall(e):(this.onTimeupdate(),void this.checkBuffer(!0));this.handleAssetItemError(i,e,this.schedule.findEventIndex(e.identifier),n,"Asset player error ".concat(i.error," ").concat(e))}),f.on(au.DESTROYING,()=>{if(!this.getAssetPlayer(u)||!this.schedule)return;const t=new Error("Asset player destroyed unexpectedly ".concat(u)),i={fatal:!0,type:iu.OTHER_ERROR,details:ru.INTERSTITIAL_ASSET_ITEM_ERROR,error:t};this.handleAssetItemError(i,e,this.schedule.findEventIndex(e.identifier),n,t.message)}),this.log("INTERSTITIAL_ASSET_PLAYER_CREATED ".concat(Sv(t))),this.hls.trigger(au.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:f}),f}clearInterstitial(e,t){e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(-1!==t){this.log('reset asset player "'.concat(e,'" after error'));const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(-1!==n){const e=this.playerQueue[n];this.log("clear ".concat(e," toSegment: ").concat(t&&Rv(t))),this.transferMediaFromPlayer(e,t),this.playerQueue.splice(n,1),e.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,i,r){const{interstitial:a,assetItem:o,assetId:s}=e,l=a.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=o,(!c||c.identifier!==s)&&(c&&(this.clearAssetPlayer(c.identifier,n[i]),delete c.error),this.log("INTERSTITIAL_ASSET_STARTED ".concat(t+1,"/").concat(l," ").concat(Sv(o))),this.hls.trigger(au.INTERSTITIAL_ASSET_STARTED,{asset:o,assetListIndex:t,event:a,schedule:n.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,r)}bufferAssetPlayer(e,t){var n,i;if(!this.schedule)return;const{interstitial:r,assetItem:a}=e,o=this.schedule.findEventIndex(r.identifier),s=null==(n=this.schedule.items)?void 0:n[o];if(!s)return;e.loadSource(),this.setBufferingItem(s),this.bufferingAsset=a;const l=this.getBufferingPlayer();if(l===e)return;const c=r.appendInPlace;if(c&&!1===(null==l?void 0:l.interstitial.appendInPlace))return;const u=(null==l?void 0:l.tracks)||(null==(i=this.detachedData)?void 0:i.tracks)||this.requiredTracks;if(c&&a!==this.playingAsset){if(!e.tracks)return void this.log("Waiting for track info before buffering ".concat(e));if(u&&!Au(u,e.tracks)){const t=new Error("Asset ".concat(Sv(a)," SourceBuffer tracks ('").concat(Object.keys(e.tracks),"') are not compatible with primary content tracks ('").concat(Object.keys(u),"')")),n={fatal:!0,type:iu.OTHER_ERROR,details:ru.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},i=r.findAssetIndex(a);return void this.handleAssetItemError(n,r,o,i,t.message)}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,n=this.primaryMedia;if(!t||!n)return;const i=n.currentTime,r=t.findAssetIndex(e,i),a=e.assetList[r];if(a){const o=this.getAssetPlayer(a.identifier);if(o){const s=o.currentTime||i-a.timelineStart,l=o.duration-s;if(this.warn("Stalled at ".concat(s," of ").concat(s+l," in ").concat(o," ").concat(e," (media.currentTime: ").concat(i,")")),s&&(l/n.playbackRate<.5||o.bufferedInPlaceToEnd(n))&&o.hls){const n=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,n,r)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,n,i,r){if(e.details===ru.BUFFER_STALLED_ERROR)return;const a=t.assetList[i]||null;if(this.warn("INTERSTITIAL_ASSET_ERROR ".concat(a&&Sv(a)," ").concat(e.error)),!this.schedule)return;const o=(null==a?void 0:a.identifier)||"",s=this.getAssetPlayerQueueIndex(o),l=this.playerQueue[s]||null,c=this.schedule.items,u=pu({},e,{fatal:!1,errorAction:gh(!0),asset:a,assetListIndex:i,event:t,schedule:c,scheduleIndex:n,player:l});if(this.hls.trigger(au.INTERSTITIAL_ASSET_ERROR,u),!e.fatal)return;const d=this.playingAsset,h=this.bufferingAsset,f=new Error(r);if(a&&(this.clearAssetPlayer(o,null),a.error=f),t.assetList.some(e=>!e.error))for(let e=i;e<t.assetList.length;e++)this.resetAssetPlayer(t.assetList[e].identifier);else t.error=f;this.updateSchedule(!0),t.error?this.primaryFallback(t):d&&d.identifier===o?this.advanceAfterAssetEnded(t,n,i):h&&h.identifier===o&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,h)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;if(n){this.log('Fallback to primary from event "'.concat(e.identifier,'" start: ').concat(t," pos: ").concat(this.timelinePos," playing: ").concat(Rv(n)," error: ").concat(e.error));let i=this.timelinePos;-1===i&&(i=this.hls.startPosition);const r=this.updateItem(n,i);if(this.itemsMatch(n,r)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t)),!this.schedule)return;const a=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(a)}else this.checkStart()}onAssetListLoaded(e,t){var n,i;const r=t.event,a=r.identifier,o=t.assetListResponse.ASSETS;if(null==(n=this.schedule)||!n.hasEvent(a))return;const s=r.timelineStart,l=r.duration;let c=0;o.forEach((e,t)=>{const n=parseFloat(e.DURATION);this.createAsset(r,t,c,s+c,n,e.URI),c+=n}),r.duration=c,this.log("Loaded asset-list with duration: ".concat(c," (was: ").concat(l,") ").concat(r));const u=this.waitingItem,d=(null==u?void 0:u.event.identifier)===a;this.updateSchedule();const h=null==(i=this.bufferingItem)?void 0:i.event;if(d){var f;const e=this.schedule.findEventIndex(a),t=null==(f=this.schedule.items)?void 0:f[e];if(t){if(!this.playingItem&&this.timelinePos>t.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==e)return r.error=new Error("Interstitial no longer within playback range ".concat(this.timelinePos," ").concat(r)),this.updateSchedule(!0),void this.primaryFallback(r);this.setBufferingItem(t)}this.setSchedulePosition(e)}else if((null==h?void 0:h.identifier)===a){const e=r.assetList[0];if(e){const t=this.getAssetPlayer(e.identifier);if(h.appendInPlace){const e=this.primaryMedia;t&&e&&this.bufferAssetPlayer(t,e)}else t&&t.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case ru.ASSET_LIST_PARSING_ERROR:case ru.ASSET_LIST_LOAD_ERROR:case ru.ASSET_LIST_LOAD_TIMEOUT:{const e=t.interstitial;e&&(this.updateSchedule(!0),this.primaryFallback(e));break}case ru.BUFFER_STALLED_ERROR:{const e=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(e)&&e.event.appendInPlace)return void this.handleInPlaceStall(e.event);this.log("Primary player stall @".concat(this.timelinePos," bufferedPos: ").concat(this.bufferedPos)),this.onTimeupdate(),this.checkBuffer(!0);break}}}}});function Fy(e){return e&&"object"==typeof e?Array.isArray(e)?e.map(Fy):Object.keys(e).reduce((t,n)=>(t[n]=Fy(e[n]),t),{}):e}class By extends Nh{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var e;null!=(e=this.media)&&e.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{var e;this.hls&&(this.ended=(null==(e=this.media)?void 0:e.currentTime)||1,this.hls.trigger(au.MEDIA_ENDED,{stalled:!1}))},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(au.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(au.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(au.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(au.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(au.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(au.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(100),this.mediaSource=t.mediaSource;const n=this.media=t.media;Xf(n,"playing",this.onMediaPlaying),Xf(n,"waiting",this.onMediaWaiting),Xf(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(Qf(n,"playing",this.onMediaPlaying),Qf(n,"waiting",this.onMediaWaiting),Qf(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(null==(e=this.media)||!e.readyState||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,i;const r=null==(n=this.hls)?void 0:n.config;if(!r)return;const a=this.media;if(!a)return;const{seeking:o}=a,s=this.seeking&&!o,l=!this.seeking&&o,c=a.paused&&!o||a.ended||0===a.playbackRate;if(this.seeking=o,e!==t)return t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),void(0===this.waiting&&this.stallResolved(e));if(l||s)return void(s&&this.stallResolved(e));if(c)return this.nudgeRetry=0,this.stallResolved(e),void(!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(au.MEDIA_ENDED,{stalled:!1})));if(!Bh.getBuffered(a).length)return void(this.nudgeRetry=0);const u=Bh.bufferInfo(a,e,0),d=u.nextStart||0,h=this.fragmentTracker;if(o&&h&&this.hls){const t=Uy(this.hls.inFlightFragments,e),n=u.len>2,i=!d||t||d-e>2&&!h.getPartialFragment(e);if(n||i)return;this.moved=!1}const f=null==(i=this.hls)?void 0:i.latestLevelDetails;if(!this.moved&&null!==this.stalled&&h){if(!(u.len>0||d))return;const t=Math.max(d,u.start||0)-e,n=null!=f&&f.live?2*f.targetduration:2,i=Gy(e,h);if(t>0&&(t<=n||i))return void(a.paused||this._trySkipBufferHole(i))}const p=r.detectStallWithCurrentTimeMs,g=self.performance.now(),m=this.waiting;let v=this.stalled;if(null===v){if(!(m>0&&g-m<p))return void(this.stalled=g);v=this.stalled=m}const y=g-v;if(!o&&(y>=p||m)&&this.hls){var _;if("ended"===(null==(_=this.mediaSource)?void 0:_.readyState)&&(null==f||!f.live)&&Math.abs(e-((null==f?void 0:f.edge)||0))<1){if(this.ended)return;return this.ended=e||1,void this.hls.trigger(au.MEDIA_ENDED,{stalled:!0})}if(this._reportStall(u),!this.media||!this.hls)return}const E=Bh.bufferInfo(a,e,r.maxBufferHole);this._tryFixBufferStall(E,y,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log("playback not stuck anymore @".concat(e,", after ").concat(Math.round(n),"ms")),this.stallReported=!1,this.waiting=0,this.hls.trigger(au.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&null!=(n=this.buffered.audio)&&n.length&&i&&i.length>1&&e>i.end(0)){const n=Bh.bufferedInfo(Bh.timeRangesToArray(this.buffered.audio),e,0);if(n.len>1&&t>=n.start){const n=Bh.timeRangesToArray(i),r=Bh.bufferedInfo(n,t,0).bufferedIndex;if(r>-1&&r<n.length-1){const t=Bh.bufferedInfo(n,e,0).bufferedIndex,i=n[r].end,a=n[r+1].start;if((-1===t||t>r)&&a-i<1&&e-i<2){const n=new Error("nudging playhead to flush pipeline after video hole. currentTime: ".concat(e," hole: ").concat(i," -> ").concat(a," buffered index: ").concat(t));this.warn(n.message),this.media.currentTime+=1e-6;let r=Gy(e,this.fragmentTracker);r&&"fragment"in r?r=r.fragment:r||(r=void 0);const o=Bh.bufferInfo(this.media,e,0);this.hls.trigger(au.ERROR,{type:iu.MEDIA_ERROR,details:ru.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:n,reason:n.message,frag:r,buffer:o.len,bufferInfo:o})}}}}}_tryFixBufferStall(e,t,n){var i,r;const{fragmentTracker:a,media:o}=this,s=null==(i=this.hls)?void 0:i.config;if(!o||!a||!s)return;const l=null==(r=this.hls)?void 0:r.latestLevelDetails,c=Gy(n,a);if((c||null!=l&&l.live&&n<l.fragmentStart)&&(this._trySkipBufferHole(c)||!this.media))return;const u=e.buffered,d=this.adjacentTraversal(e,n);(u&&u.length>1&&e.len>s.maxBufferHole||e.nextStart&&(e.nextStart-n<s.maxBufferHole||d))&&(t>1e3*s.highBufferWatchdogPeriod||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,i=e.nextStart;if(n&&i){const e=n.getFragAtPos(t,uu.MAIN),r=n.getFragAtPos(i,uu.MAIN);if(e&&r)return r.sn-e.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:i,stalled:r}=this;if(!i&&null!==r&&n&&t){this.stallReported=!0;const i=new Error("Playback stalling at @".concat(n.currentTime," due to low buffer (").concat(jd(e),")"));this.warn(i.message),t.trigger(au.ERROR,{type:iu.MEDIA_ERROR,details:ru.BUFFER_STALLED_ERROR,fatal:!1,error:i,buffer:e.len,bufferInfo:e,stalled:{start:r}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:i}=this,r=null==(t=this.hls)?void 0:t.config;if(!i||!n||!r)return 0;const a=i.currentTime,o=Bh.bufferInfo(i,a,0),s=a<o.start?o.start:o.nextStart;if(s&&this.hls){const t=o.len<=r.maxBufferHole,c=o.len>0&&o.len<1&&i.readyState<3,u=s-a;if(u>0&&(t||c)){if(u>r.maxBufferHole){let t=!1;if(0===a){const e=n.getAppendedFrag(0,uu.MAIN);e&&s<e.end&&(t=!0)}if(!t&&e){var l;if(null==(l=this.hls.loadLevelObj)||!l.details||Uy(this.hls.inFlightFragments,s))return 0;let t=!1,i=e.end;for(;i<s;){const e=Gy(i,n);if(!e){t=!0;break}i+=e.duration}if(t)return 0}}const t=Math.max(s+.05,a+.1);if(this.warn("skipping hole, adjusting currentTime from ".concat(a," to ").concat(t)),this.moved=!0,i.currentTime=t,null==e||!e.gap){const n=new Error("fragment loaded with buffer holes, seeking from ".concat(a," to ").concat(t)),i={type:iu.MEDIA_ERROR,details:ru.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:n,reason:n.message,buffer:o.len,bufferInfo:o};e&&("fragment"in e?i.part=e:i.frag=e),this.hls.trigger(au.ERROR,i)}return t}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:i}=this,r=null==t?void 0:t.config;if(!n||!r)return 0;const a=n.currentTime;if(this.nudgeRetry++,i<r.nudgeMaxRetry){const o=a+(i+1)*r.nudgeOffset,s=new Error("Nudging 'currentTime' from ".concat(a," to ").concat(o));this.warn(s.message),n.currentTime=o,t.trigger(au.ERROR,{type:iu.MEDIA_ERROR,details:ru.BUFFER_NUDGE_ON_STALL,error:s,fatal:!1,buffer:e.len,bufferInfo:e})}else{const n=new Error("Playhead still not moving while enough data buffered @".concat(a," after ").concat(r.nudgeMaxRetry," nudges"));this.error(n.message),t.trigger(au.ERROR,{type:iu.MEDIA_ERROR,details:ru.BUFFER_STALLED_ERROR,error:n,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Uy(e,t){const n=Vy(e.main);if(n&&n.start<=t)return n;const i=Vy(e.audio);return i&&i.start<=t?i:null}function Vy(e){if(!e)return null;switch(e.state){case ep:case $f:case sp:case lp:return null}return e.frag}function Gy(e,t){return t.getAppendedFrag(e,uu.MAIN)||t.getPartialFragment(e)}function Hy(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function jy(e,t,n,i,r){let a=new e(t,n,"");try{a.value=i,r&&(a.type=r)}catch(o){a=new e(t,n,jd(r?mu({type:r},i):i))}return a}const zy=(()=>{const e=Hy();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class Zy{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(au.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(au.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(au.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(au.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(au.MANIFEST_LOADING,this.onManifestLoading,this),e.on(au.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(au.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(au.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(au.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(au.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(au.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(au.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(au.MANIFEST_LOADING,this.onManifestLoading,this),e.off(au.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(au.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(au.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(au.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var n;this.media=t.media,!1===(null==(n=t.overrides)?void 0:n.cueRemoval)&&(this.removeCues=!1)}onMediaAttached(){var e;const t=null==(e=this.hls)?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&dv(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if("metadata"===n.kind&&"id3"===n.label)return cv(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:i}=this.hls.config;if(!n&&!i)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=Hy();if(a)for(let e=0;e<r.length;e++){const t=r[e].type;if(t===Gp.emsg&&!n||!i)continue;const o=Fp(r[e].data),s=r[e].pts;let l=s+r[e].duration;l>zy&&(l=zy),l-s<=0&&(l=s+.25);for(let e=0;e<o.length;e++){const n=o[e];if(!Bp(n)){this.updateId3CueEnds(s,t);const e=jy(a,s,l,n,t);e&&this.id3Track.addCue(e)}}}}updateId3CueEnds(e,t){var n;const i=null==(n=this.id3Track)?void 0:n.cues;if(i)for(let n=i.length;n--;){const r=i[n];r.type===t&&r.startTime<e&&r.endTime===zy&&(r.endTime=e)}}onBufferFlushing(e,t){let{startOffset:n,endOffset:i,type:r}=t;const{id3Track:a,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:s,enableID3MetadataCues:l}}=o;if(a&&(s||l)){let e;e="audio"===r?e=>e.type===Gp.audioId3&&l:"video"===r?e=>e.type===Gp.emsg&&s:e=>e.type===Gp.audioId3&&l||e.type===Gp.emsg&&s,hv(a,n,i,e)}}onLevelUpdated(e,t){let{details:n}=t;this.updateDateRangeCues(n,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:i,enableDateRangeMetadataCues:r,interstitialsController:a}=this.hls.config;if(!r)return;const o=Hy();if(n&&i&&!a){const{fragmentStart:t,fragmentEnd:i}=e;let r=this.assetCue;r?(r.startTime=t,r.endTime=i):o&&(r=this.assetCue=jy(o,t,i,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),r&&(r.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(r),r.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:s}=this,{dateRanges:l}=e,c=Object.keys(l);let u=this.dateRangeCuesAppended;var d;if(s&&t)if(null!=(d=s.cues)&&d.length){const e=Object.keys(u).filter(e=>!c.includes(e));for(let t=e.length;t--;){var h;const n=e[t],i=null==(h=u[n])?void 0:h.cues;delete u[n],i&&Object.keys(i).forEach(e=>{const t=i[e];if(t){t.removeEventListener("enter",this.onEventCueEnter);try{s.removeCue(t)}catch(e){}}})}}else u=this.dateRangeCuesAppended={};const f=e.fragments[e.fragments.length-1];if(0!==c.length&&eu(null==f?void 0:f.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let e=0;e<c.length;e++){const t=c[e],n=l[t],i=n.startTime,r=u[t],s=(null==r?void 0:r.cues)||{};let d=(null==r?void 0:r.durationKnown)||!1,h=zy;const{duration:f,endDate:p}=n;if(p&&null!==f)h=i+f,d=!0;else if(n.endOnNext&&!d){const e=c.reduce((e,t)=>{if(t!==n.id){const i=l[t];if(i.class===n.class&&i.startDate>n.startDate&&(!e||n.startDate<e.startDate))return i}return e},null);e&&(h=e.startTime,d=!0)}const g=Object.keys(n.attr);for(let e=0;e<g.length;e++){const l=g[e];if(!Wh(l))continue;const c=s[l];if(c)!d||null!=r&&r.durationKnown?Math.abs(c.startTime-i)>.01&&(c.startTime=i,c.endTime=h):c.endTime=h;else if(o){let e=n.attr[l];Yh(l)&&(e=Iu(e));const r=jy(o,i,h,{key:l,data:e},Gp.dateRange);r&&(r.id=t,this.id3Track.addCue(r),s[l]=r,a&&("X-ASSET-LIST"===l||"X-ASSET-URL"===l)&&r.addEventListener("enter",this.onEventCueEnter))}}u[t]={cues:s,dateRange:n,durationKnown:d}}}}}class qy{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:e}=this,t=this.levelDetails;if(!e||!t)return;this.currentTime=e.currentTime;const n=this.computeLatency();if(null===n)return;this._latency=n;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:r}=this.config;if(!i||1===r||!t.live)return;const a=this.targetLatency;if(null===a)return;const o=n-a;if(o<Math.min(this.maxLatency,a+t.targetduration)&&o>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,r)),n=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20,i=Math.min(t,Math.max(1,n));this.changeMediaPlaybackRate(e,i)}else 1!==e.playbackRate&&0!==e.playbackRate&&this.changeMediaPlaybackRate(e,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return(null==(e=this.hls)?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(void 0!==e.liveMaxLatencyDuration)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(null===e||null===this.hls)return null;const{holdBack:t,partHoldBack:n,targetduration:i}=e,{liveSyncDuration:r,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,s=this.hls.userConfig;let l=o&&n||t;(this._targetLatencyUpdated||s.liveSyncDuration||s.liveSyncDurationCount||0===l)&&(l=void 0!==r?r:a*i);const c=i;return l+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(null===e||null===t)return null;const n=this.levelDetails;if(null===n)return null;const i=n.edge,r=e-t-this.edgeStalled,a=i-n.totalduration,o=i-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(a,r),o)}get drift(){const e=this.levelDetails;return null===e?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(au.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(au.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(au.MANIFEST_LOADING,this.onManifestLoading,this),e.on(au.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(au.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(au.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(au.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(au.MANIFEST_LOADING,this.onManifestLoading,this),e.off(au.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(au.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,t){let{details:n}=t;n.advanced&&this.onTimeupdate(),!n.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===ru.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&null!=(n=this.levelDetails)&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,i;e.playbackRate!==t&&(null==(n=this.hls)||n.logger.debug("[latency-controller]: latency=".concat(this.latency.toFixed(3),", targetLatency=").concat(null==(i=this.targetLatency)?void 0:i.toFixed(3),", forwardBufferLength=").concat(this.forwardBufferLength.toFixed(3),": adjusting playback rate from ").concat(e.playbackRate," to ").concat(t)),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}class Wy extends Hg{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(au.MANIFEST_LOADING,this.onManifestLoading,this),e.on(au.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(au.LEVEL_LOADED,this.onLevelLoaded,this),e.on(au.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(au.FRAG_BUFFERED,this.onFragBuffered,this),e.on(au.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(au.MANIFEST_LOADING,this.onManifestLoading,this),e.off(au.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(au.LEVEL_LOADED,this.onLevelLoaded,this),e.off(au.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(au.FRAG_BUFFERED,this.onFragBuffered,this),e.off(au.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,i=[],r={},a={};let o=!1,s=!1,l=!1;t.levels.forEach(e=>{const t=e.attrs;let{audioCodec:c,videoCodec:u}=e;c&&(e.audioCodec=c=Td(c,n)||void 0),u&&(u=e.videoCodec=function(e){const t=e.split(",");for(let e=0;e<t.length;e++){const n=t[e].split(".");n.length>2&&"avc1"===n[0]&&(t[e]="avc1.".concat(parseInt(n[1]).toString(16)).concat(("000"+parseInt(n[2]).toString(16)).slice(-4)))}return t.join(",")}(u));const{width:d,height:h,unknownCodecs:f}=e,p=(null==f?void 0:f.length)||0;if(o||(o=!(!d||!h)),s||(s=!!u),l||(l=!!c),p||c&&!this.isAudioSupported(c)||u&&!this.isVideoSupported(u))return void this.log('Some or all CODECS not supported "'.concat(t.CODECS,'"'));const{CODECS:g,"FRAME-RATE":m,"HDCP-LEVEL":v,"PATHWAY-ID":y,RESOLUTION:_,"VIDEO-RANGE":E}=t,b="".concat("".concat(y||".","-"),e.bitrate,"-").concat(_,"-").concat(m,"-").concat(g,"-").concat(E,"-").concat(v);if(r[b])if(r[b].uri===e.url||e.attrs["PATHWAY-ID"])r[b].addGroupId("audio",t.AUDIO),r[b].addGroupId("text",t.SUBTITLES);else{const t=a[b]+=1;e.attrs["PATHWAY-ID"]=new Array(t+1).join(".");const n=this.createLevel(e);r[b]=n,i.push(n)}else{const t=this.createLevel(e);r[b]=t,a[b]=1,i.push(t)}}),this.filterAndSortMediaOptions(i,t,o,s,l)}createLevel(e){const t=new Vd(e),n=e.supplemental;if(null!=n&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const e=new Error('SUPPLEMENTAL-CODECS not supported "'.concat(n.videoCodec,'"'));this.log(e.message),t.supportedResult=Md(e,[])}return t}isAudioSupported(e){return gd(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return gd(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,i,r){var a;let o=[],s=[],l=e;const c=(null==(a=t.stats)?void 0:a.parsing)||{};if((n||i)&&r&&(l=l.filter(e=>{let{videoCodec:t,videoRange:n,width:i,height:r}=e;return(!!t||!(!i||!r))&&function(e){return!!e&&kd.indexOf(e)>-1}(n)})),0===l.length)return Promise.resolve().then(()=>{if(this.hls){let e="no level with compatible codecs found in manifest",n=e;t.levels.length&&(n="one or more CODECS in variant not supported: ".concat(jd(t.levels.map(e=>e.attrs.CODECS).filter((e,t,n)=>n.indexOf(e)===t))),this.warn(n),e+=" (".concat(n,")"));const i=new Error(e);this.hls.trigger(au.ERROR,{type:iu.MEDIA_ERROR,details:ru.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:i,reason:n})}}),void(c.end=performance.now());t.audioTracks&&(o=t.audioTracks.filter(e=>!e.audioCodec||this.isAudioSupported(e.audioCodec)),Yy(o)),t.subtitles&&(s=t.subtitles,Yy(s));const u=l.slice(0);l.sort((e,t)=>{if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return kd.indexOf(e.videoRange)-kd.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){const n=yd(e.videoCodec),i=yd(t.videoCodec);if(n!==i)return i-n}if(e.uri===t.uri&&e.codecSet!==t.codecSet){const n=_d(e.codecSet),i=_d(t.codecSet);if(n!==i)return i-n}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0});let d=u[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==u.length))for(let e=0;e<u.length;e++)if(u[e].pathwayId===l[0].pathwayId){d=u[e];break}this._levels=l;for(let e=0;e<l.length;e++)if(l[e]===d){var h;this._firstLevel=e;const t=d.bitrate,n=this.hls.bandwidthEstimate;if(this.log("manifest loaded, ".concat(l.length," level(s) found, first bitrate: ").concat(t)),void 0===(null==(h=this.hls.userConfig)?void 0:h.abrEwmaDefaultEstimate)){const e=Math.min(t,this.hls.config.abrEwmaDefaultEstimateMax);e>n&&n===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=e)}break}const f=r&&!i,p=this.hls.config,g=!(!p.audioStreamController||!p.audioTrackController),m={levels:l,audioTracks:o,subtitleTracks:s,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:i,altAudio:g&&!f&&o.some(e=>!!e.url)};c.end=performance.now(),this.hls.trigger(au.MANIFEST_PARSED,m)}get levels(){return 0===this._levels.length?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const n=new Error("invalid level idx"),i=e<0;if(this.hls.trigger(au.ERROR,{type:iu.OTHER_ERROR,details:ru.LEVEL_SWITCH_ERROR,level:e,fatal:i,error:n,reason:n.message}),i)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,i=this.currentLevel,r=i?i.attrs["PATHWAY-ID"]:void 0,a=t[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,n===e&&i&&r===o)return;this.log("Switching to level ".concat(e," (").concat(a.height?a.height+"p ":"").concat(a.videoRange?a.videoRange+" ":"").concat(a.codecSet?a.codecSet+" ":"","@").concat(a.bitrate,")").concat(o?" with Pathway "+o:""," from level ").concat(n).concat(r?" with Pathway "+r:""));const s={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(au.LEVEL_SWITCHING,s);const l=a.details;if(!l||l.live){const e=this.switchParams(a.uri,null==i?void 0:i.details,l);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(e=>-1!==t.indexOf(e));if(e.length<1)return void this.warn("pathwayPriority ".concat(e," should contain at least one pathway from list: ").concat(t));this.steering.pathwayPriority=n}}onError(e,t){t.fatal||!t.context||t.context.type===su&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,t){let{frag:n}=t;if(void 0!==n&&n.type===uu.MAIN){const e=n.elementaryStreams;if(!Object.keys(e).some(t=>!!e[t]))return;const t=this._levels[n.level];null!=t&&t.loadError&&(this.log("Resetting level error count of ".concat(t.loadError," on frag buffered")),t.loadError=0)}}onLevelLoaded(e,t){var n;const{level:i,details:r}=t,a=t.levelInfo;var o;if(!a)return this.warn("Invalid level index ".concat(i)),void(null!=(o=t.deliveryDirectives)&&o.skip&&(r.deltaUpdateFailed=!0));if(a===this.currentLevel||t.withoutMultiVariant){0===a.fragmentError&&(a.loadError=0);let e=a.details;e===t.details&&e.advanced&&(e=void 0),this.playlistLoaded(i,t,e)}else null!=(n=t.deliveryDirectives)&&n.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,r=e.attrs["PATHWAY-ID"],a=e.details,o=null==a?void 0:a.age;this.log("Loading level index ".concat(i).concat(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"").concat(r?" Pathway "+r:"").concat(o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""," ").concat(n)),this.hls.trigger(au.LEVEL_LOADING,{url:n,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(1===this._levels.length)return;const n=this._levels.filter((t,n)=>n!==e||(this.steering&&this.steering.removeLevel(t),t===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,t.details&&t.details.fragments.forEach(e=>e.level=-1)),!1));Hf(n),this._levels=n,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=n.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(au.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,t){let{levels:n}=t;this._levels=n}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(au.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function Yy(e){const t={};e.forEach(e=>{const n=e.groupId||"";e.id=t[n]=t[n]||0,t[n]++})}function Ky(){return self.SourceBuffer||self.WebKitSourceBuffer}function Xy(){if(!wu())return!1;const e=Ky();return!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove}function Qy(){if(!Xy())return!1;const e=wu();return"function"==typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(t=>e.isTypeSupported(vd(t,"video")))||["mp4a.40.2","fLaC"].some(t=>e.isTypeSupported(vd(t,"audio"))))}class Jy extends dp{constructor(e,t,n){super(e,t,n,"stream-controller",uu.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const e=this.media,t=e?e.currentTime:null;if(null===t||!eu(t)||(this.log("Media seeked to ".concat(t.toFixed(3))),!this.getBufferedFrag(t)))return;const n=this.getFwdBufferInfoAtPos(e,t,uu.MAIN,0);null!==n&&0!==n.len?this.tick():this.warn("Main forward buffer length at ".concat(t,' on "seeked" event ').concat(n?n.len:"empty",")"))},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(au.MANIFEST_PARSED,this.onManifestParsed,this),e.on(au.LEVEL_LOADING,this.onLevelLoading,this),e.on(au.LEVEL_LOADED,this.onLevelLoaded,this),e.on(au.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(au.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(au.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(au.BUFFER_CREATED,this.onBufferCreated,this),e.on(au.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(au.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(au.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(au.MANIFEST_PARSED,this.onManifestParsed,this),e.off(au.LEVEL_LOADED,this.onLevelLoaded,this),e.off(au.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(au.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(au.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(au.BUFFER_CREATED,this.onBufferCreated,this),e.off(au.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(au.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(au.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:i}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=i.startLevel;-1===e&&(i.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=i.firstAutoLevel),i.nextLoadLevel=e,this.level=i.loadLevel,this._hasEnoughToStart=!!t}n>0&&-1===e&&!t&&(this.log("Override startPosition with lastCurrentTime @".concat(n.toFixed(3))),e=n),this.state=ep,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=$f}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case up:{const{levels:e,level:t}=this,n=null==e?void 0:e[t],i=null==n?void 0:n.details;if(i&&(!i.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(i))break;this.state=ep;break}if(this.hls.nextLoadLevel!==this.level){this.state=ep;break}break}case ip:this.checkRetryDate()}this.state===ep&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),null!=(e=this.media)&&e.readyState&&!1===this.media.seeking&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:i}=this;if(null===t||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const r=this.buffering?e.nextLoadLevel:e.loadLevel;if(null==n||!n[r])return;const a=n[r],o=this.getMainFwdBufferInfo();if(null===o)return;const s=this.getLevelDetails();if(s&&this._streamEnded(o,s)){const e={};return 2===this.altAudio&&(e.type="video"),this.hls.trigger(au.BUFFER_EOS,e),void(this.state=sp)}if(!this.buffering)return;e.loadLevel!==r&&-1===e.manualLevel&&this.log("Adapting to level ".concat(r," from level ").concat(this.level)),this.level=e.nextLoadLevel=r;const l=a.details;if(!l||this.state===up||this.waitForLive(a))return this.level=r,this.state=up,void(this.startFragRequested=!1);const c=o.len,u=this.getMaxBufferLength(a.maxBitrate);if(c>=u)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const d=this.backtrackFragment?this.backtrackFragment.start:o.end;let h=this.getNextFragment(d,l);if(this.couldBacktrack&&!this.fragPrevious&&h&&Fu(h)&&this.fragmentTracker.getState(h)!==_h){var f;const e=(null!=(f=this.backtrackFragment)?f:h).sn-l.startSN,t=l.fragments[e-1];t&&h.cc===t.cc&&(h=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(h&&this.isLoopLoading(h,d)){if(!h.gap){const e=this.audioOnly&&!this.altAudio?Du:Ou,t=(e===Ou?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,uu.MAIN)}h=this.getNextFragmentLoopLoading(h,l,o,uu.MAIN,u)}h&&(h.initSegment&&!h.initSegment.data&&!this.bitrateTest&&(h=h.initSegment),this.loadFragment(h,a,d))}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);i===mh||i===yh?Fu(e)?this.bitrateTest?(this.log("Fragment ".concat(e.sn," of level ").concat(e.level," is being downloaded to test bitrate and will not be buffered")),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,uu.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let n;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const r=this.getLevelDetails();if(null!=r&&r.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*r.targetduration)return}if(!t.paused&&e){const t=e[this.hls.nextLoadLevel],i=this.fragLastKbps;n=i&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*i)+1:0}else n=0;const a=this.getBufferedFrag(t.currentTime+n);if(a){const e=this.followingBufferedFrag(a);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,n=e.duration,i=Math.max(a.end,t+Math.min(Math.max(n-this.config.maxFragLookUpTolerance,n*(this.couldBacktrack?.5:.125)),n*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(i,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case tp:case np:case ip:case ap:case op:this.state=ep}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,2===this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;Xf(n,"playing",this.onMediaPlaying),Xf(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(Qf(n,"playing",this.onMediaPlaying),Qf(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(au.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,i=!1;for(let e=0;e<t.levels.length;e++){const r=t.levels[e].audioCodec;r&&(n=n||-1!==r.indexOf("mp4a.40.2"),i=i||-1!==r.indexOf("mp4a.40.5"))}this.audioCodecSwitch=n&&i&&!function(){var e;const t=Ky();return"function"==typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==ep)return;const i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=up)}onLevelLoaded(e,t){var n;const{levels:i,startFragRequested:r}=this,a=t.level,o=t.details,s=o.totalduration;if(!i)return void this.warn("Levels were reset while loading level ".concat(a));this.log("Level ".concat(a," loaded [").concat(o.startSN,",").concat(o.endSN,"]").concat(o.lastPartSn?"[part-".concat(o.lastPartSn,"-").concat(o.lastPartIndex,"]"):"",", cc [").concat(o.startCC,", ").concat(o.endCC,"] duration:").concat(s));const l=t.levelInfo,c=this.fragCurrent;c&&(this.state===np||this.state===ip)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();let u=0;if(o.live||null!=(n=l.details)&&n.live){var d;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;u=this.alignPlaylists(o,l.details,null==(d=this.levelLastLoaded)?void 0:d.details)}if(l.details=o,this.levelLastLoaded=l,r||this.setStartPosition(o,u),this.hls.trigger(au.LEVEL_UPDATED,{details:o,level:a}),this.state===up){if(this.waitForCdnTuneIn(o))return;this.state=ep}r&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const i=this.hls.liveSyncPosition,r=this.getLoadPosition(),a=e.fragmentStart,o=e.edge,s=r>=a-t.maxFragLookUpTolerance&&r<=o;if(null!==i&&n.duration>i&&(r<i||!s)){const a=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!s&&n.readyState<4||r<o-a)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),n.readyState))if(this.warn("Playback: ".concat(r.toFixed(3)," is located too far from the end of live sliding playlist: ").concat(o,", reset currentTime to : ").concat(i.toFixed(3))),"buffered"===this.config.liveSyncMode){var l;const e=Bh.bufferInfo(n,i,0);if(null==(l=e.buffered)||!l.length)return void(n.currentTime=i);if(e.start<=r)return void(n.currentTime=i);const{nextStart:t}=Bh.bufferedInfo(e.buffered,r,0);t&&(n.currentTime=t)}else n.currentTime=i}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:i,payload:r}=e,{levels:a}=this;if(!a)return void this.warn("Levels were reset while fragment load was in progress. Fragment ".concat(n.sn," of level ").concat(n.level," will not be buffered"));const o=a[n.level];if(!o)return void this.warn("Level ".concat(n.level," not found on progress"));const s=o.details;if(!s)return this.warn("Dropping fragment ".concat(n.sn," of level ").concat(n.level," after level details were reset")),void this.fragmentTracker.removeFragment(n);const l=o.videoCodec,c=s.PTSKnown||!s.live,u=null==(t=n.initSegment)?void 0:t.data,d=this._getAudioCodec(o),h=this.transmuxer=this.transmuxer||new Vg(this.hls,uu.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=i?i.index:-1,p=-1!==f,g=new kh(n.level,n.sn,n.stats.chunkCount,r.byteLength,f,p),m=this.initPTS[n.cc];h.push(r,u,d,l,n,i,s.totalduration,c,g,m)}onAudioTrackSwitching(e,t){const n=this.hls,i=2===this.altAudio;if(Qd(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i)return this.fragmentTracker.removeAllFragments(),n.once(au.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(au.AUDIO_TRACK_SWITCHED,t)}),void n.trigger(au.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});n.trigger(au.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=Qd(t.url,this.hls);if(n){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let i,r,a=!1;for(const e in n){const t=n[e];if("main"===t.id){if(r=e,i=t,"video"===e){const t=n[e];t&&(this.videoBuffer=t.buffer)}}else a=!0}a&&i?(this.log("Alternate track found, use ".concat(r,".buffered to schedule main fragment loading")),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:i}=t,r=n.type===uu.MAIN;if(r){if(this.fragContextChanged(n))return this.warn("Fragment ".concat(n.sn).concat(i?" p: "+i.index:""," of level ").concat(n.level," finished buffering, but was aborted. state: ").concat(this.state)),void(this.state===op&&(this.state=ep));const e=i?i.stats:n.stats;this.fragLastKbps=Math.round(8*e.total/(e.buffering.end-e.loading.first)),Fu(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,i)}const a=this.media;a&&(!this._hasEnoughToStart&&Bh.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal)this.state=lp;else switch(t.details){case ru.FRAG_GAP:case ru.FRAG_PARSING_ERROR:case ru.FRAG_DECRYPT_ERROR:case ru.FRAG_LOAD_ERROR:case ru.FRAG_LOAD_TIMEOUT:case ru.KEY_LOAD_ERROR:case ru.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(uu.MAIN,t);break;case ru.LEVEL_LOAD_ERROR:case ru.LEVEL_LOAD_TIMEOUT:case ru.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===up&&(null==(n=t.context)?void 0:n.type)===su&&(this.state=ep);break;case ru.BUFFER_ADD_CODEC_ERROR:case ru.BUFFER_APPEND_ERROR:if("main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case ru.BUFFER_FULL_ERROR:if("main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case ru.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onFragLoadEmergencyAborted(){this.state=ep,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,t){let{type:n}=t;if(n!==Du||!this.altAudio){const e=(n===Ou?this.videoBuffer:this.mediaBuffer)||this.media;e&&(this.afterBufferFlushed(e,n,uu.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,-1===this.level&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking)return void this.log("could not seek to ".concat(n,", already seeking at ").concat(t));const i=this.timelineOffset;i&&n&&(n+=i);const r=this.getLevelDetails(),a=Bh.getBuffered(e),o=a.length?a.start(0):0,s=o-n,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||s>0&&(s<l||this.loadingParts&&s<2*((null==r?void 0:r.partTarget)||0)))&&(this.log("adjusting start position by ".concat(s," to match buffer start")),n+=s,this.startPosition=n),t<n&&(this.log("seek to target start position ".concat(n," from current time ").concat(t," buffer start ").concat(o)),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(e=>{const{hls:n}=this,i=null==e?void 0:e.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=ep,this.startFragRequested=!1,this.bitrateTest=!1;const r=i.stats;r.parsing.start=r.parsing.end=r.buffering.start=r.buffering.end=self.performance.now(),n.trigger(au.FRAG_LOADED,e),i.bitrateTest=!1}).catch(t=>{this.state===$f||this.state===lp||(this.warn(t),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:n}=this,{remuxResult:i,chunkMeta:r}=e,a=this.getCurrentContext(r);if(!a)return void this.resetWhenMissingContext(r);const{frag:o,part:s,level:l}=a,{video:c,text:u,id3:d,initSegment:h}=i,{details:f}=l,p=this.altAudio?void 0:i.audio;if(this.fragContextChanged(o))this.fragmentTracker.removeFragment(o);else{if(this.state=ap,h){const e=h.tracks;if(e){const i=o.initSegment||o;if(this.unhandledEncryptionError(h,o))return;this._bufferInitSegment(l,e,i,r),n.trigger(au.FRAG_PARSING_INIT_SEGMENT,{frag:i,id:t,tracks:e})}const i=h.initPTS,a=h.timescale,s=this.initPTS[o.cc];if(eu(i)&&(!s||s.baseTime!==i||s.timescale!==a)){const e=h.trackId;this.initPTS[o.cc]={baseTime:i,timescale:a,trackId:e},n.trigger(au.INIT_PTS_FOUND,{frag:o,id:t,initPTS:i,timescale:a,trackId:e})}}if(c&&f){p&&"audiovideo"===c.type&&this.logMuxedErr(o);const e=f.fragments[o.sn-1-f.startSN],t=o.sn===f.startSN,n=!e||o.cc>e.cc;if(!1!==i.independent){const{startPTS:e,endPTS:i,startDTS:a,endDTS:l}=c;if(s)s.elementaryStreams[c.type]={startPTS:e,endPTS:i,startDTS:a,endDTS:l};else if(c.firstKeyFrame&&c.independent&&1===r.id&&!n&&(this.couldBacktrack=!0),c.dropped&&c.independent){const r=this.getMainFwdBufferInfo(),a=(r?r.end:this.getLoadPosition())+this.config.maxBufferHole,s=c.firstKeyFramePTS?c.firstKeyFramePTS:e;if(!t&&a<s-this.config.maxBufferHole&&!n)return void this.backtrack(o);n&&(o.gap=!0),o.setElementaryStreamInfo(c.type,o.start,i,o.start,l,!0)}else t&&e-(f.appliedTimelineOffset||0)>2&&(o.gap=!0);o.setElementaryStreamInfo(c.type,e,i,a,l),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(c,o,s,r,t||n)}else{if(!t&&!n)return void this.backtrack(o);o.gap=!0}}if(p){const{startPTS:e,endPTS:t,startDTS:n,endDTS:i}=p;s&&(s.elementaryStreams[Du]={startPTS:e,endPTS:t,startDTS:n,endDTS:i}),o.setElementaryStreamInfo(Du,e,t,n,i),this.bufferFragmentData(p,o,s,r)}if(f&&null!=d&&d.samples.length){const e={id:t,frag:o,details:f,samples:d.samples};n.trigger(au.FRAG_PARSING_METADATA,e)}if(f&&u){const e={id:t,frag:o,details:f,samples:u.samples};n.trigger(au.FRAG_PARSING_USERDATA,e)}}}logMuxedErr(e){this.warn("".concat(Fu(e)?"Media":"Init"," segment with muxed audiovideo where only video expected: ").concat(e.url))}_bufferInitSegment(e,t,n,i){if(this.state!==ap)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:r,video:a,audiovideo:o}=t;if(r){const n=e.audioCodec;let i=Sd(r.codec,n);"mp4a"===i&&(i="mp4a.40.5");const a=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){i&&(i=-1!==i.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const e=r.metadata;e&&"channelCount"in e&&1!==(e.channelCount||1)&&-1===a.indexOf("firefox")&&(i="mp4a.40.5")}i&&-1!==i.indexOf("mp4a.40.5")&&-1!==a.indexOf("android")&&"audio/mpeg"!==r.container&&(i="mp4a.40.2",this.log("Android: force audio codec to ".concat(i))),n&&n!==i&&this.log('Swapping manifest audio codec "'.concat(n,'" for "').concat(i,'"')),r.levelCodec=i,r.id=uu.MAIN,this.log("Init audio buffer, container:".concat(r.container,", codecs[selected/level/parsed]=[").concat(i||"","/").concat(n||"","/").concat(r.codec,"]")),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=uu.MAIN;const n=a.codec;if(4===(null==n?void 0:n.length))switch(n){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e"}this.log("Init video buffer, container:".concat(a.container,", codecs[level/parsed]=[").concat(e.videoCodec||"","/").concat(n,"]").concat(a.codec!==n?" parsed-corrected="+a.codec:"").concat(a.supplemental?" supplemental="+a.supplemental:"")),delete t.audiovideo}o&&(this.log("Init audiovideo buffer, container:".concat(o.container,", codecs[level/parsed]=[").concat(e.codecs,"/").concat(o.codec,"]")),delete t.video,delete t.audio);const s=Object.keys(t);if(s.length){if(this.hls.trigger(au.BUFFER_CODECS,t),!this.hls)return;s.forEach(e=>{const r=t[e].initSegment;null!=r&&r.byteLength&&this.hls.trigger(au.BUFFER_APPENDING,{type:e,data:r,frag:n,part:null,chunkMeta:i,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&2===this.altAudio?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,uu.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,n=null==e?void 0:e[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ep}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const n=e.currentTime;if(Bh.isBuffered(e,n)?t=this.getAppendedFrag(n):Bh.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,n=t.level;(!e||t.sn!==e.sn||e.level!==n)&&(this.fragPlaying=t,this.hls.trigger(au.FRAG_CHANGED,{frag:t}),(!e||e.level!==n)&&this.hls.trigger(au.LEVEL_SWITCHED,{level:n}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;return eu(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;if(eu(t)){const e=this.getLevelDetails(),n=this.currentFrag||(e?eh(null,e.fragments,t):null);if(n){const e=n.programDateTime;if(null!==e){const i=e+1e3*(t-n.start);return new Date(i)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class $y extends vu{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const i=this.keyIdToKeyInfo[n].loader;if(i){var t;if(e&&e!==(null==(t=i.context)?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ru.KEY_LOAD_ERROR,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;return new Oh({type:iu.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:n,networkDetails:i})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let i=0,r=t.length;i<r;i++){const a=t[i];if(e.cc<=a.cc&&(!Fu(e)||!Fu(a)||e.sn<a.sn)||!n&&i==r-1)return this.emeController.selectKeySystemFormat(a).then(e=>{if(!this.emeController)return;a.setKeyFormat(e);const t=cf(e);return t?this.emeController.getKeySystemAccess([t]):void 0})}if(this.config.requireKeySystemAccessOnStart){const e=df(this.config);if(e.length)return this.emeController.getKeySystemAccess(e)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,i;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const n=new Error(t?"Expected frag.decryptdata to be defined after setting format ".concat(t):"Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ".concat(this.emeController&&this.config.emeEnabled,")"));return Promise.reject(this.createKeyLoadError(e,ru.KEY_LOAD_ERROR,n))}const a=r.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,ru.KEY_LOAD_ERROR,new Error('Invalid key URI: "'.concat(a,'"'))));const o=e_(r);let s=this.keyIdToKeyInfo[o];if(null!=(n=s)&&n.decryptdata.key)return r.key=s.decryptdata.key,Promise.resolve({frag:e,keyInfo:s});if(this.emeController&&null!=(i=s)&&i.keyLoadPromise)switch(this.emeController.getKeyStatus(s.decryptdata)){case"usable":case"usable-in-future":return s.keyLoadPromise.then(t=>{const{keyInfo:n}=t;return r.key=n.decryptdata.key,{frag:e,keyInfo:n}})}switch(this.log("".concat(this.keyIdToKeyInfo[o]?"Rel":"L","oading").concat(r.keyId?" keyId: "+xu(r.keyId):""," URI: ").concat(r.uri," from ").concat(e.type," ").concat(e.level)),s=this.keyIdToKeyInfo[o]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===r.keyFormat?this.loadKeyHTTP(s,e):this.loadKeyEME(s,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(s,e);default:return Promise.reject(this.createKeyLoadError(e,ru.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'.concat(r.method,'"'))))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const i=this.emeController.loadKey(n);return(e.keyLoadPromise=i.then(t=>(e.mediaKeySessionContext=t,n))).catch(n=>{throw e.keyLoadPromise=null,"data"in n&&(n.data.frag=t),n})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,i=new(0,n.loader)(n);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((r,a)=>{const o={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},s=n.keyLoadPolicy.default,l={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,n,i)=>{const{frag:o,keyInfo:s}=n,l=e_(s.decryptdata);if(!o.decryptdata||s!==this.keyIdToKeyInfo[l])return a(this.createKeyLoadError(o,ru.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),i));s.decryptdata.key=o.decryptdata.key=new Uint8Array(e.data),o.keyLoader=null,s.loader=null,r({frag:o,keyInfo:s})},onError:(e,n,i,r)=>{this.resetLoader(n),a(this.createKeyLoadError(t,ru.KEY_LOAD_ERROR,new Error("HTTP Error ".concat(e.code," loading key ").concat(e.text)),i,mu({url:o.url,data:void 0},e)))},onTimeout:(e,n,i)=>{this.resetLoader(n),a(this.createKeyLoadError(t,ru.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),i))},onAbort:(e,n,i)=>{this.resetLoader(n),a(this.createKeyLoadError(t,ru.INTERNAL_ABORTED,new Error("key loading aborted"),i))}};i.load(o,l,c)})}resetLoader(e){const{frag:t,keyInfo:n,url:i}=e,r=n.loader;t.keyLoader===r&&(t.keyLoader=null,n.loader=null);const a=e_(n.decryptdata)||i;delete this.keyIdToKeyInfo[a],r&&r.destroy()}}function e_(e){if(e.keyFormat!==lf.FAIRPLAY){const t=e.keyId;if(t)return xu(t)}return e.uri}function t_(e){const{type:t}=e;switch(t){case lu:return uu.AUDIO;case cu:return uu.SUBTITLE;default:return uu.MAIN}}function n_(e,t){let n=e.url;return(void 0===n||0===n.indexOf("data:"))&&(n=t.url),n}class i_{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(au.MANIFEST_LOADING,this.onManifestLoading,this),e.on(au.LEVEL_LOADING,this.onLevelLoading,this),e.on(au.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(au.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(au.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(au.MANIFEST_LOADING,this.onManifestLoading,this),e.off(au.LEVEL_LOADING,this.onLevelLoading,this),e.off(au.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(au.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(au.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,i=t.loader,r=new(n||i)(t);return this.loaders[e.type]=r,r}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ou,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:i,pathwayId:r,url:a,deliveryDirectives:o,levelInfo:s}=t;this.load({id:n,level:i,pathwayId:r,responseType:"text",type:su,url:a,deliveryDirectives:o,levelOrTrack:s})}onAudioTrackLoading(e,t){const{id:n,groupId:i,url:r,deliveryDirectives:a,track:o}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:lu,url:r,deliveryDirectives:a,levelOrTrack:o})}onSubtitleTrackLoading(e,t){const{id:n,groupId:i,url:r,deliveryDirectives:a,track:o}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:cu,url:r,deliveryDirectives:a,levelOrTrack:o})}onLevelsUpdated(e,t){const n=this.loaders[su];if(n){const e=n.context;e&&!t.levels.some(t=>t===e.levelOrTrack)&&(n.abort(),delete this.loaders[su])}}load(e){var t;const n=this.hls.config;let i,r=this.getInternalLoader(e);if(r){const t=this.hls.logger,n=r.context;if(n&&n.levelOrTrack===e.levelOrTrack&&(n.url===e.url||n.deliveryDirectives&&!e.deliveryDirectives))return void(n.url===e.url?t.log("[playlist-loader]: ignore ".concat(e.url," ongoing request")):t.log("[playlist-loader]: ignore ".concat(e.url," in favor of ").concat(n.url)));t.log("[playlist-loader]: aborting previous loader for type: ".concat(e.type)),r.abort()}if(i=e.type===ou?n.manifestLoadPolicy.default:pu({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),eu(null==(t=e.deliveryDirectives)?void 0:t.part)){let t;if(e.type===su&&null!==e.level?t=this.hls.levels[e.level].details:e.type===lu&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===cu&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,n=t.targetduration;if(e&&n){const t=1e3*Math.max(3*e,.8*n);i=pu({},i,{maxTimeToFirstByteMs:Math.min(t,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,i.maxTimeToFirstByteMs)})}}}const a=i.errorRetry||i.timeoutRetry||{},o={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},s={onSuccess:(e,t,n,i)=>{const r=this.getInternalLoader(n);this.resetInternalLoader(n.type);const a=e.data;t.parsing.start=performance.now(),Ef.isMediaPlaylist(a)||n.type!==ou?this.handleTrackOrLevelPlaylist(e,t,n,i||null,r):this.handleMasterPlaylist(e,t,n,i)},onError:(e,t,n,i)=>{this.handleNetworkError(t,n,!1,e,i)},onTimeout:(e,t,n)=>{this.handleNetworkError(t,n,!0,void 0,e)}};r.load(e,o,s)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log("".concat(e?"auto":"force"," startLoad with configured startPosition ").concat(t)),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,i){const r=this.hls,a=e.data,o=n_(e,n),s=Ef.parseMasterPlaylist(a,o);if(s.playlistParsingError)return t.parsing.end=performance.now(),void this.handleManifestParsingError(e,n,s.playlistParsingError,i,t);const{contentSteering:l,levels:c,sessionData:u,sessionKeys:d,startTimeOffset:h,variableList:f}=s;this.variableList=f,c.forEach(e=>{const{unknownCodecs:t}=e;if(t){const{preferManagedMediaSource:n}=this.hls.config;let{audioCodec:i,videoCodec:r}=e;for(let a=t.length;a--;){const o=t[a];gd(o,"audio",n)?(e.audioCodec=i=i?"".concat(i,",").concat(o):o,fd.audio[i.substring(0,4)]=2,t.splice(a,1)):gd(o,"video",n)&&(e.videoCodec=r=r?"".concat(r,",").concat(o):o,fd.video[r.substring(0,4)]=2,t.splice(a,1))}}});const{AUDIO:p=[],SUBTITLES:g,"CLOSED-CAPTIONS":m}=Ef.parseMasterPlaylistMedia(a,o,s);p.length&&!p.some(e=>!e.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new qh({}),bitrate:0,url:""})),r.trigger(au.MANIFEST_LOADED,{levels:c,audioTracks:p,subtitles:g,captions:m,contentSteering:l,url:o,stats:t,networkDetails:i,sessionData:u,sessionKeys:d,startTimeOffset:h,variableList:f})}handleTrackOrLevelPlaylist(e,t,n,i,r){const a=this.hls,{id:o,level:s,type:l}=n,c=n_(e,n),u=eu(s)?s:eu(o)?o:0,d=t_(n),h=Ef.parseLevelPlaylist(e.data,c,u,d,0,this.variableList);if(l===ou){const e={attrs:new qh({}),bitrate:0,details:h,name:"",url:c};h.requestScheduled=t.loading.start+Bf(h,0),a.trigger(au.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:c,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=h,this.handlePlaylistLoaded(h,e,t,n,i,r)}handleManifestParsingError(e,t,n,i,r){this.hls.trigger(au.ERROR,{type:iu.NETWORK_ERROR,details:ru.MANIFEST_PARSING_ERROR,fatal:t.type===ou,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:i,stats:r})}handleNetworkError(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,a="A network ".concat(n?"timeout":"error"+(i?" (status "+i.code+")":"")," occurred while loading ").concat(e.type);e.type===su?a+=": ".concat(e.level," id: ").concat(e.id):(e.type===lu||e.type===cu)&&(a+=" id: ".concat(e.id,' group-id: "').concat(e.groupId,'"'));const o=new Error(a);this.hls.logger.warn("[playlist-loader]: ".concat(a));let s=ru.UNKNOWN,l=!1;const c=this.getInternalLoader(e);switch(e.type){case ou:s=n?ru.MANIFEST_LOAD_TIMEOUT:ru.MANIFEST_LOAD_ERROR,l=!0;break;case su:s=n?ru.LEVEL_LOAD_TIMEOUT:ru.LEVEL_LOAD_ERROR,l=!1;break;case lu:s=n?ru.AUDIO_TRACK_LOAD_TIMEOUT:ru.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case cu:s=n?ru.SUBTITLE_TRACK_LOAD_TIMEOUT:ru.SUBTITLE_LOAD_ERROR,l=!1}c&&this.resetInternalLoader(e.type);const u={type:iu.NETWORK_ERROR,details:s,fatal:l,url:e.url,loader:c,context:e,error:o,networkDetails:t,stats:r};if(i){const n=(null==t?void 0:t.url)||e.url;u.response=mu({url:n,data:void 0},i)}this.hls.trigger(au.ERROR,u)}handlePlaylistLoaded(e,t,n,i,r,a){const o=this.hls,{type:s,level:l,levelOrTrack:c,id:u,groupId:d,deliveryDirectives:h}=i,f=n_(t,i),p=t_(i);let g="number"==typeof i.level&&p===uu.MAIN?l:void 0;const m=e.playlistParsingError;if(m){if(this.hls.logger.warn("".concat(m," ").concat(e.url)),!o.config.ignorePlaylistParsingErrors)return void o.trigger(au.ERROR,{type:iu.NETWORK_ERROR,details:ru.LEVEL_PARSING_ERROR,fatal:!1,url:f,error:m,reason:m.message,response:t,context:i,level:g,parent:p,networkDetails:r,stats:n});e.playlistParsingError=null}if(!e.fragments.length){const a=e.playlistParsingError=new Error("No Segments found in Playlist");return void o.trigger(au.ERROR,{type:iu.NETWORK_ERROR,details:ru.LEVEL_EMPTY_ERROR,fatal:!1,url:f,error:a,reason:a.message,response:t,context:i,level:g,parent:p,networkDetails:r,stats:n})}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),s){case ou:case su:if(g)if(c){if(c!==o.levels[g]){const e=o.levels.indexOf(c);e>-1&&(g=e)}}else g=0;o.trigger(au.LEVEL_LOADED,{details:e,levelInfo:c||o.levels[0],level:g||0,id:u||0,stats:n,networkDetails:r,deliveryDirectives:h,withoutMultiVariant:s===ou});break;case lu:o.trigger(au.AUDIO_TRACK_LOADED,{details:e,track:c,id:u||0,groupId:d||"",stats:n,networkDetails:r,deliveryDirectives:h});break;case cu:o.trigger(au.SUBTITLE_TRACK_LOADED,{details:e,track:c,id:u||0,groupId:d||"",stats:n,networkDetails:r,deliveryDirectives:h})}}}let r_=class e{static get version(){return yp}static isMSESupported(){return Xy()}static isSupported(){return Qy()}static getMediaSource(){return wu()}static get Events(){return au}static get MetadataSchema(){return Gp}static get ErrorTypes(){return iu}static get ErrorDetails(){return ru}static get DefaultConfig(){return e.defaultConfig?e.defaultConfig:ky}static set DefaultConfig(t){e.defaultConfig=t}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new vp,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const n=this.logger=function(e,t,n){const i=Eu();if("object"==typeof console&&!0===e||"object"==typeof e){const r=["debug","log","info","warn","error"];r.forEach(t=>{i[t]=bu(t,e,n)});try{i.log('Debug logs enabled for "'.concat(t,'" in hls.js version 1.6.12'))}catch(e){return Eu()}r.forEach(t=>{Tu[t]=bu(t,e)})}else pu(Tu,i);return i}(t.debug||!1,"Hls instance",t.assetPlayerId),i=this.config=function(e,t,n){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=Fy(e),r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(e=>{const a="".concat("level"===e?"playlist":e,"LoadPolicy"),o=void 0===t[a],s=[];r.forEach(n=>{const r="".concat(e,"Loading").concat(n),l=t[r];if(void 0!==l&&o){s.push(r);const e=i[a].default;switch(t[a]={default:e},n){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}}),s.length&&n.warn('hls.js config: "'.concat(s.join('", "'),'" setting(s) are deprecated, use "').concat(a,'": ').concat(jd(t[a])))}),mu(mu({},i),t)}(e.DefaultConfig,t,n);this.userConfig=t,i.progressive&&function(e,t){const n=e.loader;n!==Cy&&n!==Ny?(t.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1):Ly()&&(e.loader=Cy,e.progressive=!0,e.enableSoftwareAES=!0,t.log("[config]: Progressive streaming enabled, using FetchLoader"))}(i,n);const{abrController:r,bufferController:a,capLevelController:o,errorController:s,fpsController:l}=i,c=new s(this),u=this.abrController=new r(this),d=new Eh(this),h=i.interstitialsController,f=h?this.interstitialsController=new h(this,e):null,p=this.bufferController=new a(this,d),g=this.capLevelController=new o(this),m=new l(this),v=new i_(this),y=i.contentSteeringController,_=y?new y(this):null,E=this.levelController=new Wy(this,_),b=new Zy(this),T=new $y(this.config,this.logger),S=this.streamController=new Jy(this,d,T),w=this.gapController=new By(this,d);g.setStreamController(S),m.setStreamController(S);const A=[v,E,S];f&&A.splice(1,0,f),_&&A.splice(1,0,_),this.networkControllers=A;const R=[u,p,w,g,m,b,d];this.audioTrackController=this.createController(i.audioTrackController,A);const x=i.audioStreamController;x&&A.push(this.audioStreamController=new x(this,d,T)),this.subtitleTrackController=this.createController(i.subtitleTrackController,A);const I=i.subtitleStreamController;I&&A.push(this.subtititleStreamController=new I(this,d,T)),this.createController(i.timelineController,R),T.emeController=this.emeController=this.createController(i.emeController,R),this.cmcdController=this.createController(i.cmcdController,R),this.latencyController=this.createController(qy,R),this.coreComponents=R,A.push(c);const L=c.onErrorOut;"function"==typeof L&&this.on(au.ERROR,L,c),this.on(au.MANIFEST_LOADED,v.onManifestLoaded,v)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.on(e,t,n)}once(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,i=arguments.length>3?arguments[3]:void 0;this._emitter.off(e,t,n,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),!this.triggeringException){this.triggeringException=!0;const n=e===au.ERROR;this.trigger(au.ERROR,{type:iu.OTHER_ERROR,details:ru.INTERNAL_EXCEPTION,fatal:n,event:e,error:t}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(au.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const t=new Error("attachMedia failed: invalid argument (".concat(e,")"));return void this.trigger(au.ERROR,{type:iu.OTHER_ERROR,details:ru.ATTACH_MEDIA_ERROR,fatal:!0,error:t})}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,i=t?e:{media:n};this._media=n,this.trigger(au.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(au.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(au.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,i=this._url=Cu.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log("loadSource:".concat(i)),t&&n&&(n!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(au.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1?arguments[1]:void 0;this.logger.log("startLoad(".concat(e+(t?", <skip seek to start>":""),")")),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),this.started&&this.networkControllers);n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!this.started&&this.networkControllers);e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[uu.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[uu.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[uu.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=null==e?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=function(){try{return crypto.randomUUID()}catch(e){try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(e){let t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)})}}}()),e}get levels(){return this.levelController.levels||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log("set currentLevel:".concat(e)),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log("set nextLevel:".concat(e)),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log("set loadLevel:".concat(e)),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log("set firstLevel:".concat(e)),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return-1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log("set startLevel:".concat(e)),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log("set autoLevelCapping:".concat(e)),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){(function(e){return Nd.indexOf(e)>-1})(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let i=0;i<n;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let i;if(i=-1===t&&null!=e&&e.length?e.length-1:t,n)for(let t=i;t--;){const i=e[t].attrs["HDCP-LEVEL"];if(i&&i<=n)return t}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return(null==(t=this.audioTrackController)?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return(null==(t=this.subtitleTrackController)?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!(null==(e=this.bufferController)||!e.bufferedToEnd)}get interstitialsManager(){var e;return(null==(e=this.interstitialsController)?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e){return Pd(e,Zd(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.allAudioTracks),navigator.mediaCapabilities)}};r_.defaultConfig=void 0;const a_=Object.freeze(Object.defineProperty({__proto__:null,AbrController:Jd,AttrList:qh,AudioStreamController:Gg,AudioTrackController:qg,BasePlaylistController:Hg,BaseSegment:ku,BaseStreamController:dp,BufferController:Qg,CMCDController:$m,CapLevelController:em,ChunkMetadata:kh,ContentSteeringController:ev,Cues:Iy,DateRange:Kh,EMEController:iv,ErrorActionFlags:fh,ErrorController:ph,ErrorDetails:ru,ErrorTypes:iu,Events:au,FPSController:lv,FetchLoader:Cy,Fragment:Bu,Hls:r_,HlsSkip:Fd,HlsUrlParameters:Ud,KeySystemFormats:lf,KeySystems:sf,Level:Vd,LevelDetails:Xh,LevelKey:pf,LoadStats:Pu,M3U8Parser:Ef,MetadataSchema:Gp,NetworkErrorAction:hh,Part:Uu,PlaylistLevelType:uu,SubtitleStreamController:Mv,SubtitleTrackController:pv,TimelineController:Sy,XhrLoader:Ny,default:r_,fetchSupported:Ly,getMediaSource:wu,isMSESupported:Xy,isSupported:Qy,requestMediaKeySystemAccess:hf},Symbol.toStringTag,{value:"Module"}));var o_={exports:{}};/*! For license information please see dash.all.min.js.LICENSE.txt */!function(e){self,e.exports=function(){var e={4593:function(e,t){var n,i,r,o,l,c=function(e){for(var t=[],n=0;n<e.length;++n){var i=e.charCodeAt(n);i<128?t.push(i):i<2048?(t.push(192|i>>6),t.push(128|63&i)):i<65536?(t.push(224|i>>12),t.push(128|63&i>>6),t.push(128|63&i)):(t.push(240|i>>18),t.push(128|63&i>>12),t.push(128|63&i>>6),t.push(128|63&i))}return t},u=function(e){for(var t=[],n=0;n<e.length;){var i=e[n++];i<128||(i<224?(i=(31&i)<<6,i|=63&e[n++]):i<240?(i=(15&i)<<12,i|=(63&e[n++])<<6,i|=63&e[n++]):(i=(7&i)<<18,i|=(63&e[n++])<<12,i|=(63&e[n++])<<6,i|=63&e[n++])),t.push(String.fromCharCode(i))}return t.join("")},d={};n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=function(e){for(var t=0,i=[],r=0|e.length/3;0<r--;){var a=(e[t]<<16)+(e[t+1]<<8)+e[t+2];t+=3,i.push(n.charAt(63&a>>18)),i.push(n.charAt(63&a>>12)),i.push(n.charAt(63&a>>6)),i.push(n.charAt(63&a))}return e.length-t==2?(a=(e[t]<<16)+(e[t+1]<<8),i.push(n.charAt(63&a>>18)),i.push(n.charAt(63&a>>12)),i.push(n.charAt(63&a>>6)),i.push("=")):e.length-t==1&&(a=e[t]<<16,i.push(n.charAt(63&a>>18)),i.push(n.charAt(63&a>>12)),i.push("==")),i.join("")},r=function(){for(var e=[],t=0;t<n.length;++t)e[n.charCodeAt(t)]=t;return e[61]=0,e}(),o=function(e){for(var t=0,n=[],i=0|e.length/4;0<i--;){var a=(r[e.charCodeAt(t)]<<18)+(r[e.charCodeAt(t+1)]<<12)+(r[e.charCodeAt(t+2)]<<6)+r[e.charCodeAt(t+3)];n.push(255&a>>16),n.push(255&a>>8),n.push(255&a),t+=4}return n&&("="==e.charAt(t-2)?(n.pop(),n.pop()):"="==e.charAt(t-1)&&n.pop()),n},l={encode:function(e){for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t},decode:function(e){for(var t=0;t<s.length;++t)a[t]=String.fromCharCode(a[t]);return a.join("")}},d.decodeArray=function(e){var t=o(e);return new Uint8Array(t)},d.encodeASCII=function(e){var t=l.encode(e);return i(t)},d.decodeASCII=function(e){var t=o(e);return l.decode(t)},d.encode=function(e){var t=c(e);return i(t)},d.decode=function(e){var t=o(e);return u(t)},t.decode=d.decode,t.decodeArray=d.decodeArray,t.encode=d.encode,t.encodeASCII=d.encodeASCII},452:function(e,t){!function(e){var t={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},n=function(e){var n=e;return t.hasOwnProperty(e)&&(n=t[e]),String.fromCharCode(n)},i=15,r=32,a={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},o={17:2,18:4,21:6,22:8,23:10,19:13,20:15},s={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},l={25:2,26:4,29:6,30:8,31:10,27:13,28:15},c=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],u={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var n=this.verboseFilter[e];this.verboseLevel>=n&&console.log(this.time+" ["+e+"] "+t)}},d=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].toString(16));return t},h=function(e,t,n,i,r){this.foreground=e||"white",this.underline=t||!1,this.italics=n||!1,this.background=i||"black",this.flash=r||!1};h.prototype={reset:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},setStyles:function(e){for(var t=["foreground","underline","italics","background","flash"],n=0;n<t.length;n++){var i=t[n];e.hasOwnProperty(i)&&(this[i]=e[i])}},isDefault:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},equals:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},copy:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},toString:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}};var f=function(e,t,n,i,r,a){this.uchar=e||" ",this.penState=new h(t,n,i,r,a)};f.prototype={reset:function(){this.uchar=" ",this.penState.reset()},setChar:function(e,t){this.uchar=e,this.penState.copy(t)},setPenState:function(e){this.penState.copy(e)},equals:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},copy:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},isEmpty:function(){return" "===this.uchar&&this.penState.isDefault()}};var p=function(){this.chars=[];for(var e=0;e<r;e++)this.chars.push(new f);this.pos=0,this.currPenState=new h};p.prototype={equals:function(e){for(var t=!0,n=0;n<r;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t},copy:function(e){for(var t=0;t<r;t++)this.chars[t].copy(e.chars[t])},isEmpty:function(){for(var e=!0,t=0;t<r;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},setCursor:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(u.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>r&&(u.log("ERROR","Too large cursor position "+this.pos),this.pos=r)},moveCursor:function(e){var t=this.pos+e;if(e>1)for(var n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)},backSpace:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},insertChar:function(e){e>=144&&this.backSpace();var t=n(e);this.pos>=r?u.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},clearFromPos:function(e){var t;for(t=e;t<r;t++)this.chars[t].reset()},clear:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},clearToEndOfRow:function(){this.clearFromPos(this.pos)},getTextString:function(){for(var e=[],t=!0,n=0;n<r;n++){var i=this.chars[n].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")},setPenStyles:function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}};var g=function(){this.rows=[];for(var e=0;e<i;e++)this.rows.push(new p);this.currRow=14,this.nrRollUpRows=null,this.reset()};g.prototype={reset:function(){for(var e=0;e<i;e++)this.rows[e].clear();this.currRow=14},equals:function(e){for(var t=!0,n=0;n<i;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t},copy:function(e){for(var t=0;t<i;t++)this.rows[t].copy(e.rows[t])},isEmpty:function(){for(var e=!0,t=0;t<i;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},backSpace:function(){this.rows[this.currRow].backSpace()},clearToEndOfRow:function(){this.rows[this.currRow].clearToEndOfRow()},insertChar:function(e){this.rows[this.currRow].insertChar(e)},setPen:function(e){this.rows[this.currRow].setPenStyles(e)},moveCursor:function(e){this.rows[this.currRow].moveCursor(e)},setCursor:function(e){u.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)},setPAC:function(e){u.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.currRow=t;var n=this.rows[this.currRow];if(null!==e.indent){var i=e.indent,r=Math.max(i-1,0);n.setCursor(e.indent),e.color=n.chars[r].penState.foreground}var a={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(a)},setBkgData:function(e){u.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},setRollUpRows:function(e){this.nrRollUpRows=e},rollUp:function(){if(null!==this.nrRollUpRows){u.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),u.log("INFO","Rolling up")}else u.log("DEBUG","roll_up but nrRollUpRows not set yet")},getDisplayText:function(e){e=e||!1;for(var t=[],n="",r=-1,a=0;a<i;a++){var o=this.rows[a].getTextString();o&&(r=a+1,e?t.push("Row "+r+': "'+o+'"'):t.push(o.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n},getTextAndFormat:function(){return this.rows}};var m=function(e,t){this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new g,this.nonDisplayedMemory=new g,this.lastOutputScreen=new g,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null};m.prototype={modes:["MODE_ROLL-UP","MODE_POP-ON","MODE_PAINT-ON","MODE_TEXT"],reset:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},getHandler:function(){return this.outputFilter},setHandler:function(e){this.outputFilter=e},setPAC:function(e){this.writeScreen.setPAC(e)},setBkgData:function(e){this.writeScreen.setBkgData(e)},setMode:function(e){e!==this.mode&&(this.mode=e,u.log("INFO","MODE="+e),"MODE_POP-ON"==this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},insertChars:function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";u.log("INFO",n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(u.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},cc_RCL:function(){u.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},cc_BS:function(){u.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},cc_AOF:function(){},cc_AON:function(){},cc_DER:function(){u.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},cc_RU:function(e){u.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},cc_FON:function(){u.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},cc_RDC:function(){u.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},cc_TR:function(){u.log("INFO","TR"),this.setMode("MODE_TEXT")},cc_RTD:function(){u.log("INFO","RTD"),this.setMode("MODE_TEXT")},cc_EDM:function(){u.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()},cc_CR:function(){u.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()},cc_ENM:function(){u.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},cc_EOC:function(){if(u.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,u.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()},cc_TO:function(e){u.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},cc_MIDROW:function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var n=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][n]}u.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},outputDataUpdate:function(){var e=u.time;null!==e&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(e,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},cueSplitAtTime:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}};var v=function(e,t,n){this.field=e||1,this.outputs=[t,n],this.channels=[new m(1,t),new m(2,n)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}};v.prototype={getHandler:function(e){return this.channels[e].getHandler()},setHandler:function(e,t){this.channels[e].setHandler(t)},addData:function(e,t){var n,i,r,a=!1;this.lastTime=e,u.setTime(e);for(var o=0;o<t.length;o+=2)i=127&t[o],r=127&t[o+1],i>=16&&i<=31&&i===this.lastCmdA&&r===this.lastCmdB?(this.lastCmdA=null,this.lastCmdB=null,u.log("DEBUG","Repeated command ("+d([i,r])+") is dropped")):0!==i||0!==r?(u.log("DATA","["+d([t[o],t[o+1]])+"] -> ("+d([i,r])+")"),(n=this.parseCmd(i,r))||(n=this.parseMidrow(i,r)),n||(n=this.parsePAC(i,r)),n||(n=this.parseBackgroundAttributes(i,r)),n||(a=this.parseChars(i,r))&&(this.currChNr&&this.currChNr>=0?this.channels[this.currChNr-1].insertChars(a):u.log("WARNING","No channel found yet. TEXT-MODE?")),n?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,u.log("WARNING","Couldn't parse cleaned data "+d([i,r])+" orig: "+d([t[o],t[o+1]])))):this.dataCounters.padding+=2},parseCmd:function(e,t){var n;if(!((20===e||21===e||28===e||29===e)&&32<=t&&t<=47||(23===e||31===e)&&33<=t&&t<=35))return!1;n=20===e||21===e||23===e?1:2;var i=this.channels[n-1];return 20===e||21===e||28===e||29===e?32===t?i.cc_RCL():33===t?i.cc_BS():34===t?i.cc_AOF():35===t?i.cc_AON():36===t?i.cc_DER():37===t?i.cc_RU(2):38===t?i.cc_RU(3):39===t?i.cc_RU(4):40===t?i.cc_FON():41===t?i.cc_RDC():42===t?i.cc_TR():43===t?i.cc_RTD():44===t?i.cc_EDM():45===t?i.cc_CR():46===t?i.cc_ENM():47===t&&i.cc_EOC():i.cc_TO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0},parseMidrow:function(e,t){var n=null;if((17===e||25===e)&&32<=t&&t<=47){if((n=17===e?1:2)!==this.currChNr)return u.log("ERROR","Mismatch channel in midrow parsing"),!1;var i=this.channels[n-1];return i.insertChars([32]),i.cc_MIDROW(t),u.log("DEBUG","MIDROW ("+d([e,t])+")"),this.lastCmdA=e,this.lastCmdB=t,!0}return!1},parsePAC:function(e,t){var n,i;if(!((17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127||(16===e||24===e)&&64<=t&&t<=95))return!1;n=e<=23?1:2,i=64<=t&&t<=95?1===n?a[e]:s[e]:1===n?o[e]:l[e];var r=this.interpretPAC(i,t);return this.channels[n-1].setPAC(r),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0},interpretPAC:function(e,t){var n,i={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,i.underline=!(1&~n),n<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((n-16)/2),i},parseChars:function(e,t){var i,r=null,a=null,o=null;if(e>=25?(r=2,o=e-8):(r=1,o=e),17<=o&&o<=19?(i=17===o?t+80:18===o?t+112:t+144,u.log("INFO","Special char '"+n(i)+"' in channel "+r),a=[i],this.lastCmdA=e,this.lastCmdB=t):32<=e&&e<=127&&(a=0===t?[e]:[e,t],this.lastCmdA=null,this.lastCmdB=null),a){var s=d(a);u.log("DEBUG","Char codes =  "+s.join(","))}return a},parseBackgroundAttributes:function(e,t){var n,i,r;return((16===e||24===e)&&32<=t&&t<=47||(23===e||31===e)&&45<=t&&t<=47)&&(n={},16===e||24===e?(i=Math.floor((t-32)/2),n.background=c[i],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0)),r=e<24?1:2,this.channels[r-1].setBkgData(n),this.lastCmdA=e,this.lastCmdB=t,!0)},reset:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},cueSplitAtTime:function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)}},e.logger=u,e.PenState=h,e.CaptionScreen=g,e.Cea608Parser=v,e.findCea608Nalus=function(e,t,n){for(var i=0,r=t,a=[],o=function(e,t,n,i){if(4!==e||t<8)return null;var r=n.getUint8(i),a=n.getUint16(i+1),o=n.getUint32(i+3),s=n.getUint8(i+7);return 181==r&&49==a&&1195456820==o&&3==s};r<t+n;){if(i=e.getUint32(r),6==(31&e.getUint8(r+4)))for(var s=r+5,l=-1;s<r+4+i-1;){l=0;for(var c=255;255===c;)l+=c=e.getUint8(s),s++;var u=0;for(c=255;255===c;)u+=c=e.getUint8(s),s++;o(l,u,e,s)&&a.push([s,u]),s+=u}r+=i+4}return a},e.extractCea608DataFromRange=function(e,t){var n=t[0],i=[[],[]];n+=8;var r=31&e.getUint8(n);n+=2;for(var a=0;a<r;a++){var o=e.getUint8(n),s=4&o,l=3&o;n++;var c=e.getUint8(n);n++;var u=e.getUint8(n);n++,s&&(127&c)+(127&u)!=0&&(0===l?(i[0].push(c),i[0].push(u)):1===l&&(i[1].push(c),i[1].push(u)))}return i}}(t)},8416:function(e,t,n){var i=n(1139),r=n(5448),a=n(6398),o=n(2032),s=(n(5530),typeof window<"u"&&window||n.g),l=s.dashjs;l||(l=s.dashjs={}),l.MediaPlayer=i.Z,l.FactoryMaker=r.Z,l.Debug=a.Z,l.Version=(0,o.e)()},6398:function(e,t,n){var i=n(5595),r=n(8512),a=n(5448),o=1,s=2,l=3,c=4,u=5;function d(e){e=e||{};var t,n,a,d,h=this.context,f=(0,i.Z)(h).getInstance(),p=e.settings,g=[];function m(e){return e&&e.bind?e.bind(window.console):window.console.log.bind(window.console)}function v(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];T.apply(void 0,[o,this].concat(t))}function y(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];T.apply(void 0,[s,this].concat(t))}function _(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];T.apply(void 0,[l,this].concat(t))}function E(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];T.apply(void 0,[c,this].concat(t))}function b(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];T.apply(void 0,[u,this].concat(t))}function T(e,t){var i="",o=null;n&&(o=(new Date).getTime(),i+="["+(o-d)+"]"),a&&t&&t.getClassName&&(i+="["+t.getClassName()+"]",t.getType&&(i+="["+t.getType()+"]")),i.length>0&&(i+=" ");for(var s=arguments.length,l=new Array(s>2?s-2:0),c=2;c<s;c++)l[c-2]=arguments[c];Array.apply(null,l).forEach(function(e){i+=e+" "}),g[e]&&p&&p.get().debug.logLevel>=e&&g[e](i),p&&p.get().debug.dispatchEvent&&f.trigger(r.Z.LOG,{message:i,level:e})}return t={getLogger:function(e){return{fatal:v.bind(e),error:y.bind(e),warn:_.bind(e),info:E.bind(e),debug:b.bind(e)}},setLogTimestampVisible:function(e){n=e},setCalleeNameVisible:function(e){a=e}},n=!0,a=!0,d=(new Date).getTime(),typeof window<"u"&&window.console&&(g[o]=m(window.console.error),g[s]=m(window.console.error),g[l]=m(window.console.warn),g[c]=m(window.console.info),g[u]=m(window.console.debug)),t}d.__dashjs_factory_name="Debug";var h=a.Z.getSingletonFactory(d);h.LOG_LEVEL_NONE=0,h.LOG_LEVEL_FATAL=o,h.LOG_LEVEL_ERROR=s,h.LOG_LEVEL_WARNING=l,h.LOG_LEVEL_INFO=c,h.LOG_LEVEL_DEBUG=u,a.Z.updateSingletonFactory(d.__dashjs_factory_name,h),t.Z=h},5595:function(e,t,n){var i=n(5448),r=n(8825);function a(){var e={};function t(t,n,i){var r=-1;return e[t]&&e[t].some(function(e,t){if(e&&e.callback===n&&(!i||i===e.scope))return r=t,!0}),r}var n={on:function(n,i,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!n)throw new Error("event type cannot be null or undefined");if(!i||"function"!=typeof i)throw new Error("listener must be a function: "+i);var o=a.priority||0;if(!(t(n,i,r)>=0)){e[n]=e[n]||[];var s={callback:i,scope:r,priority:o};r&&r.getStreamId&&(s.streamId=r.getStreamId()),r&&r.getType&&(s.mediaType=r.getType()),a&&a.mode&&(s.mode=a.mode),e[n].some(function(t,i){if(t&&o>t.priority)return e[n].splice(i,0,s),!0})||e[n].push(s)}},off:function(n,i,r){if(n&&i&&e[n]){var a=t(n,i,r);a<0||(e[n][a]=null)}},trigger:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t&&e[t]){if((n=n||{}).hasOwnProperty("type"))throw new Error("'type' is a reserved word for event dispatching");n.type=t,i.streamId&&(n.streamId=i.streamId),i.mediaType&&(n.mediaType=i.mediaType),e[t].filter(function(e){return!(!e||i.streamId&&e.streamId&&e.streamId!==i.streamId||i.mediaType&&e.mediaType&&e.mediaType!==i.mediaType||i.mode&&e.mode&&e.mode!==i.mode||!e.mode&&i.mode&&i.mode===r.Z.EVENT_MODE_ON_RECEIVE)}).forEach(function(e){return e&&e.callback.call(e.scope,n)})}},reset:function(){e={}}};return n}a.__dashjs_factory_name="EventBus";var o=i.Z.getSingletonFactory(a);o.EVENT_PRIORITY_LOW=0,o.EVENT_PRIORITY_HIGH=5e3,i.Z.updateSingletonFactory(a.__dashjs_factory_name,o),t.Z=o},5448:function(e,t){var n=function(){var e,t=[],n={},i={};function r(e,n){for(var i in t){var r=t[i];if(r.context===e&&r.name===n)return r.instance}return null}function a(e,t){return t[e]}function o(e,t,n){e in n&&(n[e]=t)}function s(t,n,i){var r,a=t.__dashjs_factory_name,o=n[a];if(o){var s=o.instance;if(!o.override)return s.apply({context:n,factory:e},i);for(var l in r=t.apply({context:n},i),s=s.apply({context:n,factory:e,parent:r},i))r.hasOwnProperty(l)&&(r[l]=s[l])}else r=t.apply({context:n},i);return r.getClassName=function(){return a},r}return e={extend:function(e,t,n,i){!i[e]&&t&&(i[e]={instance:t,override:n})},getSingletonInstance:r,setSingletonInstance:function(e,n,i){for(var r in t){var a=t[r];if(a.context===e&&a.name===n)return void(t[r].instance=i)}t.push({name:n,context:e,instance:i})},deleteSingletonInstances:function(e){t=t.filter(function(t){return t.context!==e})},getSingletonFactory:function(e){var i=a(e.__dashjs_factory_name,n);return i||(i=function(n){var i;return void 0===n&&(n={}),{getInstance:function(){return i||(i=r(n,e.__dashjs_factory_name)),i||(i=s(e,n,arguments),t.push({name:e.__dashjs_factory_name,context:n,instance:i})),i}}},n[e.__dashjs_factory_name]=i),i},getSingletonFactoryByName:function(e){return a(e,n)},updateSingletonFactory:function(e,t){o(e,t,n)},getClassFactory:function(e){var t=a(e.__dashjs_factory_name,i);return t||(t=function(t){return void 0===t&&(t={}),{create:function(){return s(e,t,arguments)}}},i[e.__dashjs_factory_name]=t),t},getClassFactoryByName:function(e){return a(e,i)},updateClassFactory:function(e,t){o(e,t,i)}},e}();t.Z=n},1264:function(e,t,n){var i=n(5448),r=n(703),a=n(6398),o=n(3393),s=n(7855),l=n(5595),c=n(8512);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(){var e,t,n=this.context,i=(0,l.Z)(n).getInstance(),h={"streaming.delay.liveDelay":c.Z.SETTING_UPDATED_LIVE_DELAY,"streaming.delay.liveDelayFragmentCount":c.Z.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,"streaming.liveCatchup.enabled":c.Z.SETTING_UPDATED_CATCHUP_ENABLED,"streaming.liveCatchup.playbackRate.min":c.Z.SETTING_UPDATED_PLAYBACK_RATE_MIN,"streaming.liveCatchup.playbackRate.max":c.Z.SETTING_UPDATED_PLAYBACK_RATE_MAX},f={debug:{logLevel:a.Z.LOG_LEVEL_WARNING,dispatchEvent:!1},streaming:{abandonLoadTimeout:1e4,wallclockTimeUpdateInterval:100,manifestUpdateRetryInterval:100,liveUpdateTimeThresholdInMilliseconds:0,cacheInitSegments:!1,applyServiceDescription:!0,applyProducerReferenceTime:!0,applyContentSteering:!0,eventControllerRefreshDelay:100,enableManifestDurationMismatchFix:!0,parseInbandPrft:!1,enableManifestTimescaleMismatchFix:!1,capabilities:{filterUnsupportedEssentialProperties:!0,useMediaCapabilitiesApi:!1},timeShiftBuffer:{calcFromSegmentTimeline:!1,fallbackToSegmentTimeline:!0},metrics:{maxListDepth:100},delay:{liveDelayFragmentCount:NaN,liveDelay:NaN,useSuggestedPresentationDelay:!0},protection:{keepProtectionMediaKeys:!1,ignoreEmeEncryptedEvent:!1,detectPlayreadyMessageFormat:!0},buffer:{enableSeekDecorrelationFix:!1,fastSwitchEnabled:!0,flushBufferAtTrackSwitch:!1,reuseExistingSourceBuffers:!0,bufferPruningInterval:10,bufferToKeep:20,bufferTimeAtTopQuality:30,bufferTimeAtTopQualityLongForm:60,initialBufferLevel:NaN,stableBufferTime:12,longFormContentDurationThreshold:600,stallThreshold:.3,useAppendWindow:!0,setStallState:!0,avoidCurrentTimeRangePruning:!1,useChangeTypeForTrackSwitch:!0,mediaSourceDurationInfinity:!0,resetSourceBuffersForTrackSwitch:!1},gaps:{jumpGaps:!0,jumpLargeGaps:!0,smallGapLimit:1.5,threshold:.3,enableSeekFix:!0,enableStallFix:!1,stallSeek:.1},utcSynchronization:{enabled:!0,useManifestDateHeaderTimeSource:!0,backgroundAttempts:2,timeBetweenSyncAttempts:30,maximumTimeBetweenSyncAttempts:600,minimumTimeBetweenSyncAttempts:2,timeBetweenSyncAttemptsAdjustmentFactor:2,maximumAllowedDrift:100,enableBackgroundSyncAfterSegmentDownloadError:!0,defaultTimingSource:{scheme:"urn:mpeg:dash:utc:http-xsdate:2014",value:"https://time.akamai.com/?iso&ms"}},scheduling:{defaultTimeout:500,lowLatencyTimeout:0,scheduleWhilePaused:!0},text:{defaultEnabled:!0,dispatchForManualRendering:!1,extendSegmentedCues:!0,imsc:{displayForcedOnlyMode:!1,enableRollUp:!0},webvtt:{customRenderingEnabled:!1}},liveCatchup:{maxDrift:NaN,playbackRate:{min:NaN,max:NaN},playbackBufferMin:.5,enabled:null,mode:o.Z.LIVE_CATCHUP_MODE_DEFAULT},lastBitrateCachingInfo:{enabled:!0,ttl:36e4},lastMediaSettingsCachingInfo:{enabled:!0,ttl:36e4},saveLastMediaSettingsForCurrentStreamingSession:!0,cacheLoadThresholds:{video:50,audio:5},trackSwitchMode:{audio:o.Z.TRACK_SWITCH_MODE_ALWAYS_REPLACE,video:o.Z.TRACK_SWITCH_MODE_NEVER_REPLACE},selectionModeForInitialTrack:o.Z.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY,fragmentRequestTimeout:2e4,fragmentRequestProgressTimeout:-1,manifestRequestTimeout:1e4,retryIntervals:(e={},d(e,s.w.MPD_TYPE,500),d(e,s.w.XLINK_EXPANSION_TYPE,500),d(e,s.w.MEDIA_SEGMENT_TYPE,1e3),d(e,s.w.INIT_SEGMENT_TYPE,1e3),d(e,s.w.BITSTREAM_SWITCHING_SEGMENT_TYPE,1e3),d(e,s.w.INDEX_SEGMENT_TYPE,1e3),d(e,s.w.MSS_FRAGMENT_INFO_SEGMENT_TYPE,1e3),d(e,s.w.LICENSE,1e3),d(e,s.w.OTHER_TYPE,1e3),d(e,"lowLatencyReductionFactor",10),e),retryAttempts:(t={},d(t,s.w.MPD_TYPE,3),d(t,s.w.XLINK_EXPANSION_TYPE,1),d(t,s.w.MEDIA_SEGMENT_TYPE,3),d(t,s.w.INIT_SEGMENT_TYPE,3),d(t,s.w.BITSTREAM_SWITCHING_SEGMENT_TYPE,3),d(t,s.w.INDEX_SEGMENT_TYPE,3),d(t,s.w.MSS_FRAGMENT_INFO_SEGMENT_TYPE,3),d(t,s.w.LICENSE,3),d(t,s.w.OTHER_TYPE,3),d(t,"lowLatencyMultiplyFactor",5),t),abr:{movingAverageMethod:o.Z.MOVING_AVERAGE_SLIDING_WINDOW,ABRStrategy:o.Z.ABR_STRATEGY_DYNAMIC,additionalAbrRules:{insufficientBufferRule:!0,switchHistoryRule:!0,droppedFramesRule:!0,abandonRequestsRule:!0},abrRulesParameters:{abandonRequestsRule:{graceTimeThreshold:500,abandonMultiplier:1.8,minLengthToAverage:5}},bandwidthSafetyFactor:.9,useDefaultABRRules:!0,useDeadTimeLatency:!0,limitBitrateByPortal:!1,usePixelRatioInLimitBitrateByPortal:!1,maxBitrate:{audio:-1,video:-1},minBitrate:{audio:-1,video:-1},maxRepresentationRatio:{audio:1,video:1},initialBitrate:{audio:-1,video:-1},initialRepresentationRatio:{audio:-1,video:-1},autoSwitchBitrate:{audio:!0,video:!0},fetchThroughputCalculationMode:o.Z.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING},cmcd:{enabled:!1,sid:null,cid:null,rtp:null,rtpSafetyFactor:5,mode:o.Z.CMCD_MODE_QUERY,enabledKeys:["br","d","ot","tb","bl","dl","mtp","nor","nrr","su","bs","rtp","cid","pr","sf","sid","st","v"]},cmsd:{enabled:!1,abr:{applyMb:!1,etpWeightRatio:0}}},errors:{recoverAttempts:{mediaErrorDecode:5}}},p=r.Z.clone(f);function g(e,t,n){for(var a in e)e.hasOwnProperty(a)&&(t.hasOwnProperty(a)?"object"!==u(e[a])||e[a]instanceof Array||null===e[a]?(t[a]=r.Z.clone(e[a]),h[n+a]&&i.trigger(h[n+a])):g(e[a],t[a],n.slice()+a+"."):console.error("Settings parameter "+n+a+" is not supported"))}return{get:function(){return p},update:function(e){"object"===u(e)&&g(e,p,"")},reset:function(){p=r.Z.clone(f)}}}h.__dashjs_factory_name="Settings";var f=i.Z.getSingletonFactory(h);t.Z=f},703:function(e,t,n){var i=n(3875),r=n.n(i),a=n(1067);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return t=[{key:"mixin",value:function(t,n,i){var r,a={};if(t)for(var s in n)n.hasOwnProperty(s)&&(r=n[s],s in t&&(t[s]===r||s in a&&a[s]===r)||("object"===o(t[s])&&null!==t[s]?t[s]=e.mixin(t[s],r,i):t[s]=i(r)));return t}},{key:"clone",value:function(t){if(!t||"object"!==o(t))return t;var n;if(t instanceof Array){n=[];for(var i=0,r=t.length;i<r;++i)i in t&&n.push(e.clone(t[i]))}else n={};return e.mixin(n,t,e.clone)}},{key:"addAditionalQueryParameterToUrl",value:function(e,t){try{if(!t||0===t.length)return e;var n=new URL(e);return t.forEach(function(e){e.key&&e.value&&n.searchParams.set(e.key,e.value)}),n.href}catch(t){return e}}},{key:"parseHttpHeaders",value:function(e){var t={};if(!e)return t;for(var n=e.trim().split("\r\n"),i=0,r=n.length;i<r;i++){var a=n[i],o=a.indexOf(": ");o>0&&(t[a.substring(0,o)]=a.substring(o+2))}return t}},{key:"generateUuid",value:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)})}},{key:"generateHashCode",value:function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}},{key:"getRelativeUrl",value:function(e,t){try{var n=new URL(e),i=new URL(t);if(n.protocol=i.protocol,n.origin!==i.origin)return t;var a=r().relative(n.pathname.substr(0,n.pathname.lastIndexOf("/")),i.pathname.substr(0,i.pathname.lastIndexOf("/"))),o=0===a.length?1:0;return a+=i.pathname.substr(i.pathname.lastIndexOf("/")+o,i.pathname.length-1),i.pathname.length<a.length?i.pathname:a}catch(e){return t}}},{key:"parseUserAgent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{var t=null===e&&typeof navigator<"u"?navigator.userAgent.toLowerCase():"";return(0,a.UAParser)(t)}catch(e){return{}}}},{key:"stringHasProtocol",value:function(e){return/(http(s?)):\/\//i.test(e)}}],t&&s(e,t),e}();t.Z=l},2032:function(e,t,n){function i(){return"4.7.4"}n.d(t,{e:function(){return i}})},2230:function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return(t=[{key:"extend",value:function(e,t){if(e){var n=!!t&&t.override,i=!!t&&t.publicOnly;for(var r in e)!e.hasOwnProperty(r)||this[r]&&!n||i&&-1===e[r].indexOf("public_")||(this[r]=e[r])}}}])&&n(e.prototype,t),e}();t.Z=i},4351:function(e,t,n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var s=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}(s,e);var t,n,i=(t=s,n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=o(t);if(n){var r=o(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return a(this,e)});function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=i.call(this)).ATTEMPT_BACKGROUND_SYNC="attemptBackgroundSync",e.BUFFERING_COMPLETED="bufferingCompleted",e.BUFFER_CLEARED="bufferCleared",e.BYTES_APPENDED_END_FRAGMENT="bytesAppendedEndFragment",e.BUFFER_REPLACEMENT_STARTED="bufferReplacementStarted",e.CHECK_FOR_EXISTENCE_COMPLETED="checkForExistenceCompleted",e.CMSD_STATIC_HEADER="cmsdStaticHeader",e.CURRENT_TRACK_CHANGED="currentTrackChanged",e.DATA_UPDATE_COMPLETED="dataUpdateCompleted",e.INBAND_EVENTS="inbandEvents",e.INITIAL_STREAM_SWITCH="initialStreamSwitch",e.INIT_FRAGMENT_LOADED="initFragmentLoaded",e.INIT_FRAGMENT_NEEDED="initFragmentNeeded",e.INTERNAL_MANIFEST_LOADED="internalManifestLoaded",e.ORIGINAL_MANIFEST_LOADED="originalManifestLoaded",e.LOADING_COMPLETED="loadingCompleted",e.LOADING_PROGRESS="loadingProgress",e.LOADING_DATA_PROGRESS="loadingDataProgress",e.LOADING_ABANDONED="loadingAborted",e.MANIFEST_UPDATED="manifestUpdated",e.MEDIA_FRAGMENT_LOADED="mediaFragmentLoaded",e.MEDIA_FRAGMENT_NEEDED="mediaFragmentNeeded",e.QUOTA_EXCEEDED="quotaExceeded",e.SEGMENT_LOCATION_BLACKLIST_ADD="segmentLocationBlacklistAdd",e.SEGMENT_LOCATION_BLACKLIST_CHANGED="segmentLocationBlacklistChanged",e.SERVICE_LOCATION_BASE_URL_BLACKLIST_ADD="serviceLocationBlacklistAdd",e.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED="serviceLocationBlacklistChanged",e.SERVICE_LOCATION_LOCATION_BLACKLIST_ADD="serviceLocationLocationBlacklistAdd",e.SERVICE_LOCATION_LOCATION_BLACKLIST_CHANGED="serviceLocationLocationBlacklistChanged",e.SET_FRAGMENTED_TEXT_AFTER_DISABLED="setFragmentedTextAfterDisabled",e.SET_NON_FRAGMENTED_TEXT="setNonFragmentedText",e.SOURCE_BUFFER_ERROR="sourceBufferError",e.STREAMS_COMPOSED="streamsComposed",e.STREAM_BUFFERING_COMPLETED="streamBufferingCompleted",e.STREAM_REQUESTING_COMPLETED="streamRequestingCompleted",e.TEXT_TRACKS_QUEUE_INITIALIZED="textTracksQueueInitialized",e.TIME_SYNCHRONIZATION_COMPLETED="timeSynchronizationComplete",e.UPDATE_TIME_SYNC_OFFSET="updateTimeSyncOffset",e.URL_RESOLUTION_FAILED="urlResolutionFailed",e.VIDEO_CHUNK_RECEIVED="videoChunkReceived",e.WALLCLOCK_TIME_UPDATED="wallclockTimeUpdated",e.XLINK_ELEMENT_LOADED="xlinkElementLoaded",e.XLINK_READY="xlinkReady",e.SEEK_TARGET="seekTarget",e.SETTING_UPDATED_LIVE_DELAY="settingUpdatedLiveDelay",e.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT="settingUpdatedLiveDelayFragmentCount",e.SETTING_UPDATED_CATCHUP_ENABLED="settingUpdatedCatchupEnabled",e.SETTING_UPDATED_PLAYBACK_RATE_MIN="settingUpdatedPlaybackRateMin",e.SETTING_UPDATED_PLAYBACK_RATE_MAX="settingUpdatedPlaybackRateMax",e}return s}(n(8342).Z);t.Z=s},8512:function(e,t,n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(l,e);var t,n,i=(t=l,n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=s(t);if(n){var r=s(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return o(this,e)});function l(){return r(this,l),i.apply(this,arguments)}return l}(n(4351).Z),c=new l;t.Z=c},8342:function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return(t=[{key:"extend",value:function(e,t){if(e){var n=!!t&&t.override,i=!!t&&t.publicOnly;for(var r in e)!e.hasOwnProperty(r)||this[r]&&!n||i&&-1===e[r].indexOf("public_")||(this[r]=e[r])}}}])&&n(e.prototype,t),e}();t.Z=i},9326:function(e,t,n){var i=n(3186),r=n(7855),a=n(5448),o=n(8825),s=n(7387),l=n(1553);function c(e){var t,n,a,c,u,d=(e=e||{}).eventBus,h=e.debug,f=e.urlUtils,p=e.type,g=e.streamInfo,m=e.segmentsController,v=e.timelineConverter,y=e.baseURLController;function _(){return p}function E(){a=null}function b(e,t,n){var i,r,a=y.resolve(n.path),o={};return a&&t!==a.url&&f.isRelative(t)?(i=a.url,r=a.serviceLocation,o=a.queryParams,t&&(i=f.resolve(t,i))):i=t,!f.isRelative(i)&&(e.url=i,e.serviceLocation=r,e.queryParams=o,!0)}function T(e,t){if(null==t)return null;var n=new i.Z,a=t.representation,o=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].bandwidth,l=t.media;return l=(0,s.vi)(l,"Number",t.replacementNumber),l=(0,s.vi)(l,"Time",t.replacementTime),l=(0,s.vi)(l,"Bandwidth",o),l=(0,s.Aj)(l,a.id),l=(0,s.eR)(l),n.mediaType=_(),n.type=r.w.MEDIA_SEGMENT_TYPE,n.range=t.mediaRange,n.startTime=t.presentationStartTime,n.mediaStartTime=t.mediaStartTime,n.duration=t.duration,n.timescale=a.timescale,n.availabilityStartTime=t.availabilityStartTime,n.availabilityEndTime=t.availabilityEndTime,n.availabilityTimeComplete=a.availabilityTimeComplete,n.wallStartTime=t.wallStartTime,n.quality=a.index,n.index=t.index,n.mediaInfo=e,n.adaptationIndex=a.adaptation.index,n.representationId=a.id,b(n,l,a)?n:void 0}function S(e,t,i){var r=null;if(!t||!t.segmentInfoType)return r;var o=m.getSegmentByTime(t,i);return o&&(a=o,n.debug("Index for time "+i+" is "+o.index),r=T(e,o)),r}function w(e,t,i){var r=null,o=m.getSegmentByIndex(t,i,a?a.mediaStartTime:-1);if(o)r=T(e,o),a=o;else{if(c&&!u)return n.debug(_()+" No segment found at index: "+i+". Wait for next loop"),null;u=!0}return r}function A(){n.debug("Dynamic stream complete"),u=!0}return t={getCurrentIndex:function(){return a?a.index:-1},getInitRequest:function(e,t){return t?function(e,t,n){var a=new i.Z,o=t.adaptation.period,l=o.start;if(a.mediaType=n,a.type=r.w.INIT_SEGMENT_TYPE,a.range=t.range,a.availabilityStartTime=v.calcAvailabilityStartTimeFromPresentationTime(l,t,c),a.availabilityEndTime=v.calcAvailabilityEndTimeFromPresentationTime(l+o.duration,t,c),a.quality=t.index,a.mediaInfo=e,a.representationId=t.id,b(a,t.initialization,t))return a.url=(0,s.vi)(a.url,"Bandwidth",t.bandwidth),a}(e,t,_()):null},getNextSegmentRequest:function(e,t){return t&&t.segmentInfoType?w(e,t,a?a.index+1:0):null},getNextSegmentRequestIdempotent:function(e,t){var n=a?a.index+1:0,i=m.getSegmentByIndex(t,n,a?a.mediaStartTime:-1);return i?T(e,i):null},getSegmentRequestForTime:S,getStreamId:function(){return g.id},getStreamInfo:function(){return g},getType:_,getValidTimeAheadOfTargetTime:function(e,t,n,i){try{if(isNaN(e)||!t||!n)return NaN;if(e<0&&(e=0),isNaN(i)&&(i=.5),S(t,n,e))return e;if(n.adaptation.period.start+n.adaptation.period.duration<e)return NaN;for(var r=isFinite(n.adaptation.period.duration)?n.adaptation.period.start+n.adaptation.period.duration:e+30,a=Math.min(e+i,r),o=NaN,s=null;a<=r;){var l=null;if(a<=r&&(l=S(t,n,a)),l){o=a,s=l;break}a+=i}if(s){var c=s.startTime+s.duration;return e>s.startTime&&c-e>i?e:!isNaN(s.startTime)&&e<s.startTime&&o>s.startTime?s.startTime+.001:Math.min(c-i,o)}return o}catch(e){return NaN}},initialize:function(e){c=e,u=!1,m.initialize(e)},isLastSegmentRequested:function(e,t){return!(!e||!a||!u&&(!isFinite(e.adaptation.period.duration)||a.presentationStartTime+a.duration>t||!(e.mediaFinishedInformation&&!isNaN(e.mediaFinishedInformation.numberOfSegments)&&!isNaN(a.index)&&a.index>=e.mediaFinishedInformation.numberOfSegments-1&&(!c||e.segmentInfoType===l.Z.SEGMENT_TEMPLATE||c&&e.segmentInfoType===l.Z.SEGMENT_LIST&&e.adaptation.period.nextPeriodId)||c&&e.adaptation.period.nextPeriodId&&e.segmentInfoType===l.Z.SEGMENT_TIMELINE&&e.mediaFinishedInformation&&!isNaN(e.mediaFinishedInformation.mediaTimeOfLastSignaledSegment)&&a&&!isNaN(a.mediaStartTime)&&!isNaN(a.duration)&&a.mediaStartTime+a.duration>=e.mediaFinishedInformation.mediaTimeOfLastSignaledSegment-.05)))},repeatSegmentRequest:function(e,t){return t&&t.segmentInfoType?w(e,t,a?a.index:0):null},reset:function(){E(),d.off(o.Z.DYNAMIC_TO_STATIC,A,t)}},n=h.getLogger(t),E(),d.on(o.Z.DYNAMIC_TO_STATIC,A,t),t}c.__dashjs_factory_name="DashHandler",t.Z=a.Z.getClassFactory(c)},1553:function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var i=new(function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.init()}var t;return(t=[{key:"init",value:function(){this.BASE_URL="BaseURL",this.SEGMENT_BASE="SegmentBase",this.SEGMENT_TEMPLATE="SegmentTemplate",this.SEGMENT_LIST="SegmentList",this.SEGMENT_URL="SegmentURL",this.SEGMENT_TIMELINE="SegmentTimeline",this.SEGMENT_PROFILES="segmentProfiles",this.ADAPTATION_SET="AdaptationSet",this.REPRESENTATION="Representation",this.REPRESENTATION_INDEX="RepresentationIndex",this.SUB_REPRESENTATION="SubRepresentation",this.INITIALIZATION="Initialization",this.INITIALIZATION_MINUS="initialization",this.MPD="MPD",this.PERIOD="Period",this.ASSET_IDENTIFIER="AssetIdentifier",this.EVENT_STREAM="EventStream",this.ID="id",this.PROFILES="profiles",this.SERVICE_LOCATION="serviceLocation",this.RANGE="range",this.INDEX="index",this.MEDIA="media",this.BYTE_RANGE="byteRange",this.INDEX_RANGE="indexRange",this.MEDIA_RANGE="mediaRange",this.VALUE="value",this.CONTENT_TYPE="contentType",this.MIME_TYPE="mimeType",this.BITSTREAM_SWITCHING="BitstreamSwitching",this.BITSTREAM_SWITCHING_MINUS="bitstreamSwitching",this.CODECS="codecs",this.DEPENDENCY_ID="dependencyId",this.MEDIA_STREAM_STRUCTURE_ID="mediaStreamStructureId",this.METRICS="Metrics",this.METRICS_MINUS="metrics",this.REPORTING="Reporting",this.WIDTH="width",this.HEIGHT="height",this.SAR="sar",this.FRAMERATE="frameRate",this.AUDIO_SAMPLING_RATE="audioSamplingRate",this.MAXIMUM_SAP_PERIOD="maximumSAPPeriod",this.START_WITH_SAP="startWithSAP",this.MAX_PLAYOUT_RATE="maxPlayoutRate",this.CODING_DEPENDENCY="codingDependency",this.SCAN_TYPE="scanType",this.FRAME_PACKING="FramePacking",this.AUDIO_CHANNEL_CONFIGURATION="AudioChannelConfiguration",this.CONTENT_PROTECTION="ContentProtection",this.ESSENTIAL_PROPERTY="EssentialProperty",this.ESSENTIAL_PROPERTY_ASARRAY="EssentialProperty_asArray",this.SUPPLEMENTAL_PROPERTY="SupplementalProperty",this.SUPPLEMENTAL_PROPERTY_ASARRAY="SupplementalProperty_asArray",this.INBAND_EVENT_STREAM="InbandEventStream",this.PRODUCER_REFERENCE_TIME="ProducerReferenceTime",this.INBAND="inband",this.TYPE="type",this.ACCESSIBILITY="Accessibility",this.ROLE="Role",this.RATING="Rating",this.CONTENT_COMPONENT="ContentComponent",this.SUBSET="Subset",this.LANG="lang",this.VIEWPOINT="Viewpoint",this.VIEWPOINT_ASARRAY="Viewpoint_asArray",this.ROLE_ASARRAY="Role_asArray",this.REPRESENTATION_ASARRAY="Representation_asArray",this.PRODUCERREFERENCETIME_ASARRAY="ProducerReferenceTime_asArray",this.ACCESSIBILITY_ASARRAY="Accessibility_asArray",this.AUDIOCHANNELCONFIGURATION_ASARRAY="AudioChannelConfiguration_asArray",this.CONTENTPROTECTION_ASARRAY="ContentProtection_asArray",this.MAIN="main",this.DYNAMIC="dynamic",this.STATIC="static",this.MEDIA_PRESENTATION_DURATION="mediaPresentationDuration",this.MINIMUM_UPDATE_PERIOD="minimumUpdatePeriod",this.CODEC_PRIVATE_DATA="codecPrivateData",this.BANDWITH="bandwidth",this.SOURCE_URL="sourceURL",this.TIMESCALE="timescale",this.DURATION="duration",this.START_NUMBER="startNumber",this.PRESENTATION_TIME_OFFSET="presentationTimeOffset",this.AVAILABILITY_START_TIME="availabilityStartTime",this.AVAILABILITY_END_TIME="availabilityEndTime",this.TIMESHIFT_BUFFER_DEPTH="timeShiftBufferDepth",this.MAX_SEGMENT_DURATION="maxSegmentDuration",this.PRESENTATION_TIME="presentationTime",this.MIN_BUFFER_TIME="minBufferTime",this.MAX_SUBSEGMENT_DURATION="maxSubsegmentDuration",this.START="start",this.AVAILABILITY_TIME_OFFSET="availabilityTimeOffset",this.AVAILABILITY_TIME_COMPLETE="availabilityTimeComplete",this.CENC_DEFAULT_KID="cenc:default_KID",this.DVB_PRIORITY="dvb:priority",this.DVB_WEIGHT="dvb:weight",this.DVB_URL="dvb:url",this.DVB_MIMETYPE="dvb:mimeType",this.DVB_FONTFAMILY="dvb:fontFamily",this.SUGGESTED_PRESENTATION_DELAY="suggestedPresentationDelay",this.SERVICE_DESCRIPTION="ServiceDescription",this.SERVICE_DESCRIPTION_SCOPE="Scope",this.SERVICE_DESCRIPTION_LATENCY="Latency",this.SERVICE_DESCRIPTION_PLAYBACK_RATE="PlaybackRate",this.SERVICE_DESCRIPTION_OPERATING_QUALITY="OperatingQuality",this.SERVICE_DESCRIPTION_OPERATING_BANDWIDTH="OperatingBandwidth",this.PATCH_LOCATION="PatchLocation",this.PATCH_LOCATION_AS_ARRAY="PatchLocation_asArray",this.LOCATION="Location",this.LOCATION_AS_ARRAY="Location_asArray",this.PUBLISH_TIME="publishTime",this.ORIGINAL_PUBLISH_TIME="originalPublishTime",this.ORIGINAL_MPD_ID="mpdId",this.WALL_CLOCK_TIME="wallClockTime",this.PRESENTATION_TIME="presentationTime",this.LABEL="Label",this.GROUP_LABEL="GroupLabel",this.CONTENT_STEERING="ContentSteering",this.CONTENT_STEERING_AS_ARRAY="ContentSteering_asArray",this.DEFAULT_SERVICE_LOCATION="defaultServiceLocation",this.QUERY_BEFORE_START="queryBeforeStart",this.CLIENT_REQUIREMENT="clientRequirement",this.TTL="ttl",this.CONTENT_STEERING_RESPONSE={VERSION:"VERSION",TTL:"TTL",RELOAD_URI:"RELOAD-URI",PATHWAY_PRIORITY:"PATHWAY-PRIORITY",PATHWAY_CLONES:"PATHWAY-CLONES",BASE_ID:"BASE-ID",ID:"ID",URI_REPLACEMENT:"URI-REPLACEMENT",HOST:"HOST",PARAMS:"PARAMS"},this.PRODUCER_REFERENCE_TIME_TYPE={ENCODER:"encoder",CAPTURED:"captured",APPLICATION:"application"},this.SEGMENT_ALIGNMENT="segmentAlignment",this.SUB_SEGMENT_ALIGNMENT="subsegmentAlignment"}}])&&n(e.prototype,t),e}());t.Z=i},7802:function(e,t,n){var i=n(5448),r=n(1724),a=n(3636),o=n(1736),s=n(5246);function l(e){e=e||{};var t,n,i=this.context,l=e.dashConstants,c=e.type,u=e.segmentBaseController;function d(e){return e?e.segments?n[l.SEGMENT_BASE]:n[e.segmentInfoType]:null}return t={initialize:function(t){n[l.SEGMENT_TIMELINE]=(0,r.Z)(i).create(e,t),n[l.SEGMENT_TEMPLATE]=(0,a.Z)(i).create(e,t),n[l.SEGMENT_LIST]=(0,o.Z)(i).create(e,t),n[l.SEGMENT_BASE]=(0,s.Z)(i).create(e,t)},updateInitData:function(e,t){return t?Promise.resolve():u.getSegmentBaseInitSegment({representation:e,mediaType:c})},updateSegmentData:function(e,t){return t?Promise.resolve():u.getSegmentList({mimeType:e.mimeType,representation:e,mediaType:c})},getSegmentByIndex:function(e,t,n){var i=d(e);return i?i.getSegmentByIndex(e,t,n):null},getSegmentByTime:function(e,t){var n=d(e);return n?n.getSegmentByTime(e,t):null},getMediaFinishedInformation:function(e){var t=d(e);return t?t.getMediaFinishedInformation(e):{numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN}}},n={},t}l.__dashjs_factory_name="SegmentsController";var c=i.Z.getClassFactory(l);t.Z=c},1736:function(e,t,n){var i=n(5448),r=n(3393),a=n(7387);function o(e,t){var n=(e=e||{}).timelineConverter;function i(){if(!n||!n.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(r.Z.MISSING_CONFIG_ERROR)}function o(e,r){if(i(),!e)return null;var o=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,s=o.SegmentURL_asArray.length,l=e&&!isNaN(e.startNumber)?e.startNumber:1,c=Math.max(l-1,0),u=Math.max(r-c,0),d=null;if(u<s){var h=o.SegmentURL_asArray[u];(d=(0,a.NF)(n,t,e,r))&&(d.replacementTime=(l+r-1)*e.segmentDuration,d.media=h.media?h.media:"",d.mediaRange=h.mediaRange,d.indexRange=h.indexRange)}return d}return{getSegmentByIndex:o,getSegmentByTime:function(e,t){if(i(),!e)return null;var r=e.segmentDuration;if(isNaN(r))return null;var a=n.calcPeriodRelativeTimeFromMpdRelativeTime(e,t);return o(e,Math.floor(a/r))},getMediaFinishedInformation:function(e){var t={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};if(!e)return t;var n=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,i=e&&!isNaN(e.startNumber)?e.startNumber:1,r=Math.max(i-1,0);return t.numberOfSegments=r+n.SegmentURL_asArray.length,t}}}o.__dashjs_factory_name="ListSegmentsGetter";var s=i.Z.getClassFactory(o);t.Z=s},5246:function(e,t,n){var i=n(5448),r=n(3393);function a(e){var t=(e=e||{}).timelineConverter;function n(){if(!t||!t.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(r.Z.MISSING_CONFIG_ERROR)}function i(e,t){if(n(),!e)return null;var i,r=e.segments?e.segments.length:-1;if(t<r&&(i=e.segments[t])&&i.index===t)return i;for(var a=0;a<r;a++)if((i=e.segments[a])&&i.index===t)return i;return null}return{getSegmentByIndex:i,getSegmentByTime:function(e,t){return n(),i(e,function(e,t){if(!e)return-1;var n,i,r,a,o,s=e.segments,l=s?s.length:null,c=-1;if(s&&l>0)for(o=0;o<l;o++)if(r=(i=s[o]).presentationStartTime,t+(n=(a=i.duration)/2)>=r&&t-n<r+a){c=i.index;break}return c}(e,t))},getMediaFinishedInformation:function(e){var t={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};return e&&e.segments&&(t.numberOfSegments=e.segments.length),t}}}a.__dashjs_factory_name="SegmentBaseGetter";var o=i.Z.getClassFactory(a);t.Z=o},7387:function(e,t,n){n.d(t,{Aj:function(){return o},NF:function(){return u},TJ:function(){return d},eR:function(){return a},vi:function(){return s}});var i=n(2011);function r(e,t){for(;e.length<t;)e="0"+e;return e}function a(e){return e&&e.split("$$").join("$")}function o(e,t){if(!t||!e||-1===e.indexOf("$RepresentationID$"))return e;var n=t.toString();return e.split("$RepresentationID$").join(n)}function s(e,t,n){var i,a,o,s,l,c,u=t.length,d=2;if(!e)return e;for(;;){if((i=e.indexOf("$"+t))<0||(a=e.indexOf("$",i+u))<0)return e;if((o=e.indexOf("%0",i+u))>i&&o<a)switch(s=e.charAt(a-1),l=parseInt(e.substring(o+d,a-1),10),s){case"d":case"i":case"u":c=r(n.toString(),l);break;case"x":c=r(n.toString(16),l);break;case"X":c=r(n.toString(16),l).toUpperCase();break;case"o":c=r(n.toString(8),l);break;default:return e}else c=n;e=e.substring(0,i)+c+e.substring(a+1)}}function l(e,t,n,r,a,o,s,l){var c,u=new i.Z;return u.representation=e,u.duration=t,u.presentationStartTime=n,u.mediaStartTime=r,u.availabilityStartTime=a.calcAvailabilityStartTimeFromPresentationTime(o,e,s),u.availabilityEndTime=a.calcAvailabilityEndTimeFromPresentationTime(o+t,e,s),u.wallStartTime=a.calcWallTimeForSegment(u,s),u.replacementNumber=(c=l,u.representation.startNumber+c),u.index=l,u}function c(e,t,n,i){var r=t.adaptation.period;if(isFinite(r.duration)&&r.start+r.duration<=n.presentationStartTime)return!1;if(i){if("INF"===t.availabilityTimeOffset)return!0;var a=e.getClientReferenceTime();return n.availabilityStartTime.getTime()<=a&&(!isFinite(n.availabilityEndTime)||n.availabilityEndTime.getTime()>=a)}return!0}function u(e,t,n,i){var r,a,o;r=n.segmentDuration,isNaN(r)&&(r=n.adaptation.period.duration),a=parseFloat((n.adaptation.period.start+i*r).toFixed(5)),o=parseFloat((a+r).toFixed(5));var s=l(n,r,a,e.calcMediaTimeFromPresentationTime(a,n),e,o,t,i);return c(e,n,s,t)?s:null}function d(e,t,n,i,r,a,o,u,d,h){var f,p,g=i/a,m=r/a;return f=e.calcPresentationTimeFromMediaTime(g,n),c(e,n,p=l(n,m,f,g,e,f+m,t,d),t)?(p.replacementTime=h||i,o=s(o,"Number",p.replacementNumber),o=s(o,"Time",p.replacementTime),p.media=o,p.mediaRange=u,p):null}},3636:function(e,t,n){var i=n(5448),r=n(3393),a=n(7387);function o(e,t){var n=(e=e||{}).timelineConverter;function i(){if(!n||!n.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(r.Z.MISSING_CONFIG_ERROR)}function o(e,r){if(i(),!e)return null;var o=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate;r=Math.max(r,0);var s=(0,a.NF)(n,t,e,r);if(s){s.replacementTime=Math.round((r-1)*e.segmentDuration*e.timescale,10);var l=o.media;l=(0,a.vi)(l,"Number",s.replacementNumber),l=(0,a.vi)(l,"Time",s.replacementTime),s.media=l}return s}return{getSegmentByIndex:o,getSegmentByTime:function(e,t){if(i(),!e)return null;var r=e.segmentDuration;if(isNaN(r))return null;var a=n.calcPeriodRelativeTimeFromMpdRelativeTime(e,t);return o(e,Math.floor(a/r))},getMediaFinishedInformation:function(e){var t={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};if(!e)return t;var n=e.segmentDuration;return isNaN(n)?t.numberOfSegments=1:t.numberOfSegments=Math.ceil(e.adaptation.period.duration/n),t}}}o.__dashjs_factory_name="TemplateSegmentsGetter";var s=i.Z.getClassFactory(o);t.Z=s},1724:function(e,t,n){var i=n(5448),r=n(3393),a=n(7387);function o(e,t){var n=(e=e||{}).timelineConverter,i=e.dashMetrics;function o(){if(!n)throw new Error(r.Z.MISSING_CONFIG_ERROR)}function s(e,t){var n,i,r,a,o,s,c,u=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate||e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,d=u.SegmentTimeline,h=u.SegmentURL_asArray,f=0,p=-1;c=e.timescale;var g=!1;for(r=0,a=(n=d.S_asArray).length;r<a&&!g;r++)for(s=0,(i=n[r]).hasOwnProperty("r")&&(s=i.r),i.hasOwnProperty("t")&&(f=i.t),s<0&&(s=l(e,n[r+1],i,c,f/c)),o=0;o<=s&&!g;o++)(g=t(f,u,h,i,c,++p,r))&&(e.segmentDuration=i.d/c),f+=i.d}function l(e,t,r,a,o){var s;if(t&&t.hasOwnProperty("t"))s=t.t/a;else try{var l=0;if(isNaN(e.adaptation.period.start)||isNaN(e.adaptation.period.duration)||!isFinite(e.adaptation.period.duration)){var c=i.getCurrentDVRInfo();l=isNaN(c.end)?0:c.end}else l=e.adaptation.period.start+e.adaptation.period.duration;s=n.calcMediaTimeFromPresentationTime(l,e),e.segmentDuration=r.d/a}catch(e){s=0}return Math.max(Math.ceil((s-o)/(r.d/a))-1,0)}return{getSegmentByIndex:function(e,i,r){if(o(),!e)return null;var l=null,c=!1;return s(e,function(i,o,s,u,d,h,f){if(c||r<0){var p=o.media,g=u.mediaRange;return s&&(p=s[f].media||"",g=s[f].mediaRange),l=(0,a.TJ)(n,t,e,i,u.d,d,p,g,h,u.tManifest),!0}return i>=r*d-.5*u.d&&(c=!0),!1}),l},getSegmentByTime:function(e,i){if(o(),!e)return null;void 0===i&&(i=null);var r=null,l=n.calcMediaTimeFromPresentationTime(i,e);return s(e,function(i,o,s,c,u,d,h){var f=parseFloat((l*u).toPrecision(15));if(f<i+c.d&&f>=i){var p=o.media,g=c.mediaRange;return s&&(p=s[h].media||"",g=s[h].mediaRange),r=(0,a.TJ)(n,t,e,i,c.d,u,p,g,d,c.tManifest),!0}return!1}),r},getMediaFinishedInformation:function(e){if(!e)return 0;var t,n,i,r,a,o,s,c=(e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate||e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList).SegmentTimeline,u=0,d=0,h=0;for(s=e.timescale,r=(t=c.S_asArray).length,i=0;i<r;i++)for(o=0,(n=t[i]).hasOwnProperty("r")&&(o=n.r),n.hasOwnProperty("t")&&(d=(u=n.t)/s),o<0&&(o=l(e,t[i+1],n,s,d)),a=0;a<=o;a++)h++,d=(u+=n.d)/s;return{numberOfSegments:h,mediaTimeOfLastSignaledSegment:d}}}}o.__dashjs_factory_name="TimelineSegmentsGetter";var s=i.Z.getClassFactory(o);t.Z=s},2011:function(e,t){t.Z=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=NaN,this.replacementTime=null,this.replacementNumber=NaN,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.availabilityStartTime=NaN,this.availabilityEndTime=NaN,this.wallStartTime=NaN,this.representation=null}},2610:function(e,t){t.Z=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.schemeIdUri="",this.value=""}},1139:function(e,t,n){n.d(t,{Z:function(){return $a}});var i=n(452),r=n.n(i),a=n(3393),o=n(1553),s=n(3860),l=n(5595),c=n(8512),u=n(5448),d=n(6398),h=n(8825);function f(){var e,t,n,i,r,o,u,f,p,g,m,v,y,_,E,b,T,S,w,A,R,x,I,L,M,C=this.context,P=(0,l.Z)(C).getInstance();function D(){F(),_=!1,g=0,m=0,T=0,I=!1,S=!0,w=!1,L=!1,A=NaN,b=NaN,u&&(P.off(c.Z.DATA_UPDATE_COMPLETED,J,e),P.off(c.Z.LOADING_PROGRESS,ye,e),P.off(c.Z.MANIFEST_UPDATED,Te,e),P.off(c.Z.STREAMS_COMPOSED,Se,e),P.off(h.Z.PLAYBACK_ENDED,ge,e),P.off(h.Z.STREAM_INITIALIZING,Ee,e),P.off(h.Z.REPRESENTATION_SWITCH,be,e),P.off(h.Z.BUFFER_LEVEL_STATE_CHANGED,te,e),Q(),u.removeEventListener("canplay",$),u.removeEventListener("canplaythrough",ee),u.removeEventListener("play",ne),u.removeEventListener("waiting",ie),u.removeEventListener("playing",re),u.removeEventListener("pause",ae),u.removeEventListener("error",me),u.removeEventListener("seeking",oe),u.removeEventListener("seeked",se),u.removeEventListener("timeupdate",le),u.removeEventListener("progress",ce),u.removeEventListener("ratechange",ue),u.removeEventListener("loadedmetadata",de),u.removeEventListener("loadeddata",he),u.removeEventListener("stalled",_e),u.removeEventListener("ended",fe),u.removeEventListener("volumechange",pe)),p=null,u=null,v=null,y=null}function O(){return parseFloat((N(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)-G()).toFixed(5))}function N(e){var t=e||v;return t.start+t.duration}function k(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];v&&u&&u.getElement()?(e&&y&&V(G()),u.play()):_=!0}function F(){v&&u&&u.pause()}function B(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];v&&u&&u.getElement()&&e!==(isNaN(A)?u.getTime():A)&&((R=!0===i)||(A=e),t.info("Requesting seek to time: "+e+(R?" (internal)":"")),y&&r&&V(e),u.setCurrentTime(e,n))}function U(){if(v&&u&&y){var e=n&&n.hasVideoTrack()?a.Z.VIDEO:a.Z.AUDIO,t=r.getCurrentDVRInfo(e);return t&&t.range?t.range.end:0}}function V(e){var t=new Date(f.getClientReferenceTime()),n=o.getRegularPeriods()[0],i=f.calcPresentationTimeFromWallTime(t,n);g=i-e}function G(){return v&&u?u.getTime():null}function H(){return v&&u?u.isPaused():null}function j(){return v&&u?u.isSeeking():null}function z(){return v&&u?u.isStalled():null}function Z(){return v&&u?u.getPlaybackRate():null}function q(){return v&&u?u.getEnded():null}function W(){return y}function Y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!H()&&y&&0!==u.getReadyState()&&!j()&&!I){e||(e=n.hasVideoTrack()?a.Z.VIDEO:a.Z.AUDIO);var i=G(),r=K(i,e);!isNaN(r)&&r!==i&&!j()&&(z()||x||1===u.getReadyState())&&(t.debug("UpdateCurrentTime: Seek to actual time: ".concat(r," from currentTime: ").concat(i)),B(r,!1,!1))}}function K(e,t){var n=r.getCurrentDVRInfo(t),i=n?n.range:null;return i?e>i.end?Math.max(i.end-g,i.start):e>0&&e+.25<i.start&&Math.abs(e-i.start)<31536e4?w?Math.max(i.end-g,i.start):i.start:e:NaN}function X(){null===p&&(p=setInterval(function(){!function(){if(P.trigger(c.Z.WALLCLOCK_TIME_UPDATED,{isDynamic:y,time:new Date}),W()){var e=Date.now();(isNaN(b)||e>b+M.get().streaming.liveUpdateTimeThresholdInMilliseconds)&&(n.addDVRMetric(),H()?(t=Date.now(),(!E||t>E+500)&&(E=t,le())):Y(),b=e)}var t}()},M.get().streaming.wallclockTimeUpdateInterval))}function Q(){clearInterval(p),p=null}function J(e){var t=o.convertRepresentationToRepresentationInfo(e.currentRepresentation),n=t?t.mediaInfo.streamInfo:null;null!==n&&v.id===n.id&&(v=n)}function $(){P.trigger(c.Z.CAN_PLAY)}function ee(){P.trigger(c.Z.CAN_PLAY_THROUGH)}function te(e){e.streamId===n.getActiveStreamInfo().id&&(x=e.state===s.Z.BUFFER_EMPTY,M.get().streaming.buffer.setStallState&&u.setStallState(e.mediaType,e.state===s.Z.BUFFER_EMPTY))}function ne(){t.info("Native video element event: play"),Y(),X(),P.trigger(c.Z.PLAYBACK_STARTED,{startTime:G()})}function ie(){t.info("Native video element event: waiting"),P.trigger(c.Z.PLAYBACK_WAITING,{playingTime:G()})}function re(){t.info("Native video element event: playing"),R=!1,P.trigger(c.Z.PLAYBACK_PLAYING,{playingTime:G()})}function ae(){t.info("Native video element event: pause"),P.trigger(c.Z.PLAYBACK_PAUSED,{ended:q()})}function oe(){if(!R){var e=G();isNaN(A)||A===e||(e=A),A=NaN,t.info("Seeking to: "+e),X(),P.trigger(c.Z.PLAYBACK_SEEKING,{seekTime:e,streamId:v.id})}}function se(){t.info("Native video element event: seeked"),R=!1,P.trigger(c.Z.PLAYBACK_SEEKED)}function le(){v&&P.trigger(c.Z.PLAYBACK_TIME_UPDATED,{timeToEnd:O(),time:G(),streamId:v.id})}function ce(){P.trigger(c.Z.PLAYBACK_PROGRESS,{streamId:v.id})}function ue(){var e=Z();t.info("Native video element event: ratechange: ",e),P.trigger(c.Z.PLAYBACK_RATE_CHANGED,{playbackRate:e})}function de(){t.info("Native video element event: loadedmetadata"),P.trigger(c.Z.PLAYBACK_METADATA_LOADED),X()}function he(){t.info("Native video element event: loadeddata"),P.trigger(c.Z.PLAYBACK_LOADED_DATA)}function fe(){t.info("Native video element event: ended"),F(),Q();var e=n?n.getActiveStreamInfo():null;e&&P.trigger(c.Z.PLAYBACK_ENDED,{isLast:e.isLast})}function pe(){P.trigger(c.Z.PLAYBACK_VOLUME_CHANGED)}function ge(e){if(p&&e.isLast){t.info("onPlaybackEnded -- PLAYBACK_ENDED but native video element didn't fire ended");var n=e.seekTime?e.seekTime:N();u.setCurrentTime(n),F(),Q()}}function me(e){var t=e.target||e.srcElement;P.trigger(c.Z.PLAYBACK_ERROR,{error:t.error})}function ve(){y=!1}function ye(e){if(!1===e.stream&&w&&!isNaN(e.request.duration)){var n=1.2*e.request.duration;n>g&&(t.warn("Browser does not support fetch API with StreamReader. Increasing live delay to be 20% higher than segment duration:",n.toFixed(2)),g=n,m=n)}}function _e(e){P.trigger(c.Z.PLAYBACK_STALLED,{e:e})}function Ee(e){var n;(n=e.mediaInfo)&&n.supplementalProperties&&n.supplementalProperties[a.Z.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME]&&"true"===n.supplementalProperties[a.Z.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME].value&&(t.debug("Low Latency critical SupplementalProperty set: Enabling low Latency"),w=!0)}function be(e){var t=n.getActiveStreamInfo();e&&t&&e.currentRepresentation&&e.streamId&&e.streamId===t.id&&e.mediaType&&(e.mediaType===a.Z.VIDEO||e.mediaType===a.Z.AUDIO)&&(S=e.currentRepresentation.availabilityTimeComplete,(w=!S)&&!L&&(L=!0))}function Te(){I=!0}function Se(){I=!1}return e={initialize:function(t,n){v=t,!0!==n&&(u.addEventListener("canplay",$),u.addEventListener("canplaythrough",ee),u.addEventListener("play",ne),u.addEventListener("waiting",ie),u.addEventListener("playing",re),u.addEventListener("pause",ae),u.addEventListener("error",me),u.addEventListener("seeking",oe),u.addEventListener("seeked",se),u.addEventListener("timeupdate",le),u.addEventListener("progress",ce),u.addEventListener("ratechange",ue),u.addEventListener("loadedmetadata",de),u.addEventListener("loadeddata",he),u.addEventListener("stalled",_e),u.addEventListener("ended",fe),u.addEventListener("volumechange",pe),y=v.manifestInfo.isDynamic,x=!1,R=!1,P.on(c.Z.DATA_UPDATE_COMPLETED,J,e),P.on(c.Z.LOADING_PROGRESS,ye,e),P.on(c.Z.MANIFEST_UPDATED,Te,e),P.on(c.Z.STREAMS_COMPOSED,Se,e),P.on(h.Z.PLAYBACK_ENDED,ge,e,{priority:l.Z.EVENT_PRIORITY_HIGH}),P.on(h.Z.STREAM_INITIALIZING,Ee,e),P.on(h.Z.REPRESENTATION_SWITCH,be,e),P.on(h.Z.BUFFER_LEVEL_STATE_CHANGED,te,e),P.on(h.Z.DYNAMIC_TO_STATIC,ve,e),_&&(_=!1,k()))},setConfig:function(e){e&&(e.streamController&&(n=e.streamController),e.serviceDescriptionController&&(i=e.serviceDescriptionController),e.dashMetrics&&(r=e.dashMetrics),e.adapter&&(o=e.adapter),e.videoModel&&(u=e.videoModel),e.timelineConverter&&(f=e.timelineConverter),e.settings&&(M=e.settings))},getTimeToStreamEnd:O,getBufferLevel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=null;return n.getActiveStreamProcessors().forEach(function(n){if(!e||0===e.length||-1===e.indexOf(n.getType())){var i=n.getBufferLevel();t=null===t?i:Math.min(t,i)}}),t},getPlaybackStalled:function(){return x},getTime:G,getLowLatencyModeEnabled:function(){return w},getInitialCatchupModeActivated:function(){return L},getIsManifestUpdateInProgress:function(){return I},getPlaybackRate:Z,getPlayedRanges:function(){return v&&u?u.getPlayedRanges():null},getEnded:q,getIsDynamic:W,getStreamController:function(){return n},computeAndSetLiveDelay:function(e,t){var n,r,a,s=!isNaN(e)&&isFinite(e)?e:NaN,l=o.getSuggestedPresentationDelay(),c=i.getServiceDescriptionSettings();return n=isNaN(M.get().streaming.delay.liveDelay)?null===M.get().streaming.delay.liveDelayFragmentCount||isNaN(M.get().streaming.delay.liveDelayFragmentCount)||isNaN(s)?c&&!isNaN(c.liveDelay)&&c.liveDelay>0?c.liveDelay:!0===M.get().streaming.delay.useSuggestedPresentationDelay&&null!==l&&!isNaN(l)&&l>0?l:isNaN(s)?t&&!isNaN(t.minBufferTime)?4*t.minBufferTime:4*v.manifestInfo.minBufferTime:4*s:s*M.get().streaming.delay.liveDelayFragmentCount:M.get().streaming.delay.liveDelay,null!==(a=o.getAvailabilityStartTime())&&(T=a),r=t&&t.dvrWindowSize>0?Math.min(n,t.dvrWindowSize):n,g=r,m=r,r},getLiveDelay:function(){return g},getOriginalLiveDelay:function(){return m},getCurrentLiveLatency:function(){if(!y||isNaN(T))return NaN;var e=G();if(isNaN(e)||0===e)return 0;var t=(new Date).getTime()+1e3*f.getClientTimeOffset();return Math.max(((t-T-1e3*e)/1e3).toFixed(3),0)},play:k,isPaused:H,isStalled:z,pause:F,isSeeking:j,getStreamEndTime:N,seek:B,seekToOriginalLive:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=U();0!==i&&B(i-(g=m),e,t,n)},seekToCurrentLive:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=U();0!==i&&B(i-g,e,t,n)},reset:D,updateCurrentTime:Y,getAvailabilityStartTime:function(){return T}},t=(0,d.Z)(C).getInstance().getLogger(e),D(),e}f.__dashjs_factory_name="PlaybackController";var p=u.Z.getSingletonFactory(f),g=n(3186),m="loading",v="executed",y="failed";function _(e){var t,n,i,r,a=(e=e||{}).eventBus,o=e.events,s=e.dashMetrics,l=e.fragmentLoader,c=e.debug,u=e.streamInfo,d=e.type;function h(e){var t;return!!e&&(t=!1,i.some(function(n){if(a=e,o=n,!isNaN(a.index)&&a.startTime===o.startTime&&a.adaptationIndex===o.adaptationIndex&&a.type===o.type||(i=e,r=n,isNaN(i.index)&&isNaN(r.index)&&i.quality===r.quality)||function(e,t){return e.action===g.Z.ACTION_COMPLETE&&e.action===t.action}(e,n))return t=!0;var i,r,a,o}),t)}function f(e){return isNaN(e.duration)?.25:Math.min(e.duration/8,.5)}function p(e){i=i.filter(function(t){var n=f(t);return isNaN(t.startTime)||void 0!==e&&t.startTime>=e-n})}function _(e,t){t<=e+.5||(i=i.filter(function(n){var i=f(n);return isNaN(n.startTime)||n.startTime>=t-i||isNaN(n.duration)||n.startTime+n.duration<=e+i}))}function E(e,t,n){for(var i=e.length-1;i>=0;i--){var r=e[i],a=r.startTime,o=a+r.duration;if(n=isNaN(n)?f(r):n,!isNaN(a)&&!isNaN(o)&&t+n>=a&&t-n<o||isNaN(a)&&isNaN(t))return r}return null}function b(e,t){s.addSchedulingInfo(e,t),s.addRequestsQueue(e.mediaType,r,i)}function T(e){e.sender===l&&(r.splice(r.indexOf(e.request),1),e.response&&!e.error&&i.push(e.request),b(e.request,e.error?y:v),a.trigger(o.FRAGMENT_LOADING_COMPLETED,{request:e.request,response:e.response,error:e.error,sender:this},{streamId:u.id,mediaType:d}))}function S(e){e.sender===l&&a.trigger(o.FRAGMENT_LOADING_PROGRESS,{request:e.request,response:e.response,error:e.error,sender:this},{streamId:u.id,mediaType:d})}function w(e){e.sender===l&&a.trigger(o.FRAGMENT_LOADING_ABANDONED,{request:e.request},{streamId:u.id,mediaType:d})}function A(){i=[],r=[]}return t={getStreamId:function(){return u.id},getType:function(){return d},getRequests:function(e){var t=e?e.state instanceof Array?e.state:[e.state]:[],n=[];return t.forEach(function(t){var a,o,s=function(e){var t;switch(e){case m:t=r;break;case v:t=i;break;default:t=[]}return t}(t);n=n.concat((a=s,(o=e).hasOwnProperty("time")?[E(a,o.time,o.threshold)]:a.filter(function(e){for(var t in o)if("state"!==t&&o.hasOwnProperty(t)&&e[t]!=o[t])return!1;return!0})))}),n},isFragmentLoaded:h,isFragmentLoadedOrPending:function(e){var t,n=!1,i=0;if(!(n=h(e)))for(i=0;i<r.length;i++)t=r[i],e.url===t.url&&e.startTime===t.startTime&&(n=!0);return n},removeExecutedRequestsBeforeTime:p,removeExecutedRequestsAfterTime:function(e){i=i.filter(function(t){return isNaN(t.startTime)||void 0!==e&&t.startTime<e})},syncExecutedRequestsWithBufferedRange:function(e,t){if(e&&0!==e.length){for(var n=0,i=0,r=e.length;i<r;i++)_(n,e.start(i)),n=e.end(i);t>0&&_(n,t)}else p()},abortRequests:function(){n.debug("abort requests"),l.abort(),r=[]},executeRequest:function(e){var t;e.action===g.Z.ACTION_DOWNLOAD?(b(e,m),r.push(e),t=e,a.trigger(o.FRAGMENT_LOADING_STARTED,{request:t},{streamId:u.id,mediaType:d}),l.load(t)):n.warn("Unknown request action.")},reset:function(){a.off(o.LOADING_COMPLETED,T,this),a.off(o.LOADING_DATA_PROGRESS,S,this),a.off(o.LOADING_ABANDONED,w,this),l&&l.reset(),A()},resetInitialSettings:A,addExecutedRequest:function(e){i.push(e)}},n=c.getLogger(t),A(),a.on(o.LOADING_COMPLETED,T,t),a.on(o.LOADING_DATA_PROGRESS,S,t),a.on(o.LOADING_ABANDONED,w,t),t}_.__dashjs_factory_name="FragmentModel";var E=u.Z.getClassFactory(_);E.FRAGMENT_MODEL_LOADING=m,E.FRAGMENT_MODEL_EXECUTED=v,E.FRAGMENT_MODEL_CANCELED="canceled",E.FRAGMENT_MODEL_FAILED=y,u.Z.updateClassFactory(_.__dashjs_factory_name,E);var b=E,T=n(5459);function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var x=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(r,e);var t,n,i=(t=r,n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=R(t);if(n){var r=R(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return A(this,e)});function r(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(e=i.call(this)).MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE=10,e.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE=11,e.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE=12,e.SEGMENT_BASE_LOADER_ERROR_CODE=15,e.TIME_SYNC_FAILED_ERROR_CODE=16,e.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE=17,e.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE=18,e.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE=19,e.APPEND_ERROR_CODE=20,e.REMOVE_ERROR_CODE=21,e.DATA_UPDATE_FAILED_ERROR_CODE=22,e.CAPABILITY_MEDIASOURCE_ERROR_CODE=23,e.CAPABILITY_MEDIAKEYS_ERROR_CODE=24,e.DOWNLOAD_ERROR_ID_MANIFEST_CODE=25,e.DOWNLOAD_ERROR_ID_SIDX_CODE=26,e.DOWNLOAD_ERROR_ID_CONTENT_CODE=27,e.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE=28,e.DOWNLOAD_ERROR_ID_XLINK_CODE=29,e.MANIFEST_ERROR_ID_PARSE_CODE=31,e.MANIFEST_ERROR_ID_NOSTREAMS_CODE=32,e.TIMED_TEXT_ERROR_ID_PARSE_CODE=33,e.MANIFEST_ERROR_ID_MULTIPLEXED_CODE=34,e.MEDIASOURCE_TYPE_UNSUPPORTED_CODE=35,e.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE="parsing failed for ",e.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading manifest: ",e.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading Xlink element: ",e.SEGMENTS_UPDATE_FAILED_ERROR_MESSAGE="Segments update failed",e.SEGMENTS_UNAVAILABLE_ERROR_MESSAGE="no segments are available yet",e.SEGMENT_BASE_LOADER_ERROR_MESSAGE="error loading segment ranges from sidx",e.TIME_SYNC_FAILED_ERROR_MESSAGE="Failed to synchronize client and server time",e.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE="request is null",e.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE="Failed to resolve a valid URL",e.APPEND_ERROR_MESSAGE="chunk is not defined",e.REMOVE_ERROR_MESSAGE="Removing data from the SourceBuffer",e.DATA_UPDATE_FAILED_ERROR_MESSAGE="Data update failed",e.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE="mediasource is not supported",e.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE="mediakeys is not supported",e.TIMED_TEXT_ERROR_MESSAGE_PARSE="parsing error :",e.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE="Error creating source buffer of type : ",e}return r}(n(2230).Z)),I=n(1264),L=n(7855);function M(e){var t,n,i,r,o,s,l=this.context,u=(0,I.Z)(l).getInstance(),h=e.textController,f=e.eventBus,p=[],g=[],m=!1,v=e.mediaSource,y=null;function _(e){return new Promise(function(t){P(function(){r.changeType&&r.changeType(e),t()})})}function E(e){return r=h.getTextSourceBuffer(e),Promise.resolve()}function b(){if("function"==typeof r.addEventListener)try{r.addEventListener("updateend",M,!1),r.addEventListener("error",C,!1),r.addEventListener("abort",C,!1)}catch(e){s=setInterval(M,50)}else s=setInterval(M,50)}function S(e){return new Promise(function(t){r&&u.get().streaming.buffer.useAppendWindow?P(function(){try{if(!r)return void t();var n=v.duration,a=0;e&&!isNaN(e.start)&&!isNaN(e.duration)&&isFinite(e.duration)&&(n=e.start+e.duration),e&&!isNaN(e.start)&&(a=e.start),r.appendWindowEnd===n&&r.appendWindowStart===a||(r.appendWindowStart=0,r.appendWindowEnd=n+.01,r.appendWindowStart=Math.max(a-.1,0),i.debug("Updated append window for ".concat(o.type,". Set start to ").concat(r.appendWindowStart," and end to ").concat(r.appendWindowEnd))),t()}catch(e){i.warn("Failed to set append window"),t()}}):t()})}function w(e){return new Promise(function(t){r?P(function(){try{r.timestampOffset===e||isNaN(e)||(r.timestampOffset=e,i.debug("Set MSE timestamp offset to ".concat(e))),t()}catch(e){t()}}):t()})}function A(){if(!m&&g.length>0){m=!0;var e=g[0];g.splice(0,1);var t=function(){m=!1,g.length>0&&A.call(this),e&&e.data&&e.data.segmentType&&e.data.segmentType!==L.w.INIT_SEGMENT_TYPE&&delete e.data.bytes,e.promise.resolve({chunk:e.data})};try{y=e.request,0===e.data.bytes.byteLength?t.call(this):(r.appendBuffer?r.appendBuffer(e.data.bytes):r.append(e.data.bytes,e.data),P(t.bind(this)))}catch(t){i.fatal('SourceBuffer append failed "'+t+'"'),g.length>0?A():m=!1,delete e.data.bytes,e.promise.reject({chunk:e.data,error:new T.Z(t.code,t.message)})}}}function R(){p.length>0&&(r.updating||(p.shift()(),R()))}function M(){r.updating||R()}function C(e){var t,i,r=e.target||{};t=c.Z.SOURCE_BUFFER_ERROR,i={error:r,lastRequestAppended:y},f.trigger(t,i,{streamId:o.streamInfo.id,mediaType:n})}function P(e){p.push(e),r.updating||R()}return t={getType:function(){return n},getAllBufferRanges:function(){try{return r.buffered}catch(e){return i.error("getAllBufferRanges exception: "+e.message),null}},getBuffer:function(){return r},append:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise(function(i,r){e?(g.push({data:e,promise:{resolve:i,reject:r},request:n}),P(A.bind(t))):r({chunk:e,error:new T.Z(x.APPEND_ERROR_CODE,x.APPEND_ERROR_MESSAGE)})})},remove:function(e){return new Promise(function(t,n){var i=e.start,a=e.end;i>=0&&a>i?P(function(){try{r.remove(i,a),P(function(){t({from:i,to:a,unintended:!1}),e.resolve&&e.resolve()})}catch(t){n({from:i,to:a,unintended:!1,error:new T.Z(x.REMOVE_ERROR_CODE,x.REMOVE_ERROR_MESSAGE)}),e.reject&&e.reject(t)}}):t()})},abort:function(){return new Promise(function(e){try{g=[],"open"===v.readyState?P(function(){try{r&&r.abort(),e()}catch(t){e()}}):(r&&r.setTextTrack&&"ended"===v.readyState&&r.abort(),e())}catch(t){e()}})},reset:function(){if(r){try{p=[],function(){try{"function"==typeof r.removeEventListener&&(r.removeEventListener("updateend",M,!1),r.removeEventListener("error",C,!1),r.removeEventListener("abort",C,!1)),clearInterval(s)}catch(e){i.error(e)}}(),m=!1,g=[],r.getClassName&&"TextSourceBuffer"===r.getClassName()||(i.debug("Removing sourcebuffer from media source"),v.removeSourceBuffer(r))}catch(e){}r=null}y=null},updateTimestampOffset:w,initializeForStreamSwitch:function(e,t,i){n=(o=e).type;var a=o.codec;r=i.getBuffer(),b();var s=[];return s.push(new Promise(function(e){P(function(){var t=r.appendWindowStart,n=r.appendWindowEnd;r&&(r.abort(),r.appendWindowStart=t,r.appendWindowEnd=n),e()})})),s.push(S(o.streamInfo)),u.get().streaming.buffer.useChangeTypeForTrackSwitch&&s.push(_(a)),t&&void 0!==t.MSETimeOffset&&s.push(w(t.MSETimeOffset)),Promise.all(s)},initializeForFirstUse:function(e,t,i){n=(o=t).type;var s=o.codec;try{if(s.match(/application\/mp4;\s*codecs="(stpp|wvtt).*"/i))return E(e);r=v.addSourceBuffer(s),b();var l=[];return l.push(S(o.streamInfo)),i&&void 0!==i.MSETimeOffset&&l.push(w(i.MSETimeOffset)),Promise.all(l)}catch(t){return o.type==a.Z.TEXT&&!o.isFragmented||-1!==s.indexOf('codecs="stpp')||-1!==s.indexOf('codecs="vtt')||-1!==s.indexOf("text/vtt")?E(e):Promise.reject(t)}},updateAppendWindow:S,changeType:_},i=(0,d.Z)(l).getInstance().getLogger(t),t}M.__dashjs_factory_name="SourceBufferSink";var C=u.Z.getClassFactory(M);function P(e){var t,n,i,r=this.context,a=[],o=e;function s(e,t){return a=a.filter(function(n){return!((isNaN(t)||n.start<t)&&(isNaN(e)||n.end>e))}),Promise.resolve()}return t={getAllBufferRanges:function(){for(var e=[],t=0;t<a.length;t++){var n=a[t];0===e.length||n.start>e[e.length-1].end?e.push({start:n.start,end:n.end}):e[e.length-1].end=n.end}var i={start:function(t){return e[t].start},end:function(t){return e[t].end}};return Object.defineProperty(i,"length",{get:function(){return e.length}}),i},append:function(e){return"InitializationSegment"!==e.segmentType?(a.push(e),a.sort(function(e,t){return e.start-t.start}),i=null):i=e,n.debug("PreBufferSink appended chunk s: "+e.start+"; e: "+e.end),o&&o({chunk:e}),Promise.resolve()},remove:s,abort:function(){return Promise.resolve()},discharge:function(e,t){var n,r,o=(n=e,r=t,a.filter(function(e){return(isNaN(r)||e.start<r)&&(isNaN(n)||e.end>n)}));return i&&(o.push(i),i=null),s(e,t),o},reset:function(){a=[],i=null,o=null},updateTimestampOffset:function(){return Promise.resolve()},waitForUpdateEnd:function(e){e()},getBuffer:function(){return this}},n=(0,d.Z)(r).getInstance().getLogger(t),t}P.__dashjs_factory_name="PreBufferSink";var D=u.Z.getClassFactory(P);function O(){var e={};return{save:function(t){var n=t.streamId,i=t.representationId;e[n]=e[n]||{},e[n][i]=t},extract:function(t,n){return e&&e[t]&&e[t][n]?e[t][n]:null},reset:function(){e={}}}}O.__dashjs_factory_name="InitCache";var N=u.Z.getSingletonFactory(O),k=.01,F="BufferController";function B(e){e=e||{};var t,n,i,r,o,u,f,p,g,m,v,y,_,E,S,w,A,R,I,M,P,O=this.context,B=(0,l.Z)(O).getInstance(),U=e.errHandler,V=e.fragmentModel,G=e.representationController,H=e.adapter,j=e.textController,z=e.abrController,Z=e.playbackController,q=e.streamInfo,W=e.type,Y=e.settings;function K(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise(function(n,i){u=e,g&&t&&"function"==typeof g.discharge?(m=g,Q(t).then(function(){n()}).catch(function(e){i(e)})):n()})}function X(e){return H.convertRepresentationToRepresentationInfo(G.getRepresentationForQuality(e))}function Q(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return new Promise(function(n,i){R&&e?u?(v=!1,$(e,t).then(function(e){n(e)}).catch(function(e){i(e)})):(v=!0,J().then(function(e){n(e)}).catch(function(e){i(e)})):n(null)})}function J(){var e=this;return new Promise(function(t,n){var i=z.getQualityFor(W,q.id);g=D(O).create(re.bind(e)),Ee(X(i)).then(function(){t(g)}).catch(function(){n()})})}function $(e,t){return new Promise(function(i,r){var o,s,l,c,d=z.getQualityFor(W,q.id);g=C(O).create({mediaSource:u,textController:j,eventBus:B}),(o=e,s=t,l=d,c=X(l),s&&s[W]&&(W===a.Z.VIDEO||W===a.Z.AUDIO)?g.initializeForStreamSwitch(o,c,s[W]):g.initializeForFirstUse(q,o,c)).then(function(){return Ee(X(d))}).then(function(){i(g)}).catch(function(e){n.fatal("Caught error on create SourceBuffer: "+e),U.error(new T.Z(x.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,x.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+W)),r(e)})})}function ee(e){Y.get().streaming.cacheInitSegments&&(n.info("Init fragment finished loading saving to",W+"'s init cache"),R.save(e.chunk)),n.debug("Append Init fragment",W," with representationId:",e.chunk.representationId," and quality:",e.chunk.quality,", data size:",e.chunk.bytes.byteLength),ne(e.chunk)}function te(e){ne(e.chunk,e.request)}function ne(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;g&&(g.append(e,t).then(function(e){re(e)}).catch(function(e){re(e)}),e.mediaInfo.type===a.Z.VIDEO&&Ie(c.Z.VIDEO_CHUNK_RECEIVED,{chunk:e}))}function ie(e){if(e&&e.length>0)for(var t=0,i=e.length;t<i;t++)n.debug("Buffered range: "+e.start(t)+" - "+e.end(t)+", currentTime = ",Z.getTime())}function re(e){if(e.error)return 22===e.error.code&&function(){if(A=!0,o=.8*Ae(),n.warn("Quota exceeded, Critical Buffer: "+o),o>0){var e=Math.max(.2*o,1),t=o-e,i=Math.min(Y.get().streaming.buffer.bufferTimeAtTopQuality,.9*t),r=Math.min(Y.get().streaming.buffer.bufferTimeAtTopQualityLongForm,.9*t),a={streaming:{buffer:{bufferToKeep:parseFloat(e.toFixed(5)),bufferTimeAtTopQuality:parseFloat(i.toFixed(5)),bufferTimeAtTopQualityLongForm:parseFloat(r.toFixed(5))}}};Y.update(a)}}(),void(22!==e.error.code&&xe()||(n.warn("Clearing playback buffer to overcome quota exceed situation"),Ie(c.Z.QUOTA_EXCEEDED,{criticalBufferLevel:o,quotaExceededTime:e.chunk.start}),ve(me())));if(g&&(de(),A=!1,(E=e.chunk)&&E.endFragment)){E&&!isNaN(E.index)&&(f=Math.max(E.index,f),he());var t=g.getAllBufferRanges();E.segmentType===L.w.MEDIA_SEGMENT_TYPE&&(ie(t),se(),function(){if(!isNaN(P)&&!v)if(W===a.Z.AUDIO||W===a.Z.VIDEO){var e=Z.getTime(),t=ue(e,0),n=ue(P,0);if(t&&n&&t.start===n.start)P=NaN;else{var i=G.getCurrentRepresentation().segmentDuration,r=ue(P,i);r&&(Y.get().streaming.buffer.enableSeekDecorrelationFix&&Math.abs(e-P)>i?P<=r.end&&Z.seek(Math.max(P,r.start),!1,!0):e<r.start&&Z.seek(r.start,!1,!0))}}else P=NaN}());var i=!1;y&&(y.indexOf(E)>0&&(i=!0),y=null),E&&!i&&Ie(c.Z.BYTES_APPENDED_END_FRAGMENT,{quality:E.quality,startTime:E.start,index:E.index,bufferedRanges:t,segmentType:E.segmentType,mediaType:W})}}function ae(){return new Promise(function(e,t){var n=oe();if(!n||0===n.length)return se(),void e();ve(n).then(function(){e()}).catch(function(e){t(e)})})}function oe(e){var t=[],i=g.getAllBufferRanges();if(!i||0===i.length)return t;if(!e&&0!==e||isNaN(e))t.push({start:i.start(0),end:i.end(i.length-1)+.5});else{var r=function(e,t){var n=Y.get().streaming.buffer.bufferToKeep,i=t.start(0);if(e-i>n){var r=Math.max(0,e-n),a=V.getRequests({state:b.FRAGMENT_MODEL_EXECUTED,time:e,threshold:k})[0];if(a&&(r=Math.min(a.startTime,r)),r>0)return{start:i,end:r}}return null}(e,i),a=function(e,t){var i=t.end(t.length-1)+.5,r=Re(e),a=q.manifestInfo.duration>=Y.get().streaming.buffer.longFormContentDurationThreshold?Y.get().streaming.buffer.bufferTimeAtTopQualityLongForm:Y.get().streaming.buffer.bufferTimeAtTopQuality,o=isNaN(r)?e:Math.min(r,e+a);if(o>=t.end(t.length-1))return null;var s=V.getRequests({state:b.FRAGMENT_MODEL_EXECUTED,time:e,threshold:k})[0];if(s&&(o=Math.max(s.startTime+s.duration,o)),Y.get().streaming.buffer.avoidCurrentTimeRangePruning)for(var l=0;l<t.length;l++)if(t.start(l)<=e&&e<=t.end(l)&&t.start(l)<=o&&o<=t.end(l)){var c=o;o=l+1<t.length?t.start(l+1):t.end(l)+1,n.debug("Buffered range ["+t.start(l)+", "+t.end(l)+"] overlaps with targetTime "+e+" and range to be pruned ["+c+", "+i+"], using ["+o+", "+i+"] instead"+(o<i?"":" (no actual pruning)"));break}return o<t.end(t.length-1)?{start:o,end:i}:null}(e,i);r&&t.push(r),a&&t.push(a)}return t}function se(){(!M||W===a.Z.TEXT&&j.isTextEnabled())&&de()}function le(){fe()}function ce(){fe(),P=NaN}function ue(e,t){if(!g)return null;var n,i,r=g.getAllBufferRanges(),a=0,o=0,s=null,l=null,c=0,u=isNaN(t)?.15:t;if(null!=r){for(i=0,n=r.length;i<n;i++)if(a=r.start(i),o=r.end(i),null===s)c=Math.abs(a-e),(e>=a&&e<o||c<=u)&&(s=a,l=o);else{if(!((c=a-l)<=u))break;l=o}if(null!==s)return{start:s,end:l}}return null}function de(){if(Z){var e=Z.getTime()||0;v&&(e=isNaN(P)?0:P);var t=Y.get().streaming.gaps.jumpGaps&&!isNaN(Y.get().streaming.gaps.smallGapLimit)?Y.get().streaming.gaps.smallGapLimit:NaN;r=Math.max((n=e,i=t,Y.get().streaming.gaps.jumpGaps&&(i=Y.get().streaming.gaps.smallGapLimit),null===(a=ue(n,i))?0:a.end-n),0),Ie(c.Z.BUFFER_LEVEL_UPDATED,{mediaType:W,bufferLevel:r}),fe()}var n,i,a}function he(){var e=f>=p-1,t=Z.getTimeToStreamEnd(q)-r<1e-5;!e&&!t||i||(we(!0),n.debug("checkIfBufferingCompleted trigger BUFFERING_COMPLETED for stream id ".concat(q.id," and type ").concat(W)))}function fe(){W!==a.Z.AUDIO&&W!==a.Z.VIDEO||((!Z.getLowLatencyModeEnabled()&&r<Y.get().streaming.buffer.stallThreshold||0===r)&&!i?pe(s.Z.BUFFER_EMPTY):(i||r>=Y.get().streaming.buffer.stallThreshold||Z.getLowLatencyModeEnabled()&&r>0)&&pe(s.Z.BUFFER_LOADED))}function pe(e){_===e||e===s.Z.BUFFER_EMPTY&&0===Z.getTime()||W===a.Z.TEXT&&!j.isTextEnabled()||(_=e,Ie(c.Z.BUFFER_LEVEL_STATE_CHANGED,{state:e}),Ie(e===s.Z.BUFFER_LOADED?c.Z.BUFFER_LOADED:c.Z.BUFFER_EMPTY),n.debug(e===s.Z.BUFFER_LOADED?"Got enough buffer to start":"Waiting for more buffer before starting playback"))}function ge(){g&&W!==a.Z.TEXT&&(i||ve(me()))}function me(){var e=[],t=g.getAllBufferRanges();if(!t||0===t.length)return e;var n=Z.getTime(),i=Math.max(0,n-Y.get().streaming.buffer.bufferToKeep),r=V.getRequests({state:b.FRAGMENT_MODEL_EXECUTED,time:n,threshold:k})[0];if(r)i=Math.min(r.startTime,i);else if(0===n&&Z.getIsDynamic())return[];if(t.start(0)<=i){for(var a={start:0,end:i},o=0;o<t.length&&t.end(o)<=i;o++)a.end=t.end(o);a.start<a.end&&e.push(a)}return e}function ve(e){return new Promise(function(t,n){if(e&&g&&0!==e.length){var i=[];e.forEach(function(e){var t;i.push((t=e,new Promise(function(e,n){t.resolve=e,t.reject=n,I.push(t)})))}),w||ye(),Promise.all(i).then(function(){t()}).catch(function(e){n(e)})}else t()})}function ye(){try{if(0===I.length||!g)return n.debug("Nothing to prune, halt pruning"),I=[],void(w=!1);var e=g.getBuffer();if(!e||!e.buffered||0===e.buffered.length)return n.debug("SourceBuffer is empty (or does not exist), halt pruning"),I=[],void(w=!1);var t=I.shift();n.debug("".concat(W,": Removing buffer from: ").concat(t.start," to ").concat(t.end)),w=!0,Z.getTime()<t.end&&we(!1),g.remove(t).then(function(e){_e(e)}).catch(function(e){_e(e)})}catch(e){w=!1}}function _e(e){n.debug("onRemoved buffer from:",e.from,"to",e.to),g&&(ie(g.getAllBufferRanges()),0===I.length&&(w=!1,de()),e.unintended&&(n.warn("Detected unintended removal from:",e.from,"to",e.to,"setting streamprocessor time to",e.from),Ie(c.Z.SEEK_TARGET,{time:e.from})),w?ye():(M?M=!1:de(),Ie(c.Z.BUFFER_CLEARED,{from:e.from,to:e.to,unintended:e.unintended,hasEnoughSpaceToAppend:xe(),quotaExceeded:A})))}function Ee(e){return new Promise(function(t){e&&void 0!==e.MSETimeOffset&&g&&g.updateTimestampOffset?g.updateTimestampOffset(e.MSETimeOffset).then(function(){t()}).catch(function(){t()}):t()})}function be(){return g&&!i?g.updateAppendWindow(q):Promise.resolve()}function Te(){++S*(Y.get().streaming.wallclockTimeUpdateInterval/1e3)>=Y.get().streaming.buffer.bufferPruningInterval&&(S=0,ge())}function Se(){fe()}function we(e){(i=e)?Ie(c.Z.BUFFERING_COMPLETED):p=Number.POSITIVE_INFINITY}function Ae(){try{var e,t,n=g.getAllBufferRanges(),i=0;if(!n)return i;for(t=0,e=n.length;t<e;t++)i+=n.end(t)-n.start(t);return i}catch(e){return 0}}function Re(e){try{var t=e,n=g.getAllBufferRanges();if(!n||0===n.length)return NaN;for(var i=0;t===e&&i<n.length;){var r=n.start(i),a=n.end(i);t>=r&&t<=a&&(t=a),i+=1}return t===e?NaN:t}catch(e){}}function xe(){var e=Ae();return isNaN(e)||e<o}function Ie(e,t){var n=t||{};B.trigger(e,n,{streamId:q.id,mediaType:W})}function Le(e,t){if(o=Number.POSITIVE_INFINITY,_=void 0,p=Number.POSITIVE_INFINITY,f=0,E=null,i=!1,w=!1,A=!1,r=0,S=0,I=[],P=NaN,v=!1,g){var n=g;g=null,e||t||n.abort().then(function(){n.reset(t),n=null})}M=!1}return t={initialize:function(e){K(e),B.on(c.Z.INIT_FRAGMENT_LOADED,ee,t),B.on(c.Z.MEDIA_FRAGMENT_LOADED,te,t),B.on(c.Z.WALLCLOCK_TIME_UPDATED,Te,t),B.on(h.Z.PLAYBACK_PLAYING,ce,t),B.on(h.Z.PLAYBACK_PROGRESS,se,t),B.on(h.Z.PLAYBACK_TIME_UPDATED,se,t),B.on(h.Z.PLAYBACK_RATE_CHANGED,Se,t),B.on(h.Z.PLAYBACK_STALLED,le,t)},getStreamId:function(){return q.id},getType:function(){return W},getBufferControllerType:function(){return F},createBufferSink:Q,dischargePreBuffer:function(){if(g&&m&&"function"==typeof m.discharge){var e=m.getAllBufferRanges();if(e.length>0){for(var t="Beginning "+W+"PreBuffer discharge, adding buffer for:",i=0;i<e.length;i++)t+=" start: "+e.start(i)+", end: "+e.end(i)+";";n.debug(t)}else n.debug("PreBuffer discharge requested, but there were no media segments in the PreBuffer.");y=[];for(var r=m.discharge(),a=null,o=0;o<r.length;o++){var s=r[o];if(s.segmentType!==L.w.INIT_SEGMENT_TYPE){var l=R.extract(s.streamId,s.representationId);l&&a!==l&&(y.push(l),g.append(l),a=l)}y.push(s),g.append(s)}m.reset(),m=null}},getBuffer:function(){return g},getBufferLevel:function(){return r},getRangeAt:ue,hasBufferAtTime:function(e){try{var t=g.getAllBufferRanges();if(!t||0===t.length)return!1;for(var i=0;i<t.length;){var r=t.start(i),a=t.end(i);if(e>=r&&e<=a)return!0;i+=1}return!1}catch(e){return n.error(e),!1}},pruneBuffer:ge,setMediaSource:K,getMediaSource:function(){return u},appendInitSegmentFromCache:function(e){var t=R.extract(q.id,e);return!!t&&(n.info("Append Init fragment",W," with representationId:",t.representationId," and quality:",t.quality,", data size:",t.bytes.byteLength),ne(t),!0)},getIsBufferingCompleted:function(){return i},setIsBufferingCompleted:we,getIsPruningInProgress:function(){return w},reset:function(e,t){B.off(c.Z.INIT_FRAGMENT_LOADED,ee,this),B.off(c.Z.MEDIA_FRAGMENT_LOADED,te,this),B.off(c.Z.WALLCLOCK_TIME_UPDATED,Te,this),B.off(h.Z.PLAYBACK_PLAYING,ce,this),B.off(h.Z.PLAYBACK_PROGRESS,se,this),B.off(h.Z.PLAYBACK_TIME_UPDATED,se,this),B.off(h.Z.PLAYBACK_RATE_CHANGED,Se,this),B.off(h.Z.PLAYBACK_STALLED,le,this),Le(e,t)},prepareForPlaybackSeek:function(){return i&&we(!1),g.abort()},prepareForReplacementTrackSwitch:function(e){return new Promise(function(t,n){g.abort().then(function(){return be()}).then(function(){return Y.get().streaming.buffer.useChangeTypeForTrackSwitch?g.changeType(e):Promise.resolve()}).then(function(){return ae()}).then(function(){we(!1),t()}).catch(function(e){n(e)})})},prepareForNonReplacementTrackSwitch:function(e){return new Promise(function(t,n){be().then(function(){return Y.get().streaming.buffer.useChangeTypeForTrackSwitch?g.changeType(e):Promise.resolve()}).then(function(){t()}).catch(function(e){n(e)})})},prepareForForceReplacementQualitySwitch:function(e){return new Promise(function(t,n){g.abort().then(function(){return be()}).then(function(){return ae()}).then(function(){return Ee(e)}).then(function(){we(!1),t()}).catch(function(e){n(e)})})},updateAppendWindow:be,getAllRangesWithSafetyFactor:oe,getContinuousBufferTimeForTargetTime:Re,clearBuffers:ve,pruneAllSafely:ae,updateBufferTimestampOffset:Ee,setSeekTarget:function(e){P=e},segmentRequestingCompleted:function(e){isNaN(e)||(p=e,he())}},n=(0,d.Z)(O).getInstance().getLogger(t),R=N(O).getInstance(),Le(),t}B.__dashjs_factory_name=F;var U=u.Z.getClassFactory(B),V="NotFragmentedTextBufferController";function G(e){e=e||{};var t,n,i,r,a,o,s=this.context,u=(0,l.Z)(s).getInstance(),d=e.textController,h=e.errHandler,f=e.streamInfo,p=e.type;function g(e){r=e}function m(e){var t,i;n!==e&&(n=e)&&(t=c.Z.BUFFERING_COMPLETED,i={},u.trigger(t,i,{streamId:f.id,mediaType:p}))}function v(e){e.chunk.bytes&&!n&&(o.save(e.chunk),a.append(e.chunk),m(!0))}return t={initialize:function(e){g(e)},getStreamId:function(){return f.id},getType:function(){return p},getBufferControllerType:function(){return V},createBufferSink:function(e){return new Promise(function(t,n){try{(a=C(s).create({mediaSource:r,textController:d,eventBus:u})).initializeForFirstUse(f,e),i||(a.getBuffer()&&"function"==typeof a.getBuffer().initialize&&a.getBuffer().initialize(),i=!0),t(a)}catch(e){h.error(new T.Z(x.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,x.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+p)),n(e)}})},dischargePreBuffer:function(){},getBuffer:function(){return a},getBufferLevel:function(){return 0},getRangeAt:function(){return null},pruneBuffer:function(){},hasBufferAtTime:function(){return!0},getAllRangesWithSafetyFactor:function(){return[]},getContinuousBufferTimeForTargetTime:function(){return Number.POSITIVE_INFINITY},setMediaSource:g,getMediaSource:function(){return r},appendInitSegmentFromCache:function(e){return null!==o.extract(f.id,e)},getIsBufferingCompleted:function(){return n},setIsBufferingCompleted:m,getIsPruningInProgress:function(){return!1},reset:function(e){u.off(c.Z.INIT_FRAGMENT_LOADED,v,t),!e&&a&&(a.abort(),a.reset(),a=null)},clearBuffers:function(){return Promise.resolve()},prepareForPlaybackSeek:function(){return Promise.resolve()},prepareForReplacementTrackSwitch:function(){return n=!1,Promise.resolve()},setSeekTarget:function(){},updateAppendWindow:function(){return Promise.resolve()},pruneAllSafely:function(){return Promise.resolve()},updateBufferTimestampOffset:function(){return Promise.resolve()},segmentRequestingCompleted:function(){}},i=!1,r=null,n=!1,o=N(s).getInstance(),u.on(c.Z.INIT_FRAGMENT_LOADED,v,t),t}G.__dashjs_factory_name=V;var H=u.Z.getClassFactory(G);function j(e){e=e||{};var t,n,i,r,o,u,f,p,g,m,v,y,_,E=this.context,T=(0,l.Z)(E).getInstance(),S=e.dashMetrics,w=e.mediaPlayerModel,A=e.fragmentModel,R=e.abrController,x=e.playbackController,I=e.textController,L=e.type,M=e.bufferController,C=e.representationController,P=e.settings;function D(){y=!0}function O(){y=!1}function N(e){if(!M.getIsBufferingCompleted()){k();var t=isNaN(e)?0:e;o=setTimeout(F,t)}}function k(){o&&(clearTimeout(o),o=null)}function F(){try{if(function(){try{return L===a.Z.TEXT&&!I.isTextEnabled()||x.isPaused()&&(!x.getStreamController().getInitialPlayback()||!x.getStreamController().getAutoPlay())&&!P.get().streaming.scheduling.scheduleWhilePaused}catch(e){return!1}}())return void k();if(function(){try{return!!y&&C.getCurrentRepresentationInfo()&&(isNaN(g)||m||(t=n.id,r=R.getMaxAllowedIndexFor(L,t),!(!isNaN(p)&&p==r||(i.info("Top quality "+L+" index has changed from "+p+" to "+r),p=r,0)))||(e=C.getCurrentRepresentationInfo(),!L||!e||S.getCurrentBufferLevel(L)<B()))}catch(e){return!1}var e,t,r}()){var e=!1;_&&(e=R.checkPlaybackQuality(L,n.id)),e||(r=C.getCurrentRepresentationInfo(),v||r.quality!==g||m?(m?(i.debug("Switch track for "+L+", representation id = "+r.id),m=!1):i.debug("Quality has changed, get init request for representationid = "+r.id),T.trigger(c.Z.INIT_FRAGMENT_NEEDED,{representationId:r.id,sender:t},{streamId:n.id,mediaType:L}),_=!1,v=!1):(i.debug("Media segment needed for ".concat(L," and stream id ").concat(n.id)),T.trigger(c.Z.MEDIA_FRAGMENT_NEEDED,{},{streamId:n.id,mediaType:L}),_=!0))}else N(x.getLowLatencyModeEnabled()?P.get().streaming.scheduling.lowLatencyTimeout:P.get().streaming.scheduling.defaultTimeout)}catch(e){N(x.getLowLatencyModeEnabled()?P.get().streaming.scheduling.lowLatencyTimeout:P.get().streaming.scheduling.defaultTimeout)}var r}function B(){var e=NaN,t=C.getCurrentRepresentationInfo();return L&&t&&(e=L===a.Z.TEXT?function(){try{if(I.isTextEnabled()){var e=C.getCurrentRepresentationInfo();if(isNaN(e.fragmentDuration)){var t=S.getCurrentSchedulingInfo(s.Z.SCHEDULING_INFO);return t?t.duration:0}return e.fragmentDuration}return 0}catch(e){return 0}}():L===a.Z.AUDIO&&u?function(){try{var e=S.getCurrentBufferLevel(a.Z.VIDEO),t=C.getCurrentRepresentationInfo();return isNaN(t.fragmentDuration)?e+1:Math.max(e+1,t.fragmentDuration)}catch(e){return 0}}():function(){try{var e=C.getCurrentRepresentationInfo().mediaInfo.streamInfo;return R.isPlayingAtTopQuality(e)?e.manifestInfo.duration>=P.get().streaming.buffer.longFormContentDurationThreshold?P.get().streaming.buffer.bufferTimeAtTopQualityLongForm:P.get().streaming.buffer.bufferTimeAtTopQuality:w.getStableBufferTime()}catch(e){return w.getStableBufferTime()}}()),e}function U(){V(!0)}function V(e){if(x&&A){var t=A.getRequests({state:b.FRAGMENT_MODEL_EXECUTED,time:x.getTime(),threshold:0})[0];t&&x.getTime()>=t.startTime&&((!f.mediaInfo||t.mediaInfo.type===f.mediaInfo.type&&t.mediaInfo.index!==f.mediaInfo.index)&&e&&T.trigger(c.Z.TRACK_CHANGE_RENDERED,{mediaType:L,oldMediaInfo:f.mediaInfo,newMediaInfo:t.mediaInfo,streamId:n.id}),t.quality===f.quality&&t.adaptationIndex===f.adaptationIndex||!e||(i.debug("Quality change rendered for streamId ".concat(n.id," and type ").concat(L)),T.trigger(c.Z.QUALITY_CHANGE_RENDERED,{mediaType:L,oldQuality:f.quality,newQuality:t.quality,streamId:n.id})),f={mediaInfo:t.mediaInfo,quality:t.quality,adaptationIndex:t.adaptationIndex})}}function G(){A.abortRequests(),k()}function H(){P.get().streaming.scheduling.scheduleWhilePaused||N()}function j(e){S.updatePlayListTraceMetrics({playbackspeed:e.playbackRate.toString()})}function z(){_=!0,r=0,g=NaN,f={mediaInfo:void 0,quality:NaN,adaptationIndex:NaN},p=NaN,m=!1,v=!1,y=!0}return t={initialize:function(e){u=e,T.on(c.Z.URL_RESOLUTION_FAILED,G,t),T.on(h.Z.PLAYBACK_STARTED,H,t),T.on(h.Z.PLAYBACK_RATE_CHANGED,j,t),T.on(h.Z.PLAYBACK_TIME_UPDATED,U,t),T.on(h.Z.MANAGED_MEDIA_SOURCE_START_STREAMING,D,t),T.on(h.Z.MANAGED_MEDIA_SOURCE_END_STREAMING,O,t)},getType:function(){return L},getStreamId:function(){return n.id},setTimeToLoadDelay:function(e){r=e},getTimeToLoadDelay:function(){return r},setSwitchTrack:function(e){m=e},getSwitchTrack:function(){return m},startScheduleTimer:N,clearScheduleTimer:k,reset:function(){T.off(c.Z.URL_RESOLUTION_FAILED,G,t),T.off(h.Z.PLAYBACK_STARTED,H,t),T.off(h.Z.PLAYBACK_RATE_CHANGED,j,t),T.off(h.Z.PLAYBACK_TIME_UPDATED,U,t),T.off(h.Z.MANAGED_MEDIA_SOURCE_START_STREAMING,D,t),T.off(h.Z.MANAGED_MEDIA_SOURCE_END_STREAMING,O,t),k(),V(!1),z(),n=null},getBufferTarget:B,getPlaybackController:function(){return x},setCheckPlaybackQuality:function(e){_=e},setInitSegmentRequired:function(e){v=e},setLastInitializedQuality:function(e){g=e}},i=(0,d.Z)(E).getInstance().getLogger(t),z(),n=e.streamInfo,t}j.__dashjs_factory_name="ScheduleController";var z=u.Z.getClassFactory(j),Z=n(7387);function q(e){var t,n,i,r,o,s,l=(e=e||{}).eventBus,c=e.events,u=e.abrController,d=e.dashMetrics,f=e.playbackController,p=e.timelineConverter,g=e.type,m=e.streamInfo,v=e.dashConstants,y=e.segmentsController,_=e.isDynamic,E=e.adapter;function b(){return g}function T(){return i}function S(){return s}function w(){n=null,i=!0,r=[],o=null}function A(e){return new Promise(function(t,n){var i=e.hasInitialization(),a=e.hasSegments(),o=[];o.push(y.updateInitData(e,i)),o.push(y.updateSegmentData(e,a)),Promise.all(o).then(function(n){var i,a,o;n[0]&&!n[0].error&&(a=e,o=n[0],e=o&&!o.error&&o.representation?o.representation:a),n[1]&&!n[1].error&&(e=function(e,t){if(t&&!t.error){var n,i,r,a,o=t.segments,s=[],l=0;for(n=0,i=o?o.length:0;n<i;n++)r=o[n],(a=(0,Z.TJ)(p,_,e,r.startTime,r.duration,r.timescale,r.media,r.mediaRange,l))&&(s.push(a),a=null,l++);return s.length>0&&(e.segments=s),e}}(e,n[1])),(i=e).mediaFinishedInformation=y.getMediaFinishedInformation(i),function(e){if(T()){var t,n,i=d.getCurrentManifestUpdate(),a=!1;if(i){for(var o=0;o<i.representationInfo.length;o++)if((t=i.representationInfo[o]).index===e.index&&t.mediaType===b()){a=!0;break}a||d.addManifestUpdateRepresentationInfo(e,b())}if(function(){for(var e=0,t=r.length;e<t;e++){var n=r[e].segmentInfoType;if(!r[e].hasInitialization()||(n===v.SEGMENT_BASE||n===v.BASE_URL)&&!r[e].segments)return!1}return!0}()){u.setPlaybackQuality(g,m,(n=s,r.indexOf(n)));var l=d.getCurrentDVRInfo(g);l&&d.updateManifestUpdateInfo({latency:l.range.end-f.getTime()}),d.getCurrentRepresentationSwitch(S().adaptation.type)||R(),I()}}}(e),t()}).catch(function(e){n(e)})})}function R(){!function(){if(!(u&&d&&f&&p))throw new Error(a.Z.MISSING_CONFIG_ERROR)}();var e=new Date,t=S(),n=1e3*f.getTime();t&&d.addRepresentationSwitch(t.adaptation.type,e,n,t.id),l.trigger(h.Z.REPRESENTATION_SWITCH,{mediaType:g,streamId:m.id,currentRepresentation:t,numberOfRepresentations:r.length},{streamId:m.id,mediaType:g})}function x(e){return null==e||e>=r.length?null:r[e]}function I(e){i=!1,l.trigger(c.DATA_UPDATE_COMPLETED,{data:n,currentRepresentation:s,error:e},{streamId:m.id,mediaType:g})}function L(e){s=e,o=E.convertRepresentationToRepresentationInfo(s)}function M(e){if(e.newDuration){var t=S();t&&t.adaptation.period&&(t.adaptation.period.duration=e.newDuration)}}return t={getStreamId:function(){return m.id},getType:b,getData:function(){return n},isUpdating:T,updateData:function(e,t,o,s,l){return new Promise(function(c,u){if(i=!0,r=t,n=e,L(x(l)),o!==a.Z.VIDEO&&o!==a.Z.AUDIO&&(o!==a.Z.TEXT||!s))return I(),void c();for(var d=[],h=0,f=r.length;h<f;h++){var p=r[h];d.push(A(p))}Promise.all(d).then(function(){L(x(l)),c()}).catch(function(e){u(e)})})},getCurrentRepresentation:S,getCurrentRepresentationInfo:function(){return o},getRepresentationForQuality:x,prepareQualityChange:function(e){L(x(e)),R()},reset:function(){l.off(h.Z.MANIFEST_VALIDITY_CHANGED,M,t),w()}},w(),l.on(h.Z.MANIFEST_VALIDITY_CHANGED,M,t),t}q.__dashjs_factory_name="RepresentationController";var W=u.Z.getClassFactory(q),Y=n(3106),K=n(9326),X=n(7473),Q=n(2594);function J(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var $=function e(){J(this,e),this.start=null,this.mstart=null,this.starttype=null,this.trace=[]};$.INITIAL_PLAYOUT_START_REASON="initial_playout",$.SEEK_START_REASON="seek",$.RESUME_FROM_PAUSE_START_REASON="resume",$.METRICS_COLLECTION_START_REASON="metrics_collection_start";var ee=function e(){J(this,e),this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null};ee.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",ee.REBUFFERING_REASON="rebuffering",ee.USER_REQUEST_STOP_REASON="user_request",ee.END_OF_PERIOD_STOP_REASON="end_of_period",ee.END_OF_CONTENT_STOP_REASON="end_of_content",ee.METRICS_COLLECTION_STOP_REASON="metrics_collection_end",ee.FAILURE_STOP_REASON="failure";var te=n(7802);function ne(){return{ntpToUTC:function(e){var t=new Date(Date.UTC(1900,0,1,0,0,0));return new Date(t.getTime()+e).getTime()}}}ne.__dashjs_factory_name="TimeUtils";var ie=u.Z.getSingletonFactory(ne);function re(e){e=e||{};var t,n,i,r,u,f,p,g,m,v,y,_,E,S,w,A=this.context,R=(0,l.Z)(A).getInstance(),I=e.streamInfo,M=e.type,C=e.errHandler,P=e.mimeType,D=e.timelineConverter,O=e.adapter,N=e.manifestModel,k=e.mediaPlayerModel,F=e.fragmentModel,B=e.abrController,V=e.playbackController,G=e.mediaController,j=e.textController,Z=e.dashMetrics,q=e.settings,J=e.boxParser,$=e.segmentBlacklistController;function ne(){return I.id}function re(){return M}function ae(){return O.getIsTextTrack(g.getData())}function oe(){u=[],r=null,S=0,m=!1,v=!1,y=!1,w=null}function se(e){return!isNaN(e)&&!isNaN(I.duration)&&isFinite(I.duration)&&e>=I.start+I.duration}function le(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.sender)if(V.getIsManifestUpdateInProgress())fe();else if((!ae()||j.isTextEnabled())&&f&&e.representationId&&!f.appendInitSegmentFromCache(e.representationId)){var n=g.getCurrentRepresentation();if(0===n.range)return void ce();var i=_?_.getInitRequest(r,n):null;i?F.executeRequest(i):t&&(p.setInitSegmentRequired(!0),fe())}}function ce(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(V.getIsManifestUpdateInProgress()||f.getIsPruningInProgress())fe();else{var n=he();n?(m=!1,v=!1,ue(n)):de(t)}}function ue(e){var t,i;isNaN(e.startTime+e.duration)||(S=e.startTime+e.duration),e.delayLoadingTime=(new Date).getTime()+p.getTimeToLoadDelay(),p.setTimeToLoadDelay(0),i=(t=e).url,t.range&&(i=i.concat("_",t.range)),$.contains(i)?(n.warn("Fragment request url ".concat(e.url," for stream id ").concat(I.id," and media type ").concat(M," is on the ignore list and will be skipped")),fe()):(n.debug("Next fragment request url for stream id ".concat(I.id," and media type ").concat(M," is ").concat(e.url)),F.executeRequest(e))}function de(e){var t,a=g.getCurrentRepresentation();if(!q.get().streaming.gaps.enableSeekFix||!m&&0!==V.getTime()||(i?i&&a.segmentInfoType===o.Z.SEGMENT_TIMELINE&&(t=_.getValidTimeAheadOfTargetTime(S,r,a,q.get().streaming.gaps.threshold)):t=_.getValidTimeAheadOfTargetTime(S,r,a,q.get().streaming.gaps.threshold),isNaN(t)||t===S)){if(_.isLastSegmentRequested(a,S)){var s=_.getCurrentIndex();return n.debug("Segment requesting for stream ".concat(I.id," has finished")),R.trigger(c.Z.STREAM_REQUESTING_COMPLETED,{segmentIndex:s},{streamId:I.id,mediaType:M}),f.segmentRequestingCompleted(s),void p.clearScheduleTimer()}e&&fe()}else V.isSeeking()||0===V.getTime()?(n.warn("Adjusting playback time ".concat(t," because of gap in the manifest. Seeking by ").concat(t-S)),V.seek(t,!1,!1)):(n.warn("Adjusting buffering time ".concat(t," because of gap in the manifest. Adjusting time by ").concat(t-S)),Ne(t),e&&fe())}function he(){var e,t=Ie();if(isNaN(S)||re()===a.Z.TEXT&&!j.isTextEnabled())return null;if(_){var n=g&&t?g.getRepresentationForQuality(t.quality):null;e=m?_.getSegmentRequestForTime(r,n,S):v?_.repeatSegmentRequest(r,n):_.getNextSegmentRequest(r,n)}return e}function fe(){p.startScheduleTimer(V.getLowLatencyModeEnabled()?q.get().streaming.scheduling.lowLatencyTimeout:q.get().streaming.scheduling.defaultTimeout)}function pe(e){e.error||f.getIsBufferingCompleted()||f.updateBufferTimestampOffset(e.currentRepresentation)}function ge(e){Z.addBufferState(M,e.state,p.getBufferTarget()),e.state!==s.Z.BUFFER_EMPTY||V.isSeeking()||(n.info("Buffer is empty! Stalling!"),Z.pushPlayListTraceMetrics(new Date,ee.REBUFFERING_REASON))}function me(e){F.syncExecutedRequestsWithBufferedRange(f.getBuffer().getAllBufferRanges(),I.duration),e.quotaExceeded&&e.from>V.getTime()&&Ne(e.from),e.hasEnoughSpaceToAppend&&e.quotaExceeded&&p.startScheduleTimer()}function ve(e){if(e&&e.lastRequestAppended&&e.lastRequestAppended.url){var t=e.lastRequestAppended.url;e.lastRequestAppended.range&&(t=t.concat("_",e.lastRequestAppended.range)),n.warn("Blacklisting segment with url ".concat(t)),$.add(t)}}function ye(e){if(n.debug("Appended bytes for ".concat(e.mediaType," and stream id ").concat(e.streamId)),e.segmentType===L.w.INIT_SEGMENT_TYPE){var t=e.quality;p.setLastInitializedQuality(t),n.info("["+M+"] lastInitializedRepresentationInfo changed to "+e.quality)}w?_e(w):p.startScheduleTimer(0)}function _e(e){var t=F.getRequests({state:b.FRAGMENT_MODEL_LOADING});if(t&&t.length>0)return n.debug("Preparing for default quality switch: Waiting for ongoing segment request to be finished before applying switch."),void(w=e);f.updateBufferTimestampOffset(e).then(function(){p.setCheckPlaybackQuality(!1),r.segmentAlignment||r.subSegmentAlignment?p.startScheduleTimer():De(),w=null,y=!1}).catch(function(){w=null,y=!1})}function Ee(e){n.info("onFragmentLoadingAbandoned request: "+e.request.url+" has been aborted"),V.isSeeking()||p.getSwitchTrack()||y||(n.info("onFragmentLoadingAbandoned request: "+e.request.url+" has to be downloaded again, origin is not seeking process or switch track call"),e.request&&e.request.isInitializationRequest()?p.setInitSegmentRequired(!0):Ne(e.request.startTime+e.request.duration/2),p.startScheduleTimer(0))}function be(e){var t;n.info("OnFragmentLoadingCompleted for stream id "+I.id+" and media type "+M+" - Url:",e.request?e.request.url:"undefined",e.request.range?", Range:"+e.request.range:""),ae()&&p.startScheduleTimer(0),e.error&&e.request.serviceLocation&&(t=e,n.info("Fragment loading completed with an error"),t&&t.request&&t.request.type&&(t.request.type===L.w.INIT_SEGMENT_TYPE?le({representationId:t.request.representationId,sender:{}},!1):t.request.type===L.w.MEDIA_SEGMENT_TYPE&&(Ne(t.request.startTime+t.request.duration/2),ce({},!1))))}function Te(){Ne(V.getTime()),xe().startScheduleTimer()}function Se(e){var t=e.currentTrackInfo;if(t){var n=u.find(function(e){return e.index===t.index&&e.lang===t.lang});n&&Re(n).then(function(){f.setIsBufferingCompleted(!1),Ne(V.getTime()),p.setInitSegmentRequired(!0),p.startScheduleTimer()})}}function we(e){Ne(e.quotaExceededTime),p.clearScheduleTimer()}function Ae(){return f?f.getBuffer():null}function Re(e){e===r||e&&r&&e.type!==r.type||(r=e);var t=O.getRealAdaptation(I,r),n=O.getVoRepresentations(r);if(g){var o,s=g.getData(),l=B.getMaxAllowedIndexFor(M,I.id),c=B.getMinAllowedIndexFor(M,I.id),u=null;return null!==s&&s.id===t.id||M===a.Z.TEXT?o=B.getQualityFor(M,I.id):(u=B.getThroughputHistory().getAverageThroughput(M,i)||B.getInitialBitrateFor(M,I.id),o=B.getQualityForBitrate(r,u,I.id)),void 0!==c&&o<c&&(o=c),o>l&&(o=l),g.updateData(t,n,M,r.isFragmented,o)}return Promise.resolve()}function xe(){return p}function Ie(e){var t;return void 0!==e?((0,Y.SE)(e),t=g?g.getRepresentationForQuality(e):null):t=g?g.getCurrentRepresentation():null,O.convertRepresentationToRepresentationInfo(t)}function Le(){return!!f&&f.getIsBufferingCompleted()}function Me(e){if(q.get().streaming.enableManifestTimescaleMismatchFix){var t=e.chunk,n=t.bytes,i=Ie(t.quality),r=g&&i?g.getRepresentationForQuality(i.quality):null;i&&r&&(r.timescale=J.getMediaTimescaleFromMoov(n))}}function Ce(e){var t,n,i,r,a=e.chunk,s=a.bytes,l=a.quality,u=Ie(l),d=g&&u?g.getRepresentationForQuality(u.quality):null;if(u&&d){var f;if(q.get().streaming.parseInbandPrft&&e.request.type===L.w.MEDIA_SEGMENT_TYPE){var p=(t=f=f||J.parse(s),n=d.timescale,i=t.getBoxes("prft"),r=[],i.forEach(function(e){r.push(function(e,t){var n="unknown";switch(e.flags){case 0:n=o.Z.PRODUCER_REFERENCE_TIME_TYPE.ENCODER;break;case 16:n=o.Z.PRODUCER_REFERENCE_TIME_TYPE.APPLICATION;break;case 24:n=o.Z.PRODUCER_REFERENCE_TIME_TYPE.CAPTURED}var i=1e3*e.ntp_timestamp_sec+e.ntp_timestamp_frac/Math.pow(2,32)*1e3;return{type:n,ntpTimestamp:i=ie(A).getInstance().ntpToUTC(i),mediaTime:e.media_time/t}}(e,n))}),r);p&&p.length&&R.trigger(h.Z.INBAND_PRFT,{data:p},{streamId:I.id,mediaType:M})}var m=O.getEventsFor(u.mediaInfo,null,I),v=O.getEventsFor(u,d,I);if(m&&m.length>0||v&&v.length>0){var y=F.getRequests({state:b.FRAGMENT_MODEL_EXECUTED,quality:l,index:a.index})[0],_=function(e,t,n,i){try{for(var r={},a=[],o=n.concat(i),s=0,l=o.length;s<l;s++)r[o[s].schemeIdUri+"/"+o[s].value]=o[s];var c=e.getBoxes("emsg");if(!c||0===c.length)return a;for(var u=e.getBox("sidx"),d=!u||isNaN(u.earliest_presentation_time)||isNaN(u.timescale)?t&&!isNaN(t.mediaStartTime)?t.mediaStartTime:0:u.earliest_presentation_time/u.timescale,h=Math.max(d,0),f=g.getCurrentRepresentation(),p=0,m=c.length;p<m;p++){var v=O.getEvent(c[p],r,h,f);v&&a.push(v)}return a}catch(e){return[]}}(f=f||J.parse(s),y,m,v);R.trigger(c.Z.INBAND_EVENTS,{events:_},{streamId:I.id})}}}function Pe(){var e=V.getTime();q.get().streaming.buffer.flushBufferAtTrackSwitch&&V.seek(e+.001,!1,!0),Ne(e),f.setSeekTarget(e),p.startScheduleTimer()}function De(){var e=V.getTime(),t=f.getContinuousBufferTimeForTargetTime(e);Ne(isNaN(t)?e:t),p.startScheduleTimer()}function Oe(e){e&&!isNaN(e.time)&&(Ne(e.time),f.setSeekTarget(e.time))}function Ne(e){S=e,m=!0}return t={initialize:function(n,r,s){var l,u;E=(0,te.Z)(A).create({events:c.Z,eventBus:R,streamInfo:I,timelineConverter:D,dashConstants:o.Z,segmentBaseController:e.segmentBaseController,type:M}),_=(0,K.Z)(A).create({streamInfo:I,type:M,timelineConverter:D,dashMetrics:Z,mediaPlayerModel:k,baseURLController:e.baseURLController,errHandler:C,segmentsController:E,settings:q,boxParser:J,events:c.Z,eventBus:R,errors:x,debug:(0,d.Z)(A).getInstance(),requestModifier:(0,X.Z)(A).getInstance(),dashConstants:o.Z,constants:a.Z,urlUtils:(0,Q.Z)(A).getInstance()}),i=I.manifestInfo.isDynamic,_.initialize(i),B.registerStreamType(M,t),g=W(A).create({streamInfo:I,type:M,abrController:B,dashMetrics:Z,playbackController:V,timelineConverter:D,dashConstants:o.Z,events:c.Z,eventBus:R,errors:x,isDynamic:i,adapter:O,segmentsController:E}),u=s,(f=(l=M)?l!==a.Z.TEXT||u?U(A).create({streamInfo:I,type:l,mediaPlayerModel:k,manifestModel:N,fragmentModel:F,errHandler:C,mediaController:G,representationController:g,adapter:O,textController:j,abrController:B,playbackController:V,settings:q}):H(A).create({streamInfo:I,type:l,mimeType:P,fragmentModel:F,textController:j,errHandler:C,settings:q}):(C.error(new T.Z(x.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,x.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+"not properly defined")),null))&&f.initialize(n),(p=z(A).create({streamInfo:I,type:M,mimeType:P,adapter:O,dashMetrics:Z,mediaPlayerModel:k,fragmentModel:F,abrController:B,playbackController:V,textController:j,mediaController:G,bufferController:f,representationController:g,settings:q})).initialize(r),S=0,m=!1,v=!1},getStreamId:ne,getType:re,isUpdating:function(){return!!g&&g.isUpdating()},getBufferController:function(){return f},dischargePreBuffer:function(){f.dischargePreBuffer()},getFragmentModel:function(){return F},getScheduleController:xe,getRepresentationController:function(){return g},getRepresentationInfo:Ie,getBufferLevel:function(){return f?f.getBufferLevel():0},isBufferingCompleted:Le,createBufferSinks:function(e){var t=Ae();return t?Promise.resolve(t):f?f.createBufferSink(r,e):Promise.resolve(null)},updateStreamInfo:function(e){return I=e,Le()?Promise.resolve():f.updateAppendWindow()},getStreamInfo:function(){return I},selectMediaInfo:Re,clearMediaInfoArray:function(){u=[]},addMediaInfo:function(e){-1===u.indexOf(e)&&u.push(e)},prepareTrackSwitch:function(){return new Promise(function(e){n.debug("Preparing track switch for type ".concat(M));var t=M===a.Z.TEXT||q.get().streaming.trackSwitchMode[M]===a.Z.TRACK_SWITCH_MODE_ALWAYS_REPLACE&&V.getTimeToStreamEnd(I)>q.get().streaming.buffer.stallThreshold;if(f.getIsBufferingCompleted()&&!t)return f.prepareForNonReplacementTrackSwitch(r.codec).then(function(){R.trigger(c.Z.BUFFERING_COMPLETED,{},{streamId:I.id,mediaType:M})}).catch(function(){R.trigger(c.Z.BUFFERING_COMPLETED,{},{streamId:I.id,mediaType:M})}),void e();p.clearScheduleTimer(),p.setSwitchTrack(!0),t?(R.trigger(c.Z.BUFFER_REPLACEMENT_STARTED,{mediaType:M,streamId:I.id},{mediaType:M,streamId:I.id}),F.abortRequests(),f.prepareForReplacementTrackSwitch(r.codec).then(function(){var e=Ie();return f.updateBufferTimestampOffset(e)}).then(function(){Pe(),e()}).catch(function(){Pe(),e()})):f.prepareForNonReplacementTrackSwitch(r.codec).then(function(){De(),e()}).catch(function(){De(),e()})})},prepareQualityChange:function(e){w&&n.warn("Canceling queued representation switch to ".concat(w.quality," for ").concat(M)),n.debug("Preparing quality switch for type ".concat(M));var t=e.newQuality;y=!0,p.clearScheduleTimer(),g.prepareQualityChange(t);var i,r=Ie(t);e.reason&&e.reason.forceReplace?(i=r,F.abortRequests(),R.trigger(c.Z.BUFFER_REPLACEMENT_STARTED,{mediaType:M,streamId:I.id},{mediaType:M,streamId:I.id}),p.setCheckPlaybackQuality(!1),f.prepareForForceReplacementQualitySwitch(i).then(function(){Pe(),w=null,y=!1}).catch(function(){Pe(),w=null,y=!1})):e&&e.reason&&e.reason.forceAbandon?function(e){f.updateBufferTimestampOffset(e).then(function(){F.abortRequests(),v=!0,p.setCheckPlaybackQuality(!1),p.startScheduleTimer(),y=!1,w=null}).catch(function(){w=null,y=!1})}(r):q.get().streaming.buffer.fastSwitchEnabled?function(e){var t=V.getTime(),n=1.5*(isNaN(e.fragmentDuration)?1:e.fragmentDuration),i=F.getRequests({state:b.FRAGMENT_MODEL_EXECUTED,time:t+n,threshold:0})[0];if(i&&!ae()){var r=f.getBufferLevel(),a=B.getAbandonmentStateFor(I.id,M);i.quality<e.quality&&r>=n&&a!==s.Z.ABANDON_LOAD?f.updateBufferTimestampOffset(e).then(function(){F.abortRequests(),Ne(t+n),p.setCheckPlaybackQuality(!1),p.startScheduleTimer(),y=!1}).catch(function(){y=!1}):_e(e)}else _e(e)}(r):_e(r),Z.pushPlayListTraceMetrics(new Date,ee.REPRESENTATION_SWITCH_STOP_REASON),Z.createPlaylistTraceMetrics(r.id,1e3*V.getTime(),V.getPlaybackRate())},getMediaInfo:function(){return r},getMediaSource:function(){return f.getMediaSource()},setMediaSource:function(e){return f.setMediaSource(e,r)},getBuffer:Ae,setExplicitBufferingTime:Ne,finalisePlayList:function(e,t){Z.pushPlayListTraceMetrics(e,t)},probeNextRequest:function(){var e=Ie(),t=g&&e?g.getRepresentationForQuality(e.quality):null;return _.getNextSegmentRequestIdempotent(r,t)},prepareInnerPeriodPlaybackSeeking:function(e){return new Promise(function(t){if(f.hasBufferAtTime(e.seekTime))return f.pruneBuffer(),se(f.getContinuousBufferTimeForTargetTime(e.seekTime))&&f.setIsBufferingCompleted(!0),void t();p.clearScheduleTimer(),F.abortRequests(),f.prepareForPlaybackSeek().then(function(){var t=f.getAllRangesWithSafetyFactor(e.seekTime);return f.clearBuffers(t)}).then(function(){var n=f.getContinuousBufferTimeForTargetTime(e.seekTime);if(se(n))f.setIsBufferingCompleted(!0),t();else{var i=isNaN(n)?e.seekTime:n;Ne(i),f.setSeekTarget(i);var r=[];r.push(f.updateAppendWindow());var a=Ie();r.push(f.updateBufferTimestampOffset(a)),Promise.all(r).then(function(){p.setInitSegmentRequired(!0),p.setCheckPlaybackQuality(!1),p.startScheduleTimer(),t()})}}).catch(function(e){n.error(e)})})},prepareOuterPeriodPlaybackSeeking:function(){return new Promise(function(e,t){try{p.clearScheduleTimer(),F.abortRequests(),f.prepareForPlaybackSeek().then(function(){return f.pruneAllSafely()}).then(function(){e()})}catch(e){t(e)}})},reset:function(e,n){_&&_.reset(),f&&(f.reset(e,n),f=null),p&&(p.reset(),p=null),g&&(g.reset(),g=null),E&&(E=null),B&&B.unRegisterStreamType(ne(),M),R.off(c.Z.DATA_UPDATE_COMPLETED,pe,t),R.off(c.Z.INIT_FRAGMENT_NEEDED,le,t),R.off(c.Z.MEDIA_FRAGMENT_NEEDED,ce,t),R.off(c.Z.INIT_FRAGMENT_LOADED,Me,t),R.off(c.Z.MEDIA_FRAGMENT_LOADED,Ce,t),R.off(c.Z.BUFFER_LEVEL_STATE_CHANGED,ge,t),R.off(c.Z.BUFFER_CLEARED,me,t),R.off(c.Z.SEEK_TARGET,Oe,t),R.off(c.Z.FRAGMENT_LOADING_ABANDONED,Ee,t),R.off(c.Z.FRAGMENT_LOADING_COMPLETED,be,t),R.off(c.Z.SET_FRAGMENTED_TEXT_AFTER_DISABLED,Te,t),R.off(c.Z.SET_NON_FRAGMENTED_TEXT,Se,t),R.off(c.Z.QUOTA_EXCEEDED,we,t),R.off(c.Z.SOURCE_BUFFER_ERROR,ve,t),R.off(c.Z.BYTES_APPENDED_END_FRAGMENT,ye,t),oe(),M=null,I=null}},n=(0,d.Z)(A).getInstance().getLogger(t),oe(),R.on(c.Z.DATA_UPDATE_COMPLETED,pe,t,{priority:l.Z.EVENT_PRIORITY_HIGH}),R.on(c.Z.INIT_FRAGMENT_NEEDED,le,t),R.on(c.Z.MEDIA_FRAGMENT_NEEDED,ce,t),R.on(c.Z.INIT_FRAGMENT_LOADED,Me,t),R.on(c.Z.MEDIA_FRAGMENT_LOADED,Ce,t),R.on(c.Z.BUFFER_LEVEL_STATE_CHANGED,ge,t),R.on(c.Z.BUFFER_CLEARED,me,t),R.on(c.Z.SEEK_TARGET,Oe,t),R.on(c.Z.FRAGMENT_LOADING_ABANDONED,Ee,t),R.on(c.Z.FRAGMENT_LOADING_COMPLETED,be,t),R.on(c.Z.QUOTA_EXCEEDED,we,t),R.on(c.Z.SET_FRAGMENTED_TEXT_AFTER_DISABLED,Te,t),R.on(c.Z.SET_NON_FRAGMENTED_TEXT,Se,t),R.on(c.Z.SOURCE_BUFFER_ERROR,ve,t),R.on(c.Z.BYTES_APPENDED_END_FRAGMENT,ye,t),t}re.__dashjs_factory_name="StreamProcessor";var ae=u.Z.getClassFactory(re),oe=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.streamId=null,this.mediaInfo=null,this.segmentType=null,this.quality=NaN,this.index=NaN,this.bytes=null,this.start=NaN,this.end=NaN,this.duration=NaN,this.representationId=null,this.endFragment=null},se=n(9032);function le(e,t){if(e){if("string"==typeof e)return ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ce(e,t):void 0}}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function ue(e){e=e||{};var t,n=this.context,i=e.requestModifier,r=e.lowLatencyThroughputModel,o=e.boxParser,s=(0,I.Z)(n).getInstance();function l(e){var n,l=new Date,d=e.request,h=new Headers;if(d.range&&h.append("Range","bytes="+d.range),e.headers)for(var f in e.headers){var p=e.headers[f];p&&h.append(f,p)}d.requestStartDate||(d.requestStartDate=l),i&&i.modifyRequestHeader&&i.modifyRequestHeader({setRequestHeader:function(e,t){h.append(e,t)}},{url:e.url}),"function"==typeof window.AbortController&&(n=new AbortController,e.abortController=n,n.signal.onabort=e.onabort);var g={method:e.method,headers:h,credentials:e.withCredentials?"include":void 0,signal:n?n.signal:void 0},m=s.get().streaming.abr.fetchThroughputCalculationMode,v=Date.now(),y=0;new Promise(function(e){if(m===a.Z.ABR_FETCH_THROUGHPUT_CALCULATION_AAST&&r&&(y=r.getThroughputCapacityDelayMS(d,1e3*t.getCurrentBufferLevel(d.mediaType))))return setTimeout(e,y);e()}).then(function(){var n=Date.now();fetch(e.url,g).then(function(i){e.response||(e.response={}),e.response.status=i.status,e.response.statusText=i.statusText,e.response.responseURL=i.url,i.ok||e.onerror();var s,l="",h=function(e){var t;if(typeof Symbol>"u"||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=le(e))){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,o=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return a=e.done,e},e:function(e){o=!0,r=e},f:function(){try{a||null==t.return||t.return()}finally{if(o)throw r}}}}(i.headers.keys());try{for(h.s();!(s=h.n()).done;){var f=s.value;l+=f+": "+i.headers.get(f)+"\r\n"}}catch(e){h.e(e)}finally{h.f()}if(e.response.responseHeaders=l,!i.body)return i.arrayBuffer().then(function(t){e.response.response=t;var n={loaded:t.byteLength,total:t.byteLength,stream:!1};e.progress(n),e.onload(),e.onend()});var p,g,_,E,b=parseInt(i.headers.get("Content-Length"),10),T=0,S=!1,w=new Uint8Array,A=0;if(m===a.Z.ABR_FETCH_THROUGHPUT_CALCULATION_AAST&&r){var R=n,x=0,I=(E=2,function(e){if(Array.isArray(e))return e}(_=i.body.tee())||function(e,t){if(typeof Symbol<"u"&&Symbol.iterator in Object(e)){var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}}(_,E)||le(_,E)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),L=I[0],M=I[1];p=L.getReader(),g=[],p.read().then(function i(a){var o=a.value,s=a.done;if(x=Date.now(),o&&o.length){var c=x-R,u=o.length;g.push({chunkDownloadTimeRelativeMS:x-n,chunkDownloadDurationMS:c,chunkBytes:u,kbps:Math.round(8*u/(c/1e3)),bufferLevel:t.getCurrentBufferLevel(d.mediaType)})}if(s){var h=x-n,f=g.reduce(function(e,t){return e+t.chunkBytes},0);return r.addMeasurement(d,h,g,v,y,l),void e.progress({loaded:f,total:f,lengthComputable:!0,time:r.getEstimatedDownloadDurationMS(d),stream:!0})}return R=Date.now(),p.read().then(i)}),e.reader=M.getReader()}else e.reader=i.body.getReader();var C=[],P=[],D=[],O=!0;c(e,function t(n){var i=n.value;if(n.done){if(w){if(m!==a.Z.ABR_FETCH_THROUGHPUT_CALCULATION_AAST){var r=null,s=null;m===a.Z.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING?(r=function(e,t){try{var n,i;n=e.filter(function(t,n){return n<e.length-1}),i=t.filter(function(e,n){return n<t.length-1});var r=[];if(n.length>1){for(var a=0,o=0,s=0;s<n.length;s++)if(n[s]&&i[s]){var l=i[s].ts-n[s].ts;if(l>1)r.push(8*i[s].bytes/l),o=0;else{0===o&&(o=n[s].ts,a=0);var c=i[s].ts-o;c>1?(a+=i[s].bytes,r.push(8*a/c),o=0):a+=i[s].bytes}}if(r.length>0)return r.reduce(function(e,t){return e+t},0)/r.length}return null}catch(e){return null}}(P,D))&&(s=8*T/r):m===a.Z.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA&&(s=u(C,T)),e.progress({loaded:T,total:isNaN(b)?T:b,lengthComputable:!0,time:s,stream:!0})}e.response.response=w.buffer}return e.onload(),void e.onend()}if(i&&i.length>0){w=function(e,t){if(0===e.length)return t;var n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}(w,i),T+=i.length,C.push({ts:Date.now(),bytes:i.length}),m===a.Z.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING&&O&&o.findLastTopIsoBoxCompleted(["moof"],w,A).found&&(O=!1,P.push({ts:performance.now(),bytes:i.length}));var l=o.findLastTopIsoBoxCompleted(["moov","mdat"],w,A);if(l.found){var d,h=l.lastCompletedOffset+l.size;m!==a.Z.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING||O||(O=!0,D.push({ts:performance.now(),bytes:w.length})),h===w.length?(d=w,w=new Uint8Array):(d=new Uint8Array(w.subarray(0,h)),w=w.subarray(h)),e.progress({data:d.buffer,lengthComputable:!1,noTrace:!0}),A=0}else A=l.lastCompletedOffset,S||(e.progress({lengthComputable:!1,noTrace:!0}),S=!0)}c(e,t)})}).catch(function(t){e.onerror&&e.onerror(t)})})}function c(e,t){e.reader.read().then(t).catch(function(t){e.onerror&&200===e.response.status&&e.onerror(t)})}function u(e,t){try{if((e=e.filter(function(n){return n.bytes>t/4/e.length})).length>1){var n=0,i=(e[e.length-1].ts-e[0].ts)/e.length;return e.forEach(function(t,r){var a=e[r+1];if(a){var o=a.ts-t.ts;n+=o<i?o:0}}),n}return null}catch(e){return null}}return{load:function(e){i&&i.modifyRequest?(0,X.k)(e,i).then(function(){return l(e)}):l(e)},abort:function(e){if(e.abortController)e.abortController.abort();else if(e.reader)try{e.reader.cancel(),e.onabort()}catch(e){}},calculateDownloadedTime:u,setup:function(e){t=e.dashMetrics}}}ue.__dashjs_factory_name="FetchLoader";var de=u.Z.getClassFactory(ue),he=n(1180);function fe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var pe=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.codecs=null,this.mimeType=null,this.codecPrivateData=null,this.segmentDuration=NaN,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=NaN,this.mediaFinishedInformation={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN},this.bandwidth=NaN,this.width=NaN,this.height=NaN,this.scanType=null,this.maxPlayoutRate=NaN,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0,this.frameRate=null}var t;return(t=[{key:"hasInitialization",value:function(){return null!==this.initialization||null!==this.range}},{key:"hasSegments",value:function(){return this.segmentInfoType!==o.Z.BASE_URL&&this.segmentInfoType!==o.Z.SEGMENT_BASE&&!this.indexRange}}])&&fe(e.prototype,t),e}(),ge=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.period=null,this.index=-1,this.type=null},me=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null,this.nextPeriodId=null};me.DEFAULT_ID="defaultId";var ve=me,ye=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.publishTime=null,this.minimumUpdatePeriod=NaN,this.mediaPresentationDuration=NaN},_e=n(2610),Ee=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.type="",this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN},be=function e(t,n,i,r){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.url=t||"",this.serviceLocation=n||t||"",this.dvbPriority=i||1,this.dvbWeight=r||1,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0,this.queryParams={}};be.DEFAULT_DVB_PRIORITY=1,be.DEFAULT_DVB_WEIGHT=1;var Te=be,Se=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri="",this.presentationTimeOffset=0},we=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.id=null,this.inband=!1,this.type="encoder",this.applicationScheme=null,this.wallClockTime=null,this.presentationTime=NaN,this.UTCTiming=null},Ae=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.defaultServiceLocation=null,this.defaultServiceLocationArray=[],this.queryBeforeStart=!1,this.serverUrl=null,this.clientRequirement=!0};function Re(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var xe=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.schemeIdUri=null,this.value=null,this.id=null}var t;return(t=[{key:"init",value:function(e){return e&&(this.schemeIdUri=e.schemeIdUri?e.schemeIdUri:null,this.value=e.value?e.value:null,this.id=e.id?e.id:null,e[o.Z.DVB_URL]&&(this.dvbUrl=e[o.Z.DVB_URL]),e[o.Z.DVB_MIMETYPE]&&(this.dvbMimeType=e[o.Z.DVB_MIMETYPE]),e[o.Z.DVB_FONTFAMILY]&&(this.dvbFontFamily=e[o.Z.DVB_FONTFAMILY])),this}}])&&Re(e.prototype,t),e}(),Ie=n(3101),Le=n.n(Ie);function Me(){return{areEqual:function(e,t){return Le()(e,t)}}}Me.__dashjs_factory_name="ObjectUtils";var Ce=u.Z.getSingletonFactory(Me),Pe=n(7803),De=function e(t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.url=t||"",this.serviceLocation=n||null,this.queryParams={}},Oe=function e(t,n,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.url=t||"",this.serviceLocation=n||null,this.ttl=i||NaN,this.queryParams={}};function Ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function ke(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ne(Object(n),!0).forEach(function(t){Fe(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ne(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Fe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Be(e,t){var n;if(typeof Symbol>"u"||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Ue(e))||t){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ue(e,t){if(e){if("string"==typeof e)return Ve(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ve(e,t):void 0}}function Ve(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Ge(){var e,t,n,i,r=this.context,s=(0,Q.Z)(r).getInstance(),l=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};function c(e,t){if(!e)throw new Error("adaptation is not defined");if(!t)throw new Error("type is not defined");if(e.Representation_asArray&&e.Representation_asArray.length){var n=_(e.Representation_asArray[0]);if(n&&n.length>0&&Pe.Y.indexOf(n[0].schemeIdUri)>=0)return t===a.Z.IMAGE}if(e.ContentComponent_asArray&&e.ContentComponent_asArray.length>0){if(e.ContentComponent_asArray.length>1)return t===a.Z.MUXED;if(e.ContentComponent_asArray[0].contentType===t)return!0}var i=t===a.Z.TEXT?new RegExp("(ttml|vtt|wvtt|stpp)"):new RegExp(t);if(e.Representation_asArray&&e.Representation_asArray.length){var r=e.Representation_asArray[0].codecs;if(i.test(r))return!0}if(e.hasOwnProperty(o.Z.MIME_TYPE))return i.test(e.mimeType);if(e.Representation_asArray)for(var s,l=0;l<e.Representation_asArray.length;l++)if((s=e.Representation_asArray[l]).hasOwnProperty(o.Z.MIME_TYPE))return i.test(s.mimeType);return!1}function u(e){if(!e)throw new Error("adaptation is not defined");if(e.hasOwnProperty(o.Z.SEGMENT_TEMPLATE)||e.hasOwnProperty(o.Z.SEGMENT_TIMELINE)||e.hasOwnProperty(o.Z.SEGMENT_LIST)||e.hasOwnProperty(o.Z.SEGMENT_BASE))return!0;if(e.Representation_asArray&&e.Representation_asArray.length>0){var t=e.Representation_asArray[0];if(t.hasOwnProperty(o.Z.SEGMENT_TEMPLATE)||t.hasOwnProperty(o.Z.SEGMENT_TIMELINE)||t.hasOwnProperty(o.Z.SEGMENT_LIST)||t.hasOwnProperty(o.Z.SEGMENT_BASE))return!0}return!1}function h(e){return c(e,a.Z.VIDEO)}function f(e){return c(e,a.Z.TEXT)}function p(e){return c(e,a.Z.IMAGE)}function g(e){return e&&Array.isArray(e.Representation_asArray)&&e.Representation_asArray.sort(function(e,t){return e.bandwidth-t.bandwidth}),e}function m(e,t){return e&&e.Period_asArray&&l(t)&&e.Period_asArray[t]?e.Period_asArray[t].AdaptationSet_asArray:[]}function v(e){return e&&e.Period_asArray?e.Period_asArray:[]}function y(e){var t=!1;return e&&e.hasOwnProperty("type")&&(t=e.type===o.Z.DYNAMIC),t}function _(e){return e&&e.EssentialProperty_asArray&&e.EssentialProperty_asArray.length?e.EssentialProperty_asArray.map(function(e){return{schemeIdUri:e.schemeIdUri,value:e.value}}):null}function E(e){if(!e||!e.S_asArray)return NaN;var t=e.S_asArray[0],n=e.S_asArray[1];return t.hasOwnProperty("d")?t.d:n.t-t.t}function b(e,t){if(!e)throw new Error("Period cannot be null or undefined");var n=ve.DEFAULT_ID+"_"+t;return e.hasOwnProperty(o.Z.ID)&&e.id.length>0&&"__proto__"!==e.id&&(n=e.id),n}function S(e,t,n){var i,r=[];if(!e)return r;for(i=0;i<e.length;i++){var s=new Se;if(s.timescale=1,s.representation=t,!e[i].hasOwnProperty(a.Z.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");s.schemeIdUri=e[i].schemeIdUri,e[i].hasOwnProperty(o.Z.TIMESCALE)&&(s.timescale=e[i].timescale),e[i].hasOwnProperty(o.Z.VALUE)&&(s.value=e[i].value),r.push(s),s.period=n}return r}function w(e){var t=[],n=e.BaseURL_asArray||[e.baseUri],i=!1;return n.some(function(n){if(n){var r=new Te,a=n.__text||n;return s.isRelative(a)&&(i=!0,e.baseUri&&(a=s.resolve(a,e.baseUri))),r.url=a,n.hasOwnProperty(o.Z.SERVICE_LOCATION)&&n.serviceLocation.length?r.serviceLocation=n.serviceLocation:r.serviceLocation=a,n.hasOwnProperty(o.Z.DVB_PRIORITY)&&(r.dvbPriority=n[o.Z.DVB_PRIORITY]),n.hasOwnProperty(o.Z.DVB_WEIGHT)&&(r.dvbWeight=n[o.Z.DVB_WEIGHT]),n.hasOwnProperty(o.Z.AVAILABILITY_TIME_OFFSET)&&(r.availabilityTimeOffset=n[o.Z.AVAILABILITY_TIME_OFFSET]),n.hasOwnProperty(o.Z.AVAILABILITY_TIME_COMPLETE)&&(r.availabilityTimeComplete="false"!==n[o.Z.AVAILABILITY_TIME_COMPLETE]),t.push(r),i}}),t}function A(e){var t=new Ae;return t.serverUrl=e.__text,e.hasOwnProperty(o.Z.DEFAULT_SERVICE_LOCATION)&&(t.defaultServiceLocation=e[o.Z.DEFAULT_SERVICE_LOCATION],t.defaultServiceLocationArray=t.defaultServiceLocation.split(" ")),e.hasOwnProperty(o.Z.QUERY_BEFORE_START)&&(t.queryBeforeStart="true"===e[o.Z.QUERY_BEFORE_START].toLowerCase()),e.hasOwnProperty(o.Z.CLIENT_REQUIREMENT)&&(t.clientRequirement="false"!==e[o.Z.CLIENT_REQUIREMENT].toLowerCase()),t}return e={getIsTypeOf:c,getIsText:f,getIsFragmented:u,getProducerReferenceTimesForAdaptation:function(e){var t=e&&e.hasOwnProperty(o.Z.PRODUCERREFERENCETIME_ASARRAY)?e[o.Z.PRODUCERREFERENCETIME_ASARRAY]:[];(e&&e.hasOwnProperty(o.Z.REPRESENTATION_ASARRAY)?e[o.Z.REPRESENTATION_ASARRAY]:[]).forEach(function(e){var n;e.hasOwnProperty(o.Z.PRODUCERREFERENCETIME_ASARRAY)&&t.push.apply(t,function(e){if(Array.isArray(e))return Ve(e)}(n=e[o.Z.PRODUCERREFERENCETIME_ASARRAY])||function(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}(n)||Ue(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())});var n=[];return t.forEach(function(e){var t=new we;e.hasOwnProperty(o.Z.ID)&&(t[o.Z.ID]=e[o.Z.ID],e.hasOwnProperty(o.Z.WALL_CLOCK_TIME)&&(t[o.Z.WALL_CLOCK_TIME]=e[o.Z.WALL_CLOCK_TIME],e.hasOwnProperty(o.Z.PRESENTATION_TIME)&&(t[o.Z.PRESENTATION_TIME]=e[o.Z.PRESENTATION_TIME],e.hasOwnProperty(o.Z.INBAND)&&(t[o.Z.INBAND]="false"!==e[o.Z.INBAND]),e.hasOwnProperty(o.Z.TYPE)&&(t[o.Z.TYPE]=e[o.Z.TYPE]),n.push(t))))}),n},getLanguageForAdaptation:function(e){var t="";return e&&e.hasOwnProperty(o.Z.LANG)&&(t=e.lang),t},getViewpointForAdaptation:function(e){return e&&e.hasOwnProperty(o.Z.VIEWPOINT_ASARRAY)&&e[o.Z.VIEWPOINT_ASARRAY].length?e[o.Z.VIEWPOINT_ASARRAY].map(function(e){return(new xe).init(e)}):[]},getRolesForAdaptation:function(e){return e&&e.hasOwnProperty(o.Z.ROLE_ASARRAY)&&e[o.Z.ROLE_ASARRAY].length?e[o.Z.ROLE_ASARRAY].map(function(e){return(new xe).init(e)}):[]},getAccessibilityForAdaptation:function(e){return e&&e.hasOwnProperty(o.Z.ACCESSIBILITY_ASARRAY)&&e[o.Z.ACCESSIBILITY_ASARRAY].length?e[o.Z.ACCESSIBILITY_ASARRAY].map(function(e){return(new xe).init(e)}):[]},getAudioChannelConfigurationForAdaptation:function(e){return e&&e.hasOwnProperty(o.Z.AUDIOCHANNELCONFIGURATION_ASARRAY)&&e[o.Z.AUDIOCHANNELCONFIGURATION_ASARRAY].length?e[o.Z.AUDIOCHANNELCONFIGURATION_ASARRAY].map(function(e){return(new xe).init(e)}):[]},getAudioChannelConfigurationForRepresentation:function(e){return e&&e.hasOwnProperty(o.Z.AUDIOCHANNELCONFIGURATION_ASARRAY)&&e[o.Z.AUDIOCHANNELCONFIGURATION_ASARRAY].length?e[o.Z.AUDIOCHANNELCONFIGURATION_ASARRAY].map(function(e){return(new xe).init(e)}):[]},getAdaptationForIndex:function(e,t,n){var i=m(t,n);return i.length>0&&l(e)?i[e]:null},getIndexForAdaptation:function(e,t,n){if(!e)return-1;for(var i=m(t,n),a=0;a<i.length;a++)if(Ce(r).getInstance().areEqual(i[a],e))return a;return-1},getAdaptationForId:function(e,t,n){var i,r,a=m(t,n);for(i=0,r=a.length;i<r;i++)if(a[i].hasOwnProperty(o.Z.ID)&&a[i].id===e)return a[i];return null},getAdaptationsForType:function(e,t,n){var i,r,a=m(e,t),o=[];for(i=0,r=a.length;i<r;i++)c(a[i],n)&&o.push(g(a[i]));return o},getRealPeriods:v,getRealPeriodForIndex:function(e,t){var n=v(t);return n.length>0&&l(e)?n[e]:null},getCodec:function(e,t,n){var i=null;if(e&&e.Representation_asArray&&e.Representation_asArray.length>0){var r=l(t)&&t>=0&&t<e.Representation_asArray.length?e.Representation_asArray[t]:e.Representation_asArray[0];r&&(i=r.mimeType+';codecs="'+r.codecs+'"',n&&void 0!==r.width&&(i+=';width="'+r.width+'";height="'+r.height+'"'))}return i&&(i=i.replace(/\sprofiles=[^;]*/g,"")),i},getSelectionPriority:function(e){try{var t=e&&void 0!==e.selectionPriority?parseInt(e.selectionPriority):1;return isNaN(t)?1:t}catch(e){return 1}},getMimeType:function(e){return e&&e.Representation_asArray&&e.Representation_asArray.length>0?e.Representation_asArray[0].mimeType:null},getKID:function(e){return e&&e.hasOwnProperty(o.Z.CENC_DEFAULT_KID)?e[o.Z.CENC_DEFAULT_KID]:null},getLabelsForAdaptation:function(e){if(!e||!Array.isArray(e.Label_asArray))return[];for(var t=[],n=0;n<e.Label_asArray.length;n++)t.push({lang:e.Label_asArray[n].lang,text:e.Label_asArray[n].__text||e.Label_asArray[n]});return t},getContentProtectionData:function(e){return e&&e.hasOwnProperty(o.Z.CONTENTPROTECTION_ASARRAY)&&0!==e.ContentProtection_asArray.length?e.ContentProtection_asArray:null},getIsDynamic:y,getId:function(e){return e&&e[o.Z.ID]||null},hasProfile:function(e,t){var n=!1;return e&&e.profiles&&e.profiles.length>0&&(n=-1!==e.profiles.indexOf(t)),n},getDuration:function(e){return e&&e.hasOwnProperty(o.Z.MEDIA_PRESENTATION_DURATION)?e.mediaPresentationDuration:e&&"dynamic"==e.type?Number.POSITIVE_INFINITY:Number.MAX_SAFE_INTEGER||Number.MAX_VALUE},getBandwidth:function(e){return e&&e.bandwidth?e.bandwidth:NaN},getManifestUpdatePeriod:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=NaN;return e&&e.hasOwnProperty(o.Z.MINIMUM_UPDATE_PERIOD)&&(n=e.minimumUpdatePeriod),isNaN(n)?n:Math.max(n-t,1)},getPublishTime:function(e){return e&&e.hasOwnProperty(o.Z.PUBLISH_TIME)?new Date(e[o.Z.PUBLISH_TIME]):null},getRepresentationCount:function(e){return e&&Array.isArray(e.Representation_asArray)?e.Representation_asArray.length:0},getBitrateListForAdaptation:function(e){var t=g(e);return(t&&Array.isArray(t.Representation_asArray)?t.Representation_asArray:[]).map(function(e){return{bandwidth:e.bandwidth,width:e.width||0,height:e.height||0,scanType:e.scanType||null,id:e.id||null}})},getRepresentationFor:function(e,t){return t&&t.Representation_asArray&&t.Representation_asArray.length>0&&l(e)?t.Representation_asArray[e]:null},getRepresentationsForAdaptation:function(e){var t,n,i,r,a=[],s=function(e){if(e&&e.period&&l(e.period.index)){var t=e.period.mpd.manifest.Period_asArray[e.period.index];if(t&&t.AdaptationSet_asArray&&l(e.index))return g(t.AdaptationSet_asArray[e.index])}}(e);if(s&&s.Representation_asArray){if(e&&e.period&&l(e.period.index)){var c=w(e.period.mpd.manifest);c&&(n=c[0])}for(var d=0,h=s.Representation_asArray.length;d<h;++d){var p=s.Representation_asArray[d],m=new pe;if(m.index=d,m.adaptation=e,p.hasOwnProperty(o.Z.ID)&&(m.id=p.id),p.hasOwnProperty(o.Z.CODECS)&&(m.codecs=p.codecs),p.hasOwnProperty(o.Z.MIME_TYPE)&&(m.mimeType=p[o.Z.MIME_TYPE]),p.hasOwnProperty(o.Z.CODEC_PRIVATE_DATA)&&(m.codecPrivateData=p.codecPrivateData),p.hasOwnProperty(o.Z.BANDWITH)&&(m.bandwidth=p.bandwidth),p.hasOwnProperty(o.Z.WIDTH)&&(m.width=p.width),p.hasOwnProperty(o.Z.HEIGHT)&&(m.height=p.height),p.hasOwnProperty(o.Z.SCAN_TYPE)&&(m.scanType=p.scanType),p.hasOwnProperty(o.Z.MAX_PLAYOUT_RATE)&&(m.maxPlayoutRate=p.maxPlayoutRate),p.hasOwnProperty(o.Z.SEGMENT_BASE)?(t=p.SegmentBase,m.segmentInfoType=o.Z.SEGMENT_BASE):p.hasOwnProperty(o.Z.SEGMENT_LIST)?(t=p.SegmentList).hasOwnProperty(o.Z.SEGMENT_TIMELINE)?m.segmentInfoType=o.Z.SEGMENT_TIMELINE:m.segmentInfoType=o.Z.SEGMENT_LIST:p.hasOwnProperty(o.Z.SEGMENT_TEMPLATE)?((t=p.SegmentTemplate).hasOwnProperty(o.Z.SEGMENT_TIMELINE)?m.segmentInfoType=o.Z.SEGMENT_TIMELINE:m.segmentInfoType=o.Z.SEGMENT_TEMPLATE,t.hasOwnProperty(o.Z.INITIALIZATION_MINUS)&&(m.initialization=t.initialization.split("$Bandwidth$").join(p.bandwidth).split("$RepresentationID$").join(p.id))):m.segmentInfoType=o.Z.BASE_URL,m.essentialProperties=_(p),t){if(t.hasOwnProperty(o.Z.INITIALIZATION)){var v=t.Initialization;v.hasOwnProperty(o.Z.SOURCE_URL)&&(m.initialization=v.sourceURL),v.hasOwnProperty(o.Z.RANGE)&&(m.range=v.range)}else f(s)&&u(s)&&s.mimeType&&-1===s.mimeType.indexOf("application/mp4")&&(m.range=0);t.hasOwnProperty(o.Z.TIMESCALE)&&(m.timescale=t.timescale),t.hasOwnProperty(o.Z.DURATION)?m.segmentDuration=t.duration/m.timescale:p.hasOwnProperty(o.Z.SEGMENT_TEMPLATE)&&(t=p.SegmentTemplate).hasOwnProperty(o.Z.SEGMENT_TIMELINE)&&(m.segmentDuration=E(t.SegmentTimeline)/m.timescale),t.hasOwnProperty(o.Z.MEDIA)&&(m.media=t.media),t.hasOwnProperty(o.Z.START_NUMBER)&&(m.startNumber=t.startNumber),t.hasOwnProperty(o.Z.INDEX_RANGE)&&(m.indexRange=t.indexRange),t.hasOwnProperty(o.Z.PRESENTATION_TIME_OFFSET)&&(m.presentationTimeOffset=t.presentationTimeOffset/m.timescale),t.hasOwnProperty(o.Z.AVAILABILITY_TIME_OFFSET)?m.availabilityTimeOffset=t.availabilityTimeOffset:n&&void 0!==n.availabilityTimeOffset&&(m.availabilityTimeOffset=n.availabilityTimeOffset),t.hasOwnProperty(o.Z.AVAILABILITY_TIME_COMPLETE)?m.availabilityTimeComplete="false"!==t.availabilityTimeComplete:n&&void 0!==n.availabilityTimeComplete&&(m.availabilityTimeComplete=n.availabilityTimeComplete)}m.MSETimeOffset=(r=(i=m).presentationTimeOffset,i.adaptation.period.start-r),m.path=[e.period.index,e.index,d],a.push(m)}}return a},getAdaptationsForPeriod:function(e){var n,i,r,s=e&&l(e.index)?e.mpd.manifest.Period_asArray[e.index]:null,u=[];if(s&&s.AdaptationSet_asArray)for(r=0;r<s.AdaptationSet_asArray.length;r++)i=s.AdaptationSet_asArray[r],n=new ge,i.hasOwnProperty(o.Z.ID)&&(n.id=i.id),n.index=r,n.period=e,c(i,a.Z.MUXED)?n.type=a.Z.MUXED:c(i,a.Z.AUDIO)?n.type=a.Z.AUDIO:h(i)?n.type=a.Z.VIDEO:f(i)?n.type=a.Z.TEXT:p(i)?n.type=a.Z.IMAGE:t.warn("Unknown Adaptation stream type"),u.push(n);return u},getRegularPeriods:function(e){var i,r,s=!!e&&y(e.manifest),l=[],c=null,u=null,d=null,h=null;for(r=0,i=e&&e.manifest&&e.manifest.Period_asArray?e.manifest.Period_asArray.length:0;r<i;r++)(u=e.manifest.Period_asArray[r]).hasOwnProperty(o.Z.START)?(h=new ve).start=u.start:null!==c&&c.hasOwnProperty(o.Z.DURATION)&&null!==d?(h=new ve).start=parseFloat((d.start+d.duration).toFixed(5)):0!==r||s||((h=new ve).start=0),null!==d&&isNaN(d.duration)&&(null!==h?d.duration=parseFloat((h.start-d.start).toFixed(5)):t.warn("First period duration could not be calculated because lack of start and duration period properties. This will cause timing issues during playback")),null!==h&&(h.id=b(u,r),h.index=r,h.mpd=e,u.hasOwnProperty(o.Z.DURATION)&&(h.duration=u.duration),d&&(d.nextPeriodId=h.id),l.push(h),c=u,d=h),u=null,h=null;return 0===l.length||null!==d&&isNaN(d.duration)&&(d.duration=parseFloat((function(e){!function(){if(!n||!n.hasOwnProperty("error"))throw new Error(a.Z.MISSING_CONFIG_ERROR)}();var t,i=y(e.mpd.manifest);return e.mpd.manifest.mediaPresentationDuration?t=e.mpd.manifest.mediaPresentationDuration:e.duration?t=e.duration:i?t=Number.POSITIVE_INFINITY:n.error(new T.Z(x.MANIFEST_ERROR_ID_PARSE_CODE,"Must have @mediaPresentationDuration on MPD or an explicit @duration on the last period.",e)),t}(d)-d.start).toFixed(5))),l},getMpd:function(e){var t=new ye;return e&&(t.manifest=e,e.hasOwnProperty(o.Z.AVAILABILITY_START_TIME)?t.availabilityStartTime=new Date(e.availabilityStartTime.getTime()):e.loadedTime&&(t.availabilityStartTime=new Date(e.loadedTime.getTime())),e.hasOwnProperty(o.Z.AVAILABILITY_END_TIME)&&(t.availabilityEndTime=new Date(e.availabilityEndTime.getTime())),e.hasOwnProperty(o.Z.MINIMUM_UPDATE_PERIOD)&&(t.minimumUpdatePeriod=e.minimumUpdatePeriod),e.hasOwnProperty(o.Z.MEDIA_PRESENTATION_DURATION)&&(t.mediaPresentationDuration=e.mediaPresentationDuration),e.hasOwnProperty(o.Z.SUGGESTED_PRESENTATION_DELAY)&&(t.suggestedPresentationDelay=e.suggestedPresentationDelay),e.hasOwnProperty(o.Z.TIMESHIFT_BUFFER_DEPTH)&&(t.timeShiftBufferDepth=e.timeShiftBufferDepth),e.hasOwnProperty(o.Z.MAX_SEGMENT_DURATION)&&(t.maxSegmentDuration=e.maxSegmentDuration),e.hasOwnProperty(o.Z.PUBLISH_TIME)&&(t.publishTime=new Date(e.publishTime))),t},getEventsForPeriod:function(e){var t,n,r=e&&e.mpd&&e.mpd.manifest?e.mpd.manifest:null,s=r?r.Period_asArray:null,c=s&&e&&l(e.index)?s[e.index].EventStream_asArray:null,u=[];if(c)for(t=0;t<c.length;t++){var d=new Se;if(d.period=e,d.timescale=1,!c[t].hasOwnProperty(a.Z.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");for(d.schemeIdUri=c[t][a.Z.SCHEME_ID_URI],c[t].hasOwnProperty(o.Z.TIMESCALE)&&(d.timescale=c[t][o.Z.TIMESCALE]),c[t].hasOwnProperty(o.Z.VALUE)&&(d.value=c[t][o.Z.VALUE]),c[t].hasOwnProperty(o.Z.PRESENTATION_TIME_OFFSET)&&(d.presentationTimeOffset=c[t][o.Z.PRESENTATION_TIME_OFFSET]),n=0;c[t].Event_asArray&&n<c[t].Event_asArray.length;n++){var h=c[t].Event_asArray[n],f=new Ee;f.presentationTime=0,f.eventStream=d,h.hasOwnProperty(o.Z.PRESENTATION_TIME)&&(f.presentationTime=h.presentationTime);var p=d.presentationTimeOffset?d.presentationTimeOffset/d.timescale:0;f.calculatedPresentationTime=f.presentationTime/d.timescale+e.start-p,h.hasOwnProperty(o.Z.DURATION)&&(f.duration=h.duration/d.timescale),h.hasOwnProperty(o.Z.ID)?f.id=h.id:f.id=null,h.Signal&&h.Signal.Binary?f.messageData=i.decodeArray(h.Signal.Binary.toString()):f.messageData=h.messageData||h.__cdata||h.__text,u.push(f)}}return u},getEssentialPropertiesForAdaptation:function(e){var t={};if(e&&e.hasOwnProperty(o.Z.ESSENTIAL_PROPERTY_ASARRAY)){var n,i=Be(e.EssentialProperty_asArray);try{for(i.s();!(n=i.n()).done;){var r=n.value;r.hasOwnProperty(a.Z.SCHEME_ID_URI)&&(t[r[a.Z.SCHEME_ID_URI]]=ke({},r))}}catch(e){i.e(e)}finally{i.f()}}return t},getEssentialPropertiesAsArrayForAdaptation:function(e){return e&&e.hasOwnProperty(o.Z.ESSENTIAL_PROPERTY_ASARRAY)&&e.EssentialProperty_asArray.length?e.EssentialProperty_asArray.map(function(e){return(new xe).init(e)}):[]},getEssentialPropertiesForRepresentation:_,getEventStreamForAdaptationSet:function(e,t,n){var i,r,a;return e&&e.Period_asArray&&t&&t.period&&l(t.period.index)&&(r=e.Period_asArray[t.period.index])&&r.AdaptationSet_asArray&&l(t.index)&&(a=r.AdaptationSet_asArray[t.index])&&(i=a.InbandEventStream_asArray),S(i,null,n)},getEventStreamForRepresentation:function(e,t,n){var i,r,a,o;return e&&e.Period_asArray&&t&&t.adaptation&&t.adaptation.period&&l(t.adaptation.period.index)&&(r=e.Period_asArray[t.adaptation.period.index])&&r.AdaptationSet_asArray&&l(t.adaptation.index)&&(a=r.AdaptationSet_asArray[t.adaptation.index])&&a.Representation_asArray&&l(t.index)&&(o=a.Representation_asArray[t.index])&&(i=o.InbandEventStream_asArray),S(i,t,n)},getUTCTimingSources:function(e){var t=y(e),n=!!e&&e.hasOwnProperty(o.Z.AVAILABILITY_START_TIME),i=e?e.UTCTiming_asArray:null,r=[];return(t||n)&&i&&i.forEach(function(e){var t=new _e.Z;e.hasOwnProperty(a.Z.SCHEME_ID_URI)&&(t.schemeIdUri=e.schemeIdUri,e.hasOwnProperty(o.Z.VALUE)&&(t.value=e.value.toString(),r.push(t)))}),r},getBaseURLsFromElement:w,getRepresentationSortFunction:function(){return function(e,t){return e.bandwidth-t.bandwidth}},getContentSteering:function(e){if(e&&e.hasOwnProperty(o.Z.CONTENT_STEERING_AS_ARRAY))return A(e[o.Z.CONTENT_STEERING_AS_ARRAY][0])},getLocation:function(e){return e&&e.hasOwnProperty(o.Z.LOCATION_AS_ARRAY)?e[o.Z.LOCATION_AS_ARRAY].map(function(e){var t=e.__text||e,n=e.hasOwnProperty(o.Z.SERVICE_LOCATION)?e[o.Z.SERVICE_LOCATION]:null;return new De(t,n)}):[]},getPatchLocation:function(e){return e&&e.hasOwnProperty(o.Z.PATCH_LOCATION_AS_ARRAY)?e[o.Z.PATCH_LOCATION_AS_ARRAY].map(function(e){var t=e.__text||e,n=e.hasOwnProperty(o.Z.SERVICE_LOCATION)?e[o.Z.SERVICE_LOCATION]:null,i=e.hasOwnProperty(o.Z.TTL)?1e3*parseFloat(e[o.Z.TTL]):NaN;return new Oe(t,n,i)}):[]},getSuggestedPresentationDelay:function(e){return e&&e.hasOwnProperty(o.Z.SUGGESTED_PRESENTATION_DELAY)?e.suggestedPresentationDelay:null},getAvailabilityStartTime:function(e){return e&&e.hasOwnProperty(o.Z.AVAILABILITY_START_TIME)&&null!==e.availabilityStartTime?e.availabilityStartTime.getTime():null},getServiceDescriptions:function(e){var t=[];if(e&&e.hasOwnProperty(o.Z.SERVICE_DESCRIPTION)){var n,i=Be(e.ServiceDescription_asArray);try{for(i.s();!(n=i.n()).done;){var r=n.value,a=null,s=null,l=null,c=null,u=null,d=null,h=null;for(var f in r)r.hasOwnProperty(f)&&(f===o.Z.ID?a=r[f]:f===o.Z.SERVICE_DESCRIPTION_SCOPE?s=r[f].schemeIdUri:f===o.Z.SERVICE_DESCRIPTION_LATENCY?l={target:parseInt(r[f].target),max:parseInt(r[f].max),min:parseInt(r[f].min),referenceId:parseInt(r[f].referenceId)}:f===o.Z.SERVICE_DESCRIPTION_PLAYBACK_RATE?c={max:parseFloat(r[f].max),min:parseFloat(r[f].min)}:f===o.Z.SERVICE_DESCRIPTION_OPERATING_QUALITY?u={mediaType:r[f].mediaType,max:parseInt(r[f].max),min:parseInt(r[f].min),target:parseInt(r[f].target),type:r[f].type,maxQualityDifference:parseInt(r[f].maxQualityDifference)}:f===o.Z.SERVICE_DESCRIPTION_OPERATING_BANDWIDTH?d={mediaType:r[f].mediaType,max:parseInt(r[f].max),min:parseInt(r[f].min),target:parseInt(r[f].target)}:f===o.Z.CONTENT_STEERING&&(h=A(r[f])));t.push({id:a,schemeIdUri:s,latency:l,playbackRate:c,operatingQuality:u,operatingBandwidth:d,contentSteering:h})}}catch(e){i.e(e)}finally{i.f()}}return t},getSegmentAlignment:function(e){return!(!e||!e.hasOwnProperty(o.Z.SEGMENT_ALIGNMENT))&&"true"===e[o.Z.SEGMENT_ALIGNMENT]},getSubSegmentAlignment:function(e){return!(!e||!e.hasOwnProperty(o.Z.SUB_SEGMENT_ALIGNMENT))&&"true"===e[o.Z.SUB_SEGMENT_ALIGNMENT]},getSupplementalPropertiesForAdaptation:function(e){var t={};if(e&&e.hasOwnProperty(o.Z.SUPPLEMENTAL_PROPERTY_ASARRAY)){var n,i=Be(e.SupplementalProperty_asArray);try{for(i.s();!(n=i.n()).done;){var r=n.value;r.hasOwnProperty(a.Z.SCHEME_ID_URI)&&(t[r[a.Z.SCHEME_ID_URI]]=ke({},r))}}catch(e){i.e(e)}finally{i.f()}}return t},getSupplementalPropertiesAsArrayForAdaptation:function(e){return e&&e.hasOwnProperty(o.Z.SUPPLEMENTAL_PROPERTY_ASARRAY)&&e.SupplementalProperty_asArray.length?e.SupplementalProperty_asArray.map(function(e){return(new xe).init(e)}):[]},getSupplementalPropertiesForRepresentation:function(e){var t={};if(e&&e.hasOwnProperty(o.Z.SUPPLEMENTAL_PROPERTY_ASARRAY)){var n,i=Be(e.SupplementalProperty_asArray);try{for(i.s();!(n=i.n()).done;){var r=n.value;r.hasOwnProperty(a.Z.SCHEME_ID_URI)&&(t[r[a.Z.SCHEME_ID_URI]]=ke({},r))}}catch(e){i.e(e)}finally{i.f()}}return t},getSupplementalPropertiesAsArrayForRepresentation:function(e){return e&&e.hasOwnProperty(o.Z.SUPPLEMENTAL_PROPERTY_ASARRAY)&&e.SupplementalProperty_asArray.length?e.SupplementalProperty_asArray.map(function(e){return(new xe).init(e)}):[]},setConfig:function(e){e&&(e.errHandler&&(n=e.errHandler),e.BASE64&&(i=e.BASE64))}},t=(0,d.Z)(r).getInstance().getLogger(e),e}Ge.__dashjs_factory_name="DashManifestModel";var He=u.Z.getSingletonFactory(Ge),je=n(703);function ze(e,t){var n;if(typeof Symbol>"u"||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Ze(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ze(e,t):void 0}}(e))||t){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ze(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function qe(){var e,t,n,i,r,o,s,c,u,d,f=this.context,p=(0,l.Z)(f).getInstance(),g=(0,I.Z)(f).getInstance();function m(){n={pr:1,nor:null,st:null,sf:null,sid:"".concat(je.Z.generateUuid()),cid:null},u={},c={},d={},y()}function v(){y()}function y(){if(o){var e=o.getStreamController();if(e&&"function"==typeof e.getActiveStream){var t=e.getActiveStream();t&&(s=t.getProcessors())}}}function _(e,t){var n,i={},r=ze(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;e[a]&&(i[a]=e[a])}}catch(e){r.e(e)}finally{r.f()}return i}function E(e){var t=g.get().streaming.cmcd.enabledKeys;return e.filter(function(e){return t.includes(e)})}function b(e){try{return e.type===L.w.MPD_TYPE?((f=T()).ot="m",f):e.type===L.w.MEDIA_SEGMENT_TYPE?(h=e.mediaType,d.hasOwnProperty(h)||(d[h]=!1),c.hasOwnProperty(h)||(c[h]=!1),u.hasOwnProperty(h)||(u[h]=!1),function(e){var t,l=T(),h=function(e){try{var t=e.quality,n=e.mediaInfo.bitrateList;return parseInt(n[t].bandwidth/1e3)}catch(e){return null}}(e),f=function(e){try{return isNaN(e.duration)?NaN:Math.round(1e3*e.duration)}catch(e){return null}}(e),p=function(e){try{return 100*parseInt(i.getThroughputHistory().getSafeAverageThroughput(e)/100)}catch(e){return null}}(e.mediaType),m=function(e){try{var t=n.pr,i=r.getCurrentBufferLevel(e);return isNaN(t)||isNaN(i)?null:100*parseInt(i/t*10)}catch(e){return null}}(e.mediaType),v=S(e.mediaType),y=function(e){try{var t=i.getTopBitrateInfoFor(e);return Math.round(t.bitrate/1e3)}catch(e){return null}}(e.mediaType),_=n.pr,E=function(e){if(s&&0!==s.length){var t,n=ze(s);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i.getType()===e)return i.probeNextRequest()}}catch(e){n.e(e)}finally{n.f()}}}(e.mediaType);e.mediaType===a.Z.VIDEO&&(t="v"),e.mediaType===a.Z.AUDIO&&(t="a"),e.mediaType===a.Z.TEXT&&(t="application/mp4"===e.mediaInfo.mimeType?"tt":"c");var b=g.get().streaming.cmcd.rtp;return b||(b=function(e){try{var t=o.getPlaybackRate();t||(t=1);var n=e.quality,i=e.mediaType,r=e.mediaInfo,a=e.duration;if(!r)return NaN;var s=S(i);0===s&&(s=500);var l=r.bitrateList[n].bandwidth*a/1e3/(s/t/1e3),c=g.get().streaming.cmcd.rtpSafetyFactor&&!isNaN(g.get().streaming.cmcd.rtpSafetyFactor)?g.get().streaming.cmcd.rtpSafetyFactor:5;return 100*(parseInt(l*c/100)+1)}catch(e){return NaN}}(e)),isNaN(b)||(l.rtp=b),E&&(e.url!==E.url?l.nor=encodeURIComponent(je.Z.getRelativeUrl(e.url,E.url)):E.range&&(l.nrr=E.range)),h&&(l.br=h),t&&(l.ot=t),isNaN(f)||(l.d=f),isNaN(p)||(l.mtp=p),isNaN(m)||(l.dl=m),isNaN(v)||(l.bl=v),isNaN(y)||(l.tb=y),isNaN(_)||1===_||(l.pr=_),u[e.mediaType]&&(l.bs=!0,u[e.mediaType]=!1),!c[e.mediaType]&&d[e.mediaType]||(l.su=!0,c[e.mediaType]=!1,d[e.mediaType]=!0),l}(e)):e.type===L.w.INIT_SEGMENT_TYPE?((l=T()).ot="i",l.su=!0,l):e.type===L.w.OTHER_TYPE||e.type===L.w.XLINK_EXPANSION_TYPE?function(){var e=T();return e.ot="o",e}():e.type===L.w.LICENSE?((t=T()).ot="k",t):null}catch(e){return null}var t,l,h,f}function T(){var e={},t=g.get().streaming.cmcd.cid?g.get().streaming.cmcd.cid:n.cid;return e.v=1,e.sid=g.get().streaming.cmcd.sid?g.get().streaming.cmcd.sid:n.sid,e.sid="".concat(e.sid),t&&(e.cid="".concat(t)),isNaN(n.pr)||1===n.pr||null===n.pr||(e.pr=n.pr),n.st&&(e.st=n.st),n.sf&&(e.sf=n.sf),e}function S(e){try{var t=r.getCurrentBufferLevel(e);return isNaN(t)?null:100*parseInt(10*t)}catch(e){return null}}function w(e){try{n.pr=e.playbackRate}catch(e){}}function A(t){try{var i=e.getIsDynamic(t.data)?"l":"v",r=t.protocol&&"MSS"===t.protocol?"s":"d";n.st="".concat(i),n.sf="".concat(r)}catch(e){}}function R(e){try{e.state&&e.mediaType&&e.state===h.Z.BUFFER_EMPTY&&(u[e.mediaType]||(u[e.mediaType]=!0),c[e.mediaType]||(c[e.mediaType]=!0))}catch(e){}}function x(){for(var e in u)u.hasOwnProperty(e)&&(u[e]=!0);for(var t in c)c.hasOwnProperty(t)&&(c[t]=!0)}function M(e){try{if(!e)return null;var t=Object.keys(e).sort(function(e,t){return e.localeCompare(t)}),n=t.length,i=t.reduce(function(t,i,r){return"v"===i&&1===e[i]||("string"==typeof e[i]&&"ot"!==i&&"sf"!==i&&"st"!==i?t+="".concat(i,"=").concat(JSON.stringify(e[i])):t+="".concat(i,"=").concat(e[i]),r<n-1&&(t+=",")),t},"");return(i=i.replace(/=true/g,"")).replace(/,\s*$/,"")}catch(e){return null}}return t={getQueryParameter:function(e){try{if(g.get().streaming.cmcd&&g.get().streaming.cmcd.enabled){var t=b(e),n=M(function(e){try{var t=g.get().streaming.cmcd.enabledKeys;return Object.keys(e).filter(function(e){return t.includes(e)}).reduce(function(t,n){return t[n]=e[n],t},{})}catch(t){return e}}(t));return p.trigger(he.Z.CMCD_DATA_GENERATED,{url:e.url,mediaType:e.mediaType,cmcdData:t,cmcdString:n}),{key:"CMCD",value:n}}return null}catch(e){return null}},getHeaderParameters:function(e){try{if(g.get().streaming.cmcd&&g.get().streaming.cmcd.enabled){var t=b(e),n=_(t,E(["br","d","ot","tb"])),i=_(t,E(["bl","dl","mtp","nor","nrr","su"])),r=_(t,E(["bs","rtp"])),a=_(t,E(["cid","pr","sf","sid","st","v"])),o={"CMCD-Object":M(n),"CMCD-Request":M(i),"CMCD-Status":M(r),"CMCD-Session":M(a)};return p.trigger(he.Z.CMCD_DATA_GENERATED,{url:e.url,mediaType:e.mediaType,cmcdData:t,headers:o}),o}return null}catch(e){return null}},setConfig:function(e){e&&(e.abrController&&(i=e.abrController),e.dashMetrics&&(r=e.dashMetrics),e.playbackController&&(o=e.playbackController))},reset:function(){p.off(h.Z.PLAYBACK_RATE_CHANGED,w,this),p.off(h.Z.MANIFEST_LOADED,A,this),p.off(h.Z.BUFFER_LEVEL_STATE_CHANGED,R,t),p.off(h.Z.PLAYBACK_SEEKED,x,t),m()},initialize:function(){p.on(h.Z.PLAYBACK_RATE_CHANGED,w,t),p.on(h.Z.MANIFEST_LOADED,A,t),p.on(h.Z.BUFFER_LEVEL_STATE_CHANGED,R,t),p.on(h.Z.PLAYBACK_SEEKED,x,t),p.on(h.Z.PERIOD_SWITCH_COMPLETED,v,t)}},e=He(f).getInstance(),m(),t}qe.__dashjs_factory_name="CmcdModel";var We=u.Z.getSingletonFactory(qe);function Ye(e){return(Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ke(e,t){Ke=function(e,t){return new a(e,void 0,t)};var n=Qe(RegExp),i=RegExp.prototype,r=new WeakMap;function a(e,t,i){var a=n.call(this,e,t);return r.set(a,i||r.get(e)),a}function o(e,t){var n=r.get(t);return Object.keys(n).reduce(function(t,i){return t[i]=e[n[i]],t},Object.create(null))}return Xe(a,n),a.prototype.exec=function(e){var t=i.exec.call(this,e);return t&&(t.groups=o(t,this)),t},a.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var n=r.get(this);return i[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,function(e,t){return"$"+n[t]}))}if("function"==typeof t){var a=this;return i[Symbol.replace].call(this,e,function(){var e=[];return e.push.apply(e,arguments),"object"!==Ye(e[e.length-1])&&e.push(o(e,a)),t.apply(this,e)})}return i[Symbol.replace].call(this,e,t)},Ke.apply(this,arguments)}function Xe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&et(e,t)}function Qe(e){var t="function"==typeof Map?new Map:void 0;return Qe=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return Je(e,arguments,tt(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),et(i,e)},Qe(e)}function Je(e,t,n){return(Je=$e()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&et(r,n.prototype),r}).apply(null,arguments)}function $e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function et(e,t){return(et=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function tt(e){return(tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var nt="static",it="dynamic",rt="cmsd-",at=rt+nt,ot=rt+it,st="stream",lt=["mb","st","sf","v"],ct={video:"v",audio:"a",text:"tt",stream:st},ut=/^[-0-9]/;function dt(){var e,t,n,i,r=this.context,a=(0,l.Z)(r).getInstance();function o(){n={},i={}}function s(e){e&&Object.keys(e).forEach(function(t){lt.includes(t)||delete e[t]})}function u(e){return!e||"false"!==e.toLowerCase()&&(ut.test(e)?parseInt(e,10):e.replace(/["]+/g,""))}function h(e){try{for(var n={},i=e.split(","),r=0;r<i.length;r++){var a=i[r].split("="),o=a[0],s=u(a[1]);n[o]=s}return n}catch(e){t.error("Failed to parse CMSD-Static response header value:",e)}}function f(e){try{for(var n={},i=e.split(","),r=i[i.length-1].split(";"),a=1;a<r.length;a++){var o=r[a].split("="),s=o[0],l=u(o[1]);n[s]=l}return n}catch(e){return t.error("Failed to parse CMSD-Dynamic response header value:",e),[]}}function p(e){return ct[e]||"o"}function g(e,t,r){var a=e===nt?n:i,o=a[t]||{},s=a[st]||{};return o[r]||s[r]}return e={setConfig:function(){},initialize:function(){},reset:function(){o()},parseResponseHeaders:function(e,t){for(var r=null,o=null,l=e.split("\r\n"),u=l.length-1;u>=0;u--){var d=l[u].match(Ke(/^((?:(?!:)[\s\S])*):[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(.*)$/,{key:1,value:2}));if(d&&d.groups){var g=d.groups.key.toLowerCase(),m=d.groups.value;switch(g){case at:r=h(m),a.trigger(c.Z.CMSD_STATIC_HEADER,r);break;case ot:o||(o=f(m))}}}var v=st;return r&&r.ot?v=r.ot:t&&(v=p(t)),s(n[v]),s(i[v]),r&&(n[v]=Object.assign(n[v]||{},r)),o&&(i[v]=Object.assign(i[v]||{},o)),{static:r,dynamic:o}},getMaxBitrate:function(e){var t=p(e);return g(it,t,"mb")||-1},getEstimatedThroughput:function(e){var t=p(e);return g(it,t,"etp")||null},getResponseDelay:function(e){var t=p(e);return g(it,t,"rd")||null},getRoundTripTime:function(e){var t=p(e);return g(it,t,"rtt")||null}},t=(0,d.Z)(r).getInstance().getLogger(e),o(),e}dt.__dashjs_factory_name="CmsdModel";var ht=u.Z.getSingletonFactory(dt);function ft(){var e,t,n=this.context,i={};function r(){t=(0,d.Z)(n).getInstance().getLogger(e)}function a(e){for(var t={},n=0,i=0,r=0,a=0,o=e.length,s=0;s<o;++s)n+=e[s].chunkDownloadTimeRelativeMS,i+=e[s].bufferLevel,r+=e[s].chunkDownloadTimeRelativeMS*e[s].bufferLevel,a+=e[s].chunkDownloadTimeRelativeMS*e[s].chunkDownloadTimeRelativeMS;return t.m=(r-n*i/o)/(a-n*n/o),t.b=i/o-t.m*n/o,function(e){return t.m*e+t.b}}function o(e){var t,n=!0,i=e.reduce(function(e,t){return e+t.bufferLevelAtSegmentEnd},0)/e.length;return e.forEach(function(e){Math.abs(e.bufferLevelAtSegmentEnd/e.bufferLevelAtSegmentStart)<.95&&(n=!1),e.bufferLevelAtSegmentEnd/i<.8&&(n=!1),t?t>e.bitrate&&(n=!1):t=e.bitrate}),n}return e={setup:r,addMeasurement:function(e,t,n,r,o){e&&e.mediaType&&!i[e.mediaType]&&(i[e.mediaType]=[]);var s=e.mediaInfo.bitrateList.find(function(t){return t.id===e.representationId});i[e.mediaType].push({index:e.index,repId:e.representationId,mediaType:e.mediaType,requestTimeMS:r,adjustedAvailabilityStartTimeMS:e.availabilityStartTime.getTime(),segDurationMS:1e3*e.duration,chunksDurationMS:n.reduce(function(e,t){return e+t.chunkDownloadDurationMS},0),segmentBytes:n.reduce(function(e,t){return e+t.chunkBytes},0),bitrate:s&&s.bandwidth,bitrateList:e.mediaInfo.bitrateList,chunkMeasurements:n,fetchDownloadDurationMS:t,throughputCapacityDelayMS:o,getEstimatedBufferLevel:a(n.slice(1))}),i[e.mediaType].length>10&&i[e.mediaType].shift()},getThroughputCapacityDelayMS:function(e,t){var n=i[e.mediaType]&&i[e.mediaType].slice(-3);return!n||n.length<3?0:o(n)?t/4>250?250:t/4:0},getEstimatedDownloadDurationMS:function(e){var n=i[e.mediaType].slice(-1).pop(),r=i[e.mediaType].slice(-3),a=n.chunkMeasurements.slice(-1).pop().chunkDownloadTimeRelativeMS;n.bufferLevelAtSegmentStart=n.getEstimatedBufferLevel(a/2),n.bufferLevelAtSegmentEnd=n.getEstimatedBufferLevel(a);var s=o(r),l=s?.6:.8;if(n.isBufferStable&&1.05*n.segDurationMS<n.fetchDownloadDurationMS)return n.fetchDownloadDurationMS;if(!s||n.segDurationMS<n.fetchDownloadDurationMS||n.adjustedAvailabilityStartTimeMS<=n.requestTimeMS+n.throughputCapacityDelayMS-n.segDurationMS)return.8*n.fetchDownloadDurationMS;for(var c=n.requestTimeMS+n.throughputCapacityDelayMS-n.adjustedAvailabilityStartTimeMS,u=0,d=0,h=0,f=0;f<n.chunkMeasurements.length;f++){var p=n.chunkMeasurements[f];if(c<d+p.chunkDownloadDurationMS)break;d+=p.chunkDownloadDurationMS,u+=p.chunkBytes,h++}if(c<0&&t.warn("request time was before adjusted availibitly start time"),u&&d&&h>.2*n.chunkMeasurements.length){var g=u/d,m=n.segmentBytes/g;return n.fetchDownloadDurationMS<m?n.fetchDownloadDurationMS*l:m*l}var v=n.bitrate;return n.bitrateList.some(function(e){if(e.bandwidth>n.bitrate)return v=e.bandwidth,!0}),v===n.bitrate?n.fetchDownloadDurationMS*l:l*n.segmentBytes*8*1e3/v}},r(),e}ft.__dashjs_factory_name="LowLatencyThroughputModel";var pt=u.Z.getSingletonFactory(ft),gt=n(5717);function mt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vt(e){e=e||{};var t,n,i,r,o,s,u,h,f,p,g,m=this.context,v=e.errHandler,y=e.dashMetrics,_=e.mediaPlayerModel,E=e.requestModifier,b=e.boxParser,S=e.errors,w=e.requestTimeout||0,A=(0,l.Z)(m).getInstance(),R=(0,I.Z)(m).getInstance();function x(e,t){var l,d=e.request,g=[],S=!0,I=!0,M=new Date,C=M,P=0,D=null,O=null;if(!E||!y||!v)throw new Error("config object is not correct or missing");var N,k=function(e){d.requestStartDate=M,d.requestEndDate=new Date,d.firstByteDate=d.firstByteDate||M,d.fileLoaderType=O;var t=l.response?l.response.responseURL:null,n=l.response?l.response.status:null,i=l.response&&l.response.getAllResponseHeaders?l.response.getAllResponseHeaders():l.response?l.response.responseHeaders:null,r=i&&R.get().streaming.cmsd&&R.get().streaming.cmsd.enabled?u.parseResponseHeaders(i,d.mediaType):null;y.addHttpRequest(d,t,n,i,e?g:null,r)},F=function(e){I=!1,k(e),d.type===L.w.MPD_TYPE&&(y.addManifestUpdate(d),A.trigger(c.Z.MANIFEST_LOADING_FINISHED,{request:d}))},B=function(){if(D&&(clearTimeout(D),D=null),-1!==n.indexOf(l)&&(n.splice(n.indexOf(l),1),I))if(F(!1),t>0){try{R.get().streaming.utcSynchronization.enableBackgroundSyncAfterSegmentDownloadError&&d.type===L.w.MEDIA_SEGMENT_TYPE&&_.getRetryAttemptsForType(L.w.MEDIA_SEGMENT_TYPE)===t&&A.trigger(c.Z.ATTEMPT_BACKGROUND_SYNC)}catch(e){}t--;var i={config:e};r.push(i),i.timeout=setTimeout(function(){-1!==r.indexOf(i)&&(r.splice(r.indexOf(i),1),x(e,t))},_.getRetryIntervalsForType(d.type))}else{if(d.type===L.w.MSS_FRAGMENT_INFO_SEGMENT_TYPE)return;v.error(new T.Z(o[d.type],d.url+" is not available",{request:d,response:l.response})),e.error&&e.error(d,"error",l.response.statusText,l.response),e.complete&&e.complete(d,l.response.statusText)}};d.hasOwnProperty("availabilityTimeComplete")&&!1===d.availabilityTimeComplete&&window.fetch&&"arraybuffer"===d.responseType&&d.type===L.w.MEDIA_SEGMENT_TYPE?((N=de(m).create({requestModifier:E,lowLatencyThroughputModel:f,boxParser:b})).setup({dashMetrics:y}),O=a.Z.FILE_LOADER_TYPES.FETCH):(N=(0,se.Z)(m).create({requestModifier:E}),O=a.Z.FILE_LOADER_TYPES.XHR);var U=null,V=E.modifyRequestURL?E.modifyRequestURL(d.url):d.url;if(R.get().streaming.cmcd&&R.get().streaming.cmcd.enabled){var G=R.get().streaming.cmcd.mode;if(G===a.Z.CMCD_MODE_QUERY){var H=function(e){try{var t=[],n=s.getQueryParameter(e);return n&&t.push(n),t}catch(e){return[]}}(d);V=je.Z.addAditionalQueryParameterToUrl(V,H)}else G===a.Z.CMCD_MODE_HEADER&&(U=s.getHeaderParameters(d))}var j=h.getXHRWithCredentialsForType(d.type);if(d.queryParams){var z=Object.keys(d.queryParams).map(function(e){return{key:e,value:d.queryParams[e]}});V=je.Z.addAditionalQueryParameterToUrl(V,z)}d.url=V,l={url:V,method:L.w.GET,withCredentials:j,request:d,onload:function(){l.response.status>=200&&l.response.status<=299&&(F(!0),e.success&&e.success(l.response.response,l.response.statusText,l.response.responseURL),e.complete&&e.complete(d,l.response.statusText))},onend:B,onerror:B,progress:function(t){var n=new Date;S&&(S=!1,(!t.lengthComputable||t.lengthComputable&&t.total!==t.loaded)&&(d.firstByteDate=n)),t.lengthComputable&&(d.bytesLoaded=t.loaded,d.bytesTotal=t.total),t.noTrace||(g.push({s:C,d:t.time?t.time:n.getTime()-C.getTime(),b:[t.loaded?t.loaded-P:0]}),C=n,P=t.loaded),D&&(clearTimeout(D),D=null),R.get().streaming.fragmentRequestProgressTimeout>0&&(D=setTimeout(function(){p.warn("Abort request "+l.url+" due to progress timeout"),l.response.onabort=null,l.loader.abort(l),B()},R.get().streaming.fragmentRequestProgressTimeout)),e.progress&&t&&e.progress(t)},onabort:function(){k(!0),D&&(clearTimeout(D),D=null),e.abort&&e.abort(d)},ontimeout:function(e){var t;if(e.lengthComputable){var n=e.loaded/e.total*100;t="Request timeout: loaded: "+e.loaded+", out of: "+e.total+" : "+n.toFixed(3)+"% Completed"}else t="Request timeout: non-computable download size";p.warn(t)},loader:N,timeout:w,headers:U};var Z=(new Date).getTime();if(isNaN(d.delayLoadingTime)||Z>=d.delayLoadingTime)n.push(l),N.load(l);else{var q={httpRequest:l};i.push(q),q.delayTimeout=setTimeout(function(){if(-1!==i.indexOf(q)){i.splice(i.indexOf(q),1);try{M=new Date,C=M,n.push(q.httpRequest),N.load(q.httpRequest)}catch(e){q.httpRequest.onerror()}}},d.delayLoadingTime-Z)}}return t={load:function(e){e.request?x(e,_.getRetryAttemptsForType(e.request.type)):e.error&&e.error(e.request,"error")},abort:function(){r.forEach(function(e){clearTimeout(e.timeout),e.config.request&&e.config.abort&&e.config.abort(e.config.request)}),r=[],i.forEach(function(e){return clearTimeout(e.delayTimeout)}),i=[],n.forEach(function(e){e.request.type!==L.w.MSS_FRAGMENT_INFO_SEGMENT_TYPE&&(e.onloadend=e.onerror=e.onprogress=void 0,e.loader.abort(e))}),n=[]}},p=(0,d.Z)(m).getInstance().getLogger(t),n=[],i=[],r=[],s=We(m).getInstance(),u=ht(m).getInstance(),f=pt(m).getInstance(),h=(0,gt.Z)(m).getInstance(),mt(g={},L.w.MPD_TYPE,S.DOWNLOAD_ERROR_ID_MANIFEST_CODE),mt(g,L.w.XLINK_EXPANSION_TYPE,S.DOWNLOAD_ERROR_ID_XLINK_CODE),mt(g,L.w.INIT_SEGMENT_TYPE,S.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE),mt(g,L.w.MEDIA_SEGMENT_TYPE,S.DOWNLOAD_ERROR_ID_CONTENT_CODE),mt(g,L.w.INDEX_SEGMENT_TYPE,S.DOWNLOAD_ERROR_ID_CONTENT_CODE),mt(g,L.w.BITSTREAM_SWITCHING_SEGMENT_TYPE,S.DOWNLOAD_ERROR_ID_CONTENT_CODE),mt(g,L.w.OTHER_TYPE,S.DOWNLOAD_ERROR_ID_CONTENT_CODE),o=g,t}vt.__dashjs_factory_name="HTTPLoader";var yt=u.Z.getClassFactory(vt);function _t(){var e;function t(){e={}}function n(){t()}return n(),{getLoader:function(t){for(var n in e)if(e.hasOwnProperty(n)&&t.startsWith(n))return e[n];return yt},registerLoader:function(t,n){e[t]=n},unregisterLoader:function(t){e[t]&&delete e[t]},unregisterAllLoader:t,reset:n}}_t.__dashjs_factory_name="SchemeLoaderFactory";var Et=u.Z.getSingletonFactory(_t);function bt(e){e=e||{};var t,n,i=this.context;return t=Et(i).getInstance(),{load:function(r){if(!n){var a=t.getLoader(r&&r.request?r.request.url:null);n=a(i).create({errHandler:e.errHandler,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,dashMetrics:e.dashMetrics,boxParser:e.boxParser?e.boxParser:null,constants:e.constants?e.constants:null,dashConstants:e.dashConstants?e.dashConstants:null,urlUtils:e.urlUtils?e.urlUtils:null,requestTimeout:isNaN(e.requestTimeout)?0:e.requestTimeout,errors:e.errors})}n.load(r)},abort:function(){n&&n.abort()}}}bt.__dashjs_factory_name="URLLoader";var Tt=u.Z.getClassFactory(bt);function St(e){return(St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wt(e,t){return(wt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function At(e,t){return!t||"object"!==St(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Rt(e){return(Rt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var xt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wt(e,t)}(r,e);var t,n,i=(t=r,n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=Rt(t);if(n){var r=Rt(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return At(this,e)});function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=i.call(this,e)).checkForExistenceOnly=!0,t}return r}(g.Z);function It(e){e=e||{};var t,n,i=this.context,r=e.eventBus,o=e.events,s=e.urlUtils,l=e.errors,c=e.streamId;return t={checkForExistence:function(e){var t=function(t){r.trigger(o.CHECK_FOR_EXISTENCE_COMPLETED,{request:e,exists:t})};if(e){var i=new xt(e.url);n.load({request:i,success:function(){t(!0)},error:function(){t(!1)}})}else t(!1)},load:function(e){var i=function(n,i){r.trigger(o.LOADING_COMPLETED,{request:e,response:n||null,error:i||null,sender:t})};e?n.load({request:e,progress:function(n){r.trigger(o.LOADING_PROGRESS,{request:e,stream:n.stream,streamId:c}),n.data&&r.trigger(o.LOADING_DATA_PROGRESS,{request:e,response:n.data||null,error:null,sender:t})},success:function(e){i(e)},error:function(e,t,n){i(void 0,new T.Z(l.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE,n,t))},abort:function(e){e&&r.trigger(o.LOADING_ABANDONED,{mediaType:e.mediaType,request:e,sender:t})}}):i(void 0,new T.Z(l.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE,l.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE))},abort:function(){n&&n.abort()},reset:function(){n&&(n.abort(),n=null)}},n=Tt(i).create({errHandler:e.errHandler,errors:l,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,urlUtils:s,constants:a.Z,boxParser:e.boxParser,dashConstants:e.dashConstants,requestTimeout:e.settings.get().streaming.fragmentRequestTimeout}),t}It.__dashjs_factory_name="FragmentLoader";var Lt=u.Z.getClassFactory(It);function Mt(){return{modifyResponseAsync:function(e){return Promise.resolve(e)}}}Mt.__dashjs_factory_name="SegmentResponseModifier";var Ct=u.Z.getSingletonFactory(Mt);function Pt(e){e=e||{};var t,n,i,r=this.context,o=(0,l.Z)(r).getInstance(),s=e.errHandler,u=e.mediaPlayerModel,f=e.dashMetrics,p=(0,d.Z)(r).getInstance(),g=Ct(r).getInstance(),m=e.streamInfo;function v(){return m.id}function y(){for(var e in i)i[e].reset();i={}}function _(e){if(e.sender){var t=e.request,i=e.response,r=t.isInitializationRequest(),s=t.mediaInfo.streamInfo;if(e.error&&(t.mediaType===a.Z.AUDIO||t.mediaType===a.Z.VIDEO||t.mediaType===a.Z.TEXT&&t.mediaInfo.isFragmented)&&o.trigger(c.Z.SERVICE_LOCATION_BASE_URL_BLACKLIST_ADD,{entry:e.request.serviceLocation}),i&&s){var l=(u=i,d=t,h=m.id,f=e.type!==c.Z.FRAGMENT_LOADING_PROGRESS,(p=new oe).streamId=h,p.mediaInfo=d.mediaInfo,p.segmentType=d.type,p.start=d.startTime,p.duration=d.duration,p.end=p.start+p.duration,p.bytes=u,p.index=d.index,p.quality=d.quality,p.representationId=d.representationId,p.endFragment=f,p);g.modifyResponseAsync(l).then(function(e){o.trigger(r?c.Z.INIT_FRAGMENT_LOADED:c.Z.MEDIA_FRAGMENT_LOADED,{chunk:e,request:t},{streamId:s.id,mediaType:t.mediaType})}).catch(function(e){n.error(e),o.trigger(r?c.Z.INIT_FRAGMENT_LOADED:c.Z.MEDIA_FRAGMENT_LOADED,{chunk:l,request:t},{streamId:s.id,mediaType:t.mediaType})})}else n.warn("No "+t.mediaType+" bytes to push or stream is inactive.")}var u,d,h,f,p}return t={getStreamId:v,getModel:function(t){var n=i[t];return n||(n=b(r).create({streamInfo:m,type:t,dashMetrics:f,fragmentLoader:Lt(r).create({dashMetrics:f,mediaPlayerModel:u,errHandler:s,requestModifier:(0,X.Z)(r).getInstance(),settings:e.settings,boxParser:e.boxParser,eventBus:o,events:c.Z,errors:x,dashConstants:e.dashConstants,urlUtils:e.urlUtils,streamId:v()}),debug:p,eventBus:o,events:c.Z}),i[t]=n),n},reset:function(){o.off(h.Z.FRAGMENT_LOADING_COMPLETED,_,this),o.off(h.Z.FRAGMENT_LOADING_PROGRESS,_,this),y()}},n=p.getLogger(t),y(),o.on(h.Z.FRAGMENT_LOADING_COMPLETED,_,t),o.on(h.Z.FRAGMENT_LOADING_PROGRESS,_,t),t}Pt.__dashjs_factory_name="FragmentController";var Dt=u.Z.getClassFactory(Pt),Ot=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.url=null,this.width=null,this.height=null,this.x=null,this.y=null},Nt=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.mediaType=null,this.bitrate=null,this.width=null,this.height=null,this.scanType=null,this.qualityIndex=NaN};function kt(e){var t,n,i=this.context,r=e.streamInfo;function o(e){n.setTrackByIndex(e)}function s(){n&&n.reset()}return t={getStreamId:function(){return r.id},initialize:function(){n.addTracks();var e=n.getTracks();e&&e.length>0&&o(0)},provide:function(e,t){if("function"==typeof t){var i,r,a=n.getCurrentTrack();if(!a||a.segmentDuration<=0||null==e)t(null);else{(r=n.getThumbnailRequestForTime(e))&&(a.segmentDuration=r.duration),i=e%a.segmentDuration;var o=Math.floor(i*a.tilesHor*a.tilesVert/a.segmentDuration),s=new Ot;if(s.width=Math.floor(a.widthPerTile),s.height=Math.floor(a.heightPerTile),s.x=Math.floor(o%a.tilesHor)*a.widthPerTile,s.y=Math.floor(o/a.tilesHor)*a.heightPerTile,"readThumbnail"in a)return a.readThumbnail(e,function(e){s.url=e,t(s)});if(r)s.url=r.url,a.segmentDuration=NaN;else{var l=Math.floor(e/a.segmentDuration);s.url=(u=l+(c=a).startNumber,d=(0,Z.vi)(c.templateUrl,"Number",u),d=(0,Z.vi)(d,"Time",(u-1)*c.segmentDuration*c.timescale),d=(0,Z.vi)(d,"Bandwidth",c.bandwidth),(0,Z.eR)(d))}t(s)}}var c,u,d},setTrackByIndex:o,getCurrentTrackIndex:function(){return n.getCurrentTrackIndex()},getBitrateList:function(){var e=n.getTracks(),t=0;return e.map(function(e){var n=new Nt;return n.mediaType=a.Z.IMAGE,n.qualityIndex=t++,n.bitrate=e.bitrate,n.width=e.width,n.height=e.height,n})},reset:s},s(),n=(0,Pe.Z)(i).create({streamInfo:r,adapter:e.adapter,baseURLController:e.baseURLController,timelineConverter:e.timelineConverter,debug:e.debug,eventBus:e.eventBus,events:e.events,dashConstants:e.dashConstants,dashMetrics:e.dashMetrics,segmentBaseController:e.segmentBaseController}),t}kt.__dashjs_factory_name="ThumbnailController";var Ft=u.Z.getClassFactory(kt),Bt=n(7417);function Ut(e){var t;e=e||{};var n=[],i=(0,l.Z)(this.context).getInstance(),r=e.updateEventName,a=e.addBlacklistEventName;function o(e){-1===n.indexOf(e)&&(n.push(e),i.trigger(r,{entry:e}))}return t={add:o,contains:function(e){return!!(n.length&&e&&e.length)&&-1!==n.indexOf(e)},reset:function(){n=[]}},a&&i.on(a,function(e){o(e.entry)},t),t}Ut.__dashjs_factory_name="BlackListController";var Vt=u.Z.getClassFactory(Ut),Gt=[a.Z.VIDEO,a.Z.AUDIO,a.Z.TEXT,a.Z.MUXED,a.Z.IMAGE];function Ht(e){e=e||{};var t,n,i,r,s,u,h,f,p,g,m,v,y,_,E,b,S,w,A=this.context,R=(0,l.Z)(A).getInstance(),I=(0,Q.Z)(A).getInstance(),L=e.manifestModel,M=e.mediaPlayerModel,C=e.dashMetrics,P=e.manifestUpdater,D=e.adapter,O=e.timelineConverter,N=e.capabilities,k=e.errHandler,F=e.abrController,B=e.playbackController,U=e.eventController,V=e.mediaController,G=e.protectionController,H=e.textController,j=e.videoModel,z=e.streamInfo,Z=e.settings;function q(e,t){return new Promise(function(r,o){ne(),g=!0,re();var s=j.getElement(),l=[];Gt.forEach(function(t){(t!==a.Z.TEXT||e)&&(t!==a.Z.VIDEO||!s||s&&/^VIDEO$/i.test(s.nodeName))&&l.push(W(t,e))}),Promise.all(l).then(function(){return e=t,new Promise(function(t){var n={},r=i.map(function(t){return t.createBufferSinks(e)});Promise.all(r).then(function(e){e.forEach(function(e){e&&(n[e.getType()]=e)}),t(n)}).catch(function(){t(n)})});var e}).then(function(t){if(g=!1,0===i.length){var a="No streams to play.";k.error(new T.Z(x.MANIFEST_ERROR_ID_NOSTREAMS_CODE,a,L.getValue())),n.fatal(a)}else oe();e&&H.createTracks(z),r(t)}).catch(function(e){o(e)})})}function W(t,r){var s,l=D.getAllMediaInfoForType(z,t),u=[],d=null;if(!l||0===l.length)return n.info("No "+t+" data."),Promise.resolve();t===a.Z.VIDEO&&(h=!0),t===a.Z.AUDIO&&(f=!0);for(var p=0,g=l.length;p<g;p++)d=l[p],t===a.Z.TEXT&&d.isEmbedded&&(H.addEmbeddedTrack(z,d),u.push(d)),Y(d)&&V.addTrack(d);if(u.length>0&&(V.setInitialMediaSettingsForType(t,z),H.addMediaInfosToBuffer(z,t,u)),0===(l=l.filter(function(e){return!e.isEmbedded})).length)return Promise.resolve();if(t===a.Z.IMAGE)return(v=Ft(A).create({streamInfo:z,adapter:D,baseURLController:e.baseURLController,timelineConverter:e.timelineConverter,debug:b,eventBus:R,events:c.Z,dashConstants:o.Z,dashMetrics:e.dashMetrics,segmentBaseController:e.segmentBaseController})).initialize(),Promise.resolve();R.trigger(c.Z.STREAM_INITIALIZING,{streamInfo:z,mediaInfo:d}),V.setInitialMediaSettingsForType(t,z);var _=function(t,n){var r=t&&t.length>0?t[0]:null,o=m.getModel(r?r.type:null),s=r?r.type:null,l=r?r.mimeType:null,c=r?r.isFragmented:null,u=ae(A).create({streamInfo:z,type:s,mimeType:l,timelineConverter:O,adapter:D,manifestModel:L,mediaPlayerModel:M,fragmentModel:o,dashMetrics:e.dashMetrics,baseURLController:e.baseURLController,segmentBaseController:e.segmentBaseController,abrController:F,playbackController:B,mediaController:V,textController:H,errHandler:k,settings:Z,boxParser:E,segmentBlacklistController:y});u.initialize(n,h,c),i.push(u);for(var d=0;d<t.length;d++)u.addMediaInfo(t[d]);return s===a.Z.TEXT&&H.addMediaInfosToBuffer(z,s,t,o),u}(l,r);return(s=V.getCurrentTrackFor(t,z.id))?(F.updateTopQualityIndex(s),_.selectMediaInfo(t===a.Z.TEXT&&s.isEmbedded?l[0]:s)):Promise.resolve()}function Y(e){var t,i=e?e.type:null;return i===a.Z.MUXED?(t="Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines",n.fatal(t),k.error(new T.Z(x.MANIFEST_ERROR_ID_MULTIPLEXED_CODE,t,L.getValue())),!1):!(i!==a.Z.TEXT&&i!==a.Z.IMAGE&&e.contentProtection&&!N.supportsEncryptedMedia()&&(k.error(new T.Z(x.CAPABILITY_MEDIAKEYS_ERROR_CODE,x.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE)),1))}function K(e){for(var t=i?i.length:0,n=0;n<t;n++){var r=i[n].getFragmentModel();r.abortRequests(),r.resetInitialSettings(),i[n].reset(!1,e)}H&&H.deactivateStream(z),i=[],s=!1,u=!1,me(!1),J(!1),R.trigger(c.Z.STREAM_DEACTIVATED,{streamInfo:z})}function X(e){K(e),r=!1,h=!1,f=!1,p={},g=!1,S=!1,w=[]}function J(e){S=e}function $(){return z?z.start:NaN}function ee(){return z?z.id:null}function te(){return z}function ne(){if(!j||!F)throw new Error(a.Z.MISSING_CONFIG_ERROR)}function ie(e){e.error&&(k.error(e.error),n.fatal(e.error.message))}function re(){if(U){var e=D.getEventsFor(z);e&&e.length>0&&U.addInlineEvents(e,z.id)}}function oe(){for(var e=i.length,t=p.audio||p.video?new T.Z(x.DATA_UPDATE_FAILED_ERROR_CODE,x.DATA_UPDATE_FAILED_ERROR_MESSAGE):null,n=0;n<e;n++)if(i[n].isUpdating()||g)return;if(G){G.clearMediaInfoArray();for(var o=0;o<e&&i[o];o++){var s=i[o].getType(),l=i[o].getMediaInfo();if(s===a.Z.AUDIO||s===a.Z.VIDEO||s===a.Z.TEXT&&l.isFragmented){var u=i[o].getMediaInfo();u&&G.initializeForMedia(u)}}G.handleKeySystemFromManifest()}t?k.error(t):r||(r=!0,j.waitForReadyState(a.Z.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,function(){R.trigger(c.Z.STREAM_INITIALIZED,{streamInfo:z})}))}function se(){var e=he(),t=e.length;if(0!==t){for(var i=0;i<t;i++)if(!e[i].isBufferingCompleted()&&(e[i].getType()===a.Z.AUDIO||e[i].getType()===a.Z.VIDEO))return void n.debug("onBufferingCompleted - One streamProcessor has finished but",e[i].getType(),"one is not buffering completed");n.debug("onBufferingCompleted - trigger STREAM_BUFFERING_COMPLETED"),u=!0,R.trigger(c.Z.STREAM_BUFFERING_COMPLETED,{streamInfo:z},{streamInfo:z})}else n.warn("onBufferingCompleted - can't trigger STREAM_BUFFERING_COMPLETED because no streamProcessor is defined")}function le(e){p[e.mediaType]=e.error,oe()}function ce(e){U&&U.addInbandEvents(e.events,z.id)}function ue(e){return e&&e.type?de(e.type):null}function de(e){return e?he().filter(function(t){return t.getType()===e})[0]:null}function he(){for(var e,t,n=[],r=0;r<i.length;r++)(e=(t=i[r]).getType())!==a.Z.AUDIO&&e!==a.Z.VIDEO&&e!==a.Z.TEXT||n.push(t);return n}function fe(e,t){var n=te(),i=t.getStreamInfo();if(!i||!n)return!0;var r=D.getAdaptationForType(i.index,e,i),a=D.getAdaptationForType(n.index,e,n);return r&&a?!(!pe(a)&&pe(r)):!r&&!a}function pe(e){return!!e&&!!(e.ContentProtection||e.Representation_asArray&&e.Representation_asArray.length>0&&e.Representation_asArray[0].ContentProtection)}function ge(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e||!e.hasOwnProperty("getStreamInfo"))return!1;var i=e.getStreamInfo(),r=n?n.getStreamInfo():te();if(!i||!r)return!1;var a=D.getAdaptationForType(i.index,t,i),o=D.getAdaptationForType(r.index,t,r);if(!a||!o)return!a&&!o;var s=a&&o&&a.mimeType===o.mimeType,l=o.Representation_asArray.map(function(e){return e.codecs}),c=a.Representation_asArray.map(function(e){return e.codecs}),u=c.some(function(e){return l.indexOf(e)>-1}),d=c.some(function(e){return l.some(function(t){return N.codecRootCompatibleWithCodec(t,e)})});return u||d&&s}function me(e){_=e}function ve(){return _}return t={initialize:function(){R.on(c.Z.BUFFERING_COMPLETED,se,t),R.on(c.Z.DATA_UPDATE_COMPLETED,le,t),R.on(c.Z.INBAND_EVENTS,ce,t),G&&(R.on(c.Z.KEY_ERROR,ie,t),R.on(c.Z.SERVER_CERTIFICATE_UPDATED,ie,t),R.on(c.Z.LICENSE_REQUEST_COMPLETE,ie,t),R.on(c.Z.KEY_SYSTEM_SELECTED,ie,t),R.on(c.Z.KEY_SESSION_CREATED,ie,t),R.on(c.Z.KEY_STATUSES_CHANGED,ie,t)),H.initializeForStream(z),R.trigger(c.Z.STREAM_UPDATED,{streamInfo:z})},getStreamId:function(){return z?z.id:null},activate:function(e,t){return new Promise(function(n,i){if(!s)return ve()?(s=!0,R.trigger(c.Z.STREAM_ACTIVATED,{streamInfo:z}),void n(t)):void(r=e,a=t,q(r,a)).then(function(e){s=!0,R.trigger(c.Z.STREAM_ACTIVATED,{streamInfo:z}),n(e)}).catch(function(e){i(e)});var r,a;n(t)})},deactivate:K,getIsActive:function(){return s},getDuration:function(){return z?z.duration:NaN},getStartTime:$,getId:ee,getStreamInfo:te,getHasAudioTrack:function(){return f},getHasVideoTrack:function(){return h},startPreloading:function(e,t){return new Promise(function(r,a){ve()?a():(n.info("[startPreloading] Preloading next stream with id ".concat(ee())),me(!0),q(e,t).then(function(){for(var e=0;e<i.length&&i[e];e++)i[e].setExplicitBufferingTime($()),i[e].getScheduleController().startScheduleTimer();r()}).catch(function(){me(!1),a()}))})},initializeForTextWithMediaSource:function(e){return new Promise(function(t,n){W(a.Z.TEXT,e).then(function(){return(e=de(a.Z.TEXT))?e.createBufferSinks():Promise.resolve();var e}).then(function(){H.createTracks(z),t()}).catch(function(e){n(e)})})},getThumbnailController:function(){return v},getBitrateListFor:function(e){if(ne(),e===a.Z.IMAGE)return v?v.getBitrateList():[];var t=function(e){for(var t=null,n=0;n<i.length;n++)if((t=i[n]).getType()===e)return t.getMediaInfo();return null}(e);return F.getBitrateList(t)},updateData:function(e){return new Promise(function(t){g=!0,z=e,U&&re();for(var n=[],r=0,a=i.length;r<a;r++){var o=i[r],s=o.getMediaInfo();n.push(o.updateStreamInfo(z));var l=D.getAllMediaInfoForType(z,o.getType());if(l=l.filter(function(e){return!e.isEmbedded})){o.clearMediaInfoArray();for(var u=0;u<l.length;u++){var d=l[u];o.addMediaInfo(l[u]),D.areMediaInfosEqual(s,d)&&(F.updateTopQualityIndex(d),n.push(o.selectMediaInfo(d)))}}}Promise.all(n).then(function(){for(n=[];w.length>0;){var e=w.pop(),t=e.newMediaInfo,i=ue(e.oldMediaInfo);if(!i)return;n.push(i.prepareTrackSwitch()),n.push(i.selectMediaInfo(t))}return Promise.all(n)}).then(function(){g=!1,oe(),R.trigger(c.Z.STREAM_UPDATED,{streamInfo:z}),t()})})},reset:function(e){m&&(m.reset(),m=null),F&&z&&F.clearDataForStream(z.id),y&&(y.reset(),y=null),X(e),z=null,R.off(c.Z.DATA_UPDATE_COMPLETED,le,t),R.off(c.Z.BUFFERING_COMPLETED,se,t),R.off(c.Z.INBAND_EVENTS,ce,t),G&&(R.off(c.Z.KEY_ERROR,ie,t),R.off(c.Z.SERVER_CERTIFICATE_UPDATED,ie,t),R.off(c.Z.LICENSE_REQUEST_COMPLETE,ie,t),R.off(c.Z.KEY_SYSTEM_SELECTED,ie,t),R.off(c.Z.KEY_SESSION_CREATED,ie,t),R.off(c.Z.KEY_STATUSES_CHANGED,ie,t))},getProcessors:he,setMediaSource:function(e){return new Promise(function(t,r){for(var a=[],o=0;o<i.length;)Y(i[o].getMediaInfo())?(a.push(i[o].setMediaSource(e)),o++):(i[o].reset(),i.splice(o,1));Promise.all(a).then(function(){for(var e=0;e<i.length;e++)i[e].dischargePreBuffer();if(0===i.length){var r="No streams to play.";k.error(new T.Z(x.MANIFEST_ERROR_ID_NOSTREAMS_CODE,r+"nostreams",L.getValue())),n.fatal(r)}t()}).catch(function(e){n.error(e),r(e)})})},isMediaCodecCompatible:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return ge(e,a.Z.VIDEO,t)&&ge(e,a.Z.AUDIO,t)},isProtectionCompatible:function(e){return!e||fe(a.Z.VIDEO,e)&&fe(a.Z.AUDIO,e)},getPreloaded:ve,getIsEndedEventSignaled:function(){return S},setIsEndedEventSignaled:J,getAdapter:function(){return D},getHasFinishedBuffering:function(){return u},setPreloaded:me,startScheduleControllers:function(){for(var e=i.length,t=0;t<e&&i[t];t++)i[t].getScheduleController().startScheduleTimer()},prepareTrackChange:function(e){if(s&&z){u=!1;var t=e.newMediaInfo,i=L.getValue();D.setCurrentMediaInfo(z.id,t.type,t);var r=ue(t);if(r){var o=B.getTime();n.info("Stream -  Process track changed at current time "+o),i.refreshManifestOnSwitchTrack?(w.push(e),P.getIsUpdating()||(n.debug("Stream -  Refreshing manifest for switch track"),P.refreshManifest())):r.selectMediaInfo(t).then(function(){t.type!==a.Z.VIDEO&&t.type!==a.Z.AUDIO||F.updateTopQualityIndex(t),r.prepareTrackSwitch()})}}},prepareQualityChange:function(e){var t=de(e.mediaType);t&&t.prepareQualityChange(e)}},function(){try{b=(0,d.Z)(A).getInstance(),n=b.getLogger(t),X(),E=(0,Bt.Z)(A).getInstance(),y=Vt(A).create({updateEventName:c.Z.SEGMENT_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:c.Z.SEGMENT_LOCATION_BLACKLIST_ADD}),m=Dt(A).create({streamInfo:z,mediaPlayerModel:M,dashMetrics:C,errHandler:k,settings:Z,boxParser:E,dashConstants:o.Z,urlUtils:I})}catch(e){throw e}}(),t}Ht.__dashjs_factory_name="Stream";var jt=u.Z.getClassFactory(Ht),zt=function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.url=t||null,this.type=L.w.CONTENT_STEERING_TYPE,this.responseType="json"},Zt=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.version=null,this.ttl=300,this.reloadUri=null,this.pathwayPriority=[],this.pathwayClones=[]};function qt(){var e,t,n,i,r,a,s,l,c,u,f,p,g,m,v,y=this.context,_=(0,Q.Z)(y).getInstance();function E(e){A(e,"baseUrl")}function b(e){A(e,"location")}function T(e){if(e&&e.request&&e.request.serviceLocation&&e.request.requestStartDate&&e.request.requestEndDate&&!isNaN(e.request.bytesTotal)){var t=e.request.serviceLocation,n=e.request.requestEndDate.getTime()-e.request.requestStartDate.getTime();w(t,parseInt(8*e.request.bytesTotal/n*1e3))}}function S(e){e&&e.httpRequest&&e.httpRequest._serviceLocation&&!isNaN(e.throughput)&&w(e.httpRequest._serviceLocation,1e3*e.throughput)}function w(e,t){r[e]||(r[e]=[]),r[e].push(t),r[e].length>4&&r[e].shift()}function A(e,t){if(e&&e.request&&e.request.serviceLocation){var n=e.request.serviceLocation;-1===i[t].all.indexOf(n)&&i[t].all.push(n),i[t].current=n}}function R(){var e=f.getValue(),t=v.getContentSteering(e);return t||(t=g.getServiceDescriptionSettings().contentSteering),t}function I(){return new Promise(function(e){try{var a=R();if(!a||!a.serverUrl)return void e();var l=function(e){var t=e.serverUrl;n&&n.reloadUri&&(t=_.isRelative(n.reloadUri)?_.resolve(n.reloadUri,e.serverUrl):n.reloadUri);var a=[],o=i.baseUrl.all.concat(i.location.all);if(o.length>0){var s=o.map(function(e){return{serviceLocation:e,throughput:function(e){if(!e||!r[e]||0===r[e].length)return-1;var t=r[e].reduce(function(e,t){return e+t})/r[e].length;return parseInt(t)}(e)}});s.sort(function(e,t){return t.throughput-e.throughput});var l="",c="";s.forEach(function(e,t){0!==t&&(l="".concat(l,","),e.throughput>-1&&(c="".concat(c,","))),l="".concat(l).concat(e.serviceLocation),e.throughput>-1&&(c="".concat(c).concat(e.throughput))}),a.push({key:"_DASH_pathway",value:'"'.concat(l,'"')}),a.push({key:"_DASH_throughput",value:c})}return je.Z.addAditionalQueryParameterToUrl(t,a)}(a),c=new zt(l);s.load({request:c,success:function(t){var i;(i=t)&&i[o.Z.CONTENT_STEERING_RESPONSE.VERSION]&&1===parseInt(i[o.Z.CONTENT_STEERING_RESPONSE.VERSION])&&((n=new Zt).version=i[o.Z.CONTENT_STEERING_RESPONSE.VERSION],i[o.Z.CONTENT_STEERING_RESPONSE.TTL]&&!isNaN(i[o.Z.CONTENT_STEERING_RESPONSE.TTL])&&(n.ttl=i[o.Z.CONTENT_STEERING_RESPONSE.TTL]),i[o.Z.CONTENT_STEERING_RESPONSE.RELOAD_URI]&&(n.reloadUri=i[o.Z.CONTENT_STEERING_RESPONSE.RELOAD_URI]),i[o.Z.CONTENT_STEERING_RESPONSE.PATHWAY_PRIORITY]&&(n.pathwayPriority=i[o.Z.CONTENT_STEERING_RESPONSE.PATHWAY_PRIORITY]),i[o.Z.CONTENT_STEERING_RESPONSE.PATHWAY_CLONES]&&(n.pathwayClones=i[o.Z.CONTENT_STEERING_RESPONSE.PATHWAY_CLONES],n.pathwayClones=n.pathwayClones.filter(function(e){return(t=e)[o.Z.CONTENT_STEERING_RESPONSE.BASE_ID]&&t[o.Z.CONTENT_STEERING_RESPONSE.ID]&&t[o.Z.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT]&&t[o.Z.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT][o.Z.CONTENT_STEERING_RESPONSE.HOST];var t})),C()),m.trigger(h.Z.CONTENT_STEERING_REQUEST_COMPLETED,{currentSteeringResponseData:n,url:l}),e()},error:function(i,r,a,o){(function(e,i){try{switch(t.warn("Error fetching data from content steering server",e),i.status){case 410:break;case 429:var r=i&&i.getResponseHeader?i.getResponseHeader("retry-after"):null;null!==r&&(n||(n={}),n.ttl=parseInt(r)),C();break;default:C()}}catch(e){t.error(e)}})(i,o),e(i)},complete:function(){i.baseUrl.all=L(i.baseUrl),i.location.all=L(i.location)}})}catch(t){e(t)}})}function L(e){return e.all&&0!==e.all.length&&e.current?e.all.filter(function(t){return t===e.current}):[]}function M(e){try{var i=[];return e&&0!==e.length&&n&&n.pathwayClones&&0!==n.pathwayClones.length&&n.pathwayClones.forEach(function(t){var n=e.filter(function(e){return t[o.Z.CONTENT_STEERING_RESPONSE.BASE_ID]===e.serviceLocation}),r=null;if(n&&n.length>0&&(r=n[0]),r){var a=new URL(r.url),s=t[o.Z.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT][o.Z.CONTENT_STEERING_RESPONSE.HOST];s=je.Z.stringHasProtocol(s)?s:"".concat(a.protocol,"//").concat(s);var l={synthesizedUrl:"".concat(s).concat(a.pathname),serviceLocation:t[o.Z.CONTENT_STEERING_RESPONSE.ID],queryParams:t[o.Z.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT][o.Z.CONTENT_STEERING_RESPONSE.PARAMS],reference:r};i.push(l)}}),i}catch(e){return t.error(e),[]}}function C(){n&&n.ttl&&!isNaN(n.ttl)&&(a&&clearTimeout(a),a=setTimeout(function(){I()},1e3*n.ttl))}function P(){a&&clearTimeout(a),a=null}function D(){n=null,r={},i={baseUrl:{current:null,all:[]},location:{current:null,all:[]}},P()}return e={reset:function(){D(),m.off(h.Z.FRAGMENT_LOADING_STARTED,E,e),m.off(h.Z.MANIFEST_LOADING_STARTED,b,e),m.off(h.Z.MANIFEST_LOADING_FINISHED,T,e),m.off(h.Z.THROUGHPUT_MEASUREMENT_STORED,S,e)},setConfig:function(e){e&&(e.adapter&&(v=e.adapter),e.errHandler&&(l=e.errHandler),e.dashMetrics&&(c=e.dashMetrics),e.mediaPlayerModel&&(u=e.mediaPlayerModel),e.requestModifier&&(p=e.requestModifier),e.manifestModel&&(f=e.manifestModel),e.serviceDescriptionController&&(g=e.serviceDescriptionController),e.eventBus&&(m=e.eventBus))},loadSteeringData:I,getCurrentSteeringResponseData:function(){return n},shouldQueryBeforeStart:function(){var e=R();return!!e&&e.queryBeforeStart},getSteeringDataFromManifest:R,stopSteeringRequestTimer:P,getSynthesizedBaseUrlElements:function(e){try{return M(e).map(function(e){var t=new Te(e.synthesizedUrl,e.serviceLocation);return t.queryParams=e.queryParams,t.dvbPriority=e.reference.dvbPriority,t.dvbWeight=e.reference.dvbWeight,t.availabilityTimeOffset=e.reference.availabilityTimeOffset,t.availabilityTimeComplete=e.reference.availabilityTimeComplete,t})}catch(e){return t.error(e),[]}},getSynthesizedLocationElements:function(e){try{return M(e).map(function(e){var t=new De(e.synthesizedUrl,e.serviceLocation);return t.queryParams=e.queryParams,t})}catch(e){return t.error(e),[]}},initialize:function(){s=Tt(y).create({errHandler:l,dashMetrics:c,mediaPlayerModel:u,requestModifier:p,errors:x}),m.on(h.Z.FRAGMENT_LOADING_STARTED,E,e),m.on(h.Z.MANIFEST_LOADING_STARTED,b,e),m.on(h.Z.MANIFEST_LOADING_FINISHED,T,e),m.on(h.Z.THROUGHPUT_MEASUREMENT_STORED,S,e)}},t=(0,d.Z)(y).getInstance().getLogger(e),D(),e}qt.__dashjs_factory_name="ContentSteeringController";var Wt=u.Z.getSingletonFactory(qt);function Yt(){var e,t,n,i=this.context,r=(0,I.Z)(i).getInstance();return e={select:function(e){if(!e||0===e.length)return null;var i,a,o=null;return r.get().streaming.applyContentSteering&&(i=e,o=(a=n.getCurrentSteeringResponseData())&&a.pathwayPriority&&a.pathwayPriority.length>0?function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=0,r=null,a=function(){var a=e[i],o=n.findIndex(function(e){return e.serviceLocation&&e.serviceLocation===a});if(-1!==o&&!t.contains(n[o].serviceLocation))return r=n[o],"break";i+=1};i<e.length&&"break"!==a(););return r}(a.pathwayPriority,i):null),o||(o=function(e){return e[0]}(e)),o},setConfig:function(e){e.blacklistController&&(t=e.blacklistController),e.contentSteeringController&&(n=e.contentSteeringController)},reset:function(){t.reset()}},t=Vt(i).create({updateEventName:c.Z.SERVICE_LOCATION_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:c.Z.SERVICE_LOCATION_LOCATION_BLACKLIST_ADD}),n=Wt(i).getInstance(),e}Yt.__dashjs_factory_name="LocationSelector";var Kt=u.Z.getClassFactory(Yt);function Xt(){var e,t,n,i,r,a,s,u,f,p,g,m,v,y,_=this.context,E=(0,l.Z)(_).getInstance(),b=(0,Q.Z)(_).getInstance();function T(){n=NaN,s=!1,r=!0,a=!1,S()}function S(){null!==i&&(clearTimeout(i),i=null)}function w(e){S(),a||(isNaN(e)&&!isNaN(n)&&(e=1e3*n),isNaN(e)||(t.debug("Refresh manifest in "+e+" milliseconds."),i=setTimeout(L,e)))}function A(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];s=!0;var t=f.getValue(),n=t.url,i=null,r=g.getPatchLocation(t),a=p.select(r),o=null;if(a&&!e)n=a.url,i=a.serviceLocation,o=a.queryParams;else{var l=R(t),c=p.select(l);c&&(n=c.url,i=c.serviceLocation,o=c.queryParams)}b.isRelative(n)&&(n=b.resolve(n,t.url)),u.load(n,i,o)}function R(e){var t=g.getLocation(e),n=v.getSynthesizedLocationElements(t);return t.concat(n)}function I(e){if(e){if(g.getIsPatch(e)){var i=e;e=f.getValue();var l=g.isPatchValid(e,i),u=l;if(l){var d=g.getPublishTime(e);u=g.applyPatchToManifest(e,i);var h=g.getPublishTime(e);u=d.getTime()!=h.getTime()}if(!u)return t.debug("Patch provided is invalid, performing full manifest refresh"),void A(!0);e.loadedTime=new Date}}else(e=f.getValue()).loadedTime=new Date;if(f.getValue()&&f.getValue().type===o.Z.DYNAMIC&&e.type===o.Z.STATIC)return E.trigger(c.Z.DYNAMIC_TO_STATIC),s=!1,void(a=!0);f.setValue(e);var p=new Date,m=(p.getTime()-e.loadedTime.getTime())/1e3;1e3*(n=g.getManifestUpdatePeriod(e,m))>2147483647&&(n=2147483.647),E.trigger(c.Z.MANIFEST_UPDATED,{manifest:e}),t.info("Manifest has been refreshed at "+p+"["+p.getTime()/1e3+"] "),r||w()}function L(){r||(s?w(y.get().streaming.manifestUpdateRetryInterval):A())}function M(e){e.error?e.error.code===x.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE&&m.error(e.error):I(e.manifest)}function C(){r=!1,w()}function P(){(r=!y.get().streaming.scheduling.scheduleWhilePaused)&&S()}function D(){s=!1}return e={initialize:function(){T(),E.on(c.Z.STREAMS_COMPOSED,D,this),E.on(h.Z.PLAYBACK_STARTED,C,this),E.on(h.Z.PLAYBACK_PAUSED,P,this),E.on(c.Z.INTERNAL_MANIFEST_LOADED,M,this)},setManifest:function(e){I(e)},refreshManifest:A,getIsUpdating:function(){return s},setConfig:function(e){e&&(e.manifestModel&&(f=e.manifestModel),e.adapter&&(g=e.adapter),e.manifestLoader&&(u=e.manifestLoader),e.errHandler&&(m=e.errHandler),e.locationSelector&&(p=e.locationSelector),e.settings&&(y=e.settings),e.contentSteeringController&&(v=e.contentSteeringController))},reset:function(){E.off(h.Z.PLAYBACK_STARTED,C,this),E.off(h.Z.PLAYBACK_PAUSED,P,this),E.off(c.Z.STREAMS_COMPOSED,D,this),E.off(c.Z.INTERNAL_MANIFEST_LOADED,M,this),T()}},t=(0,d.Z)(_).getInstance().getLogger(e),p=Kt(_).create(),e}Xt.__dashjs_factory_name="ManifestUpdater";var Qt=u.Z.getClassFactory(Xt);function Jt(){var e,t,n,i,r,a,o,s,u,h,f,p,g,m,v,y,_=this.context,E=(0,l.Z)(_).getInstance(),b=(0,Q.Z)(_).getInstance();function S(){s=[],u=[],h=null,f=null,g=null,p=NaN,n=!1,i=!1,m=r.get().streaming.utcSynchronization.timeBetweenSyncAttempts}function w(){r.get().streaming.utcSynchronization.enabled&&!n&&!i&&g&&g.value&&g.schemeIdUri&&!isNaN(p)&&!isNaN(r.get().streaming.utcSynchronization.backgroundAttempts)&&(f&&(Date.now()-f)/1e3<30||(s=[],i=!0,A(isNaN(r.get().streaming.utcSynchronization.backgroundAttempts)?2:r.get().streaming.utcSynchronization.backgroundAttempts)))}function A(e){try{if(e<=0)return void V();var t=Date.now();a[g.schemeIdUri](g.value,function(n){var i=Date.now(),r=I(t,i,n);s.push(r),A(e-1)},function(){V()})}catch(e){V()}}function R(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||0;if(!u||0===u.length||e>=u.length)M();else{var t=u[e];if(t)if(a.hasOwnProperty(t.schemeIdUri)){var n=(new Date).getTime();a[t.schemeIdUri](t.value,function(e){var i=(new Date).getTime(),r=I(n,i,e);g=t,M(r)},function(){R(e+1)})}else R(e+1);else M()}}function I(e,t,n){return n-(t-(t-e)/2)}function M(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,t=isNaN(e);t&&r.get().streaming.utcSynchronization.useManifestDateHeaderTimeSource?B():U(t,e)}function C(e){var t,n,i,r=Date.parse(e);return isNaN(r)&&(i=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/.exec(e),t=Date.UTC(parseInt(i[1],10),parseInt(i[2],10)-1,parseInt(i[3],10),parseInt(i[4],10),parseInt(i[5],10),i[6]&&(parseInt(i[6],10)||0),i[7]&&1e3*parseFloat(i[7])||0),i[9]&&i[10]&&(n=60*parseInt(i[9],10)+parseInt(i[10],10),t+=("+"===i[8]?-1:1)*n*60*1e3),r=new Date(t).getTime()),r}function P(e){return Date.parse(e)}function D(e){return Date.parse(e)}function O(e,t,n){n()}function N(e,t,n){var i=C(e);isNaN(i)?n():t(i)}function k(e,t,n,i,r){var a,o,s=!1,l=new XMLHttpRequest,c=r?L.w.HEAD:L.w.GET,u=t.match(/\S+/g);if(t=u.shift(),a=function(){s||(s=!0,u.length?k(e,u.join(" "),n,i,r):i())},o=function(){var t,i;200===l.status&&(t=r?l.getResponseHeader("Date"):l.response,i=e(t),isNaN(i)||(n(i),s=!0))},b.isRelative(t)){var d=y.resolve();d&&(t=b.resolve(t,d.url))}l.open(c,t),l.timeout=5e3,l.onload=o,l.onloadend=a,l.send()}function F(e,t,n){k(D,e,t,n,!0)}function B(){var e=o.getLatestMPDRequestHeaderValueByID("Date"),t=null!==e?new Date(e).getTime():Number.NaN;isNaN(t)?U(!0):U(!1,t-Date.now())}function U(e,i){if(isNaN(p)||isNaN(i)||e||function(e){try{var n,i=G(e),a=isNaN(m)?30:m,o=isNaN(r.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor)?2:r.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor,s=isNaN(r.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts)?600:r.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts,l=isNaN(r.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts)?2:r.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts;i?(n=Math.min(a*o,s),t.debug("Increasing timeBetweenSyncAttempts to ".concat(n))):(n=Math.max(a/o,l),t.debug("Decreasing timeBetweenSyncAttempts to ".concat(n))),m=n}catch(e){}}(i),!e&&!isNaN(i)){h=Date.now(),n=!1;var a=isNaN(p);p=i,a&&w(),t.debug("Completed UTC sync. Setting client - server offset to ".concat(i))}e&&(g=null,n=!1,v.error(new T.Z(x.TIME_SYNC_FAILED_ERROR_CODE,x.TIME_SYNC_FAILED_ERROR_MESSAGE))),E.trigger(c.Z.UPDATE_TIME_SYNC_OFFSET,{offset:i}),E.trigger(c.Z.TIME_SYNCHRONIZATION_COMPLETED)}function V(){if(s&&0!==s.length){var e=s.reduce(function(e,t){return e+t},0)/s.length;G(e)?t.debug("Completed background UTC sync. Offset is within allowed threshold and is not adjusted."):(t.debug("Completed background UTC sync. Setting client - server offset to ".concat(e)),p=e,E.trigger(c.Z.UPDATE_TIME_SYNC_OFFSET,{offset:p})),i=!1,f=Date.now()}}function G(e){try{if(isNaN(p))return!0;var t=r.get().streaming.utcSynchronization.maximumAllowedDrift&&!isNaN(r.get().streaming.utcSynchronization.maximumAllowedDrift)?r.get().streaming.utcSynchronization.maximumAllowedDrift:100;return e>=p-t&&e<=p+t}catch(e){return!0}}return e={initialize:function(){S(),a={"urn:mpeg:dash:utc:http-head:2014":F,"urn:mpeg:dash:utc:http-xsdate:2014":k.bind(null,C),"urn:mpeg:dash:utc:http-iso:2014":k.bind(null,P),"urn:mpeg:dash:utc:direct:2014":N,"urn:mpeg:dash:utc:http-head:2012":F,"urn:mpeg:dash:utc:http-xsdate:2012":k.bind(null,C),"urn:mpeg:dash:utc:http-iso:2012":k.bind(null,P),"urn:mpeg:dash:utc:direct:2012":N,"urn:mpeg:dash:utc:http-ntp:2014":O,"urn:mpeg:dash:utc:ntp:2014":O,"urn:mpeg:dash:utc:sntp:2014":O}},attemptSync:function(e,t){u=e,n||(function(e){try{if(!e||!r.get().streaming.utcSynchronization.enabled)return!1;var t=isNaN(m)?30:m;return!(h&&t&&!isNaN(t))||(Date.now()-h)/1e3>=t}catch(e){return!0}}(t)?(n=!0,R()):E.trigger(c.Z.TIME_SYNCHRONIZATION_COMPLETED))},setConfig:function(e){e&&(e.dashMetrics&&(o=e.dashMetrics),e.baseURLController&&(y=e.baseURLController),e.errHandler&&(v=e.errHandler),e.settings&&(r=e.settings))},reset:function(){S(),E.off(c.Z.ATTEMPT_BACKGROUND_SYNC,w,e)}},t=(0,d.Z)(_).getInstance().getLogger(e),E.on(c.Z.ATTEMPT_BACKGROUND_SYNC,w,e),e}Jt.__dashjs_factory_name="TimeSyncController";var $t=u.Z.getSingletonFactory(Jt);$t.HTTP_TIMEOUT_MS=5e3,u.Z.updateSingletonFactory(Jt.__dashjs_factory_name,$t);var en=$t;function tn(){var e,t,n,i,r,a=this.context,o=(0,l.Z)(a).getInstance();return e={attachMediaSource:function(e){var n=window.URL.createObjectURL(t);return e.setSource(n),"managedMediaSource"===i&&(e.setDisableRemotePlayback(!0),t.addEventListener("startstreaming",function(){o.trigger(h.Z.MANAGED_MEDIA_SOURCE_START_STREAMING)}),t.addEventListener("endstreaming",function(){o.trigger(h.Z.MANAGED_MEDIA_SOURCE_END_STREAMING)})),n},createMediaSource:function(){var e="WebKitMediaSource"in window,n="MediaSource"in window;return"ManagedMediaSource"in window?(t=new ManagedMediaSource,i="managedMediaSource",r.info("Created ManagedMediaSource")):n?(t=new MediaSource,i="mediaSource",r.info("Created MediaSource")):e&&(t=new WebKitMediaSource,r.info("Created WebkitMediaSource")),t},detachMediaSource:function(e){e.setSource(null)},setConfig:function(e){e&&e.settings&&(n=e.settings)},setDuration:function e(i){t&&"open"===t.readyState&&(null===i&&isNaN(i)||t.duration!==i&&(i!==1/0||n.get().streaming.buffer.mediaSourceDurationInfinity||(i=Math.pow(2,32)),function(e){for(var t=e.sourceBuffers,n=0;n<t.length;n++)if(t[n].updating)return!0;return!1}(t)?setTimeout(e.bind(null,i),50):(r.info("Set MediaSource duration:"+i),t.duration=i)))},setSeekable:function(e,n){t&&"function"==typeof t.setLiveSeekableRange&&"function"==typeof t.clearLiveSeekableRange&&"open"===t.readyState&&e>=0&&e<n&&(t.clearLiveSeekableRange(),t.setLiveSeekableRange(e,n))},signalEndOfStream:function(e){if(e&&"open"===e.readyState){for(var t=e.sourceBuffers,n=0;n<t.length;n++)if(t[n].updating||0===t[n].buffered.length)return;r.info("call to mediaSource endOfStream"),e.endOfStream()}}},r=(0,d.Z)(a).getInstance().getLogger(e),e}tn.__dashjs_factory_name="MediaSourceController";var nn=u.Z.getSingletonFactory(tn);function rn(){var e,t,n,i,r,a,o,s,c,u,f,p="urn:mpeg:dash:event:2012",g="discarded",m="updated",v="added",y=this.context,_=(0,l.Z)(y).getInstance();function E(){if(!o||!s)throw new Error("setConfig function has to be called previously")}function b(){f=!1,n={},i={},r=null,u=!1,a=Date.now()/1e3}function T(){try{if(!u){u=!0;var e=s.getTime(),r=e-a;r=a>0?Math.max(0,r):0,S(i,r,e),S(n,r,e),w(i),w(n),a=e,u=!1}}catch(e){u=!1,t.error(e)}}function S(e,n,i){try{I(e,function(r){if(void 0!==r){var a=isNaN(r.duration)?0:r.duration;r.calculatedPresentationTime<=i&&r.calculatedPresentationTime+n+a>=i?M(r,h.Z.EVENT_MODE_ON_START):(L(i,a+n,r.calculatedPresentationTime)||function(e){try{var n=e.eventStream.period.start+e.eventStream.period.duration;return e.calculatedPresentationTime>n}catch(e){return t.error(e),!1}}(r))&&(t.debug("Removing event ".concat(r.id," from period ").concat(r.eventStream.period.id," as it is expired or invalid")),function(e,n){try{var i=n.eventStream.schemeIdUri,r=n.eventStream.period.id,a=n.eventStream.value,o=n.id;e[r][i]=e[r][i].filter(function(e){return a&&e.eventStream.value&&e.eventStream.value!==a||e.id!==o}),0===e[r][i].length&&delete e[r][i]}catch(e){t.error(e)}}(e,r))}})}catch(e){t.error(e)}}function w(e){try{for(var n in e)e.hasOwnProperty(n)&&0===Object.keys(e[n]).length&&delete e[n]}catch(e){t.error(e)}}function A(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.eventStream.schemeIdUri,r=e.eventStream.value,a=e.id,o=g;t[i]||(t[i]=[]);var s=t[i].findIndex(function(e){return(!r||e.eventStream.value&&e.eventStream.value===r)&&e.id===a});if(-1===s)t[i].push(e),e.triggeredReceivedEvent=!1,e.triggeredStartEvent=!1,o=v;else if(n){var l=t[i][s];e.triggeredReceivedEvent=l.triggeredReceivedEvent,e.triggeredStartEvent=l.triggeredStartEvent,t[i][s]=e,o=m}return o}function R(e){try{if(1==e.eventStream.value){var n,i=e.calculatedPresentationTime;n=4294967295==e.calculatedPresentationTime?NaN:e.calculatedPresentationTime+e.duration,_.trigger(h.Z.MANIFEST_VALIDITY_CHANGED,{id:e.id,validUntil:i,newDuration:n,newManifestValidAfter:NaN},{mode:h.Z.EVENT_MODE_ON_START})}}catch(e){t.error(e)}}function x(e){try{var n=s.getTime();I(e,function(e){var t=e.eventStream&&e.eventStream.period&&!isNaN(e.eventStream.period.duration)?e.eventStream.period.duration:NaN,i=e.eventStream&&e.eventStream.period&&!isNaN(e.eventStream.period.start)?e.eventStream.period.start:NaN;if(!isNaN(t)&&!isNaN(i)){var r=e.calculatedPresentationTime;Math.abs(r-n)<300&&M(e,h.Z.EVENT_MODE_ON_START)}})}catch(e){t.error(e)}}function I(e,n){try{if(e)for(var i=Object.keys(e),r=0;r<i.length;r++)for(var a=e[i[r]],o=Object.keys(a),s=0;s<o.length;s++)a[o[s]].forEach(function(e){void 0!==e&&n(e)})}catch(e){t.error(e)}}function L(e,n,i){try{return e-n>i}catch(e){return t.error(e),!1}}function M(e,n){try{var i=s.getTime(),r=e.id;if(n===h.Z.EVENT_MODE_ON_RECEIVE&&!e.triggeredReceivedEvent)return t.debug("Received event ".concat(r)),e.triggeredReceivedEvent=!0,void _.trigger(e.eventStream.schemeIdUri,{event:e},{mode:n});e.triggeredStartEvent||(e.eventStream.schemeIdUri===p&&1==e.eventStream.value?0===e.duration&&0===e.presentationTimeDelta||(t.debug("Starting manifest refresh event ".concat(r," at ").concat(i)),function(){try{E(),o.refreshManifest()}catch(e){t.error(e)}}()):"urn:mpeg:dash:event:callback:2015"===e.eventStream.schemeIdUri&&1==e.eventStream.value?(t.debug("Starting callback event ".concat(r," at ").concat(i)),function(e){try{(0,se.Z)(y).create({}).load({method:"get",url:e,request:{responseType:"arraybuffer"}})}catch(e){t.error(e)}}(e.messageData)):(t.debug("Starting event ".concat(r," from period ").concat(e.eventStream.period.id," at ").concat(i)),_.trigger(e.eventStream.schemeIdUri,{event:e},{mode:n})),e.triggeredStartEvent=!0)}catch(e){t.error(e)}}return e={addInlineEvents:function(e,i){try{if(E(),n[i]||(n[i]={}),e)for(var r=0;r<e.length;r++){var a=e[r];if(!L(s.getTime(),isNaN(a.duration)?0:a.duration,a.calculatedPresentationTime)){var o=A(a,n[i],!0);o===v?(t.debug("Added inline event with id ".concat(a.id," from period ").concat(i)),M(a,h.Z.EVENT_MODE_ON_RECEIVE)):o===m&&t.debug("Updated inline event with id ".concat(a.id," from period ").concat(i))}}}catch(e){throw e}},addInbandEvents:function(e,n){try{E(),i[n]||(i[n]={});for(var r=0;r<e.length;r++){var a=e[r];L(s.getTime(),isNaN(a.duration)?0:a.duration,a.calculatedPresentationTime)||(A(a,i[n],!1)===v?(a.eventStream.schemeIdUri===p&&R(a),t.debug("Added inband event with id ".concat(a.id," from period ").concat(n)),M(a,h.Z.EVENT_MODE_ON_RECEIVE)):t.debug("Inband event with scheme_id_uri ".concat(a.eventStream.schemeIdUri,", value ").concat(a.eventStream.value,", period id ").concat(n," and event id ").concat(a.id," was ignored because it has been added before.")))}T()}catch(e){throw e}},getInbandEvents:function(){return i},getInlineEvents:function(){return n},start:function(){try{E(),t.debug("Start Event Controller");var e=c.get().streaming.eventControllerRefreshDelay;f||isNaN(e)||(f=!0,r=setInterval(T,e))}catch(e){throw e}},setConfig:function(e){try{if(!e)return;e.manifestUpdater&&(o=e.manifestUpdater),e.playbackController&&(s=e.playbackController),e.settings&&(c=e.settings)}catch(e){throw e}},reset:function(){(function(){try{null!==r&&f&&(clearInterval(r),r=null,f=!1,function(){try{x(i),x(n)}catch(e){t.error(e)}}())}catch(e){throw e}})(),b()}},t=(0,d.Z)(y).getInstance().getLogger(e),b(),e}rn.__dashjs_factory_name="EventController";var an=u.Z.getSingletonFactory(rn),on={LEVELS:{WARNING:"Warning",ERROR:"Error"},EVENTS:{NO_UTC_TIMING_ELEMENT:{key:"NO_UTC_TIMING_ELEMENT",message:"No UTCTiming element is present in the manifest. You may experience playback failures. For a detailed validation use https://conformance.dashif.org/"},NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE:{key:"NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE",message:'SMPTE 2052-1:2013 defines the attribute name as "imageType" and does not define "imagetype"'},INVALID_DVR_WINDOW:{key:"INVALID_DVR_WINDOW",message:"No valid segment found when applying a specification compliant DVR window calculation. Using SegmentTimeline entries as a fallback."}}};function sn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function ln(){var e,t,n,i,r,o,u,f,p,g,m,v,y,_,E,b,S,w,A,R,I,L,M,C,P,D,O,k,F,B,U,V,G,H,j,z,Z,q,W,Y,K,X,Q,J,te,ne,ie,re,ae=this.context,oe=(0,l.Z)(ae).getInstance();function se(){if(!(o&&o.hasOwnProperty("load")&&I&&I.hasOwnProperty("initialize")&&I.hasOwnProperty("reset")&&I.hasOwnProperty("getClientTimeOffset")&&u&&R&&p&&G))throw new Error(a.Z.MISSING_CONFIG_ERROR)}function le(){if(!r||!r.hasOwnProperty("setManifest"))throw new Error("initialize function has to be called previously")}function ce(){!function(){try{var e=f.getStreamsInfo();if(!M&&0===e.length)throw new Error("There are no periods in the MPD");M&&e.length>0&&p.updateManifestUpdateInfo({currentTime:G.getTime(),buffered:V.getBufferRange(),presentationStartTime:e[0].start,clientTimeOffset:I.getClientTimeOffset()}),L.length>0&&(0!==(o=e).length?L=L.filter(function(e){var n=o.filter(function(t){return t.id===e.getId()}).length>0||e.getId()===M.getId();return n||(t.debug("Removing stream ".concat(e.getId())),e.reset(!0)),n}):t.warn("No periods included in the current manifest. Skipping the filtering of outdated stream objects."));for(var n=[],i=0,r=e.length;i<r;i++){var a=e[i];n.push(de(a)),p.addManifestUpdateStreamInfo(a)}Promise.all(n).then(function(){return new Promise(function(t,n){M?t():he(e,t,n)})}).then(function(){oe.trigger(c.Z.STREAMS_COMPOSED),Pe()}).catch(function(e){throw e})}catch(o){R.error(new T.Z(x.MANIFEST_ERROR_ID_NOSTREAMS_CODE,o.message+" nostreamscomposed",u.getValue())),B=!0,Qe()}var o}()}function ue(){te=!0}function de(e){var t=Ye(e.id);return t?t.updateData(e):(t=jt(ae).create({manifestModel:u,mediaPlayerModel:j,dashMetrics:p,manifestUpdater:r,adapter:f,timelineConverter:I,capabilities:n,capabilitiesFilter:i,errHandler:R,baseURLController:y,segmentBaseController:_,textController:P,abrController:b,playbackController:G,eventController:w,mediaController:S,protectionController:C,videoModel:V,streamInfo:e,settings:J}),L.push(t),t.initialize(),Promise.resolve())}function he(e,n,i){try{we();var r=p.getCurrentDVRInfo().range;if(r.end<r.start){ne&&clearTimeout(ne);var a=Math.min(1e3*(-1*(r.end-r.start)+2),2147483647);return t.debug("Waiting for ".concat(a," ms before playback can start")),oe.trigger(c.Z.AST_IN_FUTURE,{delay:a}),void(ne=setTimeout(function(){he(e,n,i)},a))}J.get().streaming.applyProducerReferenceTime&&H.calculateProducerReferenceTimeOffsets(e);var o=e[0].manifestInfo;if(J.get().streaming.applyServiceDescription&&H.applyServiceDescription(o),f.getIsDynamic()){var s=Ve(e,o);G.computeAndSetLiveDelay(s,o)}(J.get().streaming.applyContentSteering&&v.shouldQueryBeforeStart()?v.loadSteeringData():Promise.resolve()).then(function(){var e=u.getValue();e&&y.update(e),fe(),n()}).catch(function(e){t.error(e),fe(),n()})}catch(e){i(e)}}function fe(){var e=function(){var e;if(f.getIsDynamic()){var n=p.getCurrentDVRInfo();e=(n&&n.range?n.range.end:0)-G.getOriginalLiveDelay();var i=n?n.range:null;if(i){if(isNaN(ie)&&-1===ie.toString().indexOf("posix:")){var r=Fe(!0);isNaN(r)||(t.info("Start time from URI parameters: ".concat(r)),e=Math.min(e,r))}else{t.info("Start time provided by the app: ".concat(ie));var a=Be(!0,ie);isNaN(a)||(e=Math.min(e,a))}var o=J.get().streaming.timeShiftBuffer.calcFromSegmentTimeline?.1:0;e=Math.max(e,i.start+o)}}else if(e=$e()[0].getStreamInfo().start,isNaN(ie)){var s=Fe(!1);isNaN(s)||(t.info("Start time from URI parameters: ".concat(s)),e=Math.max(e,s))}else{t.info("Start time provided by the app: ".concat(ie));var l=Be(!1,ie);isNaN(l)||(e=Math.max(e,l))}return e}(),n=Se(e),i=null!==n?n:L[0];oe.trigger(c.Z.INITIAL_STREAM_SWITCH,{startTime:e}),pe(i,null,e),Y||(Y=setInterval(function(){!k&&G.getTimeToStreamEnd()<=0&&!G.isSeeking()&&oe.trigger(c.Z.PLAYBACK_ENDED,{isLast:We().isLast})},200))}function pe(e,n,i){try{if(k||!e||n===e&&e.getIsActive())return;k=!0,oe.trigger(c.Z.PERIOD_SWITCH_STARTED,{fromStreamInfo:n?n.getStreamInfo():null,toStreamInfo:e.getStreamInfo()});var r=!1;M=e,n&&(r=be(e,n),n.deactivate(r)),i=isNaN(i)?!r&&n?e.getStreamInfo().start:NaN:i,t.info("Switch to stream ".concat(e.getId(),". Seektime is ").concat(i,", current playback time is ").concat(G.getTime(),". Seamless period switch is set to ").concat(r)),X=X.filter(function(e){return e.getId()!==M.getId()}),G.initialize(We(),!!n),V.getElement()?ge(i,r,!1):me(i,r)}catch(e){k=!1}}function ge(e,n){var i,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];function a(){if(U&&"open"===U.readyState){t.debug("MediaSource is open!"),window.URL.revokeObjectURL(i),U.removeEventListener("sourceopen",a),U.removeEventListener("webkitsourceopen",a),ke();var o=p.getCurrentDVRInfo();g.setSeekable(o.range.start,o.range.end),r?(isNaN(e)||G.seek(e,!0,!0),M.setMediaSource(U).then(function(){M.initializeForTextWithMediaSource(U)})):me(e,n)}}function o(){U.addEventListener("sourceopen",a,!1),U.addEventListener("webkitsourceopen",a,!1),i=g.attachMediaSource(V),t.debug("MediaSource attached to element.  Waiting on open...")}U?n?me(e,n):(g.detachMediaSource(V),o()):(U=g.createMediaSource(),o())}function me(e,t){M.activate(U,t?K:void 0,e).then(function(t){if(t){var n=Object.keys(t);n.length>0&&t[n[0]].getBuffer().changeType&&(Q=!0),K=t}isNaN(e)||(oe.trigger(c.Z.SEEK_TARGET,{time:e},{streamId:M.getId()}),G.seek(e,!1,!0),M.startScheduleControllers()),k=!1,oe.trigger(c.Z.PERIOD_SWITCH_COMPLETED,{toStreamInfo:We()})})}function ve(e){var t,n,i,r,a=Se(e.seekTime);a&&a!==M?a&&a!==M&&(ye(),n=a,i=(t=e)&&!isNaN(t.seekTime)?t.seekTime:NaN,r=M.getProcessors().map(function(e){return e.prepareOuterPeriodPlaybackSeeking(t)}),Promise.all(r).then(function(){pe(n,M,i)}).catch(function(e){R.error(e)})):(ye(),function(e){M.getProcessors().forEach(function(t){return t.prepareInnerPeriodPlaybackSeeking(e)}),ze(ee.USER_REQUEST_STOP_REASON)}(e)),Ze($.SEEK_START_REASON)}function ye(){_e()}function _e(){X&&X.length>0&&(X.forEach(function(e){e.deactivate(!0)}),X=[])}function Ee(e){if(e.newMediaInfo.streamInfo.id===M.getId()){if(_e(),J.get().streaming.buffer.resetSourceBuffersForTrackSwitch&&e.oldMediaInfo&&e.oldMediaInfo.codec!==e.newMediaInfo.codec){var t=G.getTime();return M.deactivate(!1),void ge(t,!1,!1)}M.prepareTrackChange(e)}}function be(e,t){try{return J.get().streaming.buffer.reuseExistingSourceBuffers&&(t.isProtectionCompatible(e)||te)&&(Q&&J.get().streaming.buffer.useChangeTypeForTrackSwitch||t.isMediaCodecCompatible(e,t))}catch(e){return!1}}function Te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;U&&!e.getPreloaded()&&be(e,t)&&e.startPreloading(U,K).then(function(){X.push(e)})}function Se(e){if(isNaN(e))return null;for(var t=L.length,n=0;n<t;n++){var i=L[n];if(e<parseFloat((i.getStartTime()+i.getDuration()).toFixed(5)))return i}return null}function we(){try{var e=f.getIsDynamic(),t=f.getStreamsInfo()[0].manifestInfo,n=G.getTime(),i=I.calcTimeShiftBufferWindow(L,e),r=Oe();if(void 0===i.start||void 0===i.end)return;r&&0!==r.length?r.forEach(function(e){p.addDVRInfo(e.getType(),n,t,i)}):p.addDVRInfo(a.Z.VIDEO,n,t,i)}catch(e){}}function Ae(e){if(q&&O){var t=j.getInitialBufferLevel(),n=[a.Z.TEXT];(isNaN(t)||t<=G.getBufferLevel(n)||f.getIsDynamic()&&t>G.getLiveDelay())&&(q=!1,Ze($.INITIAL_PLAYOUT_START_REASON),G.play())}e&&e.mediaType&&p.addBufferLevel(e.mediaType,new Date,1e3*e.bufferLevel)}function Re(e){e.streamInfo.id===M.getId()&&e.reason&&e.reason.forceReplace&&_e(),Ye(e.streamInfo.id).prepareQualityChange(e)}function xe(){if(f.getIsDynamic()&&0!==G.getOriginalLiveDelay()&&M){var e=f.getStreamsInfo();if(e.length>0){var t=e[0].manifestInfo,n=Ve(e,t);G.computeAndSetLiveDelay(n,t)}}}function Ie(){if(He()){var e=V.getPlaybackQuality();e&&p.addDroppedFrames(e)}}function Le(){t.debug("[onPlaybackStarted]"),!q&&Z&&Ze($.RESUME_FROM_PAUSE_START_REASON),q&&(q=!1),W&&(W=!1,J.get().streaming.applyContentSteering&&!v.shouldQueryBeforeStart()&&v.loadSteeringData()),Z=!1}function Me(e){t.debug("[onPlaybackPaused]"),e.ended||(Z=!0,ze(ee.USER_REQUEST_STOP_REASON))}function Ce(e){t.debug("Stream with id ".concat(e.streamInfo.id," finished buffering"));var n=e.streamInfo.isLast;U&&n?(t.info("[onStreamBufferingCompleted] calls signalEndOfStream of mediaSourceController."),g.signalEndOfStream(U)):Pe()}function Pe(){if(M&&M.getHasFinishedBuffering())for(var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{var t=e||M||null;if(t){var n=t.getStreamInfo();return L.filter(function(e){var t=e.getStreamInfo();return t.start>n.start&&n.id!==t.id})}}catch(e){return[]}}(M),t=0;t<e.length;){var n=e[t],i=0===t?M:e[t-1];!n.getPreloaded()&&i.getHasFinishedBuffering()&&U&&Te(n,i),t+=1}}function De(){Y&&(clearInterval(Y),Y=null)}function Oe(){return M?M.getProcessors():[]}function Ne(e){if(M&&!M.getIsEndedEventSignaled()){M.setIsEndedEventSignaled(!0);var n=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||M||null;if(!e)return null;for(var t=e.getStreamInfo(),n=t.start,i=0,r=-1,a=NaN;i<L.length;){var o=L[i].getStreamInfo(),s=o.start-n;s>0&&(isNaN(a)||s<a)&&t.id!==o.id&&(a=s,r=i),i+=1}return r>=0?L[r]:null}();n?(t.debug("StreamController onEnded, found next stream with id ".concat(n.getStreamInfo().id,". Switching from ").concat(M.getStreamInfo().id," to ").concat(n.getStreamInfo().id)),pe(n,M,NaN)):(t.debug("StreamController no next stream found"),M.setIsEndedEventSignaled(!1)),ze(n?ee.END_OF_PERIOD_STOP_REASON:ee.END_OF_CONTENT_STOP_REASON)}e&&e.isLast&&(De(),v.stopSteeringRequestTimer())}function ke(e){var t=e||We().manifestInfo.duration;g.setDuration(t)}function Fe(e){var t=E.getURIFragmentData();if(!t||!t.t)return NaN;var n=$e()[0].getStreamInfo().start;return t.t=t.t.split(",")[0],Ue(e,t.t,n)}function Be(e,t){var n=0;return e||(n=$e()[0].getStreamInfo().start),Ue(e,t,n)}function Ue(e,t,n){var i=f.getRegularPeriods()[0],r=t.toString(),a=-1!==r.indexOf("posix:")?"now"===r.substring(6)?Date.now()/1e3:parseFloat(r.substring(6)):NaN;return e&&!isNaN(a)?I.calcPresentationTimeFromWallTime(new Date(1e3*a),i):parseFloat(r)+n}function Ve(e,t){try{var n=NaN;if(t&&!isNaN(t.maxFragmentDuration)&&isFinite(t.maxFragmentDuration))return t.maxFragmentDuration;if(e&&1===e.length){var i=e[0],r=[a.Z.VIDEO,a.Z.AUDIO,a.Z.TEXT].reduce(function(e,t){var n=f.getMediaInfoForType(i,t);return n&&!1!==n.isFragmented&&e.push(n),e},[]).reduce(function(e,t){var n=f.getVoRepresentations(t);return n&&n.length>0&&n.forEach(function(t){t&&e.push(t)}),e},[]).reduce(function(e,t){var n=f.convertRepresentationToRepresentationInfo(t);return n&&n.fragmentDuration&&!isNaN(n.fragmentDuration)&&e.push(n.fragmentDuration),e},[]);n=Math.max.apply(Math,function(e){if(Array.isArray(e))return sn(e)}(o=r)||function(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}(o)||function(e,t){if(e){if("string"==typeof e)return sn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?sn(e,t):void 0}}(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}return isFinite(n)?n:NaN}catch(e){return NaN}var o}function Ge(e){if(e.error)B=!0,Qe();else{t.info("Manifest updated... updating data system wide.");var n=e.manifest;f.updatePeriods(n);var r=f.getUTCTimingSources();!f.getIsDynamic()||r&&0!==r.length||oe.trigger(h.Z.CONFORMANCE_VIOLATION,{level:on.LEVELS.WARNING,event:on.EVENTS.NO_UTC_TIMING_ELEMENT});var a=f.getIsDynamic()?r.concat(z.getUTCTimingSources()):r;i.filterUnsupportedFeatures(n).then(function(){y.initialize(n),m.attemptSync(a,f.getIsDynamic())})}}function He(){return!!M&&M.getHasVideoTrack()}function je(){return!!M&&M.getHasAudioTrack()}function ze(e,t){t=t||new Date,Oe().forEach(function(n){n.finalisePlayList(t,e)}),p.addPlayList()}function Ze(e){p.createPlaylistMetrics(1e3*G.getTime(),e)}function qe(e){if(e.error){var n="";switch(e.error.code){case 1:n="MEDIA_ERR_ABORTED";break;case 2:n="MEDIA_ERR_NETWORK";break;case 3:n="MEDIA_ERR_DECODE",re.counts.mediaErrorDecode+=1;break;case 4:n="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:n="MEDIA_ERR_ENCRYPTED";break;default:n="UNKNOWN"}"MEDIA_ERR_DECODE"===n&&J.get().errors.recoverAttempts.mediaErrorDecode>=re.counts.mediaErrorDecode?function(){t.warn("A MEDIA_ERR_DECODE occured: Resetting the MediaSource");var e=G.getTime();M.deactivate(!1),t.warn("MediaSource has been resetted. Resuming playback from time ".concat(e)),ge(e,!1,!1)}():(F=!0,e.error.message&&(n+=" ("+e.error.message+")"),e.error.msExtendedCode&&(n+=" (0x"+(e.error.msExtendedCode>>>0).toString(16).toUpperCase()+")"),t.fatal("Video Element Error: "+n),e.error&&t.fatal(e.error),R.error(new T.Z(e.error.code,n)),Qe())}}function We(){return M?M.getStreamInfo():null}function Ye(e){for(var t=0,n=L.length;t<n;t++)if(L[t].getId()===e)return L[t];return null}function Ke(e){isNaN(e.newDuration)||ke(e.newDuration)}function Xe(){L=[],ie=NaN,C=null,k=!1,M=null,F=!1,B=!1,q=!0,W=!0,Z=!1,O=!0,Y=null,te=!1,Q=!1,X=[],ne=null,re={counts:{mediaErrorDecode:0}}}function Qe(){se(),m.reset(),ze(F||B?ee.FAILURE_STOP_REASON:ee.USER_REQUEST_STOP_REASON);for(var t=0,n=L?L.length:0;t<n;t++)L[t].reset(F);oe.off(h.Z.PLAYBACK_TIME_UPDATED,Ie,e),oe.off(h.Z.PLAYBACK_SEEKING,ve,e),oe.off(h.Z.PLAYBACK_ERROR,qe,e),oe.off(h.Z.PLAYBACK_STARTED,Le,e),oe.off(h.Z.PLAYBACK_PAUSED,Me,e),oe.off(h.Z.PLAYBACK_ENDED,Ne,e),oe.off(h.Z.METRIC_ADDED,Je,e),oe.off(h.Z.MANIFEST_VALIDITY_CHANGED,Ke,e),oe.off(h.Z.BUFFER_LEVEL_UPDATED,Ae,e),oe.off(h.Z.QUALITY_CHANGE_REQUESTED,Re,e),c.Z.KEY_SESSION_UPDATED&&oe.off(c.Z.KEY_SESSION_UPDATED,ue,e),oe.off(c.Z.MANIFEST_UPDATED,Ge,e),oe.off(c.Z.STREAM_BUFFERING_COMPLETED,Ce,e),oe.off(c.Z.TIME_SYNCHRONIZATION_COMPLETED,ce,e),oe.off(c.Z.CURRENT_TRACK_CHANGED,Ee,e),oe.off(c.Z.SETTING_UPDATED_LIVE_DELAY,xe,e),oe.off(c.Z.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,xe,e),y.reset(),r.reset(),w.reset(),p.clearAllCurrentMetrics(),u.setValue(null),o.reset(),I.reset(),A.reset(),U&&(g.detachMediaSource(V),U=null),V=null,C&&(C=null,D=null,u.getValue()&&oe.trigger(c.Z.PROTECTION_DESTROYED,{data:u.getValue().url})),De(),oe.trigger(c.Z.STREAM_TEARDOWN_COMPLETE),Xe()}function Je(e){if(e.metric===s.Z.DVR_INFO){var t=je()?a.Z.AUDIO:a.Z.VIDEO;e.mediaType===t&&g.setSeekable(e.value.range.start,e.value.range.end)}}function $e(){return L}return e={initialize:function(t,n){se(),O=t,D=n,I.initialize(),(r=Qt(ae).create()).setConfig({manifestModel:u,adapter:f,manifestLoader:o,errHandler:R,settings:J,contentSteeringController:v}),r.initialize(),(w=an(ae).getInstance()).setConfig({manifestUpdater:r,playbackController:G,settings:J}),w.start(),m.setConfig({dashMetrics:p,baseURLController:y,errHandler:R,settings:J}),m.initialize(),g.setConfig({settings:J}),C&&(oe.trigger(c.Z.PROTECTION_CREATED,{controller:C}),C.setMediaElement(V.getElement()),D&&C.setProtectionData(D)),oe.on(h.Z.PLAYBACK_TIME_UPDATED,Ie,e),oe.on(h.Z.PLAYBACK_SEEKING,ve,e),oe.on(h.Z.PLAYBACK_ERROR,qe,e),oe.on(h.Z.PLAYBACK_STARTED,Le,e),oe.on(h.Z.PLAYBACK_PAUSED,Me,e),oe.on(h.Z.PLAYBACK_ENDED,Ne,e),oe.on(h.Z.METRIC_ADDED,Je,e),oe.on(h.Z.MANIFEST_VALIDITY_CHANGED,Ke,e),oe.on(h.Z.BUFFER_LEVEL_UPDATED,Ae,e),oe.on(h.Z.QUALITY_CHANGE_REQUESTED,Re,e),c.Z.KEY_SESSION_UPDATED&&oe.on(c.Z.KEY_SESSION_UPDATED,ue,e),oe.on(c.Z.MANIFEST_UPDATED,Ge,e),oe.on(c.Z.STREAM_BUFFERING_COMPLETED,Ce,e),oe.on(c.Z.TIME_SYNCHRONIZATION_COMPLETED,ce,e),oe.on(c.Z.CURRENT_TRACK_CHANGED,Ee,e),oe.on(c.Z.SETTING_UPDATED_LIVE_DELAY,xe,e),oe.on(c.Z.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,xe,e)},getActiveStreamInfo:We,addDVRMetric:we,hasVideoTrack:He,hasAudioTrack:je,getStreamById:Ye,getStreamForTime:Se,getTimeRelativeToStreamId:function(e,t){for(var n=null,i=0,r=0,a=null,o=0;o<L.length;o++){if(r=(n=L[o]).getStartTime(),a=n.getDuration(),Number.isFinite(r)&&(i=r),n.getId()===t)return e-i;Number.isFinite(a)&&(i+=a)}return null},load:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN;se(),ie=t,o.load(e)},loadWithManifest:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN;le(),ie=t,r.setManifest(e)},getActiveStreamProcessors:Oe,setConfig:function(e){e&&(e.capabilities&&(n=e.capabilities),e.capabilitiesFilter&&(i=e.capabilitiesFilter),e.manifestLoader&&(o=e.manifestLoader),e.manifestModel&&(u=e.manifestModel),e.mediaPlayerModel&&(j=e.mediaPlayerModel),e.customParametersModel&&(z=e.customParametersModel),e.protectionController&&(C=e.protectionController),e.adapter&&(f=e.adapter),e.dashMetrics&&(p=e.dashMetrics),e.errHandler&&(R=e.errHandler),e.timelineConverter&&(I=e.timelineConverter),e.videoModel&&(V=e.videoModel),e.playbackController&&(G=e.playbackController),e.serviceDescriptionController&&(H=e.serviceDescriptionController),e.contentSteeringController&&(v=e.contentSteeringController),e.textController&&(P=e.textController),e.abrController&&(b=e.abrController),e.mediaController&&(S=e.mediaController),e.settings&&(J=e.settings),e.baseURLController&&(y=e.baseURLController),e.uriFragmentModel&&(E=e.uriFragmentModel),e.segmentBaseController&&(_=e.segmentBaseController),e.manifestUpdater&&(r=e.manifestUpdater))},setProtectionData:function(e){D=e,C&&C.setProtectionData(D)},getIsStreamSwitchInProgress:function(){return k},switchToVideoElement:function(e){M&&(G.initialize(We()),ge(e,!1,!0))},getHasMediaOrInitialisationError:function(){return F||B},getStreams:$e,getActiveStream:function(){return M},getInitialPlayback:function(){return q},getAutoPlay:function(){return O},refreshManifest:function(){r.getIsUpdating()||r.refreshManifest()},reset:Qe},t=(0,d.Z)(ae).getInstance().getLogger(e),m=en(ae).getInstance(),g=nn(ae).getInstance(),A=N(ae).getInstance(),Xe(),e}ln.__dashjs_factory_name="StreamController";var cn=u.Z.getSingletonFactory(ln);function un(){var e,t,n,i,r,o,s,u,h,f,p,g,m=this.context,v=(0,l.Z)(m).getInstance();function y(){g.debug("Stopping the gap controller"),r&&(clearInterval(r),r=null),function(){v.off(c.Z.WALLCLOCK_TIME_UPDATED,S,this),v.off(c.Z.INITIAL_STREAM_SWITCH,T,this),v.off(c.Z.PLAYBACK_SEEKING,_,this),v.off(c.Z.BUFFER_REPLACEMENT_STARTED,E,e),v.off(c.Z.TRACK_CHANGE_RENDERED,b,e)}(),r=null,o=NaN,i=0,f=null,p={}}function _(){f&&(clearTimeout(f),f=null)}function E(e){try{if(e.streamId!==u.getActiveStreamInfo().id||e.mediaType!==a.Z.VIDEO&&e.mediaType!==a.Z.AUDIO)return;e.streamId===u.getActiveStreamInfo().id&&(p[e.mediaType]=!0)}catch(e){g.error(e)}}function b(e){e&&e.mediaType&&(p[e.mediaType]=!1)}function T(){r||function(){try{r||(g.debug("Starting the gap controller"),r=setInterval(function(){w()&&I(s.getTime())},100))}catch(e){}}()}function S(){if(w(n.get().streaming.gaps.enableSeekFix)&&++i>=10){var e=s.getTime();t===e?I(e,!0):(t=e,o=NaN),i=0}}function w(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!u.getActiveStream())return!1;var t=Object.keys(p).some(function(e){return p[e]}),i=!!e&&A();return!t&&n.get().streaming.gaps.jumpGaps&&u.getActiveStreamProcessors().length>0&&(!s.isSeeking()||i)&&!s.isPaused()&&!u.getIsStreamSwitchInProgress()&&!u.getHasMediaOrInitialisationError()}function A(){var e=u.getActiveStream(),t=parseFloat((e.getStartTime()+e.getDuration()).toFixed(5));return s.getTime()+n.get().streaming.gaps.threshold>=t}function R(e,t){try{if(!e||e.length<=1&&t>0)return NaN;for(var i=NaN,r=0;isNaN(i)&&r<e.length;){var a=r>0?e.end(r-1):0;t<e.start(r)&&a-t<n.get().streaming.gaps.threshold&&(i=r),r+=1}return i}catch(e){return null}}function x(e,t){for(var n=0,i=e.length;n<i;n++)if(t>=e.start(n)&&t<=e.end(n))return!0;return!1}function I(e){var t,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=n.get().streaming.gaps.enableStallFix,a=n.get().streaming.gaps.stallSeek,l=n.get().streaming.gaps.smallGapLimit,c=n.get().streaming.gaps.jumpLargeGaps,d=h.getBufferRange(),p=NaN,m=!1;if(t=R(d,e),!isNaN(t)){var v=d.start(t),y=v-e;y>0&&(y<=l||c)&&(p=v)}var _=s.getTimeToStreamEnd();if(isNaN(p)&&i&&isFinite(_)&&!isNaN(_)&&_<l&&(p=parseFloat(s.getStreamEndTime().toFixed(5)),m=!0),r&&isNaN(p)&&i&&isNaN(t)&&x(d,e)&&(0===a?(g.warn("Toggle play pause to break stall"),h.pause(),h.play()):(g.warn("Jumping ".concat(a,"s to break stall")),p=e+a)),p>0&&o!==p&&p>e&&!f){var E=p-e;if(m){var b=u.getStreamForTime(p),T=b&&!!b.getPreloaded();g.warn("Jumping to end of stream because of gap from ".concat(e," to ").concat(p,". Gap duration: ").concat(E)),s.seek(p,!0,T)}else{var S=s.getIsDynamic(),w=t>0?d.end(t-1):e,A=S?1e3*Math.max(0,E-.1):0;f=window.setTimeout(function(){s.seek(p,!0,!0),g.warn("Jumping gap occuring in period ".concat(u.getActiveStream().getStreamId()," starting at ").concat(w," and ending at ").concat(p,". Jumping by: ").concat(p-w)),f=null},A)}o=p}}return e={reset:y,setConfig:function(e){e&&(e.settings&&(n=e.settings),e.playbackController&&(s=e.playbackController),e.streamController&&(u=e.streamController),e.videoModel&&(h=e.videoModel))},initialize:function(){!function(){v.on(c.Z.WALLCLOCK_TIME_UPDATED,S,this),v.on(c.Z.INITIAL_STREAM_SWITCH,T,this),v.on(c.Z.PLAYBACK_SEEKING,_,this),v.on(c.Z.BUFFER_REPLACEMENT_STARTED,E,e),v.on(c.Z.TRACK_CHANGE_RENDERED,b,e)}()}},g=(0,d.Z)(m).getInstance().getLogger(e),y(),e}un.__dashjs_factory_name="GapController";var dn=u.Z.getSingletonFactory(un);function hn(){var e,t,n,i,r,o,u,f,p,g,m=this.context,v=(0,l.Z)(m).getInstance();function y(){t=!1;var e=je.Z.parseUserAgent();n=e&&e.browser&&e.browser.name&&"safari"===e.browser.name.toLowerCase()}function _(){t=!1}function E(e){if(e.streamId===o.getActiveStreamInfo().id&&p){var t=u.getLiveDelay();u.getBufferLevel()>t/2&&(p=!1)}}function b(e){e.streamId===o.getActiveStreamInfo().id&&(p=e.state===s.Z.BUFFER_EMPTY)}function T(){f.getCatchupModeEnabled()||i.setPlaybackRate(1)}function S(){u.getIsDynamic()&&f.getCatchupModeEnabled()&&(f.getCatchupPlaybackRates().max>0||f.getCatchupPlaybackRates().min<0)&&!u.isPaused()&&!u.isSeeking()&&function(){try{return!(!u.getTime()>0||t)&&(A()===a.Z.LIVE_CATCHUP_MODE_LOLP?function(e,t){try{return Math.abs(w())>0||e<t}catch(e){return!1}}(u.getBufferLevel(),r.get().streaming.liveCatchup.playbackBufferMin):function(){try{return Math.abs(w())>0}catch(e){return!1}}())}catch(e){return!1}}()&&function(){if(!t&&i){var e,o=i.getPlaybackRate(),s=f.getCatchupPlaybackRates(),l=u.getBufferLevel(),c=w(),d=f.getCatchupMaxDrift();if(!isNaN(d)&&d>0&&c>d)g.info("[CatchupController]: Low Latency catchup mechanism. Latency too high, doing a seek to live point"),t=!0,u.seekToCurrentLive(!0,!1);else{var h=u.getCurrentLiveLatency(),m=u.getLiveDelay();e=A()===a.Z.LIVE_CATCHUP_MODE_LOLP?function(e,t,n,i,r){var a;if(r<i){var o=Math.abs(e.min),s=5*(r-i);a=1-o+2*o/(1+Math.pow(Math.E,-s)),g.debug("[LoL+ playback control_buffer-based] bufferLevel: "+r+", newRate: "+a)}else{if(Math.abs(t-n)<=.02*n)a=1;else{var l=t-n,c=l<0?Math.abs(e.min):e.max,u=5*l;a=1-c+2*c/(1+Math.pow(Math.E,-u))}g.debug("[LoL+ playback control_latency-based] latency: "+t+", newRate: "+a)}return a}(s,h,m,r.get().streaming.liveCatchup.playbackBufferMin,l):function(e,t,n,i){if(p)return 1;var r=t-n,a=r<0?Math.abs(e.min):e.max,o=5*r,s=1-a+2*a/(1+Math.pow(Math.E,-o));return u.getPlaybackStalled()&&i<=n/2&&r>0&&(s=1),s}(s,h,m,l);var v=n?.25:.02/(.5/s.max);e&&Math.abs(o-e)>=v&&(g.debug("[CatchupController]: Setting playback rate to ".concat(e)),i.setPlaybackRate(e))}}}()}function w(){return u.getCurrentLiveLatency()-u.getLiveDelay()}function A(){var e=r.get().streaming.liveCatchup.playbackBufferMin;return r.get().streaming.liveCatchup.mode!==a.Z.LIVE_CATCHUP_MODE_LOLP||null===e||isNaN(e)?a.Z.LIVE_CATCHUP_MODE_DEFAULT:a.Z.LIVE_CATCHUP_MODE_LOLP}function R(){f.getCatchupPlaybackRates(!0)}return e={reset:function(){v.off(h.Z.BUFFER_LEVEL_UPDATED,E,e),v.off(h.Z.BUFFER_LEVEL_STATE_CHANGED,b,e),v.off(h.Z.PLAYBACK_PROGRESS,S,e),v.off(h.Z.PLAYBACK_TIME_UPDATED,S,e),v.off(h.Z.PLAYBACK_SEEKED,_,e),v.off(c.Z.SETTING_UPDATED_CATCHUP_ENABLED,T,e),v.off(c.Z.SETTING_UPDATED_PLAYBACK_RATE_MIN,R,e),v.off(c.Z.SETTING_UPDATED_PLAYBACK_RATE_MAX,R,e),v.off(h.Z.STREAM_INITIALIZED,R,e),y(),i.setPlaybackRate(1,!0)},setConfig:function(e){e&&(e.settings&&(r=e.settings),e.videoModel&&(i=e.videoModel),e.streamController&&(o=e.streamController),e.playbackController&&(u=e.playbackController),e.mediaPlayerModel&&(f=e.mediaPlayerModel))},initialize:function(){v.on(h.Z.BUFFER_LEVEL_UPDATED,E,e),v.on(h.Z.BUFFER_LEVEL_STATE_CHANGED,b,e),v.on(h.Z.PLAYBACK_PROGRESS,S,e),v.on(h.Z.PLAYBACK_TIME_UPDATED,S,e),v.on(h.Z.PLAYBACK_SEEKED,_,e),v.on(c.Z.SETTING_UPDATED_CATCHUP_ENABLED,T,e),v.on(c.Z.SETTING_UPDATED_PLAYBACK_RATE_MIN,R,e),v.on(c.Z.SETTING_UPDATED_PLAYBACK_RATE_MAX,R,e),v.on(h.Z.STREAM_INITIALIZED,R,e),R()}},g=(0,d.Z)(m).getInstance().getLogger(e),y(),e}hn.__dashjs_factory_name="CatchupController";var fn=u.Z.getSingletonFactory(hn),pn=[a.Z.SERVICE_DESCRIPTION_DVB_LL_SCHEME],gn="video",mn="audio";function vn(){var e,t,n,i,r,s=this.context;function l(){t={liveDelay:NaN,liveCatchup:{maxDrift:NaN,playbackRate:{min:NaN,max:NaN}},minBitrate:{},maxBitrate:{},initialBitrate:{},contentSteering:null},n=[]}function c(e,n,r){try{t[e][n]=r/1e3}catch(e){i.error(e)}}return e={getServiceDescriptionSettings:function(){return t},getProducerReferenceTimeOffsets:function(){return n},calculateProducerReferenceTimeOffsets:function(e){try{var t=[];if(e&&e.length>0){var s=[a.Z.VIDEO,a.Z.AUDIO,a.Z.TEXT],l=r.getAvailabilityStartTime()/1e3;e.forEach(function(e){var n=s.reduce(function(t,n){return t.concat(r.getAllMediaInfoForType(e,n))},[]).reduce(function(t,n){return r.getProducerReferenceTimes(e,n).forEach(function(i){var a=r.getVoRepresentations(n);if(a&&a.length>0&&a[0].adaptation&&a[0].segmentInfoType===o.Z.SEGMENT_TEMPLATE){var s=a[0],c=new Date(i[o.Z.WALL_CLOCK_TIME]).getTime()/1e3-(i[o.Z.PRESENTATION_TIME]/s[o.Z.TIMESCALE]-s[o.Z.PRESENTATION_TIME_OFFSET]+e.start),u=l-c;t.push({id:i[o.Z.ID],to:u})}}),t},[]);t=t.concat(n)})}n=t}catch(e){i.error(e),n=[]}},applyServiceDescription:function(e){if(e&&e.serviceDescriptions){var r=e.serviceDescriptions.filter(function(e){return pn.includes(e.schemeIdUri)}),o=e.serviceDescriptions.filter(function(e){return null==e.schemeIdUri}),s=r.length>0?r[r.length-1]:o[o.length-1];s&&(s.latency&&s.latency.target>0&&function(e){var r,o;if(e.schemeIdUri,a.Z.SERVICE_DESCRIPTION_DVB_LL_SCHEME,r={liveDelay:(o=e).latency.target/1e3,maxDrift:!isNaN(o.latency.max)&&o.latency.max>o.latency.target?(o.latency.max-o.latency.target+500)/1e3:NaN,referenceId:o.latency.referenceId||NaN},n.length>0){var s=function(e){var t,i=0,r=n.filter(function(t){return t.id===e.referenceId});return 0===r.length?(i=n.length>0?n[0].to:0,t=n[0].id||NaN):(i=r[0].to||0,t=r[0].id||NaN),{to:i,id:t}}(r),l=s.to,c=s.id;t.liveDelay=r.liveDelay-l,t.liveCatchup.maxDrift=r.maxDrift,i.debug("\n                Found latency properties coming from service description. Applied time offset of ".concat(l," from ProducerReferenceTime element with id ").concat(c,".\n                Live Delay: ").concat(r.liveDelay-l,", Live catchup max drift: ").concat(r.maxDrift,"\n            "))}else t.liveDelay=r.liveDelay,t.liveCatchup.maxDrift=r.maxDrift,i.debug("Found latency properties coming from service description: Live Delay: ".concat(r.liveDelay,", Live catchup max drift: ").concat(r.maxDrift))}(s),s.playbackRate&&(u=(l=s).playbackRate.min?Math.round(1e3*(l.playbackRate.min-1))/1e3:NaN,d=l.playbackRate.max?Math.round(1e3*(l.playbackRate.max-1))/1e3:NaN,t.liveCatchup.playbackRate.min=u,t.liveCatchup.playbackRate.max=d,i.debug("Found latency properties coming from service description: Live catchup min playback rate: ".concat(u)),i.debug("Found latency properties coming from service description: Live catchup max playback rate: ".concat(d))),s.operatingQuality,s.operatingBandwidth&&function(e){if(e&&e.operatingBandwidth&&e.operatingBandwidth.mediaType&&"all"!==e.operatingBandwidth.mediaType){var t={};t.minBandwidth=e.operatingBandwidth.min,t.maxBandwidth=e.operatingBandwidth.max,t.targetBandwidth=e.operatingBandwidth.target;var n=[];e.operatingBandwidth.mediaType===gn||e.operatingBandwidth.mediaType===mn?n.push(e.operatingBandwidth.mediaType):"any"===e.operatingBandwidth.mediaType&&(n.push(mn),n.push(gn)),n.forEach(function(e){isNaN(t.minBandwidth)||c("minBitrate",e,t.minBandwidth),isNaN(t.maxBandwidth)||c("maxBitrate",e,t.maxBandwidth),isNaN(t.targetBandwidth)||c("initialBitrate",e,t.targetBandwidth)})}}(s),s.contentSteering&&function(e){t.contentSteering=e.contentSteering}(s))}var l,u,d},reset:function(){l()},setConfig:function(e){e&&e.adapter&&(r=e.adapter)}},i=(0,d.Z)(s).getInstance().getLogger(e),l(),e}vn.__dashjs_factory_name="ServiceDescriptionController";var yn=u.Z.getSingletonFactory(vn),_n=n(3973),En=n.n(_n),bn=n(3039);function Tn(){var e,t,n,i,r,o,s,u,h=this.context,f=(0,l.Z)(h).getInstance();function p(e,t){return e&&n[t]&&n[t][e]?n[t][e].list:[]}function g(e,t){return e&&n[t]&&n[t][e]?n[t][e].current:null}function m(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e&&e.streamInfo){var r=e.type,s=e.streamInfo.id,l=g(r,s);if(n[s]&&n[s][r]&&(n[s][r].current=e,n[s][r].current&&(r!==a.Z.TEXT&&!_(e,l)||r===a.Z.TEXT&&e.isFragmented)&&f.trigger(c.Z.CURRENT_TRACK_CHANGED,{oldMediaInfo:l,newMediaInfo:e,switchMode:i.get().streaming.trackSwitchMode[r]},{streamId:s}),!t)){var d=b(e);if(!d||!n[s][r].storeLastSettings)return;d.roles&&(d.role=d.roles[0],delete d.roles),d.accessibility&&(d.accessibility=d.accessibility[0]),d.audioChannelConfiguration&&(d.audioChannelConfiguration=d.audioChannelConfiguration[0]),o[r]=d,u.setSavedMediaSettings(r,d)}}}function v(e,t){e&&t&&(r[e]=t)}function y(e){return e?r[e]:null}function _(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;var n=e.id===t.id,i=e.viewpoint===t.viewpoint,r=JSON.stringify(e.viewpointsWithSchemeIdUri)===JSON.stringify(t.viewpointsWithSchemeIdUri),a=e.lang===t.lang,o=e.codec===t.codec,s=e.roles.toString()===t.roles.toString(),l=JSON.stringify(e.rolesWithSchemeIdUri)===JSON.stringify(t.rolesWithSchemeIdUri),c=e.accessibility.toString()===t.accessibility.toString(),u=JSON.stringify(e.accessibilitiesWithSchemeIdUri)===JSON.stringify(t.accessibilitiesWithSchemeIdUri),d=e.audioChannelConfiguration.toString()===t.audioChannelConfiguration.toString(),h=JSON.stringify(e.audioChannelConfigurationsWithSchemeIdUri)===JSON.stringify(t.audioChannelConfigurationsWithSchemeIdUri);return n&&o&&i&&r&&a&&s&&l&&c&&u&&d&&h}function E(){n={},o={},r={audio:null,video:null,text:null}}function b(e){var t={lang:e.lang,viewpoint:e.viewpoint,roles:e.roles,accessibility:e.accessibility,audioChannelConfiguration:e.audioChannelConfiguration,codec:e.codec};return t.lang||t.viewpoint||t.role&&t.role.length>0||t.accessibility&&t.accessibility.length>0||t.audioChannelConfiguration&&t.audioChannelConfiguration.length>0?t:null}function T(e,t,n){var i=[];return e.forEach(function(e){t(n,e)&&i.push(e)}),0!==i.length?i:e}function S(e,t){try{return!e.lang||e.lang instanceof RegExp?t.lang.match(e.lang):""!==t.lang&&(0,bn.extendedFilter)(t.lang,En()(e.lang)).length>0}catch(e){return!1}}function w(e,t){return void 0===e.index||null===e.index||t.index===e.index}function A(e,t){return!e.viewpoint||e.viewpoint===t.viewpoint}function R(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!e.role||!!t.roles.filter(function(t){return t===e.role})[0]||t.type===a.Z.AUDIO&&n}function x(e,t){return e.accessibility?!!t.accessibility.filter(function(t){return t===e.accessibility})[0]:!t.accessibility.length}function I(e,t){return!e.audioChannelConfiguration||!!t.audioChannelConfiguration.filter(function(t){return t===e.audioChannelConfiguration})[0]}function L(e,t){return!e.codec||e.codec===t.codec}function M(e){var t,n=0,i=[];return e.forEach(function(e){(t=Math.max.apply(Math,e.bitrateList.map(function(e){return e.bandwidth})))>n?(n=t,i=[e]):t===n&&i.push(e)}),i}function C(e){var t,n=1/0,i=[];return e.forEach(function(e){var r=e.bitrateList.reduce(function(e,t){var n=Math.max(1,t.width*t.height);return e+t.bandwidth/n},0);(t=r/e.bitrateList.length)<n?(n=t,i=[e]):t===n&&i.push(e)}),i}function P(e){var t,n=0,i=[];return e.forEach(function(e){(t=e.representationCount)>n?(n=t,i=[e]):t===n&&i.push(e)}),i}function D(e,n){if(e===a.Z.TEXT)return n[0];var r,o,l,c,u=i.get().streaming.selectionModeForInitialTrack,d=s.getCustomInitialTrackSelectionFunction();if(d&&"function"==typeof d)r=d(n);else switch(u){case a.Z.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY:o=0,l=[],n.forEach(function(e){isNaN(e.selectionPriority)||(e.selectionPriority>o?(o=e.selectionPriority,l=[e]):e.selectionPriority===o&&l.push(e))}),(c=l).length>1&&(c=M(c)),c.length>1&&(c=P(c)),r=c;break;case a.Z.TRACK_SELECTION_MODE_HIGHEST_BITRATE:r=function(e){var t=M(e);return t.length>1&&(t=P(t)),t}(n);break;case a.Z.TRACK_SELECTION_MODE_FIRST_TRACK:r=O(n);break;case a.Z.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY:r=function(e){var t=C(e);return t.length>1&&(t=M(t)),t}(n);break;case a.Z.TRACK_SELECTION_MODE_WIDEST_RANGE:r=function(e){var t=P(e);return t.length>1&&(t=M(e)),t}(n);break;default:t.warn("Track selection mode ".concat(u," is not supported. Falling back to TRACK_SELECTION_MODE_FIRST_TRACK")),r=O(n)}return r.length>0?r[0]:n[0]}function O(e){return e[0]}return e={setInitialMediaSettingsForType:function(e,t){var n=o[e]||y(e),i=p(e,t.id),r=[];n||((n=u.getSavedMediaSettings(e))&&delete n.codec,v(e,n)),i&&0!==i.length&&(n&&(r=T(r=Array.from(i),S,n),r=T(r,w,n),r=T(r,A,n),e===a.Z.AUDIO&&o[e]||(r=T(r,R,n)),r=T(r,x,n),r=T(r,I,n),r=T(r,L,n)),0===r.length?m(D(e,i),!0):r.length>1?m(D(e,r)):m(r[0]))},addTrack:function(e){if(e){var t=e.type;if((r=t)===a.Z.AUDIO||r===a.Z.VIDEO||r===a.Z.TEXT||r===a.Z.IMAGE){var r,o,s=e.streamInfo.id;n[s]||(n[s]={audio:{list:[],storeLastSettings:o=i.get().streaming.saveLastMediaSettingsForCurrentStreamingSession,current:null},video:{list:[],storeLastSettings:o,current:null},text:{list:[],storeLastSettings:o,current:null},image:{list:[],storeLastSettings:o,current:null}});for(var l=n[s][t].list,c=0,u=l.length;c<u;++c)if(_(l[c],e))return;l.push(e)}}},getTracksFor:p,getCurrentTrackFor:g,isCurrentTrack:function(e){if(!e)return!1;var t=e.type,i=e.streamInfo.id;return n[i]&&n[i][t]&&_(n[i][t].current,e)},setTrack:m,selectInitialTrack:D,setInitialSettings:v,getInitialSettings:y,getTracksWithHighestBitrate:M,getTracksWithHighestEfficiency:C,getTracksWithWidestRange:P,isTracksEqual:_,matchSettings:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{var i=!1;if(e.lang){if(e.lang instanceof RegExp)i=t.lang.match(e.lang);else if(""!==t.lang){var r=En()(e.lang);r&&(i=(0,bn.extendedFilter)(t.lang,r).length>0)}}else i=!0;var o=void 0===e.index||null===e.index||t.index===e.index,s=!e.viewpoint||e.viewpoint===t.viewpoint,l=!e.role||!!t.roles.filter(function(t){return t===e.role})[0],c=!e.accessibility||!!t.accessibility.filter(function(t){return t===e.accessibility})[0],u=!e.audioChannelConfiguration||!!t.audioChannelConfiguration.filter(function(t){return t===e.audioChannelConfiguration})[0];return i&&o&&s&&(l||t.type===a.Z.AUDIO&&n)&&c&&u}catch(e){return!1}},matchSettingsLang:S,matchSettingsIndex:w,matchSettingsViewPoint:A,matchSettingsRole:R,matchSettingsAccessibility:x,matchSettingsAudioChannelConfig:I,saveTextSettingsDisabled:function(){u.setSavedMediaSettings(a.Z.TEXT,null)},setConfig:function(e){e&&(e.domStorage&&(u=e.domStorage),e.settings&&(i=e.settings),e.customParametersModel&&(s=e.customParametersModel))},reset:E},t=(0,d.Z)(h).getInstance().getLogger(e),E(),e}Tn.__dashjs_factory_name="MediaController";var Sn=u.Z.getSingletonFactory(Tn);u.Z.updateSingletonFactory(Tn.__dashjs_factory_name,Sn);var wn=Sn,An=NaN,Rn=function e(t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.data={baseUrls:t||null,selectedIdx:n||An},this.children=[]};function xn(){var e,t,n,i,r=this.context,a=Ce(r).getInstance();function o(e,t,n){var i=s(n);e[t]?a.areEqual(i,e[t].data.baseUrls)||(e[t].data.baseUrls=i,e[t].data.selectedIdx=An):e[t]=new Rn(i)}function s(e){var t=n.getBaseURLsFromElement(e),r=i.getSynthesizedBaseUrlElements(t);return r&&r.length>0&&(t=t.concat(r)),t}function l(e,n){var i=n||t;e(i.data),i.children&&i.children.forEach(function(t){return l(e,t)})}function c(){t=new Rn}return e={reset:c,update:function(e){!function(e){!function(){if(!n||!n.hasOwnProperty("getBaseURLsFromElement")||!n.hasOwnProperty("getRepresentationSortFunction"))throw new Error("setConfig function has to be called previously")}();var i=s(e);a.areEqual(i,t.data.baseUrls)||(t.data.baseUrls=i,t.data.selectedIdx=An),e&&e.Period_asArray&&e.Period_asArray.forEach(function(e,i){o(t.children,i,e),e.AdaptationSet_asArray&&e.AdaptationSet_asArray.forEach(function(e,r){o(t.children[i].children,r,e),e.Representation_asArray&&e.Representation_asArray.sort(n.getRepresentationSortFunction()).forEach(function(e,n){o(t.children[i].children[r].children,n,e)})})})}(e)},getForPath:function(e){var n=t,i=[n.data];return e&&e.forEach(function(e){(n=n.children[e])&&i.push(n.data)}),i.filter(function(e){return e.baseUrls.length})},invalidateSelectedIndexes:function(e){l(function(t){isNaN(t.selectedIdx)||e===t.baseUrls[t.selectedIdx].serviceLocation&&(t.selectedIdx=An)})},setConfig:function(e){e.adapter&&(n=e.adapter),e.contentSteeringController&&(i=e.contentSteeringController)},getBaseUrls:function(e){return s(e)}},c(),e}xn.__dashjs_factory_name="BaseURLTreeModel";var In=u.Z.getClassFactory(xn);function Ln(e){var t=(e=e||{}).blacklistController;return{select:function(e){return e&&function(e){var t,n,i=0,r=[],a=0;if((n=e.sort(function(e,t){var n=e.dvbPriority-t.dvbPriority;return isNaN(n)?0:n}).filter(function(e,t,n){return!t||n[0].dvbPriority&&e.dvbPriority&&n[0].dvbPriority===e.dvbPriority})).length)return n.length>1&&(n.forEach(function(e){i+=e.dvbWeight,r.push(i)}),t=Math.floor(Math.random()*(i-1)),r.every(function(e,n){return a=n,!(t<e)})),n[a]}((n=[],e.filter(function(e){return!t.contains(e.serviceLocation)||(e.dvbPriority&&n.push(e.dvbPriority),!1)}).filter(function(e){return!n.length||!e.dvbPriority||-1===n.indexOf(e.dvbPriority)})));var n}}}Ln.__dashjs_factory_name="DVBSelector";var Mn=u.Z.getClassFactory(Ln);function Cn(e){var t=(e=e||{}).blacklistController;return{select:function(e){var n,i=0;return e&&e.some(function(e,n){return i=n,!t.contains(e.serviceLocation)})&&(n=e[i]),n}}}Cn.__dashjs_factory_name="BasicSelector";var Pn=u.Z.getClassFactory(Cn);function Dn(){var e,t,n,i=this.context;function r(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=0,r=NaN,a=function(){var a=e[i],o=t.findIndex(function(e){return e.serviceLocation&&e.serviceLocation===a});if(-1!==o&&!n.contains(t[o].serviceLocation))return r=o,"break";i+=1};i<e.length&&"break"!==a(););return r}return e={selectBaseUrlIndex:function(e){var n=NaN;if(isNaN(e.selectedIdx)){var i=t.getSteeringDataFromManifest();i&&i.defaultServiceLocationArray.length>0&&(n=r(i.defaultServiceLocationArray,e.baseUrls))}var a=t.getCurrentSteeringResponseData();return e.baseUrls&&e.baseUrls.length&&a&&a.pathwayPriority&&a.pathwayPriority.length&&(n=r(a.pathwayPriority,e.baseUrls)),n},setConfig:function(e){e.blacklistController&&(n=e.blacklistController),e.contentSteeringController&&(t=e.contentSteeringController)}},t=Wt(i).getInstance(),e}Dn.__dashjs_factory_name="ContentSteeringSelector";var On=u.Z.getClassFactory(Dn);function Nn(){var e,t,n,i,r,a,o=this.context,s=(0,l.Z)(o).getInstance(),u=(0,I.Z)(o).getInstance();function d(){t.reset()}return e={chooseSelector:function(e){(0,Y.PS)(e,"boolean"),a=e?i:n},select:function(e){if(e){if(u.get().streaming.applyContentSteering){var t=r.selectBaseUrlIndex(e);isNaN(t)||-1===t||(e.selectedIdx=t)}if(!isNaN(e.selectedIdx))return e.baseUrls[e.selectedIdx];var i=a.select(e.baseUrls);return i?(e.selectedIdx=e.baseUrls.indexOf(i),i):(s.trigger(c.Z.URL_RESOLUTION_FAILED,{error:new T.Z(x.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE,x.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE)}),void(a===n&&d()))}},reset:d,setConfig:function(e){e.selector&&(a=e.selector),e.contentSteeringSelector&&(r=e.contentSteeringSelector)}},t=Vt(o).create({updateEventName:c.Z.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,addBlacklistEventName:c.Z.SERVICE_LOCATION_BASE_URL_BLACKLIST_ADD}),n=Pn(o).create({blacklistController:t}),i=Mn(o).create({blacklistController:t}),(r=On(o).create()).setConfig({blacklistController:t}),a=n,e}Nn.__dashjs_factory_name="BaseURLSelector";var kn=u.Z.getClassFactory(Nn);function Fn(){var e,t,n,i,r,a=this.context,o=(0,l.Z)(a).getInstance(),s=(0,Q.Z)(a).getInstance();function u(e){n.update(e),i.chooseSelector(t.getIsDVB(e)),o.trigger(h.Z.BASE_URLS_UPDATED,{baseUrls:d(e)})}function d(e){return n.getBaseUrls(e)}return e={reset:function(){n.reset(),i.reset()},initialize:function(e){n.setConfig({adapter:t,contentSteeringController:r}),u(e)},resolve:function(e){var t=n.getForPath(e).reduce(function(e,t){var n=i.select(t);return n?(s.isRelative(n.url)?e.url=s.resolve(n.url,e.url):(e.url=n.url,e.serviceLocation=n.serviceLocation),e.availabilityTimeOffset=n.availabilityTimeOffset,e.availabilityTimeComplete=n.availabilityTimeComplete,e.queryParams=n.queryParams,e):new Te},new Te);if(!s.isRelative(t.url))return t},setConfig:function(e){e.baseURLTreeModel&&(n=e.baseURLTreeModel),e.baseURLSelector&&(i=e.baseURLSelector),e.adapter&&(t=e.adapter),e.contentSteeringController&&(r=e.contentSteeringController)},getBaseUrls:d,update:u},n=In(a).create(),i=kn(a).create(),o.on(c.Z.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,function(e){n.invalidateSelectedIndexes(e.entry)},e),e}Fn.__dashjs_factory_name="BaseURLController";var Bn=u.Z.getClassFactory(Fn);function Un(e){return(Un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Vn(e,t){return(Vn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Gn(e,t){return!t||"object"!==Un(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Hn(e){return(Hn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var jn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Vn(e,t)}(r,e);var t,n,i=(t=r,n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=Hn(t);if(n){var r=Hn(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return Gn(this,e)});function r(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(n=i.call(this)).url=e||null,n.type=t||null,n.mediaType=a.Z.STREAM,n.responseType="",n}return r}(g.Z);function zn(e){e=e||{};var t=this.context,n=(0,l.Z)(t).getInstance(),i=Tt(t).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,errors:x});return{load:function(e,t,r){var a=function(i,a){t.resolved=!0,t.resolvedContent=i||null,n.trigger(c.Z.XLINK_ELEMENT_LOADED,{element:t,resolveObject:r,error:i||a?null:new T.Z(x.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE,x.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE+e)})};if("urn:mpeg:dash:resolve-to-zero:2013"===e)a(null,!0);else{var o=new jn(e,L.w.XLINK_EXPANSION_TYPE);i.load({request:o,success:function(e){a(e)},error:function(){a(null)}})}},reset:function(){i&&(i.abort(),i=null)}}}zn.__dashjs_factory_name="XlinkLoader";var Zn=u.Z.getClassFactory(zn),qn=function(e){function t(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!=t||(t=e.nodeName),t}function n(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):e}function i(e,t,n,i){for(var r=0;r<e.length;r++){var a=e[r];if("string"==typeof a){if(a==i)break}else if(a instanceof RegExp){if(a.test(i))break}else if("function"==typeof a&&a(t,n,i))break}return r!=e.length}function r(t,n,r){"property"===e.arrayAccessForm&&(t[n]instanceof Array?t[n+"_asArray"]=t[n]:t[n+"_asArray"]=[t[n]]),!(t[n]instanceof Array)&&e.arrayAccessFormPaths.length>0&&i(e.arrayAccessFormPaths,t,n,r)&&(t[n]=[t[n]])}function a(e){var t=e.split(/[-T:+Z]/g),n=new Date(t[0],t[1]-1,t[2]),i=t[5].split(".");if(n.setHours(t[3],t[4],i[0]),i.length>1&&n.setMilliseconds(i[1]),t[6]&&t[7]){var r=60*t[6]+Number(t[7]);r=0+("-"==(/\d\d-\d\d:\d\d$/.test(e)?"-":"+")?-1*r:r),n.setMinutes(n.getMinutes()-r-n.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds())));return n}function o(t,n,r,a){return!(1==n&&e.xmlElementsFilter.length>0)||i(e.xmlElementsFilter,t,r,a)}function s(n,l){if(9==n.nodeType){for(var c=new Object,u=n.childNodes,d=0;d<u.length;d++)1==(f=u[d]).nodeType&&(e.ignoreRoot?c=s(f):(c={})[p=t(f)]=s(f));return c}if(1==n.nodeType){(c=new Object).__cnt=0;var h=[];for(u=n.childNodes,d=0;d<u.length;d++){var f,p=t(f=u[d]);if(8!=f.nodeType){var g=l+"."+p;if(o(c,f.nodeType,p,g))if(c.__cnt++,null==c[p]){var m=s(f,g);("#text"!=p||/[^\s]/.test(m))&&((v={})[p]=m,h.push(v)),c[p]=m,r(c,p,g)}else{var v;null!=c[p]&&(c[p]instanceof Array||(c[p]=[c[p]],r(c,p,g))),m=s(f,g),("#text"!=p||/[^\s]/.test(m))&&((v={})[p]=m,h.push(v)),c[p][c[p].length]=m}}}c.__children=h;for(var y=t(n),_=0;_<n.attributes.length;_++){var E=n.attributes[_];c.__cnt++;for(var b=E.value,T=0,S=e.matchers.length;T<S;T++){var w=e.matchers[T];w.test(E,y)&&(b=w.converter(E.value))}c[e.attributePrefix+E.name]=b}var A=n.prefix;return null!=A&&""!=A&&(c.__cnt++,c.__prefix=A),null!=c["#text"]&&(c.__text=c["#text"],c.__text instanceof Array&&(c.__text=c.__text.join("\n")),e.stripWhitespaces&&(c.__text=c.__text.trim()),delete c["#text"],"property"==e.arrayAccessForm&&delete c["#text_asArray"],c.__text=function(t,n,r){if(e.datetimeAccessFormPaths.length>0){var o=r.split(".#")[0];return i(e.datetimeAccessFormPaths,t,n,o)?a(t):t}return t}(c.__text,p,l+"."+p)),null!=c["#cdata-section"]&&(c.__cdata=c["#cdata-section"],delete c["#cdata-section"],"property"==e.arrayAccessForm&&delete c["#cdata-section_asArray"]),0==c.__cnt&&"text"==e.emptyNodeForm?c="":1==c.__cnt&&null!=c.__text?c=c.__text:1!=c.__cnt||null==c.__cdata||e.keepCData?c.__cnt>1&&null!=c.__text&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&""==c.__text||""==c.__text.trim())&&delete c.__text:c=c.__cdata,delete c.__cnt,!e.enableToStringFunc||null==c.__text&&null==c.__cdata||(c.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),c}if(3==n.nodeType||4==n.nodeType)return n.nodeValue}function l(t,i,r,a){var o="<"+(null!=t&&null!=t.__prefix?t.__prefix+":":"")+i;if(null!=r)for(var s=0;s<r.length;s++){var l=r[s],c=t[l];e.escapeMode&&(c=n(c)),o+=" "+l.substr(e.attributePrefix.length)+"=",e.useDoubleQuotes?o+='"'+c+'"':o+="'"+c+"'"}return o+(a?"/>":">")}function c(e,t){return"</"+(null!=e.__prefix?e.__prefix+":":"")+t+">"}function u(t,n){return"property"==e.arrayAccessForm&&(r="_asArray",-1!==(i=n.toString()).indexOf(r,i.length-r.length))||0==n.toString().indexOf(e.attributePrefix)||0==n.toString().indexOf("__")||t[n]instanceof Function;var i,r}function d(e){var t=0;if(e instanceof Object)for(var n in e)u(e,n)||t++;return t}function h(t,n,r){return 0==e.jsonPropertiesFilter.length||""==r||i(e.jsonPropertiesFilter,t,n,r)}function f(t){var n=[];if(t instanceof Object)for(var i in t)-1==i.toString().indexOf("__")&&0==i.toString().indexOf(e.attributePrefix)&&n.push(i);return n}function p(t){var i,r,a="";return t instanceof Object?a+=(r="",null!=(i=t).__cdata&&(r+="<![CDATA["+i.__cdata+"]]>"),null!=i.__text&&(e.escapeMode?r+=n(i.__text):r+=i.__text),r):null!=t&&(e.escapeMode?a+=n(t):a+=t),a}function g(e,t){return""===e?t:e+"."+t}function m(e,t,n,i){var r="";if(0==e.length)r+=l(e,t,n,!0);else for(var a=0;a<e.length;a++)r+=l(e[a],t,f(e[a]),!1),r+=v(e[a],g(i,t)),r+=c(e[a],t);return r}function v(e,t){var n="";if(d(e)>0)for(var i in e)if(!u(e,i)&&(""==t||h(e,i,g(t,i)))){var r=e[i],a=f(r);null==r||null==r?n+=l(r,i,a,!0):r instanceof Object?r instanceof Array?n+=m(r,i,a,t):r instanceof Date?(n+=l(r,i,a,!1),n+=r.toISOString(),n+=c(r,i)):d(r)>0||null!=r.__text||null!=r.__cdata?(n+=l(r,i,a,!1),n+=v(r,g(t,i)),n+=c(r,i)):n+=l(r,i,a,!0):(n+=l(r,i,a,!1),n+=p(r),n+=c(r,i))}return n+p(e)}void 0===(e=e||{}).escapeMode&&(e.escapeMode=!0),void 0===e.attributePrefix&&(e.attributePrefix="_"),e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",void 0===e.enableToStringFunc&&(e.enableToStringFunc=!0),e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],void 0===e.skipEmptyTextNodesForObj&&(e.skipEmptyTextNodesForObj=!0),void 0===e.stripWhitespaces&&(e.stripWhitespaces=!0),e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[],void 0===e.useDoubleQuotes&&(e.useDoubleQuotes=!1),e.xmlElementsFilter=e.xmlElementsFilter||[],e.jsonPropertiesFilter=e.jsonPropertiesFilter||[],void 0===e.keepCData&&(e.keepCData=!1),void 0===e.ignoreRoot&&(e.ignoreRoot=!1),this.parseXmlString=function(e){var t;if(void 0===e)return null;if(window.DOMParser){var n=new window.DOMParser;try{(t=n.parseFromString(e,"text/xml")).getElementsByTagNameNS("*","parsererror").length>0&&(t=null)}catch(e){t=null}}else 0==e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),(t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e);return t},this.asArray=function(e){return void 0===e||null==e?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?a(e):e},this.xml2json=function(e){return s(e)},this.xml_str2json=function(e){var t=this.parseXmlString(e);return null!=t?this.xml2json(t):null},this.json2xml_str=function(e){return v(e,"")},this.json2xml=function(e){var t=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return"1.2.0"}},Wn="onLoad";function Yn(e){e=e||{};var t,n,i,r,a,s,u=this.context,d=(0,l.Z)(u).getInstance(),h=(0,Q.Z)(u).getInstance();function f(e,t,n){var i,r,a={};a.elements=e,a.type=t,a.resolveType=n,0===a.elements.length&&g(a);for(var o=0;o<a.elements.length;o++)i=a.elements[o],r=h.isHTTPURL(i.url)?i.url:i.originalContent.BaseURL+i.url,s.load(r,i,a)}function p(e){var t,n,i="";if(t=e.element,n=e.resolveObject,t.resolvedContent){var r=0;0===t.resolvedContent.indexOf("<?xml")&&(r=t.resolvedContent.indexOf("?>")+2),i=t.resolvedContent.substr(0,r)+"<response>"+t.resolvedContent.substr(r)+"</response>",t.resolvedContent=a.xml_str2json(i)}(function(e){var t;for(t=0;t<e.elements.length;t++)if(!1===e.elements[t].resolved)return!1;return!0})(n)&&g(n)}function g(e){var t,n,a=[];if(function(e){var t,n,a,o,s,l,c=[];for(o=e.elements.length-1;o>=0;o--){if(n=(t=e.elements[o]).type+"_asArray",t.resolvedContent){if(t.resolvedContent)for(s=0;s<t.resolvedContent[n].length;s++)a=t.resolvedContent[n][s],c.push(a)}else delete t.originalContent["xlink:actuate"],delete t.originalContent["xlink:href"],c.push(t.originalContent);for(t.parentElement[n].splice(t.index,1),l=0;l<c.length;l++)t.parentElement[n].splice(t.index+l,0,c[l]);c=[]}e.elements.length>0&&i.run(r)}(e),"onActuate"===e.resolveType&&d.trigger(c.Z.XLINK_READY,{manifest:r}),e.resolveType===Wn)switch(e.type){case o.Z.PERIOD:for(t=0;t<r[o.Z.PERIOD+"_asArray"].length;t++)(n=r[o.Z.PERIOD+"_asArray"][t]).hasOwnProperty(o.Z.ADAPTATION_SET+"_asArray")&&(a=a.concat(m(n[o.Z.ADAPTATION_SET+"_asArray"],n,o.Z.ADAPTATION_SET,Wn))),n.hasOwnProperty(o.Z.EVENT_STREAM+"_asArray")&&(a=a.concat(m(n[o.Z.EVENT_STREAM+"_asArray"],n,o.Z.EVENT_STREAM,Wn)));f(a,o.Z.ADAPTATION_SET,Wn);break;case o.Z.ADAPTATION_SET:d.trigger(c.Z.XLINK_READY,{manifest:r})}}function m(e,t,n,i){var r,a,o,s=[];for(a=e.length-1;a>=0;a--)(r=e[a]).hasOwnProperty("xlink:href")&&"urn:mpeg:dash:resolve-to-zero:2013"===r["xlink:href"]&&e.splice(a,1);for(a=0;a<e.length;a++)(r=e[a]).hasOwnProperty("xlink:href")&&r.hasOwnProperty("xlink:actuate")&&r["xlink:actuate"]===i&&(o=v(r["xlink:href"],t,n,a,i,r),s.push(o));return s}function v(e,t,n,i,r,a){return{url:e,parentElement:t,type:n,index:i,resolveType:r,originalContent:a,resolvedContent:null,resolved:!1}}return t={resolveManifestOnLoad:function(e){a=new qn({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!1,ignoreRoot:!0,matchers:n}),(r=e).Period_asArray?f(m(r.Period_asArray,r,o.Z.PERIOD,Wn),o.Z.PERIOD,Wn):d.trigger(c.Z.XLINK_READY,{manifest:r})},setMatchers:function(e){e&&(n=e)},setIron:function(e){e&&(i=e)},reset:function(){d.off(c.Z.XLINK_ELEMENT_LOADED,p,t),s&&(s.reset(),s=null)}},d.on(c.Z.XLINK_ELEMENT_LOADED,p,t),s=Zn(u).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,settings:e.settings}),t}Yn.__dashjs_factory_name="XlinkController";var Kn=u.Z.getClassFactory(Yn);function Xn(e){return(Xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qn(e){function t(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function n(e,n,i){for(var r=0,a=e.length;r<a;++r){var o=e[r];if(n[o.name])if(i[o.name]){if(o.merge){var s=n[o.name],l=i[o.name];"object"===Xn(s)&&"object"===Xn(l)?t(s,l):i[o.name]=s+l}}else i[o.name]=n[o.name]}}function i(e,t){for(var r=0,a=e.children.length;r<a;++r){var o=e.children[r],s=t[o.name+"_asArray"];if(s)for(var l=0,c=s.length;l<c;++l){var u=s[l];n(e.properties,t,u),i(o,u)}}}return{run:function(t){if(null===t||"object"!==Xn(t))return t;if(t.Period_asArray&&"period"in e)for(var n=e.period,r=t.Period_asArray,a=0,o=r.length;a<o;++a){var s=r[a];if(i(n,s),"adaptationset"in e){var l=s.AdaptationSet_asArray;if(l)for(var c=e.adaptationset,u=0,d=l.length;u<d;++u)i(c,l[u])}}return t}}}Qn.__dashjs_factory_name="ObjectIron";var Jn=u.Z.getClassFactory(Qn);function $n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ei=function(){function e(t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this._test=t,this._converter=n}var t;return(t=[{key:"test",get:function(){return this._test}},{key:"converter",get:function(){return this._converter}}])&&$n(e.prototype,t),e}();function ti(e){return(ti="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ni(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ii(e,t){return(ii=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ri(e,t){return!t||"object"!==ti(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ai(e){return(ai=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var oi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ii(e,t)}(r,e);var t,n,i=(t=r,n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=ai(t);if(n){var r=ai(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return ri(this,e)});function r(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),i.call(this,function(e,t){var n,i=(ni(n={},o.Z.MPD,[o.Z.ID,o.Z.PROFILES]),ni(n,o.Z.PERIOD,[o.Z.ID]),ni(n,o.Z.BASE_URL,[o.Z.SERVICE_LOCATION,o.Z.BYTE_RANGE]),ni(n,o.Z.SEGMENT_BASE,[o.Z.INDEX_RANGE]),ni(n,o.Z.INITIALIZATION,[o.Z.RANGE]),ni(n,o.Z.REPRESENTATION_INDEX,[o.Z.RANGE]),ni(n,o.Z.SEGMENT_LIST,[o.Z.INDEX_RANGE]),ni(n,o.Z.BITSTREAM_SWITCHING,[o.Z.RANGE]),ni(n,o.Z.SEGMENT_URL,[o.Z.MEDIA_RANGE,o.Z.INDEX_RANGE]),ni(n,o.Z.SEGMENT_TEMPLATE,[o.Z.INDEX_RANGE,o.Z.MEDIA,o.Z.INDEX,o.Z.INITIALIZATION_MINUS,o.Z.BITSTREAM_SWITCHING_MINUS]),ni(n,o.Z.ASSET_IDENTIFIER,[o.Z.VALUE,o.Z.ID]),ni(n,o.Z.EVENT_STREAM,[o.Z.VALUE]),ni(n,o.Z.ADAPTATION_SET,[o.Z.PROFILES,o.Z.MIME_TYPE,o.Z.SEGMENT_PROFILES,o.Z.CODECS,o.Z.CONTENT_TYPE]),ni(n,o.Z.FRAME_PACKING,[o.Z.VALUE,o.Z.ID]),ni(n,o.Z.AUDIO_CHANNEL_CONFIGURATION,[o.Z.VALUE,o.Z.ID]),ni(n,o.Z.CONTENT_PROTECTION,[o.Z.VALUE,o.Z.ID]),ni(n,o.Z.ESSENTIAL_PROPERTY,[o.Z.VALUE,o.Z.ID]),ni(n,o.Z.SUPPLEMENTAL_PROPERTY,[o.Z.VALUE,o.Z.ID]),ni(n,o.Z.INBAND_EVENT_STREAM,[o.Z.VALUE,o.Z.ID]),ni(n,o.Z.ACCESSIBILITY,[o.Z.VALUE,o.Z.ID]),ni(n,o.Z.ROLE,[o.Z.VALUE,o.Z.ID]),ni(n,o.Z.RATING,[o.Z.VALUE,o.Z.ID]),ni(n,o.Z.VIEWPOINT,[o.Z.VALUE,o.Z.ID]),ni(n,o.Z.CONTENT_COMPONENT,[o.Z.CONTENT_TYPE]),ni(n,o.Z.REPRESENTATION,[o.Z.ID,o.Z.DEPENDENCY_ID,o.Z.MEDIA_STREAM_STRUCTURE_ID]),ni(n,o.Z.SUBSET,[o.Z.ID]),ni(n,o.Z.METRICS,[o.Z.METRICS_MINUS]),ni(n,o.Z.REPORTING,[o.Z.VALUE,o.Z.ID]),n);if(i.hasOwnProperty(t)){var r=i[t];return void 0!==r&&r.indexOf(e.name)>=0}return!1},function(e){return String(e)})}return r}(ei);function si(e){return(si="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function li(e,t){return(li=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ci(e,t){return!t||"object"!==si(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ui(e){return(ui=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var di=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,hi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&li(e,t)}(r,e);var t,n,i=(t=r,n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=ui(t);if(n){var r=ui(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return ci(this,e)});function r(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),i.call(this,function(e){for(var t=[o.Z.MIN_BUFFER_TIME,o.Z.MEDIA_PRESENTATION_DURATION,o.Z.MINIMUM_UPDATE_PERIOD,o.Z.TIMESHIFT_BUFFER_DEPTH,o.Z.MAX_SEGMENT_DURATION,o.Z.MAX_SUBSEGMENT_DURATION,o.Z.SUGGESTED_PRESENTATION_DELAY,o.Z.START,a.Z.START_TIME,o.Z.DURATION],n=t.length,i=0;i<n;i++)if(e.nodeName===t[i])return di.test(e.value);return!1},function(e){var t=di.exec(e),n=31536e3*parseFloat(t[3]||0)+2592e3*parseFloat(t[5]||0)+86400*parseFloat(t[7]||0)+3600*parseFloat(t[9]||0)+60*parseFloat(t[11]||0)+parseFloat(t[13]||0);return void 0!==t[1]&&(n=-n),n})}return r}(ei);function fi(e){return(fi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pi(e,t){return(pi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function gi(e,t){return!t||"object"!==fi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function mi(e){return(mi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var vi=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})(?::?)([0-9]{2}))?/,yi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pi(e,t)}(r,e);var t,n,i=(t=r,n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=mi(t);if(n){var r=mi(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return gi(this,e)});function r(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),i.call(this,function(e){return vi.test(e.value)},function(e){var t,n=vi.exec(e);if(t=Date.UTC(parseInt(n[1],10),parseInt(n[2],10)-1,parseInt(n[3],10),parseInt(n[4],10),parseInt(n[5],10),n[6]&&parseInt(n[6],10)||0,n[7]&&1e3*parseFloat(n[7])||0),n[9]&&n[10]){var i=60*parseInt(n[9],10)+parseInt(n[10],10);t+=("+"===n[8]?-1:1)*i*60*1e3}return new Date(t)})}return r}(ei);function _i(e){return(_i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ei(e,t){return(Ei=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function bi(e,t){return!t||"object"!==_i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ti(e){return(Ti=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Si=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,wi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ei(e,t)}(r,e);var t,n,i=(t=r,n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=Ti(t);if(n){var r=Ti(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return bi(this,e)});function r(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),i.call(this,function(e){return Si.test(e.value)},function(e){return parseFloat(e)})}return r}(ei);function Ai(e){return(Ai="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ri(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xi(e,t){return(xi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ii(e,t){return!t||"object"!==Ai(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Li(e){return(Li=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Mi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xi(e,t)}(r,e);var t,n,i=(t=r,n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=Li(t);if(n){var r=Li(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return Ii(this,e)});function r(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),i.call(this,function(e,t){var n,i=(Ri(n={},o.Z.ADAPTATION_SET,[o.Z.LANG]),Ri(n,o.Z.REPRESENTATION,[o.Z.LANG]),Ri(n,o.Z.CONTENT_COMPONENT,[o.Z.LANG]),Ri(n,o.Z.LABEL,[o.Z.LANG]),Ri(n,o.Z.GROUP_LABEL,[o.Z.LANG]),n);if(i.hasOwnProperty(t)){var r=i[t];return void 0!==r&&r.indexOf(e.name)>=0}return!1},function(e){return En()(e)||String(e)})}return r}(ei);function Ci(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Pi=function(){function e(t){var n;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this._name=t,this._merge=(n=t)&&n.length&&n.charAt(0)===n.charAt(0).toUpperCase()}var t;return(t=[{key:"name",get:function(){return this._name}},{key:"merge",get:function(){return this._merge}}])&&Ci(e.prototype,t),e}();function Di(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Oi=function(){function e(t,n,i){var r=this;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this._name=t||"",this._properties=[],this._children=i||[],Array.isArray(n)&&n.forEach(function(e){r._properties.push(new Pi(e))})}var t;return(t=[{key:"name",get:function(){return this._name}},{key:"children",get:function(){return this._children}},{key:"properties",get:function(){return this._properties}}])&&Di(e.prototype,t),e}();function Ni(e){return(Ni="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ki(e,t){return(ki=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Fi(e,t){return!t||"object"!==Ni(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Bi(e){return(Bi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ui=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ki(e,t)}(r,e);var t,n,i=(t=r,n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=Bi(t);if(n){var r=Bi(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return Fi(this,e)});function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var e=[o.Z.PROFILES,o.Z.WIDTH,o.Z.HEIGHT,o.Z.SAR,o.Z.FRAMERATE,o.Z.AUDIO_SAMPLING_RATE,o.Z.MIME_TYPE,o.Z.SEGMENT_PROFILES,o.Z.CODECS,o.Z.MAXIMUM_SAP_PERIOD,o.Z.START_WITH_SAP,o.Z.MAX_PLAYOUT_RATE,o.Z.CODING_DEPENDENCY,o.Z.SCAN_TYPE,o.Z.FRAME_PACKING,o.Z.AUDIO_CHANNEL_CONFIGURATION,o.Z.CONTENT_PROTECTION,o.Z.ESSENTIAL_PROPERTY,o.Z.ESSENTIAL_PROPERTY+"_asArray",o.Z.SUPPLEMENTAL_PROPERTY,o.Z.INBAND_EVENT_STREAM];return i.call(this,o.Z.ADAPTATION_SET,e,[new Oi(o.Z.REPRESENTATION,e,[new Oi(o.Z.SUB_REPRESENTATION,e)])])}return r}(Oi);function Vi(e){return(Vi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gi(e,t){return(Gi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Hi(e,t){return!t||"object"!==Vi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ji(e){return(ji=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var zi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Gi(e,t)}(r,e);var t,n,i=(t=r,n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=ji(t);if(n){var r=ji(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return Hi(this,e)});function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var e=[o.Z.SEGMENT_BASE,o.Z.SEGMENT_TEMPLATE,o.Z.SEGMENT_LIST];return i.call(this,o.Z.PERIOD,e,[new Oi(o.Z.ADAPTATION_SET,e,[new Oi(o.Z.REPRESENTATION,e)])])}return r}(Oi);function Zi(e){e=e||{};var t,n,i,r,a,o=this.context,s=e.debug;return t={parse:function(e){var t,i=window.performance.now();if(!(t=r.xml_str2json(e)))throw new Error("parsing the manifest failed");var o=window.performance.now();t.Patch?((t=t.Patch).add_asArray&&t.add_asArray.forEach(function(e){return a.run(e)}),t.replace_asArray&&t.replace_asArray.forEach(function(e){return a.run(e)})):(t=t.MPD,a.run(t));var s=window.performance.now();return n.info("Parsing complete: ( xml2json: "+(o-i).toPrecision(3)+"ms, objectiron: "+(s-o).toPrecision(3)+"ms, total: "+((s-i)/1e3).toPrecision(3)+"s)"),t.protocol="DASH",t},getMatchers:function(){return i},getIron:function(){return a}},n=s.getLogger(t),i=[new hi,new yi,new wi,new Mi,new oi],r=new qn({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!0,ignoreRoot:!1,matchers:i}),a=Jn(o).create({adaptationset:new Ui,period:new zi}),t}Zi.__dashjs_factory_name="DashParser";var qi=u.Z.getClassFactory(Zi);function Wi(e){e=e||{};var t,n,i,r,s,u=this.context,d=e.debug,h=e.settings,f=(0,l.Z)(u).getInstance(),p=(0,Q.Z)(u).getInstance(),g=e.mssHandler,m=e.errHandler;function v(e){f.trigger(c.Z.INTERNAL_MANIFEST_LOADED,{manifest:e.manifest})}function y(e){var t=null;return e.indexOf("SmoothStreamingMedia")>-1?(g&&(t=g.createMssParser(),g.createMssFragmentProcessor(),g.registerEvents()),t):e.indexOf("MPD")>-1||e.indexOf("Patch")>-1?qi(u).create({debug:d}):t}return t={load:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=new Date,l=new jn(e,L.w.MPD_TYPE);t&&(l.serviceLocation=t),a&&(l.queryParams=a),l.requestStartDate||(l.requestStartDate=o),f.trigger(c.Z.MANIFEST_LOADING_STARTED,{request:l}),i.load({request:l,success:function(t,i,a){var o,l,u;if(r)if(a&&a!==e?(l=p.parseBaseUrl(a),o=a):(p.isRelative(e)&&(e=p.resolve(e,window.location.href)),l=p.parseBaseUrl(e)),"No Content"!=i)if(null===s&&(s=y(t)),null!==s){r.setMatchers(s.getMatchers()),r.setIron(s.getIron());try{u=s.parse(t)}catch(t){return void f.trigger(c.Z.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new T.Z(x.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,x.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(e))})}if(u){if(u.url=o||e,u.originalUrl||(u.originalUrl=u.url),h&&h.get().streaming.enableManifestDurationMismatchFix&&u.mediaPresentationDuration&&u.Period_asArray.length>1){var d=u.Period_asArray.reduce(function(e,t){return e+t.duration},0);!isNaN(d)&&u.mediaPresentationDuration>d&&(n.warn("Media presentation duration greater than duration of all periods. Setting duration to total period duration"),u.mediaPresentationDuration=d)}u.baseUri=l,u.loadedTime=new Date,r.resolveManifestOnLoad(u),f.trigger(c.Z.ORIGINAL_MANIFEST_LOADED,{originalManifest:t})}else f.trigger(c.Z.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new T.Z(x.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,x.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(e))})}else f.trigger(c.Z.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new T.Z(x.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,x.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(e))});else f.trigger(c.Z.INTERNAL_MANIFEST_LOADED,{manifest:null})},error:function(t,n,i){f.trigger(c.Z.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new T.Z(x.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE,x.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE+"".concat(e,", ").concat(i))})}})},reset:function(){f.off(c.Z.XLINK_READY,v,t),g&&g.reset(),r&&(r.reset(),r=null),i&&(i.abort(),i=null)}},n=d.getLogger(t),f.on(c.Z.XLINK_READY,v,t),i=Tt(u).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,urlUtils:p,constants:a.Z,dashConstants:o.Z,errors:x,requestTimeout:e.settings.get().streaming.manifestRequestTimeout}),r=Kn(u).create({errHandler:m,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,settings:e.settings}),s=null,t}Wi.__dashjs_factory_name="ManifestLoader";var Yi=u.Z.getClassFactory(Wi);function Ki(){var e=this.context,t=(0,l.Z)(e).getInstance();return{error:function(e){t.trigger(c.Z.ERROR,{error:e})}}}Ki.__dashjs_factory_name="ErrorHandler";var Xi=u.Z.getSingletonFactory(Ki),Qi=n(1715);function Ji(){var e,t,n,i,r,o,s=this.context,u=(0,l.Z)(s).getInstance();function h(e,i){if(!i||!i.Period_asArray||0===i.Period_asArray.length)return Promise.resolve();var r=[];return i.Period_asArray.forEach(function(i){var s,l;r.push((s=i,l=e,new Promise(function(e){if(s&&s.AdaptationSet_asArray&&0!==s.AdaptationSet_asArray.length){var i=[];s.AdaptationSet_asArray.forEach(function(e){var r,s;t.getIsTypeOf(e,l)&&i.push((r=e,s=l,new Promise(function(e){if(r.Representation_asArray&&0!==r.Representation_asArray.length){var i=[],l=[];r.Representation_asArray.forEach(function(e,o){var c=t.getCodec(r,o,!1),u=function(e,t,n){switch(e){case a.Z.VIDEO:return{codec:n,width:(i=t).width||null,height:i.height||null,framerate:i.frameRate||null,bitrate:i.bandwidth||null};case a.Z.AUDIO:return function(e,t){var n=e.audioSamplingRate||null;return{codec:t,bitrate:e.bandwidth||null,samplerate:n}}(t,n);default:return null}var i}(s,e,c);l.push(u),i.push(n.supportsCodec(u,s))}),Promise.all(i).then(function(t){r.Representation_asArray=r.Representation_asArray.filter(function(e,n){return t[n]||o.debug("[Stream] Codec ".concat(l[n].codec," not supported ")),t[n]}),e()}).catch(function(){e()})}else e()})))}),Promise.all(i).then(function(){s.AdaptationSet_asArray=s.AdaptationSet_asArray.filter(function(e){var t=e.Representation_asArray&&e.Representation_asArray.length>0;return t||(u.trigger(c.Z.ADAPTATION_SET_REMOVED_NO_CAPABILITIES,{adaptationSet:e}),o.warn("AdaptationSet has been removed because of no supported Representation")),t}),e()}).catch(function(){e()})}else e()})))}),Promise.all(r)}return e={setConfig:function(e){e&&(e.adapter&&(t=e.adapter),e.capabilities&&(n=e.capabilities),e.settings&&(i=e.settings),e.customParametersModel&&(r=e.customParametersModel))},filterUnsupportedFeatures:function(e){return new Promise(function(s){var l=[];l.push(h(a.Z.VIDEO,e)),l.push(h(a.Z.AUDIO,e)),Promise.all(l).then(function(){var a;i.get().streaming.capabilities.filterUnsupportedEssentialProperties&&(a=e)&&a.Period_asArray&&0!==a.Period_asArray.length&&a.Period_asArray.forEach(function(e){e.AdaptationSet_asArray=e.AdaptationSet_asArray.filter(function(e){return!e.Representation_asArray||0===e.Representation_asArray.length||(e.Representation_asArray=e.Representation_asArray.filter(function(e){var i=t.getEssentialPropertiesForRepresentation(e);if(i&&i.length>0)for(var r=0;r<i.length;){if(!n.supportsEssentialProperty(i[r]))return o.debug("[Stream] EssentialProperty not supported: "+i[r].schemeIdUri),!1;r+=1}return!0}),e.Representation_asArray&&e.Representation_asArray.length>0)})}),function(e){var t=r.getCustomCapabilitiesFilters();t&&0!==t.length&&e&&e.Period_asArray&&0!==e.Period_asArray.length&&e.Period_asArray.forEach(function(e){e.AdaptationSet_asArray=e.AdaptationSet_asArray.filter(function(e){return!e.Representation_asArray||0===e.Representation_asArray.length||(e.Representation_asArray=e.Representation_asArray.filter(function(e){return!t.some(function(t){return!t(e)})}),e.Representation_asArray&&e.Representation_asArray.length>0)})})}(e),s()}).catch(function(){s()})})}},o=(0,d.Z)(s).getInstance().getLogger(e),e}Ji.__dashjs_factory_name="CapabilitiesFilter";var $i=u.Z.getSingletonFactory(Ji),er=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null,this.r=null};function tr(){var e;return{initialize:function(t){if(e=new er,!t)return null;var n=t.indexOf("#");if(-1!==n)for(var i=t.substr(n+1).split("&"),r=0,a=i.length;r<a;++r){var o=i[r],s=o.indexOf("=");if(-1!==s){var l=o.substring(0,s);e.hasOwnProperty(l)&&(e[l]=o.substr(s+1))}}},getURIFragmentData:function(){return e}}}tr.__dashjs_factory_name="URIFragmentModel";var nr=u.Z.getSingletonFactory(tr);function ir(){var e,t=this.context,n=(0,l.Z)(t).getInstance();return{getValue:function(){return e},setValue:function(t){e=t,t&&n.trigger(c.Z.MANIFEST_LOADED,{data:t})}}}ir.__dashjs_factory_name="ManifestModel";var rr=u.Z.getSingletonFactory(ir),ar=-.5;function or(){var e,t,n,i,r=this.context,a=(0,I.Z)(r).getInstance();function o(e,n){return isNaN(e)?0:e>0?(n&&t.warn("Supplied minimum playback rate is a positive value when it should be negative or 0. The supplied rate will not be applied and set to 0: 100% playback speed."),0):e<ar?(n&&t.warn("Supplied minimum playback rate is out of range and will be limited to ".concat(ar,": ").concat(-50,"% playback speed.")),ar):e}function s(e,n){return isNaN(e)?0:e<0?(n&&t.warn("Supplied maximum playback rate is a negative value when it should be negative or 0. The supplied rate will not be applied and set to 0: 100% playback speed."),0):e>1?(n&&t.warn("Supplied maximum playback rate is out of range and will be limited to ".concat(1,": ").concat(200,"% playback speed.")),1):e}function l(){var e=a.get().streaming.buffer.stableBufferTime>0?a.get().streaming.buffer.stableBufferTime:a.get().streaming.buffer.fastSwitchEnabled?20:12,t=n.getLiveDelay();return!isNaN(t)&&t>0?Math.min(e,t):e}return e={getCatchupMaxDrift:function(){if(!isNaN(a.get().streaming.liveCatchup.maxDrift)&&a.get().streaming.liveCatchup.maxDrift>0)return a.get().streaming.liveCatchup.maxDrift;var e=i.getServiceDescriptionSettings();return e&&e.liveCatchup&&!isNaN(e.liveCatchup.maxDrift)&&e.liveCatchup.maxDrift>0?e.liveCatchup.maxDrift:12},getCatchupModeEnabled:function(){return null!==a.get().streaming.liveCatchup.enabled?a.get().streaming.liveCatchup.enabled:n.getInitialCatchupModeActivated()},getStableBufferTime:l,getInitialBufferLevel:function(){var e=a.get().streaming.buffer.initialBufferLevel;return isNaN(e)||e<0?0:Math.min(l(),e)},getRetryAttemptsForType:function(e){var t=isNaN(a.get().streaming.retryAttempts.lowLatencyMultiplyFactor)?5:a.get().streaming.retryAttempts.lowLatencyMultiplyFactor;return n.getLowLatencyModeEnabled()?a.get().streaming.retryAttempts[e]*t:a.get().streaming.retryAttempts[e]},getRetryIntervalsForType:function(e){var t=isNaN(a.get().streaming.retryIntervals.lowLatencyReductionFactor)?10:a.get().streaming.retryIntervals.lowLatencyReductionFactor;return n.getLowLatencyModeEnabled()?a.get().streaming.retryIntervals[e]/t:a.get().streaming.retryIntervals[e]},getCatchupPlaybackRates:function(e){var t=a.get().streaming.liveCatchup.playbackRate;if(!isNaN(t.min)||!isNaN(t.max))return{min:o(t.min,e),max:s(t.max,e)};var n=i.getServiceDescriptionSettings();if(n&&n.liveCatchup&&(!isNaN(n.liveCatchup.playbackRate.min)||!isNaN(n.liveCatchup.playbackRate.max))){var r=n.liveCatchup.playbackRate;return{min:o(r.min,e),max:s(r.max,e)}}return{min:-.5,max:.5}},getAbrBitrateParameter:function(e,t){try{var n=a.get().streaming.abr[e][t];if(!isNaN(n)&&-1!==n)return n;var r=i.getServiceDescriptionSettings();return r&&r[e]&&!isNaN(r[e][t])?r[e][t]:-1}catch(e){return-1}},setConfig:function(e){e.playbackController&&(n=e.playbackController),e.serviceDescriptionController&&(i=e.serviceDescriptionController)},reset:function(){}},t=(0,d.Z)(r).getInstance().getLogger(e),e}or.__dashjs_factory_name="MediaPlayerModel";var sr=u.Z.getSingletonFactory(or),lr=n(1767);function cr(e){var t=(e=e||{}).abrController,n=e.switchHistory,i=e.droppedFramesHistory,r=e.currentRequest,a=e.useBufferOccupancyABR,o=e.useL2AABR,s=e.useLoLPABR,l=e.streamProcessor?e.streamProcessor.getScheduleController():null,c=e.streamProcessor?e.streamProcessor.getRepresentationInfo():null,u=e.videoModel?e.videoModel:null;function d(){return c?c.mediaInfo:null}return{getMediaType:function(){var e=d();return e?e.type:null},getMediaInfo:d,getDroppedFramesHistory:function(){return i},getCurrentRequest:function(){return r},getSwitchHistory:function(){return n},getStreamInfo:function(){var e=d();return e?e.streamInfo:null},getScheduleController:function(){return l},getAbrController:function(){return t},getRepresentationInfo:function(){return c},useBufferOccupancyABR:function(){return a},useL2AABR:function(){return o},useLoLPABR:function(){return s},getVideoModel:function(){return u}}}cr.__dashjs_factory_name="RulesContext";var ur=u.Z.getClassFactory(cr),dr=n(2068);function hr(){var e=[],t=[];return{push:function(n){n.newValue===dr.Z.NO_CHANGE&&(n.newValue=n.oldValue),e[n.oldValue]||(e[n.oldValue]={noDrops:0,drops:0,dropSize:0});var i=n.newValue-n.oldValue,r=i<0?1:0,a=r?-i:0,o=r?0:1;if(e[n.oldValue].drops+=r,e[n.oldValue].dropSize+=a,e[n.oldValue].noDrops+=o,t.push({idx:n.oldValue,noDrop:o,drop:r,dropSize:a}),t.length>8){var s=t.shift();e[s.idx].drops-=s.drop,e[s.idx].dropSize-=s.dropSize,e[s.idx].noDrops-=s.noDrop}},getSwitchRequests:function(){return e},reset:function(){e=[],t=[]}}}hr.__dashjs_factory_name="SwitchRequestHistory";var fr=u.Z.getClassFactory(hr);function pr(){var e={},t={},n={};return{push:function(i,r,a){if(r){e[i]||(e[i]=[],t[i]=0,n[i]=0);var o=a&&a.droppedVideoFrames?a.droppedVideoFrames:0,s=a&&a.totalVideoFrames?a.totalVideoFrames:0,l=o-t[i];t[i]=o;var c=s-n[i];n[i]=s;var u=e[i];isNaN(r)||(u[r]?(u[r].droppedVideoFrames+=l,u[r].totalVideoFrames+=c):u[r]={droppedVideoFrames:l,totalVideoFrames:c})}},getFrameHistory:function(t){return e[t]},clearForStream:function(i){try{delete e[i],delete t[i],delete n[i]}catch(e){}},reset:function(){e={},t={},n={}}}}pr.__dashjs_factory_name="DroppedFramesHistory";var gr=u.Z.getClassFactory(pr);function mr(e){var t,n,i,r,o,s=this.context,c=(e=e||{}).settings,u=(0,l.Z)(s).getInstance();function d(e,t,n,i){var r=Math.pow(.5,n/i.fast);e.fastEstimate=(1-r)*t+r*e.fastEstimate;var a=Math.pow(.5,n/i.slow);e.slowEstimate=(1-a)*t+a*e.slowEstimate,e.totalWeight+=n}function f(e,s,l){return c.get().streaming.abr.movingAverageMethod!==a.Z.MOVING_AVERAGE_SLIDING_WINDOW?function(e,t){var n=e?o.throughputHalfLife:o.latencyHalfLife,a=e?i[t]:r[t];if(!a||a.totalWeight<=0)return NaN;var s=a.fastEstimate/(1-Math.pow(.5,a.totalWeight/n.fast)),l=a.slowEstimate/(1-Math.pow(.5,a.totalWeight/n.slow));return e?Math.min(s,l):Math.max(s,l)}(e,s):(h=function(e,i,r){var a,o;if(e?(a=t[i],o=r?3:4):(a=n[i],o=4),a){if(o>=a.length)o=a.length;else if(e)for(var s=1;s<o;++s){var l=a[a.length-s]/a[a.length-s-1];if((l>=1.3||l<=.7692307692307692)&&(o+=1)===a.length)break}}else o=0;return o}(u=e,d=s,l),f=(u?t:n)[d],0!==h&&f&&0!==f.length?(f=f.slice(-h)).reduce(function(e,t){return e+t})/f.length:NaN);var u,d,h,f}function p(e,t){return f(!0,e,t)}function g(e){t[e]=t[e]||[],n[e]=n[e]||[],i[e]=i[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0},r[e]=r[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0}}function m(){t={},n={},i={},r={}}var v={push:function(e,s,l){if(s.trace&&s.trace.length){var f,p=s.tresponse.getTime()-s.trequest.getTime()||1,m=s._tfinish.getTime()-s.tresponse.getTime()||1,v=s.trace.reduce(function(e,t){return e+t.b[0]},0),y=0;if(0!==(f=s._fileLoaderType&&s._fileLoaderType===a.Z.FILE_LOADER_TYPES.FETCH?s.trace.reduce(function(e,t){return e+t.d},0):l?m:p+m)&&(y=Math.round(8*v/f)),s.cmsd){var _=s.cmsd.dynamic&&s.cmsd.dynamic.etp?s.cmsd.dynamic.etp:null;if(_){var E=c.get().streaming.cmsd.abr.etpWeightRatio;E>0&&E<=1&&(y=y*(1-E)+_*E)}}if(g(e),T=m,(b=e)===a.Z.VIDEO?T<c.get().streaming.cacheLoadThresholds[a.Z.VIDEO]:b===a.Z.AUDIO?T<c.get().streaming.cacheLoadThresholds[a.Z.AUDIO]:void 0){if(t[e].length>0&&!t[e].hasCachedEntries)return;t[e].hasCachedEntries=!0}else t[e]&&t[e].hasCachedEntries&&function(e){delete t[e],delete n[e],delete i[e],delete r[e],g(e)}(e);t[e].push(y),u.trigger(h.Z.THROUGHPUT_MEASUREMENT_STORED,{throughput:y,mediaType:e,httpRequest:s}),t[e].length>20&&t[e].shift(),n[e].push(p),n[e].length>20&&n[e].shift(),d(i[e],y,.001*m,o.throughputHalfLife),d(r[e],p,1,o.latencyHalfLife)}var b,T},getAverageThroughput:p,getSafeAverageThroughput:function(e,t){var n=p(e,t);return isNaN(n)||(n*=c.get().streaming.abr.bandwidthSafetyFactor),n},getAverageLatency:function(e){return f(!1,e)},reset:m};return o={throughputHalfLife:{fast:3,slow:8},latencyHalfLife:{fast:1,slow:2}},m(),v}mr.__dashjs_factory_name="ThroughputHistory";var vr=u.Z.getClassFactory(mr);function yr(){var e,t,n,i,r,o,u,f,p,g,m,v,y,_,E,T,S,w,A,R,x,I,M,C,P,D,O,N=this.context,k=(0,d.Z)(N).getInstance(),F=(0,l.Z)(N).getInstance();function B(){r={},o={},f={},u={},R={},M={},C={},P={},void 0===g&&(g=!1),x&&x.reset(),A=void 0,x=void 0,I=void 0,clearTimeout(p),p=null}function U(t){var r=t.request.mediaType,a=t.streamId;if(r&&a&&u[a]&&O.get().streaming.abr.autoSwitchBitrate[r]){var o=u[a][r];if(o){var l=ur(N).create({abrController:e,streamProcessor:o,currentRequest:t.request,useBufferOccupancyABR:M[r],useL2AABR:C[r],useLoLPABR:P[r],videoModel:_}),c=n.shouldAbandonFragment(l,a);c.quality>dr.Z.NO_CHANGE&&o.getFragmentModel().getRequests({state:b.FRAGMENT_MODEL_LOADING,index:t.request.index})[0]&&(f[a][r].state=s.Z.ABANDON_LOAD,R[a][r].reset(),R[a][r].push({oldValue:z(r,a),newValue:c.quality,confidence:1,reason:c.reason}),Z(r,i.getActiveStreamInfo(),c.quality,c.reason),clearTimeout(p),p=setTimeout(function(){f[a][r].state=s.Z.ALLOW_LOAD,p=null},O.get().streaming.abandonLoadTimeout))}}}function V(e){e.mediaType===a.Z.VIDEO&&(void 0!==A&&x.push(e.streamId,A,_.getPlaybackQuality()),A=e.newQuality)}function G(e){var n,i;e.metric!==s.Z.HTTP_REQUEST||!e.value||e.value.type!==L.w.MEDIA_SEGMENT_TYPE||e.mediaType!==a.Z.AUDIO&&e.mediaType!==a.Z.VIDEO||I.push(e.mediaType,e.value,O.get().streaming.abr.useDeadTimeLatency),e.metric!==s.Z.BUFFER_LEVEL||e.mediaType!==a.Z.AUDIO&&e.mediaType!==a.Z.VIDEO||(n=e.mediaType,i=.001*e.value.level,O.get().streaming.abr.ABRStrategy===a.Z.ABR_STRATEGY_DYNAMIC&&function(e,n){try{var i=E.getStableBufferTime(),r=i,a=.5*i,o=M[e],s=n>(o?a:r);M[e]=s,s!==o&&(s?t.info("["+e+"] switching from throughput to buffer occupancy ABR rule (buffer: "+n.toFixed(3)+")."):t.info("["+e+"] switching from buffer occupancy to throughput ABR rule (buffer: "+n.toFixed(3)+")."))}catch(e){t.error(e)}}(n,i))}function H(e,n){try{var i;return r[n]=r[n]||{},r[n].hasOwnProperty(e)||(r[n][e]=0),i=function(e,t){var n=r[t][e],i=n;if(!u[t]||!u[t][e])return i;var a=j(e,t);void 0!==a&&(i=Math.max(n,a));var o=function(e,t){try{var n=E.getAbrBitrateParameter("maxBitrate",e);return n>-1?K(u[t][e].getMediaInfo(),n,t):void 0}catch(e){return}}(e,t);return void 0!==o&&(i=Math.min(i,o)),i}(e,n),o=i,s=e,l=r[n][s],c=O.get().streaming.abr.maxRepresentationRatio[s],i=function(e,t,n){if(t!==a.Z.VIDEO||!O.get().streaming.abr.limitBitrateByPortal||!u[n]||!u[n][t])return e;g||Q();var i=u[n][t].getStreamInfo(),r=y.getAdaptationForType(i.index,t,i).Representation_asArray,o=e;if(m>0&&v>0){for(;o>0&&r[o]&&m<r[o].width&&m-r[o-1].width<r[o].width-m;)o-=1;for(;o<r.length-1&&r[o].width===r[o+1].width;)o+=1}return o}(i=isNaN(c)||c>=1||c<0?o:Math.min(o,Math.round(l*c)),e,n),O.get().streaming.cmsd.enabled&&O.get().streaming.cmsd.abr.applyMb&&(i=function(e,n,i){if("video"!==n)return e;var r=S.getMaxBitrate(n);if(r<0)return e;var a=W(i,"audio",z("audio",i));r-=a?a.bitrate/1e3:0;var o=K(u[i][n].getMediaInfo(),r,i);return t.debug("Stream ID: "+i+" ["+n+"] Apply max bit rate from CMSD: "+r),Math.min(e,o)}(i,e,n)),i}catch(e){return}var o,s,l,c}function j(e,t){try{return function(e,t){try{var n=E.getAbrBitrateParameter("minBitrate",e);if(n>-1){var i=u[t][e].getMediaInfo(),r=X(i),a=K(i,n,t);return r[a]&&a<r.length-1&&r[a].bitrate<1e3*n&&a++,a}return}catch(e){return}}(e,t)}catch(e){return}}function z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{return t||(t=i.getActiveStreamInfo().id),e&&u[t]&&u[t][e]&&t?(o[t]=o[t]||{},o[t].hasOwnProperty(e)||(o[t][e]=0),o[t][e]):0}catch(e){return 0}}function Z(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(t&&t.id&&e){var r=t.id,a=z(e,r);(0,Y.SE)(n);var o=H(e,r);n!==a&&n>=0&&n<=o&&q(e,a,n,o,i,r)}}function q(e,n,i,r,a,s){if(e&&u[s]&&u[s][e]){var l=u[s][e].getStreamInfo(),d=l&&l.manifestInfo&&l.manifestInfo.isDynamic,h=D.getCurrentBufferLevel(e);t.info("Stream ID: "+s+" ["+e+"] switch from "+n+" to "+i+"/"+r+" (buffer: "+h+") "+(a?JSON.stringify(a):".")),o[s]=o[s]||{},o[s][e]=i;var f=W(s,e,i);F.trigger(c.Z.QUALITY_CHANGE_REQUESTED,{oldQuality:n,newQuality:i,reason:a,streamInfo:l,bitrateInfo:f,maxIdx:r,mediaType:e},{streamId:l.id,mediaType:e});var p=I.getAverageThroughput(e,d);isNaN(p)||w.setSavedBitrateSettings(e,p)}}function W(e,t,n){if(t&&u&&u[e]&&u[e][t]){var i=X(u[e][t].getMediaInfo());return i[n]?i[n]:null}return null}function K(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=e&&e.type?u[n][e.type].getRepresentationInfo():null;if(O.get().streaming.abr.useDeadTimeLatency&&i&&r&&r.fragmentDuration){i/=1e3;var a=r.fragmentDuration;if(i>a)return 0;t*=1-i/a}for(var o=X(e),s=o.length-1;s>=0;s--)if(1e3*t>=o[s].bitrate)return s;return 0}function X(e){var t=[];if(!e||!e.bitrateList)return t;for(var n,i=e.bitrateList,r=e.type,a=0,o=i.length;a<o;a++)(n=new Nt).mediaType=r,n.qualityIndex=a,n.bitrate=i[a].bandwidth,n.width=i[a].width,n.height=i[a].height,n.scanType=i[a].scanType,t.push(n);return t}function Q(){if(_){var e=O.get().streaming.abr.usePixelRatioInLimitBitrateByPortal&&window.hasOwnProperty("devicePixelRatio")?window.devicePixelRatio:1;m=_.getClientWidth()*e,v=_.getClientHeight()*e}}return e={initialize:function(){x=gr(N).create(),I=vr(N).create({settings:O}),(n=(0,lr.Z)(N).create({dashMetrics:D,customParametersModel:T,mediaPlayerModel:E,settings:O})).initialize(),F.on(h.Z.QUALITY_CHANGE_RENDERED,V,e),F.on(h.Z.METRIC_ADDED,G,e),F.on(c.Z.LOADING_PROGRESS,U,e)},isPlayingAtTopQuality:function(e){var t=e?e.id:null,n=z(a.Z.AUDIO,t),i=z(a.Z.VIDEO,t);return n===H(a.Z.AUDIO,t)&&i===H(a.Z.VIDEO,t)},updateTopQualityIndex:function(e){var t=e.type,n=e.streamInfo.id,i=e.representationCount-1;return r[n]=r[n]||{},r[n][t]=i,i},clearDataForStream:function(e){x&&x.clearForStream(e),u[e]&&delete u[e],R[e]&&delete R[e],f[e]&&delete f[e]},getThroughputHistory:function(){return I},getBitrateList:X,getQualityForBitrate:K,getTopBitrateInfoFor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t||(t=i.getActiveStreamInfo().id),e&&u&&u[t]&&u[t][e]){var n=H(e,t),r=X(u[t][e].getMediaInfo());return r[n]?r[n]:null}return null},getMinAllowedIndexFor:j,getMaxAllowedIndexFor:H,getInitialBitrateFor:function(e,t){if(function(){if(!w||!w.hasOwnProperty("getSavedBitrateSettings"))throw new Error(a.Z.MISSING_CONFIG_ERROR)}(),e===a.Z.TEXT)return NaN;var n=w.getSavedBitrateSettings(e),i=E.getAbrBitrateParameter("initialBitrate",e),r=O.get().streaming.abr.initialRepresentationRatio[e];if(-1===i)if(r>-1){var o=u[t][e].getStreamInfo(),s=y.getAdaptationForType(o.index,e,o).Representation_asArray;i=Array.isArray(s)?s[Math.max(Math.round(s.length*r)-1,0)].bandwidth/1e3:0}else i=isNaN(n)?e===a.Z.VIDEO?1e3:100:n;return i},getQualityFor:z,getAbandonmentStateFor:function(e,t){return f[e]&&f[e][t]?f[e][t].state:null},setPlaybackQuality:Z,checkPlaybackQuality:function(t,i){try{if(!(t&&u&&u[i]&&u[i][t]))return!1;if(x){var r=_.getPlaybackQuality();r&&x.push(i,A,r)}if(!O.get().streaming.abr.autoSwitchBitrate[t])return!1;var a=z(t,i),o=ur(N).create({abrController:e,switchHistory:R[i][t],droppedFramesHistory:x,streamProcessor:u[i][t],currentValue:a,useBufferOccupancyABR:M[t],useL2AABR:C[t],useLoLPABR:P[t],videoModel:_}),l=j(t,i),c=H(t,i),d=n.getMaxQuality(o),h=d.quality;return void 0!==l&&(h>dr.Z.NO_CHANGE?h:a)<l&&(h=l),h>c&&(h=c),R[i][t].push({oldValue:a,newValue:h}),h>dr.Z.NO_CHANGE&&h!==a&&(f[i][t].state===s.Z.ALLOW_LOAD||h<a)&&(q(t,a,h,c,d.reason,i),!0)}catch(e){return!1}},setElementSize:Q,setWindowResizeEventCalled:function(e){g=e},registerStreamType:function(e,t){var n,i,r=t.getStreamInfo().id;u[r]||(u[r]={}),R[r]||(R[r]={}),f[r]||(f[r]={}),R[r][e]=fr(N).create(),u[r][e]=t,f[r][e]={},f[r][e].state=s.Z.ALLOW_LOAD,n=e,(i=O.get().streaming.abr.ABRStrategy)===a.Z.ABR_STRATEGY_L2A?(M[n]=!1,P[n]=!1,C[n]=!0):i===a.Z.ABR_STRATEGY_LoLP?(M[n]=!1,P[n]=!0,C[n]=!1):i===a.Z.ABR_STRATEGY_BOLA?(M[n]=!0,P[n]=!1,C[n]=!1):i===a.Z.ABR_STRATEGY_THROUGHPUT?(M[n]=!1,P[n]=!1,C[n]=!1):i===a.Z.ABR_STRATEGY_DYNAMIC&&(M[n]=!(!M||!M[n])&&M[n],P[n]=!1,C[n]=!1),e===a.Z.VIDEO&&Q()},unRegisterStreamType:function(e,t){try{u[e]&&u[e][t]&&delete u[e][t],R[e]&&R[e][t]&&delete R[e][t],f[e]&&f[e][t]&&delete f[e][t]}catch(e){}},setConfig:function(e){e&&(e.streamController&&(i=e.streamController),e.domStorage&&(w=e.domStorage),e.mediaPlayerModel&&(E=e.mediaPlayerModel),e.customParametersModel&&(T=e.customParametersModel),e.cmsdModel&&(S=e.cmsdModel),e.dashMetrics&&(D=e.dashMetrics),e.adapter&&(y=e.adapter),e.videoModel&&(_=e.videoModel),e.settings&&(O=e.settings))},reset:function(){B(),F.off(c.Z.LOADING_PROGRESS,U,e),F.off(h.Z.QUALITY_CHANGE_RENDERED,V,e),F.off(h.Z.METRIC_ADDED,G,e),n&&n.reset()}},t=k.getLogger(e),B(),e}yr.__dashjs_factory_name="AbrController";var _r=u.Z.getSingletonFactory(yr);_r.QUALITY_DEFAULT=0,u.Z.updateSingletonFactory(yr.__dashjs_factory_name,_r);var Er=_r,br=new Map([[a.Z.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,"loadedmetadata"],[a.Z.VIDEO_ELEMENT_READY_STATES.HAVE_CURRENT_DATA,"loadeddata"],[a.Z.VIDEO_ELEMENT_READY_STATES.HAVE_FUTURE_DATA,"canplay"],[a.Z.VIDEO_ELEMENT_READY_STATES.HAVE_ENOUGH_DATA,"canplaythrough"]]);function Tr(){var e,t,n,i,r,o,s,u,h=this.context,f=(0,l.Z)(h).getInstance(),p=[];function g(){n&&(n.playbackRate=1,n.removeEventListener("canplay",g))}function m(){return p.length>0}function v(){if(n&&m()&&0===n.playbackRate){var e=document.createEvent("Event");e.initEvent("waiting",!0,!1),n.dispatchEvent(e)}}function y(e,t){n&&n.addEventListener(e,t)}function _(e,t){n&&n.removeEventListener(e,t)}function E(){return n?n.readyState:NaN}function b(){return n?n.buffered:null}function T(e,t,i,r,a){if(n)for(var o=0;o<n.textTracks.length;o++)if(n.textTracks[o].kind===e&&(!t||n.textTracks[o].label==t)&&n.textTracks[o].language===i&&n.textTracks[o].isTTML===r&&n.textTracks[o].isEmbedded===a)return n.textTracks[o];return null}function S(e,t){return e===a.Z.VIDEO_ELEMENT_READY_STATES.HAVE_NOTHING||E()>=e?(t(),null):(n=br.get(e),i=t,y(n,r=function e(){_(n,e),i(n)}),{func:r,event:n});var n,i,r}return e={addEventListener:y,addTextTrack:function(e,t,i,r,a){if(!n)return null;var o=T(e,t,i,r,a);return o||((o=n.addTextTrack(e,t,i)).isEmbedded=a,o.isTTML=r),o},appendChild:function(e){n&&(n.appendChild(e),void 0!==e.isTTML&&(n.textTracks[n.textTracks.length-1].isTTML=e.isTTML,n.textTracks[n.textTracks.length-1].isEmbedded=e.isEmbedded))},getBufferRange:b,getClientHeight:function(){return n?n.clientHeight:NaN},getClientWidth:function(){return n?n.clientWidth:NaN},getElement:function(){return n},getEnded:function(){return n?n.ended:null},getPlaybackQuality:function(){if(!n)return null;var e="webkitDroppedFrameCount"in n&&"webkitDecodedFrameCount"in n,t=null;return"getVideoPlaybackQuality"in n?t=n.getVideoPlaybackQuality():e&&(t={droppedVideoFrames:n.webkitDroppedFrameCount,totalVideoFrames:n.webkitDroppedFrameCount+n.webkitDecodedFrameCount,creationTime:new Date}),t},getPlaybackRate:function(){return n?n.playbackRate:null},getPlayedRanges:function(){return n?n.played:null},getReadyState:E,getSource:function(){return n?n.src:null},getTTMLRenderingDiv:function(){return o},getTextTrack:T,getTextTracks:function(){return n?n.textTracks:[]},getTime:function(){return n?isNaN(i)?n.currentTime:i:null},getVideoHeight:function(){return n?n.videoHeight:NaN},getVideoRelativeOffsetLeft:function(){if(n){var e=n.parentNode.host||n.parentNode;return e?n.getBoundingClientRect().left-e.getBoundingClientRect().left:NaN}return NaN},getVideoRelativeOffsetTop:function(){if(n){var e=n.parentNode.host||n.parentNode;return e?n.getBoundingClientRect().top-e.getBoundingClientRect().top:NaN}return NaN},getVideoWidth:function(){return n?n.videoWidth:NaN},getVttRenderingDiv:function(){return s},initialize:function(){f.on(c.Z.PLAYBACK_PLAYING,v,this)},isPaused:function(){return n?n.paused:null},isSeeking:function(){return n?n.seeking||!isNaN(i):null},isStalled:m,pause:function(){n&&(n.pause(),n.autoplay=!1)},play:function(){if(n){n.autoplay=!0;var e=n.play();e&&e.catch&&typeof Promise<"u"&&e.catch(function(e){"NotAllowedError"===e.name&&f.trigger(c.Z.PLAYBACK_NOT_ALLOWED),t.warn("Caught pending play exception - continuing (".concat(e,")"))})}},removeChild:function(e){n&&n.removeChild(e)},removeEventListener:_,reset:function(){clearTimeout(u),f.off(c.Z.PLAYBACK_PLAYING,v,this)},setCurrentTime:function(e,t){n&&(r&&r.func&&r.event&&_(r.event,r.func),i=e,r=S(a.Z.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,function(){if(n)if(n.currentTime!==i)try{i=t?function(e){var t=b(),n=e,i=9999999999;if(t)for(var r=0;r<t.length;r++){var a=t.start(r),o=t.end(r),s=Math.abs(a-e),l=Math.abs(o-e);if(e>=a&&e<=o)return e;s<i&&(i=s,n=a),l<i&&(i=l,n=o)}return n}(i):i,isNaN(i)||(n.currentTime=i),i=NaN}catch(e){0===n.readyState&&e.code===e.INVALID_STATE_ERR&&(u=setTimeout(function(){n.currentTime=i,i=NaN},400))}else i=NaN}))},setElement:function(e){if(!(null==e||e&&/^(VIDEO|AUDIO)$/i.test(e.nodeName)))throw"element is not video or audio DOM type!";(n=e)&&(n.preload="auto")},setPlaybackRate:function(e){n&&(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&n.readyState<=2&&e>0?n.addEventListener("canplay",g):n.playbackRate=e)},setSource:function(e){n&&(e?n.src=e:(n.removeAttribute("src"),n.load()))},setStallState:function(e,t){var i,r;i=e,t?null!==(r=i)&&n&&!n.seeking&&-1===p.indexOf(r)&&p.push(r):function(e){var t=p.indexOf(e);null!==e&&-1!==t&&p.splice(t,1)}(i)},setTTMLRenderingDiv:function(e){(o=e).style.position="absolute",o.style.display="flex",o.style.overflow="hidden",o.style.pointerEvents="none",o.style.top=0,o.style.left=0},setVttRenderingDiv:function(e){s=e},waitForReadyState:S,setDisableRemotePlayback:function(e){n&&(n.disableRemotePlayback=e)}},t=(0,d.Z)(h).getInstance().getLogger(e),i=NaN,e}Tr.__dashjs_factory_name="VideoModel";var Sr=u.Z.getSingletonFactory(Tr),wr=[{oldKey:"dashjs_vbitrate",newKey:"dashjs_video_bitrate"},{oldKey:"dashjs_abitrate",newKey:"dashjs_audio_bitrate"},{oldKey:"dashjs_vsettings",newKey:"dashjs_video_settings"},{oldKey:"dashjs_asettings",newKey:"dashjs_audio_settings"}],Ar="dashjs_?_bitrate",Rr="dashjs_?_settings",xr="localStorage",Ir="lastBitrate",Lr="lastMediaSettings";function Mr(e){e=e||{};var t,n,i,r=this.context,o=e.settings;function s(e){if(void 0!==i)return i;var t;i=!1;try{typeof window<"u"&&(t=window[e])}catch(e){return n.warn("DOMStorage access denied: "+e.message),i}if(!t||e!==xr)return i;try{t.setItem("1","1"),t.removeItem("1"),i=!0}catch(e){n.warn("DOMStorage is supported, but cannot be used: "+e.message)}return i}function l(){var e=6e5;return Math.round((new Date).getTime()/e)*e}function c(e,t){return s(e)&&o.get().streaming[t+"CachingInfo"].enabled}function u(){if(!o)throw new Error(a.Z.MISSING_CONFIG_ERROR)}return t={getSavedBitrateSettings:function(e){if(u(),!o.get().streaming.lastBitrateCachingInfo.enabled)return NaN;var t=NaN;if(c(xr,Ir)){var i=Ar.replace(/\?/,e);try{var r=JSON.parse(localStorage.getItem(i))||{},a=(new Date).getTime()-parseInt(r.timestamp,10)>=o.get().streaming.lastBitrateCachingInfo.ttl||!1,s=parseFloat(r.bitrate);isNaN(s)||a?a&&localStorage.removeItem(i):(t=s,n.debug("Last saved bitrate for "+e+" was "+s))}catch(e){return null}}return t},setSavedBitrateSettings:function(e,t){if(c(xr,Ir)&&t){var i=Ar.replace(/\?/,e);try{localStorage.setItem(i,JSON.stringify({bitrate:t.toFixed(3),timestamp:l()}))}catch(e){n.error(e.message)}}},getSavedMediaSettings:function(e){if(u(),!o.get().streaming.lastMediaSettingsCachingInfo.enabled)return null;var t=null;if(c(xr,Lr)){var n=Rr.replace(/\?/,e);try{var i=JSON.parse(localStorage.getItem(n))||{},r=(new Date).getTime()-parseInt(i.timestamp,10)>=o.get().streaming.lastMediaSettingsCachingInfo.ttl||!1;t=i.settings,r&&(localStorage.removeItem(n),t=null)}catch(e){return null}}return t},setSavedMediaSettings:function(e,t){if(c(xr,Lr)){var i=Rr.replace(/\?/,e);try{localStorage.setItem(i,JSON.stringify({settings:t,timestamp:l()}))}catch(e){n.error(e.message)}}}},n=(0,d.Z)(r).getInstance().getLogger(t),s(xr)&&wr.forEach(function(e){var t=localStorage.getItem(e.oldKey);if(t){localStorage.removeItem(e.oldKey);try{localStorage.setItem(e.newKey,t)}catch(e){n.error(e.message)}}}),t}Mr.__dashjs_factory_name="DOMStorage";var Cr=u.Z.getSingletonFactory(Mr),Pr=n(2032),Dr=n(2011);function Or(){var e,t,n,i,r,a,o,s,l,c,u,d,h,f=this.context;function p(e,n,r,a){var o=null,l=e?h.resolve(e.path):null,c=a||{init:!0,url:l?l.url:void 0,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500,mediaType:n};t.debug("Start searching for initialization.");var u=y(c);s.load({request:u,success:function(t){if(c.bytesLoaded=c.range.end,!(o=i.findInitRange(t)))return c.range.end=c.bytesLoaded+c.bytesToLoad,p(e,n,r,c);e.range=o,r(e)},error:function(){r(e)}}),t.debug("Perform init search: "+c.url)}function m(e,n,r,a,o,l){if(r&&(void 0===r.start||void 0===r.end)){var c=r?r.toString().split("-"):null;r=c?{start:parseFloat(c[0]),end:parseFloat(c[1])}:null}o=o||v;var u=null,d=null,f=!!r,p=e?h.resolve(e.path):null,g={init:!1,url:p?p.url:void 0,range:f?r:{start:0,end:1500},searching:!f,bytesLoaded:l?l.bytesLoaded:0,bytesToLoad:1500,mediaType:n},_=y(g);s.load({request:_,success:function(r){var s=g.bytesToLoad,l=r.byteLength;if(g.bytesLoaded=g.range.end-g.range.start,u=i.parse(r),(d=u.getBox("sidx"))&&d.isComplete){var c,h,f=d.references;if(null!=f&&f.length>0&&(c=1===f[0].reference_type),c){var p,v,y,_;t.debug("Initiate multiple SIDX load."),g.range.end=g.range.start+d.size;var E=[],b=0,T=(d.offset||g.range.start)+d.size,S=function(t){t?(E=E.concat(t),++b>=v&&(E.sort(function(e,t){return e.startTime-t.startTime<0?-1:0}),o(E,e,a))):o(null,e,a)};for(p=0,v=f.length;p<v;p++)y=T,_=T+f[p].referenced_size-1,T+=f[p].referenced_size,m(e,n,{start:y,end:_},a,S,g)}else t.debug("Parsing segments from SIDX. representation "+n+" - id: "+e.id+" for range : "+g.range.start+" - "+g.range.end),h=function(e,t){for(var n,i,r,a,o=e.references,s=o.length,l=e.timescale,c=e.earliest_presentation_time,u=t.range.start+e.offset+e.first_offset+e.size,d=[],h=0;h<s;h++)r=o[h].subsegment_duration,a=o[h].referenced_size,(n=new Dr.Z).duration=r,n.startTime=c,n.timescale=l,i=u+a-1,n.mediaRange=u+"-"+i,d.push(n),c+=r,u+=a;return d}(d,g),o(h,e,a)}else{if(d)g.range.start=d.offset||g.range.start,g.range.end=g.range.start+(d.size||s);else{if(l<g.bytesLoaded)return void o(null,e,a);var w=u.getLastBox();w&&w.size?(g.range.start=w.offset+w.size,g.range.end=g.range.start+s):g.range.end+=s}m(e,n,g.range,a,null,g)}},error:function(){o(null,e,a)}}),t.debug("Perform SIDX load for type ".concat(n," : ").concat(g.url," with range ").concat(g.range.start," - ").concat(g.range.end))}function v(e,t,n){n({segments:e,representation:t,error:e?void 0:new T.Z(l.SEGMENT_BASE_LOADER_ERROR_CODE,l.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}function y(e){if(e.url){var t=new g.Z;return t.setInfo(e),t}}return e={setConfig:function(s){s.baseURLController&&(h=s.baseURLController),s.dashMetrics&&(a=s.dashMetrics),s.mediaPlayerModel&&(o=s.mediaPlayerModel),s.errHandler&&(n=s.errHandler),s.boxParser&&(i=s.boxParser),s.debug&&(t=s.debug.getLogger(e)),s.requestModifier&&(r=s.requestModifier),s.errors&&(l=s.errors),s.urlUtils&&(d=s.urlUtils),s.constants&&(c=s.constants),s.dashConstants&&(u=s.dashConstants)},initialize:function(){s=Tt(f).create({errHandler:n,dashMetrics:a,mediaPlayerModel:o,requestModifier:r,boxParser:i,errors:l,urlUtils:d,constants:c,dashConstants:u})},loadInitialization:function(e,t){return new Promise(function(n){p(e,t,n)})},loadSegments:function(e,t,n){return new Promise(function(i){m(e,t,n,i)})},reset:function(){s&&(s.abort(),s=null)}}}Or.__dashjs_factory_name="SegmentBaseLoader";var Nr=u.Z.getSingletonFactory(Or);function kr(e){var t;e=e||{};var n=new DataView(e.data),i=0;function r(e,t){var r=!0,a=0;if(void 0===t&&(t=!1),e.tag>16777215?(n.getUint32(i)!==e.tag&&(r=!1),a=4):e.tag>65535?(256*n.getUint16(i)+n.getUint8(i+2)!==e.tag&&(r=!1),a=3):e.tag>255?(n.getUint16(i)!==e.tag&&(r=!1),a=2):(n.getUint8(i)!==e.tag&&(r=!1),a=1),!r&&e.required&&!t)throw new Error("required tag not found");return r&&(i+=a),r}function a(e){var t=1,r=128,a=-1,o=0,s=n.getUint8(i),l=0;for(l=0;l<8;l+=1){if((s&r)===r){o=void 0===e?s&~r:s,a=l;break}r>>=1}for(l=0;l<a;l+=1,t+=1)o=o<<8|255&n.getUint8(i+t);return i+=t,o}return t={getPos:function(){return i},setPos:function(e){i=e},consumeTag:r,consumeTagAndSize:function(e,t){var n=r(e,t);return n&&a(),n},parseTag:function(e){var n;return r(e),n=a(),t[e.parse](n)},skipOverElement:function(e,t){var n,o=r(e,t);return o&&(n=a(),i+=n),o},getMatroskaCodedNum:a,getMatroskaFloat:function(e){var t;switch(e){case 4:t=n.getFloat32(i),i+=4;break;case 8:t=n.getFloat64(i),i+=8}return t},getMatroskaUint:function(e){if(e>4)return function(e){for(var t=Math.floor(Number.MAX_SAFE_INTEGER/256),r=0,a=0;a<e;a+=1){if(r>t)throw new Error("Value exceeds safe integer limit");r*=256;var o=n.getUint8(i+a);if(r>Number.MAX_SAFE_INTEGER-o)throw new Error("Value exceeds safe integer limit");r+=o}return i+=e,r}(e);for(var t=0,r=0;r<e;r+=1)t<<=8,t|=255&n.getUint8(i+r);return i+=e,t>>>0},moreData:function(){return i<n.byteLength}}}kr.__dashjs_factory_name="EBMLParser";var Fr=u.Z.getClassFactory(kr);function Br(){var e,t,n,i,r,o,s,l,c,u,d=this.context;function h(e){var t=new g.Z;return t.setInfo(e),t}return e={setConfig:function(n){if(!(n.baseURLController&&n.dashMetrics&&n.mediaPlayerModel&&n.errHandler))throw new Error(a.Z.MISSING_CONFIG_ERROR);u=n.baseURLController,o=n.dashMetrics,s=n.mediaPlayerModel,i=n.errHandler,c=n.errors,t=n.debug.getLogger(e),r=n.requestModifier},initialize:function(){l=Tt(d).create({errHandler:i,dashMetrics:o,mediaPlayerModel:s,requestModifier:r,errors:c})},loadInitialization:function(e,n){return new Promise(function(i){var r=null,a=e?u.resolve(e.path):null,o=e?e.range.split("-"):null,s={range:{start:o?parseFloat(o[0]):null,end:o?parseFloat(o[1]):null},request:r,url:a?a.url:void 0,init:!0,mediaType:n};t.info("Start loading initialization."),r=h(s),l.load({request:r,success:function(){i(e)},error:function(){i(e)}}),t.debug("Perform init load: "+s.url)})},loadSegments:function(e,i,r){return new Promise(function(a){var o=null,s=e?u.resolve(e.path):null,f=s?s.url:void 0;o=h({bytesLoaded:0,bytesToLoad:8192,range:{start:0,end:8192},request:o,url:f,init:!1,mediaType:i}),t.debug("Parsing ebml header"),l.load({request:o,success:function(i){!function(e,i,r,a){if(e&&0!==e.byteLength){var o,s,c,u,f=Fr(d).create({data:e}),p=r?r.split("-"):null,g=null,m={url:i,range:{start:p?parseFloat(p[0]):null,end:p?parseFloat(p[1]):null},request:g};for(t.debug("Parse EBML header: "+m.url),f.skipOverElement(n.EBML),f.consumeTag(n.Segment),c=f.getMatroskaCodedNum(),c+=f.getPos(),u=f.getPos();f.moreData()&&!f.consumeTagAndSize(n.Segment.Info,!0);)if(!(f.skipOverElement(n.Segment.SeekHead,!0)||f.skipOverElement(n.Segment.Tracks,!0)||f.skipOverElement(n.Segment.Cues,!0)||f.skipOverElement(n.Void,!0)))throw new Error("no valid top level element found");for(;void 0===o;){var v=f.getMatroskaCodedNum(!0),y=f.getMatroskaCodedNum();v===n.Segment.Info.Duration.tag?o=f[n.Segment.Info.Duration.parse](y):f.setPos(f.getPos()+y)}g=h(m),l.load({request:g,success:function(e){s=function(e,i,r,a){var o,s,l,c,u,h,f,p;for(l=[],u=0,h=(s=function(e){var t,i,r=[],a=Fr(d).create({data:e});for(a.consumeTagAndSize(n.Segment.Cues);a.moreData()&&a.consumeTagAndSize(n.Segment.Cues.CuePoint,!0);){for((t={}).CueTime=a.parseTag(n.Segment.Cues.CuePoint.CueTime),t.CueTracks=[];a.moreData()&&a.consumeTag(n.Segment.Cues.CuePoint.CueTrackPositions,!0);){var o=a.getMatroskaCodedNum(),s=a.getPos();if((i={}).Track=a.parseTag(n.Segment.Cues.CuePoint.CueTrackPositions.CueTrack),0===i.Track)throw new Error("Cue track cannot be 0");i.ClusterPosition=a.parseTag(n.Segment.Cues.CuePoint.CueTrackPositions.CueClusterPosition),t.CueTracks.push(i),a.setPos(s+o)}if(0===t.CueTracks.length)throw new Error("Mandatory cuetrack not found");r.push(t)}if(0===r.length)throw new Error("mandatory cuepoint not found");return r}(e)).length;u<h;u+=1)c=new Dr.Z,o=u<s.length-1?s[u+1].CueTime-s[u].CueTime:a-s[u].CueTime,c.duration=o,c.startTime=s[u].CueTime,c.timescale=1e3,f=s[u].CueTracks[0].ClusterPosition+i,p=u<s.length-1?s[u+1].CueTracks[0].ClusterPosition+i-1:r-1,c.mediaRange=f+"-"+p,l.push(c);return t.debug("Parsed cues: "+l.length+" cues."),l}(e,u,c,o),a(s)},error:function(){t.error("Download Error: Cues "+m.url),a(null)}}),t.debug("Perform cues load: "+m.url+" bytes="+m.range.start+"-"+m.range.end)}else a(null)}(i,f,r,function(t){a({segments:t,representation:e,error:t?void 0:new T.Z(c.SEGMENT_BASE_LOADER_ERROR_CODE,c.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})})},error:function(){a({representation:e,error:new T.Z(c.SEGMENT_BASE_LOADER_ERROR_CODE,c.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}})})},reset:function(){l&&(l.abort(),l=null)}},n={EBML:{tag:440786851,required:!0},Segment:{tag:408125543,required:!0,SeekHead:{tag:290298740,required:!0},Info:{tag:357149030,required:!0,TimecodeScale:{tag:2807729,required:!0,parse:"getMatroskaUint"},Duration:{tag:17545,required:!0,parse:"getMatroskaFloat"}},Tracks:{tag:374648427,required:!0},Cues:{tag:475249515,required:!0,CuePoint:{tag:187,required:!0,CueTime:{tag:179,required:!0,parse:"getMatroskaUint"},CueTrackPositions:{tag:183,required:!0,CueTrack:{tag:247,required:!0,parse:"getMatroskaUint"},CueClusterPosition:{tag:241,required:!0,parse:"getMatroskaUint"}}}}},Void:{tag:236,required:!0}},e}Br.__dashjs_factory_name="WebmSegmentBaseLoader";var Ur=u.Z.getSingletonFactory(Br);function Vr(e){e=e||{};var t,n,i,r=this.context,a=e.eventBus,o=e.events,s=e.dashMetrics,l=e.mediaPlayerModel,c=e.errHandler,u=e.baseURLController,d=e.debug,h=e.boxParser,f=e.requestModifier,p=e.errors;function g(e){return"webm"===(e?e.split("/")[1]:"").toLowerCase()}return t={initialize:function(){n.initialize(),i.initialize()},getSegmentBaseInitSegment:function(e){return g(e.representation.mimeType)?i.loadInitialization(e.representation,e.mediaType):n.loadInitialization(e.representation,e.mediaType)},getSegmentList:function(e){return g(e.mimeType)?i.loadSegments(e.representation,e.mediaType,e.representation?e.representation.indexRange:null):n.loadSegments(e.representation,e.mediaType,e.representation?e.representation.indexRange:null)},reset:function(){n.reset(),i.reset()}},n=Nr(r).getInstance(),i=Ur(r).getInstance(),n.setConfig({baseURLController:u,dashMetrics:s,mediaPlayerModel:l,errHandler:c,eventBus:a,events:o,errors:p,debug:d,boxParser:h,requestModifier:f}),i.setConfig({baseURLController:u,dashMetrics:s,mediaPlayerModel:l,errHandler:c,eventBus:a,events:o,errors:p,debug:d,requestModifier:f}),t}Vr.__dashjs_factory_name="SegmentBaseController";var Gr=u.Z.getSingletonFactory(Vr),Hr=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.id=null,this.quality=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null},jr=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.representationCount=0,this.labels=null,this.lang=null,this.viewpoint=null,this.viewpointsWithSchemeIdUri=null,this.accessibility=null,this.accessibilitiesWithSchemeIdUri=null,this.audioChannelConfiguration=null,this.audioChannelConfigurationsWithSchemeIdUri=null,this.roles=null,this.rolesWithSchemeIdUri=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.isText=!1,this.KID=null,this.bitrateList=null,this.isFragmented=null,this.isEmbedded=null,this.selectionPriority=1,this.supplementalProperties={},this.supplementalPropertiesAsArray=[],this.essentialProperties={},this.essentialPropertiesAsArray=[],this.segmentAlignment=!1,this.subSegmentAlignment=!1},zr=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.id=null,this.index=null,this.start=NaN,this.duration=NaN,this.manifestInfo=null,this.isLast=!0},Zr=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.dvrWindowSize=NaN,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=NaN,this.duration=NaN,this.isDynamic=!1,this.maxFragmentDuration=null,this.serviceDescriptions=[],this.protocol=null};function qr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Wr=function(){function e(t){var n=this;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.valid="/"==t[0],this.path=t.split("/").filter(function(e){return 0!==e.length}).map(function(e){var t={name:e},i=e.indexOf("[");if(-1!=i){t.name=e.substring(0,i);var r=e.substring(i+1,e.length-1);n.valid=n.valid&&-1==r.indexOf("[");var a=r.indexOf("=");-1!=a?(t.attribute={name:r.substring(1,a),value:r.substring(a+1)},-1!=["'",'"'].indexOf(t.attribute.value[0])&&(t.attribute.value=t.attribute.value.substring(1,t.attribute.value.length-1))):t.position=parseInt(r,10)-1}return t})}var t;return(t=[{key:"isValid",value:function(){return this.valid}},{key:"findsElement",value:function(){return!this.findsAttribute()}},{key:"findsAttribute",value:function(){return this.path[this.path.length-1].name.startsWith("@")}},{key:"findsTextReplace",value:function(){return"text()"===this.path[this.path.length-1].name}},{key:"getMpdTarget",value:function(e,t){for(var n=null,i=e,r=1,a="MPD";r<this.path.length&&null!==i;){n=i;var o=this.path[r];if(a=o.name,r!==this.path.length-1||!a.startsWith("@")&&"text()"!==a){var s=n[a+"_asArray"]||[];0===s.length&&n[a]&&s.push(n[a]),o.position?i=s[o.position]||null:o.attribute?function(){var e=o.attribute;i=s.filter(function(t){return t[e.name]==e.value})[0]||null}():i=s[0]||null}r++}return null===i?null:a.startsWith("@")?{name:a.substring(1),leaf:i,target:i}:"text()"===a?{name:"__text",leaf:i,target:i}:{name:a,leaf:i,target:t?n:i}}}])&&qr(e.prototype,t),e}();function Yr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Kr=function(){function e(t,n,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.action=t,this.xpath=n,this.value=i,this.position=null}var t;return(t=[{key:"getMpdTarget",value:function(e){var t="remove"===this.action||"replace"===this.action||"before"===this.position||"after"===this.position;return this.xpath.getMpdTarget(e,t)}}])&&Yr(e.prototype,t),e}();function Xr(){var e,t,n=this.context;return e={getIsPatch:function(e){return e&&e.hasOwnProperty(o.Z.ORIGINAL_MPD_ID)||!1},getPublishTime:function(e){return e&&e.hasOwnProperty(o.Z.PUBLISH_TIME)?new Date(e[o.Z.PUBLISH_TIME]):null},getOriginalPublishTime:function(e){return e&&e.hasOwnProperty(o.Z.ORIGINAL_PUBLISH_TIME)?new Date(e[o.Z.ORIGINAL_PUBLISH_TIME]):null},getMpdId:function(e){return e&&e[o.Z.ORIGINAL_MPD_ID]||null},getPatchOperations:function(e){return e?(e.__children||[]).map(function(e){var n=Object.keys(e)[0];if("add"!==n&&"remove"!==n&&"replace"!==n)return t.warn("Ignoring node of invalid action: ".concat(n)),null;var i=e[n],r=i.sel;if("add"===n&&i.type){if(!i.type.startsWith("@"))return t.warn("Ignoring add action for prefixed namespace declaration: ".concat(i.type,"=").concat(i.__text)),null;r="".concat(r,"/").concat(i.type)}var a=new Wr(r);if(!a.isValid())return t.warn("Ignoring action with invalid selector: ".concat(n," - ").concat(r)),null;var o=null;a.findsAttribute()||a.findsTextReplace()?o=i.__text||"":"remove"!==n&&(o=i.__children.reduce(function(e,t){var n=Object.keys(t)[0];return"#text"!==n&&(e[n]=e[n]||[],e[n].push(t[n])),e},{}));var s=new Kr(n,a,o);return"add"===n&&(s.position=i.pos),s}).filter(function(e){return!!e}):[]}},t=(0,d.Z)(n).getInstance().getLogger(e),e}Xr.__dashjs_factory_name="PatchManifestModel";var Qr=u.Z.getSingletonFactory(Xr);function Jr(){var e,t,n,i,r,a,s,l=this.context;function c(e,n,a){var s,l=t.getAdaptationsForType(i[0].mpd.manifest,e,n);if(!l||0===l.length)return null;if(l.length>1&&a){var c=h(a,n);if(r[a.id]&&r[a.id][n])for(var d=0,f=l.length;d<f;d++)if(u(r[a.id][n],c[d]))return l[d];for(var p=0,g=l.length;p<g;p++)if(s=l[p],t.getRolesForAdaptation(s).filter(function(e){return e.value===o.Z.MAIN})[0])return l[p]}return l[0]}function u(e,t){if(!e||!t)return!1;var n=e.id===t.id,i=e.codec===t.codec,r=e.viewpoint===t.viewpoint,a=JSON.stringify(e.viewpointsWithSchemeIdUri)===JSON.stringify(t.viewpointsWithSchemeIdUri),o=e.lang===t.lang,s=e.roles.toString()===t.roles.toString(),l=JSON.stringify(e.rolesWithSchemeIdUri)===JSON.stringify(t.rolesWithSchemeIdUri),c=e.accessibility.toString()===t.accessibility.toString(),u=JSON.stringify(e.accessibilitiesWithSchemeIdUri)===JSON.stringify(t.accessibilitiesWithSchemeIdUri),d=e.audioChannelConfiguration.toString()===t.audioChannelConfiguration.toString(),h=JSON.stringify(e.audioChannelConfigurationsWithSchemeIdUri)===JSON.stringify(t.audioChannelConfigurationsWithSchemeIdUri);return n&&i&&r&&a&&o&&s&&l&&c&&u&&d&&h}function d(e,n,i,r,o,s){var l,c,u,d,h,f,p=[];if(!r||0===r.length)return[];var g=t.getAdaptationsForPeriod(n);for(d=0,f=r.length;d<f;d++)if(l=r[d],c=_(g[u=t.getIndexForAdaptation(l,e,i.index)]),s){var m=c.accessibility.length;for(h=0;h<m;h++)if(c){var v=c.accessibility[h];if(0===v.indexOf("cea-608:")){var y=v.substring(8).split(";");if("CC"===y[0].substring(0,2))for(h=0;h<y.length;h++)c||(c=_.call(this,g[u])),E(c,y[h].substring(0,3),y[h].substring(4)),p.push(c),c=null;else for(h=0;h<y.length;h++)c||(c=_.call(this,g[u])),E(c,"CC"+(h+1),y[h]),p.push(c),c=null}else 0===v.indexOf("cea-608")&&(E(c,a.CC1,"eng"),p.push(c),c=null)}}else o===a.IMAGE?(c.type=a.IMAGE,p.push(c),c=null):c&&p.push(c);return p}function h(e,n,r){var o=i,s=r,l=[];if(s)T(),o=f(s);else{if(!(i.length>0))return l;s=i[0].mpd.manifest}var c=y(e,o),u=t.getAdaptationsForType(s,e?e.index:null,n);return l=d(s,c,e,u,n),n===a.TEXT&&(u=t.getAdaptationsForType(s,e?e.index:null,a.VIDEO),l=l.concat(d(s,c,e,u,n,!0))),l}function f(e){var n=p(e);return t.getRegularPeriods(n)}function p(e){var n=m(e);return t.getMpd(n)}function g(){i=[],r={}}function m(e){return e||(i.length>0?i[0].mpd.manifest:null)}function v(e){try{var n=y(e.streamInfo,i),r=t.getAdaptationsForPeriod(n);return e&&e.streamInfo&&void 0!==e.streamInfo.id&&r?r[e.index]:null}catch(e){return null}}function y(e,t){for(var n=t.length,i=0;i<n;i++){var r=t[i];if(e&&e.id===r.id)return r}return null}function _(e){if(!e)return null;var n,i,r,a,o,l=new jr,c=e.period.mpd.manifest.Period_asArray[e.period.index].AdaptationSet_asArray[e.index];if(l.id=e.id,l.index=e.index,l.type=e.type,l.streamInfo=b(e.period),l.representationCount=t.getRepresentationCount(c),l.labels=t.getLabelsForAdaptation(c),l.lang=t.getLanguageForAdaptation(c),l.segmentAlignment=t.getSegmentAlignment(c),l.subSegmentAlignment=t.getSubSegmentAlignment(c),n=t.getViewpointForAdaptation(c),l.viewpoint=n.length?n[0].value:void 0,l.viewpointsWithSchemeIdUri=n,o=t.getAccessibilityForAdaptation(c),l.accessibility=o.map(function(e){var t=e.value,n=t;return e.schemeIdUri&&e.schemeIdUri.search("cea-608")>=0&&void 0!==s&&(n=t?"cea-608:"+t:"cea-608",l.embeddedCaptions=!0),n}),l.accessibilitiesWithSchemeIdUri=o,i=t.getAudioChannelConfigurationForAdaptation(c),l.audioChannelConfiguration=i.map(function(e){return e.value}),l.audioChannelConfigurationsWithSchemeIdUri=i,0===l.audioChannelConfiguration.length&&Array.isArray(c.Representation_asArray)&&c.Representation_asArray.length>0&&(r=t.getAudioChannelConfigurationForRepresentation(c.Representation_asArray[0]),l.audioChannelConfiguration=r.map(function(e){return e.value}),l.audioChannelConfigurationsWithSchemeIdUri=r),a=t.getRolesForAdaptation(c),l.roles=a.map(function(e){return e.value}),l.rolesWithSchemeIdUri=a,l.codec=t.getCodec(c),l.mimeType=t.getMimeType(c),l.contentProtection=t.getContentProtectionData(c),l.bitrateList=t.getBitrateListForAdaptation(c),l.selectionPriority=t.getSelectionPriority(c),l.contentProtection){var u=l.contentProtection.map(function(e){return t.getKID(e)}).filter(function(e){return null!==e});if(u.length){var d=u[0];l.contentProtection.forEach(function(e){e.keyId=d})}}if(l.isText=t.getIsText(c),l.supplementalProperties=t.getSupplementalPropertiesForAdaptation(c),(!l.supplementalProperties||0===Object.keys(l.supplementalProperties).length)&&Array.isArray(c.Representation_asArray)&&c.Representation_asArray.length>0){var h=c.Representation_asArray.map(function(e){return t.getSupplementalPropertiesForRepresentation(e)});h.every(function(e){return JSON.stringify(e)===JSON.stringify(h[0])})&&(l.supplementalProperties=h[0])}if(l.supplementalPropertiesAsArray=t.getSupplementalPropertiesAsArrayForAdaptation(c),(!l.supplementalPropertiesAsArray||0===l.supplementalPropertiesAsArray.length)&&Array.isArray(c.Representation_asArray)&&c.Representation_asArray.length>0){var f=c.Representation_asArray.map(function(e){return t.getSupplementalPropertiesAsArrayForRepresentation(e)});f.every(function(e){return JSON.stringify(e)===JSON.stringify(f[0])})&&(l.supplementalPropertiesAsArray=f[0])}return l.essentialProperties=t.getEssentialPropertiesForAdaptation(c),l.essentialPropertiesAsArray=t.getEssentialPropertiesAsArrayForAdaptation(c),l.isFragmented=t.getIsFragmented(c),l.isEmbedded=!1,l}function E(e,t,n){e.id=t,e.index=100+parseInt(t.substring(2,3)),e.type=a.TEXT,e.codec="cea-608-in-SEI",e.isEmbedded=!0,e.isFragmented=!1;var i=En()(n);e.lang=i||n,e.roles=["caption"],e.rolesWithSchemeIdUri=[{schemeIdUri:"urn:mpeg:dash:role:2011",value:"caption"}]}function b(e){var n,i,r=new zr;return r.id=e.id,r.index=e.index,r.start=e.start,r.duration=e.duration,r.manifestInfo=(n=e.mpd,(i=new Zr).dvrWindowSize=n.timeShiftBufferDepth,i.loadedTime=n.manifest.loadedTime,i.availableFrom=n.availabilityStartTime,i.minBufferTime=n.manifest.minBufferTime,i.maxFragmentDuration=n.maxSegmentDuration,i.duration=t.getDuration(n.manifest),i.isDynamic=t.getIsDynamic(n.manifest),i.serviceDescriptions=t.getServiceDescriptions(n.manifest),i.protocol=n.manifest.protocol,i),r.isLast=1===e.mpd.manifest.Period_asArray.length||Math.abs(r.start+r.duration-r.manifestInfo.duration)<1,r}function T(){if(!a)throw new Error("setConfig function has to be called previously")}function S(e){return i.length>0?i[0].mpd.manifest.Period_asArray[e]:null}function w(e,t,n){var i,r,a,o,s;if(e)for(i=e.AdaptationSet_asArray,o=0;o<i.length;o+=1)for(a=i[o].Representation_asArray,s=0;s<a.length;s+=1)if(t===(r=a[s]).id)return n?s:r;return null}return e={getBandwidthForRepresentation:function(e,t){var n;return(n=w(S(t),e))?n.bandwidth:null},getIndexForRepresentation:function(e,t){return n=S(t),null!==(i=w(n,e,!0))?i:-1;var n,i},getMaxIndexForBufferType:function(e,n){return function(e,n){var i,r,a,o;if(!e||!n)return-1;for(r=e.AdaptationSet_asArray,o=0;o<r.length;o+=1)if(a=(i=r[o]).Representation_asArray,t.getIsTypeOf(i,n))return a.length;return-1}(S(n),e)},convertRepresentationToRepresentationInfo:function(e){if(e){var n=new Hr,i=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index],r=t.getRepresentationFor(e.index,i);return n.id=e.id,n.quality=e.index,n.bandwidth=t.getBandwidth(r),n.fragmentDuration=e.segmentDuration||(e.segments&&e.segments.length>0?e.segments[0].duration:NaN),n.MSETimeOffset=e.MSETimeOffset,n.mediaInfo=_(e.adaptation),n}return null},getStreamsInfo:function(e,t){var n=[],r=i;if(e&&(T(),r=f(e)),r.length>0){(!t||t>r.length)&&(t=r.length);for(var a=0;a<t;a++)n.push(b(r[a]))}return n},getMediaInfoForType:function(e,n){if(0===i.length||!e)return null;var r=y(e,i);if(!r)return null;var a=t.getAdaptationsForPeriod(r),o=c(e.index,n,e);return o?_(a[t.getIndexForAdaptation(o,i[0].mpd.manifest,e.index)]):null},getAllMediaInfoForType:h,getAdaptationForType:c,getRealAdaptation:function(e,n){var r,a,o=y(e,i);return r=n?n.id:null,i.length>0&&o&&(a=r?t.getAdaptationForId(r,i[0].mpd.manifest,o.index):t.getAdaptationForIndex(n?n.index:null,i[0].mpd.manifest,o.index)),a},getProducerReferenceTimes:function(e,n){var r,a,o=y(e,i);return r=n?n.id:null,i.length>0&&o&&(a=r?t.getAdaptationForId(r,i[0].mpd.manifest,o.index):t.getAdaptationForIndex(n?n.index:null,i[0].mpd.manifest,o.index)),a?t.getProducerReferenceTimesForAdaptation(a):[]},getRealPeriodByIndex:function(e){return t.getRealPeriodForIndex(e,i[0].mpd.manifest)},getEssentialPropertiesForRepresentation:function(e){try{return t.getEssentialPropertiesForRepresentation(e)}catch(e){return[]}},getVoRepresentations:function(e){var n=v(e);return t.getRepresentationsForAdaptation(n)},getEventsFor:function(e,n,r){var a=[];if(i.length>0){var o=i[0].mpd.manifest;if(e instanceof zr){var s=y(e,i);a=t.getEventsForPeriod(s)}else if(e instanceof jr){var l=y(r,i);a=t.getEventStreamForAdaptationSet(o,v(e),l)}else if(e instanceof Hr){var c=y(r,i);a=t.getEventStreamForRepresentation(o,n,c)}}return a},getEvent:function(e,t,n,i){try{if(!e||!t||isNaN(n)||!i)return null;var r=e.scheme_id_uri,a=e.value;if(!t[r+"/"+a])return null;var o,s=new Ee,l=e.timescale||1,c=i.adaptation.period.start,u=t[r+"/"+a],d=isNaN(i.presentationTimeOffset)?isNaN(u.presentationTimeOffset)?0:u.presentationTimeOffset:i.presentationTimeOffset,h=e.presentation_time_delta/l;o=0===e.version?c+n-d+h:c-d+h;var f=e.event_duration/l,p=e.id,g=e.message_data;return s.eventStream=u,s.eventStream.value=a,s.eventStream.timescale=l,s.duration=f,s.id=p,s.calculatedPresentationTime=o,s.messageData=g,s.presentationTimeDelta=h,s}catch(e){return null}},getMpd:p,setConfig:function(e){e&&(e.constants&&(a=e.constants),e.cea608parser&&(s=e.cea608parser),e.errHandler&&t.setConfig({errHandler:e.errHandler}),e.BASE64&&t.setConfig({BASE64:e.BASE64}))},updatePeriods:function(e){if(!e)return null;T(),i=f(e)},getIsTextTrack:function(e){return t.getIsText(e)},getUTCTimingSources:function(){var e=m();return t.getUTCTimingSources(e)},getSuggestedPresentationDelay:function(){var e=i.length>0?i[0].mpd:null;return t.getSuggestedPresentationDelay(e)},getAvailabilityStartTime:function(e){var n=p(e);return t.getAvailabilityStartTime(n)},getIsTypeOf:function(e,n){return t.getIsTypeOf(e,n)},getIsDynamic:function(e){var n=m(e);return t.getIsDynamic(n)},getDuration:function(e){var n=m(e);return t.getDuration(n)},getRegularPeriods:f,getContentSteering:function(e){return t.getContentSteering(e)},getLocation:function(e){return t.getLocation(e)},getPatchLocation:function(e){var n=t.getPatchLocation(e),i=t.getPublishTime(e);return n&&0!==n.length&&i?n.filter(function(e){return isNaN(e.ttl)||i.getTime()+e.ttl>(new Date).getTime()}):[]},getManifestUpdatePeriod:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.getManifestUpdatePeriod(e,n)},getPublishTime:function(e){return t.getPublishTime(e)},getIsDVB:function(e){return t.hasProfile(e,"urn:dvb:dash:profile:dvb-dash:2014")},getIsPatch:function(e){return n.getIsPatch(e)},getBaseURLsFromElement:function(e){return t.getBaseURLsFromElement(e)},getRepresentationSortFunction:function(){return t.getRepresentationSortFunction()},getCodec:function(e,n,i){return t.getCodec(e,n,i)},getPeriodById:function(e){if(!e||0===i.length)return null;var t=i.filter(function(t){return t.id===e});return t&&t.length>0?t[0]:null},setCurrentMediaInfo:function(e,t,n){r[e]=r[e]||{},r[e][t]=r[e][t]||{},r[e][t]=n},isPatchValid:function(e,i){var r=t.getId(e),a=n.getMpdId(i),o=t.getPublishTime(e),s=n.getPublishTime(i),l=n.getOriginalPublishTime(i);return!!(r&&a&&r==a&&o&&l&&o.getTime()==l.getTime()&&s&&o.getTime()<s.getTime())},applyPatchToManifest:function(e,t){n.getPatchOperations(t).forEach(function(t){var n=t.getMpdTarget(e);if(null!==n){var i=n.name,r=n.target,a=n.leaf;if(t.xpath.findsAttribute()||"__text"===i)switch(t.action){case"add":case"replace":r[i]=t.value;break;case"remove":delete r[i]}else{var o=(r[i+"_asArray"]||[]).indexOf(a),s="prepend"===t.position||"before"===t.position;if(("remove"===t.action||"replace"===t.action)&&(delete r[i],-1!=o)){var l=r[i+"_asArray"];l.splice(o,1),l.length>1?r[i]=l:1==l.length?r[i]=l[0]:delete r[i+"_asArray"]}"add"!==t.action&&"replace"!==t.action||Object.keys(t.value).forEach(function(e){var n=t.value[e],a=r[e+"_asArray"]||[];if(0===a.length&&r[e]&&a.push(r[e]),0===a.length)a=n;else{var l=a.length;l=e==i&&-1!=o?o+(s?0:1)+("replace"==t.action?-1:0):s?0:a.length,a.splice.apply(a,[l,0].concat(n))}r[e+"_asArray"]=a,r[e]=1==a.length?a[0]:a})}}})},areMediaInfosEqual:u,reset:g},t=He(l).getInstance(),n=Qr(l).getInstance(),g(),e}Jr.__dashjs_factory_name="DashAdapter";var $r=u.Z.getSingletonFactory(Jr);function ea(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ta=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return(t=[{key:"round10",value:function(e,t){return n="round",i=e,void 0===(r=t)||0==+r?Math[n](i):(r=+r,null===(i=+i)||isNaN(i)||"number"!=typeof r||r%1!=0?NaN:(i=i.toString().split("e"),+((i=(i=Math[n](+(i[0]+"e"+(i[1]?+i[1]-r:-r)))).toString().split("e"))[0]+"e"+(i[1]?+i[1]+r:r))));var n,i,r}}])&&ea(e,t),e}(),na=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.TcpList=[],this.HttpList=[],this.RepSwitchList=[],this.BufferLevel=[],this.BufferState=[],this.PlayList=[],this.DroppedFrames=[],this.SchedulingInfo=[],this.DVRInfo=[],this.ManifestUpdate=[],this.RequestsQueue=null,this.DVBErrors=[]},ia=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.t=null,this.mt=null,this.to=null,this.lto=null},ra=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.t=null,this.level=null},aa=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.target=null,this.state=s.Z.BUFFER_EMPTY},oa=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.time=null,this.range=null,this.manifestInfo=null},sa=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.time=null,this.droppedFrames=null};function la(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var ca=function e(){la(this,e),this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.representationInfo=[]},ua=function e(){la(this,e),this.id=null,this.index=null,this.start=null,this.duration=null},da=function e(){la(this,e),this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null},ha=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null},fa=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.loadingRequests=[],this.executedRequests=[]};function pa(e){var t,n,i=(e=e||{}).settings,r=this.context,o=(0,l.Z)(r).getInstance();function u(){o.trigger(c.Z.METRICS_CHANGED)}function d(e){o.trigger(c.Z.METRIC_CHANGED,{mediaType:e}),u()}function h(e,t,n){o.trigger(c.Z.METRIC_UPDATED,{mediaType:e,metric:t,value:n}),d(e)}function f(e,t,n){o.trigger(c.Z.METRIC_ADDED,{mediaType:e,metric:t,value:n}),d(e)}function p(e,t){var i=null;return e&&(n.hasOwnProperty(e)?i=n[e]:t||(i=new na,n[e]=i)),i}function g(e,t,n){var r=p(e);null!==r&&(r[t].push(n),r[t].length>i.get().streaming.metrics.maxListDepth&&r[t].shift())}function m(e,t,n){g(e,t,n),f(e,t,n)}return t={clearCurrentMetricsForType:function(e){delete n[e],d(e)},clearAllCurrentMetrics:function(){n={},u()},getMetricsFor:p,addHttpRequest:function e(t,n,i,r,a,o,l,c,u,d,h,f,p,g,v,y,_){var E=new L.w;null!=o&&o!==r&&(e(t,null,i,r,a,null,null,c,u,null,null,null,p,null,null,y,_),E.actualurl=o),E.tcpid=n,E.type=i,E.url=r,E.range=c,E.trequest=u,E.tresponse=d,E.responsecode=f,E.cmsd=_,E._tfinish=h,E._stream=t,E._mediaduration=p,E._quality=a,E._responseHeaders=g,E._serviceLocation=l,E._fileLoaderType=y,v?v.forEach(function(e){var t,n,i,r,a;t=E,n=e.s,i=e.d,r=e.b,(a=new L.O).s=n,a.d=i,a.b=r,t.trace.push(a),t.interval||(t.interval=0),t.interval+=i}):(delete E.interval,delete E.trace),m(t,s.Z.HTTP_REQUEST,E)},addRepresentationSwitch:function(e,t,n,i,r){var a=new ia;a.t=t,a.mt=n,a.to=i,r?a.lto=r:delete a.lto,m(e,s.Z.TRACK_SWITCH,a)},addBufferLevel:function(e,t,n){var i=new ra;i.t=t,i.level=n,m(e,s.Z.BUFFER_LEVEL,i)},addBufferState:function(e,t,n){var i=new aa;i.target=n,i.state=t,m(e,s.Z.BUFFER_STATE,i)},addDVRInfo:function(e,t,n,i){var r=new oa;r.time=t,r.range=i,r.manifestInfo=n,m(e,s.Z.DVR_INFO,r)},addDroppedFrames:function(e,t){var n=new sa,i=p(e).DroppedFrames;t&&(n.time=t.creationTime,n.droppedFrames=t.droppedVideoFrames,i.length>0&&i[i.length-1]==n||m(e,s.Z.DROPPED_FRAMES,n))},addSchedulingInfo:function(e,t,n,i,r,a,o,l,c){var u=new ha;u.mediaType=e,u.t=t,u.type=n,u.startTime=i,u.availabilityStartTime=r,u.duration=a,u.quality=o,u.range=l,u.state=c,m(e,s.Z.SCHEDULING_INFO,u)},addRequestsQueue:function(e,t,n){var i=new fa;i.loadingRequests=t,i.executedRequests=n,p(e).RequestsQueue=i,f(e,s.Z.REQUESTS_QUEUE,i)},addManifestUpdate:function(e,t,n,i,r,o,l,c,u,d){var h=new ca;h.mediaType=e,h.type=t,h.requestTime=n,h.fetchTime=i,h.availabilityStartTime=r,h.presentationStartTime=o,h.clientTimeOffset=l,h.currentTime=c,h.buffered=u,h.latency=d,g(a.Z.STREAM,s.Z.MANIFEST_UPDATE,h),f(e,s.Z.MANIFEST_UPDATE,h)},updateManifestUpdateInfo:function(e,t){if(e){for(var n in t)e[n]=t[n];h(e.mediaType,s.Z.MANIFEST_UPDATE,e)}},addManifestUpdateStreamInfo:function(e,t,n,i,r){if(e){var a=new ua;a.id=t,a.index=n,a.start=i,a.duration=r,e.streamInfo.push(a),h(e.mediaType,s.Z.MANIFEST_UPDATE_STREAM_INFO,e)}},addManifestUpdateRepresentationInfo:function(e,t,n,i,r,a,o,l){if(e&&e.representationInfo){var c=new da;c.id=t,c.index=n,c.streamIndex=i,c.mediaType=r,c.startNumber=o,c.fragmentInfoType=l,c.presentationTimeOffset=a,e.representationInfo.push(c),h(e.mediaType,s.Z.MANIFEST_UPDATE_TRACK_INFO,e)}},addPlayList:function(e){e.trace&&Array.isArray(e.trace)?e.trace.forEach(function(e){e.hasOwnProperty("subreplevel")&&!e.subreplevel&&delete e.subreplevel}):delete e.trace,m(a.Z.STREAM,s.Z.PLAY_LIST,e)},addDVBErrors:function(e){m(a.Z.STREAM,s.Z.DVB_ERRORS,e)}},n={},t}pa.__dashjs_factory_name="MetricsModel";var ga=u.Z.getSingletonFactory(pa);function ma(e){e=e||{};var t,n,i,r,o=this.context,l=e.metricsModel;function c(e){var t=l.getMetricsFor(e,!0);if(!t)return null;var n,i=t.HttpList,r=null;if(!i||i.length<=0)return null;for(n=i.length-1;n>=0;){if(i[n].responsecode){r=i[n];break}n--}return r}function u(e){var t=l.getMetricsFor(e,!0);return t&&t.HttpList?t.HttpList:[]}function d(e,t){if(!e)return null;var n=e[t];return n&&0!==n.length?n[n.length-1]:null}return t={getCurrentRepresentationSwitch:function(e){return d(l.getMetricsFor(e,!0),s.Z.TRACK_SWITCH)},getCurrentBufferState:function(e){return d(l.getMetricsFor(e,!0),s.Z.BUFFER_STATE)},getCurrentBufferLevel:function(e){var t=d(l.getMetricsFor(e,!0),s.Z.BUFFER_LEVEL);return t?ta.round10(t.level/1e3,-3):0},getCurrentHttpRequest:c,getHttpRequests:u,getCurrentDroppedFrames:function(){return d(l.getMetricsFor(a.Z.VIDEO,!0),s.Z.DROPPED_FRAMES)},getCurrentSchedulingInfo:function(e){return d(l.getMetricsFor(e,!0),s.Z.SCHEDULING_INFO)},getCurrentDVRInfo:function(e){return d(e?l.getMetricsFor(e,!0):l.getMetricsFor(a.Z.VIDEO,!0)||l.getMetricsFor(a.Z.AUDIO,!0),s.Z.DVR_INFO)},getCurrentManifestUpdate:function(){return d(l.getMetricsFor(a.Z.STREAM),s.Z.MANIFEST_UPDATE)},getLatestFragmentRequestHeaderValueByID:function(e,t){if(!t)return null;var n={},i=c(e);i&&(n=je.Z.parseHttpHeaders(i._responseHeaders));var r=n[t.toLowerCase()];return void 0===r?null:r},getLatestMPDRequestHeaderValueByID:function(e){if(!e)return null;var t,n,i,r={};for(i=(t=u(a.Z.STREAM)).length-1;i>=0;i--)if((n=t[i]).type===L.w.MPD_TYPE){r=je.Z.parseHttpHeaders(n._responseHeaders);break}var o=r[e.toLowerCase()];return void 0===o?null:o},addRepresentationSwitch:function(e,t,n,i,r){l.addRepresentationSwitch(e,t,n,i,r)},addDVRInfo:function(e,t,n,i){l.addDVRInfo(e,t,n,i)},updateManifestUpdateInfo:function(e){var t=this.getCurrentManifestUpdate();l.updateManifestUpdateInfo(t,e)},addManifestUpdateStreamInfo:function(e){if(e){var t=this.getCurrentManifestUpdate();l.addManifestUpdateStreamInfo(t,e.id,e.index,e.start,e.duration)}},addManifestUpdateRepresentationInfo:function(e,t){if(e){var n=this.getCurrentManifestUpdate();l.addManifestUpdateRepresentationInfo(n,e.id,e.index,e.streamIndex,t,e.presentationTimeOffset,e.startNumber,e.fragmentInfoType)}},addManifestUpdate:function(e){l.addManifestUpdate(a.Z.STREAM,e.type,e.requestStartDate,e.requestEndDate)},addHttpRequest:function(e,t,n,i,r,a){l.addHttpRequest(e.mediaType,null,e.type,e.url,e.quality,t,e.serviceLocation||null,e.range||null,e.requestStartDate,e.firstByteDate,e.requestEndDate,n,e.duration,i,r,e.fileLoaderType,a)},addSchedulingInfo:function(e,t){l.addSchedulingInfo(e.mediaType,new Date,e.type,e.startTime,e.availabilityStartTime,e.duration,e.quality,e.range,t)},addRequestsQueue:function(e,t,n){l.addRequestsQueue(e,t,n)},addBufferLevel:function(e,t,n){l.addBufferLevel(e,t,n)},addBufferState:function(e,t,n){l.addBufferState(e,t,n)},addDroppedFrames:function(e){l.addDroppedFrames(a.Z.VIDEO,e)},addPlayList:function(){r&&(l.addPlayList(r),r=null)},addDVBErrors:function(e){l.addDVBErrors(e)},createPlaylistMetrics:function(e,t){(r=new $).start=new Date,r.mstart=e,r.starttype=t},createPlaylistTraceMetrics:function(e,t,r){!0===n&&(n=!1,(i=new ee).representationid=e,i.start=new Date,i.mstart=t,i.playbackspeed=null!==r?r.toString():null)},updatePlayListTraceMetrics:function(e){if(i)for(var t in i)i[t]=e[t]},pushPlayListTraceMetrics:function(e,t){if(!1===n&&r&&i&&i.start){var a=i.start,o=e.getTime()-a.getTime();i.duration=o,i.stopreason=t,r.trace.push(i),n=!0}},clearAllCurrentMetrics:function(){l.clearAllCurrentMetrics()}},l=l||ga(o).getInstance({settings:e.settings}),n=!0,i=null,r=null,t}ma.__dashjs_factory_name="DashMetrics";var va=u.Z.getSingletonFactory(ma);function ya(){var e,t,n,i,r=this.context,s=(0,l.Z)(r).getInstance(),u=(0,I.Z)(r).getInstance();function d(e){i=e}function f(e,t,n,i){var r,a=t.adaptation.period.mpd,o=a.availabilityStartTime;if(i)r=n&&a.timeShiftBufferDepth!==Number.POSITIVE_INFINITY?new Date(o.getTime()+1e3*(e+a.timeShiftBufferDepth)):a.availabilityEndTime;else if(n){var s=t.availabilityTimeOffset;r=new Date(o.getTime()+1e3*(e-s))}else r=o;return r}function p(e,t){return(e.getTime()-t.mpd.availabilityStartTime.getTime()+1e3*i)/1e3}function g(e,t){return e+(t.adaptation.period.start-t.presentationTimeOffset)}function m(e){var n={start:NaN,end:NaN},i=e[0].getAdapter().getRegularPeriods()[0],r=p(new Date,i);if(!e||0===e.length)return{range:n,now:r};e.forEach(function(e){var i=e.getAdapter(),s=i.getMediaInfoForType(e.getStreamInfo(),a.Z.VIDEO)||i.getMediaInfoForType(e.getStreamInfo(),a.Z.AUDIO),l=i.getVoRepresentations(s)[0],c={start:NaN,end:NaN};if(l)if(l.segmentInfoType===o.Z.SEGMENT_TIMELINE)c=function(e){var n,i,r,a,o=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index],s=t.getRepresentationFor(e.index,o),l=s.SegmentTemplate||s.SegmentList,c=l.SegmentTimeline,u=l.timescale,d=c.S_asArray,h={start:0,end:0},f=d[0].t,p=!isNaN(f),m=p?f:0,v=0;for(p&&(h.start=g(m/u,e)),r=0,a=d.length;r<a;r++)i=0,(n=d[r]).hasOwnProperty("r")&&(i=n.r),v+=n.d*(1+i);return h.end=g((m+v)/u,e),h}(l);else{var u=l.adaptation.period;c.start=u.start,c.end=Math.max(r,u.start+u.duration)}!isNaN(c.start)&&(isNaN(n.start)||n.start>c.start)&&(n.start=c.start),!isNaN(c.end)&&(isNaN(n.end)||n.end<c.end)&&(n.end=c.end)}),n.end=Math.min(r,n.end);var s=y(e,n.end,!0);return n.end=isNaN(s)?n.end:s,n.start=i&&i.mpd&&i.mpd.timeShiftBufferDepth&&!isNaN(i.mpd.timeShiftBufferDepth)&&!isNaN(n.end)?Math.max(n.end-i.mpd.timeShiftBufferDepth,n.start):n.start,n.start=y(e,n.start),{range:n,now:r}}function v(e,t){n=e-t.end}function y(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{for(var i=0,r=!1,a=NaN;!r&&i<e.length;){var o=e[i].getStreamInfo();o.start<=t&&(!isFinite(o.duration)||o.start+o.duration>=t)?(a=t,r=!0):!n&&o.start>t&&(isNaN(a)||o.start<a)?a=o.start:n&&o.start+o.duration<t&&(isNaN(a)||o.start+o.duration>a)&&(a=o.start+o.duration),i+=1}return a}catch(e){return t}}function _(e){void 0===e.offset||isNaN(e.offset)||d(e.offset/1e3)}function E(){i=0,n=0}function b(){s.off(c.Z.UPDATE_TIME_SYNC_OFFSET,_,this),E()}return e={initialize:function(){E(),s.on(c.Z.UPDATE_TIME_SYNC_OFFSET,_,this)},getClientTimeOffset:function(){return i},setClientTimeOffset:d,getClientReferenceTime:function(){return Date.now()-1e3*n+1e3*i},calcAvailabilityStartTimeFromPresentationTime:function(e,t,n){return f(e,t,n)},calcAvailabilityEndTimeFromPresentationTime:function(e,t,n){return f(e,t,n,!0)},calcPresentationTimeFromWallTime:p,calcPresentationTimeFromMediaTime:g,calcPeriodRelativeTimeFromMpdRelativeTime:function(e,t){return t-e.adaptation.period.start},calcMediaTimeFromPresentationTime:function(e,t){return e-t.adaptation.period.start+t.presentationTimeOffset},calcWallTimeForSegment:function(e,t){var n,i,r;return t&&(n=e.representation.adaptation.period.mpd.suggestedPresentationDelay,i=e.presentationStartTime+n,r=new Date(e.availabilityStartTime.getTime()+1e3*i)),r},calcTimeShiftBufferWindow:function(e,t){if(!t)return n={start:NaN,end:NaN},i=0,r=NaN,e.forEach(function(e){var t=e.getStreamInfo();i+=t.duration,(isNaN(r)||t.start<r)&&(r=t.start)}),n.start=r,n.end=r+i,n;var n,i,r;if(u.get().streaming.timeShiftBuffer.calcFromSegmentTimeline){var a=m(e);return v(a.now,a.range),a.range}return function(e){var t={start:NaN,end:NaN};if(!e||0===e.length)return t;var n=e[0].getAdapter().getRegularPeriods()[0],i=p(new Date,n),r=n.mpd.timeShiftBufferDepth,a=isNaN(r)?0:i-r;if(t.start=y(e,a),t.end=!isNaN(t.start)&&i<t.start?i:y(e,i,!0),!isNaN(r)&&t.end<i-r&&(t.end=NaN),u.get().streaming.timeShiftBuffer.fallbackToSegmentTimeline){var o=m(e);if(o.range.end<t.start)return s.trigger(h.Z.CONFORMANCE_VIOLATION,{level:on.LEVELS.WARNING,event:on.EVENTS.INVALID_DVR_WINDOW}),v(o.now,o.range),o.range}return t}(e)},reset:b},t=He(r).getInstance(),b(),e}ya.__dashjs_factory_name="TimelineConverter";var _a=u.Z.getSingletonFactory(ya),Ea=n(4593),ba=n(6934);function Ta(e){return(Ta="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Sa(e,t){return(Sa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function wa(e,t){return!t||"object"!==Ta(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Aa(e){return(Aa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ra=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Sa(e,t)}(r,e);var t,n,i=(t=r,n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=Aa(t);if(n){var r=Aa(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return wa(this,e)});function r(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(e=i.call(this)).captionData=null,e.label=null,e.defaultTrack=!1,e.kind=null,e.isFragmented=!1,e.isEmbedded=!1,e.isTTML=null,e}return r}(jr),xa=n(2295);function Ia(){var e=0;function t(e){for(var t="",n=0;n<e.length;++n)t+=e[n].uchar;return t.length-t.replace(/^\s+/,"").length}function n(e){return"left: "+3.125*e.x+"%; top: "+6.66*e.y1+"%; width: "+(100-3.125*e.x)+"%; height: "+6.66*Math.max(e.y2-1-e.y1,1)+"%; align-items: flex-start; overflow: visible; -webkit-writing-mode: horizontal-tb;"}function i(e){return"red"===e?"rgb(255, 0, 0)":"green"===e?"rgb(0, 255, 0)":"blue"===e?"rgb(0, 0, 255)":"cyan"===e?"rgb(0, 255, 255)":"magenta"===e?"rgb(255, 0, 255)":"yellow"===e?"rgb(255, 255, 0)":"white"===e?"rgb(255, 255, 255)":"black"===e?"rgb(0, 0, 0)":e}function r(e,t){var n=e.videoHeight/15;return t?"font-size: "+n+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; color: "+(t.foreground?i(t.foreground):"rgb(255, 255, 255)")+"; font-style: "+(t.italics?"italic":"normal")+"; text-decoration: "+(t.underline?"underline":"none")+"; white-space: pre; background-color: "+(t.background?i(t.background):"transparent")+";":"font-size: "+n+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; justify-content: flex-start; text-align: left; color: rgb(255, 255, 255); font-style: normal; white-space: pre; line-height: normal; font-weight: normal; text-decoration: none; width: 100%; display: flex;"}function a(e){return e.replace(/^\s+/g,"")}function o(e){return e.replace(/\s+$/g,"")}return{createHTMLCaptionsFromScreen:function(i,s,l,c){var u,d,h=null,f=!1,p=-1,g={start:s,end:l,spans:[]},m="style_cea608_white_black",v={},y={},_=[];for(u=0;u<15;++u){var E=c.rows[u],b="",T=null;if(!1===E.isEmpty()){var S=t(E.chars);null===h&&(h={x:S,y1:u,y2:u+1,p:[]}),S!==p&&f&&(h.p.push(g),g={start:s,end:l,spans:[]},h.y2=u,h.name="region_"+h.x+"_"+h.y1+"_"+h.y2,!1===v.hasOwnProperty(h.name)?(_.push(h),v[h.name]=h):v[h.name].p.contat(h.p),h={x:S,y1:u,y2:u+1,p:[]});for(var w=0;w<E.chars.length;++w){var A=E.chars[w],R=A.penState;if(null===T||!R.equals(T)){b.trim().length>0&&(g.spans.push({name:m,line:b,row:u}),b="");var x="style_cea608_"+R.foreground+"_"+R.background;R.underline&&(x+="_underline"),R.italics&&(x+="_italics"),y.hasOwnProperty(x)||(y[x]=JSON.parse(JSON.stringify(R))),T=R,m=x}b+=A.uchar}b.trim().length>0&&g.spans.push({name:m,line:b,row:u}),f=!0,p=S}else f=!1,p=-1,h&&(h.p.push(g),g={start:s,end:l,spans:[]},h.y2=u,h.name="region_"+h.x+"_"+h.y1+"_"+h.y2,!1===v.hasOwnProperty(h.name)?(_.push(h),v[h.name]=h):v[h.name].p.contat(h.p),h=null)}h&&(h.p.push(g),h.y2=u+1,h.name="region_"+h.x+"_"+h.y1+"_"+h.y2,!1===v.hasOwnProperty(h.name)?(_.push(h),v[h.name]=h):v[h.name].p.contat(h.p),h=null);var I=[];for(u=0;u<_.length;++u){var L=_[u],M="sub_cea608_"+e++,C=document.createElement("div");C.id=M;var P=n(L);C.style.cssText="position: absolute; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;"+P;var D=document.createElement("div");D.className="paragraph bodyStyle",D.style.cssText=r(i);var O=document.createElement("div");O.className="cueUniWrapper",O.style.cssText="unicode-bidi: normal; direction: ltr;";for(var N=0;N<L.p.length;++N){var k=L.p[N],F=0;for(d=0;d<k.spans.length;++d){var B=k.spans[d];if(B.line.length>0){if(0!==d&&F!=B.row){var U=document.createElement("br");U.className="lineBreak",O.appendChild(U)}var V=!1;F===B.row&&(V=!0),F=B.row;var G=y[B.name],H=document.createElement("span");H.className="spanPadding "+B.name+" customSpanColor",H.style.cssText=r(i,G),0!==d&&V?d===k.spans.length-1?H.textContent=o(B.line):H.textContent=B.line:k.spans.length>1&&d<k.spans.length-1&&B.row===k.spans[d+1].row?H.textContent=a(B.line):H.textContent=B.line.trim(),O.appendChild(H)}}}D.appendChild(O),C.appendChild(D);var j={bodyStyle:["%",90]};for(var z in y)y.hasOwnProperty(z)&&(j[z]=["%",90]);I.push({type:"html",start:s,end:l,cueHTMLElement:C,cueID:M,cellResolution:[32,15],isFromCEA608:!0,fontSize:j,lineHeight:{},linePadding:{}})}return I}}}Ia.__dashjs_factory_name="EmbeddedTextHtmlRender";var La=u.Z.getSingletonFactory(Ia);function Ma(e){var t,n,i,o,s,u,h,f,p,g,m,v,y,_,E,b,S,w=e.errHandler,A=e.manifestModel,R=e.mediaController,I=e.videoModel,M=e.textTracks,C=e.vttParser,P=e.vttCustomRenderingParser,D=e.ttmlParser,O=e.streamInfo,N=e.settings,k=this.context,F=(0,l.Z)(k).getInstance(),B=!1;function U(){u=null,f=NaN,p=[],g=null,h=!1,s=[],o=null}function V(e){var t,n,i=new Ra;for(var r in e)i[r]=e[r];i.labels=e.labels,i.defaultTrack=(t=e,n=!1,v.length>1&&t.isEmbedded?n=t.id&&t.id===a.Z.CC1:1===v.length?t.id&&"string"==typeof t.id&&"CC"===t.id.substring(0,2)&&(n=!0):0===v.length&&(n=t.index===s[0].index),n),i.isFragmented=e.isFragmented,i.isEmbedded=!!e.isEmbedded,i.isTTML=function(e){return e.codec&&e.codec.search(a.Z.STPP)>=0||e.mimeType&&e.mimeType.search(a.Z.TTML)>=0}(e),i.kind=function(e,t){var n=e.roles&&e.roles.length>0?t[e.roles[0]]:t.caption;return n===t.caption||n===t.subtitle?n:t.caption}(e,{subtitle:"subtitles",caption:"captions"}),M.addTextTrack(i)}function G(e){var t=e.chunk;t.mediaInfo.embeddedCaptions&&j(t.bytes,t)}function H(e){m=e}function j(e,s){var l=s.mediaInfo,c=l.type,d=l.mimeType,p=l.codec||d;p?-1!==l.codec.indexOf("application/mp4")?function(e,r,s){var l;if("InitializationSegment"===r.segmentType)h=!0,f=i.getMediaTimescaleFromMoov(e);else{if(!h)return;(l=i.getSamplesInfo(e).sampleList).length>0&&(g=l[0].cts-r.start*f),s.search(a.Z.STPP)>=0?function(e,i,r){var s,l;for(o=null!==o?o:q(r),s=0;s<i.length;s++){var c=i[s],d=c.cts,h=Z(),p=h+d/f,g=p+c.duration/f;t.buffered.add(p,g);var v=new DataView(e,c.offset,c.subSizes[0]),y=ba.Utils.dataViewToString(v,a.Z.UTF8),_=[],E=c.offset+c.subSizes[0];for(l=1;l<c.subSizes.length;l++){var b=new Uint8Array(e,E,c.subSizes[l]),T=String.fromCharCode.apply(null,b);_.push(T),E+=c.subSizes[l]}try{var S=A.getValue().ttmlTimeIsRelative?d/f:0,w=o.parse(y,S,d/f,(d+c.duration)/f,_);M.addCaptions(m,h,w)}catch(e){u.removeExecutedRequestsBeforeTime(),this.remove(),n.error("TTML parser error: "+e.message)}}}(e,l,s):function(e,i){var r,a,o,s=[];for(r=0;r<i.length;r++){var l=i[r];l.cts-=g;var c=Z()+l.cts/f,u=c+l.duration/f;t.buffered.add(c,u);var d=e.slice(l.offset,l.offset+l.size),h=ba.parseBuffer(d);for(a=0;a<h.boxes.length;a++){var p=h.boxes[a];if(n.debug("VTT box1: "+p.type),"vtte"!==p.type&&"vttc"===p.type){n.debug("VTT vttc boxes.length = "+p.boxes.length);var v={styles:{}};for(o=0;o<p.boxes.length;o++){var y=p.boxes[o];if(n.debug("VTT box2: "+y.type),"payl"===y.type)v.start=l.cts/f,v.end=(l.cts+l.duration)/f,v.data=y.cue_text;else if("sttg"===y.type&&y.settings&&""!==y.settings)try{var _=y.settings.split(" ");v.styles=C.getCaptionStyles(_)}catch(e){}}v&&v.data&&(s.push(v),n.debug("VTT  ".concat(v.start," - ").concat(v.end," :  ").concat(v.data)))}}}s.length>0&&M.addCaptions(m,0,s)}(e,l)}}(e,s,p):c===a.Z.VIDEO?function(e,t){var a,o,s,l,c,u,d;if(t.segmentType===L.w.INIT_SEGMENT_TYPE)0===y&&(y=i.getMediaTimescaleFromMoov(e));else if(t.segmentType===L.w.MEDIA_SEGMENT_TYPE){if(0===y)return void n.warn("CEA-608: No timescale for embeddedTextTrack yet");var h=(o=i.getSamplesInfo(e)).lastSequenceNumber,f=Math.trunc(t.start),p=Math.trunc(t.end);if(b[0]||b[1]||function(){for(var e,t=0;t<v.length;t++){if(-1===(e=M.getTrackIdxForId(v[t].id)))return void n.warn("CEA-608: data before track is ready.");var i=z(e);b[t]=new(r().Cea608Parser)(t+1,{newCue:i},null)}}(),y){if(s=_,l=h,c=o.numSequences,u=E,d=f,null!==s&&null!==l&&null!==u&&null!==d&&(l===s?u!==d:l!==s+c))for(a=0;a<b.length;a++)b[a]&&b[a].reset();for(var g=function(e,t){if(0===t.length)return null;for(var n={splits:[],fields:[[],[]]},i=new DataView(e),a=0;a<t.length;a++)for(var o=t[a],s=r().findCea608Nalus(i,o.offset,o.size),l=null,c=0,u=0;u<s.length;u++)for(var d=r().extractCea608DataFromRange(i,s[u]),h=0;h<2;h++)if(d[h].length>0){o.cts!==l?c=0:c+=1;var f=Z();n.fields[h].push([o.cts+f*y,d[h],c]),l=o.cts}return n.fields.forEach(function(e){e.sort(function(e,t){return e[0]===t[0]?e[2]-t[2]:e[0]-t[0]})}),n}(e,o.sampleList),m=0;m<b.length;m++){var T=g.fields[m],S=b[m];if(S)for(a=0;a<T.length;a++)S.addData(T[a][0]/y,T[a][1])}_=h,E=p}}}(e,s):function(e,n,i){var r,o,s=new DataView(e,0,e.byteLength);o=ba.Utils.dataViewToString(s,a.Z.UTF8);try{r=q(i).parse(o,0),M.addCaptions(M.getCurrentTrackIdx(),0,r),t.buffered&&t.buffered.add(n.start,n.end)}catch(e){w.error(new T.Z(x.TIMED_TEXT_ERROR_ID_PARSE_CODE,x.TIMED_TEXT_ERROR_MESSAGE_PARSE+e.message,o))}}(e,s,p):n.error("No text type defined")}function z(e){return function(t,n,i){var r;(r=I.getTTMLRenderingDiv()?S.createHTMLCaptionsFromScreen(I.getElement(),t,n,i):[{start:t,end:n,data:i.getDisplayText(),styles:{}}])&&M.addCaptions(e,0,r)}}function Z(){return isNaN(t.timestampOffset)?0:t.timestampOffset}function q(e){var t;return e.search(a.Z.VTT)>=0?t=N.get().streaming.text.webvtt.customRenderingEnabled&&P?P:C:(e.search(a.Z.TTML)>=0||e.search(a.Z.STPP)>=0)&&(t=D),t}function W(e){v.forEach(function(t){var n=M.getTrackIdxForId(t.id);n>=0&&M.deleteCuesFromTrackIdx(n,e.from,e.to)})}return t={initialize:function(){B||(v=[],m=null,y=0,b=[],_=null,E=null,B=!0,S=La(k).getInstance(),F.on(c.Z.VIDEO_CHUNK_RECEIVED,G,t),F.on(c.Z.BUFFER_CLEARED,W,t))},addMediaInfos:function(e,n,i){if(s=s.concat(n),e===a.Z.TEXT&&n[0].isFragmented&&!n[0].isEmbedded){u=i,t.buffered=(0,xa.Z)(k).create(),p=R.getTracksFor(a.Z.TEXT,O.id).filter(function(e){return e.isFragmented});for(var r=R.getCurrentTrackFor(a.Z.TEXT,O.id),o=0;o<p.length;o++)if(p[o]===r){H(o);break}}for(var l=0;l<n.length;l++)V(n[l])},resetMediaInfos:function(){s=[]},getStreamId:function(){return O.id},append:j,abort:function(){},addEmbeddedTrack:function(e){if(B&&e)if(e.id===a.Z.CC1||e.id===a.Z.CC3){for(var t=0;t<v.length;t++)if(v[t].id===e.id)return;v.push(e)}else n.warn("Embedded track "+e.id+" not supported!")},resetEmbedded:function(){F.off(c.Z.VIDEO_CHUNK_RECEIVED,G,t),F.off(c.Z.BUFFER_CLEARED,W,t),M&&M.deleteAllTextTracks(),B=!1,v=[],b=[null,null],_=null,E=null},getConfig:function(){return{fragmentModel:u,fragmentedTracks:p,videoModel:I}},setCurrentFragmentedTrackIdx:H,remove:function(e,n){void 0===e&&e===n&&(e=t.buffered.start(0),n=t.buffered.end(t.buffered.length-1)),t.buffered.remove(e,n),M.deleteCuesFromTrackIdx(m,e,n)},reset:function(){U(),s=[],i=null}},n=(0,d.Z)(k).getInstance().getLogger(t),i=(0,Bt.Z)(k).getInstance(),U(),t}Ma.__dashjs_factory_name="TextSourceBuffer";var Ca=u.Z.getClassFactory(Ma),Pa=n(4403);function Da(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var Oa=["text","align","fontSize","id","isd","line","lineAlign","lineHeight","linePadding","position","positionAlign","region","size","snapToLines","vertical"];function Na(e){var t,n,i,r,o,s,u,f,p,g,m,v,y,_,E,b,T,S,w,A,R=this.context,x=(0,l.Z)(R).getInstance(),I=e.videoModel,L=e.streamInfo,M=e.settings;function C(e,t,n,i,r,a){var o=0,s=0;e/t>n/i?o=(s=t)/i*n:s=(o=e)/n*i;var l,c,u=0,d=0;return o/s>r?(d=s,u=s*r):(u=o,d=o/r),l=(e-u)/2,c=(t-d)/2,a?{x:l+.1*u,y:c+.1*d,w:.8*u,h:.8*d}:{x:l,y:c,w:u,h:d}}function P(e,t){var n=I.getClientWidth(),i=I.getClientHeight(),r=I.getVideoWidth(),a=I.getVideoHeight(),o=I.getVideoRelativeOffsetTop(),s=I.getVideoRelativeOffsetLeft();if(0!==r&&0!==a){var l=r/a,c=!1;e.isFromCEA608&&(l=1.1666666666666667,c=!0);var d=C.call(this,n,i,r,a,l,c),v=d.w,y=d.h,b=d.x,S=d.y;if(v!=p||y!=g||b!=u||S!=f||t){if(u=b+s,f=S+o,p=v,g=y,m){var w=m.style;w&&(w.left=u+"px",w.top=f+"px",w.width=p+"px",w.height=g+"px",w.zIndex=_&&document[_]||E?T:null,x.trigger(h.Z.CAPTION_CONTAINER_RESIZE))}var A=e.activeCues;if(A)for(var R=A.length,L=0;L<R;++L){var M=A[L];M.scaleCue(M)}}}}function D(e){var t,n,i,r,a,o=p,s=g;if(e.cellResolution){var l=[o/e.cellResolution[0],s/e.cellResolution[1]];if(e.linePadding)for(t in e.linePadding)if(e.linePadding.hasOwnProperty(t)){n=(e.linePadding[t]*l[0]).toString();for(var c=document.getElementsByClassName("spanPadding"),u=0;u<c.length;u++)c[u].style.cssText=c[u].style.cssText.replace(/(padding-left\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+n),c[u].style.cssText=c[u].style.cssText.replace(/(padding-right\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+n)}if(e.fontSize){for(t in e.fontSize)if(e.fontSize.hasOwnProperty(t)){"%"===e.fontSize[t][0]?i=e.fontSize[t][1]/100:"c"===e.fontSize[t][0]&&(i=e.fontSize[t][1]),n=(i*l[1]).toString(),a="defaultFontSize"!==t?document.getElementsByClassName(t):document.getElementsByClassName("paragraph");for(var d=0;d<a.length;d++)a[d].style.cssText=a[d].style.cssText.replace(/(font-size\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+n)}if(e.lineHeight)for(t in e.lineHeight)if(e.lineHeight.hasOwnProperty(t)){"%"===e.lineHeight[t][0]?r=e.lineHeight[t][1]/100:"c"===e.fontSize[t][0]&&(r=e.lineHeight[t][1]),n=(r*l[1]).toString(),a=document.getElementsByClassName(t);for(var h=0;h<a.length;h++)a[h].style.cssText=a[h].style.cssText.replace(/(line-height\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+n)}}}if(e.isd){var f=document.getElementById(e.cueID);f&&m.removeChild(f),N(e)}}function O(e,t){var n=/^(urn:)(mpeg:[a-z0-9][a-z0-9-]{0,31}:)(subs:)([0-9]+)$/,i=/^#(.*)$/;if(n.test(t)){var r=n.exec(t),a=parseInt(r[4],10)-1;return"data:image/png;base64,"+btoa(e.images[a])}if(i.test(t)){var o=i.exec(t)[1];return"data:image/png;base64,"+e.embeddedImages[o]}return t}function N(e){if(m){re.call(this);var t=document.createElement("div");m.appendChild(t),b=(0,Pa.renderHTML)(e.isd,t,function(t){return O(e,t)},m.clientHeight,m.clientWidth,M.get().streaming.text.imsc.displayForcedOnlyMode,function(e){n.info("renderCaption :",e)},b,M.get().streaming.text.imsc.enableRollUp),t.id=e.cueID,x.trigger(h.Z.CAPTION_RENDERED,{captionDiv:t,currentTrackIdx:s})}}function k(e,t){return!!t&&t.endTime>=e.startTime}function F(e,t){return!!M.get().streaming.text.extendSegmentedCues&&!!function(e,t,n){for(var i=0;i<n.length;i++){var r=n[i];if(JSON.stringify(e[r])!==JSON.stringify(t[r]))return!1}return!0}(t,e,Oa)&&(t.endTime=Math.max(t.endTime,e.endTime),!0)}function B(e,t){t&&t.forEach(function(t){t.kind&&"image"===t.kind&&(t.src=O(e,t.src)),B(e,t.contents)})}function U(e,t,i){var r=K(e),o=M.get().streaming.text.dispatchForManualRendering;if(r&&Array.isArray(i)&&0!==i.length)for(var s=0;s<i.length;s++){var l=null,c=i[s];r.cellResolution=c.cellResolution,r.isFromCEA608=c.isFromCEA608,isNaN(c.start)||isNaN(c.end)||(o?l=V(c,t):Z(c)&&m?l=j(c,t,r):c.data&&(l=z(c,t,r)));try{if(l){if(!J(r,l))if(M.get().streaming.text.webvtt.customRenderingEnabled)r.manualCueList||(r.manualCueList=[]),r.manualCueList.push(l);else{var u=void 0;r.cues&&0!==r.cues.length&&(u=r.cues[r.cues.length-1]),k(l,u)?F(l,u)||(u.isd&&(u.onexit=function(){}),r.mode!==a.Z.TEXT_DISABLED&&r.addCue(l)):r.mode!==a.Z.TEXT_DISABLED&&r.addCue(l)}var d=M.get().streaming.buffer.bufferToKeep;ee(r,0,I.getTime()-d)}else n.error("Impossible to display subtitles. You might have missed setting a TTML rendering div via player.attachTTMLRenderingDiv(TTMLRenderingDiv)")}catch(e){throw te(r),r.addCue(l),e}}}function V(e,t){var n=q(e,t);return n.onenter=function(){Z(e)&&A&&A.cueID!==n.cueID&&H(A),delete n.type,A=n,G(n)},n.onexit=function(){H(n),A=null},n}function G(e){x.trigger(h.Z.CUE_ENTER,e)}function H(e){x.trigger(h.Z.CUE_EXIT,{cueID:e.cueID})}function j(e,t,i){var r=this,o=q(e,t);return m.style.left=u+"px",m.style.top=f+"px",m.style.width=p+"px",m.style.height=g+"px",o.onenter=function(){var e=this;i.mode===a.Z.TEXT_SHOWING&&(this.isd?(w?requestAnimationFrame(function(){return N(e)}):N(this),n.debug("Cue enter id:"+this.cueID)):(m.appendChild(this.cueHTMLElement),D.call(r,this),x.trigger(h.Z.CAPTION_RENDERED,{captionDiv:this.cueHTMLElement,currentTrackIdx:s})))},o.onexit=function(){if(m)for(var e=m.childNodes,t=0;t<e.length;++t)e[t].id===this.cueID&&(n.debug("Cue exit id:"+e[t].id),m.removeChild(e[t]),--t)},o}function z(e,t,i){var r=q(e,t);if(r.isActive=!1,e.styles)try{void 0!==e.styles.align&&"align"in r&&(r.align=e.styles.align),void 0!==e.styles.line&&"line"in r&&(r.line=e.styles.line),void 0!==e.styles.snapToLines&&"snapToLines"in r&&(r.snapToLines=e.styles.snapToLines),void 0!==e.styles.position&&"position"in r&&(r.position=e.styles.position),void 0!==e.styles.size&&"size"in r&&(r.size=e.styles.size)}catch(e){n.error(e)}return r.onenter=function(){i.mode===a.Z.TEXT_SHOWING&&x.trigger(h.Z.CAPTION_RENDERED,{currentTrackIdx:s})},r}function Z(e){return"html"===e.type}function q(e,t){return Z(e)?(r=t,(a=new i((n=e).start+r,n.end+r,"")).cueHTMLElement=n.cueHTMLElement,a.isd=n.isd,a.images=n.images,a.embeddedImages=n.embeddedImages,a.cueID=n.cueID,a.scaleCue=D.bind(self),a.cellResolution=n.cellResolution,a.lineHeight=n.lineHeight,a.linePadding=n.linePadding,a.fontSize=n.fontSize,a.isd&&B(a,a.isd.contents),a):function(e,t){var n=new i(e.start-t,e.end-t,e.data);return n.cueID="".concat(n.startTime,"_").concat(n.endTime),n}(e,t);var n,r,a}function W(e){if(v)for(var t=v.childNodes,n=0;n<t.length;++n)t[n].id===e.cueID&&(v.removeChild(t[n]),--n)}function Y(){var e,t=[],n=function(e,t){var n;if(typeof Symbol>"u"||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Da(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Da(e,t):void 0}}(e))||t){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}(I.getTextTracks());try{for(n.s();!(e=n.n()).done;){var i=e.value;i.manualMode===a.Z.TEXT_SHOWING&&t.push(i)}}catch(e){n.e(e)}finally{n.f()}return t}function K(e){return e>=0&&r[e]?I.getTextTrack(r[e].kind,r[e].id,r[e].lang,r[e].isTTML,r[e].isEmbedded):null}function X(e){var t=this;if(e!==s){var n=K(s=e);Q.call(this,n),y&&(clearInterval(y),y=null),n&&"html"===n.renderingType&&(P.call(this,n,!0),window.ResizeObserver?(S=new window.ResizeObserver(function(){P.call(t,n,!0)})).observe(I.getElement()):y=setInterval(P.bind(this,n),500))}}function Q(e){re.call(this),e&&"html"===e.renderingType?ne.call(this):ie.call(this)}function J(e,t){if(!e.cues)return!1;for(var n=0;n<e.cues.length;n++)if(e.cues[n].startTime===t.startTime&&e.cues[n].endTime===t.endTime)return!0;return!1}function $(e,t,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return!!e&&(isNaN(t)||(i?e.startTime:e.endTime)>=t)&&(isNaN(n)||(i?e.endTime:e.startTime)<=n)}function ee(e,t,n){var i,r;if(!(n<t)&&e&&(e.cues||e.manualCueList)){var a=e.cues&&e.cues.length>0?"native":"custom",o="native"===a?e.cues:e.manualCueList;if(!o||0===o.length)return;for(var s=o.length-1;s>=0;s--)!$(o[s],t,n,!0)||(i=o[s],r=I.getTime(),i.startTime>=r&&i.endTime<=r)||("native"===a?e.removeCue(o[s]):(W(o[s]),delete e.manualCueList[s]))}}function te(e,t,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e&&(e.cues||e.manualCueList)){var r=e.cues&&e.cues.length>0?"native":"custom",a="native"===r?e.cues:e.manualCueList;if(!a||0===a.length)return;for(var o=a.length-1;o>=0;o--)$(a[o],t,n,i)&&("native"===r?(a[o].onexit&&a[o].onexit(),e.removeCue(a[o])):(W(a[o]),delete e.manualCueList[o]))}}function ne(){var e=document.getElementById("native-cue-style");if(!e){(e=document.createElement("style")).id="native-cue-style",document.head.appendChild(e);var t=e.sheet,i=I.getElement();try{i&&(i.id?t.insertRule("#"+i.id+"::cue {background: transparent}",0):0!==i.classList.length?t.insertRule("."+i.className+"::cue {background: transparent}",0):t.insertRule("video::cue {background: transparent}",0))}catch(e){n.info(""+e.message)}}}function ie(){var e=document.getElementById("native-cue-style");e&&document.head.removeChild(e)}function re(){if(m)for(;m.firstChild;)m.removeChild(m.firstChild)}return t={initialize:function(){typeof window<"u"&&typeof navigator<"u"&&(i=window.VTTCue||window.TextTrackCue,r=[],o=[],s=-1,u=0,f=0,p=0,g=0,m=null,v=null,y=null,E=!1,T=2147483647,b=null,w="requestAnimationFrame"in window,void 0!==document.fullscreenElement?_="fullscreenElement":void 0!==document.webkitIsFullScreen?_="webkitIsFullScreen":document.msFullscreenElement?_="msFullscreenElement":document.mozFullScreen&&(_="mozFullScreen"))},getStreamId:function(){return L.id},addTextTrack:function(e){r.push(e)},addCaptions:U,createTracks:function(){var e=M.get().streaming.text.dispatchForManualRendering;r.sort(function(e,t){return e.index-t.index}),m=I.getTTMLRenderingDiv(),v=I.getVttRenderingDiv();for(var t,n,i,l,u,d,f=-1,p=0;p<r.length;p++){var g=(n=(t=r[p]).kind,i=void 0!==t.id?t.id:t.lang,l=t.lang,u=t.isTTML,d=t.isEmbedded,I.addTextTrack(n,i,l,u,d));o.push(g),r[p].defaultTrack&&(g.default=!0,f=p);var y=K(p);y&&(y.mode=a.Z.TEXT_SHOWING,m&&(r[p].isTTML||r[p].isEmbedded)?y.renderingType="html":y.renderingType="default"),U(p,0,r[p].captionData),x.trigger(h.Z.TEXT_TRACK_ADDED)}if(X.call(this,f),f>=0){x.on(h.Z.PLAYBACK_METADATA_LOADED,function e(){var t=K(f);t&&"html"===t.renderingType&&P.call(this,t,!0),x.off(h.Z.PLAYBACK_METADATA_LOADED,e,this)},this);for(var _=0;_<r.length;_++){var E=K(_);E&&(E.mode=_!==f||e?a.Z.TEXT_HIDDEN:a.Z.TEXT_SHOWING,E.manualMode=_===f?a.Z.TEXT_SHOWING:a.Z.TEXT_HIDDEN)}}x.trigger(c.Z.TEXT_TRACKS_QUEUE_INITIALIZED,{index:s,tracks:r,streamId:L.id})},getCurrentTrackIdx:function(){return s},setCurrentTrackIdx:X,getTrackIdxForId:function(e){for(var t=-1,n=0;n<r.length;n++)if(r[n].id===e){t=n;break}return t},getCurrentTrackInfo:function(){return r[s]},setModeForTrackIdx:function(e,t){var n=K(e);n&&n.mode!==t&&(n.mode=t),n&&n.manualMode!==t&&(n.manualMode=t)},deleteCuesFromTrackIdx:function(e,t,n){var i=K(e);i&&te(i,t,n)},deleteAllTextTracks:function(){for(var e=o?o.length:0,t=0;t<e;t++){var n=K(t);n&&te.call(this,n,L.start,L.start+L.duration,!1)}o=[],r=[],y&&(clearInterval(y),y=null),S&&I&&(S.unobserve(I.getElement()),S=null),s=-1,re.call(this)},manualCueProcessing:function(e){var t=Y();if(t&&t.length>0){var n=t[0].manualCueList;n&&n.length>0&&n.forEach(function(t){t.startTime<=e&&t.endTime>=e&&!t.isActive?(t.isActive=!0,M.get().streaming.text.dispatchForManualRendering?G(t):WebVTT.processCues(window,[t],v,t.cueID)):t.isActive&&(t.startTime>e||t.endTime<e)&&(t.isActive=!1,M.get().streaming.text.dispatchForManualRendering?H(t):W(t))})}},disableManualTracks:function(){var e=Y();if(e&&e.length>0){var t=e[0].manualCueList;t&&t.length>0&&t.forEach(function(e){if(e.isActive)if(e.isActive=!1,M.get().streaming.text.dispatchForManualRendering)H(e);else if(v)for(var t=v.childNodes,n=0;n<t.length;++n)t[n].id===e.cueID&&(v.removeChild(t[n]),--n)})}}},n=(0,d.Z)(R).getInstance().getLogger(t),t}Na.__dashjs_factory_name="TextTracks";var ka=u.Z.getClassFactory(Na);function Fa(){var e,t,n,i,r,a,o=this.context;function s(e){var t=e.split(":"),n=t.length-1;return e=60*parseInt(t[n-1],10)+parseFloat(t[n]),2===n&&(e+=3600*parseInt(t[0],10)),e}function l(e){var t=e.split(i),n=t[1].split(a);return n.shift(),t[1]=n[0],n.shift(),{cuePoints:t,styles:c(n)}}function c(e){var t={};return e.forEach(function(e){if(e.split(/:/).length>1){var n=e.split(/:/)[1],i=!1;n&&-1!=n.search(/%/)&&(i=!0,n=parseInt(n.replace(/%/,""),10)),(e.match(/align/)||e.match(/A/))&&(t.align=n),(e.match(/line/)||e.match(/L/))&&(t.line="auto"===n?n:parseInt(n,10),i&&(t.snapToLines=!1)),(e.match(/position/)||e.match(/P/))&&(t.position=n),(e.match(/size/)||e.match(/S/))&&(t.size=n)}}),t}function u(e,t){for(var n,r=t,a="",o="";""!==e[r]&&r<e.length;)r++;if((n=r-t)>1)for(var s=0;s<n;s++){if((o=e[t+s]).match(i)){a="";break}a+=o,s!==n-1&&(a+="\n")}else(o=e[t]).match(i)||(a=o);return a}return e={parse:function(e){var a,o,c=[];if(!e)return c;a=(e=e.split(n)).length,o=-1;for(var d=0;d<a;d++){var h=e[d];if(h.length>0&&"WEBVTT"!==h&&h.match(i)){var f=l(h),p=f.cuePoints,g=f.styles,m=u(e,d+1),v=s(p[0].replace(r,"")),y=s(p[1].replace(r,""));!isNaN(v)&&!isNaN(y)&&v>=o&&y>v?""!==m?(o=v,c.push({start:v,end:y,data:m,styles:g})):t.error("Skipping cue due to empty/malformed cue text"):t.error("Skipping cue due to incorrect cue timing")}}return c},getCaptionStyles:c},t=(0,d.Z)(o).getInstance().getLogger(e),n=/(?:\r\n|\r|\n)/gm,i=/-->/,r=/(^[\s]+|[\s]+$)/g,a=/\s\b/g,e}Fa.__dashjs_factory_name="VTTParser";var Ba=u.Z.getSingletonFactory(Fa);function Ua(){var e,t;return e={parse:function(e){var n=[];return t.oncue=function(e){e.start=e.startTime,e.end=e.endTime,e.data=e.text,e.styles={align:e.align,line:e.line,position:e.position,size:e.size},n.push(e)},t.parse(e),n}},function(){try{window&&window.WebVTT&&window.WebVTT.Parser&&(t=new window.WebVTT.Parser(window,window.vttjs,window.WebVTT.StringDecoder()))}catch(e){}}(),e}Ua.__dashjs_factory_name="VttCustomRenderingParser";var Va=u.Z.getSingletonFactory(Ua);function Ga(){var e,t,n=this.context,i=(0,l.Z)(n).getInstance(),r=0;return e={parse:function(e,n,a,o,s){var l,u,d,f="",p=[],g={},m={},v="",y="",_={onOpenTag:function(e,n,r){if(r[" imagetype"]&&!r[" imageType"]&&(i.trigger(h.Z.CONFORMANCE_VIOLATION,{level:on.LEVELS.ERROR,event:on.EVENTS.NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE}),r[" imageType"]=r[" imagetype"]),"image"===n&&("http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt"===e||"http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt"===e)){if(!r[" imageType"]||"PNG"!==r[" imageType"].value)return void t.warn("smpte-tt imageType != PNG. Discarded");v=r["http://www.w3.org/XML/1998/namespace id"].value}},onCloseTag:function(){v&&(m[v]=y.trim()),y="",v=""},onText:function(e){v&&(y+=e)}};if(!e)throw f="no ttml data to parse",new Error(f);g.data=e,i.trigger(c.Z.TTML_TO_PARSE,g);var E=(0,Pa.fromXML)(g.data,function(e){f=e},_);i.trigger(c.Z.TTML_PARSED,{ttmlString:g.data,ttmlDoc:E});var b,T=E.getMediaTimeEvents();for(d=0;d<T.length;d++){var S=(0,Pa.generateISD)(E,T[d],function(e){f=e});S.contents.some(function(e){return e.contents.length})&&(l=T[d]+n)<(u=T[d+1]+n)&&p.push({start:l,end:u,type:"html",cueID:(b="cue_TTML_"+r,r++,b),isd:S,images:s,embeddedImages:m})}if(""!==f)throw t.error(f),new Error(f);return p}},t=(0,d.Z)(n).getInstance().getLogger(e),e}Ga.__dashjs_factory_name="TTMLParser";var Ha=u.Z.getSingletonFactory(Ga);function ja(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function za(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ja(Object(n),!0).forEach(function(t){Za(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ja(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Za(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qa(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Wa(e){var t,n,i,r=this.context,o=(0,l.Z)(r).getInstance(),s=(0,Q.Z)(r).getInstance(),c=e.adapter,u=e.baseURLController;function f(e,t){var n,r,o=!1;if(u.resolve()){var l=c.getVoRepresentations(e);l&&l.length>0&&(n=u.resolve(l[0].path).url)}var d=e.essentialPropertiesAsArray.filter(function(e){return e.schemeIdUri&&e.schemeIdUri===a.Z.FONT_DOWNLOAD_DVB_SCHEME}),h=e.supplementalPropertiesAsArray.filter(function(e){return e.schemeIdUri&&e.schemeIdUri===a.Z.FONT_DOWNLOAD_DVB_SCHEME});d.length>0?(o=!0,r=d):r=h,r.forEach(function(r){if((c=r).value&&"1"===c.value&&c.dvbUrl&&c.dvbUrl.length>0&&c.dvbFontFamily&&c.dvbFontFamily.length>0&&c.dvbMimeType&&(c.dvbMimeType===a.Z.OFF_MIMETYPE||c.dvbMimeType===a.Z.WOFF_MIMETYPE)){var l=(u=r.dvbUrl,d=n,s.isPathAbsolute(u)?u:s.isRelative(u)?d?s.resolve(u,d):s.resolve(u):u);i.push({fontFamily:r.dvbFontFamily,url:l,mimeType:r.dvbMimeType,trackId:e.id,streamId:t,isEssential:o,status:"unloaded",fontFace:new FontFace(r.dvbFontFamily,"url(".concat(l,")"),{display:"swap"})})}var c,u,d})}function p(e,t){var n=i[e];i[e]=za(za({},n),{},{status:t})}function g(){i=[]}return t={addFontsFromTracks:function(e,t){if(e&&Array.isArray(e)&&t)for(var n=0;n<e.length;n++)f(e[n],t)},downloadFonts:function(){for(var e=function(e){var t=i[e];document.fonts.add(t.fontFace),o.trigger(h.Z.DVB_FONT_DOWNLOAD_ADDED,t),t.fontFace.load().then(function(){p(e,"loaded"),o.trigger(h.Z.DVB_FONT_DOWNLOAD_COMPLETE,t)},function(i){p(e,"error"),n.debug("Font download error: ",i),o.trigger(h.Z.DVB_FONT_DOWNLOAD_FAILED,t)})},t=0;t<i.length;t++)e(t)},getFonts:function(){return i},getFontsForTrackId:function(e){return i.filter(function(t){return t.trackId&&t.trackId===e})},reset:function(){(function(){var e,t=function(e,t){var n;if(typeof Symbol>"u"||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return qa(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?qa(e,t):void 0}}(e))||t){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}(i);try{for(t.s();!(e=t.n()).done;){var r=e.value,a=document.fonts.delete(r.fontFace);n.debug("Removal of fontFamily: ".concat(r.fontFamily," was ").concat(a?"successful":"unsuccessful"))}}catch(e){t.e(e)}finally{t.f()}})(),g()}},n=(0,d.Z)(r).getInstance().getLogger(t),g(),t}Wa.__dashjs_factory_name="DVBFonts";var Ya=u.Z.getClassFactory(Wa);function Ka(e){var t,n,i,r,o,s,u,f,p,g,m,v,y,_,E=this.context,b=e.adapter,T=e.errHandler,S=e.manifestModel,w=e.mediaController,A=e.baseURLController,R=e.videoModel,x=e.settings;function I(e){if(_.error("Could not download ".concat(e.isEssential?"an essential":"a"," font - fontFamily: ").concat(e.fontFamily,", url: ").concat(e.url)),e.isEssential){var t=r[e.streamId].getTrackIdxForId(e.trackId);r[e.streamId].setModeForTrackIdx(t,a.Z.TEXT_DISABLED)}}function L(e){if(_.debug("Successfully downloaded ".concat(e.isEssential?"an essential":"a"," font - fontFamily: ").concat(e.fontFamily,", url: ").concat(e.url)),e.isEssential){var t=r[e.streamId].getTrackIdxForId(e.trackId);t===r[e.streamId].getCurrentTrackIdx()?r[e.streamId].setModeForTrackIdx(t,a.Z.TEXT_SHOWING):r[e.streamId].setModeForTrackIdx(t,a.Z.TEXT_HIDDEN)}}function M(e){var t=e.tracks,i=e.index,o=e.streamId;if(!1===x.get().streaming.text.defaultEnabled&&!D()||v)O(o,-1);else{var s=w.getCurrentTrackFor(a.Z.TEXT,o);if(s){var l={lang:s.lang,role:s.roles[0],index:s.index,codec:s.codec,accessibility:s.accessibility[0]};t.some(function(e,t){if(w.matchSettings(l,e))return O(o,t),i=t,!0})}p=!1}n[o].lastEnabledIndex=i,f.trigger(h.Z.TEXT_TRACKS_ADDED,{enabled:D(),index:i,tracks:t,streamId:o}),m=!0,y.addFontsFromTracks(t,o),y.getFonts().forEach(function(e){if(e.isEssential){var t=r[e.streamId].getTrackIdxForId(e.trackId);r[e.streamId].setModeForTrackIdx(t,a.Z.TEXT_DISABLED)}}),y.downloadFonts()}function C(e){try{var t=e.streamId;if(!r[t]||isNaN(e.time))return;r[t].manualCueProcessing(e.time)}catch(e){}}function P(e){try{var t=e.streamId;if(!r[t])return;r[t].disableManualTracks()}catch(e){}}function D(){var e=!0;return p&&!g&&(e=!1),e}function O(e,t){(p=-1===t)&&w&&w.saveTextSettingsDisabled();var n,o,s=N(e);if(s!==t&&r[e]){r[e].disableManualTracks();var l=r[e].getCurrentTrackInfo(),u=l?R.getTextTrack(l.kind,l.id,l.lang,l.isTTML,l.isEmbedded):null;u&&u.mode!==a.Z.TEXT_DISABLED&&r[e].setModeForTrackIdx(s,a.Z.TEXT_HIDDEN),r[e].setCurrentTrackIdx(t),l=r[e].getCurrentTrackInfo();var d=x.get().streaming.text.dispatchForManualRendering;l&&!d&&l.mode!==a.Z.TEXT_DISABLED&&r[e].setModeForTrackIdx(t,a.Z.TEXT_SHOWING),l&&l.isFragmented&&!l.isEmbedded?function(e,t,n){if(i[e])for(var o=i[e].getConfig().fragmentedTracks,s=0;s<o.length;s++){var l=o[s];if(t.lang===l.lang&&(l.id?t.id===l.id:t.index===l.index)){var u=w.getCurrentTrackFor(a.Z.TEXT,e);(l.id?u.id!==l.id:u.index!==l.index)?(r[e].deleteCuesFromTrackIdx(n),i[e].setCurrentFragmentedTrackIdx(s)):-1===n&&f.trigger(c.Z.SET_FRAGMENTED_TEXT_AFTER_DISABLED,{},{streamId:e,mediaType:a.Z.TEXT})}}}(e,l,s):l&&!l.isFragmented&&(n=e,o=l,f.trigger(c.Z.SET_NON_FRAGMENTED_TEXT,{currentTrackInfo:o},{streamId:n,mediaType:a.Z.TEXT})),w.setTrack(l)}}function N(e){return r[e].getCurrentTrackIdx()}function k(){i={},r={},n={},p=!0,m=!1,v=!1}return t={deactivateStream:function(e){if(e){var t=e.id;i[t]&&i[t].resetMediaInfos(),r[t]&&r[t].deleteAllTextTracks()}},initialize:function(){y=Ya(E).create({adapter:b,baseURLController:A}),f.on(c.Z.TEXT_TRACKS_QUEUE_INITIALIZED,M,t),f.on(c.Z.DVB_FONT_DOWNLOAD_FAILED,I,t),f.on(c.Z.DVB_FONT_DOWNLOAD_COMPLETE,L,t),x.get().streaming.text.webvtt.customRenderingEnabled&&(f.on(c.Z.PLAYBACK_TIME_UPDATED,C,t),f.on(c.Z.PLAYBACK_SEEKING,P,t))},initializeForStream:function(e){var t=e.id,a=ka(E).create({videoModel:R,settings:x,streamInfo:e});a.initialize(),r[t]=a;var l=Ca(E).create({errHandler:T,adapter:b,dvbFonts:y,manifestModel:S,mediaController:w,videoModel:R,textTracks:a,vttParser:o,vttCustomRenderingParser:s,ttmlParser:u,streamInfo:e,settings:x});l.initialize(),i[t]=l,n[t]={},n[t].lastEnabledIndex=-1},createTracks:function(e){var t=e.id;r[t]&&r[t].createTracks()},getTextSourceBuffer:function(e){var t=e.id;if(i&&i[t])return i[t]},getAllTracksAreDisabled:function(){return p},addEmbeddedTrack:function(e,t){var n=e.id;i[n]&&i[n].addEmbeddedTrack(t)},enableText:function(e,t){return(0,Y.PS)(t,"boolean"),D()!==t&&(t&&O(e,n[e].lastEnabledIndex),t||(n[e].lastEnabledIndex=N(e),m?O(e,-1):v=!0)),!0},isTextEnabled:D,setTextTrack:O,getCurrentTrackIdx:N,enableForcedTextStreaming:function(e){return(0,Y.PS)(e,"boolean"),g=e,!0},addMediaInfosToBuffer:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=e.id;i[a]&&i[a].addMediaInfos(t,n,r)},reset:function(){y.reset(),k(),f.off(c.Z.TEXT_TRACKS_QUEUE_INITIALIZED,M,t),f.off(c.Z.DVB_FONT_DOWNLOAD_FAILED,I,t),f.off(c.Z.DVB_FONT_DOWNLOAD_COMPLETE,L,t),x.get().streaming.text.webvtt.customRenderingEnabled&&(f.off(c.Z.PLAYBACK_TIME_UPDATED,C,t),f.off(c.Z.PLAYBACK_SEEKING,P,t)),Object.keys(i).forEach(function(e){i[e].resetEmbedded(),i[e].reset()})}},g=!1,m=!1,v=!1,o=Ba(E).getInstance(),s=Va(E).getInstance(),u=Ha(E).getInstance(),f=(0,l.Z)(E).getInstance(),_=(0,d.Z)(E).getInstance().getLogger(t),k(),t}Ka.__dashjs_factory_name="TextController";var Xa=u.Z.getClassFactory(Ka);function Qa(){var e,t,n,i,f,g,m,v,y,_,E,b,S,w,A,R,M,C,P,D,O,N,k,F,B,U,V,G,H,j,z,Z,q,W,K,J,$,ee,te,ne="You must first call initialize() and set a source before calling this method",ie="You must first call initialize() and set a valid source and view before calling this method",re="You must first call attachView() to set the video element before calling this method",ae="You must first call attachSource() with a valid source before calling this method",oe="MediaPlayer not initialized!",se=this.context,le=(0,l.Z)(se).getInstance(),ce=(0,I.Z)(se).getInstance(),ue=(0,d.Z)(se).getInstance({settings:ce});function de(){Ae(null),Se(null),i=null,w&&(w.reset(),w=null),A&&(A.reset(),A=null),D&&D.reset(),ce.reset(),M&&(M.reset(),M=null)}function he(){return!!n&&!!J.getElement()}function fe(){return(0,Pr.e)()}function pe(){if(!m)throw ie;return G.isPaused()}function ge(){if(!m)throw ie;return G.getIsDynamic()}function me(e){var t=B&&B.hasVideoTrack()?a.Z.VIDEO:a.Z.AUDIO,n=Z.getCurrentDVRInfo(t);if(!n)return 0;var i=G.getOriginalLiveDelay(),r=n.range.start+e;return r>n.range.end-i&&(r=n.range.end-i),r}function ve(e){if(!m)throw ie;var t=Te().currentTime;if(void 0!==e)t=B.getTimeRelativeToStreamId(t,e);else if(G.getIsDynamic()){var n=B&&B.hasVideoTrack()?a.Z.VIDEO:a.Z.AUDIO,i=Z.getCurrentDVRInfo(n);t=null===i||0===t?0:Math.max(0,t-i.range.start)}return t}function ye(){if(!m)throw ie;var e=Te().duration;if(G.getIsDynamic()){var t=B&&B.hasVideoTrack()?a.Z.VIDEO:a.Z.AUDIO,n=Z.getCurrentDVRInfo(t);e=n?n.range.end-n.range.start:0}return e}function _e(e){(0,Y.PS)(e,"boolean"),v=e}function Ee(){D.restoreDefaultUTCTimingSources()}function be(){return Z}function Te(){if(!J.getElement())throw re;return J.getElement()}function Se(e){if(!f)throw oe;J.setElement(e),e&&(Me(),function(){if(!A){var e=dashjs.MetricsReporting;if("function"==typeof e){var t=e(se).create();A=t.createMetricsReporting({debug:ue,eventBus:le,mediaElement:Te(),adapter:C,dashMetrics:Z,mediaPlayerModel:P,events:c.Z,constants:a.Z,metricsConstants:s.Z})}}}(),function(){if(!R){var e=dashjs.MssHandler;"function"==typeof e&&(x.extend(e.errors),R=e(se).create({eventBus:le,mediaPlayerModel:P,dashMetrics:Z,manifestModel:q,playbackController:G,streamController:B,protectionController:w,baseURLController:N,errHandler:O,events:c.Z,constants:a.Z,debug:ue,initSegmentType:L.w.INIT_SEGMENT_TYPE,BASE64:Ea,ISOBoxer:ba,settings:ce}))}}(),B&&B.switchToVideoElement(y)),m&&xe(),De(y)}function we(e){if(!g)throw ne;var t=B.getActiveStreamInfo();return t?S.getTracksFor(e,t.id):[]}function Ae(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN;if(!f)throw oe;"string"==typeof e&&$.initialize(e),null==t&&(t=NaN),isNaN(t)||(t=Math.max(0,t)),y=t,n=e,(g||m)&&xe(),he()&&De(y)}function Re(){if(!g)throw ne;var e=B.getActiveStreamInfo();return e?B.getStreamById(e.id):null}function xe(){m=!1,g=!1,C.reset(),B.reset(),V.reset(),z.reset(),G.reset(),H.reset(),j.reset(),_.reset(),S.reset(),te.reset(),w&&(ce.get().streaming.protection.keepProtectionMediaKeys?w.stop():(w.reset(),w=null,Me())),U.reset(),W.reset(),K.reset()}function Ie(){var e=Le();B||(B=cn(se).getInstance()),U||(U=Xa(se).create({errHandler:O,manifestModel:q,adapter:C,mediaController:S,baseURLController:N,videoModel:J,settings:ce})),F.setConfig({capabilities:k,customParametersModel:D,adapter:C,settings:ce,manifestModel:q,errHandler:O}),B.setConfig({capabilities:k,capabilitiesFilter:F,manifestLoader:e,manifestModel:q,mediaPlayerModel:P,customParametersModel:D,protectionController:w,textController:U,adapter:C,dashMetrics:Z,errHandler:O,timelineConverter:b,videoModel:J,playbackController:G,serviceDescriptionController:H,contentSteeringController:j,abrController:_,mediaController:S,settings:ce,baseURLController:N,uriFragmentModel:$,segmentBaseController:te}),V.setConfig({settings:ce,playbackController:G,streamController:B,videoModel:J,timelineConverter:b,adapter:C}),G.setConfig({streamController:B,serviceDescriptionController:H,dashMetrics:Z,adapter:C,videoModel:J,timelineConverter:b,settings:ce}),z.setConfig({streamController:B,playbackController:G,mediaPlayerModel:P,videoModel:J,settings:ce}),_.setConfig({streamController:B,domStorage:ee,mediaPlayerModel:P,customParametersModel:D,cmsdModel:K,dashMetrics:Z,adapter:C,videoModel:J,settings:ce}),W.setConfig({abrController:_,dashMetrics:Z,playbackController:G}),K.setConfig({}),_.initialize(),B.initialize(v,i),U.initialize(),V.initialize(),z.initialize(),W.initialize(),K.initialize(),j.initialize(),te.initialize()}function Le(){return Yi(se).create({debug:ue,errHandler:O,dashMetrics:Z,mediaPlayerModel:P,requestModifier:(0,X.Z)(se).getInstance(),mssHandler:R,settings:ce})}function Me(){if(w)return w;var e=dashjs.Protection;if("function"==typeof e){var t=e(se).create();return c.Z.extend(e.events),h.Z.extend(e.events,{publicOnly:!0}),x.extend(e.errors),k||(k=(0,Qi.Z)(se).getInstance()),w=t.createProtectionSystem({debug:ue,errHandler:O,videoModel:J,customParametersModel:D,capabilities:k,eventBus:le,events:c.Z,BASE64:Ea,constants:a.Z,cmcdModel:W,settings:ce})}return null}function Ce(){if(!f)throw oe;if(M)return M;var e=dashjs.OfflineController;if("function"==typeof e){c.Z.extend(e.events),h.Z.extend(e.events,{publicOnly:!0}),x.extend(e.errors);var t=Le(),n=Qt(se).create();return n.setConfig({manifestModel:q,adapter:C,manifestLoader:t,errHandler:O,contentSteeringController:j}),M=e(se).create({debug:ue,manifestUpdater:n,baseURLController:N,manifestLoader:t,manifestModel:q,mediaPlayerModel:P,abrController:_,playbackController:G,adapter:C,errHandler:O,dashMetrics:Z,timelineConverter:b,segmentBaseController:te,schemeLoaderFactory:E,eventBus:le,events:c.Z,errors:x,constants:a.Z,settings:ce,dashConstants:o.Z,urlUtils:(0,Q.Z)(se).getInstance()})}return null}function Pe(e){var t=B&&B.hasVideoTrack()?a.Z.VIDEO:a.Z.AUDIO,n=Z.getCurrentDVRInfo(t);return n?e+(n.manifestInfo.availableFrom.getTime()/1e3+n.range.start):0}function De(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN;M&&M.resetRecords(),!g&&n&&(g=!0,t.info("Streaming Initialized"),Ie(),"string"==typeof n?B.load(n,e):B.loadWithManifest(n,e)),!m&&he()&&(m=!0,t.info("Playback Initialized"))}return e={initialize:function(e,n,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:NaN;k||(k=(0,Qi.Z)(se).getInstance()).setConfig({settings:ce}),O||(O=Xi(se).getInstance()),k.supportsMediaSource()?(f||(f=!0,b=_a(se).getInstance(),_||(_=Er(se).getInstance()).setConfig({settings:ce}),E||(E=Et(se).getInstance()),G||(G=p(se).getInstance()),S||(S=wn(se).getInstance()),B||(B=cn(se).getInstance()),V||(V=dn(se).getInstance()),z||(z=fn(se).getInstance()),H||(H=yn(se).getInstance()),j||(j=Wt(se).getInstance()),F||(F=$i(se).getInstance()),C=$r(se).getInstance(),q=rr(se).getInstance(),W=We(se).getInstance(),K=ht(se).getInstance(),Z=va(se).getInstance({settings:ce}),ee=Cr(se).getInstance({settings:ce}),C.setConfig({constants:a.Z,cea608parser:r(),errHandler:O,BASE64:Ea}),N||(N=Bn(se).create()),N.setConfig({adapter:C,contentSteeringController:j}),H.setConfig({adapter:C}),te||(te=Gr(se).getInstance({dashMetrics:Z,mediaPlayerModel:P,errHandler:O,baseURLController:N,events:c.Z,eventBus:le,debug:ue,boxParser:(0,Bt.Z)(se).getInstance(),requestModifier:(0,X.Z)(se).getInstance(),errors:x})),S.setConfig({domStorage:ee,settings:ce,customParametersModel:D}),P.setConfig({playbackController:G,serviceDescriptionController:H}),j.setConfig({adapter:C,errHandler:O,dashMetrics:Z,mediaPlayerModel:P,manifestModel:q,serviceDescriptionController:H,eventBus:le,requestModifier:(0,X.Z)(se).getInstance()}),Ee(),_e(void 0===i||i),Ce()),e&&Se(e),n&&Ae(n,o),t.info("[dash.js "+fe()+"] MediaPlayer has been initialized")):O.error(new T.Z(x.CAPABILITY_MEDIASOURCE_ERROR_CODE,x.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE))},setConfig:function(e){e&&(e.capabilities&&(k=e.capabilities),e.capabilitiesFilter&&(F=e.capabilitiesFilter),e.streamController&&(B=e.streamController),e.textController&&(U=e.textController),e.gapController&&(V=e.gapController),e.playbackController&&(G=e.playbackController),e.serviceDescriptionController&&(H=e.serviceDescriptionController),e.contentSteeringController&&(j=e.contentSteeringController),e.catchupController&&(z=e.catchupController),e.mediaPlayerModel&&(P=e.mediaPlayerModel),e.customParametersModel&&(D=e.customParametersModel),e.abrController&&(_=e.abrController),e.schemeLoaderFactory&&(E=e.schemeLoaderFactory),e.mediaController&&(S=e.mediaController),e.settings&&(ce=e.settings))},on:function(e,t,n,i){le.on(e,t,n,i)},off:function(e,t,n){le.off(e,t,n)},extend:function(e,t,n){u.Z.extend(e,t,n,se)},attachView:Se,attachSource:Ae,refreshManifest:function(e){if(!f)throw oe;if(!he())return e(null,ae);var t=this;"function"==typeof e&&le.on(c.Z.INTERNAL_MANIFEST_LOADED,function n(i){le.off(c.Z.INTERNAL_MANIFEST_LOADED,n,t),i.error?e(null,i.error):e(i.manifest)},t),B.refreshManifest()},isReady:he,preload:function(){if(!J.getElement()&&!g){if(!n)throw ae;De(y)}},play:function(){if(!m)throw ie;(!v||pe()&&m)&&G.play(!0)},isPaused:pe,pause:function(){if(!m)throw ie;G.pause()},isSeeking:function(){if(!m)throw ie;return G.isSeeking()},isDynamic:ge,getLowLatencyModeEnabled:function(){if(!m)throw ie;return G.getLowLatencyModeEnabled()},seek:function(e){if(!m)throw ie;if((0,Y.PS)(e,"number"),isNaN(e))throw a.Z.BAD_ARGUMENT_ERROR;e<0&&(e=0);var t=G.getIsDynamic()?me(e):e,n=Te();!G.getIsDynamic()&&n.duration&&(t=Math.min(n.duration,t)),G.seek(t,!1,!1,!0)},seekToOriginalLive:function(){m&&ge()&&G.seekToOriginalLive()},setPlaybackRate:function(e){Te().playbackRate=e},getPlaybackRate:function(){return Te().playbackRate},setMute:function(e){(0,Y.PS)(e,"boolean"),Te().muted=e},isMuted:function(){return Te().muted},setVolume:function(e){if("number"!=typeof e||isNaN(e)||e<0||e>1)throw a.Z.BAD_ARGUMENT_ERROR;Te().volume=e},getVolume:function(){return Te().volume},time:ve,duration:ye,timeAsUTC:function(){if(!m)throw ie;return ve()<0?NaN:Pe(ve())},durationAsUTC:function(){if(!m)throw ie;return Pe(ye())},getActiveStream:Re,getDVRWindowSize:function(){var e=B&&B.hasVideoTrack()?a.Z.VIDEO:a.Z.AUDIO,t=Z.getCurrentDVRInfo(e);return t?t.manifestInfo.dvrWindowSize:0},getDVRSeekOffset:me,getAvailableBaseUrls:function(){var e=q.getValue();return e?N.getBaseUrls(e):[]},getAvailableLocations:function(){var e=q.getValue();if(!e)return[];var t=C.getLocation(e),n=j.getSynthesizedLocationElements(t);return t.concat(n)},getTargetLiveDelay:function(){if(!m)throw ie;return G.getOriginalLiveDelay()},convertToTimeCode:function(e){e=Math.max(e,0);var t=Math.floor(e/3600),n=Math.floor(e%3600/60),i=Math.floor(e%3600%60);return(0===t?"":t<10?"0"+t.toString()+":":t.toString()+":")+(n<10?"0"+n.toString():n.toString())+":"+(i<10?"0"+i.toString():i.toString())},formatUTC:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=new Date(1e3*e),a=r.toLocaleDateString(t),o=r.toLocaleTimeString(t,{hour12:n});return i?o+" "+a:o},getVersion:fe,getDebug:function(){return ue},getBufferLength:function(e){var n=[a.Z.VIDEO,a.Z.AUDIO,a.Z.TEXT];if(e)return-1!==n.indexOf(e)?be().getCurrentBufferLevel(e)||NaN:(t.warn("getBufferLength requested for invalid type"),NaN);var i=n.map(function(e){return we(e).length>0?be().getCurrentBufferLevel(e):Number.MAX_VALUE}).reduce(function(e,t){return Math.min(e,t)});return i===Number.MAX_VALUE?NaN:i},getTTMLRenderingDiv:function(){return J?J.getTTMLRenderingDiv():null},getVideoElement:Te,getSource:function(){if(!n)throw ae;return n},updateSource:function(e){n=e,B.load(n)},getCurrentLiveLatency:function(){if(!f)throw oe;return m?G.getCurrentLiveLatency():NaN},getTopBitrateInfoFor:function(e){if(!g)throw ne;return _.getTopBitrateInfoFor(e)},setAutoPlay:_e,getAutoPlay:function(){return v},getDashMetrics:be,getQualityFor:function(e){if(!g)throw ne;if(e===a.Z.IMAGE){var t=Re();if(!t)return-1;var n=t.getThumbnailController();return n?n.getCurrentTrackIndex():-1}return _.getQualityFor(e)},setQualityFor:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!g)throw ne;if(e===a.Z.IMAGE){var i=Re();if(!i)return;var r=i.getThumbnailController();r&&r.setTrackByIndex(t)}_.setPlaybackQuality(e,B.getActiveStreamInfo(),t,{forceReplace:n})},updatePortalSize:function(){_.setElementSize(),_.setWindowResizeEventCalled(!0)},enableText:function(e){var t=B.getActiveStreamInfo();return!(!t||!U)&&U.enableText(t.id,e)},enableForcedTextStreaming:function(e){return!(!B.getActiveStreamInfo()||!U)&&U.enableForcedTextStreaming(e)},isTextEnabled:function(){var e=B.getActiveStreamInfo();return!(!e||!U)&&U.isTextEnabled(e)},setTextTrack:function(e){if(!m)throw ie;var t=B.getActiveStreamInfo();t&&U&&U.setTextTrack(t.id,e)},getBitrateInfoListFor:function(e){if(!g)throw ne;var t=Re();return t?t.getBitrateListFor(e):[]},getStreamsFromManifest:function(e){if(!g)throw ne;return C.getStreamsInfo(e)},getTracksFor:we,getTracksForTypeFromManifest:function(e,t,n){if(!g)throw ne;return(n=n||C.getStreamsInfo(t,1)[0])?C.getAllMediaInfoForType(n,e,t):[]},getCurrentTrackFor:function(e){if(!g)throw ne;var t=B.getActiveStreamInfo();return S.getCurrentTrackFor(e,t.id)},setInitialMediaSettingsFor:function(e,t){if(!f)throw oe;S.setInitialSettings(e,t)},getInitialMediaSettingsFor:function(e){if(!f)throw oe;return S.getInitialSettings(e)},setCurrentTrack:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!g)throw ne;S.setTrack(e,t)},addABRCustomRule:function(e,t,n){D.addAbrCustomRule(e,t,n)},removeABRCustomRule:function(e){D.removeAbrCustomRule(e)},removeAllABRCustomRule:function(){D.removeAllAbrCustomRule()},getABRCustomRules:function(){return D.getAbrCustomRules()},getAverageThroughput:function(e){var t=_.getThroughputHistory(),n=G.getIsDynamic();return t?t.getAverageThroughput(e,n):0},retrieveManifest:function(e,t){var n=Le(),i=this;le.on(c.Z.INTERNAL_MANIFEST_LOADED,function e(r){r.error?t(null,r.error):t(r.manifest),le.off(c.Z.INTERNAL_MANIFEST_LOADED,e,i),n.reset()},i),$.initialize(e),n.load(e)},addUTCTimingSource:function(e,t){D.addUTCTimingSource(e,t)},removeUTCTimingSource:function(e,t){D.removeUTCTimingSource(e,t)},clearDefaultUTCTimingSources:function(){D.clearDefaultUTCTimingSources()},restoreDefaultUTCTimingSources:Ee,setXHRWithCredentialsForType:function(e,t){D.setXHRWithCredentialsForType(e,t)},getXHRWithCredentialsForType:function(e){return D.getXHRWithCredentialsForType(e)},getProtectionController:function(){return Me()},attachProtectionController:function(e){w=e},setProtectionData:function(e){i=e,B&&B.setProtectionData(i)},registerLicenseRequestFilter:function(e){D.registerLicenseRequestFilter(e)},registerLicenseResponseFilter:function(e){D.registerLicenseResponseFilter(e)},unregisterLicenseRequestFilter:function(e){D.unregisterLicenseRequestFilter(e)},unregisterLicenseResponseFilter:function(e){D.unregisterLicenseResponseFilter(e)},registerCustomCapabilitiesFilter:function(e){D.registerCustomCapabilitiesFilter(e)},unregisterCustomCapabilitiesFilter:function(e){D.unregisterCustomCapabilitiesFilter(e)},setCustomInitialTrackSelectionFunction:function(e){D.setCustomInitialTrackSelectionFunction(e)},resetCustomInitialTrackSelectionFunction:function(){D.resetCustomInitialTrackSelectionFunction(null)},attachTTMLRenderingDiv:function(e){if(!J.getElement())throw re;J.setTTMLRenderingDiv(e)},attachVttRenderingDiv:function(e){if(!J.getElement())throw re;J.setVttRenderingDiv(e)},getCurrentTextTrackIndex:function(){var e=B.getActiveStreamInfo();if(e&&U)return U.getCurrentTrackIdx(e.id)},provideThumbnail:function(e,t){if("function"==typeof t)if(e<0)t(null);else{var n=G.getIsDynamic()?me(e):e,i=B.getStreamForTime(n);if(null!==i){var r=i.getThumbnailController();if(r)return r.provide(n,t);t(null)}else t(null)}},getDashAdapter:function(){return C},getOfflineController:function(){return Ce()},triggerSteeringRequest:function(){if(j)return j.loadSteeringData()},getCurrentSteeringResponseData:function(){if(j)return j.getCurrentSteeringResponseData()},getSettings:function(){return ce.get()},updateSettings:function(e){ce.update(e)},resetSettings:function(){ce.reset()},reset:de,destroy:function(){de(),u.Z.deleteSingletonInstances(se)}},t=ue.getLogger(e),f=!1,m=!1,g=!1,v=!0,y=NaN,w=null,M=null,i=null,C=null,te=null,c.Z.extend(h.Z),P=sr(se).getInstance(),D=(0,gt.Z)(se).getInstance(),J=Sr(se).getInstance(),$=nr(se).getInstance(),e}Qa.__dashjs_factory_name="MediaPlayer";var Ja=u.Z.getClassFactory(Qa);Ja.events=h.Z,Ja.errors=x,u.Z.updateClassFactory(Qa.__dashjs_factory_name,Ja);var $a=Ja},8825:function(e,t,n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var s=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}(s,e);var t,n,i=(t=s,n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=o(t);if(n){var r=o(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return a(this,e)});function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=i.call(this)).AST_IN_FUTURE="astInFuture",e.BASE_URLS_UPDATED="baseUrlsUpdated",e.BUFFER_EMPTY="bufferStalled",e.BUFFER_LOADED="bufferLoaded",e.BUFFER_LEVEL_STATE_CHANGED="bufferStateChanged",e.BUFFER_LEVEL_UPDATED="bufferLevelUpdated",e.DVB_FONT_DOWNLOAD_ADDED="dvbFontDownloadAdded",e.DVB_FONT_DOWNLOAD_COMPLETE="dvbFontDownloadComplete",e.DVB_FONT_DOWNLOAD_FAILED="dvbFontDownloadFailed",e.DYNAMIC_TO_STATIC="dynamicToStatic",e.ERROR="error",e.FRAGMENT_LOADING_COMPLETED="fragmentLoadingCompleted",e.FRAGMENT_LOADING_PROGRESS="fragmentLoadingProgress",e.FRAGMENT_LOADING_STARTED="fragmentLoadingStarted",e.FRAGMENT_LOADING_ABANDONED="fragmentLoadingAbandoned",e.LOG="log",e.MANIFEST_LOADING_STARTED="manifestLoadingStarted",e.MANIFEST_LOADING_FINISHED="manifestLoadingFinished",e.MANIFEST_LOADED="manifestLoaded",e.METRICS_CHANGED="metricsChanged",e.METRIC_CHANGED="metricChanged",e.METRIC_ADDED="metricAdded",e.METRIC_UPDATED="metricUpdated",e.PERIOD_SWITCH_STARTED="periodSwitchStarted",e.PERIOD_SWITCH_COMPLETED="periodSwitchCompleted",e.QUALITY_CHANGE_REQUESTED="qualityChangeRequested",e.QUALITY_CHANGE_RENDERED="qualityChangeRendered",e.TRACK_CHANGE_RENDERED="trackChangeRendered",e.STREAM_INITIALIZING="streamInitializing",e.STREAM_UPDATED="streamUpdated",e.STREAM_ACTIVATED="streamActivated",e.STREAM_DEACTIVATED="streamDeactivated",e.STREAM_INITIALIZED="streamInitialized",e.STREAM_TEARDOWN_COMPLETE="streamTeardownComplete",e.TEXT_TRACKS_ADDED="allTextTracksAdded",e.TEXT_TRACK_ADDED="textTrackAdded",e.CUE_ENTER="cueEnter",e.CUE_EXIT="cueExit",e.THROUGHPUT_MEASUREMENT_STORED="throughputMeasurementStored",e.TTML_PARSED="ttmlParsed",e.TTML_TO_PARSE="ttmlToParse",e.CAPTION_RENDERED="captionRendered",e.CAPTION_CONTAINER_RESIZE="captionContainerResize",e.CAN_PLAY="canPlay",e.CAN_PLAY_THROUGH="canPlayThrough",e.PLAYBACK_ENDED="playbackEnded",e.PLAYBACK_ERROR="playbackError",e.PLAYBACK_NOT_ALLOWED="playbackNotAllowed",e.PLAYBACK_METADATA_LOADED="playbackMetaDataLoaded",e.PLAYBACK_LOADED_DATA="playbackLoadedData",e.PLAYBACK_PAUSED="playbackPaused",e.PLAYBACK_PLAYING="playbackPlaying",e.PLAYBACK_PROGRESS="playbackProgress",e.PLAYBACK_RATE_CHANGED="playbackRateChanged",e.PLAYBACK_SEEKED="playbackSeeked",e.PLAYBACK_SEEKING="playbackSeeking",e.PLAYBACK_STALLED="playbackStalled",e.PLAYBACK_STARTED="playbackStarted",e.PLAYBACK_TIME_UPDATED="playbackTimeUpdated",e.PLAYBACK_VOLUME_CHANGED="playbackVolumeChanged",e.PLAYBACK_WAITING="playbackWaiting",e.MANIFEST_VALIDITY_CHANGED="manifestValidityChanged",e.EVENT_MODE_ON_START="eventModeOnStart",e.EVENT_MODE_ON_RECEIVE="eventModeOnReceive",e.CONFORMANCE_VIOLATION="conformanceViolation",e.REPRESENTATION_SWITCH="representationSwitch",e.ADAPTATION_SET_REMOVED_NO_CAPABILITIES="adaptationSetRemovedNoCapabilities",e.CONTENT_STEERING_REQUEST_COMPLETED="contentSteeringRequestCompleted",e.INBAND_PRFT="inbandPrft",e.MANAGED_MEDIA_SOURCE_START_STREAMING="managedMediaSourceStartStreaming",e.MANAGED_MEDIA_SOURCE_END_STREAMING="managedMediaSourceEndStreaming",e}return s}(n(8342).Z));t.Z=s},3393:function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var i=new(function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.init()}var t;return(t=[{key:"init",value:function(){this.STREAM="stream",this.VIDEO="video",this.AUDIO="audio",this.TEXT="text",this.MUXED="muxed",this.IMAGE="image",this.STPP="stpp",this.TTML="ttml",this.VTT="vtt",this.WVTT="wvtt",this.CONTENT_STEERING="contentSteering",this.ABR_STRATEGY_DYNAMIC="abrDynamic",this.ABR_STRATEGY_BOLA="abrBola",this.ABR_STRATEGY_L2A="abrL2A",this.ABR_STRATEGY_LoLP="abrLoLP",this.ABR_STRATEGY_THROUGHPUT="abrThroughput",this.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA="abrFetchThroughputCalculationDownloadedData",this.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING="abrFetchThroughputCalculationMoofParsing",this.ABR_FETCH_THROUGHPUT_CALCULATION_AAST="abrFetchThroughputCalculationAAST",this.LIVE_CATCHUP_MODE_DEFAULT="liveCatchupModeDefault",this.LIVE_CATCHUP_MODE_LOLP="liveCatchupModeLoLP",this.MOVING_AVERAGE_SLIDING_WINDOW="slidingWindow",this.MOVING_AVERAGE_EWMA="ewma",this.BAD_ARGUMENT_ERROR="Invalid Arguments",this.MISSING_CONFIG_ERROR="Missing config parameter(s)",this.TRACK_SWITCH_MODE_ALWAYS_REPLACE="alwaysReplace",this.TRACK_SWITCH_MODE_NEVER_REPLACE="neverReplace",this.TRACK_SELECTION_MODE_FIRST_TRACK="firstTrack",this.TRACK_SELECTION_MODE_HIGHEST_BITRATE="highestBitrate",this.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY="highestEfficiency",this.TRACK_SELECTION_MODE_WIDEST_RANGE="widestRange",this.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY="highestSelectionPriority",this.CMCD_MODE_QUERY="query",this.CMCD_MODE_HEADER="header",this.INITIALIZE="initialize",this.TEXT_SHOWING="showing",this.TEXT_HIDDEN="hidden",this.TEXT_DISABLED="disabled",this.CC1="CC1",this.CC3="CC3",this.UTF8="utf-8",this.SCHEME_ID_URI="schemeIdUri",this.START_TIME="starttime",this.SERVICE_DESCRIPTION_DVB_LL_SCHEME="urn:dvb:dash:lowlatency:scope:2019",this.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME="urn:dvb:dash:lowlatency:critical:2019",this.FONT_DOWNLOAD_DVB_SCHEME="urn:dvb:dash:fontdownload:2014",this.XML="XML",this.ARRAY_BUFFER="ArrayBuffer",this.DVB_REPORTING_URL="dvb:reportingUrl",this.DVB_PROBABILITY="dvb:probability",this.OFF_MIMETYPE="application/font-sfnt",this.WOFF_MIMETYPE="application/font-woff",this.VIDEO_ELEMENT_READY_STATES={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},this.FILE_LOADER_TYPES={FETCH:"fetch_loader",XHR:"xhr_loader"}}}])&&n(e.prototype,t),e}());t.Z=i},3860:function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var i=new(function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.init()}var t;return(t=[{key:"init",value:function(){this.TCP_CONNECTION="TcpList",this.HTTP_REQUEST="HttpList",this.TRACK_SWITCH="RepSwitchList",this.BUFFER_LEVEL="BufferLevel",this.BUFFER_LOADED="bufferLoaded",this.ABANDON_LOAD="abandonload",this.ALLOW_LOAD="allowload",this.BUFFER_EMPTY="bufferStalled",this.BUFFER_STATE="BufferState",this.DVR_INFO="DVRInfo",this.DROPPED_FRAMES="DroppedFrames",this.SCHEDULING_INFO="SchedulingInfo",this.REQUESTS_QUEUE="RequestsQueue",this.MANIFEST_UPDATE="ManifestUpdate",this.MANIFEST_UPDATE_STREAM_INFO="ManifestUpdatePeriodInfo",this.MANIFEST_UPDATE_TRACK_INFO="ManifestUpdateRepresentationInfo",this.PLAY_LIST="PlayList",this.DVB_ERRORS="DVBErrors",this.HTTP_REQUEST_DVB_REPORTING_TYPE="DVBReporting"}}])&&n(e.prototype,t),e}());t.Z=i},8080:function(e,t,n){n.d(t,{default:function(){return q}});var i=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.mpdurl=null,this.errorcode=null,this.terror=null,this.url=null,this.ipaddress=null,this.servicelocation=null};i.SSL_CONNECTION_FAILED_PREFIX="SSL",i.DNS_RESOLUTION_FAILED="C00",i.HOST_UNREACHABLE="C01",i.CONNECTION_REFUSED="C02",i.CONNECTION_ERROR="C03",i.CORRUPT_MEDIA_ISOBMFF="M00",i.CORRUPT_MEDIA_OTHER="M01",i.BASE_URL_CHANGED="F00",i.BECAME_REPORTER="S00";var r=i,a=n(1180);function o(e){var t,n,i=(e=e||{}).eventBus,o=e.dashMetrics,s=e.metricsConstants,l=e.events;function c(e){var t=new r;if(n){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.mpdurl||(t.mpdurl=n.originalUrl||n.url),t.terror||(t.terror=new Date),o.addDVBErrors(t)}}function u(e){e.error||(n=e.manifest)}function d(e){c({errorcode:r.BASE_URL_CHANGED,servicelocation:e.entry})}function h(){c({errorcode:r.BECAME_REPORTER})}function f(e){var t;e.metric===s.HTTP_REQUEST&&(0===(t=e.value).responsecode||null==t.responsecode||t.responsecode>=400||t.responsecode<100||t.responsecode>=600)&&c({errorcode:t.responsecode||r.CONNECTION_ERROR,url:t.url,terror:t.tresponse,servicelocation:t._serviceLocation})}function p(e){var t;switch(e.error?e.error.code:0){case MediaError.MEDIA_ERR_NETWORK:t=r.CONNECTION_ERROR;break;case MediaError.MEDIA_ERR_DECODE:t=r.CORRUPT_MEDIA_OTHER;break;default:return}c({errorcode:t})}return t={initialize:function(){i.on(l.MANIFEST_UPDATED,u,t),i.on(l.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,d,t),i.on(l.METRIC_ADDED,f,t),i.on(l.METRIC_UPDATED,f,t),i.on(l.PLAYBACK_ERROR,p,t),i.on(a.Z.BECAME_REPORTING_PLAYER,h,t)},reset:function(){i.off(l.MANIFEST_UPDATED,u,t),i.off(l.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,d,t),i.off(l.METRIC_ADDED,f,t),i.off(l.METRIC_UPDATED,f,t),i.off(l.PLAYBACK_ERROR,p,t),i.off(a.Z.BECAME_REPORTING_PLAYER,h,t)}}}o.__dashjs_factory_name="DVBErrorsTranslator";var s=dashjs.FactoryMaker.getSingletonFactory(o),l=n(2295);function c(e){e=e||{};var t,n,i=!1,r=this.context,a=e.mediaElement;return t={initialize:function(e){e&&e.length&&(e.forEach(function(e){var t=e.starttime,i=t+e.duration;n.add(t,i)}),i=!!e[0]._useWallClockTime)},reset:function(){n.clear()},isEnabled:function(){var e,t=n.length;if(!t)return!0;e=i?(new Date).getTime()/1e3:a.currentTime;for(var r=0;r<t;r+=1){var o=n.start(r),s=n.end(r);if(o<=e&&e<s)return!0}return!1}},n=(0,l.Z)(r).create(),t}c.__dashjs_factory_name="RangeController";var u=dashjs.FactoryMaker.getClassFactory(c);function d(){return{serialise:function e(t){var n,i,r=[],a=[];for(n in t)if(t.hasOwnProperty(n)&&0!==n.indexOf("_")){if(null==(i=t[n])&&(i=""),Array.isArray(i)){if(!i.length)continue;a=[],i.forEach(function(t){var n="Object"!==Object.prototype.toString.call(t).slice(8,-1);a.push(n?t:e(t))}),i=a.map(encodeURIComponent).join(",")}else"string"==typeof i?i=encodeURIComponent(i):i instanceof Date?i=i.toISOString():"number"==typeof i&&(i=Math.round(i));r.push(n+"="+i)}return r.join("&")}}}d.__dashjs_factory_name="MetricSerialiser";var h=dashjs.FactoryMaker.getSingletonFactory(d);function f(){var e,t,n,i=window.crypto||window.msCrypto,r=Uint32Array,a=Math.pow(2,8*r.BYTES_PER_ELEMENT)-1;function o(){i&&(e||(e=new r(10)),i.getRandomValues(e),t=0)}return n={random:function(n,r){var s;return n||(n=0),r||(r=1),i?(t===e.length&&o(),s=e[t]/a,t+=1):s=Math.random(),s*(r-n)+n}},o(),n}f.__dashjs_factory_name="RNG";var p=dashjs.FactoryMaker.getSingletonFactory(f),g=n(5717);function m(e){var t;e=e||{};var n,i,r,a,o,s,l,c=this.context,u=[],d=e.metricsConstants;function f(){a=!1,o=!1,s=null,l=null}return t={report:function(e,t){Array.isArray(t)||(t=[t]),o&&l.isEnabled()&&t.forEach(function(t){var r=n.serialise(t);e!==d.DVB_ERRORS&&(r="metricname=".concat(e,"&").concat(r)),function(e,t,n){var r=new XMLHttpRequest;r.withCredentials=i.getXHRWithCredentialsForType(d.HTTP_REQUEST_DVB_REPORTING_TYPE);var a=function(){var e=u.indexOf(r);-1!==e&&(u.splice(e,1),!(r.status>=200&&r.status<300)&&n&&n())};u.push(r);try{r.open("GET",e),r.onloadend=a,r.onerror=a,r.send()}catch(e){r.onerror()}}(r="".concat(s,"?").concat(r),0,function(){o=!1})})},initialize:function(e,t){var n;if(l=t,!(s=e.dvbReportingUrl))throw new Error("required parameter missing (dvb:reportingUrl)");a||((n=e.dvbProbability)&&(1e3===n||n/1e3>=r.random())&&(o=!0),a=!0)},reset:function(){f()}},n=h(c).getInstance(),r=p(c).getInstance(),i=(0,g.Z)(c).getInstance(),f(),t}m.__dashjs_factory_name="DVBReporting";var v=dashjs.FactoryMaker.getClassFactory(m);function y(e){e=e||{};var t,n={"urn:dvb:dash:reporting:2014":v},i=this.context,r=e.debug?e.debug.getLogger(t):{},a=e.metricsConstants,o=e.mediaPlayerModel||{};return{create:function(e,t){var s;try{(s=n[e.schemeIdUri](i).create({metricsConstants:a,mediaPlayerModel:o})).initialize(e,t)}catch(t){s=null,r.error("ReportingFactory: could not create Reporting with schemeIdUri ".concat(e.schemeIdUri," (").concat(t.message,")"))}return s},register:function(e,t){n[e]=t},unregister:function(e){delete n[e]}}}y.__dashjs_factory_name="ReportingFactory";var _=dashjs.FactoryMaker.getSingletonFactory(y);function E(e){var t=[],n=_(this.context).getInstance(e);return{initialize:function(e,i){e.some(function(e){var r=n.create(e,i);if(r)return t.push(r),!0})},reset:function(){t.forEach(function(e){return e.reset()}),t=[]},report:function(e,n){t.forEach(function(t){return t.report(e,n)})}}}E.__dashjs_factory_name="ReportingController";var b=dashjs.FactoryMaker.getClassFactory(E);function T(){return{reconstructFullMetricName:function(e,t,n){var i=e;return t&&(i+="("+t,n&&n.length&&(i+=","+n),i+=")"),i},validateN:function(e){if(!e)throw new Error("missing n");if(isNaN(e))throw new Error("n is NaN");if(e<0)throw new Error("n must be positive");return e}}}T.__dashjs_factory_name="HandlerHelpers";var S=dashjs.FactoryMaker.getSingletonFactory(T);function w(e){var t,n,i,r,a;e=e||{};var o=this.context,s=S(o).getInstance(),l=[],c=e.metricsConstants;function u(){var e=function(){try{return Object.keys(l).map(function(e){return l[e]}).reduce(function(e,t){return e.level<t.level?e:t})}catch(e){return}}();e&&a!==e.t&&(a=e.t,t.report(i,e))}return{initialize:function(e,a,o){a&&(n=s.validateN(o),t=a,i=s.reconstructFullMetricName(e,o),r=setInterval(u,n))},reset:function(){clearInterval(r),r=null,n=0,t=null,a=null},handleNewMetric:function(e,t,n){e===c.BUFFER_LEVEL&&(l[n]=t)}}}w.__dashjs_factory_name="BufferLevelHandler";var A=dashjs.FactoryMaker.getClassFactory(w),R=dashjs.FactoryMaker.getClassFactory(function(e){var t,n=(e=e||{}).eventBus,i=e.metricsConstants;function r(){n.off(a.Z.METRICS_INITIALISATION_COMPLETE,r,this),n.trigger(a.Z.BECAME_REPORTING_PLAYER)}return{initialize:function(e,i){i&&(t=i,n.on(a.Z.METRICS_INITIALISATION_COMPLETE,r,this))},reset:function(){t=null},handleNewMetric:function(e,n){e===i.DVB_ERRORS&&t&&t.report(e,n)}}});function x(e){var t,n,i,r,a;e=e||{};var o=[],s=S(this.context).getInstance(),l=e.metricsConstants;function c(){var e=o;e.length&&t&&t.report(r,e),o=[]}return{initialize:function(e,o,l,u){o&&(n=s.validateN(l),t=o,u&&u.length&&(i=u),r=s.reconstructFullMetricName(e,l,u),a=setInterval(c,n))},reset:function(){clearInterval(a),a=null,n=null,i=null,o=[],t=null},handleNewMetric:function(e,t){e===l.HTTP_REQUEST&&(i&&i!==t.type||o.push(t))}}}x.__dashjs_factory_name="HttpListHandler";var I=dashjs.FactoryMaker.getClassFactory(x);function L(){var e,t;return{initialize:function(n,i){e=n,t=i},reset:function(){t=null,e=void 0},handleNewMetric:function(n,i){n===e&&t&&t.report(e,i)}}}L.__dashjs_factory_name="GenericMetricHandler";var M=dashjs.FactoryMaker.getClassFactory(L);function C(e){var t,n=(e=e||{}).debug?e.debug.getLogger(t):{},i=/([a-zA-Z]*)(\(([0-9]*)(\,\s*([a-zA-Z]*))?\))?/,r=this.context,a={BufferLevel:A,DVBErrors:R,HttpList:I,PlayList:M,RepSwitchList:M,TcpList:M};return{create:function(t,o){var s,l=t.match(i);if(l){try{(s=a[l[1]](r).create({eventBus:e.eventBus,metricsConstants:e.metricsConstants})).initialize(l[1],o,l[3],l[5])}catch(e){s=null,n.error("MetricsHandlerFactory: Could not create handler for type ".concat(l[1]," with args ").concat(l[3],", ").concat(l[5]," (").concat(e.message,")"))}return s}},register:function(e,t){a[e]=t},unregister:function(e){delete a[e]}}}C.__dashjs_factory_name="MetricsHandlerFactory";var P=dashjs.FactoryMaker.getSingletonFactory(C);function D(e){e=e||{};var t,n=[],i=this.context,r=e.eventBus,a=e.events,o=P(i).getInstance({debug:e.debug,eventBus:e.eventBus,metricsConstants:e.metricsConstants});function s(e){n.forEach(function(t){t.handleNewMetric(e.metric,e.value,e.mediaType)})}return t={initialize:function(e,i){e.split(",").forEach(function(e,t,r){var a;if(-1!==e.indexOf("(")&&-1===e.indexOf(")")){var s=r[t+1];s&&-1===s.indexOf("(")&&-1!==s.indexOf(")")&&(e+=","+s,delete r[t+1])}(a=o.create(e,i))&&n.push(a)}),r.on(a.METRIC_ADDED,s,t),r.on(a.METRIC_UPDATED,s,t)},reset:function(){r.off(a.METRIC_ADDED,s,t),r.off(a.METRIC_UPDATED,s,t),n.forEach(function(e){return e.reset()}),n=[]}}}D.__dashjs_factory_name="MetricsHandlersController";var O=dashjs.FactoryMaker.getClassFactory(D);function N(e){var t,n,i;e=e||{};var r=this.context;function a(){t&&t.reset(),n&&n.reset(),i&&i.reset()}return{initialize:function(o){try{(i=u(r).create({mediaElement:e.mediaElement})).initialize(o.Range),(n=b(r).create({debug:e.debug,metricsConstants:e.metricsConstants,mediaPlayerModel:e.mediaPlayerModel})).initialize(o.Reporting,i),(t=O(r).create({debug:e.debug,eventBus:e.eventBus,metricsConstants:e.metricsConstants,events:e.events})).initialize(o.metrics,n)}catch(e){throw a(),e}},reset:a}}N.__dashjs_factory_name="MetricsController";var k=dashjs.FactoryMaker.getClassFactory(N),F=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.metrics="",this.Range=[],this.Reporting=[]},B=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.starttime=0,this.duration=1/0,this._useWallClockTime=!1},U=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.schemeIdUri="",this.value="",this.dvbReportingUrl="",this.dvbProbability=1e3};function V(e){var t=(e=e||{}).adapter,n=e.constants;return{getMetrics:function(e){var i=[];return e&&e.Metrics_asArray&&e.Metrics_asArray.forEach(function(r){var a=new F,o=t.getIsDynamic(e);r.hasOwnProperty("metrics")&&(a.metrics=r.metrics,r.Range_asArray&&r.Range_asArray.forEach(function(i){var r,s,l,c,u,d=new B;d.starttime=(r=e,s=i,u=0,o?u=t.getAvailabilityStartTime(r)/1e3:(l=t.getRegularPeriods(r)).length&&(u=l[0].start),c=u,s&&s.hasOwnProperty(n.START_TIME)&&(c+=s.starttime),c),i.hasOwnProperty("duration")?d.duration=i.duration:d.duration=t.getDuration(e),d._useWallClockTime=o,a.Range.push(d)}),r.Reporting_asArray&&(r.Reporting_asArray.forEach(function(e){var t=new U;e.hasOwnProperty(n.SCHEME_ID_URI)&&(t.schemeIdUri=e.schemeIdUri,e.hasOwnProperty("value")&&(t.value=e.value),e.hasOwnProperty(n.DVB_REPORTING_URL)&&(t.dvbReportingUrl=e[n.DVB_REPORTING_URL]),e.hasOwnProperty(n.DVB_PROBABILITY)&&(t.dvbProbability=e[n.DVB_PROBABILITY]),a.Reporting.push(t))}),i.push(a)))}),i}}}V.__dashjs_factory_name="ManifestParsing";var G=dashjs.FactoryMaker.getSingletonFactory(V);function H(e){var t;e=e||{};var n={},i=this.context,r=e.eventBus,o=e.events;function s(t){if(!t.error){var o=Object.keys(n);G(i).getInstance({adapter:e.adapter,constants:e.constants}).getMetrics(t.manifest).forEach(function(t){var r=JSON.stringify(t);if(n.hasOwnProperty(r))o.splice(r,1);else try{var a=k(i).create(e);a.initialize(t),n[r]=a}catch(e){}}),o.forEach(function(e){n[e].reset(),delete n[e]}),r.trigger(a.Z.METRICS_INITIALISATION_COMPLETE)}}function l(){Object.keys(n).forEach(function(e){n[e].reset()}),n={}}return t={reset:function(){r.off(o.MANIFEST_UPDATED,s,t),r.off(o.STREAM_TEARDOWN_COMPLETE,l,t)}},r.on(o.MANIFEST_UPDATED,s,t),r.on(o.STREAM_TEARDOWN_COMPLETE,l,t),t}H.__dashjs_factory_name="MetricsCollectionController";var j=dashjs.FactoryMaker.getClassFactory(H);function z(){var e=this.context;return{createMetricsReporting:function(t){return s(e).getInstance({eventBus:t.eventBus,dashMetrics:t.dashMetrics,metricsConstants:t.metricsConstants,events:t.events}).initialize(),j(e).create(t)},getReportingFactory:function(){return _(e).getInstance()},getMetricsHandlerFactory:function(){return P(e).getInstance()}}}z.__dashjs_factory_name="MetricsReporting";var Z=dashjs.FactoryMaker.getClassFactory(z);Z.events=a.Z,dashjs.FactoryMaker.updateClassFactory(z.__dashjs_factory_name,Z);var q=Z},1180:function(e,t,n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var s=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}(s,e);var t,n,i=(t=s,n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=o(t);if(n){var r=o(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return a(this,e)});function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=i.call(this)).METRICS_INITIALISATION_COMPLETE="internal_metricsReportingInitialized",e.BECAME_REPORTING_PLAYER="internal_becameReportingPlayer",e.CMCD_DATA_GENERATED="cmcdDataGenerated",e}return s}(n(8342).Z));t.Z=s},5717:function(e,t,n){var i=n(2610),r=n(5448),a=n(1264),o=n(3106),s=n(1767),l=n(3393);function c(){var e,t,n,r,c,u,d,h,f=this.context,p=(0,a.Z)(f).getInstance();function g(){r=[],c=[],u=[],h=[],d=null,t=[]}function m(e,t){var n=-1;e.some(function(e,i){if(e===t)return n=i,!0}),n<0||e.splice(n,1)}function v(e){var t;for(t=0;t<h.length;t++)if(h[t].rulename===e)return t;return-1}function y(e,n){_(e,n);var r=new i.Z;r.schemeIdUri=e,r.value=n,t.push(r)}function _(e,n){(0,o.PS)(e,"string"),(0,o.PS)(n,"string"),t.forEach(function(i,r){i.schemeIdUri===e&&i.value===n&&t.splice(r,1)})}return e={getCustomInitialTrackSelectionFunction:function(){return d},setCustomInitialTrackSelectionFunction:function(e){d=e},resetCustomInitialTrackSelectionFunction:function(){d=null},getLicenseResponseFilters:function(){return c},getLicenseRequestFilters:function(){return r},getCustomCapabilitiesFilters:function(){return u},registerCustomCapabilitiesFilter:function(e){u.push(e)},registerLicenseResponseFilter:function(e){c.push(e)},registerLicenseRequestFilter:function(e){r.push(e)},unregisterCustomCapabilitiesFilter:function(e){m(u,e)},unregisterLicenseResponseFilter:function(e){m(c,e)},unregisterLicenseRequestFilter:function(e){m(r,e)},addAbrCustomRule:function(e,t,n){if("string"!=typeof e||e!==s.Z.ABANDON_FRAGMENT_RULES&&e!==s.Z.QUALITY_SWITCH_RULES||"string"!=typeof t)throw l.Z.BAD_ARGUMENT_ERROR;var i=v(t);-1===i?h.push({type:e,rulename:t,rule:n}):(h[i].type=e,h[i].rule=n)},removeAllAbrCustomRule:function(){h=[]},removeAbrCustomRule:function(e){if(e){var t=v(e);-1!==t&&h.splice(t,1)}else h=[]},getAbrCustomRules:function(){return h},addUTCTimingSource:y,removeUTCTimingSource:_,getUTCTimingSources:function(){return t},clearDefaultUTCTimingSources:function(){t=[]},restoreDefaultUTCTimingSources:function(){var e=p.get().streaming.utcSynchronization.defaultTimingSource;y(e.scheme,e.value)},setXHRWithCredentialsForType:function e(t,i){t?n[t]=!!i:Object.keys(n).forEach(function(t){e(t,i)})},getXHRWithCredentialsForType:function(e){var t=n[e];return void 0===t?n.default:t},setConfig:function(){},reset:function(){g()}},n={default:!1},g(),e}c.__dashjs_factory_name="CustomParametersModel",t.Z=r.Z.getSingletonFactory(c)},9032:function(e,t,n){var i=n(5448),r=n(7473);function a(e){var t=(e=e||{}).requestModifier;function n(e){var n=new Date,i=e.request,r=new XMLHttpRequest;if(r.open(e.method,e.url,!0),i.responseType&&(r.responseType=i.responseType),i.range&&r.setRequestHeader("Range","bytes="+i.range),i.requestStartDate||(i.requestStartDate=n),t&&t.modifyRequestHeader&&(r=t.modifyRequestHeader(r,{url:e.url})),e.headers)for(var a in e.headers){var o=e.headers[a];o&&r.setRequestHeader(a,o)}r.withCredentials=e.withCredentials,r.onload=e.onload,r.onloadend=e.onend,r.onerror=e.onerror,r.onprogress=e.progress,r.onabort=e.onabort,r.ontimeout=e.ontimeout,r.timeout=e.timeout,r.send(),e.response=r}return{load:function(e){t&&t.modifyRequest?(0,r.k)(e,t).then(function(){return n(e)}):n(e)},abort:function(e){var t=e.response;t.onloadend=t.onerror=t.onprogress=void 0,t.abort()}}}a.__dashjs_factory_name="XHRLoader";var o=i.Z.getClassFactory(a);t.Z=o},1737:function(e,t,n){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.d(t,{default:function(){return Se}});var r={attributes:["Laurl","laurl"],prefixes:["clearkey","dashif"]},a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return(t=[{key:"findCencContentProtection",value:function(e){for(var t=null,n=0;n<e.length;++n){var i=e[n];"urn:mpeg:dash:mp4protection:2011"!==i.schemeIdUri.toLowerCase()||"cenc"!==i.value.toLowerCase()&&"cbcs"!==i.value.toLowerCase()||(t=i)}return t}},{key:"getPSSHData",value:function(e){var t=8,n=new DataView(e),i=n.getUint8(t);return t+=20,i>0&&(t+=4+16*n.getUint32(t)),t+=4,e.slice(t)}},{key:"getPSSHForKeySystem",value:function(t,n){var i=e.parsePSSHList(n);return t&&i.hasOwnProperty(t.uuid.toLowerCase())?i[t.uuid.toLowerCase()]:null}},{key:"parseInitDataFromContentProtection",value:function(e,t){return"pssh"in e?(e.pssh.__text=e.pssh.__text.replace(/\r?\n|\r/g,"").replace(/\s+/g,""),t.decodeArray(e.pssh.__text).buffer):null}},{key:"parsePSSHList",value:function(e){if(null==e)return[];for(var t=new DataView(e.buffer||e),n={},i=0;;){var r,a,o=void 0,s=i;if(i>=t.buffer.byteLength)break;if(r=i+t.getUint32(i),i+=4,1886614376===t.getUint32(i))if(i+=4,0===(a=t.getUint8(i))||1===a){i++,i+=3,o="";var l=void 0,c=void 0;for(l=0;l<4;l++)o+=1===(c=t.getUint8(i+l).toString(16)).length?"0"+c:c;for(i+=4,o+="-",l=0;l<2;l++)o+=1===(c=t.getUint8(i+l).toString(16)).length?"0"+c:c;for(i+=2,o+="-",l=0;l<2;l++)o+=1===(c=t.getUint8(i+l).toString(16)).length?"0"+c:c;for(i+=2,o+="-",l=0;l<2;l++)o+=1===(c=t.getUint8(i+l).toString(16)).length?"0"+c:c;for(i+=2,o+="-",l=0;l<6;l++)o+=1===(c=t.getUint8(i+l).toString(16)).length?"0"+c:c;i+=6,i+=4,n[o=o.toLowerCase()]=t.buffer.slice(s,r),i=r}else i=r;else i=r}return n}},{key:"getLicenseServerUrlFromMediaInfo",value:function(e,t){try{if(!e||0===e.length)return null;for(var n=0,i=null;n<e.length&&!i;){var a=e[n];if(a&&a.contentProtection&&a.contentProtection.length>0){var o=a.contentProtection.filter(function(e){return e.schemeIdUri&&e.schemeIdUri===t});if(o&&o.length>0)for(var s=0;s<o.length&&!i;){for(var l=o[s],c=0;c<r.attributes.length&&!i;){for(var u=0,d=r.attributes[c];u<r.prefixes.length&&!i;){var h=r.prefixes[u];l[d]&&l[d].__prefix&&l[d].__prefix===h&&l[d].__text&&(i=l[d].__text),u+=1}c+=1}s+=1}}n+=1}return i}catch(e){return null}}}])&&i(e,t),e}(),o=function e(t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.contentType=t,this.robustness=n},s=function e(t,n,i,r,a){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.initDataTypes=["cenc"],t&&t.length&&(this.audioCapabilities=t),n&&n.length&&(this.videoCapabilities=n),this.distinctiveIdentifier=i,this.persistentState=r,this.sessionTypes=a};function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var h=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(r,e);var t,n,i=(t=r,n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=d(t);if(n){var r=d(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return u(this,e)});function r(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(e=i.call(this)).MEDIA_KEYERR_CODE=100,e.MEDIA_KEYERR_UNKNOWN_CODE=101,e.MEDIA_KEYERR_CLIENT_CODE=102,e.MEDIA_KEYERR_SERVICE_CODE=103,e.MEDIA_KEYERR_OUTPUT_CODE=104,e.MEDIA_KEYERR_HARDWARECHANGE_CODE=105,e.MEDIA_KEYERR_DOMAIN_CODE=106,e.MEDIA_KEY_MESSAGE_ERROR_CODE=107,e.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE=108,e.SERVER_CERTIFICATE_UPDATED_ERROR_CODE=109,e.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE=110,e.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE=111,e.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE=112,e.KEY_SESSION_CREATED_ERROR_CODE=113,e.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE=114,e.MEDIA_KEYERR_UNKNOWN_MESSAGE="An unspecified error occurred. This value is used for errors that don't match any of the other codes.",e.MEDIA_KEYERR_CLIENT_MESSAGE="The Key System could not be installed or updated.",e.MEDIA_KEYERR_SERVICE_MESSAGE="The message passed into update indicated an error from the license service.",e.MEDIA_KEYERR_OUTPUT_MESSAGE="There is no available output device with the required characteristics for the content protection system.",e.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE="A hardware configuration change caused a content protection error.",e.MEDIA_KEYERR_DOMAIN_MESSAGE="An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain.",e.MEDIA_KEY_MESSAGE_ERROR_MESSAGE="Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!",e.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE="DRM: Empty key message from CDM",e.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE="Error updating server certificate -- ",e.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE="DRM: KeyStatusChange error! -- License has expired",e.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE="DRM: No license server URL specified!",e.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE="DRM: KeySystem Access Denied! -- ",e.KEY_SESSION_CREATED_ERROR_MESSAGE="DRM: unable to create session! --",e.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE="DRM: licenser error! --",e}return r}(n(2230).Z)),f=n(5459),p=function e(t,n,i,r,a,o,s,l){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.url=t,this.method=n,this.responseType=i,this.headers=r,this.withCredentials=a,this.messageType=o,this.sessionId=s,this.data=l},g=function e(t,n,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.url=t,this.headers=n,this.data=i},m=n(7855),v=n(703),y=n(3393),_=n(5448);function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e){var t,n,i,r,l,c,u,d,_,b,T,S=(e=e||{}).protectionKeyController,w=e.protectionModel,A=e.eventBus,R=e.events,x=e.debug,I=e.BASE64,L=e.constants,M=[],C=e.cmcdModel,P=e.settings,D=e.customParametersModel;function O(){if(!(A&&A.hasOwnProperty("on")&&S&&S.hasOwnProperty("getSupportedKeySystemsFromContentProtection")))throw new Error("Missing config parameter(s)")}function N(e,t){d||_?d&&k():function(e,t){if(!_){_=!0;var i,r=[];e=e.sort(function(t,n){return(l&&l[t.ks.systemString]&&l[t.ks.systemString].priority>=0?l[t.ks.systemString].priority:e.length)-(l&&l[n.ks.systemString]&&l[n.ks.systemString].priority>=0?l[n.ks.systemString].priority:e.length)});for(var a=0;a<e.length;a++){var o=j(e[a]);r.push({ks:e[a].ks,configs:[o],protData:e[a].protData})}w.requestKeySystemAccess(r).then(function(e){var t=(i=e.data).mksa&&i.mksa.selectedSystemString?i.mksa.selectedSystemString:i.keySystem.systemString;return n.info("DRM: KeySystem Access Granted for system string ("+t+")!  Selecting key system..."),w.selectKeySystem(i)}).then(function(e){if(d=e,_=!1,w){A.trigger(R.KEY_SYSTEM_SELECTED,{data:i});var t=V(d);t&&t.serverCertificate&&t.serverCertificate.length>0&&w.setServerCertificate(I.decodeArray(t.serverCertificate).buffer),k()}}).catch(function(e){d=null,_=!1,t||A.trigger(R.KEY_SYSTEM_SELECTED,{data:null,error:new f.Z(h.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,h.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+"Error selecting key system! -- "+e.error)})})}}(e,t)}function k(){for(var e,t=0;t<i.length;t++)for(e=0;e<i[t].length;e++)if(d===i[t][e].ks){F(i[t][e]);break}i=[]}function F(e){if(S.isClearKey(d)&&e.protData&&e.protData.hasOwnProperty("clearkeys")&&0!==Object.keys(e.protData.clearkeys).length){var t={kids:Object.keys(e.protData.clearkeys)};e.initData=(new TextEncoder).encode(JSON.stringify(t))}e.sessionId?B(e):null!==e.initData&&U(e)}function B(e){O(),w.loadKeySession(e)}function U(e){var t=a.getPSSHForKeySystem(d,e?e.initData:null);if(t){if(function(e){if(!e)return!1;try{for(var t=w.getSessions(),n=0;n<t.length;n++)if(t[n].getKeyId()===e)return!0;return!1}catch(e){return!1}}(e.keyId)||G(t))return;try{e.initData=t,w.createKeySession(e)}catch(e){A.trigger(R.KEY_SESSION_CREATED,{data:null,error:new f.Z(h.KEY_SESSION_CREATED_ERROR_CODE,h.KEY_SESSION_CREATED_ERROR_MESSAGE+e.message)})}}else e&&e.initData?w.createKeySession(e):A.trigger(R.KEY_SESSION_CREATED,{data:null,error:new f.Z(h.KEY_SESSION_CREATED_ERROR_CODE,h.KEY_SESSION_CREATED_ERROR_MESSAGE+"Selected key system is "+(d?d.systemString:null)+".  needkey/encrypted event contains no initData corresponding to that key system!")})}function V(e){if(e){var t=e.systemString;if(l)return t in l?l[t]:null}return null}function G(e){if(!e)return!1;try{for(var t=w.getAllInitData(),i=0;i<t.length;i++)if(S.initDataEquals(e,t[i]))return n.debug("DRM: Ignoring initData because we have already seen it!"),!0;return!1}catch(e){return!1}}function H(e){O(),e?(w.setMediaElement(e),A.on(R.NEED_KEY,J,t)):null===e&&(w.setMediaElement(e),A.off(R.NEED_KEY,J,t))}function j(e){var t=e.protData,n=[],i=[],a=t&&t.audioRobustness&&t.audioRobustness.length>0?t.audioRobustness:u,l=t&&t.videoRobustness&&t.videoRobustness.length>0?t.videoRobustness:u,c=e.sessionType,d=t&&t.distinctiveIdentifier?t.distinctiveIdentifier:"optional",h=t&&t.persistentState?t.persistentState:"temporary"===c?"optional":"required";return r.forEach(function(e){e.type===L.AUDIO?n.push(new o(e.codec,a)):e.type===L.VIDEO&&i.push(new o(e.codec,l))}),new s(n,i,d,h,[c])}function z(e){e.error?A.trigger(R.KEY_STATUSES_CHANGED,{data:null,error:e.error}):n.debug("DRM: key status = "+e.status)}function Z(e){n.debug("DRM: onKeyMessage");var t=e.data;A.trigger(R.KEY_MESSAGE,{data:t});var i=t.messageType?t.messageType:"license-request",o=t.message,s=t.sessionToken,l=V(d),c=S.getLicenseServerModelInstance(d,l,i),u={sessionToken:s,messageType:i};if(o&&0!==o.byteLength){if(!c)return n.debug("DRM: License server request not required for this message (type = "+e.data.messageType+").  Session ID = "+s.getSessionId()),void q(u);if(S.isClearKey(d)){var y=S.processClearKeyLicenseRequest(d,l,o);if(y&&y.keyPairs&&y.keyPairs.length>0)return n.debug("DRM: ClearKey license request handled by application!"),q(u),void w.updateKeySession(s,y)}!function(e,t,n){var i=e.sessionToken,o=e.messageType?e.messageType:"license-request",s={sessionToken:i,messageType:o},l=d?d.systemString:null,c=function(e,t,n,i,o){var s=null,l=i.message;if(e&&e.serverURL){var c=e.serverURL;"string"==typeof c&&""!==c?s=c:"object"===E(c)&&c.hasOwnProperty(t)&&(s=c[t])}else if(e&&e.laURL&&""!==e.laURL)s=e.laURL;else if(!(s=a.getLicenseServerUrlFromMediaInfo(r,d.schemeIdURI))&&!S.isClearKey(d)){var u=a.getPSSHData(n.initData);(s=d.getLicenseServerURLFromInitData(u))||(s=i.laURL)}return o.getServerURLFromMessage(s,l,t)}(n,o,i,e,t);if(c){var u={},y=!1;n&&K(u,n.httpRequestHeaders);var _=e.message;K(u,d.getRequestHeadersFromMessage(_)),Object.keys(u).forEach(function(e){"authorization"===e.toLowerCase()&&(y=!0)}),n&&"boolean"==typeof n.withCredentials&&(y=n.withCredentials);var b=function(e){if(w)if(e.status>=200&&e.status<=299){var n=v.Z.parseHttpHeaders(e.getAllResponseHeaders?e.getAllResponseHeaders():null),r=new g(e.responseURL,n,e.response);Q(D.getLicenseResponseFilters(),r).then(function(){var n=t.getLicenseMessage(r.data,l,o);null!==n?(q(s),w.updateKeySession(i,n)):X(e,s,l,o,t)})}else X(e,s,l,o,t)},T=function(e){q(s,new f.Z(h.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,h.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+l+' update, XHR aborted. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))},A=function(e){q(s,new f.Z(h.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,h.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+l+' update, XHR error. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))},R=d.getLicenseRequestFromMessage(_),x=t.getHTTPMethod(o),I=t.getResponseType(l,o),L=n&&!isNaN(n.httpTimeout)?n.httpTimeout:8e3,M=i.getSessionId()||null,C=new p(c,x,I,u,y,o,M,R),O=isNaN(P.get().streaming.retryAttempts[m.w.LICENSE])?3:P.get().streaming.retryAttempts[m.w.LICENSE];Q(D.getLicenseRequestFilters(),C).then(function(){W(C,O,L,b,T,A)})}else q(s,new f.Z(h.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE,h.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE))}(t,c,l)}else q(u,new f.Z(h.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE,h.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE))}function q(e,t){A.trigger(R.LICENSE_REQUEST_COMPLETE,{data:e,error:t})}function W(e,t,i,r,a,o){var s=new XMLHttpRequest;if(P.get().streaming.cmcd&&P.get().streaming.cmcd.enabled&&P.get().streaming.cmcd.mode===y.Z.CMCD_MODE_QUERY){var l=C.getQueryParameter({url:e.url,type:m.w.LICENSE});l&&(e.url=v.Z.addAditionalQueryParameterToUrl(e.url,[l]))}for(var c in s.open(e.method,e.url,!0),s.responseType=e.responseType,s.withCredentials=e.withCredentials,i>0&&(s.timeout=i),e.headers)s.setRequestHeader(c,e.headers[c]);if(P.get().streaming.cmcd&&P.get().streaming.cmcd.enabled&&P.get().streaming.cmcd.mode===y.Z.CMCD_MODE_HEADER){var u=C.getHeaderParameters({url:e.url,type:m.w.LICENSE});if(u)for(var d in u){var h=u[d];h&&s.setRequestHeader(d,h)}}var f=function(){t--;var n=isNaN(P.get().streaming.retryIntervals[m.w.LICENSE])?1e3:P.get().streaming.retryIntervals[m.w.LICENSE];T=setTimeout(function(){W(e,t,i,r,a,o)},n)};s.onload=function(){b=null,this.status>=200&&this.status<=299||t<=0?r(this):(n.warn("License request failed ("+this.status+"). Retrying it... Pending retries: "+t),f())},s.ontimeout=s.onerror=function(){b=null,t<=0?o(this):(n.warn("License request network request failed . Retrying it... Pending retries: "+t),f())},s.onabort=function(){a(this)},A.trigger(R.LICENSE_REQUEST_SENDING,{url:e.url,headers:e.headers,payload:e.data,sessionId:e.sessionId}),b=s,s.send(e.data)}function Y(){b&&(b.onloadend=b.onerror=b.onprogress=void 0,b.abort(),b=null),T&&(clearTimeout(T),T=null)}function K(e,t){if(t)for(var n in t)e[n]=t[n]}function X(e,t,n,i,r){var a="NONE",o=null;e.response&&(a=r.getErrorResponse(e.response,n,i),o={serverResponse:e.response||null,responseCode:e.status||null,responseText:e.statusText||null}),q(t,new f.Z(h.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,h.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+n+' update, XHR complete. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState+".  Response is "+a,o))}function Q(e,t){return e?e.reduce(function(e,n){return e.then(function(){return n(t)})},Promise.resolve()):Promise.resolve()}function J(e,t){if(!P.get().streaming.protection.ignoreEmeEncryptedEvent){if(n.debug("DRM: onNeedKey"),"cenc"!==e.key.initDataType)return void n.warn("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+e.key.initDataType);if(0===r.length&&(n.warn("DRM: onNeedKey called before initializeForMedia, wait until initialized"),(t=void 0===t?1:t+1)<5))return void M.push(setTimeout(function(){J(e,t)},500));var o=e.key.initData;if(ArrayBuffer.isView(o)&&(o=o.buffer),d){var s=a.getPSSHForKeySystem(d,o);if(s&&G(s))return}n.debug("DRM: initData:",String.fromCharCode.apply(null,new Uint8Array(o)));var u=S.getSupportedKeySystemsFromSegmentPssh(o,l,c);if(0===u.length)return void n.debug("DRM: Received needkey event with initData, but we don't support any of the key systems!");h=u,i.push(h),N(h,!1)}var h}return t={initializeForMedia:function(e){if(!e)throw new Error("mediaInfo can not be null or undefined");O(),r.push(e)},clearMediaInfoArray:function(){r=[]},handleKeySystemFromManifest:function(){if(r&&0!==r.length){var e=[];r.forEach(function(t){var n=S.getSupportedKeySystemsFromContentProtection(t.contentProtection,l,c);n.length>0&&(0===e.length&&(e=n),i.push(n))}),e&&e.length>0&&N(e,!0)}},createKeySession:U,loadKeySession:B,removeKeySession:function(e){O(),w.removeKeySession(e)},closeKeySession:function(e){O(),w.closeKeySession(e)},setServerCertificate:function(e){O(),w.setServerCertificate(e)},setMediaElement:H,setSessionType:function(e){c=e},setRobustnessLevel:function(e){u=e},setProtectionData:function(e){l=e,S.setProtectionData(e)},getSupportedKeySystemsFromContentProtection:function(e){return O(),S.getSupportedKeySystemsFromContentProtection(e,l,c)},getKeySystems:function(){return S?S.getKeySystems():[]},setKeySystems:function(e){S&&S.setKeySystems(e)},stop:function(){Y(),w&&w.stop()},reset:function(){A.off(R.INTERNAL_KEY_MESSAGE,Z,t),A.off(R.INTERNAL_KEY_STATUS_CHANGED,z,t),O(),Y(),H(null),d=null,_=!1,w&&(w.reset(),w=null),M.forEach(function(e){return clearTimeout(e)}),M=[],r=[],i=[]}},n=x.getLogger(t),i=[],r=[],c="temporary",u="",b=null,T=null,A.on(R.INTERNAL_KEY_MESSAGE,Z,t),A.on(R.INTERNAL_KEY_STATUS_CHANGED,z,t),t}b.__dashjs_factory_name="ProtectionController";var T=_.Z.getClassFactory(b),S=function e(t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.keyID=t,this.key=n};function w(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var A=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n&&"persistent"!==n&&"temporary"!==n)throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=t,this.type=n}var t;return(t=[{key:"toJWK",value:function(){var e,t=this.keyPairs.length,n={keys:[]};for(e=0;e<t;e++){var i={kty:"oct",alg:"A128KW",kid:this.keyPairs[e].keyID,k:this.keyPairs[e].key};n.keys.push(i)}this.type&&(n.type=this.type);var r=JSON.stringify(n),a=r.length,o=new ArrayBuffer(a),s=new Uint8Array(o);for(e=0;e<a;e++)s[e]=r.charCodeAt(e);return o}}])&&w(e.prototype,t),e}();function R(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var x=new(function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.init()}var t;return(t=[{key:"init",value:function(){this.CLEARKEY_KEYSTEM_STRING="org.w3.clearkey",this.WIDEVINE_KEYSTEM_STRING="com.widevine.alpha",this.PLAYREADY_KEYSTEM_STRING="com.microsoft.playready",this.PLAYREADY_RECOMMENDATION_KEYSTEM_STRING="com.microsoft.playready.recommendation",this.INITIALIZATION_DATA_TYPE_CENC="cenc",this.INITIALIZATION_DATA_TYPE_KEYIDS="keyids",this.INITIALIZATION_DATA_TYPE_WEBM="webm"}}])&&R(e.prototype,t),e}()),I="e2719d58-a985-b3c9-781a-b030af78d30e",L=x.CLEARKEY_KEYSTEM_STRING,M="urn:uuid:"+I;function C(e){var t=(e=e||{}).BASE64;return{uuid:I,schemeIdURI:M,systemString:L,getInitData:function(e,n){try{var i=a.parseInitDataFromContentProtection(e,t);if(!i&&n){var r={kids:[function(e){try{var t=e.replace(/-/g,"");return(t=btoa(t.match(/\w{2}/g).map(function(e){return String.fromCharCode(parseInt(e,16))}).join(""))).replace(/=/g,"").replace(/\//g,"_").replace(/\+/g,"-")}catch(e){return null}}(n["cenc:default_KID"])]};i=(new TextEncoder).encode(JSON.stringify(r))}return i}catch(e){return null}},getRequestHeadersFromMessage:function(){return{"Content-Type":"application/json"}},getLicenseRequestFromMessage:function(e){return JSON.stringify(JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e))))},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getClearKeysFromProtectionData:function(e,t){var n=null;if(e){for(var i=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),r=[],a=0;a<i.kids.length;a++){var o=i.kids[a],s=e.clearkeys&&e.clearkeys.hasOwnProperty(o)?e.clearkeys[o]:null;if(!s)throw new Error("DRM: ClearKey keyID ("+o+") is not known!");r.push(new S(o,s))}n=new A(r)}return n}}}C.__dashjs_factory_name="KeySystemClearKey";var P=dashjs.FactoryMaker.getSingletonFactory(C),D="1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",O=x.CLEARKEY_KEYSTEM_STRING,N="urn:uuid:"+D;function k(e){var t,n=e.BASE64,i=e.debug.getLogger(t);return{uuid:D,schemeIdURI:N,systemString:O,getInitData:function(e){return a.parseInitDataFromContentProtection(e,n)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getClearKeysFromProtectionData:function(e,t){var n=null;if(e){for(var r=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),a=[],o=0;o<r.kids.length;o++){var s=r.kids[o],l=e.clearkeys&&e.clearkeys.hasOwnProperty(s)?e.clearkeys[s]:null;if(!l)throw new Error("DRM: ClearKey keyID ("+s+") is not known!");a.push(new S(s,l))}n=new A(a),i.warn("ClearKey schemeIdURI is using W3C Common PSSH systemID (1077efec-c0b2-4d02-ace3-3c1e52e2fb4b) in Content Protection. See DASH-IF IOP v4.1 section 7.6.2.4")}return n}}}k.__dashjs_factory_name="KeySystemW3CClearKey";var F=dashjs.FactoryMaker.getSingletonFactory(k),B="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",U=x.WIDEVINE_KEYSTEM_STRING,V="urn:uuid:"+B;function G(e){var t=(e=e||{}).BASE64;return{uuid:B,schemeIdURI:V,systemString:U,getInitData:function(e){return a.parseInitDataFromContentProtection(e,t)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null}}}G.__dashjs_factory_name="KeySystemWidevine";var H=dashjs.FactoryMaker.getSingletonFactory(G),j="9a04f079-9840-4286-ab92-e65be0885f95",z=x.PLAYREADY_KEYSTEM_STRING,Z="urn:uuid:"+j;function q(e){var t="utf-16",n=(e=e||{}).BASE64,i=e.settings;function r(){if(!n||!n.hasOwnProperty("decodeArray")||!n.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}return{uuid:j,schemeIdURI:Z,systemString:z,getInitData:function(e){var t,i,o,s,l,c=new Uint8Array([112,115,115,104,0,0,0,0]),u=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),d=0,h=null;if(r(),!e)return null;if("pssh"in e)return a.parseInitDataFromContentProtection(e,n);if("pro"in e)h=n.decodeArray(e.pro.__text);else{if(!("prheader"in e))return null;h=n.decodeArray(e.prheader.__text)}return t=h.length,i=4+c.length+u.length+4+t,o=new ArrayBuffer(i),s=new Uint8Array(o),(l=new DataView(o)).setUint32(d,i),d+=4,s.set(c,d),d+=c.length,s.set(u,d),d+=u.length,l.setUint32(d,t),d+=4,s.set(h,d),d+=t,s.buffer},getRequestHeadersFromMessage:function(e){var n,r,a={},o=new DOMParser;if(i&&i.get().streaming.protection.detectPlayreadyMessageFormat&&"utf-16"===t&&e&&e.byteLength%2==1)return a["Content-Type"]="text/xml; charset=utf-8",a;var s="utf-16"===t?new Uint16Array(e):new Uint8Array(e);n=String.fromCharCode.apply(null,s);for(var l=(r=o.parseFromString(n,"application/xml")).getElementsByTagName("name"),c=r.getElementsByTagName("value"),u=0;u<l.length;u++)a[l[u].childNodes[0].nodeValue]=c[u].childNodes[0].nodeValue;return a.hasOwnProperty("Content")&&(a["Content-Type"]=a.Content,delete a.Content),a.hasOwnProperty("Content-Type")||(a["Content-Type"]="text/xml; charset=utf-8"),a},getLicenseRequestFromMessage:function(e){var a=null,o=new DOMParser;if(i&&i.get().streaming.protection.detectPlayreadyMessageFormat&&"utf-16"===t&&e&&e.byteLength%2==1)return e;var s="utf-16"===t?new Uint16Array(e):new Uint8Array(e);r();var l=String.fromCharCode.apply(null,s),c=o.parseFromString(l,"application/xml");if(!c.getElementsByTagName("PlayReadyKeyMessage")[0])return e;var u=c.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;return u&&(a=n.decode(u)),a},getLicenseServerURLFromInitData:function(e){if(e)for(var t=new DataView(e),n=t.getUint16(4,!0),i=6,r=new DOMParser,a=0;a<n;a++){var o=t.getUint16(i,!0);i+=2;var s=t.getUint16(i,!0);if(i+=2,1===o){var l=e.slice(i,i+s),c=String.fromCharCode.apply(null,new Uint16Array(l)),u=r.parseFromString(c,"application/xml");if(u.getElementsByTagName("LA_URL")[0]){var d=u.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(d)return d}if(u.getElementsByTagName("LUI_URL")[0]){var h=u.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(h)return h}}else i+=s}return null},getCDMData:function(e){var t,i,a,o;if(r(),!e)return null;for(t=[],o=0;o<e.length;++o)t.push(e.charCodeAt(o)),t.push(0);for(t=String.fromCharCode.apply(null,t),t=n.encode(t),i='<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="false"><CustomData encoding="base64encoded">%CUSTOMDATA%</CustomData></LicenseAcquisition></PlayReadyCDMData>'.replace("%CUSTOMDATA%",t),a=[],o=0;o<i.length;++o)a.push(i.charCodeAt(o)),a.push(0);return new Uint8Array(a).buffer},setPlayReadyMessageFormat:function(e){if("utf-8"!==e&&"utf-16"!==e)throw new Error('Specified message format is not one of "utf-8" or "utf-16"');t=e}}}q.__dashjs_factory_name="KeySystemPlayReady";var W=dashjs.FactoryMaker.getSingletonFactory(q);function Y(e){var t=(e=e||{}).BASE64,n={};return n[x.WIDEVINE_KEYSTEM_STRING]={responseType:"json",getLicenseMessage:function(e){return t.decodeArray(e.license)},getErrorResponse:function(e){return e}},n[x.PLAYREADY_KEYSTEM_STRING]={responseType:"arraybuffer",getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}},{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(e){return n[e].responseType},getLicenseMessage:function(e,i){return function(){if(!t||!t.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}(),n[i].getLicenseMessage(e)},getErrorResponse:function(e,t){return n[t].getErrorResponse(e)}}}Y.__dashjs_factory_name="DRMToday";var K=dashjs.FactoryMaker.getSingletonFactory(Y);function X(){var e="http://schemas.xmlsoap.org/soap/envelope/";function t(e){var t=String.fromCharCode.apply(null,new Uint8Array(e));return decodeURIComponent(escape(t))}function n(n){if(window.DOMParser){var i=t(n),r=(new window.DOMParser).parseFromString(i,"text/xml"),a=r?r.getElementsByTagNameNS(e,"Envelope")[0]:null,o=a?a.getElementsByTagNameNS(e,"Body")[0]:null;if(o&&o.getElementsByTagNameNS(e,"Fault")[0])return null}return n}function i(n){var i="",r="",a="",o=-1,s=-1;if(window.DOMParser){var l=t(n),c=(new window.DOMParser).parseFromString(l,"text/xml"),u=c?c.getElementsByTagNameNS(e,"Envelope")[0]:null,d=u?u.getElementsByTagNameNS(e,"Body")[0]:null,h=d?d.getElementsByTagNameNS(e,"Fault")[0]:null,f=h?h.getElementsByTagName("detail")[0]:null,p=f?f.getElementsByTagName("Exception")[0]:null,g=null;if(null===h)return l;i=(g=h.getElementsByTagName("faultstring")[0].firstChild)?g.nodeValue:null,null!==p&&(r=(g=p.getElementsByTagName("StatusCode")[0])?g.firstChild.nodeValue:null,o=(a=(g=p.getElementsByTagName("Message")[0])?g.firstChild.nodeValue:null)?a.lastIndexOf("[")+1:-1,s=a?a.indexOf("]"):-1,a=a?a.substring(o,s):"")}var m="code: ".concat(r,", name: ").concat(i);return a&&(m+=", message: ".concat(a)),m}return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return n.call(this,e)},getErrorResponse:function(e){return i.call(this,e)}}}X.__dashjs_factory_name="PlayReady";var Q=_.Z.getSingletonFactory(X);function J(){return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}J.__dashjs_factory_name="Widevine";var $=dashjs.FactoryMaker.getSingletonFactory(J);function ee(){return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"json"},getLicenseMessage:function(e){if(!e.hasOwnProperty("keys"))return null;for(var t=[],n=0;n<e.keys.length;n++){var i=e.keys[n],r=i.kid.replace(/=/g,""),a=i.k.replace(/=/g,"");t.push(new S(r,a))}return new A(t)},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}ee.__dashjs_factory_name="ClearKey";var te=dashjs.FactoryMaker.getSingletonFactory(ee);function ne(){var e,t,n,i,r,o,s,l,c=this.context;function u(e,t){return t&&e in t?t[e]:null}function d(e,t){return e&&e.sessionId?e.sessionId:t&&t.sessionId?t.sessionId:null}function h(e,t){return e&&e.sessionType?e.sessionType:t}return e={initialize:function(){var e;i=[],e=W(c).getInstance({BASE64:r,settings:o}),i.push(e),e=H(c).getInstance({BASE64:r}),i.push(e),e=P(c).getInstance({BASE64:r}),i.push(e),s=e,e=F(c).getInstance({BASE64:r,debug:t}),i.push(e),l=e},setProtectionData:function(e){for(var t,n,r=0;r<i.length;r++){var a=i[r];a.hasOwnProperty("init")&&a.init((t=a.systemString,n=void 0,n=null,e&&(n=t in e?e[t]:null),n))}},isClearKey:function(e){return e===s||e===l},initDataEquals:function(e,t){if(e.byteLength===t.byteLength){for(var n=new Uint8Array(e),i=new Uint8Array(t),r=0;r<n.length;r++)if(n[r]!==i[r])return!1;return!0}return!1},getKeySystems:function(){return i},setKeySystems:function(e){i=e},getKeySystemBySystemString:function(e){for(var t=0;t<i.length;t++)if(i[t].systemString===e)return i[t];return null},getSupportedKeySystemsFromContentProtection:function(e,t,n){var r,o,s,l,c=[];if(e){var f=a.findCencContentProtection(e);for(s=0;s<i.length;++s){var p=u((o=i[s]).systemString,t);for(l=0;l<e.length;++l)if((r=e[l]).schemeIdUri.toLowerCase()===o.schemeIdURI){var g=o.getInitData(r,f);c.push({ks:i[s],keyId:r.keyId,initData:g,protData:p,cdmData:o.getCDMData(p?p.cdmData:null),sessionId:d(p,r),sessionType:h(p,n)})}}}return c},getSupportedKeySystemsFromSegmentPssh:function(e,t,n){for(var r,o=[],s=a.parsePSSHList(e),l=0;l<i.length;++l){var c=u((r=i[l]).systemString,t);r.uuid in s&&o.push({ks:r,initData:s[r.uuid],protData:c,cdmData:r.getCDMData(c?c.cdmData:null),sessionId:d(c),sessionType:h(c,n)})}return o},getLicenseServerModelInstance:function(e,t,n){if("license-release"===n||"individualization-request"===n)return null;var i=null;return t&&t.hasOwnProperty("drmtoday")?i=K(c).getInstance({BASE64:r}):e.systemString===x.WIDEVINE_KEYSTEM_STRING?i=$(c).getInstance():e.systemString===x.PLAYREADY_KEYSTEM_STRING?i=Q(c).getInstance():e.systemString===x.CLEARKEY_KEYSTEM_STRING&&(i=te(c).getInstance()),i},processClearKeyLicenseRequest:function(e,t,i){try{return e.getClearKeysFromProtectionData(t,i)}catch(e){return n.error("Failed to retrieve clearkeys from ProtectionData"),null}},setConfig:function(i){i&&(i.debug&&(t=i.debug,n=t.getLogger(e)),i.BASE64&&(r=i.BASE64),i.settings&&(o=i.settings))}}}ne.__dashjs_factory_name="ProtectionKeyController";var ie=dashjs.FactoryMaker.getSingletonFactory(ne);function re(e){return(re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ae(e,t){return(ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function oe(e,t){return!t||"object"!==re(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function se(e){return(se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var le=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ae(e,t)}(r,e);var t,n,i=(t=r,n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=se(t);if(n){var r=se(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return oe(this,e)});function r(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(e=i.call(this)).INTERNAL_KEY_MESSAGE="internalKeyMessage",e.INTERNAL_KEY_STATUS_CHANGED="internalkeyStatusChanged",e.KEY_ADDED="public_keyAdded",e.KEY_ERROR="public_keyError",e.KEY_MESSAGE="public_keyMessage",e.KEY_SESSION_CLOSED="public_keySessionClosed",e.KEY_SESSION_CREATED="public_keySessionCreated",e.KEY_SESSION_REMOVED="public_keySessionRemoved",e.KEY_STATUSES_CHANGED="public_keyStatusesChanged",e.KEY_SYSTEM_ACCESS_COMPLETE="public_keySystemAccessComplete",e.KEY_SYSTEM_SELECTED="public_keySystemSelected",e.LICENSE_REQUEST_COMPLETE="public_licenseRequestComplete",e.LICENSE_REQUEST_SENDING="public_licenseRequestSending",e.NEED_KEY="needkey",e.PROTECTION_CREATED="public_protectioncreated",e.PROTECTION_DESTROYED="public_protectiondestroyed",e.SERVER_CERTIFICATE_UPDATED="serverCertificateUpdated",e.TEARDOWN_COMPLETE="protectionTeardownComplete",e.VIDEO_ELEMENT_SELECTED="videoElementSelected",e.KEY_SESSION_UPDATED="public_keySessionUpdated",e}return r}(n(8342).Z)),ce=function e(t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.initData=t,this.initDataType=n},ue=function e(t,n,i,r){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.sessionToken=t,this.message=n,this.defaultURL=i,this.messageType=r||"license-request"},de=function e(t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.keySystem=t,this.ksConfiguration=n},he={};function fe(e){e=e||{};var t,n,i,r,a,o,s,l,c=this.context,u=e.eventBus,d=e.events,p=e.debug;function g(e,t,n,i){if(void 0===navigator.requestMediaKeySystemAccess||"function"!=typeof navigator.requestMediaKeySystemAccess){var r="Insecure origins are not allowed";return u.trigger(d.KEY_SYSTEM_ACCESS_COMPLETE,{error:r}),void i({error:r})}var a,o,s=e[t].protData&&e[t].protData.systemStringPriority?e[t].protData.systemStringPriority:null,l=e[t].configs,c=e[t].ks,h=c.systemString;(a=s||(he[h]?he[h]:[h]),o=l,new Promise(function(e,t){m(a,o,0,e,t)})).then(function(e){var t="function"==typeof e.getConfiguration?e.getConfiguration():null,i=new de(c,t);i.mksa=e,u.trigger(d.KEY_SYSTEM_ACCESS_COMPLETE,{data:i}),n({data:i})}).catch(function(r){if(t+1<e.length)g(e,t+1,n,i);else{var a="Key system access denied! ";u.trigger(d.KEY_SYSTEM_ACCESS_COMPLETE,{error:a+r.message}),i({error:a+r.message})}})}function m(e,t,i,r,a){var o=e[i];n.debug("Requesting key system access for system string ".concat(o)),navigator.requestMediaKeySystemAccess(o,t).then(function(e){e.selectedSystemString=o,r(e)}).catch(function(n){i+1<e.length?m(e,t,i+1,r,a):a(n)})}function v(e){if(!e||!e.session)return Promise.resolve;var t=e.session;return t.removeEventListener("keystatuseschange",e),t.removeEventListener("message",e),t.close()}function y(e){for(var t=0;t<o.length;t++)if(o[t]===e){o.splice(t,1);break}}function _(e){var t,n;return e&&e.length>0&&(e[0]&&("string"==typeof e[0]?t=e[0]:n=e[0]),e[1]&&("string"==typeof e[1]?t=e[1]:n=e[1])),{status:t,keyId:n}}function E(e,t){var i={session:e,keyId:t.keyId,initData:t.initData,sessionId:t.sessionId,sessionType:t.sessionType,handleEvent:function(e){switch(e.type){case"keystatuseschange":u.trigger(d.KEY_STATUSES_CHANGED,{data:this}),e.target.keyStatuses.forEach(function(){var e=_(arguments);"expired"===e.status?u.trigger(d.INTERNAL_KEY_STATUS_CHANGED,{error:new f.Z(h.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE,h.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE)}):u.trigger(d.INTERNAL_KEY_STATUS_CHANGED,e)});break;case"message":var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;u.trigger(d.INTERNAL_KEY_MESSAGE,{data:new ue(this,t,void 0,e.messageType)})}},getKeyId:function(){return this.keyId},getSessionId:function(){return e.sessionId},getSessionType:function(){return this.sessionType},getExpirationTime:function(){return e.expiration},getKeyStatuses:function(){return e.keyStatuses},getUsable:function(){var t=!1;return e.keyStatuses.forEach(function(){"usable"===_(arguments).status&&(t=!0)}),t}};return e.addEventListener("keystatuseschange",i),e.addEventListener("message",i),e.closed.then(function(){y(i),n.debug("DRM: Session closed.  SessionID = "+i.getSessionId()),u.trigger(d.KEY_SESSION_CLOSED,{data:i.getSessionId()})}),o.push(i),i}return t={getAllInitData:function(){for(var e=[],t=0;t<o.length;t++)o[t].initData&&e.push(o[t].initData);return e},getSessions:function(){return o},requestKeySystemAccess:function(e){return new Promise(function(t,n){g(e,0,t,n)})},selectKeySystem:function(e){return new Promise(function(t,n){e.mksa.createMediaKeys().then(function(t){return i=e.keySystem,a=t,r?r.setMediaKeys(a):Promise.resolve()}).then(function(){t(i)}).catch(function(){n({error:"Error selecting keys system ("+e.keySystem.systemString+")! Could not create MediaKeys -- TODO"})})})},setMediaElement:function(e){r!==e&&(r&&(r.removeEventListener("encrypted",s),r.setMediaKeys&&r.setMediaKeys(null)),(r=e)&&(r.addEventListener("encrypted",s),r.setMediaKeys&&a&&r.setMediaKeys(a)))},setServerCertificate:function(e){if(!i||!a)throw new Error("Can not set server certificate until you have selected a key system");a.setServerCertificate(e).then(function(){n.info("DRM: License server certificate successfully updated."),u.trigger(d.SERVER_CERTIFICATE_UPDATED)}).catch(function(e){u.trigger(d.SERVER_CERTIFICATE_UPDATED,{error:new f.Z(h.SERVER_CERTIFICATE_UPDATED_ERROR_CODE,h.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE+e.name)})})},createKeySession:function(e){if(!i||!a)throw new Error("Can not create sessions until you have selected a key system");var t=a.createSession(e.sessionType),r=E(t,e),o=i.systemString===x.CLEARKEY_KEYSTEM_STRING&&(e.initData||e.protData&&e.protData.clearkeys)?x.INITIALIZATION_DATA_TYPE_KEYIDS:x.INITIALIZATION_DATA_TYPE_CENC;t.generateRequest(o,e.initData).then(function(){n.debug("DRM: Session created.  SessionID = "+r.getSessionId()),u.trigger(d.KEY_SESSION_CREATED,{data:r})}).catch(function(e){y(r),u.trigger(d.KEY_SESSION_CREATED,{data:null,error:new f.Z(h.KEY_SESSION_CREATED_ERROR_CODE,h.KEY_SESSION_CREATED_ERROR_MESSAGE+"Error generating key request -- "+e.name)})})},updateKeySession:function(e,t){var n=e.session;l.isClearKey(i)&&(t=t.toJWK()),n.update(t).then(function(){u.trigger(d.KEY_SESSION_UPDATED)}).catch(function(t){u.trigger(d.KEY_ERROR,{error:new f.Z(h.MEDIA_KEYERR_CODE,"Error sending update() message! "+t.name,e)})})},loadKeySession:function(e){if(!i||!a)throw new Error("Can not load sessions until you have selected a key system");for(var t=e.sessionId,r=0;r<o.length;r++)if(t===o[r].sessionId)return void n.warn("DRM: Ignoring session ID because we have already seen it!");var s=a.createSession(e.sessionType),l=E(s,e);s.load(t).then(function(e){e?(n.debug("DRM: Session loaded.  SessionID = "+l.getSessionId()),u.trigger(d.KEY_SESSION_CREATED,{data:l})):(y(l),u.trigger(d.KEY_SESSION_CREATED,{data:null,error:new f.Z(h.KEY_SESSION_CREATED_ERROR_CODE,h.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session! Invalid Session ID ("+t+")")}))}).catch(function(e){y(l),u.trigger(d.KEY_SESSION_CREATED,{data:null,error:new f.Z(h.KEY_SESSION_CREATED_ERROR_CODE,h.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session ("+t+")! "+e.name)})})},removeKeySession:function(e){e.session.remove().then(function(){n.debug("DRM: Session removed.  SessionID = "+e.getSessionId()),u.trigger(d.KEY_SESSION_REMOVED,{data:e.getSessionId()})},function(t){u.trigger(d.KEY_SESSION_REMOVED,{data:null,error:"Error removing session ("+e.getSessionId()+"). "+t.name})})},closeKeySession:function(e){v(e).catch(function(t){y(e),u.trigger(d.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.getSessionId()+") "+t.name})})},stop:function(){for(var e,t=0;t<o.length;t++)(e=o[t]).getUsable()||(v(e),y(e))},reset:function(){var e,t=o.length;0!==t?function(){for(var n=function(e){y(e),0===o.length&&(r?(r.removeEventListener("encrypted",s),r.setMediaKeys(null).then(function(){u.trigger(d.TEARDOWN_COMPLETE)})):u.trigger(d.TEARDOWN_COMPLETE))},i=0;i<t;i++)(function(t){v(e),n(t)})(e=o[i])}():u.trigger(d.TEARDOWN_COMPLETE)}},n=p.getLogger(t),i=null,r=null,a=null,o=[],l=ie(c).getInstance(),s={handleEvent:function(e){if("encrypted"===e.type&&e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;u.trigger(d.NEED_KEY,{key:new ce(t,e.initDataType)})}}},t}he[x.PLAYREADY_KEYSTEM_STRING]=[x.PLAYREADY_KEYSTEM_STRING,x.PLAYREADY_RECOMMENDATION_KEYSTEM_STRING],he[x.WIDEVINE_KEYSTEM_STRING]=[x.WIDEVINE_KEYSTEM_STRING],he[x.CLEARKEY_KEYSTEM_STRING]=[x.CLEARKEY_KEYSTEM_STRING],fe.__dashjs_factory_name="ProtectionModel_21Jan2015";var pe=dashjs.FactoryMaker.getClassFactory(fe);function ge(e){e=e||{};var t,n,i,r,a,o,l,c,u,d=this.context,p=e.eventBus,g=e.events,m=e.debug,v=e.api;function y(){try{for(var e=0;e<l.length;e++)_(l[e]);i&&i.removeEventListener(v.needkey,c),p.trigger(g.TEARDOWN_COMPLETE)}catch(e){p.trigger(g.TEARDOWN_COMPLETE,{error:"Error tearing down key sessions and MediaKeys! -- "+e.message})}}function _(e){var t=e.session;t.removeEventListener(v.error,e),t.removeEventListener(v.message,e),t.removeEventListener(v.ready,e),t.removeEventListener(v.close,e);for(var n=0;n<l.length;n++)if(l[n]===e){l.splice(n,1);break}t[v.release]()}function E(){var e=null,t=function(){i.removeEventListener("loadedmetadata",e),i[v.setMediaKeys](a),p.trigger(g.VIDEO_ELEMENT_SELECTED)};i.readyState>=1?t():(e=t.bind(this),i.addEventListener("loadedmetadata",e))}return t={getAllInitData:function(){for(var e=[],t=0;t<l.length;t++)e.push(l[t].initData);return e},getSessions:function(){return l},requestKeySystemAccess:function(e){return new Promise(function(t,n){for(var i=!1,r=0;r<e.length;r++)for(var a=e[r].ks.systemString,o=e[r].configs,l=null,c=null,d=0;d<o.length;d++){var h=o[d].audioCapabilities,f=o[d].videoCapabilities;if(h&&0!==h.length){l=[];for(var m=0;m<h.length;m++)window[v.MediaKeys].isTypeSupported(a,h[m].contentType)&&l.push(h[m])}if(f&&0!==f.length){c=[];for(var y=0;y<f.length;y++)window[v.MediaKeys].isTypeSupported(a,f[y].contentType)&&c.push(f[y])}if(!(!l&&!c||l&&0===l.length||c&&0===c.length)){i=!0;var _=new s(l,c),E=u.getKeySystemBySystemString(a),b=new de(E,_);p.trigger(g.KEY_SYSTEM_ACCESS_COMPLETE,{data:b}),t({data:b});break}}if(!i){var T="Key system access denied! -- No valid audio/video content configurations detected!";p.trigger(g.KEY_SYSTEM_ACCESS_COMPLETE,{error:T}),n({error:T})}})},selectKeySystem:function(e){return new Promise(function(t,n){try{a=e.mediaKeys=new window[v.MediaKeys](e.keySystem.systemString),r=e.keySystem,o=e,i&&E(),t(r)}catch(e){n({error:"Error selecting keys system ("+r.systemString+")! Could not create MediaKeys -- TODO"})}})},setMediaElement:function(e){i!==e&&(i&&i.removeEventListener(v.needkey,c),(i=e)&&(i.addEventListener(v.needkey,c),a&&E()))},createKeySession:function(e){if(!r||!a||!o)throw new Error("Can not create sessions until you have selected a key system");var t=null;if(o.ksConfiguration.videoCapabilities&&o.ksConfiguration.videoCapabilities.length>0&&(t=o.ksConfiguration.videoCapabilities[0]),null===t&&o.ksConfiguration.audioCapabilities&&o.ksConfiguration.audioCapabilities.length>0&&(t=o.ksConfiguration.audioCapabilities[0]),null===t)throw new Error("Can not create sessions for unknown content types.");var i,s=t.contentType,c=a.createSession(s,new Uint8Array(e.initData),e.cdmData?new Uint8Array(e.cdmData):null),u={session:c,keyId:(i=e).keyId,initData:i.initData,getKeyId:function(){return this.keyId},getSessionId:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"},handleEvent:function(e){switch(e.type){case v.error:p.trigger(g.KEY_ERROR,{error:new f.Z(h.MEDIA_KEYERR_CODE,"KeyError",this)});break;case v.message:var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;p.trigger(g.INTERNAL_KEY_MESSAGE,{data:new ue(this,t,e.destinationURL)});break;case v.ready:n.debug("DRM: Key added."),p.trigger(g.KEY_ADDED);break;case v.close:n.debug("DRM: Session closed.  SessionID = "+this.getSessionId()),p.trigger(g.KEY_SESSION_CLOSED,{data:this.getSessionId()})}}};c.addEventListener(v.error,u),c.addEventListener(v.message,u),c.addEventListener(v.ready,u),c.addEventListener(v.close,u),l.push(u),n.debug("DRM: Session created.  SessionID = "+u.getSessionId()),p.trigger(g.KEY_SESSION_CREATED,{data:u})},updateKeySession:function(e,t){var n=e.session;u.isClearKey(r)?n.update(new Uint8Array(t.toJWK())):n.update(new Uint8Array(t)),p.trigger(g.KEY_SESSION_UPDATED)},closeKeySession:_,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:y,reset:y},n=m.getLogger(t),i=null,r=null,a=null,o=null,l=[],u=ie(d).getInstance(),c={handleEvent:function(e){if(e.type===v.needkey&&e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;p.trigger(g.NEED_KEY,{key:new ce(t,"cenc")})}}},t}ge.__dashjs_factory_name="ProtectionModel_3Feb2014";var me=dashjs.FactoryMaker.getClassFactory(ge);function ve(e){e=e||{};var t,n,i,r,a,o,l,c,u,d=this.context,p=e.eventBus,g=e.events,m=e.debug,v=e.api,y=e.errHandler;function _(){i&&T();for(var e=0;e<l.length;e++)E(l[e]);p.trigger(g.TEARDOWN_COMPLETE)}function E(e){try{i[v.cancelKeyRequest](r.systemString,e.sessionId)}catch(t){p.trigger(g.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.sessionId+") "+t.message})}}function b(e,t){if(t&&e){for(var n=e.length,i=0;i<n;i++)if(e[i].sessionId==t)return e[i];return null}return null}function T(){i.removeEventListener(v.keyerror,u),i.removeEventListener(v.needkey,u),i.removeEventListener(v.keymessage,u),i.removeEventListener(v.keyadded,u)}return t={getAllInitData:function(){for(var e=[],t=0;t<o.length;t++)e.push(o[t].initData);for(var n=0;n<l.length;n++)e.push(l[n].initData);return e},getSessions:function(){return l.concat(o)},requestKeySystemAccess:function(e){return new Promise(function(t,n){var r=i;r||(r=document.createElement("video"));for(var o=!1,l=0;l<e.length;l++)for(var c=e[l].ks.systemString,u=e[l].configs,d=null,h=0;h<u.length;h++){var f=u[h].videoCapabilities;if(f&&0!==f.length){d=[];for(var m=0;m<f.length;m++)""!==r.canPlayType(f[m].contentType,c)&&d.push(f[m])}if(d&&(!d||0!==d.length)){o=!0;var v=new s(null,d),y=a.getKeySystemBySystemString(c),_=new de(y,v);p.trigger(g.KEY_SYSTEM_ACCESS_COMPLETE,{data:_}),t({data:_});break}}if(!o){var E="Key system access denied! -- No valid audio/video content configurations detected!";p.trigger(g.KEY_SYSTEM_ACCESS_COMPLETE,{error:E}),n({error:E})}})},selectKeySystem:function(e){return r=e.keySystem,Promise.resolve(r)},setMediaElement:function(e){if(i!==e){if(i){T();for(var t=0;t<l.length;t++)E(l[t]);l=[]}(i=e)&&(i.addEventListener(v.keyerror,u),i.addEventListener(v.needkey,u),i.addEventListener(v.keymessage,u),i.addEventListener(v.keyadded,u),p.trigger(g.VIDEO_ELEMENT_SELECTED))}},createKeySession:function(e){if(!r)throw new Error("Can not create sessions until you have selected a key system");if(c||0===l.length){var t={sessionId:null,keyId:e.keyId,initData:e.initData,getKeyId:function(){return this.keyId},getSessionId:function(){return this.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}};return o.push(t),i[v.generateKeyRequest](r.systemString,new Uint8Array(e.initData)),t}throw new Error("Multiple sessions not allowed!")},updateKeySession:function(e,t){var n=e.sessionId;if(a.isClearKey(r))for(var o=0;o<t.keyPairs.length;o++)i[v.addKey](r.systemString,t.keyPairs[o].key,t.keyPairs[o].keyID,n);else i[v.addKey](r.systemString,new Uint8Array(t),new Uint8Array(e.initData),n);p.trigger(g.KEY_SESSION_UPDATED)},closeKeySession:E,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:_,reset:_},n=m.getLogger(t),i=null,r=null,o=[],l=[],a=ie(d).getInstance(),u={handleEvent:function(e){var t=null;switch(e.type){case v.needkey:var i=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;p.trigger(g.NEED_KEY,{key:new ce(i,"cenc")});break;case v.keyerror:if((t=b(l,e.sessionId))||(t=b(o,e.sessionId)),t){var r=h.MEDIA_KEYERR_CODE,a="";switch(e.errorCode.code){case 1:r=h.MEDIA_KEYERR_UNKNOWN_CODE,a+="MEDIA_KEYERR_UNKNOWN - "+h.MEDIA_KEYERR_UNKNOWN_MESSAGE;break;case 2:r=h.MEDIA_KEYERR_CLIENT_CODE,a+="MEDIA_KEYERR_CLIENT - "+h.MEDIA_KEYERR_CLIENT_MESSAGE;break;case 3:r=h.MEDIA_KEYERR_SERVICE_CODE,a+="MEDIA_KEYERR_SERVICE - "+h.MEDIA_KEYERR_SERVICE_MESSAGE;break;case 4:r=h.MEDIA_KEYERR_OUTPUT_CODE,a+="MEDIA_KEYERR_OUTPUT - "+h.MEDIA_KEYERR_OUTPUT_MESSAGE;break;case 5:r=h.MEDIA_KEYERR_HARDWARECHANGE_CODE,a+="MEDIA_KEYERR_HARDWARECHANGE - "+h.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE;break;case 6:r=h.MEDIA_KEYERR_DOMAIN_CODE,a+="MEDIA_KEYERR_DOMAIN - "+h.MEDIA_KEYERR_DOMAIN_MESSAGE}a+="  System Code = "+e.systemCode,p.trigger(g.KEY_ERROR,{error:new f.Z(r,a,t)})}else n.error("No session token found for key error");break;case v.keyadded:(t=b(l,e.sessionId))||(t=b(o,e.sessionId)),t?(n.debug("DRM: Key added."),p.trigger(g.KEY_ADDED,{data:t})):n.debug("No session token found for key added");break;case v.keymessage:if((c=null!==e.sessionId&&void 0!==e.sessionId)?!(t=b(l,e.sessionId))&&o.length>0&&(t=o.shift(),l.push(t),t.sessionId=e.sessionId,p.trigger(g.KEY_SESSION_CREATED,{data:t})):o.length>0&&(t=o.shift(),l.push(t),0!==o.length&&y.error(new f.Z(h.MEDIA_KEY_MESSAGE_ERROR_CODE,h.MEDIA_KEY_MESSAGE_ERROR_MESSAGE))),t){var s=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;t.keyMessage=s,p.trigger(g.INTERNAL_KEY_MESSAGE,{data:new ue(t,s,e.defaultURL)})}else n.warn("No session token found for key message")}}},t}ve.__dashjs_factory_name="ProtectionModel_01b";var ye=dashjs.FactoryMaker.getClassFactory(ve),_e=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],Ee=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}];function be(){var e,t=this.context;function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];if("function"==typeof e[i[Object.keys(i)[0]]])return i}return null}return e={createProtectionSystem:function(i){var r=null,a=ie(t).getInstance();a.setConfig({debug:i.debug,BASE64:i.BASE64,settings:i.settings}),a.initialize();var o,s,l,c,u,d,h=(s=(o=i).debug,l=s.getLogger(e),c=o.eventBus,u=o.errHandler,(d=o.videoModel?o.videoModel.getElement():null)&&void 0===d.onencrypted||d&&void 0===d.mediaKeys?n(d,Ee)?(l.info("EME detected on this user agent! (ProtectionModel_3Feb2014)"),me(t).create({debug:s,eventBus:c,events:o.events,api:n(d,Ee)})):n(d,_e)?(l.info("EME detected on this user agent! (ProtectionModel_01b)"),ye(t).create({debug:s,eventBus:c,errHandler:u,events:o.events,api:n(d,_e)})):(l.warn("No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!"),null):(l.info("EME detected on this user agent! (ProtectionModel_21Jan2015)"),pe(t).create({debug:s,eventBus:c,events:o.events})));return!r&&h&&(r=T(t).create({protectionModel:h,protectionKeyController:a,eventBus:i.eventBus,debug:i.debug,events:i.events,BASE64:i.BASE64,constants:i.constants,cmcdModel:i.cmcdModel,customParametersModel:i.customParametersModel,settings:i.settings}),i.capabilities.setEncryptedMediaSupported(!0)),r}}}be.__dashjs_factory_name="Protection";var Te=dashjs.FactoryMaker.getClassFactory(be);Te.events=le,Te.errors=h,dashjs.FactoryMaker.updateClassFactory(be.__dashjs_factory_name,Te);var Se=Te},2068:function(e,t,n){var i=n(5448),r={DEFAULT:.5,STRONG:1,WEAK:0};function a(e,t,n){var i,a,o;return i=void 0===e?-1:e,a=n,o=r.DEFAULT,a!==r.DEFAULT&&a!==r.STRONG&&a!==r.WEAK||(o=a),{quality:i,reason:void 0===t?null:t,priority:o}}a.__dashjs_factory_name="SwitchRequest";var o=i.Z.getClassFactory(a);o.NO_CHANGE=-1,o.PRIORITY=r,i.Z.updateClassFactory(a.__dashjs_factory_name,o),t.Z=o},1767:function(e,t,n){var i=n(5628),r=n(6535),a=n(7423),o=n(895),s=n(6070),l=n(3112),c=n(1914),u=n(5435),d=n(5448),h=n(2068),f=n(3393),p="qualitySwitchRules",g="abandonFragmentRules";function m(e){e=e||{};var t,n,d=this.context,m=e.mediaPlayerModel,v=e.customParametersModel,y=e.dashMetrics,_=e.settings;function E(e){return e.filter(function(e){return e.quality>h.Z.NO_CHANGE})}function b(e){var t,n,i,r,a,o={},s=null;if(0!==e.length){for(o[h.Z.PRIORITY.STRONG]={quality:h.Z.NO_CHANGE,reason:null},o[h.Z.PRIORITY.WEAK]={quality:h.Z.NO_CHANGE,reason:null},o[h.Z.PRIORITY.DEFAULT]={quality:h.Z.NO_CHANGE,reason:null},t=0,n=e.length;t<n;t+=1)(i=e[t]).quality!==h.Z.NO_CHANGE&&(o[i.priority].quality===h.Z.NO_CHANGE||o[i.priority].quality>i.quality)&&(o[i.priority].quality=i.quality,o[i.priority].reason=i.reason||null);return o[h.Z.PRIORITY.WEAK].quality!==h.Z.NO_CHANGE&&(s=o[h.Z.PRIORITY.WEAK]),o[h.Z.PRIORITY.DEFAULT].quality!==h.Z.NO_CHANGE&&(s=o[h.Z.PRIORITY.DEFAULT]),o[h.Z.PRIORITY.STRONG].quality!==h.Z.NO_CHANGE&&(s=o[h.Z.PRIORITY.STRONG]),s&&(r=s.quality,a=s.reason),(0,h.Z)(d).create(r,a)}}return{initialize:function(){t=[],n=[],_.get().streaming.abr.useDefaultABRRules&&(_.get().streaming.abr.ABRStrategy===f.Z.ABR_STRATEGY_L2A?t.push((0,c.Z)(d).create({dashMetrics:y,settings:_})):_.get().streaming.abr.ABRStrategy===f.Z.ABR_STRATEGY_LoLP?t.push((0,u.Z)(d).create({dashMetrics:y})):(t.push((0,l.Z)(d).create({dashMetrics:y,mediaPlayerModel:m,settings:_})),t.push((0,i.Z)(d).create({dashMetrics:y})),_.get().streaming.abr.additionalAbrRules.insufficientBufferRule&&t.push((0,r.Z)(d).create({dashMetrics:y,settings:_})),_.get().streaming.abr.additionalAbrRules.switchHistoryRule&&t.push((0,s.Z)(d).create()),_.get().streaming.abr.additionalAbrRules.droppedFramesRule&&t.push((0,o.Z)(d).create()),_.get().streaming.abr.additionalAbrRules.abandonRequestsRule&&n.push((0,a.Z)(d).create({dashMetrics:y,mediaPlayerModel:m,settings:_})))),v.getAbrCustomRules().forEach(function(e){e.type===p&&t.push(e.rule(d).create()),e.type===g&&n.push(e.rule(d).create())})},reset:function(){[t,n].forEach(function(e){e&&e.length&&e.forEach(function(e){return e.reset&&e.reset()})}),t=[],n=[]},getMaxQuality:function(e){return b(E(t.map(function(t){return t.getMaxIndex(e)})))||(0,h.Z)(d).create()},getMinSwitchRequest:b,shouldAbandonFragment:function(e,t){var i=b(E(n.map(function(n){return n.shouldAbandon(e,t)})));return i&&(i.reason.forceAbandon=!0),i||(0,h.Z)(d).create()},getQualitySwitchRules:function(){return t}}}m.__dashjs_factory_name="ABRRulesCollection";var v=d.Z.getClassFactory(m);v.QUALITY_SWITCH_RULES=p,v.ABANDON_FRAGMENT_RULES=g,d.Z.updateSingletonFactory(m.__dashjs_factory_name,v),t.Z=v},7423:function(e,t,n){var i=n(2068),r=n(5448),a=n(6398);function o(e){e=e||{};var t,n,r,s,l,c=this.context,u=e.mediaPlayerModel,d=e.dashMetrics,h=e.settings;function f(){r={},s={},l=[]}return t={shouldAbandon:function(e){var t=(0,i.Z)(c).create(i.Z.NO_CHANGE,{name:o.__dashjs_factory_name});if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getCurrentRequest")&&e.hasOwnProperty("getRepresentationInfo")&&e.hasOwnProperty("getAbrController")))return t;var a,f,p,g,m=e.getMediaInfo(),v=e.getMediaType(),y=e.getStreamInfo(),_=y?y.id:null,E=e.getCurrentRequest();if(!isNaN(E.index)){a=v,f=E.index,r[a]=r[a]||{},r[a][f]=r[a][f]||{};var b=u.getStableBufferTime();if(d.getCurrentBufferLevel(v)>b)return t;var T=r[v][E.index];if(null===T||null===E.firstByteDate||s.hasOwnProperty(T.id))return t;if(void 0===T.firstByteTime&&(l[v]=[],T.firstByteTime=E.firstByteDate.getTime(),T.segmentDuration=E.duration,T.bytesTotal=E.bytesTotal,T.id=E.index),T.bytesLoaded=E.bytesLoaded,T.elapsedTime=(new Date).getTime()-T.firstByteTime,T.bytesLoaded>0&&T.elapsedTime>0&&(p=v,g=Math.round(8*T.bytesLoaded/T.elapsedTime),l[p]=l[p]||[],l[p].push(g)),l[v].length>=h.get().streaming.abr.abrRulesParameters.abandonRequestsRule.minLengthToAverage&&T.elapsedTime>h.get().streaming.abr.abrRulesParameters.abandonRequestsRule.graceTimeThreshold&&T.bytesLoaded<T.bytesTotal){var S=l[v].reduce(function(e,t){return e+t},0);if(T.measuredBandwidthInKbps=Math.round(S/l[v].length),T.estimatedTimeOfDownload=+(8*T.bytesTotal/T.measuredBandwidthInKbps/1e3).toFixed(2),T.estimatedTimeOfDownload<T.segmentDuration*h.get().streaming.abr.abrRulesParameters.abandonRequestsRule.abandonMultiplier||0===e.getRepresentationInfo().quality)return t;if(!s.hasOwnProperty(T.id)){var w=e.getAbrController(),A=T.bytesTotal-T.bytesLoaded,R=w.getBitrateList(m),x=w.getQualityForBitrate(m,T.measuredBandwidthInKbps*h.get().streaming.abr.bandwidthSafetyFactor,_),I=w.getMinAllowedIndexFor(v,_),L=void 0!==I?Math.max(I,x):x;A>T.bytesTotal*R[L].bitrate/R[w.getQualityFor(v,_)].bitrate&&(t.quality=L,t.reason.throughput=T.measuredBandwidthInKbps,t.reason.fragmentID=T.id,t.reason.rule=this.getClassName(),s[T.id]=T,n.debug("["+v+"] frag id",T.id," is asking to abandon and switch to quality to ",L," measured bandwidth was",T.measuredBandwidthInKbps),delete r[v][T.id])}}else T.bytesLoaded===T.bytesTotal&&delete r[v][T.id]}return t},reset:f},n=(0,a.Z)(c).getInstance().getLogger(t),f(),t}o.__dashjs_factory_name="AbandonRequestsRule",t.Z=r.Z.getClassFactory(o)},3112:function(e,t,n){var i=n(3860),r=n(2068),a=n(5448),o=n(7855),s=n(5595),l=n(8512),c=n(6398),u=n(8825),d=n(3393),h=10;function f(e){e=e||{};var t,n,a,f=this.context,p=e.dashMetrics,g=e.mediaPlayerModel,m=(0,s.Z)(f).getInstance();function v(e,t,n){var i=n.reduce(function(e,t,i){return t>n[e]?i:e},0);if(0===i)return null;var r=Math.max(e,h+2*t.length),a=(n[i]-1)/(r/h-1);return{gp:a,Vp:h/a}}function y(e){e.placeholderBuffer=0,e.mostAdvancedSegmentStart=NaN,e.lastSegmentWasReplacement=!1,e.lastSegmentStart=NaN,e.lastSegmentDurationS=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN}function _(e,t){var n=g.getStableBufferTime();if(e.stableBufferTime!==n){var i=v(n,e.bitrates,e.utilities);if(i.Vp!==e.Vp||i.gp!==e.gp){var r=p.getCurrentBufferLevel(t),a=r+e.placeholderBuffer;a-=h,a*=i.Vp/e.Vp,a+=h,e.stableBufferTime=n,e.Vp=i.Vp,e.gp=i.gp,e.placeholderBuffer=Math.max(0,a-r)}}}function E(e,t){return e.Vp*(e.utilities[t]+e.gp)}function b(e,t){for(var n=e.bitrates[t],i=e.utilities[t],r=0,a=t-1;a>=0;--a)if(e.utilities[a]<e.utilities[t]){var o=e.bitrates[a],s=e.utilities[a],l=e.Vp*(e.gp+(n*s-o*i)/(n-o));r=Math.max(r,l)}return r}function T(e){var t=e.mediaType===d.Z.AUDIO?[d.Z.AUDIO]:a;for(var n in t)a.hasOwnProperty(n)&&2===a[n].state&&(a[n].placeholderBuffer=0)}function S(){for(var e in a)if(a.hasOwnProperty(e)){var t=a[e];0!==t.state&&(t.state=1,y(t))}}function w(e){if(e&&e.chunk&&e.chunk.mediaInfo){var t=a[e.chunk.mediaInfo.type];if(t&&0!==t.state){var n=e.chunk.start;isNaN(t.mostAdvancedSegmentStart)||n>t.mostAdvancedSegmentStart?(t.mostAdvancedSegmentStart=n,t.lastSegmentWasReplacement=!1):t.lastSegmentWasReplacement=!0,t.lastSegmentStart=n,t.lastSegmentDurationS=e.chunk.duration,t.lastQuality=e.chunk.quality,R(t,e.chunk.mediaInfo.type)}}}function A(e){if(e&&e.metric===i.Z.HTTP_REQUEST&&e.value&&e.value.type===o.w.MEDIA_SEGMENT_TYPE&&e.value.trace&&e.value.trace.length){var t=a[e.mediaType];t&&0!==t.state&&(t.lastSegmentRequestTimeMs=e.value.trequest.getTime(),t.lastSegmentFinishTimeMs=e.value._tfinish.getTime(),R(t,e.mediaType))}}function R(e,t){if(!isNaN(e.lastSegmentStart)&&!isNaN(e.lastSegmentRequestTimeMs)&&!isNaN(e.placeholderBuffer)){if(e.placeholderBuffer*=.99,!isNaN(e.lastSegmentFinishTimeMs)){var n=p.getCurrentBufferLevel(t)+.001*(e.lastSegmentFinishTimeMs-e.lastSegmentRequestTimeMs),i=E(e,e.lastQuality),r=Math.max(0,i-n);e.placeholderBuffer=Math.min(r,e.placeholderBuffer)}e.lastSegmentWasReplacement&&!isNaN(e.lastSegmentDurationS)&&(e.placeholderBuffer+=e.lastSegmentDurationS),e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN}}function x(e){if(e){var t=a[e.mediaType];t&&0!==t.state&&(t.abrQuality=e.newQuality)}}function I(e){if(e){var t=a[e.mediaType];if(t&&0!==t.state){var n,i=p.getCurrentBufferLevel(e.mediaType);n=t.abrQuality>0?b(t,t.abrQuality):h;var r=Math.max(0,n-i);t.placeholderBuffer=Math.min(t.placeholderBuffer,r)}}}function L(){a={}}return t={getMaxIndex:function(e){var t=(0,r.Z)(f).create();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getScheduleController")&&e.hasOwnProperty("getStreamInfo")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("useBufferOccupancyABR")))return t;var i=e.getMediaInfo(),o=e.getMediaType(),s=e.getScheduleController(),l=e.getStreamInfo(),c=e.getAbrController(),u=c.getThroughputHistory(),d=l?l.id:null,h=l&&l.manifestInfo&&l.manifestInfo.isDynamic,m=e.useBufferOccupancyABR();if(t.reason=t.reason||{},!m)return t;s.setTimeToLoadDelay(0);var T,S,w,A=(S=(T=e).getMediaType(),(w=a[S])?0!==w.state&&_(w,S):(w=function(e){var t={},n=e.getMediaInfo().bitrateList.map(function(e){return e.bandwidth}),i=n.map(function(e){return Math.log(e)});i=i.map(function(e){return e-i[0]+1});var r=g.getStableBufferTime(),a=v(r,n,i);return a?(t.state=1,t.bitrates=n,t.utilities=i,t.stableBufferTime=r,t.Vp=a.Vp,t.gp=a.gp,t.lastQuality=0,y(t)):t.state=0,t}(T),a[S]=w),w);if(0===A.state)return t;var R,x=p.getCurrentBufferLevel(o),I=u.getAverageThroughput(o,h),L=u.getSafeAverageThroughput(o,h),M=u.getAverageLatency(o);if(t.reason.state=A.state,t.reason.throughput=I,t.reason.latency=M,isNaN(I))return t;switch(A.state){case 1:R=c.getQualityForBitrate(i,L,d,M),t.quality=R,t.reason.throughput=L,A.placeholderBuffer=Math.max(0,b(A,R)-x),A.lastQuality=R,!isNaN(A.lastSegmentDurationS)&&x>=A.lastSegmentDurationS&&(A.state=2);break;case 2:(function(e,t){var n=Date.now();if(isNaN(e.lastSegmentFinishTimeMs)){if(!isNaN(e.lastCallTimeMs)){var i=.001*(n-e.lastCallTimeMs);e.placeholderBuffer+=Math.max(0,i)}}else{var r=.001*(n-e.lastSegmentFinishTimeMs);e.placeholderBuffer+=Math.max(0,r)}e.lastCallTimeMs=n,e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN,_(e,t)})(A,o),R=function(e,t){for(var n=e.bitrates.length,i=NaN,r=NaN,a=0;a<n;++a){var o=(e.Vp*(e.utilities[a]+e.gp)-t)/e.bitrates[a];(isNaN(r)||o>=r)&&(r=o,i=a)}return i}(A,x+A.placeholderBuffer);var C=c.getQualityForBitrate(i,L,d,M);R>A.lastQuality&&R>C&&(R=Math.max(C,A.lastQuality));var P=Math.max(0,x+A.placeholderBuffer-E(A,R));P<=A.placeholderBuffer?(A.placeholderBuffer-=P,P=0):(P-=A.placeholderBuffer,A.placeholderBuffer=0,R<c.getMaxAllowedIndexFor(o,d)?s.setTimeToLoadDelay(1e3*P):P=0),t.quality=R,t.reason.throughput=I,t.reason.latency=M,t.reason.bufferLevel=x,t.reason.placeholderBuffer=A.placeholderBuffer,t.reason.delay=P,A.lastQuality=R;break;default:n.debug("BOLA ABR rule invoked in bad state."),t.quality=c.getQualityForBitrate(i,L,d,M),t.reason.state=A.state,t.reason.throughput=L,t.reason.latency=M,A.state=1,y(A)}return t},reset:function(){L(),m.off(u.Z.BUFFER_EMPTY,T,t),m.off(u.Z.PLAYBACK_SEEKING,S,t),m.off(u.Z.METRIC_ADDED,A,t),m.off(u.Z.QUALITY_CHANGE_REQUESTED,x,t),m.off(u.Z.FRAGMENT_LOADING_ABANDONED,I,t),m.off(l.Z.MEDIA_FRAGMENT_LOADED,w,t)}},n=(0,c.Z)(f).getInstance().getLogger(t),L(),m.on(u.Z.BUFFER_EMPTY,T,t),m.on(u.Z.PLAYBACK_SEEKING,S,t),m.on(u.Z.METRIC_ADDED,A,t),m.on(u.Z.QUALITY_CHANGE_REQUESTED,x,t),m.on(u.Z.FRAGMENT_LOADING_ABANDONED,I,t),m.on(l.Z.MEDIA_FRAGMENT_LOADED,w,t),t}f.__dashjs_factory_name="BolaRule",t.Z=a.Z.getClassFactory(f)},895:function(e,t,n){var i=n(5448),r=n(2068),a=n(6398);function o(){var e,t,n=this.context;return e={getMaxIndex:function(e){var i=(0,r.Z)(n).create();if(!e||!e.hasOwnProperty("getDroppedFramesHistory"))return i;var a=e.getDroppedFramesHistory(),o=e.getStreamInfo().id;if(a){var s=a.getFrameHistory(o);if(!s||0===s.length)return i;for(var l=0,c=0,u=r.Z.NO_CHANGE,d=1;d<s.length;d++)if(s[d]&&(l=s[d].droppedVideoFrames,(c=s[d].totalVideoFrames)>375&&l/c>.15)){u=d-1,t.debug("index: "+u+" Dropped Frames: "+l+" Total Frames: "+c);break}return(0,r.Z)(n).create(u,{droppedFrames:l})}return i}},t=(0,a.Z)(n).getInstance().getLogger(e),e}o.__dashjs_factory_name="DroppedFramesRule",t.Z=i.Z.getClassFactory(o)},6535:function(e,t,n){var i=n(5595),r=n(8512),a=n(5448),o=n(6398),s=n(2068),l=n(3393),c=n(3860),u=n(8825);function d(e){e=e||{};var t,n,a,d=this.context,h=(0,i.Z)(d).getInstance(),f=e.dashMetrics;function p(){(a={})[l.Z.VIDEO]={ignoreCount:2},a[l.Z.AUDIO]={ignoreCount:2}}function g(){p()}function m(e){isNaN(e.startTime)||e.mediaType!==l.Z.AUDIO&&e.mediaType!==l.Z.VIDEO||a[e.mediaType].ignoreCount>0&&a[e.mediaType].ignoreCount--}return t={getMaxIndex:function(e){var t=(0,s.Z)(d).create();if(!e||!e.hasOwnProperty("getMediaType"))return t;!function(){if(!f||!f.hasOwnProperty("getCurrentBufferLevel")||!f.hasOwnProperty("getCurrentBufferState"))throw new Error(l.Z.MISSING_CONFIG_ERROR)}();var i,r,o=e.getMediaType(),u=f.getCurrentBufferState(o),h=e.getRepresentationInfo().fragmentDuration,p=e.getStreamInfo(),g=p?p.id:null,m=e.getScheduleController(),v=p&&p.manifestInfo&&p.manifestInfo.isDynamic;if(i=m.getPlaybackController().getLowLatencyModeEnabled(),r=o,!i&&a[r].ignoreCount>0||!h)return t;if(u&&u.state===c.Z.BUFFER_EMPTY)n.debug("["+o+"] Switch to index 0; buffer is empty."),t.quality=0,t.reason="InsufficientBufferRule: Buffer is empty";else{var y=e.getMediaInfo(),_=e.getAbrController(),E=_.getThroughputHistory(),b=f.getCurrentBufferLevel(o),T=E.getAverageThroughput(o,v),S=E.getAverageLatency(o),w=T*(b/h)*.5;t.quality=_.getQualityForBitrate(y,w,g,S),t.reason="InsufficientBufferRule: being conservative to avoid immediate rebuffering"}return t},reset:function(){p(),h.off(u.Z.PLAYBACK_SEEKING,g,t),h.off(r.Z.BYTES_APPENDED_END_FRAGMENT,m,t)}},n=(0,o.Z)(d).getInstance().getLogger(t),p(),h.on(u.Z.PLAYBACK_SEEKING,g,t),h.on(r.Z.BYTES_APPENDED_END_FRAGMENT,m,t),t}d.__dashjs_factory_name="InsufficientBufferRule",t.Z=a.Z.getClassFactory(d)},1914:function(e,t,n){var i=n(3860),r=n(2068),a=n(5448),o=n(7855),s=n(5595),l=n(8512),c=n(6398),u=n(3393);function d(e){e=e||{};var t,n,a,d,h=this.context,f=e.dashMetrics,p=(0,s.Z)(h).getInstance();function g(e){e.placeholderBuffer=0,e.mostAdvancedSegmentStart=NaN,e.lastSegmentWasReplacement=!1,e.lastSegmentStart=NaN,e.lastSegmentDurationS=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN,e.lastSegmentUrl=""}function m(){for(var e in n)if(n.hasOwnProperty(e)){var t=n[e];0!==t.state&&(t.state=1,g(t))}}function v(e){if(e&&e.chunk&&e.chunk.mediaInfo){var t=n[e.chunk.mediaInfo.type],i=a[e.chunk.mediaInfo.type];if(t&&0!==t.state){var r=e.chunk.start;isNaN(t.mostAdvancedSegmentStart)||r>t.mostAdvancedSegmentStart?(t.mostAdvancedSegmentStart=r,t.lastSegmentWasReplacement=!1):t.lastSegmentWasReplacement=!0,t.lastSegmentStart=r,t.lastSegmentDurationS=e.chunk.duration,t.lastQuality=e.chunk.quality,_(t,i)}}}function y(e){if(e&&e.metric===i.Z.HTTP_REQUEST&&e.value&&e.value.type===o.w.MEDIA_SEGMENT_TYPE&&e.value.trace&&e.value.trace.length){var t=n[e.mediaType],r=a[e.mediaType];t&&0!==t.state&&(t.lastSegmentRequestTimeMs=e.value.trequest.getTime(),t.lastSegmentFinishTimeMs=e.value._tfinish.getTime(),_(t,r))}}function _(e,t){isNaN(e.lastSegmentStart)||isNaN(e.lastSegmentRequestTimeMs)||(t.segment_request_start_s=.001*e.lastSegmentRequestTimeMs,t.segment_download_finish_s=.001*e.lastSegmentFinishTimeMs,e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN)}function E(e){if(e&&e.mediaType){var t=n[e.mediaType];t&&0!==t.state&&(t.abrQuality=e.newQuality)}}function b(e,t){if(e.length!==t.length)return-1;for(var n=0,i=0;i<e.length;i++)n+=e[i]*t[i];return n}function T(){n={},a={}}return t={getMaxIndex:function(e){var t,i=(0,r.Z)(h).create(),s=Math.pow(4,.99),l=Math.max(Math.pow(4,1),s*Math.sqrt(4)),c=e.getMediaInfo(),p=e.getMediaType(),m=c.bitrateList.map(function(e){return e.bandwidth}),v=m.length,y=e.getScheduleController(),_=e.getStreamInfo(),E=e.getAbrController(),T=E.getThroughputHistory(),S=_&&_.manifestInfo&&_.manifestInfo.isDynamic,w=e.useL2AABR(),A=f.getCurrentBufferLevel(p,!0),R=T.getSafeAverageThroughput(p,S),x=T.getAverageThroughput(p,S),I=T.getAverageLatency(p),L=e.getVideoModel().getPlaybackRate();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getScheduleController")&&e.hasOwnProperty("getStreamInfo")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("useL2AABR")&&(i.reason=i.reason||{},w&&p!==u.Z.AUDIO)))return i;y.setTimeToLoadDelay(0);var M,C,P,D,O,N,k,F=(N=(M=e).getMediaType(),(k=n[N])||(P={},D=M.getMediaInfo(),O=D.bitrateList.map(function(e){return e.bandwidth/1e3}),P.state=1,P.bitrates=O,P.lastQuality=0,(C=D)&&C.type&&(a[C.type]={},a[C.type].w=[],a[C.type].prev_w=[],a[C.type].Q=0,a[C.type].segment_request_start_s=0,a[C.type].segment_download_finish_s=0,a[C.type].B_target=1.5),g(P),k=P,n[N]=k),k);if(0===F.state)return i;var B=a[p];if(!B||(i.reason.state=F.state,i.reason.throughput=x,i.reason.latency=I,isNaN(x)))return i;switch(F.state){case 1:if(t=E.getQualityForBitrate(c,R,_.id,I),i.quality=t,i.reason.throughput=R,F.lastQuality=t,!isNaN(F.lastSegmentDurationS)&&A>=B.B_target){F.state=2,B.Q=s;for(var U=0;U<v;++U)U===F.lastQuality?B.prev_w[U]=1:B.prev_w[U]=0}break;case 2:var V=[],G=f.getCurrentHttpRequest(p).trace.reduce(function(e,t){return e+t.d},0),H=f.getCurrentHttpRequest(p).trace.reduce(function(e,t){return e+t.b[0]},0),j=Math.round(8*H/G),z=f.getCurrentHttpRequest(p);if(j<1&&(j=1),z.url===F.lastSegmentUrl||z.type===o.w.INIT_SEGMENT_TYPE)t=F.lastQuality;else{for(var Z=F.lastSegmentDurationS,q=1,W=0;W<v;++W)m[W]=m[W]/1e3,L*m[W]>j&&(q=-1),B.w[W]=B.prev_w[W]+q*(Z/(2*l))*((B.Q+s)*(L*m[W]/j));B.w=function(e){for(var t=e.length,n=!1,i=[],r=0;r<t;++r)i[r]=e[r];for(var a=e.sort(function(e,t){return t-e}),o=0,s=0,l=[],c=0;c<t-1;++c)if((s=((o+=a[c])-1)/(c+1))>=a[c+1]){n=!0;break}n||(s=(o+a[t-1]-1)/t);for(var u=0;u<t;++u)l[u]=Math.max(i[u]-s,0);return l}(B.w);for(var Y=0;Y<v;++Y)V[Y]=B.w[Y]-B.prev_w[Y],B.prev_w[Y]=B.w[Y];B.Q=Math.max(0,B.Q-Z+Z*L*((b(m,B.prev_w)+b(m,V))/j));for(var K=[],X=0;X<v;++X)K[X]=Math.abs(m[X]-b(B.w,m));(t=K.indexOf(Math.min.apply(Math,K)))>F.lastQuality&&m[F.lastQuality+1]<=j&&(t=F.lastQuality+1),m[t]>=j&&(B.Q=2*Math.max(s,B.Q)),F.lastSegmentUrl=z.url}i.quality=t,i.reason.throughput=x,i.reason.latency=I,i.reason.bufferLevel=A,F.lastQuality=i.quality;break;default:d.debug("L2A ABR rule invoked in bad state."),i.quality=E.getQualityForBitrate(c,R,_.id,I),i.reason.state=F.state,i.reason.throughput=R,i.reason.latency=I,F.state=1,g(F)}return i},reset:function(){T(),p.off(l.Z.PLAYBACK_SEEKING,m,t),p.off(l.Z.MEDIA_FRAGMENT_LOADED,v,t),p.off(l.Z.METRIC_ADDED,y,t),p.off(l.Z.QUALITY_CHANGE_REQUESTED,E,t)}},d=(0,c.Z)(h).getInstance().getLogger(t),T(),p.on(l.Z.PLAYBACK_SEEKING,m,t),p.on(l.Z.MEDIA_FRAGMENT_LOADED,v,t),p.on(l.Z.METRIC_ADDED,y,t),p.on(l.Z.QUALITY_CHANGE_REQUESTED,E,t),t}d.__dashjs_factory_name="L2ARule",t.Z=a.Z.getClassFactory(d)},6070:function(e,t,n){var i=n(5448),r=n(6398),a=n(2068);function o(){var e,t,n=this.context;return e={getMaxIndex:function(e){for(var i=e?e.getSwitchHistory():null,r=i?i.getSwitchRequests():[],o=0,s=0,l=0,c=(0,a.Z)(n).create(),u=0;u<r.length;u++)if(void 0!==r[u]&&(o+=r[u].drops,s+=r[u].noDrops,l+=r[u].dropSize,o+s>=6&&o/s>.075)){c.quality=u>0&&r[u].drops>0?u-1:u,c.reason={index:c.quality,drops:o,noDrops:s,dropSize:l},t.debug("Switch history rule index: "+c.quality+" samples: "+(o+s)+" drops: "+o);break}return c}},t=(0,r.Z)(n).getInstance().getLogger(e),e}o.__dashjs_factory_name="SwitchHistoryRule",t.Z=i.Z.getClassFactory(o)},5628:function(e,t,n){var i=n(5448),r=n(2068),a=n(3393),o=n(3860);function s(e){e=e||{};var t=this.context,n=e.dashMetrics;return{getMaxIndex:function(e){var i=(0,r.Z)(t).create();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("useBufferOccupancyABR")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("getScheduleController")))return i;!function(){if(!n||!n.hasOwnProperty("getCurrentBufferState"))throw new Error(a.Z.MISSING_CONFIG_ERROR)}();var s=e.getMediaInfo(),l=e.getMediaType(),c=n.getCurrentBufferState(l),u=e.getScheduleController(),d=e.getAbrController(),h=e.getStreamInfo(),f=h?h.id:null,p=h&&h.manifestInfo?h.manifestInfo.isDynamic:null,g=d.getThroughputHistory(),m=g.getSafeAverageThroughput(l,p),v=g.getAverageLatency(l),y=e.useBufferOccupancyABR();return isNaN(m)||!c||y||d.getAbandonmentStateFor(f,l)!==o.Z.ABANDON_LOAD&&(c.state===o.Z.BUFFER_LOADED||p)&&(i.quality=d.getQualityForBitrate(s,m,f,v),u.setTimeToLoadDelay(0),i.reason={throughput:m,latency:v}),i},reset:function(){}}}s.__dashjs_factory_name="ThroughputRule",t.Z=i.Z.getClassFactory(s)},4722:function(e,t,n){var i=n(5448),r=n(6398);function a(){var e,t,n,i,a,o,s,l,c,u=this.context;function d(){n=null,i=1,a=100,o=0,s=null,l=null,c="dynamic_weight_selection"}function h(){var e=0;if(n)for(var t=0;t<n.length;t++){var i=n[t];i.state.throughput>e&&(e=i.state.throughput)}return e}function f(e,t,n){var i=e.map(function(e,i){return n[i]*Math.pow(e-t[i],2)}).reduce(function(e,t){return e+t});return(i<0?-1:1)*Math.sqrt(Math.abs(i))}function p(e,t){return f([e.state.throughput,e.state.latency,e.state.rebuffer,e.state.switch],[t.state.throughput,t.state.latency,t.state.rebuffer,t.state.switch],[1,1,1,1])}function g(e,t,n){for(var i=0;i<t.length;i++){var r=t[i],a=p(r,e);m(r,n,Math.exp(-1*Math.pow(a,2)/(2*Math.pow(.1,2))))}}function m(e,t,n){var i=e.state,r=[.01,.01,.01,.01];i.throughput=i.throughput+(t[0]-i.throughput)*r[0]*n,i.latency=i.latency+(t[1]-i.latency)*r[1]*n,i.rebuffer=i.rebuffer+(t[2]-i.rebuffer)*r[2]*n,i.switch=i.switch+(t[3]-i.switch)*r[3]*n}return e={getNextQuality:function(e,r,u,d,p,m,v){var y=u,_=d,E=r,b=function(e){if(!n){n=[];var t=e.bitrateList,r=[];o=t[0].bandwidth,t.forEach(function(e){r.push(e.bandwidth),e.bandwidth<o&&(o=e.bandwidth)}),c=r.map(function(e){return Math.pow(e,2)}).reduce(function(e,t){return e+t}),i=Math.sqrt(c);for(var a=0;a<t.length;a++){var s={qualityIndex:a,bitrate:t[a].bandwidth,state:{throughput:t[a].bandwidth/i,latency:0,rebuffer:0,switch:0}};n.push(s)}l=function(e){var t=[],n=function(e){for(var t=[],n=0;n<e;n++){var i=[Math.random()*h(),Math.random(),Math.random(),Math.random()];t.push(i)}return t}(Math.pow(e.length,2));t.push(n[0]);for(var i=[1,1,1,1],r=1;r<e.length;r++){for(var a=null,o=null,s=0;s<n.length;s++){for(var l=n[s],c=null,u=0;u<t.length;u++){var d=f(l,t[u],i);(null===c||d<c)&&(c=d)}(null===o||c>o)&&(a=l,o=c)}t.push(a)}for(var p=null,g=null,m=0;m<t.length;m++){for(var v=0,y=0;y<t.length;y++)m!==y&&(v+=f(t[m],t[y],i));(null===p||v>p)&&(p=v,g=m)}var _=[];for(_.push(t[g]),t.splice(g,1);t.length>0;){for(var E=null,b=null,T=0;T<t.length;T++){var S=f(_[0],t[T],i);(null===E||S<E)&&(E=S,b=T)}_.push(t[b]),t.splice(b,1)}return _}(n)}var c;return n}(e),T=r/i;T>1&&(T=h()),u/=a,t.debug("getNextQuality called throughput:".concat(T," latency:").concat(u," bufferSize:").concat(d," currentQualityIndex:").concat(m," playbackRate:").concat(p));var S=b[m],w=S.bitrate*v.getSegmentDuration()/E,A=Math.max(0,w-_);if(_-w<v.getMinBuffer())return t.debug("Buffer is low for bitrate= ".concat(S.bitrate," downloadTime=").concat(w," currentBuffer=").concat(_," rebuffer=").concat(A)),function(e,t){var i=0,r=e;if(n)for(var a=0;a<n.length;a++){var o=n[a];o.bitrate<e.bitrate&&o.bitrate>i&&t>o.bitrate&&(i=o.bitrate,r=o)}return r}(S,E).qualityIndex;switch(c){case"manual_weight_selection":s=[.4,.4,.4,.4];break;case"random_weight_selection":s=function(e){for(var t=[],n=Math.sqrt(2/e),i=0;i<4;i++)t.push(Math.random()*n);return s=t}(b.length);break;default:!function(e,t,n,i,r,a,o){s||(s=l[l.length-1]);var c=e.findWeightVector(t,n,i,r,a,o);null!==c&&-1!==c&&(s=c)}(v,b,y,_,A,E,p)}for(var R=null,x=null,I=null,L=0;L<b.length;L++){var M=b[L],C=M.state,P=[C.throughput,C.latency,C.rebuffer,C.switch],D=s.slice(),O=v.getNextBufferWithBitrate(M.bitrate,_,E),N=O<v.getMinBuffer();N&&t.debug("Buffer is low for bitrate=".concat(M.bitrate," downloadTime=").concat(w," currentBuffer=").concat(_," nextBuffer=").concat(O)),(M.bitrate>r-1e4||N)&&M.bitrate!==o&&(D[0]=100);var k=f(P,[T,0,0,0],D);(null===R||k<R)&&(R=k,x=M.qualityIndex,I=M)}var F=Math.abs(S.bitrate-I.bitrate)/i;return g(S,b,[T,u,A,F]),g(I,b,[T,0,0,F]),x},reset:function(){d()}},t=(0,r.Z)(u).getInstance().getLogger(e),d(),e}a.__dashjs_factory_name="LearningAbrController",t.Z=i.Z.getClassFactory(a)},5317:function(e,t,n){var i=n(5448),r=n(2298);function a(){var e,t,n,i,a;function o(){t=null,n=null,i=null,a=null}function s(e,t,n,i){var a=new r.Z;return a.type=e,a.weights.bitrateReward=t||1,a.weights.bitrateSwitchPenalty=1,a.weights.rebufferPenalty=n||1e3,a.weights.latencyPenalty=[],a.weights.latencyPenalty.push({threshold:1.1,penalty:.05*i}),a.weights.latencyPenalty.push({threshold:1e8,penalty:.1*n}),a.weights.playbackSpeedPenalty=i||200,a}function l(e,t,n,i,r){r.bitrateWSum+=r.weights.bitrateReward*e,r.lastBitrate&&(r.bitrateSwitchWSum+=r.weights.bitrateSwitchPenalty*Math.abs(e-r.lastBitrate)),r.lastBitrate=e,r.rebufferWSum+=r.weights.rebufferPenalty*t;for(var a=0;a<r.weights.latencyPenalty.length;a++){var o=r.weights.latencyPenalty[a];if(n<=o.threshold){r.latencyWSum+=o.penalty*n;break}}r.playbackSpeedWSum+=r.weights.playbackSpeedPenalty*Math.abs(1-i),r.totalQoe=r.bitrateWSum-r.bitrateSwitchWSum-r.rebufferWSum-r.latencyWSum-r.playbackSpeedWSum}return e={setupPerSegmentQoe:function(e,r,o){t=s("segment",e,r,o),n=e,i=r,a=o},logSegmentMetrics:function(e,n,i,r){t&&l(e,n,i,r,t)},getPerSegmentQoe:function(){return t},calculateSingleUseQoe:function(e,t,r,o){var c=null;return n&&i&&a&&(c=s("segment",n,i,a)),c?(l(e,t,r,o,c),c.totalQoe):0},reset:function(){o()}},o(),e}a.__dashjs_factory_name="LoLpQoeEvaluator",t.Z=i.Z.getClassFactory(a)},5435:function(e,t,n){var i=n(6398),r=n(5448),a=n(4722),o=n(5317),s=n(2068),l=n(3860),c=n(6523),u=n(3393);function d(e){var t,n,r,d,h=(e=e||{}).dashMetrics,f=this.context;return n={getMaxIndex:function(e){try{var n=(0,s.Z)(f).create(),i=e.getMediaInfo().type,a=e.getAbrController(),o=e.getStreamInfo(),p=a.getQualityFor(i,o.id),g=e.getMediaInfo(),m=h.getCurrentBufferState(i),v=e.getScheduleController(),y=h.getCurrentBufferLevel(i,!0),_=o&&o.manifestInfo?o.manifestInfo.isDynamic:null,E=v.getPlaybackController(),b=E.getCurrentLiveLatency();if(!e.useLoLPABR()||i===u.Z.AUDIO)return n;b||(b=0);var T=E.getPlaybackRate(),S=a.getThroughputHistory().getSafeAverageThroughput(i,_);if(t.debug("Throughput ".concat(Math.round(S)," kbps")),isNaN(S)||!m||a.getAbandonmentStateFor(o.id,i)===l.Z.ABANDON_LOAD)return n;for(var w=g.bitrateList,A=e.getRepresentationInfo().fragmentDuration,R=w[0].bandwidth/1e3,x=w[w.length-1].bandwidth/1e3,I=0;I<w.length;I++){var L=w[I].bandwidth/1e3;L>x?x=L:L<R&&(R=L)}var M=w[p].bandwidth/1e3,C=h.getCurrentHttpRequest(i,!0),P=(C.tresponse.getTime()-C.trequest.getTime())/1e3,D=P>A?P-A:0;d.setupPerSegmentQoe(A,x,R),d.logSegmentMetrics(M,D,b,T);var O=(0,c.Z)(f).create({targetLatency:1.5,bufferMin:.3,segmentDuration:A,qoeEvaluator:d});return n.quality=r.getNextQuality(g,1e3*S,b,y,T,p,O),n.reason={throughput:S,latency:b},n.priority=s.Z.PRIORITY.STRONG,v.setTimeToLoadDelay(0),n.quality!==p&&t.debug("[TgcLearningRule]["+i+"] requesting switch to index: ",n.quality,"Average throughput",Math.round(S),"kbps"),n}catch(e){throw e}},reset:function(){r.reset(),d.reset()}},t=(0,i.Z)(f).getInstance().getLogger(n),r=(0,a.Z)(f).create(),d=(0,o.Z)(f).create(),n}d.__dashjs_factory_name="LoLPRule",t.Z=r.Z.getClassFactory(d)},6523:function(e,t,n){var i=n(5448);function r(e){var t,n,i,r,a=e.targetLatency,o=e.bufferMin,s=e.segmentDuration,l=e.qoeEvaluator;function c(){return s}function u(e,t){var n=c();return t>n?e-n:e+n-t}return t={getMinBuffer:function(){return o},getSegmentDuration:c,getNextBufferWithBitrate:function(e,t,n){return u(t,e*s/n)},getNextBuffer:u,findWeightVector:function(e,t,r,c,d,h){var f=null,p=null,g=null,m=Math.abs(t-i);return e.forEach(function(e){n.forEach(function(n){n[0];var i,c=n[1],v=n[2],y=(n[3],e.bitrate*s/d),_=u(r,y),E=(0===v?10:1/v)*Math.max(1e-5,y-_),b=(0===c?10:1/c)*e.state.latency,T=l.calculateSingleUseQoe(e.bitrate,E,b,h);(null===f||T>f)&&(i=_,!(t>a+m)&&i>=o)&&(f=T,p=n,g=e.bitrate)})}),null===p&&null===g&&(p=-1),i=t,p}},n=function e(t,n,i){if(i===n)return t;for(var a=t.length,o=0;o<a;o++)for(var s=t.shift(),l=0;l<r.length;l++)t.push(s.concat(r[l]));return e(t,n,i+1)}((r=[.2,.4,.6,.8,1]).map(function(e){return[e]}),4,1),i=0,t}r.__dashjs_factory_name="LoLpWeightSelector",t.Z=i.Z.getClassFactory(r)},2298:function(e,t){t.Z=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.type=null,this.lastBitrate=null,this.weights={},this.weights.bitrateReward=null,this.weights.bitrateSwitchPenalty=null,this.weights.rebufferPenalty=null,this.weights.latencyPenalty=null,this.weights.playbackSpeedPenalty=null,this.bitrateWSum=0,this.bitrateSwitchWSum=0,this.rebufferWSum=0,this.latencyWSum=0,this.playbackSpeedWSum=0,this.totalQoe=0}},7803:function(e,t,n){n.d(t,{Y:function(){return f}});var i=n(3393),r=n(1553),a=n(5448),o=n(2128),s=n(2594),l=n(7387),c=n(7417),u=n(9032),d=n(9326),h=n(7802),f=["http://dashif.org/thumbnail_tile","http://dashif.org/guidelines/thumbnail_tile"];function p(e){var t,n,a,p,g,m,v,y,_=this.context,E=e.adapter,b=e.baseURLController,T=e.streamInfo,S=e.timelineConverter,w=e.debug,A=e.eventBus,R=e.events,x=e.dashConstants,I=(0,s.Z)(_).getInstance();function L(e,t){var i,r,a=new o.Z;a.id=e.id,a.bitrate=e.bandwidth,a.width=e.width,a.height=e.height,a.tilesHor=1,a.tilesVert=1,e.essentialProperties&&e.essentialProperties.forEach(function(e){if(f.indexOf(e.schemeIdUri)>=0&&e.value){var t=e.value.split("x");2!==t.length||isNaN(t[0])||isNaN(t[1])||(a.tilesHor=parseInt(t[0],10),a.tilesVert=parseInt(t[1],10))}}),t?m.updateSegmentData(e).then(function(t){var n,i,r,o;n=a,r=[],o=function(e,t){var n,i,r,a,o=[],s=0;for(n=0,i=e.segments.length;n<i;n++)r=e.segments[n],(a=(0,l.TJ)(S,E.getIsDynamic(),t,r.startTime,r.duration,r.timescale,r.media,r.mediaRange,s))&&(o.push(a),a=null,s++);return o}(t,i=e),i.segments=o,n.segmentDuration=i.segments[0].duration,n.readThumbnail=function(e,t){var n=null;r.some(function(t){if(t.start<=e&&t.end>e)return n=t.url,!0}),n?t(n):i.segments.some(function(n){if(n.mediaStartTime<=e&&n.mediaStartTime+n.duration>e){var a=b.resolve(i.path);return v.load({method:"get",url:a.url,request:{range:n.mediaRange,responseType:"arraybuffer"},onload:function(e){var i=y.getSamplesInfo(e.target.response),a=new Blob([e.target.response.slice(i.sampleList[0].offset,i.sampleList[0].offset+i.sampleList[0].size)],{type:"image/jpeg"}),o=window.URL.createObjectURL(a);r.push({start:n.mediaStartTime,end:n.mediaStartTime+n.duration,url:o}),t&&t(o)}}),!0}})}}):(a.startNumber=e.startNumber,a.segmentDuration=e.segmentDuration,a.timescale=e.timescale,a.templateUrl=(i=e,(r=I.isRelative(i.media)?I.resolve(i.media,b.resolve(i.path).url):i.media)?(0,l.Aj)(r,i.id):"")),a.tilesHor>0&&a.tilesVert>0&&(a.widthPerTile=a.width/a.tilesHor,a.heightPerTile=a.height/a.tilesVert,n.push(a))}function M(){n=[],p=-1,g=null}return t={getTracks:function(){return n},addTracks:function(){if(T&&E&&(g=E.getMediaInfoForType(T,i.Z.IMAGE))){var e=E.getVoRepresentations(g);e&&e.length>0&&e.forEach(function(e){(e.segmentInfoType===r.Z.SEGMENT_TEMPLATE&&e.segmentDuration>0&&e.media||e.segmentInfoType===r.Z.SEGMENT_TIMELINE)&&L(e),e.segmentInfoType===r.Z.SEGMENT_BASE&&L(e,!0)}),n.length>0&&n.sort(function(e,t){return e.bitrate-t.bitrate})}},reset:M,setTrackByIndex:function(e){n&&0!==n.length&&(e>=n.length&&(e=n.length-1),p=e)},getCurrentTrack:function(){return p<0?null:n[p]},getCurrentTrackIndex:function(){return p},getThumbnailRequestForTime:function(e){for(var t,i=E.getVoRepresentations(g),r=0;r<i.length;r++)if(n[p].id===i[r].id){t=i[r];break}return a.getSegmentRequestForTime(g,t,e)}},M(),v=(0,u.Z)(_).create({}),y=(0,c.Z)(_).getInstance(),m=(0,h.Z)(_).create({events:R,eventBus:A,streamInfo:T,timelineConverter:S,dashConstants:x,dashMetrics:e.dashMetrics,segmentBaseController:e.segmentBaseController,type:i.Z.IMAGE}),(a=(0,d.Z)(_).create({streamInfo:T,type:i.Z.IMAGE,timelineConverter:S,segmentsController:m,baseURLController:b,debug:w,eventBus:A,events:R,dashConstants:x,urlUtils:I})).initialize(!!E&&E.getIsDynamic()),t}p.__dashjs_factory_name="ThumbnailTracks",t.Z=a.Z.getClassFactory(p)},7417:function(e,t,n){var i=n(6398),r=n(8260),a=n(5448),o=n(6934),s=n(9597);function l(){var e,t,n=this.context;function a(e){if(!e)return null;void 0===e.fileStart&&(e.fileStart=0);var t=o.parseBuffer(e),i=(0,r.Z)(n).create();return i.setData(t),i}function l(e,t){return e[t+3]>>>0|e[t+2]<<8>>>0|e[t+1]<<16>>>0|e[t]<<24>>>0}function c(e,t){return String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t])}return t={parse:a,findLastTopIsoBoxCompleted:function(e,t,n){if(void 0===n&&(n=0),!t||n+8>=t.byteLength)return new s.Z(0,!1);for(var i,r=t instanceof ArrayBuffer?new Uint8Array(t):t,a=0;n<r.byteLength;){var o=l(r,n),u=c(r,n+4);if(0===o)break;n+o<=r.byteLength&&(e.indexOf(u)>=0?i=new s.Z(n,!0,o):a=n+o),n+=o}return i||new s.Z(a,!1)},getMediaTimescaleFromMoov:function(e){var t=a(e),n=t?t.getBox("mdhd"):void 0;return n?n.timescale:NaN},getSamplesInfo:function(e){if(!e||0===e.byteLength)return{sampleList:[],lastSequenceNumber:NaN,totalDuration:NaN,numSequences:NaN};var t,n,i,r,o,s,l,c,u,d,h,f,p,g,m,v,y=a(e),_=y.getBoxes("moof"),E=y.getBoxes("mfhd");m=y.getBoxes("moof").length,g=E[E.length-1].sequence_number,n=0,o=[];var b=-1,T=-1;for(d=0;d<_.length;d++){var S=_[d],w=S.getChildBoxes("traf");for(c=0;c<w.length;c++){var A=w[c],R=A.getChildBox("tfhd"),x=A.getChildBox("tfdt");r=x.baseMediaDecodeTime;var I=A.getChildBoxes("trun"),L=A.getChildBoxes("subs");for(u=0;u<I.length;u++){var M=I[u];for(n=M.sample_count,p=(R.base_data_offset||0)+(M.data_offset||0),l=0;l<n;l++){t=void 0!==(s=M.samples[l]).sample_duration?s.sample_duration:R.default_sample_duration,i=void 0!==s.sample_size?s.sample_size:R.default_sample_size;var C={dts:r,cts:r+(void 0!==s.sample_composition_time_offset?s.sample_composition_time_offset:0),duration:t,offset:S.offset+p,size:i,subSizes:[i]};if(L)for(h=0;h<L.length;h++){var P=L[h];if(b<P.entry_count-1&&l>T&&(b++,T+=P.entries[b].sample_delta),l==T){C.subSizes=[];var D=P.entries[b];for(f=0;f<D.subsample_count;f++)C.subSizes.push(D.subsamples[f].subsample_size)}}o.push(C),p+=i,r+=t}}v=r-x.baseMediaDecodeTime}}return{sampleList:o,lastSequenceNumber:g,totalDuration:v,numSequences:m}},findInitRange:function(t){var n=null,i=a(t);if(!i)return n;var r=i.getBox("ftyp"),o=i.getBox("moov");return e.debug("Searching for initialization."),o&&o.isComplete&&(n=(r?r.offset:o.offset)+"-"+(o.offset+o.size-1),e.debug("Found the initialization.  Range: "+n)),n},parsePayload:function(e,t,n){if(void 0===n&&(n=0),!t||n+8>=t.byteLength)return new s.Z(0,!1);for(var i,r=t instanceof ArrayBuffer?new Uint8Array(t):t,a=0;n<r.byteLength;){var o=l(r,n),u=c(r,n+4);if(0===o)break;n+o<=r.byteLength&&(e.indexOf(u)>=0?i=new s.Z(n,!0,o,u):a=n+o),n+=o}return i||new s.Z(a,!1)}},e=(0,i.Z)(n).getInstance().getLogger(t),t}l.__dashjs_factory_name="BoxParser",t.Z=a.Z.getSingletonFactory(l)},1715:function(e,t,n){n.d(t,{B:function(){return s}});var i=n(5448),r=n(7803),a=n(3393),o=[{codec:"avc1",compatibleCodecs:["avc3"]},{codec:"avc3",compatibleCodecs:["avc1"]}];function s(){var e="ManagedMediaSource"in window,t="WebKitMediaSource"in window,n="MediaSource"in window;return e||t||n}function l(){var e,t,n;return e={setConfig:function(e){e&&e.settings&&(t=e.settings)},supportsMediaSource:s,supportsEncryptedMedia:function(){return n},supportsCodec:function(e,n){return n!==a.Z.AUDIO&&n!==a.Z.VIDEO?Promise.resolve(!0):(i=e,r=n,t.get().streaming.capabilities.useMediaCapabilitiesApi&&navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo&&(i.codec&&r===a.Z.AUDIO||r===a.Z.VIDEO&&i.codec&&i.width&&i.height&&i.bitrate&&i.framerate)?function(e,t){return new Promise(function(n){if(e&&e.codec){var i={type:"media-source"};i[t]={},i[t].contentType=e.codec,i[t].width=e.width,i[t].height=e.height,i[t].bitrate=parseInt(e.bitrate),i[t].framerate=parseFloat(e.framerate),navigator.mediaCapabilities.decodingInfo(i).then(function(e){n(e.supported)}).catch(function(){n(!1)})}else n(!1)})}(e,n):function(e){return new Promise(function(t){if(e&&e.codec){var n=e.codec;e.width&&e.height&&(n+=';width="'+e.width+'";height="'+e.height+'"'),"ManagedMediaSource"in window&&ManagedMediaSource.isTypeSupported(n)||"MediaSource"in window&&MediaSource.isTypeSupported(n)||"WebKitMediaSource"in window&&WebKitMediaSource.isTypeSupported(n)?t(!0):t(!1)}else t(!1)})}(e));var i,r},setEncryptedMediaSupported:function(e){n=e},supportsEssentialProperty:function(e){try{return-1!==r.Y.indexOf(e.schemeIdUri)||a.Z.FONT_DOWNLOAD_DVB_SCHEME===e.schemeIdUri}catch(e){return!0}},codecRootCompatibleWithCodec:function(e,t){for(var n,i=e.split(".")[0],r=0===t.indexOf(i),a=0;a<o.length;a++)if(o[a].codec===i){n=o[a];break}return n?r||n.compatibleCodecs.some(function(e){return 0===t.indexOf(e)}):r}},n=!1,e}l.__dashjs_factory_name="Capabilities",t.Z=i.Z.getSingletonFactory(l)},2295:function(e,t,n){var i=n(5448),r=n(3106);function a(){return{customTimeRangeArray:[],length:0,add:function(e,t){var n;for(n=0;n<this.customTimeRangeArray.length&&e>this.customTimeRangeArray[n].start;n++);for(this.customTimeRangeArray.splice(n,0,{start:e,end:t}),n=0;n<this.customTimeRangeArray.length-1;n++)this.mergeRanges(n,n+1)&&n--;this.length=this.customTimeRangeArray.length},clear:function(){this.customTimeRangeArray=[],this.length=0},remove:function(e,t){for(var n=0;n<this.customTimeRangeArray.length;n++)if(e<=this.customTimeRangeArray[n].start&&t>=this.customTimeRangeArray[n].end)this.customTimeRangeArray.splice(n,1),n--;else{if(e>this.customTimeRangeArray[n].start&&t<this.customTimeRangeArray[n].end){this.customTimeRangeArray.splice(n+1,0,{start:t,end:this.customTimeRangeArray[n].end}),this.customTimeRangeArray[n].end=e;break}e>this.customTimeRangeArray[n].start&&e<this.customTimeRangeArray[n].end?this.customTimeRangeArray[n].end=e:t>this.customTimeRangeArray[n].start&&t<this.customTimeRangeArray[n].end&&(this.customTimeRangeArray[n].start=t)}this.length=this.customTimeRangeArray.length},mergeRanges:function(e,t){var n=this.customTimeRangeArray[e],i=this.customTimeRangeArray[t];return n.start<=i.start&&i.start<=n.end&&n.end<=i.end?(n.end=i.end,this.customTimeRangeArray.splice(t,1),!0):i.start<=n.start&&n.start<=i.end&&i.end<=n.end?(n.start=i.start,this.customTimeRangeArray.splice(t,1),!0):i.start<=n.start&&n.start<=i.end&&n.end<=i.end?(this.customTimeRangeArray.splice(e,1),!0):n.start<=i.start&&i.start<=n.end&&i.end<=n.end&&(this.customTimeRangeArray.splice(t,1),!0)},start:function(e){return(0,r.SE)(e),e>=this.customTimeRangeArray.length||e<0?NaN:this.customTimeRangeArray[e].start},end:function(e){return(0,r.SE)(e),e>=this.customTimeRangeArray.length||e<0?NaN:this.customTimeRangeArray[e].end}}}a.__dashjs_factory_name="CustomTimeRanges",t.Z=i.Z.getClassFactory(a)},5:function(e,t,n){var i=n(5448);function r(){var e,t=/^[a-z][a-z0-9+\-_.]*:/i,n=/^https?:\/\//i,i=/^https:\/\//i,r=/^([a-z][a-z0-9+\-_.]*:\/\/[^\/]+)\/?/i,a=function(e,t){try{return new window.URL(e,t).toString()}catch(t){return e}},o=function(e,t){var n=s;if(!t||!u(e))return e;d(e)&&(n=l),h(e)&&(n=c);var i=n(t),r="/"!==i.charAt(i.length-1)&&"/"!==e.charAt(0)?"/":"";return[i,e].join(r)};function s(e){var t=e.indexOf("/"),n=e.lastIndexOf("/");return-1!==t?n===t+1?e:(-1!==e.indexOf("?")&&(e=e.substring(0,e.indexOf("?"))),e.substring(0,n+1)):""}function l(e){var t=e.match(r);return t?t[1]:""}function c(e){var n=e.match(t);return n?n[0]:""}function u(e){return!t.test(e)}function d(e){return u(e)&&"/"===e.charAt(0)}function h(e){return 0===e.indexOf("//")}return function(){try{new window.URL("x","http://y"),e=a}catch(e){}finally{e=e||o}}(),{parseBaseUrl:s,parseOrigin:l,parseScheme:c,isRelative:u,isPathAbsolute:d,isSchemeRelative:h,isHTTPURL:function(e){return n.test(e)},isHTTPS:function(e){return i.test(e)},removeHostname:function(e){return/^(?:\w+\:\/\/)?([^\/]+)(.*)$/.exec(e)[2].substring(1)},resolve:function(t,n){return e(t,n)}}}r.__dashjs_factory_name="DefaultURLUtils",t.Z=i.Z.getSingletonFactory(r)},8260:function(e,t,n){var i=n(2839),r=n(5448);function a(){var e;function t(t){var i=[];if(!t||!e||"function"!=typeof e.fetchAll)return i;for(var r,a=e.fetchAll(t),o=0,s=a.length;o<s;o++)(r=n(a[o]))&&i.push(r);return i}function n(e){if(!e)return null;var t=new i.Z(e);return e.hasOwnProperty("_incomplete")&&(t.isComplete=!e._incomplete),t}return{getBox:function(t){return t&&e&&e.boxes&&0!==e.boxes.length&&"function"==typeof e.fetch?n(e.fetch(t)):null},getBoxes:t,setData:function(t){e=t},getLastBox:function(){if(!e||!e.boxes||!e.boxes.length)return null;var n=t(e.boxes[e.boxes.length-1].type);return n.length>0?n[n.length-1]:null}}}a.__dashjs_factory_name="IsoFile",t.Z=r.Z.getClassFactory(a)},7473:function(e,t,n){n.d(t,{k:function(){return r}});var i=n(5448);function r(e,t){var n={url:e.url,method:e.method,headers:Object.assign({},e.headers),credentials:e.withCredentials?"include":void 0,range:e.request.range};return Promise.resolve(t.modifyRequest(n)).then(function(){return Object.assign(e,n,{withCredentials:"include"===n.credentials})})}function a(){return{modifyRequest:null,modifyRequestURL:function(e){return e},modifyRequestHeader:function(e,t){return t.url,e}}}a.__dashjs_factory_name="RequestModifier",t.Z=i.Z.getSingletonFactory(a)},3106:function(e,t,n){n.d(t,{PS:function(){return a},SE:function(){return o}});var i=n(3393);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){if(r(e)!==t)throw i.Z.BAD_ARGUMENT_ERROR}function o(e){if(null===e||isNaN(e)||e%1!=0)throw i.Z.BAD_ARGUMENT_ERROR+" : argument is not an integer"}},2594:function(e,t,n){var i=n(5448),r=n(5);function a(){var e,t=[],n=this.context;function i(n,i,r){var a=function(n){var i;for(i=0;i<t.length;i++)if(t[i].regex.test(n))return t[i].utils;return e}(r||i);return a&&"function"==typeof a[n]?a[n](i,r):e[n](i,r)}return e=(0,r.Z)(n).getInstance(),{registerUrlRegex:function(e,n){t.push({regex:e,utils:n})},parseBaseUrl:function(e){return i("parseBaseUrl",e)},parseOrigin:function(e){return i("parseOrigin",e)},parseScheme:function(e){return i("parseScheme",e)},isRelative:function(e){return i("isRelative",e)},isPathAbsolute:function(e){return i("isPathAbsolute",e)},isSchemeRelative:function(e){return i("isSchemeRelative",e)},isHTTPURL:function(e){return i("isHTTPURL",e)},isHTTPS:function(e){return i("isHTTPS",e)},removeHostname:function(e){return i("removeHostname",e)},resolve:function(e,t){return i("resolve",e,t)}}}a.__dashjs_factory_name="URLUtils";var o=i.Z.getSingletonFactory(a);t.Z=o},5459:function(e,t){t.Z=function e(t,n,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.code=t||null,this.message=n||null,this.data=i||null}},3186:function(e,t,n){var i=n(7855);function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.action=e.ACTION_DOWNLOAD,this.startTime=NaN,this.mediaStartTime=NaN,this.mediaType=null,this.mediaInfo=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=t||null,this.serviceLocation=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null,this.bytesLoaded=NaN,this.bytesTotal=NaN,this.delayLoadingTime=NaN,this.responseType="arraybuffer",this.representationId=null}var t;return(t=[{key:"isInitializationRequest",value:function(){return this.type&&this.type===i.w.INIT_SEGMENT_TYPE}},{key:"setInfo",value:function(e){this.type=e&&e.init?i.w.INIT_SEGMENT_TYPE:i.w.MEDIA_SEGMENT_TYPE,this.url=e&&e.url?e.url:null,this.range=e&&e.range?e.range.start+"-"+e.range.end:null,this.mediaType=e&&e.mediaType?e.mediaType:null}}])&&r(e.prototype,t),e}();a.ACTION_DOWNLOAD="download",a.ACTION_COMPLETE="complete",t.Z=a},2839:function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var i=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.offset=t._offset,this.type=t.type,this.size=t.size,this.boxes=[],t.boxes)for(var n=0;n<t.boxes.length;n++)this.boxes.push(new e(t.boxes[n]));switch(this.isComplete=!0,t.type){case"sidx":if(this.timescale=t.timescale,this.earliest_presentation_time=t.earliest_presentation_time,this.first_offset=t.first_offset,this.references=t.references,t.references){this.references=[];for(var i=0;i<t.references.length;i++){var r={reference_type:t.references[i].reference_type,referenced_size:t.references[i].referenced_size,subsegment_duration:t.references[i].subsegment_duration};this.references.push(r)}}break;case"emsg":this.id=t.id,this.version=1===t.version?1:0,this.value=t.value,this.timescale=t.timescale,this.scheme_id_uri=t.scheme_id_uri,this.presentation_time_delta=1===t.version?t.presentation_time:t.presentation_time_delta,this.event_duration=t.event_duration,this.message_data=t.message_data;break;case"mdhd":this.timescale=t.timescale;break;case"mfhd":this.sequence_number=t.sequence_number;break;case"subs":this.entry_count=t.entry_count,this.entries=t.entries;break;case"tfhd":this.base_data_offset=t.base_data_offset,this.sample_description_index=t.sample_description_index,this.default_sample_duration=t.default_sample_duration,this.default_sample_size=t.default_sample_size,this.default_sample_flags=t.default_sample_flags,this.flags=t.flags;break;case"tfdt":this.version=t.version,this.baseMediaDecodeTime=t.baseMediaDecodeTime,this.flags=t.flags;break;case"trun":if(this.sample_count=t.sample_count,this.first_sample_flags=t.first_sample_flags,this.data_offset=t.data_offset,this.flags=t.flags,this.samples=t.samples,t.samples){this.samples=[];for(var a=0,o=t.samples.length;a<o;a++){var s={sample_size:t.samples[a].sample_size,sample_duration:t.samples[a].sample_duration,sample_composition_time_offset:t.samples[a].sample_composition_time_offset};this.samples.push(s)}}break;case"prft":this.version=t.version,this.reference_track_ID=t.reference_track_ID,this.ntp_timestamp_sec=t.ntp_timestamp_sec,this.ntp_timestamp_frac=t.ntp_timestamp_frac,this.media_time=t.media_time,this.flags=t.flags}}var t;return(t=[{key:"getChildBox",value:function(e){for(var t=0;t<this.boxes.length;t++)if(this.boxes[t].type===e)return this.boxes[t]}},{key:"getChildBoxes",value:function(e){for(var t=[],n=0;n<this.boxes.length;n++)this.boxes[n].type===e&&t.push(this.boxes[n]);return t}}])&&n(e.prototype,t),e}();t.Z=i},9597:function(e,t){t.Z=function e(t,n,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.lastCompletedOffset=t,this.found=n,this.size=i}},2128:function(e,t){t.Z=function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.bitrate=0,this.width=0,this.height=0,this.tilesHor=0,this.tilesVert=0,this.widthPerTile=0,this.heightPerTile=0,this.startNumber=0,this.segmentDuration=0,this.timescale=0,this.templateUrl="",this.id=""}},7855:function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,{O:function(){return a},w:function(){return r}});var r=function e(){i(this,e),this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.responsecode=null,this.interval=null,this.trace=[],this.cmsd=null,this._stream=null,this._tfinish=null,this._mediaduration=null,this._quality=null,this._responseHeaders=null,this._serviceLocation=null,this._fileLoaderType=null},a=function e(){i(this,e),this.s=null,this.d=null,this.b=[]};r.GET="GET",r.HEAD="HEAD",r.MPD_TYPE="MPD",r.XLINK_EXPANSION_TYPE="XLinkExpansion",r.INIT_SEGMENT_TYPE="InitializationSegment",r.INDEX_SEGMENT_TYPE="IndexSegment",r.MEDIA_SEGMENT_TYPE="MediaSegment",r.BITSTREAM_SWITCHING_SEGMENT_TYPE="BitstreamSwitchingSegment",r.MSS_FRAGMENT_INFO_SEGMENT_TYPE="FragmentInfoSegment",r.DVB_REPORTING_TYPE="DVBReporting",r.LICENSE="license",r.CONTENT_STEERING_TYPE="ContentSteering",r.OTHER_TYPE="other"},3039:function(e,t){function n(e,t){return function(n,r){for(var a,o,s,l=i(n,"tag"),c=i(null!=r?r:"*","range"),u=[],d=-1;++d<c.length;)if(a=c[d].toLowerCase(),t||"*"!==a){for(o=-1,s=[];++o<l.length;)if(e(l[o].toLowerCase(),a)){if(!t)return l[o];u.push(l[o])}else s.push(l[o]);l=s}return t?u:void 0}}function i(e,t){var n=e&&"string"==typeof e?[e]:e;if(!n||"object"!=typeof n||!("length"in n))throw new Error("Invalid "+t+" `"+n+"`, expected non-empty string");return n}t.basicFilter=n(function(e,t){return"*"===t||e===t||e.indexOf(t+"-")>-1},!0),t.extendedFilter=n(function(e,t){var n=e.split("-"),i=t.split("-"),r=0,a=0;if("*"!==i[a]&&n[r]!==i[a])return!1;for(r++,a++;a<i.length;)if("*"!==i[a]){if(!n[r])return!1;if(n[r]!==i[a]){if(1===n[r].length)return!1;r++}else r++,a++}else a++;return!0},!0),t.lookup=n(function(e,t){for(var n,i=t;;){if("*"===i||e===i)return!0;if((n=i.lastIndexOf("-"))<0)return!1;"-"===i.charAt(n-2)&&(n-=2),i=i.slice(0,n)}})},3973:function(e,t,n){e.exports=n(3854)},3854:function(e,t,n){var i=n(2415),r=n(3039),a=n(7778),o=n(5813),s=n(3165),l=n(9460);e.exports=function(e,t){var n,u=t||{},m=i.parse(String(e||"").toLowerCase(),u),v=i.stringify(m),y=-1;if(!v)return v;for(;++y<a.length;)r.extendedFilter(v,a[y].from).length&&(h(m,a[y].from,a[y].to),v=i.stringify(m));for(y=-1;++y<o.length;)f(m,o[y].from.field,o[y].from.value)&&p(m,o[y].to.field,o[y].to.value);for(v=i.stringify(Object.assign({},m,d)),y=-1;++y<s.length;)v===s[y]&&(h(m,s[y],s[y].split("-").slice(0,-1).join("-")),v=i.stringify(Object.assign({},m,d)));if(m.extensions.sort(g),u.warning)for(n in l)c.call(l[n],m[n])&&u.warning("Deprecated "+n+" `"+m[n]+"`, expected one of `"+l[n][m[n]].join("`, `")+"`",null,7);return m.script&&(m.script=m.script.charAt(0).toUpperCase()+m.script.slice(1)),m.region&&(m.region=m.region.toUpperCase()),i.stringify(m)};var c={}.hasOwnProperty,u=new Intl.Collator,d={variants:[],extensions:[],privateuse:[],irregular:null,regular:null};function h(e,t,n){var r,a=i.parse(t),o=i.parse(n),s=[];for(r in a)a[r]&&a[r].length&&f(e,r,a[r])&&s.push(r);for(r in o)o[r]&&o[r].length&&(s.indexOf(r)>-1||!e[r]||!e[r].length)&&p(e,r,o[r])}function f(e,t,n){var i,r,a,o,s=!1;if(n){if(r=i=e[t],i&&"object"==typeof i)for(r=[],a=-1;++a<i.length;)o=i[a],n.indexOf(o)<0?r.push(o):s=!0;else i===n&&(r=null,s=!0);e[t]=r}return s}function p(e,t,n){var i,r,a,o=e[t];if(o&&"object"==typeof o)for(i=[].concat(n),r=-1;++r<i.length;)a=i[r],o.indexOf(a)<0&&o.push(a);else e[t]=n}function g(e,t){return u.compare(e.singleton,t.singleton)}},2415:function(e,t,n){t.parse=n(6903),t.stringify=n(6713)},6903:function(e,t,n){var i=n(2219),r=n(3516),a=n(395),o=n(858),s=n(8589);e.exports=function e(t,n){var c,u,d,h=n||{},f={language:null,extendedLanguageSubtags:[],script:null,region:null,variants:[],extensions:[],privateuse:[],irregular:null,regular:null},p=String(t),g=p.toLowerCase(),m=0;if(null==t)throw new Error("Expected string, got `"+t+"`");if(l.call(s,g))return(null==h.normalize||h.normalize)&&s[g]?e(s[g]):(f[-1===o.indexOf(g)?"irregular":"regular"]=p,f);for(;r(g.charCodeAt(m))&&m<9;)m++;if(m>1&&m<9){if(f.language=p.slice(0,m),m<4)for(u=0;45===g.charCodeAt(m)&&r(g.charCodeAt(m+1))&&r(g.charCodeAt(m+2))&&r(g.charCodeAt(m+3))&&!r(g.charCodeAt(m+4));){if(u>2)return v(m,3,"Too many extended language subtags, expected at most 3 subtags");f.extendedLanguageSubtags.push(p.slice(m+1,m+4)),m+=4,u++}for(45===g.charCodeAt(m)&&r(g.charCodeAt(m+1))&&r(g.charCodeAt(m+2))&&r(g.charCodeAt(m+3))&&r(g.charCodeAt(m+4))&&!r(g.charCodeAt(m+5))&&(f.script=p.slice(m+1,m+5),m+=5),45===g.charCodeAt(m)&&(r(g.charCodeAt(m+1))&&r(g.charCodeAt(m+2))&&!r(g.charCodeAt(m+3))?(f.region=p.slice(m+1,m+3),m+=3):a(g.charCodeAt(m+1))&&a(g.charCodeAt(m+2))&&a(g.charCodeAt(m+3))&&!a(g.charCodeAt(m+4))&&(f.region=p.slice(m+1,m+4),m+=4));45===g.charCodeAt(m);){for(d=c=m+1;i(g.charCodeAt(d));){if(d-c>7)return v(d,1,"Too long variant, expected at most 8 characters");d++}if(!(d-c>4||d-c>3&&a(g.charCodeAt(c))))break;f.variants.push(p.slice(c,d)),m=d}for(;45===g.charCodeAt(m)&&120!==g.charCodeAt(m+1)&&i(g.charCodeAt(m+1))&&45===g.charCodeAt(m+2)&&i(g.charCodeAt(m+3));){for(d=m+2,u=0;45===g.charCodeAt(d)&&i(g.charCodeAt(d+1))&&i(g.charCodeAt(d+2));)for(d=(c=d+1)+2,u++;i(g.charCodeAt(d));){if(d-c>7)return v(d,2,"Too long extension, expected at most 8 characters");d++}if(!u)return v(d,4,"Empty extension, extensions must have at least 2 characters of content");f.extensions.push({singleton:p.charAt(m+1),extensions:p.slice(m+3,d).split("-")}),m=d}}else m=0;if(0===m&&120===g.charCodeAt(m)||45===g.charCodeAt(m)&&120===g.charCodeAt(m+1))for(d=m=m?m+2:1;45===g.charCodeAt(d)&&i(g.charCodeAt(d+1));){for(d=c=m+1;i(g.charCodeAt(d));){if(d-c>7)return v(d,5,"Too long private-use area, expected at most 8 characters");d++}f.privateuse.push(p.slice(m+1,d)),m=d}return m!==p.length?v(m,6,"Found superfluous content after tag"):f;function v(e,t,n){return h.warning&&h.warning(n,t,e),h.forgiving?f:{language:null,extendedLanguageSubtags:[],script:null,region:null,variants:[],extensions:[],privateuse:[],irregular:null,regular:null}}};var l={}.hasOwnProperty},6713:function(e){e.exports=function(e){var t,n,i,r=e||{},a=[];if(r.irregular||r.regular)return r.irregular||r.regular;if(r.language)for(a=a.concat(r.language,r.extendedLanguageSubtags||[],r.script||[],r.region||[],r.variants||[]),t=r.extensions||[],n=-1;++n<t.length;)(i=t[n]).singleton&&i.extensions&&i.extensions.length&&(a=a.concat(i.singleton,i.extensions));return r.privateuse&&r.privateuse.length&&(a=a.concat("x",r.privateuse)),a.join("-")}},1549:function(e,t,n){var i=n(6693),r=n(2165),a="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=l,t.SlowBuffer=function(e){return+e!=e&&(e=0),l.alloc(+e)},t.INSPECT_MAX_BYTES=50;var o=2147483647;function s(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,l.prototype),t}function l(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return d(e)}return c(e,t,n)}function c(e,t,n){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|g(e,t),i=s(n),r=i.write(e,t);return r!==n&&(i=i.slice(0,r)),i}(e,t);if(ArrayBuffer.isView(e))return function(e){if(G(e,Uint8Array)){var t=new Uint8Array(e);return f(t.buffer,t.byteOffset,t.byteLength)}return h(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(G(e,ArrayBuffer)||e&&G(e.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(G(e,SharedArrayBuffer)||e&&G(e.buffer,SharedArrayBuffer)))return f(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return l.from(i,t,n);var r=function(e){if(l.isBuffer(e)){var t=0|p(e.length),n=s(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||H(e.length)?s(0):h(e):"Buffer"===e.type&&Array.isArray(e.data)?h(e.data):void 0}(e);if(r)return r;if(typeof Symbol<"u"&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function d(e){return u(e),s(e<0?0:0|p(e))}function h(e){for(var t=e.length<0?0:0|p(e.length),n=s(t),i=0;i<t;i+=1)n[i]=255&e[i];return n}function f(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var i;return i=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(i,l.prototype),i}function p(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function g(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||G(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return U(e).length;default:if(r)return i?-1:B(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0)||(n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return M(this,t,n);case"utf8":case"utf-8":return R(this,t,n);case"ascii":return I(this,t,n);case"latin1":case"binary":return L(this,t,n);case"base64":return A(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function v(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function y(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),H(n=+n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=l.from(t,i)),l.isBuffer(t))return 0===t.length?-1:_(e,t,n,i,r);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):_(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function _(e,t,n,i,r){var a,o=1,s=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;o=2,s/=2,l/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(r){var u=-1;for(a=n;a<s;a++)if(c(e,a)===c(t,-1===u?0:a-u)){if(-1===u&&(u=a),a-u+1===l)return u*o}else-1!==u&&(a-=a-u),u=-1}else for(n+l>s&&(n=s-l),a=n;a>=0;a--){for(var d=!0,h=0;h<l;h++)if(c(e,a+h)!==c(t,h)){d=!1;break}if(d)return a}return-1}function E(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;var a=t.length;i>a/2&&(i=a/2);for(var o=0;o<i;++o){var s=parseInt(t.substr(2*o,2),16);if(H(s))return o;e[n+o]=s}return o}function b(e,t,n,i){return V(B(t,e.length-n),e,n,i)}function T(e,t,n,i){return V(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function S(e,t,n,i){return V(U(t),e,n,i)}function w(e,t,n,i){return V(function(e,t){for(var n,i,r,a=[],o=0;o<e.length&&!((t-=2)<0);++o)i=(n=e.charCodeAt(o))>>8,r=n%256,a.push(r),a.push(i);return a}(t,e.length-n),e,n,i)}function A(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function R(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var a,o,s,l,c=e[r],u=null,d=c>239?4:c>223?3:c>191?2:1;if(r+d<=n)switch(d){case 1:c<128&&(u=c);break;case 2:128==(192&(a=e[r+1]))&&(l=(31&c)<<6|63&a)>127&&(u=l);break;case 3:a=e[r+1],o=e[r+2],128==(192&a)&&128==(192&o)&&(l=(15&c)<<12|(63&a)<<6|63&o)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:a=e[r+1],o=e[r+2],s=e[r+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(l=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(u=l)}null===u?(u=65533,d=1):u>65535&&(u-=65536,i.push(u>>>10&1023|55296),u=56320|1023&u),i.push(u),r+=d}return function(e){var t=e.length;if(t<=x)return String.fromCharCode.apply(String,e);for(var n="",i=0;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=x));return n}(i)}t.kMaxLength=o,l.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),l.TYPED_ARRAY_SUPPORT||typeof console>"u"||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(e,t,n){return c(e,t,n)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(e,t,n){return r=t,a=n,u(i=e),i<=0?s(i):void 0!==r?"string"==typeof a?s(i).fill(r,a):s(i).fill(r):s(i);var i,r,a},l.allocUnsafe=function(e){return d(e)},l.allocUnsafeSlow=function(e){return d(e)},l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,t){if(G(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),G(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,i=t.length,r=0,a=Math.min(n,i);r<a;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=l.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var a=e[n];if(G(a,Uint8Array))r+a.length>i.length?l.from(a).copy(i,r):Uint8Array.prototype.set.call(i,a,r);else{if(!l.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(i,r)}r+=a.length}return i},l.byteLength=g,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},l.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?R(this,0,e):m.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},a&&(l.prototype[a]=l.prototype.inspect),l.prototype.compare=function(e,t,n,i,r){if(G(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(r>>>=0)-(i>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(a,o),c=this.slice(i,r),u=e.slice(t,n),d=0;d<s;++d)if(c[d]!==u[d]){a=c[d],o=u[d];break}return a<o?-1:o<a?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},l.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var a=!1;;)switch(i){case"hex":return E(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":case"latin1":case"binary":return T(this,e,t,n);case"base64":return S(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),a=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var x=4096;function I(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function L(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function M(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",a=t;a<n;++a)r+=j[e[a]];return r}function C(e,t,n){for(var i=e.slice(t,n),r="",a=0;a<i.length-1;a+=2)r+=String.fromCharCode(i[a]+256*i[a+1]);return r}function P(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function D(e,t,n,i,r,a){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<a)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function O(e,t,n,i,r,a){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function N(e,t,n,i,a){return t=+t,n>>>=0,a||O(e,0,n,4),r.write(e,t,n,i,23,4),n+4}function k(e,t,n,i,a){return t=+t,n>>>=0,a||O(e,0,n,8),r.write(e,t,n,i,52,8),n+8}l.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var i=this.subarray(e,t);return Object.setPrototypeOf(i,l.prototype),i},l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);for(var i=this[e],r=1,a=0;++a<t&&(r*=256);)i+=this[e+a]*r;return i},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);for(var i=this[e],r=1,a=0;++a<t&&(r*=256);)i+=this[e+a]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},l.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);for(var i=t,r=1,a=this[e+--i];i>0&&(r*=256);)a+=this[e+--i]*r;return a>=(r*=128)&&(a-=Math.pow(2,8*t)),a},l.prototype.readInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){e>>>=0,t||P(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){e>>>=0,t||P(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return e>>>=0,t||P(e,4,this.length),r.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e>>>=0,t||P(e,4,this.length),r.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||P(e,8,this.length),r.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,t||P(e,8,this.length),r.read(this,e,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,n,i){e=+e,t>>>=0,n>>>=0,i||D(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,a=0;for(this[t]=255&e;++a<n&&(r*=256);)this[t+a]=e/r&255;return t+n},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,n,i){e=+e,t>>>=0,n>>>=0,i||D(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,a=1;for(this[t+r]=255&e;--r>=0&&(a*=256);)this[t+r]=e/a&255;return t+n},l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t>>>=0,!i){var r=Math.pow(2,8*n-1);D(this,e,t,n,r-1,-r)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o|0)-s&255;return t+n},l.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t>>>=0,!i){var r=Math.pow(2,8*n-1);D(this,e,t,n,r-1,-r)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o|0)-s&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeFloatLE=function(e,t,n){return N(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return N(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return k(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return k(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,i){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n||0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r=i-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),t),r},l.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!l.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===e.length){var r=e.charCodeAt(0);("utf8"===i&&r<128||"latin1"===i)&&(e=r)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(a=t;a<n;++a)this[a]=e;else{var o=l.isBuffer(e)?e:l.from(e,i),s=o.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(a=0;a<n-t;++a)this[a+t]=o[a%s]}return this};var F=/[^+/0-9A-Za-z-_]/g;function B(e,t){var n;t=t||1/0;for(var i=e.length,r=null,a=[],o=0;o<i;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===i){(t-=3)>-1&&a.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&a.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function U(e){return i.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(F,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function V(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function G(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function H(e){return e!=e}var j=function(){for(var e="0123456789abcdef",t=new Array(256),n=0;n<16;++n)for(var i=16*n,r=0;r<16;++r)t[i+r]=e[n]+e[r];return t}()},6693:function(e,t){t.byteLength=function(e){var t=l(e),n=t[0],i=t[1];return 3*(n+i)/4-i},t.toByteArray=function(e){var t,n,a,o=l(e),s=o[0],c=o[1],u=new r(3*(s+(a=c))/4-a),d=0,h=c>0?s-4:s;for(n=0;n<h;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],u[d++]=t>>16&255,u[d++]=t>>8&255,u[d++]=255&t;return 2===c&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,u[d++]=255&t),1===c&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,u[d++]=t>>8&255,u[d++]=255&t),u},t.fromByteArray=function(e){for(var t,i=e.length,r=i%3,a=[],o=16383,s=0,l=i-r;s<l;s+=o)a.push(c(e,s,s+o>l?l:s+o));return 1===r?(t=e[i-1],a.push(n[t>>2]+n[t<<4&63]+"==")):2===r&&(t=(e[i-2]<<8)+e[i-1],a.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),a.join("")};for(var n=[],i=[],r=typeof Uint8Array<"u"?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,s=a.length;o<s;++o)n[o]=a[o],i[a.charCodeAt(o)]=o;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,i){for(var r,a,o=[],s=t;s<i;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(n[(a=r)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return o.join("")}i[45]=62,i[95]=63},2165:function(e,t){t.read=function(e,t,n,i,r){var a,o,s=8*r-i-1,l=(1<<s)-1,c=l>>1,u=-7,d=n?r-1:0,h=n?-1:1,f=e[t+d];for(d+=h,a=f&(1<<-u)-1,f>>=-u,u+=s;u>0;a=256*a+e[t+d],d+=h,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=i;u>0;o=256*o+e[t+d],d+=h,u-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,i),a-=c}return(f?-1:1)*o*Math.pow(2,a-i)},t.write=function(e,t,n,i,r,a){var o,s,l,c=8*a-r-1,u=(1<<c)-1,d=u>>1,h=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:a-1,p=i?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+d>=1?h/l:h*Math.pow(2,1-d))*l>=2&&(o++,l/=2),o+d>=u?(s=0,o=u):o+d>=1?(s=(t*l-1)*Math.pow(2,r),o+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,r),o=0));r>=8;e[n+f]=255&s,f+=p,s/=256,r-=8);for(o=o<<r|s,c+=r;c>0;e[n+f]=255&o,f+=p,o/=256,c-=8);e[n+f-p]|=128*g}},6934:function(e,t){var n={parseBuffer:function(e){return new i(e).parse()},addBoxProcessor:function(e,t){"string"==typeof e&&"function"==typeof t&&(r.prototype._boxProcessors[e]=t)},createFile:function(){return new i},createBox:function(e,t,n){var i=r.create(e);return t&&t.append(i,n),i},createFullBox:function(e,t,i){var r=n.createBox(e,t,i);return r.version=0,r.flags=0,r},Utils:{}};n.Utils.dataViewToString=function(e,t){var n=t||"utf-8";if(typeof TextDecoder<"u")return new TextDecoder(n).decode(e);var i=[],r=0;if("utf-8"===n)for(;r<e.byteLength;){var a=e.getUint8(r++);a<128||(a<224?(a=(31&a)<<6,a|=63&e.getUint8(r++)):a<240?(a=(15&a)<<12,a|=(63&e.getUint8(r++))<<6,a|=63&e.getUint8(r++)):(a=(7&a)<<18,a|=(63&e.getUint8(r++))<<12,a|=(63&e.getUint8(r++))<<6,a|=63&e.getUint8(r++))),i.push(String.fromCharCode(a))}else for(;r<e.byteLength;)i.push(String.fromCharCode(e.getUint8(r++)));return i.join("")},n.Utils.utf8ToByteArray=function(e){var t,n;if(typeof TextEncoder<"u")t=(new TextEncoder).encode(e);else for(t=[],n=0;n<e.length;++n){var i=e.charCodeAt(n);i<128?t.push(i):i<2048?(t.push(192|i>>6),t.push(128|63&i)):i<65536?(t.push(224|i>>12),t.push(128|63&i>>6),t.push(128|63&i)):(t.push(240|i>>18),t.push(128|63&i>>12),t.push(128|63&i>>6),t.push(128|63&i))}return t},n.Utils.appendBox=function(e,t,n){if(t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,-1!==n)if(null!=n){var i,r=-1;if("number"==typeof n)r=n;else{if("string"==typeof n)i=n;else{if("object"!=typeof n||!n.type)return void e.boxes.push(t);i=n.type}for(var a=0;a<e.boxes.length;a++)if(i===e.boxes[a].type){r=a+1;break}}e.boxes.splice(r,0,t)}else e.boxes.push(t)},t.parseBuffer=n.parseBuffer,t.addBoxProcessor=n.addBoxProcessor,t.createFile=n.createFile,t.createBox=n.createBox,t.createFullBox=n.createFullBox,t.Utils=n.Utils,n.Cursor=function(e){this.offset=void 0===e?0:e};var i=function(e){this._cursor=new n.Cursor,this.boxes=[],e&&(this._raw=new DataView(e))};i.prototype.fetch=function(e){var t=this.fetchAll(e,!0);return t.length?t[0]:null},i.prototype.fetchAll=function(e,t){var n=[];return i._sweep.call(this,e,n,t),n},i.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var e=r.parse(this);if(void 0===e.type)break;this.boxes.push(e)}return this},i._sweep=function(e,t,n){for(var r in this.type&&this.type==e&&t.push(this),this.boxes){if(t.length&&n)return;i._sweep.call(this.boxes[r],e,t,n)}},i.prototype.write=function(){var e,t=0;for(e=0;e<this.boxes.length;e++)t+=this.boxes[e].getLength(!1);var n=new Uint8Array(t);for(this._rawo=new DataView(n.buffer),this.bytes=n,this._cursor.offset=0,e=0;e<this.boxes.length;e++)this.boxes[e].write();return n.buffer},i.prototype.append=function(e,t){n.Utils.appendBox(this,e,t)};var r=function(){this._cursor=new n.Cursor};r.parse=function(e){var t=new r;return t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,t._parseBox(),e._cursor.offset=t._raw.byteOffset+t._raw.byteLength,t},r.create=function(e){var t=new r;return t.type=e,t.boxes=[],t},r.prototype._boxContainers=["dinf","edts","mdia","meco","mfra","minf","moof","moov","mvex","stbl","strk","traf","trak","tref","udta","vttc","sinf","schi","encv","enca"],r.prototype._boxProcessors={},r.prototype._procField=function(e,t,n){this._parsing?this[e]=this._readField(t,n):this._writeField(t,n,this[e])},r.prototype._procFieldArray=function(e,t,n,i){var r;if(this._parsing)for(this[e]=[],r=0;r<t;r++)this[e][r]=this._readField(n,i);else for(r=0;r<this[e].length;r++)this._writeField(n,i,this[e][r])},r.prototype._procFullBox=function(){this._procField("version","uint",8),this._procField("flags","uint",24)},r.prototype._procEntries=function(e,t,n){var i;if(this._parsing)for(this[e]=[],i=0;i<t;i++)this[e].push({}),n.call(this,this[e][i]);else for(i=0;i<t;i++)n.call(this,this[e][i])},r.prototype._procSubEntries=function(e,t,n,i){var r;if(this._parsing)for(e[t]=[],r=0;r<n;r++)e[t].push({}),i.call(this,e[t][r]);else for(r=0;r<n;r++)i.call(this,e[t][r])},r.prototype._procEntryField=function(e,t,n,i){this._parsing?e[t]=this._readField(n,i):this._writeField(n,i,e[t])},r.prototype._procSubBoxes=function(e,t){var n;if(this._parsing)for(this[e]=[],n=0;n<t;n++)this[e].push(r.parse(this));else for(n=0;n<t;n++)this._rawo?this[e][n].write():this.size+=this[e][n].getLength()},r.prototype._readField=function(e,t){switch(e){case"uint":return this._readUint(t);case"int":return this._readInt(t);case"template":return this._readTemplate(t);case"string":return-1===t?this._readTerminatedString():this._readString(t);case"data":return this._readData(t);case"utf8":return this._readUTF8String();default:return-1}},r.prototype._readInt=function(e){var t=null,n=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:t=this._raw.getInt8(n);break;case 16:t=this._raw.getInt16(n);break;case 32:t=this._raw.getInt32(n);break;case 64:var i=this._raw.getInt32(n),r=this._raw.getInt32(n+4);t=i*Math.pow(2,32)+r}return this._cursor.offset+=e>>3,t},r.prototype._readUint=function(e){var t,n,i=null,r=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:i=this._raw.getUint8(r);break;case 16:i=this._raw.getUint16(r);break;case 24:i=((t=this._raw.getUint16(r))<<8)+(n=this._raw.getUint8(r+2));break;case 32:i=this._raw.getUint32(r);break;case 64:t=this._raw.getUint32(r),n=this._raw.getUint32(r+4),i=t*Math.pow(2,32)+n}return this._cursor.offset+=e>>3,i},r.prototype._readString=function(e){for(var t="",n=0;n<e;n++){var i=this._readUint(8);t+=String.fromCharCode(i)}return t},r.prototype._readTemplate=function(e){return this._readUint(e/2)+this._readUint(e/2)/Math.pow(2,e/2)},r.prototype._readTerminatedString=function(){for(var e="";this._cursor.offset-this._offset<this._raw.byteLength;){var t=this._readUint(8);if(0===t)break;e+=String.fromCharCode(t)}return e},r.prototype._readData=function(e){var t=e>0?e:this._raw.byteLength-(this._cursor.offset-this._offset);if(t>0){var n=new Uint8Array(this._raw.buffer,this._cursor.offset,t);return this._cursor.offset+=t,n}return null},r.prototype._readUTF8String=function(){var e=this._raw.byteLength-(this._cursor.offset-this._offset),t=null;return e>0&&(t=new DataView(this._raw.buffer,this._cursor.offset,e),this._cursor.offset+=e),t&&n.Utils.dataViewToString(t)},r.prototype._parseBox=function(){if(this._parsing=!0,this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)this._root._incomplete=!0;else{switch(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}this._incomplete||(this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type)?this._parseContainerBox():this._data=this._readData())}},r.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},r.prototype._parseContainerBox=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(r.parse(this))},r.prototype.append=function(e,t){n.Utils.appendBox(this,e,t)},r.prototype.getLength=function(){if(this._parsing=!1,this._rawo=null,this.size=0,this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.size+=this.boxes[e].getLength();return this._data&&this._writeData(this._data),this.size},r.prototype.write=function(){switch(this._parsing=!1,this._cursor.offset=this._parent._cursor.offset,this.size){case 0:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.parent._rawo.byteLength-this._cursor.offset);break;case 1:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.largesize);break;default:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.size)}if(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.boxes[e].write();return this._data&&this._writeData(this._data),this._parent._cursor.offset+=this.size,this.size},r.prototype._writeInt=function(e,t){if(this._rawo){var n=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setInt8(n,t);break;case 16:this._rawo.setInt16(n,t);break;case 32:this._rawo.setInt32(n,t);break;case 64:var i=Math.floor(t/Math.pow(2,32)),r=t-i*Math.pow(2,32);this._rawo.setUint32(n,i),this._rawo.setUint32(n+4,r)}this._cursor.offset+=e>>3}else this.size+=e>>3},r.prototype._writeUint=function(e,t){if(this._rawo){var n,i,r=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setUint8(r,t);break;case 16:this._rawo.setUint16(r,t);break;case 24:n=(16776960&t)>>8,i=255&t,this._rawo.setUint16(r,n),this._rawo.setUint8(r+2,i);break;case 32:this._rawo.setUint32(r,t);break;case 64:i=t-(n=Math.floor(t/Math.pow(2,32)))*Math.pow(2,32),this._rawo.setUint32(r,n),this._rawo.setUint32(r+4,i)}this._cursor.offset+=e>>3}else this.size+=e>>3},r.prototype._writeString=function(e,t){for(var n=0;n<e;n++)this._writeUint(8,t.charCodeAt(n))},r.prototype._writeTerminatedString=function(e){if(0!==e.length){for(var t=0;t<e.length;t++)this._writeUint(8,e.charCodeAt(t));this._writeUint(8,0)}},r.prototype._writeTemplate=function(e,t){var n=Math.floor(t),i=(t-n)*Math.pow(2,e/2);this._writeUint(e/2,n),this._writeUint(e/2,i)},r.prototype._writeData=function(e){if(e)if(this._rawo){if(e instanceof Array){for(var t=this._cursor.offset-this._rawo.byteOffset,n=0;n<e.length;n++)this._rawo.setInt8(t+n,e[n]);this._cursor.offset+=e.length}e instanceof Uint8Array&&(this._root.bytes.set(e,this._cursor.offset),this._cursor.offset+=e.length)}else this.size+=e.length},r.prototype._writeUTF8String=function(e){var t=n.Utils.utf8ToByteArray(e);if(this._rawo)for(var i=new DataView(this._rawo.buffer,this._cursor.offset,t.length),r=0;r<t.length;r++)i.setUint8(r,t[r]);else this.size+=t.length},r.prototype._writeField=function(e,t,n){switch(e){case"uint":this._writeUint(t,n);break;case"int":this._writeInt(t,n);break;case"template":this._writeTemplate(t,n);break;case"string":-1==t?this._writeTerminatedString(n):this._writeString(t,n);break;case"data":this._writeData(n);break;case"utf8":this._writeUTF8String(n)}},r.prototype._boxProcessors.avc1=r.prototype._boxProcessors.avc2=r.prototype._boxProcessors.avc3=r.prototype._boxProcessors.avc4=r.prototype._boxProcessors.hvc1=r.prototype._boxProcessors.hev1=r.prototype._boxProcessors.encv=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procField("pre_defined1","uint",16),this._procField("reserved2","uint",16),this._procFieldArray("pre_defined2",3,"uint",32),this._procField("width","uint",16),this._procField("height","uint",16),this._procField("horizresolution","template",32),this._procField("vertresolution","template",32),this._procField("reserved3","uint",32),this._procField("frame_count","uint",16),this._procFieldArray("compressorname",32,"uint",8),this._procField("depth","uint",16),this._procField("pre_defined3","int",16),this._procField("config","data",-1)},r.prototype._boxProcessors.ctts=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,function(e){this._procEntryField(e,"sample_count","uint",32),this._procEntryField(e,"sample_offset",1===this.version?"int":"uint",32)})},r.prototype._boxProcessors.dref=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},r.prototype._boxProcessors.elst=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,function(e){this._procEntryField(e,"segment_duration","uint",1===this.version?64:32),this._procEntryField(e,"media_time","int",1===this.version?64:32),this._procEntryField(e,"media_rate_integer","int",16),this._procEntryField(e,"media_rate_fraction","int",16)})},r.prototype._boxProcessors.emsg=function(){this._procFullBox(),1==this.version?(this._procField("timescale","uint",32),this._procField("presentation_time","uint",64),this._procField("event_duration","uint",32),this._procField("id","uint",32),this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1)):(this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1),this._procField("timescale","uint",32),this._procField("presentation_time_delta","uint",32),this._procField("event_duration","uint",32),this._procField("id","uint",32)),this._procField("message_data","data",-1)},r.prototype._boxProcessors.free=r.prototype._boxProcessors.skip=function(){this._procField("data","data",-1)},r.prototype._boxProcessors.frma=function(){this._procField("data_format","uint",32)},r.prototype._boxProcessors.ftyp=r.prototype._boxProcessors.styp=function(){this._procField("major_brand","string",4),this._procField("minor_version","uint",32);var e=-1;this._parsing&&(e=(this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset))/4),this._procFieldArray("compatible_brands",e,"string",4)},r.prototype._boxProcessors.hdlr=function(){this._procFullBox(),this._procField("pre_defined","uint",32),this._procField("handler_type","string",4),this._procFieldArray("reserved",3,"uint",32),this._procField("name","string",-1)},r.prototype._boxProcessors.mdat=function(){this._procField("data","data",-1)},r.prototype._boxProcessors.mdhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._parsing||"string"!=typeof this.language||(this.language=this.language.charCodeAt(0)-96<<10|this.language.charCodeAt(1)-96<<5|this.language.charCodeAt(2)-96),this._procField("language","uint",16),this._parsing&&(this.language=String.fromCharCode(96+(this.language>>10&31),96+(this.language>>5&31),96+(31&this.language))),this._procField("pre_defined","uint",16)},r.prototype._boxProcessors.mehd=function(){this._procFullBox(),this._procField("fragment_duration","uint",1==this.version?64:32)},r.prototype._boxProcessors.mfhd=function(){this._procFullBox(),this._procField("sequence_number","uint",32)},r.prototype._boxProcessors.mfro=function(){this._procFullBox(),this._procField("mfra_size","uint",32)},r.prototype._boxProcessors.mp4a=r.prototype._boxProcessors.enca=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procField("channelcount","uint",16),this._procField("samplesize","uint",16),this._procField("pre_defined","uint",16),this._procField("reserved3","uint",16),this._procField("samplerate","template",32),this._procField("esds","data",-1)},r.prototype._boxProcessors.mvhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procField("rate","template",32),this._procField("volume","template",16),this._procField("reserved1","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procFieldArray("matrix",9,"template",32),this._procFieldArray("pre_defined",6,"uint",32),this._procField("next_track_ID","uint",32)},r.prototype._boxProcessors.payl=function(){this._procField("cue_text","utf8")},r.prototype._boxProcessors.prft=function(){this._procFullBox(),this._procField("reference_track_ID","uint",32),this._procField("ntp_timestamp_sec","uint",32),this._procField("ntp_timestamp_frac","uint",32),this._procField("media_time","uint",1==this.version?64:32)},r.prototype._boxProcessors.pssh=function(){this._procFullBox(),this._procFieldArray("SystemID",16,"uint",8),this._procField("DataSize","uint",32),this._procFieldArray("Data",this.DataSize,"uint",8)},r.prototype._boxProcessors.schm=function(){this._procFullBox(),this._procField("scheme_type","uint",32),this._procField("scheme_version","uint",32),1&this.flags&&this._procField("scheme_uri","string",-1)},r.prototype._boxProcessors.sdtp=function(){this._procFullBox();var e=-1;this._parsing&&(e=this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset)),this._procFieldArray("sample_dependency_table",e,"uint",8)},r.prototype._boxProcessors.sidx=function(){this._procFullBox(),this._procField("reference_ID","uint",32),this._procField("timescale","uint",32),this._procField("earliest_presentation_time","uint",1==this.version?64:32),this._procField("first_offset","uint",1==this.version?64:32),this._procField("reserved","uint",16),this._procField("reference_count","uint",16),this._procEntries("references",this.reference_count,function(e){this._parsing||(e.reference=(1&e.reference_type)<<31,e.reference|=2147483647&e.referenced_size,e.sap=(1&e.starts_with_SAP)<<31,e.sap|=(3&e.SAP_type)<<28,e.sap|=268435455&e.SAP_delta_time),this._procEntryField(e,"reference","uint",32),this._procEntryField(e,"subsegment_duration","uint",32),this._procEntryField(e,"sap","uint",32),this._parsing&&(e.reference_type=e.reference>>31&1,e.referenced_size=2147483647&e.reference,e.starts_with_SAP=e.sap>>31&1,e.SAP_type=e.sap>>28&7,e.SAP_delta_time=268435455&e.sap)})},r.prototype._boxProcessors.smhd=function(){this._procFullBox(),this._procField("balance","uint",16),this._procField("reserved","uint",16)},r.prototype._boxProcessors.ssix=function(){this._procFullBox(),this._procField("subsegment_count","uint",32),this._procEntries("subsegments",this.subsegment_count,function(e){this._procEntryField(e,"ranges_count","uint",32),this._procSubEntries(e,"ranges",e.ranges_count,function(e){this._procEntryField(e,"level","uint",8),this._procEntryField(e,"range_size","uint",24)})})},r.prototype._boxProcessors.stsd=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},r.prototype._boxProcessors.sttg=function(){this._procField("settings","utf8")},r.prototype._boxProcessors.stts=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,function(e){this._procEntryField(e,"sample_count","uint",32),this._procEntryField(e,"sample_delta","uint",32)})},r.prototype._boxProcessors.subs=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,function(e){this._procEntryField(e,"sample_delta","uint",32),this._procEntryField(e,"subsample_count","uint",16),this._procSubEntries(e,"subsamples",e.subsample_count,function(e){this._procEntryField(e,"subsample_size","uint",1===this.version?32:16),this._procEntryField(e,"subsample_priority","uint",8),this._procEntryField(e,"discardable","uint",8),this._procEntryField(e,"codec_specific_parameters","uint",32)})})},r.prototype._boxProcessors.tenc=function(){this._procFullBox(),this._procField("default_IsEncrypted","uint",24),this._procField("default_IV_size","uint",8),this._procFieldArray("default_KID",16,"uint",8)},r.prototype._boxProcessors.tfdt=function(){this._procFullBox(),this._procField("baseMediaDecodeTime","uint",1==this.version?64:32)},r.prototype._boxProcessors.tfhd=function(){this._procFullBox(),this._procField("track_ID","uint",32),1&this.flags&&this._procField("base_data_offset","uint",64),2&this.flags&&this._procField("sample_description_offset","uint",32),8&this.flags&&this._procField("default_sample_duration","uint",32),16&this.flags&&this._procField("default_sample_size","uint",32),32&this.flags&&this._procField("default_sample_flags","uint",32)},r.prototype._boxProcessors.tfra=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._parsing||(this.reserved=0,this.reserved|=(48&this.length_size_of_traf_num)<<4,this.reserved|=(12&this.length_size_of_trun_num)<<2,this.reserved|=3&this.length_size_of_sample_num),this._procField("reserved","uint",32),this._parsing&&(this.length_size_of_traf_num=(48&this.reserved)>>4,this.length_size_of_trun_num=(12&this.reserved)>>2,this.length_size_of_sample_num=3&this.reserved),this._procField("number_of_entry","uint",32),this._procEntries("entries",this.number_of_entry,function(e){this._procEntryField(e,"time","uint",1===this.version?64:32),this._procEntryField(e,"moof_offset","uint",1===this.version?64:32),this._procEntryField(e,"traf_number","uint",8*(this.length_size_of_traf_num+1)),this._procEntryField(e,"trun_number","uint",8*(this.length_size_of_trun_num+1)),this._procEntryField(e,"sample_number","uint",8*(this.length_size_of_sample_num+1))})},r.prototype._boxProcessors.tkhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("track_ID","uint",32),this._procField("reserved1","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procFieldArray("reserved2",2,"uint",32),this._procField("layer","uint",16),this._procField("alternate_group","uint",16),this._procField("volume","template",16),this._procField("reserved3","uint",16),this._procFieldArray("matrix",9,"template",32),this._procField("width","template",32),this._procField("height","template",32)},r.prototype._boxProcessors.trex=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._procField("default_sample_description_index","uint",32),this._procField("default_sample_duration","uint",32),this._procField("default_sample_size","uint",32),this._procField("default_sample_flags","uint",32)},r.prototype._boxProcessors.trun=function(){this._procFullBox(),this._procField("sample_count","uint",32),1&this.flags&&this._procField("data_offset","int",32),4&this.flags&&this._procField("first_sample_flags","uint",32),this._procEntries("samples",this.sample_count,function(e){256&this.flags&&this._procEntryField(e,"sample_duration","uint",32),512&this.flags&&this._procEntryField(e,"sample_size","uint",32),1024&this.flags&&this._procEntryField(e,"sample_flags","uint",32),2048&this.flags&&this._procEntryField(e,"sample_composition_time_offset",1===this.version?"int":"uint",32)})},r.prototype._boxProcessors["url "]=r.prototype._boxProcessors["urn "]=function(){this._procFullBox(),"urn "===this.type&&this._procField("name","string",-1),this._procField("location","string",-1)},r.prototype._boxProcessors.vlab=function(){this._procField("source_label","utf8")},r.prototype._boxProcessors.vmhd=function(){this._procFullBox(),this._procField("graphicsmode","uint",16),this._procFieldArray("opcolor",3,"uint",16)},r.prototype._boxProcessors.vttC=function(){this._procField("config","utf8")},r.prototype._boxProcessors.vtte=function(){}},5530:function(e,t,n){e.exports=n(6146).polyfill()},6146:function(e,t,n){e.exports=function(){function e(e){return"function"==typeof e}var t=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},i=0,r=void 0,a=void 0,o=function(e,t){f[i]=e,f[i+1]=t,2===(i+=2)&&(a?a(p):_())},s=typeof window<"u"?window:void 0,l=s||{},c=l.MutationObserver||l.WebKitMutationObserver,u=typeof self>"u"&&typeof process<"u"&&"[object process]"==={}.toString.call(process),d=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function h(){var e=setTimeout;return function(){return e(p,1)}}var f=new Array(1e3);function p(){for(var e=0;e<i;e+=2)(0,f[e])(f[e+1]),f[e]=void 0,f[e+1]=void 0;i=0}var g,m,v,y,_=void 0;function E(e,t){var n=this,i=new this.constructor(S);void 0===i[T]&&O(i);var r=n._state;if(r){var a=arguments[r-1];o(function(){return P(r,i,a,n._result)})}else M(n,i,e,t);return i}function b(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(S);return R(t,e),t}_=u?function(){return process.nextTick(p)}:c?(m=0,v=new c(p),y=document.createTextNode(""),v.observe(y,{characterData:!0}),function(){y.data=m=++m%2}):d?((g=new MessageChannel).port1.onmessage=p,function(){return g.port2.postMessage(0)}):void 0===s?function(){try{var e=Function("return this")().require("vertx");return void 0!==(r=e.runOnLoop||e.runOnContext)?function(){r(p)}:h()}catch(e){return h()}}():h();var T=Math.random().toString(36).substring(2);function S(){}var w=void 0;function A(t,n,i){var r,a;n.constructor===t.constructor&&i===E&&n.constructor.resolve===b?(r=t,1===(a=n)._state?I(r,a._result):2===a._state?L(r,a._result):M(a,void 0,function(e){return R(r,e)},function(e){return L(r,e)})):void 0===i?I(t,n):e(i)?function(e,t,n){o(function(e){var i=!1,r=function(e,t,n,i){try{e.call(t,n,i)}catch(e){return e}}(n,t,function(n){i||(i=!0,t!==n?R(e,n):I(e,n))},function(t){i||(i=!0,L(e,t))},e._label);!i&&r&&(i=!0,L(e,r))},e)}(t,n,i):I(t,n)}function R(e,t){if(e===t)L(e,new TypeError("You cannot resolve a promise with itself"));else if(r=typeof(i=t),null===i||"object"!==r&&"function"!==r)I(e,t);else{var n=void 0;try{n=t.then}catch(t){return void L(e,t)}A(e,t,n)}var i,r}function x(e){e._onerror&&e._onerror(e._result),C(e)}function I(e,t){e._state===w&&(e._result=t,e._state=1,0!==e._subscribers.length&&o(C,e))}function L(e,t){e._state===w&&(e._state=2,e._result=t,o(x,e))}function M(e,t,n,i){var r=e._subscribers,a=r.length;e._onerror=null,r[a]=t,r[a+1]=n,r[a+2]=i,0===a&&e._state&&o(C,e)}function C(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i=void 0,r=void 0,a=e._result,o=0;o<t.length;o+=3)i=t[o],r=t[o+n],i?P(n,i,r,a):r(a);e._subscribers.length=0}}function P(t,n,i,r){var a=e(i),o=void 0,s=void 0,l=!0;if(a){try{o=i(r)}catch(e){l=!1,s=e}if(n===o)return void L(n,new TypeError("A promises callback cannot return that same promise."))}else o=r;n._state!==w||(a&&l?R(n,o):!1===l?L(n,s):1===t?I(n,o):2===t&&L(n,o))}var D=0;function O(e){e[T]=D++,e._state=void 0,e._result=void 0,e._subscribers=[]}var N=function(){function e(e,n){this._instanceConstructor=e,this.promise=new e(S),this.promise[T]||O(this.promise),t(n)?(this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),0===this.length?I(this.promise,this._result):(this.length=this.length||0,this._enumerate(n),0===this._remaining&&I(this.promise,this._result))):L(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===w&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===b){var r=void 0,a=void 0,o=!1;try{r=e.then}catch(e){o=!0,a=e}if(r===E&&e._state!==w)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(n===k){var s=new n(S);o?L(s,a):A(s,e,r),this._willSettleAt(s,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(i(e),t)},e.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===w&&(this._remaining--,2===e?L(i,n):this._result[t]=n),0===this._remaining&&I(i,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;M(e,void 0,function(e){return n._settledAt(1,t,e)},function(e){return n._settledAt(2,t,e)})},e}(),k=function(){function t(e){this[T]=D++,this._result=this._state=void 0,this._subscribers=[],S!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t(function(t){R(e,t)},function(t){L(e,t)})}catch(t){L(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var n=this,i=n.constructor;return e(t)?n.then(function(e){return i.resolve(t()).then(function(){return e})},function(e){return i.resolve(t()).then(function(){throw e})}):n.then(t,t)},t}();return k.prototype.then=E,k.all=function(e){return new N(this,e).promise},k.race=function(e){var n=this;return t(e)?new n(function(t,i){for(var r=e.length,a=0;a<r;a++)n.resolve(e[a]).then(t,i)}):new n(function(e,t){return t(new TypeError("You must pass an array to race."))})},k.resolve=b,k.reject=function(e){var t=new this(S);return L(t,e),t},k._setScheduler=function(e){a=e},k._setAsap=function(e){o=e},k._asap=o,k.polyfill=function(){var e=void 0;if(void 0!==n.g)e=n.g;else if(typeof self<"u")e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var i=null;try{i=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===i&&!t.cast)return}e.Promise=k},k.Promise=k,k}()},1159:function(e){var t,n="object"==typeof Reflect?Reflect:null,i=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise(function(n,i){function r(n){e.removeListener(t,a),i(n)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}var o,s;g(e,t,a,{once:!0}),"error"!==t&&(s=r,"function"==typeof(o=e).on&&g(o,"error",s,{once:!0}))})},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var o=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function c(e,t,n,i){var r,a,o,c;if(s(n),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]),void 0===o)o=a[t]=n,++e._eventsCount;else if("function"==typeof o?o=a[t]=i?[n,o]:[o,n]:i?o.unshift(n):o.push(n),(r=l(e))>0&&o.length>r&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,c=u,console&&console.warn&&console.warn(c)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=u.bind(i);return r.listener=n,i.wrapFn=r,r}function h(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):p(r,r.length)}function f(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function g(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function r(a){i.once&&e.removeEventListener(t,r),n(a)})}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,a=this._events;if(void 0!==a)r=r&&void 0===a.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var l=a[e];if(void 0===l)return!1;if("function"==typeof l)i(l,this,t);else{var c=l.length,u=p(l,c);for(n=0;n<c;++n)i(u[n],this,t)}return!0},a.prototype.addListener=function(e,t){return c(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return c(this,e,t,!0)},a.prototype.once=function(e,t){return s(t),this.on(e,d(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,d(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,i,r,a,o;if(s(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){o=n[a].listener,r=a;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,a=Object.keys(n);for(i=0;i<a.length;++i)"removeListener"!==(r=a[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},a.prototype.listeners=function(e){return h(this,e,!0)},a.prototype.rawListeners=function(e){return h(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},a.prototype.listenerCount=f,a.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},3101:function(e){var t=Array.isArray,n=Object.keys,i=Object.prototype.hasOwnProperty;e.exports=function e(r,a){if(r===a)return!0;if(r&&a&&"object"==typeof r&&"object"==typeof a){var o,s,l,c=t(r),u=t(a);if(c&&u){if((s=r.length)!=a.length)return!1;for(o=s;0!=o--;)if(!e(r[o],a[o]))return!1;return!0}if(c!=u)return!1;var d=r instanceof Date,h=a instanceof Date;if(d!=h)return!1;if(d&&h)return r.getTime()==a.getTime();var f=r instanceof RegExp,p=a instanceof RegExp;if(f!=p)return!1;if(f&&p)return r.toString()==a.toString();var g=n(r);if((s=g.length)!==n(a).length)return!1;for(o=s;0!=o--;)if(!i.call(a,g[o]))return!1;for(o=s;0!=o--;)if(!e(r[l=g[o]],a[l]))return!1;return!0}return r!=r&&a!=a}},3362:function(e,t,n){!function(e,t,n,i,r){function a(e){if("contents"in e)for(var t=("styleAttrs"in e?e.styleAttrs[i.byName.ruby.qname]:null),n="span"===e.kind&&("container"===t||"textContainer"===t||"baseContainer"===t),r=e.contents.length-1;r>=0;r--)!n||"styleAttrs"in e.contents[r]&&i.byName.ruby.qname in e.contents[r].styleAttrs?a(e.contents[r]):delete e.contents[r]}function o(e,t,n,i){var r=i&&"seq"===i.timeContainer,a=0;i&&(a=r&&n?n.end:i.begin),t.begin=t.explicit_begin?t.explicit_begin+a:a;var s=t.begin,l=null;if("sets"in t)for(var c=0;c<t.sets.length;c++)o(e,t.sets[c],l,t),s="seq"===t.timeContainer?t.sets[c].end:Math.max(s,t.sets[c].end),l=t.sets[c];if("contents"in t){if("contents"in t)for(var u=0;u<t.contents.length;u++)o(e,t.contents[u],l,t),s="seq"===t.timeContainer?t.contents[u].end:Math.max(s,t.contents[u].end),l=t.contents[u]}else s=r?t.begin:Number.POSITIVE_INFINITY;null!==t.explicit_end&&null!==t.explicit_dur?t.end=Math.min(t.begin+t.explicit_dur,a+t.explicit_end):null===t.explicit_end&&null!==t.explicit_dur?t.end=t.begin+t.explicit_dur:null!==t.explicit_end&&null===t.explicit_dur?t.end=a+t.explicit_end:t.end=s,delete t.explicit_begin,delete t.explicit_dur,delete t.explicit_end,e._registerEvent(t)}function s(e){this.node=e}function l(){this.events=[],this.head=new c,this.body=null}function c(){this.styling=new u,this.layout=new f}function u(){this.styles={},this.initials={}}function d(){this.id=null,this.styleAttrs=null,this.styleRefs=null}function h(){this.styleAttrs=null}function f(){this.regions={}}function p(e,t){g.call(this,"image"),this.src=e,this.type=t}function g(e){this.kind=e}function m(e){this.id=e}function v(e){this.regionID=e}function y(e){this.styleAttrs=e}function _(e){this.sets=e}function E(e){this.contents=e}function b(e,t,n){this.explicit_begin=e,this.explicit_end=t,this.explicit_dur=n}function T(){g.call(this,"body")}function S(){g.call(this,"div")}function w(){g.call(this,"p")}function A(){g.call(this,"span")}function R(){g.call(this,"span")}function x(){g.call(this,"br")}function I(){}function L(){}function M(e){return e&&"xml:id"in e.attributes&&e.attributes["xml:id"].value||null}function C(e){return e&&"style"in e.attributes?e.attributes.style.value.split(" "):[]}function P(e,t){var n={};if(null!==e)for(var r in e.attributes){var a=e.attributes[r].uri+" "+e.attributes[r].local,o=i.byQName[a];if(void 0!==o){var s=o.parse(e.attributes[r].value);null!==s?(n[a]=s,o===i.byName.zIndex&&B(t,"zIndex attribute present but not used by IMSC1 since regions do not overlap")):U(t,"Cannot parse styling attribute "+a+" --\x3e "+e.attributes[r].value)}}return n}function D(e,t,n){for(var i in e.attributes)if(e.attributes[i].uri===t&&e.attributes[i].local===n)return e.attributes[i].value;return null}function O(e,t,n){var i,r=null;return null!==(i=/^(\d+(?:\.\d+)?)f$/.exec(n))?null!==t&&(r=parseFloat(i[1])/t):null!==(i=/^(\d+(?:\.\d+)?)t$/.exec(n))?null!==e&&(r=parseFloat(i[1])/e):null!==(i=/^(\d+(?:\.\d+)?)ms$/.exec(n))?r=parseFloat(i[1])/1e3:null!==(i=/^(\d+(?:\.\d+)?)s$/.exec(n))?r=parseFloat(i[1]):null!==(i=/^(\d+(?:\.\d+)?)h$/.exec(n))?r=3600*parseFloat(i[1]):null!==(i=/^(\d+(?:\.\d+)?)m$/.exec(n))?r=60*parseFloat(i[1]):null!==(i=/^(\d{2,}):(\d\d):(\d\d(?:\.\d+)?)$/.exec(n))?r=3600*parseInt(i[1])+60*parseInt(i[2])+parseFloat(i[3]):null!==(i=/^(\d{2,}):(\d\d):(\d\d)\:(\d{2,})$/.exec(n))&&null!==t&&(r=3600*parseInt(i[1])+60*parseInt(i[2])+parseInt(i[3])+(null===i[4]?0:parseInt(i[4])/t)),r}function N(e,t,n){for(;t.styleRefs.length>0;){var i=t.styleRefs.pop();i in e.styles?(N(e,e.styles[i],n),F(e.styles[i].styleAttrs,t.styleAttrs)):U(n,"Non-existant style id referenced")}}function k(e,t,n,i){for(var r=t.length-1;r>=0;r--){var a=t[r];a in e.styles?F(e.styles[a].styleAttrs,n):U(i,"Non-existant style id referenced")}}function F(e,t){for(var n in e)e.hasOwnProperty(n)&&(n in t||(t[n]=e[n]))}function B(e,t){if(e&&e.warn&&e.warn(t))throw t}function U(e,t){if(e&&e.error&&e.error(t))throw t}function V(e,t){throw e&&e.fatal&&e.fatal(t),t}function G(e,t){for(var n,i=0,r=e.length-1;i<=r;){var a=e[n=Math.floor((i+r)/2)];if(a<t)i=n+1;else{if(!(a>t))return{found:!0,index:n};r=n-1}}return{found:!1,index:i}}e.fromXML=function(e,r,g){var m=t.parser(!0,{xmlns:!0}),v=[],y=[],_=[],E=0,b=null;m.onclosetag=function(e){if(v[0]instanceof I)null!==b.head&&null!==b.head.styling&&k(b.head.styling,v[0].styleRefs,v[0].styleAttrs,r),delete v[0].styleRefs;else if(v[0]instanceof u)for(var t in v[0].styles)v[0].styles.hasOwnProperty(t)&&N(v[0],v[0].styles[t],r);else if(v[0]instanceof w||v[0]instanceof A){if(v[0].contents.length>1){var i,a=[v[0].contents[0]];for(i=1;i<v[0].contents.length;i++)v[0].contents[i]instanceof R&&a[a.length-1]instanceof R?a[a.length-1].text+=v[0].contents[i].text:a.push(v[0].contents[i]);v[0].contents=a}v[0]instanceof A&&1===v[0].contents.length&&v[0].contents[0]instanceof R&&(v[0].text=v[0].contents[0].text,delete v[0].contents)}else v[0]instanceof s&&(v[0].node.uri===n.ns_tt&&"metadata"===v[0].node.local?E--:E>0&&g&&"onCloseTag"in g&&g.onCloseTag());_.shift(),y.shift(),v.shift()},m.ontext=function(e){if(void 0!==v[0])if(v[0]instanceof A||v[0]instanceof w){if(v[0]instanceof A){var t=v[0].styleAttrs[i.byName.ruby.qname];if("container"===t||"textContainer"===t||"baseContainer"===t)return}var n=new R;n.initFromText(b,v[0],e,y[0],_[0],r),v[0].contents.push(n)}else v[0]instanceof s&&E>0&&g&&"onText"in g&&g.onText(e)},m.onopentag=function(e){var t=e.attributes["xml:space"];t?_.unshift(t.value):0===_.length?_.unshift("default"):_.unshift(_[0]);var a=e.attributes["xml:lang"];if(a?y.unshift(a.value):0===y.length?y.unshift(""):y.unshift(y[0]),e.uri===n.ns_tt)if("tt"===e.local)null!==b&&V(r,"Two <tt> elements at ("+this.line+","+this.column+")"),(b=new l).initFromNode(e,y[0],r),v.unshift(b);else if("head"===e.local)v[0]instanceof l||V(r,"Parent of <head> element is not <tt> at ("+this.line+","+this.column+")"),v.unshift(b.head);else if("styling"===e.local)v[0]instanceof c||V(r,"Parent of <styling> element is not <head> at ("+this.line+","+this.column+")"),v.unshift(b.head.styling);else if("style"===e.local){var o;v[0]instanceof u?((o=new d).initFromNode(e,r),o.id?b.head.styling.styles[o.id]=o:U(r,"<style> element missing @id attribute"),v.unshift(o)):v[0]instanceof I?((o=new d).initFromNode(e,r),F(o.styleAttrs,v[0].styleAttrs),v.unshift(o)):V(r,"Parent of <style> element is not <styling> or <region> at ("+this.line+","+this.column+")")}else if("initial"===e.local){var m;if(v[0]instanceof u){for(var R in(m=new h).initFromNode(e,r),m.styleAttrs)m.styleAttrs.hasOwnProperty(R)&&(b.head.styling.initials[R]=m.styleAttrs[R]);v.unshift(m)}else V(r,"Parent of <initial> element is not <styling> at ("+this.line+","+this.column+")")}else if("layout"===e.local)v[0]instanceof c||V(r,"Parent of <layout> element is not <head> at "+this.line+","+this.column+")"),v.unshift(b.head.layout);else if("region"===e.local){v[0]instanceof f||V(r,"Parent of <region> element is not <layout> at "+this.line+","+this.column+")");var M=new I;M.initFromNode(b,e,y[0],r),!M.id||M.id in b.head.layout.regions?U(r,"Ignoring <region> with duplicate or missing @id at "+this.line+","+this.column+")"):b.head.layout.regions[M.id]=M,v.unshift(M)}else if("body"===e.local){v[0]instanceof l||V(r,"Parent of <body> element is not <tt> at "+this.line+","+this.column+")"),null!==b.body&&V(r,"Second <body> element at "+this.line+","+this.column+")");var C=new T;C.initFromNode(b,e,y[0],r),b.body=C,v.unshift(C)}else if("div"===e.local){v[0]instanceof S||v[0]instanceof T||V(r,"Parent of <div> element is not <body> or <div> at "+this.line+","+this.column+")");var P=new S;P.initFromNode(b,v[0],e,y[0],r);var D=P.styleAttrs[i.byName.backgroundImage.qname];D&&(P.contents.push(new p(D)),delete P.styleAttrs[i.byName.backgroundImage.qname]),v[0].contents.push(P),v.unshift(P)}else if("image"===e.local){v[0]instanceof S||V(r,"Parent of <image> element is not <div> at "+this.line+","+this.column+")");var O=new p;O.initFromNode(b,v[0],e,y[0],r),v[0].contents.push(O),v.unshift(O)}else if("p"===e.local){v[0]instanceof S||V(r,"Parent of <p> element is not <div> at "+this.line+","+this.column+")");var N=new w;N.initFromNode(b,v[0],e,y[0],r),v[0].contents.push(N),v.unshift(N)}else if("span"===e.local){v[0]instanceof A||v[0]instanceof w||V(r,"Parent of <span> element is not <span> or <p> at "+this.line+","+this.column+")");var k=new A;k.initFromNode(b,v[0],e,y[0],_[0],r),v[0].contents.push(k),v.unshift(k)}else if("br"===e.local){v[0]instanceof A||v[0]instanceof w||V(r,"Parent of <br> element is not <span> or <p> at "+this.line+","+this.column+")");var B=new x;B.initFromNode(b,v[0],e,y[0],r),v[0].contents.push(B),v.unshift(B)}else if("set"===e.local){v[0]instanceof A||v[0]instanceof w||v[0]instanceof S||v[0]instanceof T||v[0]instanceof I||v[0]instanceof x||V(r,"Parent of <set> element is not a content element or a region at "+this.line+","+this.column+")");var G=new L;G.initFromNode(b,v[0],e,r),v[0].sets.push(G),v.unshift(G)}else v.unshift(new s(e));else v.unshift(new s(e));if(v[0]instanceof s)if(e.uri===n.ns_tt&&"metadata"===e.local)E++;else if(E>0&&g&&"onOpenTag"in g){var H=[];for(var j in e.attributes)H[e.attributes[j].uri+" "+e.attributes[j].local]={uri:e.attributes[j].uri,local:e.attributes[j].local,value:e.attributes[j].value};g.onOpenTag(e.uri,e.local,H)}},m.write(e).close(),delete b.head.styling.styles;var M=!1;for(var C in b.head.layout.regions)if(b.head.layout.regions.hasOwnProperty(C)){M=!0;break}if(!M){var P=I.prototype.createDefaultRegion(b.lang);b.head.layout.regions[P.id]=P}for(var D in b.head.layout.regions)b.head.layout.regions.hasOwnProperty(D)&&o(b,b.head.layout.regions[D],null,null);return b.body&&o(b,b.body,null,null),b.body&&a(b.body),b},l.prototype.initFromNode=function(e,t,i){var a=function(e,t){var i=D(e,n.ns_ttp,"cellResolution"),r=15,a=32;if(null!==i){var o=/(\d+) (\d+)/.exec(i);null!==o?(a=parseInt(o[1]),r=parseInt(o[2])):B(t,"Malformed cellResolution value (using initial value instead)")}return{w:a,h:r}}(e,i);this.cellLength={h:new r.ComputedLength(0,1/a.h),w:new r.ComputedLength(1/a.w,0)};var o=function(e,t){var i,r=D(e,n.ns_ttp,"frameRate"),a=30;null!==r&&(null!==(i=/(\d+)/.exec(r))?a=parseInt(i[1]):B(t,"Malformed frame rate attribute (using initial value instead)"));var o=D(e,n.ns_ttp,"frameRateMultiplier"),s=1;null!==o&&(null!==(i=/(\d+) (\d+)/.exec(o))?s=parseInt(i[1])/parseInt(i[2]):B(t,"Malformed frame rate multiplier attribute (using initial value instead)"));var l=s*a,c=1,u=D(e,n.ns_ttp,"tickRate");return null===u?null!==r&&(c=l):null!==(i=/(\d+)/.exec(u))?c=parseInt(i[1]):B(t,"Malformed tick rate attribute (using initial value instead)"),{effectiveFrameRate:l,tickRate:c}}(e,i);this.effectiveFrameRate=o.effectiveFrameRate,this.tickRate=o.tickRate,this.aspectRatio=function(e,t){var i=D(e,n.ns_ittp,"aspectRatio");null===i&&(i=D(e,n.ns_ttp,"displayAspectRatio"));var r=null;if(null!==i){var a=/(\d+)\s+(\d+)/.exec(i);if(null!==a){var o=parseInt(a[1]),s=parseInt(a[2]);0!==o&&0!==s?r=o/s:U(t,"Illegal aspectRatio values (ignoring)")}else U(t,"Malformed aspectRatio attribute (ignoring)")}return r}(e,i);var s=D(e,n.ns_ttp,"timeBase");null!==s&&"media"!==s&&V(i,"Unsupported time base");var l=function(e,t){var i=D(e,n.ns_tts,"extent");if(null===i)return null;var a=i.split(" ");if(2!==a.length)return B(t,"Malformed extent (ignoring)"),null;var o=r.parseLength(a[0]),s=r.parseLength(a[1]);return s&&o?{h:s,w:o}:(B(t,"Malformed extent values (ignoring)"),null)}(e,i);null===l?this.pxLength={h:null,w:null}:("px"===l.h.unit&&"px"===l.w.unit||V(i,"Extent on TT must be in px or absent"),this.pxLength={h:new r.ComputedLength(0,1/l.h.value),w:new r.ComputedLength(1/l.w.value,0)}),this.dimensions={h:new r.ComputedLength(0,1),w:new r.ComputedLength(1,0)},this.lang=t},l.prototype._registerEvent=function(e){if(!(e.end<=e.begin)){var t=G(this.events,e.begin);if(t.found||this.events.splice(t.index,0,e.begin),e.end!==Number.POSITIVE_INFINITY){var n=G(this.events,e.end);n.found||this.events.splice(n.index,0,e.end)}}},l.prototype.getMediaTimeRange=function(){return[this.events[0],this.events[this.events.length-1]]},l.prototype.getMediaTimeEvents=function(){return this.events},d.prototype.initFromNode=function(e,t){this.id=M(e),this.styleAttrs=P(e,t),this.styleRefs=C(e)},h.prototype.initFromNode=function(e,t){for(var i in this.styleAttrs={},e.attributes)if(e.attributes[i].uri===n.ns_itts||e.attributes[i].uri===n.ns_ebutts||e.attributes[i].uri===n.ns_tts){var r=e.attributes[i].uri+" "+e.attributes[i].local;this.styleAttrs[r]=e.attributes[i].value}},p.prototype.initFromNode=function(e,t,n,i,r){this.src="src"in n.attributes?n.attributes.src.value:null,this.src||U(r,"Invalid image@src attribute"),this.type="type"in n.attributes?n.attributes.type.value:null,this.type||U(r,"Invalid image@type attribute"),y.prototype.initFromNode.call(this,e,t,n,r),b.prototype.initFromNode.call(this,e,t,n,r),_.prototype.initFromNode.call(this,e,t,n,r),v.prototype.initFromNode.call(this,e,t,n,r),this.lang=i},m.prototype.initFromNode=function(e,t,n,i){this.id=M(n)},v.prototype.initFromNode=function(e,t,n,i){var r;this.regionID=(r=n)&&"region"in r.attributes?r.attributes.region.value:""},y.prototype.initFromNode=function(e,t,n,i){this.styleAttrs=P(n,i),null!==e.head&&null!==e.head.styling&&k(e.head.styling,C(n),this.styleAttrs,i)},_.prototype.initFromNode=function(e,t,n,i){this.sets=[]},E.prototype.initFromNode=function(e,t,n,i){this.contents=[]},b.prototype.initFromNode=function(e,t,n,i){var r,a,o,s=function(e,t,n,i){var r=null;n&&"begin"in n.attributes&&null===(r=O(e.tickRate,e.effectiveFrameRate,n.attributes.begin.value))&&B(i,"Malformed begin value "+n.attributes.begin.value+" (using 0)");var a=null;n&&"dur"in n.attributes&&null===(a=O(e.tickRate,e.effectiveFrameRate,n.attributes.dur.value))&&B(i,"Malformed dur value "+n.attributes.dur.value+" (ignoring)");var o=null;return n&&"end"in n.attributes&&null===(o=O(e.tickRate,e.effectiveFrameRate,n.attributes.end.value))&&B(i,"Malformed end value (ignoring)"),{explicit_begin:r,explicit_end:o,explicit_dur:a}}(e,0,n,i);this.explicit_begin=s.explicit_begin,this.explicit_end=s.explicit_end,this.explicit_dur=s.explicit_dur,this.timeContainer=(a=i,(o=(r=n)&&"timeContainer"in r.attributes?r.attributes.timeContainer.value:null)&&"par"!==o?"seq"===o?"seq":(U(a,"Illegal value of timeContainer (assuming 'par')"),"par"):"par")},T.prototype.initFromNode=function(e,t,n,i){y.prototype.initFromNode.call(this,e,null,t,i),b.prototype.initFromNode.call(this,e,null,t,i),_.prototype.initFromNode.call(this,e,null,t,i),v.prototype.initFromNode.call(this,e,null,t,i),E.prototype.initFromNode.call(this,e,null,t,i),this.lang=n},S.prototype.initFromNode=function(e,t,n,i,r){y.prototype.initFromNode.call(this,e,t,n,r),b.prototype.initFromNode.call(this,e,t,n,r),_.prototype.initFromNode.call(this,e,t,n,r),v.prototype.initFromNode.call(this,e,t,n,r),E.prototype.initFromNode.call(this,e,t,n,r),this.lang=i},w.prototype.initFromNode=function(e,t,n,i,r){y.prototype.initFromNode.call(this,e,t,n,r),b.prototype.initFromNode.call(this,e,t,n,r),_.prototype.initFromNode.call(this,e,t,n,r),v.prototype.initFromNode.call(this,e,t,n,r),E.prototype.initFromNode.call(this,e,t,n,r),this.lang=i},A.prototype.initFromNode=function(e,t,n,i,r,a){y.prototype.initFromNode.call(this,e,t,n,a),b.prototype.initFromNode.call(this,e,t,n,a),_.prototype.initFromNode.call(this,e,t,n,a),v.prototype.initFromNode.call(this,e,t,n,a),E.prototype.initFromNode.call(this,e,t,n,a),this.space=r,this.lang=i},R.prototype.initFromText=function(e,t,n,i,r,a){b.prototype.initFromNode.call(this,e,t,null,a),this.text=n,this.space=r,this.lang=i},x.prototype.initFromNode=function(e,t,n,i,r){v.prototype.initFromNode.call(this,e,t,n,r),b.prototype.initFromNode.call(this,e,t,n,r),this.lang=i},I.prototype.createDefaultRegion=function(e){var t=new I;return m.call(t,""),y.call(t,{}),_.call(t,[]),b.call(t,0,Number.POSITIVE_INFINITY,null),this.lang=e,t},I.prototype.initFromNode=function(e,t,n,i){m.prototype.initFromNode.call(this,e,null,t,i),b.prototype.initFromNode.call(this,e,null,t,i),_.prototype.initFromNode.call(this,e,null,t,i),this.styleAttrs=P(t,i),this.styleRefs=C(t),this.lang=n},L.prototype.initFromNode=function(e,t,n,i){b.prototype.initFromNode.call(this,e,t,n,i);var r=P(n,i);for(var a in this.qname=null,this.value=null,r)if(r.hasOwnProperty(a)){if(this.qname){U(i,"More than one style specified on set");break}this.qname=a,this.value=r[a]}}}(t,typeof sax>"u"?n(5378):sax,typeof imscNames>"u"?n(210):imscNames,typeof imscStyles>"u"?n(6811):imscStyles,typeof imscUtils>"u"?n(5926):imscUtils)},506:function(e,t,n){var i=/firefox/i.test(navigator.userAgent);!function(e,t,n){function r(e,t,d,f){var p;if("region"===d.kind)(p=document.createElement("div")).style.position="absolute";else if("body"===d.kind)p=document.createElement("div");else if("div"===d.kind)p=document.createElement("div");else if("image"===d.kind){if(p=document.createElement("img"),null!==e.imgResolver&&null!==d.src){var v=e.imgResolver(d.src,p);v&&(p.src=v),p.height=e.regionH,p.width=e.regionW}}else if("p"===d.kind)p=document.createElement("p");else if("span"===d.kind)if("container"===d.styleAttrs[n.byName.ruby.qname])p=document.createElement("ruby"),e.ruby=!0;else if("base"===d.styleAttrs[n.byName.ruby.qname])p=document.createElement("span");else if("text"===d.styleAttrs[n.byName.ruby.qname])p=document.createElement("rt");else if("baseContainer"===d.styleAttrs[n.byName.ruby.qname])p=document.createElement("rbc");else if("textContainer"===d.styleAttrs[n.byName.ruby.qname])p=document.createElement("rtc");else{if("delimiter"===d.styleAttrs[n.byName.ruby.qname])return;p=document.createElement("span")}else"br"===d.kind&&(p=document.createElement("br"));if(p){if(d.lang&&("region"!==d.kind&&d.lang===f.lang||(p.lang=d.lang)),t.appendChild(p),p.style.margin="0","region"===d.kind){var E=d.styleAttrs[n.byName.writingMode.qname];"lrtb"===E||"lr"===E?(e.ipd="lr",e.bpd="tb"):"rltb"===E||"rl"===E?(e.ipd="rl",e.bpd="tb"):"tblr"===E?(e.ipd="tb",e.bpd="lr"):"tbrl"!==E&&"tb"!==E||(e.ipd="tb",e.bpd="rl")}else if("p"===d.kind&&"tb"===e.bpd){var b=d.styleAttrs[n.byName.direction.qname];e.ipd="ltr"===b?"lr":"rl"}for(var T=0;T<h.length;T++){var S=h[T],w=d.styleAttrs[S.qname];void 0!==w&&null!==S.map&&S.map(e,p,d,w)}var A=p,R=d.styleAttrs[n.byName.linePadding.qname];if(R&&!R.isZero()){var x=R.toUsedLength(e.w,e.h);if(x>0){var I=Math.ceil(x)+"px";"tb"===e.bpd?(A.style.paddingLeft=I,A.style.paddingRight=I):(A.style.paddingTop=I,A.style.paddingBottom=I),e.lp=R}}var L=d.styleAttrs[n.byName.multiRowAlign.qname];if(L&&"auto"!==L){var M=document.createElement("span");M.style.display="inline-block",M.style.textAlign=L,p.appendChild(M),A=M,e.mra=L}var C=d.styleAttrs[n.byName.rubyReserve.qname];if(C&&"none"!==C[0]&&(e.rubyReserve=C),d.styleAttrs[n.byName.fillLineGap.qname]&&(e.flg=!0),"span"===d.kind&&d.text){var P=d.styleAttrs[n.byName.textEmphasis.qname];if(P&&"none"!==P.style&&(e.textEmphasis=!0),n.byName.textCombine.qname in d.styleAttrs&&"all"===d.styleAttrs[n.byName.textCombine.qname])p.textContent=d.text,p._isd_element=d,P&&u(e,p,0,P);else for(var D="",O=0;O<d.text.length;O++){D+=d.text.charAt(O);var N=d.text.charCodeAt(O);if(N<55296||N>56319||O===d.text.length-1){var k=document.createElement("span");k.textContent=D,P&&u(e,k,0,P),p.appendChild(k),D="",k._isd_element=d}}}if("contents"in d)for(var F=0;F<d.contents.length;F++)r(e,A,d.contents[F],d);var B=[];if("p"===d.kind&&(c(e,A,B,null),e.rubyReserve&&(function(e,t){for(var n=0;n<e.length;n++){var i,r,a=document.createElement("ruby"),o=document.createElement("span");o.textContent="​",a.appendChild(o);var s,l=t.rubyReserve[1].toUsedLength(t.w,t.h)+"px";"both"===t.rubyReserve[0]||"outside"===t.rubyReserve[0]&&1==e.length?((i=document.createElement("rtc")).style[m]=g?"after":"under",i.textContent="​",i.style.fontSize=l,(r=document.createElement("rtc")).style[m]=g?"before":"over",r.textContent="​",r.style.fontSize=l,a.appendChild(i),a.appendChild(r)):((i=document.createElement("rtc")).textContent="​",i.style.fontSize=l,s="after"===t.rubyReserve[0]||"outside"===t.rubyReserve[0]&&n>0?g?"after":"tb"===t.bpd||"rl"===t.bpd?"under":"over":g?"before":"tb"===t.bpd||"rl"===t.bpd?"over":"under",i.style[m]=s,a.appendChild(i));for(var c=null,u=0;u<e[n].rbc.length;u++)if("ruby"===e[n].rbc[u].localName){c=e[n].rbc[u];for(var d=0;d<c.style.length;d++)a.style.setProperty(c.style.item(d),c.style.getPropertyValue(c.style.item(d)));break}(c=c||e[n].elements[0].node).parentElement.insertBefore(a,c)}}(B,e),e.rubyReserve=null),(e.ruby||e.rubyReserve)&&(function(e,t){for(var n=0;n<e.length;n++)for(var i=0;i<e[n].rbc.length;i++){var r;e[n].rbc[i].style[m]||(r=g?0===n?"before":"after":"tb"===t.bpd||"rl"===t.bpd?0===n?"over":"under":0===n?"under":"over",e[n].rbc[i].style[m]=r)}}(B,e),e.ruby=null),e.textEmphasis&&(function(e,t){for(var n=0;n<e.length;n++)for(var i=0;i<e[n].te.length;i++){var r;e[n].te[i].style[y]&&"none"!==e[n].te[i].style[y]||(r="tb"===t.bpd?0===n?"left over":"left under":"rl"===t.bpd?0===n?"right under":"left under":0===n?"left under":"right under",e[n].te[i].style[y]=r)}}(B,e),e.textEmphasis=null),e.mra&&(function(e){for(var t=0;t<e.length-1;t++){var n=e[t].elements.length;if(0!==n&&!1===e[t].br){var i=document.createElement("br"),r=e[t].elements[n-1].node;r.parentElement.insertBefore(i,r.nextSibling)}}}(B),e.mra=null),e.lp&&(function(e,t,n){if(null!==e)for(var r=0;r<e.length;r++){var a=e[r].elements.length,o=Math.ceil(t)+"px",s="-"+Math.ceil(t)+"px";if(0!==a){var l=e[r].elements[e[r].start_elem],c=e[r].elements[e[r].end_elem];if(l===c){var u=l.node.getBoundingClientRect();if(0==u.width||0==u.height)continue}"lr"===n.ipd?(l.node.style.marginLeft=s,l.node.style.paddingLeft=o):"rl"===n.ipd?(l.node.style.paddingRight=o,l.node.style.marginRight=s):"tb"===n.ipd&&(l.node.style.paddingTop=o,l.node.style.marginTop=s),"lr"===n.ipd?(i||(c.node.style.marginRight=s),c.node.style.paddingRight=o):"rl"===n.ipd?(c.node.style.paddingLeft=o,i||(c.node.style.marginLeft=s)):"tb"===n.ipd&&(c.node.style.paddingBottom=o,c.node.style.marginBottom=s)}}}(B,e.lp.toUsedLength(e.w,e.h),e),e.lp=null),function(e,t){for(var n=0;n<e.length;n++)for(var i=e[n],r=1;r<i.elements.length;){var s=i.elements[r-1],l=i.elements[r];o(s.node,l.node,t)?i.elements.splice(r,1):r++}for(var c,u,d=[],h=0;h<e.length;h++)for(var f=0;f<e[h].elements.length;f++)(u=a(c=e[h].elements[f].node,d,!1))&&(c.style.backgroundColor=u);for(var p=0;p<d.length;p++)d[p].style.backgroundColor=""}(B,e),e.flg)){var U=l(A.getBoundingClientRect(),e);(function(e,t,n,i){for(var r=Math.sign(n-t),a=0;a<=e.length;a++){var o,s,l,c;if(o=0===a?Math.round(t):a===e.length?Math.round(n):Math.round((e[a-1].after+e[a].before)/2),a>0&&e[a-1])for(l=0;l<e[a-1].elements.length;l++)s=r*(o-(c=e[a-1].elements[l]).after)+"px","lr"===i.bpd?c.node.style.paddingRight=s:"rl"===i.bpd?c.node.style.paddingLeft=s:"tb"===i.bpd&&(c.node.style.paddingBottom=s);if(a<e.length)for(l=0;l<e[a].elements.length;l++)s=r*((c=e[a].elements[l]).before-o)+"px","lr"===i.bpd?c.node.style.paddingLeft=s:"rl"===i.bpd?c.node.style.paddingRight=s:"tb"===i.bpd&&(c.node.style.paddingTop=s)}})(B,U.before,U.after,e),e.flg=null}if("region"===d.kind&&"tb"===e.bpd&&e.enableRollUp&&d.contents.length>0&&"after"===d.styleAttrs[n.byName.displayAlign.qname]){c(e,A,B,null);var V=new s(""===d.id?"_":d.id,B);if(e.currentISDState[V.id]=V,e.previousISDState&&V.id in e.previousISDState&&e.previousISDState[V.id].plist.length>0&&V.plist.length>1&&V.plist[V.plist.length-2].text===e.previousISDState[V.id].plist[e.previousISDState[V.id].plist.length-1].text){var G=p.firstElementChild,H=V.plist[V.plist.length-1].after-V.plist[V.plist.length-1].before;G.style.bottom="-"+H+"px",G.style.transition="transform 0.4s",G.style.position="relative",G.style.transform="translateY(-"+H+"px)"}}}else _(e.errorHandler,"Error processing ISD element kind: "+d.kind)}function a(e,t,n){return e.style.backgroundColor?(n&&!t.includes(e)&&t.push(e),e.style.backgroundColor):"SPAN"===e.parentElement.nodeName||"RUBY"===e.parentElement.nodeName||"RBC"===e.parentElement.nodeName||"RTC"===e.parentElement.nodeName||"RT"===e.parentElement.nodeName?a(e.parentElement,t,!0):void 0}function o(e,t,n){if("SPAN"===e.tagName&&"SPAN"===t.tagName&&e._isd_element===t._isd_element){if(!e._isd_element)return _(n.errorHandler,"Internal error: HTML span is not linked to a source element; cannot merge spans."),!1;e.textContent+=t.textContent;for(var i=0;i<t.style.length;i++){var r=t.style[i];(r.indexOf("border")>=0||r.indexOf("padding")>=0||r.indexOf("margin")>=0)&&(e.style[r]=t.style[r])}return t.parentElement.removeChild(t),!0}return!1}function s(e,t){this.id=e,this.plist=t}function l(e,t){var n={before:null,after:null,start:null,end:null};return"tb"===t.bpd?(n.before=e.top,n.after=e.bottom,"lr"===t.ipd?(n.start=e.left,n.end=e.right):(n.start=e.right,n.end=e.left)):"lr"===t.bpd?(n.before=e.left,n.after=e.right,n.start=e.top,n.end=e.bottom):"rl"===t.bpd&&(n.before=e.right,n.after=e.left,n.start=e.top,n.end=e.bottom),n}function c(e,t,n,i){if("rt"!==t.localName&&"rtc"!==t.localName){var r,a,o,s,u=t.style.backgroundColor||i;if(0===t.childElementCount)if("span"===t.localName||"rb"===t.localName){var d=l(t.getBoundingClientRect(),e);if(0!==n.length&&(r=d.before,a=d.after,o=n[n.length-1].before,a<(s=n[n.length-1].after)&&r>o||s<=a&&o>=r)){var h=Math.sign(d.after-d.before),f=Math.sign(d.end-d.start);h*(d.before-n[n.length-1].before)<0&&(n[n.length-1].before=d.before),h*(d.after-n[n.length-1].after)>0&&(n[n.length-1].after=d.after),f*(d.start-n[n.length-1].start)<0&&(n[n.length-1].start=d.start,n[n.length-1].start_elem=n[n.length-1].elements.length),f*(d.end-n[n.length-1].end)>0&&(n[n.length-1].end=d.end,n[n.length-1].end_elem=n[n.length-1].elements.length)}else n.push({before:d.before,after:d.after,start:d.start,end:d.end,start_elem:0,end_elem:0,elements:[],rbc:[],te:[],text:"",br:!1});n[n.length-1].text+=t.textContent,n[n.length-1].elements.push({node:t,bgcolor:u,before:d.before,after:d.after})}else"br"===t.localName&&0!==n.length&&(n[n.length-1].br=!0);else for(var p=t.firstChild;p;)p.nodeType===Node.ELEMENT_NODE&&(c(e,p,n,u),"ruby"===p.localName||"rtc"===p.localName?n.length>0&&n[n.length-1].rbc.push(p):"span"===p.localName&&p.style[v]&&"none"!==p.style[v]&&n.length>0&&n[n.length-1].te.push(p)),p=p.nextSibling}}function u(e,t,n,i){var r;"none"!==i.style&&("auto"===i.style?t.style[v]="filled":t.style[v]=i.style+" "+i.symbol,("before"===i.position||"after"===i.position)&&(r="tb"===e.bpd?"before"===i.position?"left over":"left under":"rl"===e.bpd?"before"===i.position?"right under":"left under":"before"===i.position?"left under":"right under",t.style[y]=r))}function d(e,t){this.qname=e,this.map=t}e.render=function(e,t,n,i,a,o,s,l,c){var u=i||t.clientHeight,d=a||t.clientWidth;if(null!==e.aspectRatio){var h=u*e.aspectRatio;h>d?u=Math.round(d/e.aspectRatio):d=h}var f=document.createElement("div");f.style.position="relative",f.style.width=d+"px",f.style.height=u+"px",f.style.margin="auto",f.style.top=0,f.style.bottom=0,f.style.left=0,f.style.right=0,f.style.zIndex=0;var p={h:u,w:d,regionH:null,regionW:null,imgResolver:n,displayForcedOnlyMode:o||!1,isd:e,errorHandler:s,previousISDState:l,enableRollUp:c||!1,currentISDState:{},flg:null,lp:null,mra:null,ipd:null,bpd:null,ruby:null,textEmphasis:null,rubyReserve:null};if(t.appendChild(f),"contents"in e)for(var g=0;g<e.contents.length;g++)r(p,f,e.contents[g],e);return p.currentISDState};for(var h=[new d("http://www.w3.org/ns/ttml#styling backgroundColor",function(e,t,n,i){0!==i[3]&&(t.style.backgroundColor="rgba("+i[0].toString()+","+i[1].toString()+","+i[2].toString()+","+(i[3]/255).toString()+")")}),new d("http://www.w3.org/ns/ttml#styling color",function(e,t,n,i){t.style.color="rgba("+i[0].toString()+","+i[1].toString()+","+i[2].toString()+","+(i[3]/255).toString()+")"}),new d("http://www.w3.org/ns/ttml#styling direction",function(e,t,n,i){t.style.direction=i}),new d("http://www.w3.org/ns/ttml#styling display",function(e,t,n,i){}),new d("http://www.w3.org/ns/ttml#styling displayAlign",function(e,t,n,i){t.style.display="flex",t.style.flexDirection="column","before"===i?t.style.justifyContent="flex-start":"center"===i?t.style.justifyContent="center":"after"===i&&(t.style.justifyContent="flex-end")}),new d("http://www.w3.org/ns/ttml#styling extent",function(e,t,n,i){e.regionH=i.h.toUsedLength(e.w,e.h),e.regionW=i.w.toUsedLength(e.w,e.h);var r=0,a=0,o=n.styleAttrs["http://www.w3.org/ns/ttml#styling padding"];o&&(r=o[0].toUsedLength(e.w,e.h)+o[2].toUsedLength(e.w,e.h),a=o[1].toUsedLength(e.w,e.h)+o[3].toUsedLength(e.w,e.h)),t.style.height=e.regionH-r+"px",t.style.width=e.regionW-a+"px"}),new d("http://www.w3.org/ns/ttml#styling fontFamily",function(e,t,n,i){for(var r=[],a=0;a<i.length;a++)i[a]=i[a].trim(),"monospaceSerif"===i[a]?(r.push("Courier New"),r.push('"Liberation Mono"'),r.push("Courier"),r.push("monospace")):"proportionalSansSerif"===i[a]?(r.push("Arial"),r.push("Helvetica"),r.push('"Liberation Sans"'),r.push("sans-serif")):"monospace"===i[a]?r.push("monospace"):"sansSerif"===i[a]?r.push("sans-serif"):"serif"===i[a]?r.push("serif"):"monospaceSansSerif"===i[a]?(r.push("Consolas"),r.push("monospace")):"proportionalSerif"===i[a]?r.push("serif"):r.push(i[a]);if(r.length>0){for(var o=[r[0]],s=1;s<r.length;s++)-1==o.indexOf(r[s])&&o.push(r[s]);r=o}t.style.fontFamily=r.join(",")}),new d("http://www.w3.org/ns/ttml#styling shear",function(e,t,n,i){if(0!==i){var r=-.9*i;"tb"===e.bpd?t.style.transform="skewX("+r+"deg)":t.style.transform="skewY("+r+"deg)"}}),new d("http://www.w3.org/ns/ttml#styling fontSize",function(e,t,n,i){t.style.fontSize=i.toUsedLength(e.w,e.h)+"px"}),new d("http://www.w3.org/ns/ttml#styling fontStyle",function(e,t,n,i){t.style.fontStyle=i}),new d("http://www.w3.org/ns/ttml#styling fontWeight",function(e,t,n,i){t.style.fontWeight=i}),new d("http://www.w3.org/ns/ttml#styling lineHeight",function(e,t,n,i){t.style.lineHeight="normal"===i?"normal":i.toUsedLength(e.w,e.h)+"px"}),new d("http://www.w3.org/ns/ttml#styling opacity",function(e,t,n,i){t.style.opacity=i}),new d("http://www.w3.org/ns/ttml#styling origin",function(e,t,n,i){t.style.top=i.h.toUsedLength(e.w,e.h)+"px",t.style.left=i.w.toUsedLength(e.w,e.h)+"px"}),new d("http://www.w3.org/ns/ttml#styling overflow",function(e,t,n,i){t.style.overflow=i}),new d("http://www.w3.org/ns/ttml#styling padding",function(e,t,n,i){var r=[];r[0]=i[0].toUsedLength(e.w,e.h)+"px",r[1]=i[3].toUsedLength(e.w,e.h)+"px",r[2]=i[2].toUsedLength(e.w,e.h)+"px",r[3]=i[1].toUsedLength(e.w,e.h)+"px",t.style.padding=r.join(" ")}),new d("http://www.w3.org/ns/ttml#styling position",function(e,t,n,i){t.style.top=i.h.toUsedLength(e.w,e.h)+"px",t.style.left=i.w.toUsedLength(e.w,e.h)+"px"}),new d("http://www.w3.org/ns/ttml#styling rubyAlign",function(e,t,n,i){t.style.rubyAlign="spaceAround"===i?"space-around":"center"}),new d("http://www.w3.org/ns/ttml#styling rubyPosition",function(e,t,n,i){var r;"before"!==i&&"after"!==i||(r=g?i:"tb"===e.bpd||"rl"===e.bpd?"before"===i?"over":"under":"before"===i?"under":"over",t.parentElement.style[m]=r)}),new d("http://www.w3.org/ns/ttml#styling showBackground",null),new d("http://www.w3.org/ns/ttml#styling textAlign",function(e,t,n,i){var r;r="start"===i?"rl"===e.ipd?"right":"left":"end"===i?"rl"===e.ipd?"left":"right":i,t.style.textAlign=r}),new d("http://www.w3.org/ns/ttml#styling textDecoration",function(e,t,n,i){t.style.textDecoration=i.join(" ").replace("lineThrough","line-through")}),new d("http://www.w3.org/ns/ttml#styling textOutline",function(e,t,n,i){}),new d("http://www.w3.org/ns/ttml#styling textShadow",function(e,t,i,r){var a=i.styleAttrs[n.byName.textOutline.qname];if("none"===r&&"none"===a)t.style.textShadow="";else{var o=[];if("none"!==a){var s="rgba("+a.color[0].toString()+","+a.color[1].toString()+","+a.color[2].toString()+","+(a.color[3]/255).toString()+")";o.push("1px 1px 1px "+s),o.push("-1px 1px 1px "+s),o.push("1px -1px 1px "+s),o.push("-1px -1px 1px "+s)}if("none"!==r)for(var l=0;l<r.length;l++)o.push(r[l].x_off.toUsedLength(e.w,e.h)+"px "+r[l].y_off.toUsedLength(e.w,e.h)+"px "+r[l].b_radius.toUsedLength(e.w,e.h)+"px rgba("+r[l].color[0].toString()+","+r[l].color[1].toString()+","+r[l].color[2].toString()+","+(r[l].color[3]/255).toString()+")");t.style.textShadow=o.join(",")}}),new d("http://www.w3.org/ns/ttml#styling textCombine",function(e,t,n,i){t.style.textCombineUpright=i}),new d("http://www.w3.org/ns/ttml#styling textEmphasis",function(e,t,n,i){}),new d("http://www.w3.org/ns/ttml#styling unicodeBidi",function(e,t,n,i){var r;r="bidiOverride"===i?"bidi-override":i,t.style.unicodeBidi=r}),new d("http://www.w3.org/ns/ttml#styling visibility",function(e,t,n,i){t.style.visibility=i}),new d("http://www.w3.org/ns/ttml#styling wrapOption",function(e,t,n,i){"wrap"===i?"preserve"===n.space?t.style.whiteSpace="pre-wrap":t.style.whiteSpace="normal":"preserve"===n.space?t.style.whiteSpace="pre":t.style.whiteSpace="noWrap"}),new d("http://www.w3.org/ns/ttml#styling writingMode",function(e,t,n,i){"lrtb"===i||"lr"===i||"rltb"===i||"rl"===i?t.style.writingMode="horizontal-tb":"tblr"===i?t.style.writingMode="vertical-lr":"tbrl"!==i&&"tb"!==i||(t.style.writingMode="vertical-rl")}),new d("http://www.w3.org/ns/ttml#styling zIndex",function(e,t,n,i){t.style.zIndex=i}),new d("http://www.w3.org/ns/ttml/profile/imsc1#styling forcedDisplay",function(e,t,n,i){e.displayForcedOnlyMode&&!1===i&&(t.style.visibility="hidden")})],f={},p=0;p<h.length;p++)f[h[p].qname]=h[p];var g="webkitRubyPosition"in window.getComputedStyle(document.documentElement),m=g?"webkitRubyPosition":"rubyPosition",v="webkitTextEmphasisStyle"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisStyle":"textEmphasisStyle",y="webkitTextEmphasisPosition"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisPosition":"textEmphasisPosition";function _(e,t){if(e&&e.error&&e.error(t))throw t}}(t,typeof imscNames>"u"?n(210):imscNames,typeof imscStyles>"u"?n(6811):imscStyles,typeof imscUtils>"u"?n(5926):imscUtils)},4080:function(e,t,n){!function(e,t,n,i){e.generateISD=function(e,t,i){var r,o=new l(e),s={},c={},u=e.head.styling.initials[n.byName.showBackground.qname],d=e.head.styling.initials[n.byName.backgroundColor.qname];for(var h in e.head.layout.regions)if(e.head.layout.regions.hasOwnProperty(h)){var f=e.head.layout.regions[h],p=f.styleAttrs[n.byName.showBackground.qname]||u,g=f.styleAttrs[n.byName.backgroundColor.qname]||d;c[f.id]=("always"===p||void 0===p)&&void 0!==g&&!(t<f.begin||t>=f.end)}for(var m in e.body&&e.body.regionID&&(c[e.body.regionID]=!0),r=null!==e.body?function e(t,n){if(n.contents){var i={};for(var r in n)n.hasOwnProperty(r)&&(i[r]=n[r]);return i.contents=[],n.contents.filter(function(e){return!(t<e.begin||t>=e.end)}).forEach(function(n){var r=e(t,n);r.regionID&&(c[r.regionID]=!0),null!==r&&i.contents.push(r)}),i}return n}(t,e.body):null,void 0!==c[""]&&(c[""]=!0),c)if(c[m]){var v=a(e,t,e.head.layout.regions[m],r,null,"",e.head.layout.regions[m],i,s);null!==v&&o.contents.push(v.element)}return o};var r=[n.byName.color.qname,n.byName.textCombine.qname,n.byName.textDecoration.qname,n.byName.textEmphasis.qname,n.byName.textOutline.qname,n.byName.textShadow.qname];function a(e,t,l,d,h,f,p,g,m){if(t<p.begin||t>=p.end)return null;var v="regionID"in p&&""!==p.regionID?p.regionID:f;if(null!==h&&v!==l.id&&(!("contents"in p)||"contents"in p&&0===p.contents.length||""!==v))return null;var y=new c(p);if("sets"in p)for(var _=0;_<p.sets.length;_++)t<p.sets[_].begin||t>=p.sets[_].end||(y.styleAttrs[p.sets[_].qname]=p.sets[_].value);var E={};for(var b in y.styleAttrs)if(y.styleAttrs.hasOwnProperty(b)&&(E[b]=!0,"region"===y.kind&&b===n.byName.writingMode.qname&&!(n.byName.direction.qname in y.styleAttrs))){var T=y.styleAttrs[b];"lrtb"===T||"lr"===T?y.styleAttrs[n.byName.direction.qname]="ltr":"rltb"!==T&&"rl"!==T||(y.styleAttrs[n.byName.direction.qname]="rtl")}if(null!==h)for(var S=0;S<n.all.length;S++){var w=n.all[S];if(w.qname===n.byName.textDecoration.qname){var A=h.styleAttrs[w.qname],R=y.styleAttrs[w.qname],x=[];void 0===R?x=A:-1===R.indexOf("none")?((-1===R.indexOf("noUnderline")&&-1!==A.indexOf("underline")||-1!==R.indexOf("underline"))&&x.push("underline"),(-1===R.indexOf("noLineThrough")&&-1!==A.indexOf("lineThrough")||-1!==R.indexOf("lineThrough"))&&x.push("lineThrough"),(-1===R.indexOf("noOverline")&&-1!==A.indexOf("overline")||-1!==R.indexOf("overline"))&&x.push("overline")):x.push("none"),y.styleAttrs[w.qname]=x}else if(w.qname!==n.byName.fontSize.qname||w.qname in y.styleAttrs||"span"!==y.kind||"textContainer"!==y.styleAttrs[n.byName.ruby.qname])if(w.qname!==n.byName.fontSize.qname||w.qname in y.styleAttrs||"span"!==y.kind||"text"!==y.styleAttrs[n.byName.ruby.qname])w.inherit&&w.qname in h.styleAttrs&&!(w.qname in y.styleAttrs)&&(y.styleAttrs[w.qname]=h.styleAttrs[w.qname]);else{var I=h.styleAttrs[n.byName.fontSize.qname];"textContainer"===h.styleAttrs[n.byName.ruby.qname]?y.styleAttrs[w.qname]=I:y.styleAttrs[w.qname]=new i.ComputedLength(.5*I.rw,.5*I.rh)}else{var L=h.styleAttrs[n.byName.fontSize.qname];y.styleAttrs[w.qname]=new i.ComputedLength(.5*L.rw,.5*L.rh)}}for(var M=0;M<n.all.length;M++){var C=n.all[M];if(!(C.qname in y.styleAttrs)&&!(C.qname===n.byName.position.qname&&n.byName.origin.qname in y.styleAttrs||C.qname===n.byName.origin.qname&&n.byName.position.qname in y.styleAttrs)){var P=e.head.styling.initials[C.qname]||C.initial;if(null!==P&&("region"===y.kind||!1===C.inherit&&null!==P)){var D=C.parse(P);null!==D?(y.styleAttrs[C.qname]=D,E[C.qname]=!0):u(g,"Invalid initial value for '"+C.qname+"' on element '"+y.kind)}}}for(var O=0;O<n.all.length;O++){var N=n.all[O];if(N.qname in E&&null!==N.compute){var k=N.compute(e,h,y,y.styleAttrs[N.qname],m);null!==k?y.styleAttrs[N.qname]=k:(y.styleAttrs[N.qname]=N.compute(e,h,y,N.parse(N.initial),m),u(g,"Style '"+N.qname+"' on element '"+y.kind+"' cannot be computed"))}}if("none"===y.styleAttrs[n.byName.display.qname])return null;var F=null;null===h?F=null===d?[]:[d]:"contents"in p&&(F=p.contents);for(var B=0;null!==F&&B<F.length;B++){var U=a(e,t,l,d,y,v,F[B],g,m);null!==U&&y.contents.push(U.element)}for(var V in y.styleAttrs)if(y.styleAttrs.hasOwnProperty(V)){var G=!1;if("span"===y.kind){var H=y.styleAttrs[n.byName.ruby.qname];(G=("container"===H||"textContainer"===H||"baseContainer"===H)&&-1!==r.indexOf(V))||(G="container"!==H&&V===n.byName.rubyAlign.qname),G||(G=!("textContainer"===H||"text"===H)&&V===n.byName.rubyPosition.qname)}if(!G){var j=n.byQName[V];"applies"in j&&(G=-1===j.applies.indexOf(y.kind))}G&&delete y.styleAttrs[V]}var z=y.styleAttrs[n.byName.ruby.qname];if("p"===y.kind||"span"===y.kind&&("textContainer"===z||"text"===z)){var Z=[];o(y,Z),function(e){for(var t,n=0;n<e.length;)if("br"!==(t=e[n]).kind&&"preserve"!==t.space){var i=t.text.replace(/[\t\r\n ]+/g," ");/^[ ]/.test(i)&&(0===n||"br"===(r=e[n-1]).kind||/[\r\n\t ]$/.test(r.text))&&(i=i.substring(1)),t.text=i,0===i.length?e.splice(n,1):n++}else n++;var r,a;for(n=0;n<e.length;n++)"br"!==(t=e[n]).kind&&"preserve"!==t.space?/[ ]$/.test(t.text)&&(n===e.length-1||"br"===(a=e[n+1]).kind||"preserve"===a.space&&/^[\r\n]/.test(a.text))&&(t.text=t.text.slice(0,-1)):n++}(Z),s(y)}return"div"===y.kind&&n.byName.backgroundImage.qname in y.styleAttrs||"br"===y.kind||"image"===y.kind||"contents"in y&&y.contents.length>0||"span"===y.kind&&null!==y.text||"region"===y.kind&&"always"===y.styleAttrs[n.byName.showBackground.qname]?{region_id:v,element:y}:null}function o(e,t){if("contents"in e)for(var i=0;i<e.contents.length;i++){var r=e.contents[i],a=r.styleAttrs[n.byName.ruby.qname];("span"!==r.kind||"textContainer"!==a&&"text"!==a)&&("contents"in r?o(r,t):("span"===r.kind&&0!==r.text.length||"br"===r.kind)&&t.push(r))}}function s(e){if("br"===e.kind)return!1;if("text"in e)return 0===e.text.length;if("contents"in e){for(var t=e.contents.length;t--;)s(e.contents[t])&&e.contents.splice(t,1);return 0===e.contents.length}}function l(e){this.contents=[],this.aspectRatio=e.aspectRatio,this.lang=e.lang}function c(e){for(var t in this.kind=e.kind||"region",this.lang=e.lang,e.id&&(this.id=e.id),this.styleAttrs={},e.styleAttrs)e.styleAttrs.hasOwnProperty(t)&&(this.styleAttrs[t]=e.styleAttrs[t]);"src"in e&&(this.src=e.src),"type"in e&&(this.type=e.type),"text"in e?this.text=e.text:("region"===this.kind||"contents"in e)&&(this.contents=[]),"space"in e&&(this.space=e.space)}function u(e,t){if(e&&e.error&&e.error(t))throw t}}(t,typeof imscNames>"u"?n(210):imscNames,typeof imscStyles>"u"?n(6811):imscStyles,typeof imscUtils>"u"?n(5926):imscUtils)},4403:function(e,t,n){t.generateISD=n(4080).generateISD,t.fromXML=n(3362).fromXML,t.renderHTML=n(506).render},210:function(e,t){var n;(n=t).ns_tt="http://www.w3.org/ns/ttml",n.ns_tts="http://www.w3.org/ns/ttml#styling",n.ns_ttp="http://www.w3.org/ns/ttml#parameter",n.ns_xml="http://www.w3.org/XML/1998/namespace",n.ns_itts="http://www.w3.org/ns/ttml/profile/imsc1#styling",n.ns_ittp="http://www.w3.org/ns/ttml/profile/imsc1#parameter",n.ns_smpte="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt",n.ns_ebutts="urn:ebu:tt:style"},6811:function(e,t,n){!function(e,t,n){function i(e,t,n,i,r,a,o,s){this.name=t,this.ns=e,this.qname=e+" "+t,this.inherit=r,this.animatable=a,this.initial=n,this.applies=i,this.parse=o,this.compute=s}for(var r in e.all=[new i(t.ns_tts,"backgroundColor","transparent",["body","div","p","region","span"],!1,!0,n.parseColor,null),new i(t.ns_tts,"color","white",["span"],!0,!0,n.parseColor,null),new i(t.ns_tts,"direction","ltr",["p","span"],!0,!0,function(e){return e},null),new i(t.ns_tts,"display","auto",["body","div","p","region","span"],!1,!0,function(e){return e},null),new i(t.ns_tts,"displayAlign","before",["region"],!1,!0,function(e){return e},null),new i(t.ns_tts,"extent","auto",["tt","region"],!1,!0,function(e){if("auto"===e)return e;var t=e.split(" ");if(2!==t.length)return null;var i=n.parseLength(t[0]),r=n.parseLength(t[1]);return r&&i?{h:r,w:i}:null},function(e,t,i,r,a){var o,s;if("auto"===r)o=new n.ComputedLength(0,1);else if(null===(o=n.toComputedLength(r.h.value,r.h.unit,null,e.dimensions.h,null,e.pxLength.h)))return null;if("auto"===r)s=new n.ComputedLength(1,0);else if(null===(s=n.toComputedLength(r.w.value,r.w.unit,null,e.dimensions.w,null,e.pxLength.w)))return null;return{h:o,w:s}}),new i(t.ns_tts,"fontFamily","default",["span","p"],!0,!0,function(e){for(var t=e.split(","),n=[],i=0;i<t.length;i++)t[i]=t[i].trim(),"'"!==t[i].charAt(0)&&'"'!==t[i].charAt(0)&&"default"===t[i]?n.push("monospaceSerif"):n.push(t[i]);return n},null),new i(t.ns_tts,"shear","0%",["p"],!0,!0,n.parseLength,function(e,t,n,i){return"%"!==i.unit?null:Math.abs(i.value)>100?100*Math.sign(i.value):i.value}),new i(t.ns_tts,"fontSize","1c",["span","p"],!0,!0,n.parseLength,function(t,i,r,a,o){return n.toComputedLength(a.value,a.unit,null!==i?i.styleAttrs[e.byName.fontSize.qname]:t.cellLength.h,null!==i?i.styleAttrs[e.byName.fontSize.qname]:t.cellLength.h,t.cellLength.h,t.pxLength.h)}),new i(t.ns_tts,"fontStyle","normal",["span","p"],!0,!0,function(e){return e},null),new i(t.ns_tts,"fontWeight","normal",["span","p"],!0,!0,function(e){return e},null),new i(t.ns_tts,"lineHeight","normal",["p"],!0,!0,function(e){return"normal"===e?e:n.parseLength(e)},function(t,i,r,a,o){var s;if("normal"===a)s=a;else if(null===(s=n.toComputedLength(a.value,a.unit,r.styleAttrs[e.byName.fontSize.qname],r.styleAttrs[e.byName.fontSize.qname],t.cellLength.h,t.pxLength.h)))return null;return s}),new i(t.ns_tts,"opacity",1,["region"],!1,!0,parseFloat,null),new i(t.ns_tts,"origin","auto",["region"],!1,!0,function(e){if("auto"===e)return e;var t=e.split(" ");if(2!==t.length)return null;var i=n.parseLength(t[0]),r=n.parseLength(t[1]);return r&&i?{h:r,w:i}:null},function(e,t,i,r,a){var o,s;if("auto"===r)o=new n.ComputedLength(0,0);else if(null===(o=n.toComputedLength(r.h.value,r.h.unit,null,e.dimensions.h,null,e.pxLength.h)))return null;if("auto"===r)s=new n.ComputedLength(0,0);else if(null===(s=n.toComputedLength(r.w.value,r.w.unit,null,e.dimensions.w,null,e.pxLength.w)))return null;return{h:o,w:s}}),new i(t.ns_tts,"overflow","hidden",["region"],!1,!0,function(e){return e},null),new i(t.ns_tts,"padding","0px",["region"],!1,!0,function(e){var t=e.split(" ");if(t.length>4)return null;for(var i=[],r=0;r<t.length;r++){var a=n.parseLength(t[r]);if(!a)return null;i.push(a)}return i},function(t,i,r,a,o){var s;if(1===a.length)s=[a[0],a[0],a[0],a[0]];else if(2===a.length)s=[a[0],a[1],a[0],a[1]];else if(3===a.length)s=[a[0],a[1],a[2],a[1]];else{if(4!==a.length)return null;s=[a[0],a[1],a[2],a[3]]}var l=r.styleAttrs[e.byName.writingMode.qname];if("lrtb"===l||"lr"===l)s=[s[0],s[3],s[2],s[1]];else if("rltb"===l||"rl"===l)s=[s[0],s[1],s[2],s[3]];else if("tblr"===l)s=[s[3],s[0],s[1],s[2]];else{if("tbrl"!==l&&"tb"!==l)return null;s=[s[3],s[2],s[1],s[0]]}for(var c=[],u=0;u<s.length;u++)if(0===s[u].value)c[u]=new n.ComputedLength(0,0);else if(c[u]=n.toComputedLength(s[u].value,s[u].unit,r.styleAttrs[e.byName.fontSize.qname],0===u||2===u?r.styleAttrs[e.byName.extent.qname].h:r.styleAttrs[e.byName.extent.qname].w,0===u||2===u?t.cellLength.h:t.cellLength.w,0===u||2===u?t.pxLength.h:t.pxLength.w),null===c[u])return null;return c}),new i(t.ns_tts,"position","top left",["region"],!1,!0,function(e){return n.parsePosition(e)},function(t,i,r,a){var o,s;return null===(o=n.toComputedLength(a.v.offset.value,a.v.offset.unit,null,new n.ComputedLength(-r.styleAttrs[e.byName.extent.qname].h.rw,t.dimensions.h.rh-r.styleAttrs[e.byName.extent.qname].h.rh),null,t.pxLength.h))?null:("bottom"===a.v.edge&&(o=new n.ComputedLength(-o.rw-r.styleAttrs[e.byName.extent.qname].h.rw,t.dimensions.h.rh-o.rh-r.styleAttrs[e.byName.extent.qname].h.rh)),s=n.toComputedLength(a.h.offset.value,a.h.offset.unit,null,new n.ComputedLength(t.dimensions.w.rw-r.styleAttrs[e.byName.extent.qname].w.rw,-r.styleAttrs[e.byName.extent.qname].w.rh),null,t.pxLength.w),null===o?null:("right"===a.h.edge&&(s=new n.ComputedLength(t.dimensions.w.rw-s.rw-r.styleAttrs[e.byName.extent.qname].w.rw,-s.rh-r.styleAttrs[e.byName.extent.qname].w.rh)),{h:o,w:s}))}),new i(t.ns_tts,"ruby","none",["span"],!1,!0,function(e){return e},null),new i(t.ns_tts,"rubyAlign","center",["span"],!0,!0,function(e){return"center"!==e&&"spaceAround"!==e?null:e},null),new i(t.ns_tts,"rubyPosition","outside",["span"],!0,!0,function(e){return e},null),new i(t.ns_tts,"rubyReserve","none",["p"],!0,!0,function(e){var t=e.split(" "),i=[null,null];if(0===t.length||t.length>2||"none"!==t[0]&&"both"!==t[0]&&"after"!==t[0]&&"before"!==t[0]&&"outside"!==t[0])return null;if(i[0]=t[0],2===t.length&&"none"!==t[0]){var r=n.parseLength(t[1]);if(!r)return null;i[1]=r}return i},function(t,i,r,a,o){return"none"===a[0]?a:null===(s=null===a[1]?new n.ComputedLength(.5*r.styleAttrs[e.byName.fontSize.qname].rw,.5*r.styleAttrs[e.byName.fontSize.qname].rh):n.toComputedLength(a[1].value,a[1].unit,r.styleAttrs[e.byName.fontSize.qname],r.styleAttrs[e.byName.fontSize.qname],t.cellLength.h,t.pxLength.h))?null:[a[0],s];var s}),new i(t.ns_tts,"showBackground","always",["region"],!1,!0,function(e){return e},null),new i(t.ns_tts,"textAlign","start",["p"],!0,!0,function(e){return e},function(e,t,n,i,r){return"left"===i?"start":"right"===i?"end":i}),new i(t.ns_tts,"textCombine","none",["span"],!0,!0,function(e){return"none"===e||"all"===e?e:null},null),new i(t.ns_tts,"textDecoration","none",["span"],!0,!0,function(e){return e.split(" ")},null),new i(t.ns_tts,"textEmphasis","none",["span"],!0,!0,function(e){for(var t=e.split(" "),i={style:null,symbol:null,color:null,position:null},r=0;r<t.length;r++)if("none"===t[r]||"auto"===t[r])i.style=t[r];else if("filled"===t[r]||"open"===t[r])i.style=t[r];else if("circle"===t[r]||"dot"===t[r]||"sesame"===t[r])i.symbol=t[r];else if("current"===t[r])i.color=t[r];else if("outside"===t[r]||"before"===t[r]||"after"===t[r])i.position=t[r];else if(i.color=n.parseColor(t[r]),null===i.color)return null;return null==i.style&&null==i.symbol?i.style="auto":(i.symbol=i.symbol||"circle",i.style=i.style||"filled"),i.position=i.position||"outside",i.color=i.color||"current",i},null),new i(t.ns_tts,"textOutline","none",["span"],!0,!0,function(e){if("none"===e)return e;var t={},i=e.split(" ");if(0===i.length||i.length>2)return null;var r=n.parseColor(i[0]);if(t.color=r,null!==r&&i.shift(),1!==i.length)return null;var a=n.parseLength(i[0]);return a?(t.thickness=a,t):null},function(t,i,r,a,o){if("none"===a)return a;var s={};return null===a.color?s.color=r.styleAttrs[e.byName.color.qname]:s.color=a.color,s.thickness=n.toComputedLength(a.thickness.value,a.thickness.unit,r.styleAttrs[e.byName.fontSize.qname],r.styleAttrs[e.byName.fontSize.qname],t.cellLength.h,t.pxLength.h),null===s.thickness?null:s}),new i(t.ns_tts,"textShadow","none",["span"],!0,!0,n.parseTextShadow,function(t,i,r,a){if("none"===a)return a;for(var o=[],s=0;s<a.length;s++){var l={};if(l.x_off=n.toComputedLength(a[s][0].value,a[s][0].unit,null,r.styleAttrs[e.byName.fontSize.qname],null,t.pxLength.w),null===l.x_off||(l.y_off=n.toComputedLength(a[s][1].value,a[s][1].unit,null,r.styleAttrs[e.byName.fontSize.qname],null,t.pxLength.h),null===l.y_off))return null;if(null===a[s][2])l.b_radius=0;else if(l.b_radius=n.toComputedLength(a[s][2].value,a[s][2].unit,null,r.styleAttrs[e.byName.fontSize.qname],null,t.pxLength.h),null===l.b_radius)return null;null===a[s][3]?l.color=r.styleAttrs[e.byName.color.qname]:l.color=a[s][3],o.push(l)}return o}),new i(t.ns_tts,"unicodeBidi","normal",["span","p"],!1,!0,function(e){return e},null),new i(t.ns_tts,"visibility","visible",["body","div","p","region","span"],!0,!0,function(e){return e},null),new i(t.ns_tts,"wrapOption","wrap",["span"],!0,!0,function(e){return e},null),new i(t.ns_tts,"writingMode","lrtb",["region"],!1,!0,function(e){return e},null),new i(t.ns_tts,"zIndex","auto",["region"],!1,!0,function(e){var t;return"auto"===e?t=e:(t=parseInt(e),isNaN(t)&&(t=null)),t},null),new i(t.ns_ebutts,"linePadding","0c",["p"],!0,!1,n.parseLength,function(e,t,i,r,a){return n.toComputedLength(r.value,r.unit,null,null,e.cellLength.w,null)}),new i(t.ns_ebutts,"multiRowAlign","auto",["p"],!0,!1,function(e){return e},null),new i(t.ns_smpte,"backgroundImage",null,["div"],!1,!1,function(e){return e},null),new i(t.ns_itts,"forcedDisplay","false",["body","div","p","region","span"],!0,!0,function(e){return"true"===e},null),new i(t.ns_itts,"fillLineGap","false",["p"],!0,!0,function(e){return"true"===e},null)],e.byQName={},e.all)e.byQName[e.all[r].qname]=e.all[r];for(var a in e.byName={},e.all)e.byName[e.all[a].name]=e.all[a]}(t,typeof imscNames>"u"?n(210):imscNames,typeof imscUtils>"u"?n(5926):imscUtils)},5926:function(e,t){!function(e){var t=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?/,n=/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,i=/rgba\(\s*(\d+),\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,r={transparent:[0,0,0,0],black:[0,0,0,255],silver:[192,192,192,255],gray:[128,128,128,255],white:[255,255,255,255],maroon:[128,0,0,255],red:[255,0,0,255],purple:[128,0,128,255],fuchsia:[255,0,255,255],magenta:[255,0,255,255],green:[0,128,0,255],lime:[0,255,0,255],olive:[128,128,0,255],yellow:[255,255,0,255],navy:[0,0,128,255],blue:[0,0,255,255],teal:[0,128,128,255],aqua:[0,255,255,255],cyan:[0,255,255,255]};e.parseColor=function(e){var a,o=null,s=r[e.toLowerCase()];return void 0!==s?o=s:null!==(a=t.exec(e))?o=[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16),void 0!==a[4]?parseInt(a[4],16):255]:null!==(a=n.exec(e))?o=[parseInt(a[1]),parseInt(a[2]),parseInt(a[3]),255]:null!==(a=i.exec(e))&&(o=[parseInt(a[1]),parseInt(a[2]),parseInt(a[3]),parseInt(a[4])]),o};var a=/^((?:\+|\-)?\d*(?:\.\d+)?)(px|em|c|%|rh|rw)$/;e.parseLength=function(e){var t,n=null;return null!==(t=a.exec(e))&&(n={value:parseFloat(t[1]),unit:t[2]}),n},e.parseTextShadow=function(t){for(var n=t.match(/([^\(,\)]|\([^\)]+\))+/g),i=[],r=0;r<n.length;r++){var a=n[r].split(" ");if(1===a.length&&"none"===a[0])return"none";if(a.length>1&&a.length<5){var o=[null,null,null,null],s=e.parseLength(a.shift());if(null===s||(o[0]=s,null===(s=e.parseLength(a.shift()))))return null;if(o[1]=s,0===a.length){i.push(o);continue}if(null!==(s=e.parseLength(a[0]))&&(o[2]=s,a.shift()),0===a.length){i.push(o);continue}var l=e.parseColor(a[0]);if(null===l)return null;o[3]=l,i.push(o)}}return i},e.parsePosition=function(t){var n=t.split(" "),i=function(e){return"center"===e||"left"===e||"top"===e||"bottom"===e||"right"===e};if(n.length>4)return null;for(var r=0;r<n.length;r++)if(!i(n[r])){var a=e.parseLength(n[r]);if(null===a)return null;n[r]=a}for(var o={h:{edge:"left",offset:{value:50,unit:"%"}},v:{edge:"top",offset:{value:50,unit:"%"}}},s=0;s<n.length;){var l=n[s++];if(i(l)){var c={value:0,unit:"%"};2!==n.length&&s<n.length&&!i(n[s])&&(c=n[s++]),"right"===l?(o.h.edge=l,o.h.offset=c):"bottom"===l?(o.v.edge=l,o.v.offset=c):"left"===l?o.h.offset=c:"top"===l&&(o.v.offset=c)}else{if(1!==n.length&&2!==n.length)return null;1===s?o.h.offset=l:o.v.offset=l}}return o},e.ComputedLength=function(e,t){this.rw=e,this.rh=t},e.ComputedLength.prototype.toUsedLength=function(e,t){return e*this.rw+t*this.rh},e.ComputedLength.prototype.isZero=function(){return 0===this.rw&&0===this.rh},e.toComputedLength=function(t,n,i,r,a,o){return"%"===n&&r?new e.ComputedLength(r.rw*t/100,r.rh*t/100):"em"===n&&i?new e.ComputedLength(i.rw*t,i.rh*t):"c"===n&&a?new e.ComputedLength(t*a.rw,t*a.rh):"px"===n&&o?new e.ComputedLength(t*o.rw,t*o.rh):"rh"===n?new e.ComputedLength(0,t/100):"rw"===n?new e.ComputedLength(t/100,0):null}}(t)},3516:function(e){e.exports=function(e){var t="string"==typeof e?e.charCodeAt(0):e;return t>=97&&t<=122||t>=65&&t<=90}},2219:function(e,t,n){var i=n(3516),r=n(395);e.exports=function(e){return i(e)||r(e)}},395:function(e){e.exports=function(e){var t="string"==typeof e?e.charCodeAt(0):e;return t>=48&&t<=57}},3875:function(e){function t(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function n(e,t){for(var n,i="",r=0,a=-1,o=0,s=0;s<=e.length;++s){if(s<e.length)n=e.charCodeAt(s);else{if(47===n)break;n=47}if(47===n){if(a!==s-1&&1!==o)if(a!==s-1&&2===o){if(i.length<2||2!==r||46!==i.charCodeAt(i.length-1)||46!==i.charCodeAt(i.length-2))if(i.length>2){var l=i.lastIndexOf("/");if(l!==i.length-1){-1===l?(i="",r=0):r=(i=i.slice(0,l)).length-1-i.lastIndexOf("/"),a=s,o=0;continue}}else if(2===i.length||1===i.length){i="",r=0,a=s,o=0;continue}t&&(i.length>0?i+="/..":i="..",r=2)}else i.length>0?i+="/"+e.slice(a+1,s):i=e.slice(a+1,s),r=s-a-1;a=s,o=0}else 46===n&&-1!==o?++o:o=-1}return i}var i={resolve:function(){for(var e,i="",r=!1,a=arguments.length-1;a>=-1&&!r;a--){var o;a>=0?o=arguments[a]:(void 0===e&&(e=process.cwd()),o=e),t(o),0!==o.length&&(i=o+"/"+i,r=47===o.charCodeAt(0))}return i=n(i,!r),r?i.length>0?"/"+i:"/":i.length>0?i:"."},normalize:function(e){if(t(e),0===e.length)return".";var i=47===e.charCodeAt(0),r=47===e.charCodeAt(e.length-1);return 0!==(e=n(e,!i)).length||i||(e="."),e.length>0&&r&&(e+="/"),i?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,n=0;n<arguments.length;++n){var r=arguments[n];t(r),r.length>0&&(void 0===e?e=r:e+="/"+r)}return void 0===e?".":i.normalize(e)},relative:function(e,n){if(t(e),t(n),e===n||(e=i.resolve(e))===(n=i.resolve(n)))return"";for(var r=1;r<e.length&&47===e.charCodeAt(r);++r);for(var a=e.length,o=a-r,s=1;s<n.length&&47===n.charCodeAt(s);++s);for(var l=n.length-s,c=o<l?o:l,u=-1,d=0;d<=c;++d){if(d===c){if(l>c){if(47===n.charCodeAt(s+d))return n.slice(s+d+1);if(0===d)return n.slice(s+d)}else o>c&&(47===e.charCodeAt(r+d)?u=d:0===d&&(u=0));break}var h=e.charCodeAt(r+d);if(h!==n.charCodeAt(s+d))break;47===h&&(u=d)}var f="";for(d=r+u+1;d<=a;++d)d!==a&&47!==e.charCodeAt(d)||(0===f.length?f+="..":f+="/..");return f.length>0?f+n.slice(s+u):(s+=u,47===n.charCodeAt(s)&&++s,n.slice(s))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var n=e.charCodeAt(0),i=47===n,r=-1,a=!0,o=e.length-1;o>=1;--o)if(47===(n=e.charCodeAt(o))){if(!a){r=o;break}}else a=!1;return-1===r?i?"/":".":i&&1===r?"//":e.slice(0,r)},basename:function(e,n){if(void 0!==n&&"string"!=typeof n)throw new TypeError('"ext" argument must be a string');t(e);var i,r=0,a=-1,o=!0;if(void 0!==n&&n.length>0&&n.length<=e.length){if(n.length===e.length&&n===e)return"";var s=n.length-1,l=-1;for(i=e.length-1;i>=0;--i){var c=e.charCodeAt(i);if(47===c){if(!o){r=i+1;break}}else-1===l&&(o=!1,l=i+1),s>=0&&(c===n.charCodeAt(s)?-1==--s&&(a=i):(s=-1,a=l))}return r===a?a=l:-1===a&&(a=e.length),e.slice(r,a)}for(i=e.length-1;i>=0;--i)if(47===e.charCodeAt(i)){if(!o){r=i+1;break}}else-1===a&&(o=!1,a=i+1);return-1===a?"":e.slice(r,a)},extname:function(e){t(e);for(var n=-1,i=0,r=-1,a=!0,o=0,s=e.length-1;s>=0;--s){var l=e.charCodeAt(s);if(47!==l)-1===r&&(a=!1,r=s+1),46===l?-1===n?n=s:1!==o&&(o=1):-1!==n&&(o=-1);else if(!a){i=s+1;break}}return-1===n||-1===r||0===o||1===o&&n===r-1&&n===i+1?"":e.slice(n,r)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return n=(t=e).dir||t.root,i=t.base||(t.name||"")+(t.ext||""),n?n===t.root?n+i:n+"/"+i:i;var t,n,i},parse:function(e){t(e);var n={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return n;var i,r=e.charCodeAt(0),a=47===r;a?(n.root="/",i=1):i=0;for(var o=-1,s=0,l=-1,c=!0,u=e.length-1,d=0;u>=i;--u)if(47!==(r=e.charCodeAt(u)))-1===l&&(c=!1,l=u+1),46===r?-1===o?o=u:1!==d&&(d=1):-1!==o&&(d=-1);else if(!c){s=u+1;break}return-1===o||-1===l||0===d||1===d&&o===l-1&&o===s+1?-1!==l&&(n.base=n.name=0===s&&a?e.slice(1,l):e.slice(s,l)):(0===s&&a?(n.name=e.slice(1,o),n.base=e.slice(1,l)):(n.name=e.slice(s,o),n.base=e.slice(s,l)),n.ext=e.slice(o,l)),s>0?n.dir=e.slice(0,s-1):a&&(n.dir="/"),n},sep:"/",delimiter:":",win32:null,posix:null};i.posix=i,e.exports=i},8387:function(e,t,n){var i=n(1549),r=i.Buffer;function a(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=i:(a(i,t),t.Buffer=o),a(r,o),o.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},5378:function(e,t,n){!function(e){e.parser=function(e,t){return new r(e,t)},e.SAXParser=r,e.SAXStream=o,e.createStream=function(e,t){return new o(e,t)},e.MAX_BUFFER_LENGTH=65536;var t,i=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function r(t,n){if(!(this instanceof r))return new r(t,n);var a=this;(function(e){for(var t=0,n=i.length;t<n;t++)e[i[t]]=""})(a),a.q=a.c="",a.bufferCheckPosition=e.MAX_BUFFER_LENGTH,a.opt=n||{},a.opt.lowercase=a.opt.lowercase||a.opt.lowercasetags,a.looseCase=a.opt.lowercase?"toLowerCase":"toUpperCase",a.tags=[],a.closed=a.closedRoot=a.sawRoot=!1,a.tag=a.error=null,a.strict=!!t,a.noscript=!(!t&&!a.opt.noscript),a.state=A.BEGIN,a.strictEntities=a.opt.strictEntities,a.ENTITIES=a.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),a.attribList=[],a.opt.xmlns&&(a.ns=Object.create(p)),a.trackPosition=!1!==a.opt.position,a.trackPosition&&(a.position=a.line=a.column=0),x(a,"onready")}e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),r.prototype={end:function(){P(this)},write:function(t){var n=this;if(this.error)throw this.error;if(n.closed)return C(n,"Cannot write after close. Assign an onready handler.");if(null===t)return P(n);"object"==typeof t&&(t=t.toString());for(var r=0,a="";a=G(t,r++),n.c=a,a;)switch(n.trackPosition&&(n.position++,"\n"===a?(n.line++,n.column=0):n.column++),n.state){case A.BEGIN:if(n.state=A.BEGIN_WHITESPACE,"\ufeff"===a)continue;V(n,a);continue;case A.BEGIN_WHITESPACE:V(n,a);continue;case A.TEXT:if(n.sawRoot&&!n.closedRoot){for(var o=r-1;a&&"<"!==a&&"&"!==a;)(a=G(t,r++))&&n.trackPosition&&(n.position++,"\n"===a?(n.line++,n.column=0):n.column++);n.textNode+=t.substring(o,r-1)}"<"!==a||n.sawRoot&&n.closedRoot&&!n.strict?(!b(s,a)||n.sawRoot&&!n.closedRoot||D(n,"Text data outside of root node."),"&"===a?n.state=A.TEXT_ENTITY:n.textNode+=a):(n.state=A.OPEN_WAKA,n.startTagPosition=n.position);continue;case A.SCRIPT:"<"===a?n.state=A.SCRIPT_ENDING:n.script+=a;continue;case A.SCRIPT_ENDING:"/"===a?n.state=A.CLOSE_TAG:(n.script+="<"+a,n.state=A.SCRIPT);continue;case A.OPEN_WAKA:if("!"===a)n.state=A.SGML_DECL,n.sgmlDecl="";else if(!E(s,a))if(E(g,a))n.state=A.OPEN_TAG,n.tagName=a;else if("/"===a)n.state=A.CLOSE_TAG,n.tagName="";else if("?"===a)n.state=A.PROC_INST,n.procInstName=n.procInstBody="";else{if(D(n,"Unencoded <"),n.startTagPosition+1<n.position){var l=n.position-n.startTagPosition;a=new Array(l).join(" ")+a}n.textNode+="<"+a,n.state=A.TEXT}continue;case A.SGML_DECL:"[CDATA["===(n.sgmlDecl+a).toUpperCase()?(I(n,"onopencdata"),n.state=A.CDATA,n.sgmlDecl="",n.cdata=""):n.sgmlDecl+a==="--"?(n.state=A.COMMENT,n.comment="",n.sgmlDecl=""):"DOCTYPE"===(n.sgmlDecl+a).toUpperCase()?(n.state=A.DOCTYPE,(n.doctype||n.sawRoot)&&D(n,"Inappropriately located doctype declaration"),n.doctype="",n.sgmlDecl=""):">"===a?(I(n,"onsgmldeclaration",n.sgmlDecl),n.sgmlDecl="",n.state=A.TEXT):(E(u,a)&&(n.state=A.SGML_DECL_QUOTED),n.sgmlDecl+=a);continue;case A.SGML_DECL_QUOTED:a===n.q&&(n.state=A.SGML_DECL,n.q=""),n.sgmlDecl+=a;continue;case A.DOCTYPE:">"===a?(n.state=A.TEXT,I(n,"ondoctype",n.doctype),n.doctype=!0):(n.doctype+=a,"["===a?n.state=A.DOCTYPE_DTD:E(u,a)&&(n.state=A.DOCTYPE_QUOTED,n.q=a));continue;case A.DOCTYPE_QUOTED:n.doctype+=a,a===n.q&&(n.q="",n.state=A.DOCTYPE);continue;case A.DOCTYPE_DTD:n.doctype+=a,"]"===a?n.state=A.DOCTYPE:E(u,a)&&(n.state=A.DOCTYPE_DTD_QUOTED,n.q=a);continue;case A.DOCTYPE_DTD_QUOTED:n.doctype+=a,a===n.q&&(n.state=A.DOCTYPE_DTD,n.q="");continue;case A.COMMENT:"-"===a?n.state=A.COMMENT_ENDING:n.comment+=a;continue;case A.COMMENT_ENDING:"-"===a?(n.state=A.COMMENT_ENDED,n.comment=M(n.opt,n.comment),n.comment&&I(n,"oncomment",n.comment),n.comment=""):(n.comment+="-"+a,n.state=A.COMMENT);continue;case A.COMMENT_ENDED:">"!==a?(D(n,"Malformed comment"),n.comment+="--"+a,n.state=A.COMMENT):n.state=A.TEXT;continue;case A.CDATA:"]"===a?n.state=A.CDATA_ENDING:n.cdata+=a;continue;case A.CDATA_ENDING:"]"===a?n.state=A.CDATA_ENDING_2:(n.cdata+="]"+a,n.state=A.CDATA);continue;case A.CDATA_ENDING_2:">"===a?(n.cdata&&I(n,"oncdata",n.cdata),I(n,"onclosecdata"),n.cdata="",n.state=A.TEXT):"]"===a?n.cdata+="]":(n.cdata+="]]"+a,n.state=A.CDATA);continue;case A.PROC_INST:"?"===a?n.state=A.PROC_INST_ENDING:E(s,a)?n.state=A.PROC_INST_BODY:n.procInstName+=a;continue;case A.PROC_INST_BODY:if(!n.procInstBody&&E(s,a))continue;"?"===a?n.state=A.PROC_INST_ENDING:n.procInstBody+=a;continue;case A.PROC_INST_ENDING:">"===a?(I(n,"onprocessinginstruction",{name:n.procInstName,body:n.procInstBody}),n.procInstName=n.procInstBody="",n.state=A.TEXT):(n.procInstBody+="?"+a,n.state=A.PROC_INST_BODY);continue;case A.OPEN_TAG:E(m,a)?n.tagName+=a:(O(n),">"===a?F(n):"/"===a?n.state=A.OPEN_TAG_SLASH:(b(s,a)&&D(n,"Invalid character in tag name"),n.state=A.ATTRIB));continue;case A.OPEN_TAG_SLASH:">"===a?(F(n,!0),B(n)):(D(n,"Forward-slash in opening tag not followed by >"),n.state=A.ATTRIB);continue;case A.ATTRIB:if(E(s,a))continue;">"===a?F(n):"/"===a?n.state=A.OPEN_TAG_SLASH:E(g,a)?(n.attribName=a,n.attribValue="",n.state=A.ATTRIB_NAME):D(n,"Invalid attribute name");continue;case A.ATTRIB_NAME:"="===a?n.state=A.ATTRIB_VALUE:">"===a?(D(n,"Attribute without value"),n.attribValue=n.attribName,k(n),F(n)):E(s,a)?n.state=A.ATTRIB_NAME_SAW_WHITE:E(m,a)?n.attribName+=a:D(n,"Invalid attribute name");continue;case A.ATTRIB_NAME_SAW_WHITE:if("="===a)n.state=A.ATTRIB_VALUE;else{if(E(s,a))continue;D(n,"Attribute without value"),n.tag.attributes[n.attribName]="",n.attribValue="",I(n,"onattribute",{name:n.attribName,value:""}),n.attribName="",">"===a?F(n):E(g,a)?(n.attribName=a,n.state=A.ATTRIB_NAME):(D(n,"Invalid attribute name"),n.state=A.ATTRIB)}continue;case A.ATTRIB_VALUE:if(E(s,a))continue;E(u,a)?(n.q=a,n.state=A.ATTRIB_VALUE_QUOTED):(D(n,"Unquoted attribute value"),n.state=A.ATTRIB_VALUE_UNQUOTED,n.attribValue=a);continue;case A.ATTRIB_VALUE_QUOTED:if(a!==n.q){"&"===a?n.state=A.ATTRIB_VALUE_ENTITY_Q:n.attribValue+=a;continue}k(n),n.q="",n.state=A.ATTRIB_VALUE_CLOSED;continue;case A.ATTRIB_VALUE_CLOSED:E(s,a)?n.state=A.ATTRIB:">"===a?F(n):"/"===a?n.state=A.OPEN_TAG_SLASH:E(g,a)?(D(n,"No whitespace between attributes"),n.attribName=a,n.attribValue="",n.state=A.ATTRIB_NAME):D(n,"Invalid attribute name");continue;case A.ATTRIB_VALUE_UNQUOTED:if(b(d,a)){"&"===a?n.state=A.ATTRIB_VALUE_ENTITY_U:n.attribValue+=a;continue}k(n),">"===a?F(n):n.state=A.ATTRIB;continue;case A.CLOSE_TAG:if(n.tagName)">"===a?B(n):E(m,a)?n.tagName+=a:n.script?(n.script+="</"+n.tagName,n.tagName="",n.state=A.SCRIPT):(b(s,a)&&D(n,"Invalid tagname in closing tag"),n.state=A.CLOSE_TAG_SAW_WHITE);else{if(E(s,a))continue;b(g,a)?n.script?(n.script+="</"+a,n.state=A.SCRIPT):D(n,"Invalid tagname in closing tag."):n.tagName=a}continue;case A.CLOSE_TAG_SAW_WHITE:if(E(s,a))continue;">"===a?B(n):D(n,"Invalid characters in closing tag");continue;case A.TEXT_ENTITY:case A.ATTRIB_VALUE_ENTITY_Q:case A.ATTRIB_VALUE_ENTITY_U:var c,h;switch(n.state){case A.TEXT_ENTITY:c=A.TEXT,h="textNode";break;case A.ATTRIB_VALUE_ENTITY_Q:c=A.ATTRIB_VALUE_QUOTED,h="attribValue";break;case A.ATTRIB_VALUE_ENTITY_U:c=A.ATTRIB_VALUE_UNQUOTED,h="attribValue"}";"===a?(n[h]+=U(n),n.entity="",n.state=c):E(n.entity.length?y:v,a)?n.entity+=a:(D(n,"Invalid character in entity name"),n[h]+="&"+n.entity+a,n.entity="",n.state=c);continue;default:throw new Error(n,"Unknown state: "+n.state)}return n.position>=n.bufferCheckPosition&&function(t){for(var n=Math.max(e.MAX_BUFFER_LENGTH,10),r=0,a=0,o=i.length;a<o;a++){var s=t[i[a]].length;if(s>n)switch(i[a]){case"textNode":L(t);break;case"cdata":I(t,"oncdata",t.cdata),t.cdata="";break;case"script":I(t,"onscript",t.script),t.script="";break;default:C(t,"Max buffer length exceeded: "+i[a])}r=Math.max(r,s)}var l=e.MAX_BUFFER_LENGTH-r;t.bufferCheckPosition=l+t.position}(n),n},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){var e;L(e=this),""!==e.cdata&&(I(e,"oncdata",e.cdata),e.cdata=""),""!==e.script&&(I(e,"onscript",e.script),e.script="")}};try{t=n(182).Stream}catch(e){t=function(){}}var a=e.EVENTS.filter(function(e){return"error"!==e&&"end"!==e});function o(e,n){if(!(this instanceof o))return new o(e,n);t.apply(this),this._parser=new r(e,n),this.writable=!0,this.readable=!0;var i=this;this._parser.onend=function(){i.emit("end")},this._parser.onerror=function(e){i.emit("error",e),i._parser.error=null},this._decoder=null,a.forEach(function(e){Object.defineProperty(i,"on"+e,{get:function(){return i._parser["on"+e]},set:function(t){if(!t)return i.removeAllListeners(e),i._parser["on"+e]=t,t;i.on(e,t)},enumerable:!0,configurable:!1})})}o.prototype=Object.create(t.prototype,{constructor:{value:o}}),o.prototype.write=function(e){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(e)){if(!this._decoder){var t=n(7503).s;this._decoder=new t("utf8")}e=this._decoder.write(e)}return this._parser.write(e.toString()),this.emit("data",e),!0},o.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},o.prototype.on=function(e,n){var i=this;return i._parser["on"+e]||-1===a.indexOf(e)||(i._parser["on"+e]=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),i.emit.apply(i,t)}),t.prototype.on.call(i,e,n)};var s="\r\n\t ",l="0124356789",c="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",u="'\"",d=s+">",h="http://www.w3.org/XML/1998/namespace",f="http://www.w3.org/2000/xmlns/",p={xml:h,xmlns:f};s=_(s),l=_(l),c=_(c);var g=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,m=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/,v=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,y=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;function _(e){return e.split("").reduce(function(e,t){return e[t]=!0,e},{})}function E(e,t){return n=e,"[object RegExp]"===Object.prototype.toString.call(n)?!!t.match(e):e[t];var n}function b(e,t){return!E(e,t)}u=_(u),d=_(d);var T,S,w,A=0;for(var R in e.STATE={BEGIN:A++,BEGIN_WHITESPACE:A++,TEXT:A++,TEXT_ENTITY:A++,OPEN_WAKA:A++,SGML_DECL:A++,SGML_DECL_QUOTED:A++,DOCTYPE:A++,DOCTYPE_QUOTED:A++,DOCTYPE_DTD:A++,DOCTYPE_DTD_QUOTED:A++,COMMENT_STARTING:A++,COMMENT:A++,COMMENT_ENDING:A++,COMMENT_ENDED:A++,CDATA:A++,CDATA_ENDING:A++,CDATA_ENDING_2:A++,PROC_INST:A++,PROC_INST_BODY:A++,PROC_INST_ENDING:A++,OPEN_TAG:A++,OPEN_TAG_SLASH:A++,ATTRIB:A++,ATTRIB_NAME:A++,ATTRIB_NAME_SAW_WHITE:A++,ATTRIB_VALUE:A++,ATTRIB_VALUE_QUOTED:A++,ATTRIB_VALUE_CLOSED:A++,ATTRIB_VALUE_UNQUOTED:A++,ATTRIB_VALUE_ENTITY_Q:A++,ATTRIB_VALUE_ENTITY_U:A++,CLOSE_TAG:A++,CLOSE_TAG_SAW_WHITE:A++,SCRIPT:A++,SCRIPT_ENDING:A++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(t){var n=e.ENTITIES[t],i="number"==typeof n?String.fromCharCode(n):n;e.ENTITIES[t]=i}),e.STATE)e.STATE[e.STATE[R]]=R;function x(e,t,n){e[t]&&e[t](n)}function I(e,t,n){e.textNode&&L(e),x(e,t,n)}function L(e){e.textNode=M(e.opt,e.textNode),e.textNode&&x(e,"ontext",e.textNode),e.textNode=""}function M(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function C(e,t){return L(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),t=new Error(t),e.error=t,x(e,"onerror",t),e}function P(e){return e.sawRoot&&!e.closedRoot&&D(e,"Unclosed root tag"),e.state!==A.BEGIN&&e.state!==A.BEGIN_WHITESPACE&&e.state!==A.TEXT&&C(e,"Unexpected end"),L(e),e.c="",e.closed=!0,x(e,"onend"),r.call(e,e.strict,e.opt),e}function D(e,t){if("object"!=typeof e||!(e instanceof r))throw new Error("bad call to strictFail");e.strict&&C(e,t)}function O(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,n=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(n.ns=t.ns),e.attribList.length=0,I(e,"onopentagstart",n)}function N(e,t){var n=e.indexOf(":")<0?["",e]:e.split(":"),i=n[0],r=n[1];return t&&"xmlns"===e&&(i="xmlns",r=""),{prefix:i,local:r}}function k(e){if(e.strict||(e.attribName=e.attribName[e.looseCase]()),-1!==e.attribList.indexOf(e.attribName)||e.tag.attributes.hasOwnProperty(e.attribName))e.attribName=e.attribValue="";else{if(e.opt.xmlns){var t=N(e.attribName,!0),n=t.prefix,i=t.local;if("xmlns"===n)if("xml"===i&&e.attribValue!==h)D(e,"xml: prefix must be bound to "+h+"\nActual: "+e.attribValue);else if("xmlns"===i&&e.attribValue!==f)D(e,"xmlns: prefix must be bound to "+f+"\nActual: "+e.attribValue);else{var r=e.tag,a=e.tags[e.tags.length-1]||e;r.ns===a.ns&&(r.ns=Object.create(a.ns)),r.ns[i]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,I(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}}function F(e,t){if(e.opt.xmlns){var n=e.tag,i=N(e.tagName);n.prefix=i.prefix,n.local=i.local,n.uri=n.ns[i.prefix]||"",n.prefix&&!n.uri&&(D(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),n.uri=i.prefix);var r=e.tags[e.tags.length-1]||e;n.ns&&r.ns!==n.ns&&Object.keys(n.ns).forEach(function(t){I(e,"onopennamespace",{prefix:t,uri:n.ns[t]})});for(var a=0,o=e.attribList.length;a<o;a++){var s=e.attribList[a],l=s[0],c=s[1],u=N(l,!0),d=u.prefix,h=u.local,f=""===d?"":n.ns[d]||"",p={name:l,value:c,prefix:d,local:h,uri:f};d&&"xmlns"!==d&&!f&&(D(e,"Unbound namespace prefix: "+JSON.stringify(d)),p.uri=d),e.tag.attributes[l]=p,I(e,"onattribute",p)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),I(e,"onopentag",e.tag),t||(e.noscript||"script"!==e.tagName.toLowerCase()?e.state=A.TEXT:e.state=A.SCRIPT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function B(e){if(!e.tagName)return D(e,"Weird empty close tag."),e.textNode+="</>",void(e.state=A.TEXT);if(e.script){if("script"!==e.tagName)return e.script+="</"+e.tagName+">",e.tagName="",void(e.state=A.SCRIPT);I(e,"onscript",e.script),e.script=""}var t=e.tags.length,n=e.tagName;e.strict||(n=n[e.looseCase]());for(var i=n;t--&&e.tags[t].name!==i;)D(e,"Unexpected close tag");if(t<0)return D(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",void(e.state=A.TEXT);e.tagName=n;for(var r=e.tags.length;r-- >t;){var a=e.tag=e.tags.pop();e.tagName=e.tag.name,I(e,"onclosetag",e.tagName);var o={};for(var s in a.ns)o[s]=a.ns[s];var l=e.tags[e.tags.length-1]||e;e.opt.xmlns&&a.ns!==l.ns&&Object.keys(a.ns).forEach(function(t){var n=a.ns[t];I(e,"onclosenamespace",{prefix:t,uri:n})})}0===t&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=A.TEXT}function U(e){var t,n=e.entity,i=n.toLowerCase(),r="";return e.ENTITIES[n]?e.ENTITIES[n]:e.ENTITIES[i]?e.ENTITIES[i]:("#"===(n=i).charAt(0)&&("x"===n.charAt(1)?(n=n.slice(2),r=(t=parseInt(n,16)).toString(16)):(n=n.slice(1),r=(t=parseInt(n,10)).toString(10))),n=n.replace(/^0+/,""),r.toLowerCase()!==n?(D(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(t))}function V(e,t){"<"===t?(e.state=A.OPEN_WAKA,e.startTagPosition=e.position):b(s,t)&&(D(e,"Non-whitespace before first tag."),e.textNode=t,e.state=A.TEXT)}function G(e,t){var n="";return t<e.length&&(n=e.charAt(t)),n}A=e.STATE,String.fromCodePoint||(T=String.fromCharCode,S=Math.floor,w=function(){var e,t,n=16384,i=[],r=-1,a=arguments.length;if(!a)return"";for(var o="";++r<a;){var s=Number(arguments[r]);if(!isFinite(s)||s<0||s>1114111||S(s)!==s)throw RangeError("Invalid code point: "+s);s<=65535?i.push(s):(e=55296+((s-=65536)>>10),t=s%1024+56320,i.push(e,t)),(r+1===a||i.length>n)&&(o+=T.apply(null,i),i.length=0)}return o},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:w,configurable:!0,writable:!0}):String.fromCodePoint=w)}(t)},182:function(e,t,n){e.exports=r;var i=n(1159).EventEmitter;function r(){i.call(this)}n(1765)(r,i),r.Readable=n(2846),r.Writable=n(8318),r.Duplex=n(6138),r.Transform=n(9798),r.PassThrough=n(5472),r.finished=n(8800),r.pipeline=n(7295),r.Stream=r,r.prototype.pipe=function(e,t){var n=this;function r(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function a(){n.readable&&n.resume&&n.resume()}n.on("data",r),e.on("drain",a),e._isStdio||t&&!1===t.end||(n.on("end",s),n.on("close",l));var o=!1;function s(){o||(o=!0,e.end())}function l(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(u(),0===i.listenerCount(this,"error"))throw e}function u(){n.removeListener("data",r),e.removeListener("drain",a),n.removeListener("end",s),n.removeListener("close",l),n.removeListener("error",c),e.removeListener("error",c),n.removeListener("end",u),n.removeListener("close",u),e.removeListener("close",u)}return n.on("error",c),e.on("error",c),n.on("end",u),n.on("close",u),e.on("close",u),e.emit("pipe",n),e}},1765:function(e){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},3690:function(e){var t={};function n(e,n,i){i||(i=Error);var r=function(e){var t,i;function r(t,i,r){return e.call(this,(a=t,o=i,s=r,"string"==typeof n?n:n(a,o,s)))||this;var a,o,s}return i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,r}(i);r.prototype.name=i.name,r.prototype.code=e,t[e]=r}function i(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map(function(e){return String(e)}),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}n("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError),n("ERR_INVALID_ARG_TYPE",function(e,t,n){var r,a,o,s,l,c,u,d;if("string"==typeof t&&(a="not ",t.substr(0,a.length)===a)?(r="must not be",t=t.replace(/^not /,"")):r="must be",c=e,u=" argument",(void 0===d||d>c.length)&&(d=c.length),c.substring(d-u.length,d)===u)o="The ".concat(e," ").concat(r," ").concat(i(t,"type"));else{var h=("number"!=typeof l&&(l=0),l+1>(s=e).length||-1===s.indexOf(".",l)?"argument":"property");o='The "'.concat(e,'" ').concat(h," ").concat(r," ").concat(i(t,"type"))}return o+". Received type ".concat(typeof n)},TypeError),n("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),n("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"}),n("ERR_STREAM_PREMATURE_CLOSE","Premature close"),n("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"}),n("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),n("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),n("ERR_STREAM_WRITE_AFTER_END","write after end"),n("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),n("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError),n("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.q=t},6138:function(e,t,n){var i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=c;var r=n(2846),a=n(8318);n(1765)(c,r);for(var o=i(a.prototype),s=0;s<o.length;s++){var l=o[s];c.prototype[l]||(c.prototype[l]=a.prototype[l])}function c(e){if(!(this instanceof c))return new c(e);r.call(this,e),a.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",u)))}function u(){this._writableState.ended||process.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(c.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(c.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})},5472:function(e,t,n){e.exports=r;var i=n(9798);function r(e){if(!(this instanceof r))return new r(e);i.call(this,e)}n(1765)(r,i),r.prototype._transform=function(e,t,n){n(null,e)}},2846:function(e,t,n){var i;e.exports=w,w.ReadableState=S,n(1159).EventEmitter;var r,a=function(e,t){return e.listeners(t).length},o=n(9299),s=n(1549).Buffer,l=n.g.Uint8Array||function(){},c=n(964);r=c&&c.debuglog?c.debuglog("stream"):function(){};var u,d,h,f=n(8393),p=n(6163),g=n(7269).getHighWaterMark,m=n(3690).q,v=m.ERR_INVALID_ARG_TYPE,y=m.ERR_STREAM_PUSH_AFTER_EOF,_=m.ERR_METHOD_NOT_IMPLEMENTED,E=m.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;n(1765)(w,o);var b=p.errorOrDestroy,T=["error","close","destroy","pause","resume"];function S(e,t,r){i=i||n(6138),e=e||{},"boolean"!=typeof r&&(r=t instanceof i),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=g(this,e,"readableHighWaterMark",r),this.buffer=new f,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(u||(u=n(7503).s),this.decoder=new u(e.encoding),this.encoding=e.encoding)}function w(e){if(i=i||n(6138),!(this instanceof w))return new w(e);var t=this instanceof i;this._readableState=new S(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),o.call(this)}function A(e,t,n,i,a){r("readableAddChunk",t);var o,c,u,d,h,f=e._readableState;if(null===t)f.reading=!1,function(e,t){if(r("onEofChunk"),!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?L(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,M(e)))}}(e,f);else if(a||(c=f,h=u=t,s.isBuffer(h)||h instanceof l||"string"==typeof u||void 0===u||c.objectMode||(d=new v("chunk",["string","Buffer","Uint8Array"],u)),o=d),o)b(e,o);else if(f.objectMode||t&&t.length>0)if("string"==typeof t||f.objectMode||Object.getPrototypeOf(t)===s.prototype||(t=function(e){return s.from(e)}(t)),i)f.endEmitted?b(e,new E):R(e,f,t,!0);else if(f.ended)b(e,new y);else{if(f.destroyed)return!1;f.reading=!1,f.decoder&&!n?(t=f.decoder.write(t),f.objectMode||0!==t.length?R(e,f,t,!1):C(e,f)):R(e,f,t,!1)}else i||(f.reading=!1,C(e,f));return!f.ended&&(f.length<f.highWaterMark||0===f.length)}function R(e,t,n,i){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&L(e)),C(e,t)}Object.defineProperty(w.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),w.prototype.destroy=p.destroy,w.prototype._undestroy=p.undestroy,w.prototype._destroy=function(e,t){t(e)},w.prototype.push=function(e,t){var n,i=this._readableState;return i.objectMode?n=!0:"string"==typeof e&&((t=t||i.defaultEncoding)!==i.encoding&&(e=s.from(e,t),t=""),n=!0),A(this,e,t,!1,n)},w.prototype.unshift=function(e){return A(this,e,null,!0,!1)},w.prototype.isPaused=function(){return!1===this._readableState.flowing},w.prototype.setEncoding=function(e){u||(u=n(7503).s);var t=new u(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var i=this._readableState.buffer.head,r="";null!==i;)r+=t.write(i.data),i=i.next;return this._readableState.buffer.clear(),""!==r&&this._readableState.buffer.push(r),this._readableState.length=r.length,this};var x=1073741824;function I(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=((n=e)>=x?n=x:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0));var n}function L(e){var t=e._readableState;r("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(r("emitReadable",t.flowing),t.emittedReadable=!0,process.nextTick(M,e))}function M(e){var t=e._readableState;r("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,k(e)}function C(e,t){t.readingMore||(t.readingMore=!0,process.nextTick(P,e,t))}function P(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var n=t.length;if(r("maybeReadMore read 0"),e.read(0),n===t.length)break}t.readingMore=!1}function D(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function O(e){r("readable nexttick read 0"),e.read(0)}function N(e,t){r("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),k(e),t.flowing&&!t.reading&&e.read(0)}function k(e){var t=e._readableState;for(r("flow",t.flowing);t.flowing&&null!==e.read(););}function F(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function B(e){var t=e._readableState;r("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,process.nextTick(U,t,e))}function U(e,t){if(r("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var n=t._writableState;(!n||n.autoDestroy&&n.finished)&&t.destroy()}}function V(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}w.prototype.read=function(e){r("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return r("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?B(this):L(this),null;if(0===(e=I(e,t))&&t.ended)return 0===t.length&&B(this),null;var i,a=t.needReadable;return r("need readable",a),(0===t.length||t.length-e<t.highWaterMark)&&r("length less than watermark",a=!0),t.ended||t.reading?r("reading or ended",a=!1):a&&(r("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=I(n,t))),null===(i=e>0?F(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&B(this)),null!==i&&this.emit("data",i),i},w.prototype._read=function(e){b(this,new _("_read()"))},w.prototype.pipe=function(e,t){var n=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,r("pipe count=%d opts=%j",i.pipesCount,t);var o=t&&!1===t.end||e===process.stdout||e===process.stderr?g:s;function s(){r("onend"),e.end()}i.endEmitted?process.nextTick(o):n.once("end",o),e.on("unpipe",function t(a,o){r("onunpipe"),a===n&&o&&!1===o.hasUnpiped&&(o.hasUnpiped=!0,r("cleanup"),e.removeListener("close",f),e.removeListener("finish",p),e.removeListener("drain",c),e.removeListener("error",h),e.removeListener("unpipe",t),n.removeListener("end",s),n.removeListener("end",g),n.removeListener("data",d),u=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||c())});var l,c=(l=n,function(){var e=l._readableState;r("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&a(l,"data")&&(e.flowing=!0,k(l))});e.on("drain",c);var u=!1;function d(t){r("ondata");var a=e.write(t);r("dest.write",a),!1===a&&((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==V(i.pipes,e))&&!u&&(r("false write response, pause",i.awaitDrain),i.awaitDrain++),n.pause())}function h(t){r("onerror",t),g(),e.removeListener("error",h),0===a(e,"error")&&b(e,t)}function f(){e.removeListener("finish",p),g()}function p(){r("onfinish"),e.removeListener("close",f),g()}function g(){r("unpipe"),n.unpipe(e)}return n.on("data",d),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",h),e.once("close",f),e.once("finish",p),e.emit("pipe",n),i.flowing||(r("pipe resume"),n.resume()),e},w.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var i=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<r;a++)i[a].emit("unpipe",this,{hasUnpiped:!1});return this}var o=V(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},w.prototype.on=function(e,t){var n=o.prototype.on.call(this,e,t),i=this._readableState;return"data"===e?(i.readableListening=this.listenerCount("readable")>0,!1!==i.flowing&&this.resume()):"readable"===e&&(i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,r("on readable",i.length,i.reading),i.length?L(this):i.reading||process.nextTick(O,this))),n},w.prototype.addListener=w.prototype.on,w.prototype.removeListener=function(e,t){var n=o.prototype.removeListener.call(this,e,t);return"readable"===e&&process.nextTick(D,this),n},w.prototype.removeAllListeners=function(e){var t=o.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||process.nextTick(D,this),t},w.prototype.resume=function(){var e,t,n=this._readableState;return n.flowing||(r("resume"),n.flowing=!n.readableListening,e=this,(t=n).resumeScheduled||(t.resumeScheduled=!0,process.nextTick(N,e,t))),n.paused=!1,this},w.prototype.pause=function(){return r("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(r("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},w.prototype.wrap=function(e){var t=this,n=this._readableState,i=!1;for(var a in e.on("end",function(){if(r("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(a){r("wrapped data"),n.decoder&&(a=n.decoder.write(a)),n.objectMode&&null==a||(n.objectMode||a&&a.length)&&(t.push(a)||(i=!0,e.pause()))}),e)void 0===this[a]&&"function"==typeof e[a]&&(this[a]=function(t){return function(){return e[t].apply(e,arguments)}}(a));for(var o=0;o<T.length;o++)e.on(T[o],this.emit.bind(this,T[o]));return this._read=function(t){r("wrapped _read",t),i&&(i=!1,e.resume())},this},"function"==typeof Symbol&&(w.prototype[Symbol.asyncIterator]=function(){return void 0===d&&(d=n(7299)),d(this)}),Object.defineProperty(w.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(w.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(w.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),w._fromList=F,Object.defineProperty(w.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(w.from=function(e,t){return void 0===h&&(h=n(6233)),h(w,e,t)})},9798:function(e,t,n){e.exports=u;var i=n(3690).q,r=i.ERR_METHOD_NOT_IMPLEMENTED,a=i.ERR_MULTIPLE_CALLBACK,o=i.ERR_TRANSFORM_ALREADY_TRANSFORMING,s=i.ERR_TRANSFORM_WITH_LENGTH_0,l=n(6138);function c(e,t){var n=this._transformState;n.transforming=!1;var i=n.writecb;if(null===i)return this.emit("error",new a);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),i(e);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}function u(e){if(!(this instanceof u))return new u(e);l.call(this,e),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function d(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?h(this,null,null):this._flush(function(t,n){h(e,t,n)})}function h(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new s;if(e._transformState.transforming)throw new o;return e.push(null)}n(1765)(u,l),u.prototype.push=function(e,t){return this._transformState.needTransform=!1,l.prototype.push.call(this,e,t)},u.prototype._transform=function(e,t,n){n(new r("_transform()"))},u.prototype._write=function(e,t,n){var i=this._transformState;if(i.writecb=n,i.writechunk=e,i.writeencoding=t,!i.transforming){var r=this._readableState;(i.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},u.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},u.prototype._destroy=function(e,t){l.prototype._destroy.call(this,e,function(e){t(e)})}},8318:function(e,t,n){function i(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(void 0),n=n.next}t.corkedRequestsFree.next=e}(t,e)}}var r;e.exports=w,w.WritableState=S;var a,o={deprecate:n(7839)},s=n(9299),l=n(1549).Buffer,c=n.g.Uint8Array||function(){},u=n(6163),d=n(7269).getHighWaterMark,h=n(3690).q,f=h.ERR_INVALID_ARG_TYPE,p=h.ERR_METHOD_NOT_IMPLEMENTED,g=h.ERR_MULTIPLE_CALLBACK,m=h.ERR_STREAM_CANNOT_PIPE,v=h.ERR_STREAM_DESTROYED,y=h.ERR_STREAM_NULL_VALUES,_=h.ERR_STREAM_WRITE_AFTER_END,E=h.ERR_UNKNOWN_ENCODING,b=u.errorOrDestroy;function T(){}function S(e,t,a){r=r||n(6138),e=e||{},"boolean"!=typeof a&&(a=t instanceof r),this.objectMode=!!e.objectMode,a&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=d(this,e,"writableHighWaterMark",a),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===e.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n,i=e._writableState,r=i.sync,a=i.writecb;if("function"!=typeof a)throw new g;if((n=i).writing=!1,n.writecb=null,n.length-=n.writelen,n.writelen=0,t)!function(e,t,n,i,r){--t.pendingcb,n?(process.nextTick(r,i),process.nextTick(M,e,t),e._writableState.errorEmitted=!0,b(e,i)):(r(i),e._writableState.errorEmitted=!0,b(e,i),M(e,t))}(e,i,r,t,a);else{var o=I(i)||e.destroyed;o||i.corked||i.bufferProcessing||!i.bufferedRequest||x(e,i),r?process.nextTick(R,e,i,o,a):R(e,i,o,a)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new i(this)}function w(e){var t=this instanceof(r=r||n(6138));if(!t&&!a.call(w,this))return new w(e);this._writableState=new S(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),s.call(this)}function A(e,t,n,i,r,a,o){t.writelen=i,t.writecb=o,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new v("write")):n?e._writev(r,t.onwrite):e._write(r,a,t.onwrite),t.sync=!1}function R(e,t,n,i){var r,a;n||(r=e,0===(a=t).length&&a.needDrain&&(a.needDrain=!1,r.emit("drain"))),t.pendingcb--,i(),M(e,t)}function x(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,a=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var s=0,l=!0;n;)a[s]=n,n.isBuf||(l=!1),n=n.next,s+=1;a.allBuffers=l,A(e,t,!0,t.length,a,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new i(t),t.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,u=n.encoding,d=n.callback;if(A(e,t,!1,t.objectMode?1:c.length,c,u,d),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function I(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function L(e,t){e._final(function(n){t.pendingcb--,n&&b(e,n),t.prefinished=!0,e.emit("prefinish"),M(e,t)})}function M(e,t){var n,i,r=I(t);if(r&&(n=e,(i=t).prefinished||i.finalCalled||("function"!=typeof n._final||i.destroyed?(i.prefinished=!0,n.emit("prefinish")):(i.pendingcb++,i.finalCalled=!0,process.nextTick(L,n,i))),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var a=e._readableState;(!a||a.autoDestroy&&a.endEmitted)&&e.destroy()}return r}n(1765)(w,s),S.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(S.prototype,"buffer",{get:o.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(a=Function.prototype[Symbol.hasInstance],Object.defineProperty(w,Symbol.hasInstance,{value:function(e){return!!a.call(this,e)||this===w&&e&&e._writableState instanceof S}})):a=function(e){return e instanceof this},w.prototype.pipe=function(){b(this,new m)},w.prototype.write=function(e,t,n){var i,r,a=this._writableState,o=!1,s=!a.objectMode&&(i=e,l.isBuffer(i)||i instanceof c);return s&&!l.isBuffer(e)&&(r=e,e=l.from(r)),"function"==typeof t&&(n=t,t=null),s?t="buffer":t||(t=a.defaultEncoding),"function"!=typeof n&&(n=T),a.ending?function(e,t){var n=new _;b(e,n),process.nextTick(t,n)}(this,n):(s||function(e,t,n,i){var r;return null===n?r=new y:"string"==typeof n||t.objectMode||(r=new f("chunk",["string","Buffer"],n)),!r||(b(e,r),process.nextTick(i,r),!1)}(this,a,e,n))&&(a.pendingcb++,o=function(e,t,n,i,r,a){if(!n){var o=(c=i,u=r,(s=t).objectMode||!1===s.decodeStrings||"string"!=typeof c||(c=l.from(c,u)),c);i!==o&&(n=!0,r="buffer",i=o)}var s,c,u,d=t.objectMode?1:i.length;t.length+=d;var h=t.length<t.highWaterMark;if(h||(t.needDrain=!0),t.writing||t.corked){var f=t.lastBufferedRequest;t.lastBufferedRequest={chunk:i,encoding:r,isBuf:n,callback:a,next:null},f?f.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else A(e,t,!1,d,i,r,a);return h}(this,a,s,e,t,n)),o},w.prototype.cork=function(){this._writableState.corked++},w.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||x(this,e))},w.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new E(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(w.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(w.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),w.prototype._write=function(e,t,n){n(new p("_write()"))},w.prototype._writev=null,w.prototype.end=function(e,t,n){var i,r,a,o=this._writableState;return"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),o.corked&&(o.corked=1,this.uncork()),o.ending||(i=this,a=n,(r=o).ending=!0,M(i,r),a&&(r.finished?process.nextTick(a):i.once("finish",a)),r.ended=!0,i.writable=!1),this},Object.defineProperty(w.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(w.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),w.prototype.destroy=u.destroy,w.prototype._undestroy=u.undestroy,w.prototype._destroy=function(e,t){t(e)}},7299:function(e,t,n){var i;function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=n(8800),o=Symbol("lastResolve"),s=Symbol("lastReject"),l=Symbol("error"),c=Symbol("ended"),u=Symbol("lastPromise"),d=Symbol("handlePromise"),h=Symbol("stream");function f(e,t){return{value:e,done:t}}function p(e){var t=e[o];if(null!==t){var n=e[h].read();null!==n&&(e[u]=null,e[o]=null,e[s]=null,t(f(n,!1)))}}function g(e){process.nextTick(p,e)}var m=Object.getPrototypeOf(function(){}),v=Object.setPrototypeOf((r(i={get stream(){return this[h]},next:function(){var e=this,t=this[l];if(null!==t)return Promise.reject(t);if(this[c])return Promise.resolve(f(void 0,!0));if(this[h].destroyed)return new Promise(function(t,n){process.nextTick(function(){e[l]?n(e[l]):t(f(void 0,!0))})});var n,i,r,a=this[u];if(a)n=new Promise((i=a,r=this,function(e,t){i.then(function(){r[c]?e(f(void 0,!0)):r[d](e,t)},t)}));else{var o=this[h].read();if(null!==o)return Promise.resolve(f(o,!1));n=new Promise(this[d])}return this[u]=n,n}},Symbol.asyncIterator,function(){return this}),r(i,"return",function(){var e=this;return new Promise(function(t,n){e[h].destroy(null,function(e){e?n(e):t(f(void 0,!0))})})}),i),m);e.exports=function(e){var t,n=Object.create(v,(r(t={},h,{value:e,writable:!0}),r(t,o,{value:null,writable:!0}),r(t,s,{value:null,writable:!0}),r(t,l,{value:null,writable:!0}),r(t,c,{value:e._readableState.endEmitted,writable:!0}),r(t,d,{value:function(e,t){var i=n[h].read();i?(n[u]=null,n[o]=null,n[s]=null,e(f(i,!1))):(n[o]=e,n[s]=t)},writable:!0}),t));return n[u]=null,a(e,function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=n[s];return null!==t&&(n[u]=null,n[o]=null,n[s]=null,t(e)),void(n[l]=e)}var i=n[o];null!==i&&(n[u]=null,n[o]=null,n[s]=null,i(f(void 0,!0))),n[c]=!0}),e.on("readable",g.bind(null,n)),n}},8393:function(e,t,n){function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=n(1549).Buffer,s=n(9862).inspect,l=s&&s.custom||"inspect";e.exports=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.head=null,this.tail=null,this.length=0}var t;return t=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return o.alloc(0);for(var t,n,i,r=o.allocUnsafe(e>>>0),a=this.head,s=0;a;)t=a.data,n=r,i=s,o.prototype.copy.call(t,n,i),s+=a.data.length,a=a.next;return r}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,i=t.data;for(e-=i.length;t=t.next;){var r=t.data,a=e>r.length?r.length:e;if(a===r.length?i+=r:i+=r.slice(0,e),0==(e-=a)){a===r.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=r.slice(a));break}++n}return this.length-=n,i}},{key:"_getBuffer",value:function(e){var t=o.allocUnsafe(e),n=this.head,i=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var r=n.data,a=e>r.length?r.length:e;if(r.copy(t,t.length-e,0,a),0==(e-=a)){a===r.length?(++i,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=r.slice(a));break}++i}return this.length-=i,t}},{key:l,value:function(e,t){return s(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){r(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},t,{depth:0,customInspect:!1}))}}],t&&a(e.prototype,t),e}()},6163:function(e){function t(e,t){i(e,t),n(e)}function n(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,r){var a=this,o=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return o||s?(r?r(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(i,this,e)):process.nextTick(i,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!r&&e?a._writableState?a._writableState.errorEmitted?process.nextTick(n,a):(a._writableState.errorEmitted=!0,process.nextTick(t,a,e)):process.nextTick(t,a,e):r?(process.nextTick(n,a),r(e)):process.nextTick(n,a)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,i=e._writableState;n&&n.autoDestroy||i&&i.autoDestroy?e.destroy(t):e.emit("error",t)}}},8800:function(e,t,n){var i=n(3690).q.ERR_STREAM_PREMATURE_CLOSE;function r(){}e.exports=function e(t,n,a){if("function"==typeof n)return e(t,null,n);var o,s;n||(n={}),o=a||r,s=!1,a=function(){if(!s){s=!0;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];o.apply(this,t)}};var l=n.readable||!1!==n.readable&&t.readable,c=n.writable||!1!==n.writable&&t.writable,u=function(){t.writable||h()},d=t._writableState&&t._writableState.finished,h=function(){c=!1,d=!0,l||a.call(t)},f=t._readableState&&t._readableState.endEmitted,p=function(){l=!1,f=!0,c||a.call(t)},g=function(e){a.call(t,e)},m=function(){var e;return l&&!f?(t._readableState&&t._readableState.ended||(e=new i),a.call(t,e)):c&&!d?(t._writableState&&t._writableState.ended||(e=new i),a.call(t,e)):void 0},v=function(){t.req.on("finish",h)};return function(e){return e.setHeader&&"function"==typeof e.abort}(t)?(t.on("complete",h),t.on("abort",m),t.req?v():t.on("request",v)):c&&!t._writableState&&(t.on("end",u),t.on("close",u)),t.on("end",p),t.on("finish",h),!1!==n.error&&t.on("error",g),t.on("close",m),function(){t.removeListener("complete",h),t.removeListener("abort",m),t.removeListener("request",v),t.req&&t.req.removeListener("finish",h),t.removeListener("end",u),t.removeListener("close",u),t.removeListener("finish",h),t.removeListener("end",p),t.removeListener("error",g),t.removeListener("close",m)}}},6233:function(e){e.exports=function(){throw new Error("Readable.from is not available in the browser")}},7295:function(e,t,n){var i,r=n(3690).q,a=r.ERR_MISSING_ARGS,o=r.ERR_STREAM_DESTROYED;function s(e){if(e)throw e}function l(e,t,r,a){var s,l;s=a,l=!1,a=function(){l||(l=!0,s.apply(void 0,arguments))};var c=!1;e.on("close",function(){c=!0}),void 0===i&&(i=n(8800)),i(e,{readable:t,writable:r},function(e){if(e)return a(e);c=!0,a()});var u=!1;return function(t){if(!c&&!u)return u=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void a(t||new o("pipe"))}}function c(e){e()}function u(e,t){return e.pipe(t)}function d(e){return e.length?"function"!=typeof e[e.length-1]?s:e.pop():s}e.exports=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i,r=d(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new a("streams");var o=t.map(function(e,n){var a=n<t.length-1;return l(e,a,n>0,function(e){i||(i=e),e&&o.forEach(c),a||(o.forEach(c),r(i))})});return t.reduce(u)}},7269:function(e,t,n){var i=n(3690).q.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,n,r){var a,o,s,l=(o=r,s=n,null!=(a=t).highWaterMark?a.highWaterMark:o?a[s]:null);if(null!=l){if(!isFinite(l)||Math.floor(l)!==l||l<0)throw new i(r?n:"highWaterMark",l);return Math.floor(l)}return e.objectMode?16:16384}}},9299:function(e,t,n){e.exports=n(1159).EventEmitter},7503:function(e,t,n){var i=n(8387).Buffer,r=i.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(i.isEncoding===r||!r(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=c,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=u,this.end=d,t=3;break;default:return this.write=h,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=i.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function s(e){var t=this.lastTotal-this.lastNeed,n=function(e,t){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var i=n.charCodeAt(n.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function u(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function h(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}t.s=a,a.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},a.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},a.prototype.text=function(e,t){var n=function(e,t,n){var i=t.length-1;if(i<n)return 0;var r=o(t[i]);return r>=0?(r>0&&(e.lastNeed=r-1),r):--i<n||-2===r?0:(r=o(t[i]))>=0?(r>0&&(e.lastNeed=r-2),r):--i<n||-2===r?0:(r=o(t[i]))>=0?(r>0&&(2===r?r=0:e.lastNeed=r-3),r):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var i=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,i),e.toString("utf8",t,i)},a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},1067:function(e,t,n){var i;!function(r,a){var o="function",s="undefined",l="object",c="string",u="major",d="model",h="name",f="type",p="vendor",g="version",m="architecture",v="console",y="mobile",_="tablet",E="smarttv",b="wearable",T="embedded",S="Amazon",w="Apple",A="ASUS",R="BlackBerry",x="Browser",I="Chrome",L="Firefox",M="Google",C="Huawei",P="LG",D="Microsoft",O="Motorola",N="Opera",k="Samsung",F="Sharp",B="Sony",U="Xiaomi",V="Zebra",G="Facebook",H="Chromium OS",j="Mac OS",z=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},Z=function(e,t){return typeof e===c&&-1!==q(t).indexOf(q(e))},q=function(e){return e.toLowerCase()},W=function(e,t){if(typeof e===c)return e=e.replace(/^\s\s*/,""),typeof t===s?e:e.substring(0,500)},Y=function(e,t){for(var n,i,r,s,c,u,d=0;d<t.length&&!c;){var h=t[d],f=t[d+1];for(n=i=0;n<h.length&&!c&&h[n];)if(c=h[n++].exec(e))for(r=0;r<f.length;r++)u=c[++i],typeof(s=f[r])===l&&s.length>0?2===s.length?typeof s[1]==o?this[s[0]]=s[1].call(this,u):this[s[0]]=s[1]:3===s.length?typeof s[1]!==o||s[1].exec&&s[1].test?this[s[0]]=u?u.replace(s[1],s[2]):a:this[s[0]]=u?s[1].call(this,u,s[2]):a:4===s.length&&(this[s[0]]=u?s[3].call(this,u.replace(s[1],s[2])):a):this[s]=u||a;d+=2}},K=function(e,t){for(var n in t)if(typeof t[n]===l&&t[n].length>0){for(var i=0;i<t[n].length;i++)if(Z(t[n][i],e))return"?"===n?a:n}else if(Z(t[n],e))return"?"===n?a:n;return e},X={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Q={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[h,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[h,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[h,g],[/opios[\/ ]+([\w\.]+)/i],[g,[h,N+" Mini"]],[/\bopr\/([\w\.]+)/i],[g,[h,N]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[g,[h,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[h,g],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[h,"UC"+x]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[g,[h,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[h,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[h,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[g,[h,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[g,[h,"Smart Lenovo "+x]],[/(avast|avg)\/([\w\.]+)/i],[[h,/(.+)/,"$1 Secure "+x],g],[/\bfocus\/([\w\.]+)/i],[g,[h,L+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[h,N+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[h,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[h,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[h,N+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[h,"MIUI "+x]],[/fxios\/([-\w\.]+)/i],[g,[h,L]],[/\bqihu|(qi?ho?o?|360)browser/i],[[h,"360 "+x]],[/(oculus|sailfish|huawei|vivo)browser\/([\w\.]+)/i],[[h,/(.+)/,"$1 "+x],g],[/samsungbrowser\/([\w\.]+)/i],[g,[h,k+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[h,/_/g," "],g],[/metasr[\/ ]?([\d\.]+)/i],[g,[h,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[h,"Sogou Mobile"],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[h,g],[/(lbbrowser)/i,/\[(linkedin)app\]/i],[h],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[h,G],g],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[h,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[h,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[g,[h,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[h,I+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[h,I+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[h,"Android "+x]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[h,g],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[g,[h,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[g,h],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[h,[g,K,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[h,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[h,"Netscape"],g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[h,L+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[h,g],[/(cobalt)\/([\w\.]+)/i],[h,[g,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,q]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[m,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[m,"armhf"]],[/windows (ce|mobile); ppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[m,/ower/,"",q]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[m,q]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[p,k],[f,_]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[d,[p,k],[f,y]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[d,[p,w],[f,y]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[p,w],[f,_]],[/(macintosh);/i],[d,[p,w]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[p,F],[f,y]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[p,C],[f,_]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[d,[p,C],[f,y]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[d,/_/g," "],[p,U],[f,y]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[p,U],[f,_]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[p,"OPPO"],[f,y]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[p,"Vivo"],[f,y]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[d,[p,"Realme"],[f,y]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[p,O],[f,y]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[p,O],[f,_]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[p,P],[f,_]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[p,P],[f,y]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[p,"Lenovo"],[f,_]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[p,"Nokia"],[f,y]],[/(pixel c)\b/i],[d,[p,M],[f,_]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[p,M],[f,y]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[p,B],[f,y]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[p,B],[f,_]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[p,"OnePlus"],[f,y]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[p,S],[f,_]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[p,S],[f,y]],[/(playbook);[-\w\),; ]+(rim)/i],[d,p,[f,_]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[p,R],[f,y]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[p,A],[f,_]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[p,A],[f,y]],[/(nexus 9)/i],[d,[p,"HTC"],[f,_]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[p,[d,/_/g," "],[f,y]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[p,"Acer"],[f,_]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[p,"Meizu"],[f,y]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[d,[p,"Ulefone"],[f,y]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[p,d,[f,y]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[p,d,[f,_]],[/(surface duo)/i],[d,[p,D],[f,_]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[p,"Fairphone"],[f,y]],[/(u304aa)/i],[d,[p,"AT&T"],[f,y]],[/\bsie-(\w*)/i],[d,[p,"Siemens"],[f,y]],[/\b(rct\w+) b/i],[d,[p,"RCA"],[f,_]],[/\b(venue[\d ]{2,7}) b/i],[d,[p,"Dell"],[f,_]],[/\b(q(?:mv|ta)\w+) b/i],[d,[p,"Verizon"],[f,_]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[p,"Barnes & Noble"],[f,_]],[/\b(tm\d{3}\w+) b/i],[d,[p,"NuVision"],[f,_]],[/\b(k88) b/i],[d,[p,"ZTE"],[f,_]],[/\b(nx\d{3}j) b/i],[d,[p,"ZTE"],[f,y]],[/\b(gen\d{3}) b.+49h/i],[d,[p,"Swiss"],[f,y]],[/\b(zur\d{3}) b/i],[d,[p,"Swiss"],[f,_]],[/\b((zeki)?tb.*\b) b/i],[d,[p,"Zeki"],[f,_]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[p,"Dragon Touch"],d,[f,_]],[/\b(ns-?\w{0,9}) b/i],[d,[p,"Insignia"],[f,_]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[p,"NextBook"],[f,_]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[p,"Voice"],d,[f,y]],[/\b(lvtel\-)?(v1[12]) b/i],[[p,"LvTel"],d,[f,y]],[/\b(ph-1) /i],[d,[p,"Essential"],[f,y]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[p,"Envizen"],[f,_]],[/\b(trio[-\w\. ]+) b/i],[d,[p,"MachSpeed"],[f,_]],[/\btu_(1491) b/i],[d,[p,"Rotor"],[f,_]],[/(shield[\w ]+) b/i],[d,[p,"Nvidia"],[f,_]],[/(sprint) (\w+)/i],[p,d,[f,y]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[p,D],[f,y]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[p,V],[f,_]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[p,V],[f,y]],[/smart-tv.+(samsung)/i],[p,[f,E]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[p,k],[f,E]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[p,P],[f,E]],[/(apple) ?tv/i],[p,[d,w+" TV"],[f,E]],[/crkey/i],[[d,I+"cast"],[p,M],[f,E]],[/droid.+aft(\w+)( bui|\))/i],[d,[p,S],[f,E]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[d,[p,F],[f,E]],[/(bravia[\w ]+)( bui|\))/i],[d,[p,B],[f,E]],[/(mitv-\w{5}) bui/i],[d,[p,U],[f,E]],[/Hbbtv.*(technisat) (.*);/i],[p,d,[f,E]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[p,W],[d,W],[f,E]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[f,E]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[p,d,[f,v]],[/droid.+; (shield) bui/i],[d,[p,"Nvidia"],[f,v]],[/(playstation [345portablevi]+)/i],[d,[p,B],[f,v]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[p,D],[f,v]],[/((pebble))app/i],[p,d,[f,b]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[d,[p,w],[f,b]],[/droid.+; (glass) \d/i],[d,[p,M],[f,b]],[/droid.+; (wt63?0{2,3})\)/i],[d,[p,V],[f,b]],[/(quest( 2| pro)?)/i],[d,[p,G],[f,b]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[p,[f,T]],[/(aeobc)\b/i],[d,[p,S],[f,T]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[d,[f,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[f,_]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[f,_]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[f,y]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[p,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[h,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[h,g],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,h]],os:[[/microsoft (windows) (vista|xp)/i],[h,g],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[h,[g,K,X]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[g,K,X],[h,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[h,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[h,j],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[g,h],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[h,g],[/\(bb(10);/i],[g,[h,R]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[g,[h,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[h,L+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[h,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[g,[h,"watchOS"]],[/crkey\/([\d\.]+)/i],[g,[h,I+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[h,H],g],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[h,g],[/(sunos) ?([\w\.\d]*)/i],[[h,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[h,g]]},J=function(e,t){if(typeof e===l&&(t=e,e=a),!(this instanceof J))return new J(e,t).getResult();var n=typeof r!==s&&r.navigator?r.navigator:a,i=e||(n&&n.userAgent?n.userAgent:""),v=n&&n.userAgentData?n.userAgentData:a,E=t?function(e,t){var n={};for(var i in e)t[i]&&t[i].length%2==0?n[i]=t[i].concat(e[i]):n[i]=e[i];return n}(Q,t):Q,b=n&&n.userAgent==i;return this.getBrowser=function(){var e,t={};return t[h]=a,t[g]=a,Y.call(t,i,E.browser),t[u]=typeof(e=t[g])===c?e.replace(/[^\d\.]/g,"").split(".")[0]:a,b&&n&&n.brave&&typeof n.brave.isBrave==o&&(t[h]="Brave"),t},this.getCPU=function(){var e={};return e[m]=a,Y.call(e,i,E.cpu),e},this.getDevice=function(){var e={};return e[p]=a,e[d]=a,e[f]=a,Y.call(e,i,E.device),b&&!e[f]&&v&&v.mobile&&(e[f]=y),b&&"Macintosh"==e[d]&&n&&typeof n.standalone!==s&&n.maxTouchPoints&&n.maxTouchPoints>2&&(e[d]="iPad",e[f]=_),e},this.getEngine=function(){var e={};return e[h]=a,e[g]=a,Y.call(e,i,E.engine),e},this.getOS=function(){var e={};return e[h]=a,e[g]=a,Y.call(e,i,E.os),b&&!e[h]&&v&&"Unknown"!=v.platform&&(e[h]=v.platform.replace(/chrome os/i,H).replace(/macos/i,j)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=typeof e===c&&e.length>500?W(e,500):e,this},this.setUA(i),this};J.VERSION="1.0.37",J.BROWSER=z([h,g,u]),J.CPU=z([m]),J.DEVICE=z([d,p,f,v,y,E,_,b,T]),J.ENGINE=J.OS=z([h,g]),typeof t!==s?(e.exports&&(t=e.exports=J),t.UAParser=J):n.amdO?(i=function(){return J}.call(t,n,t,e))===a||(e.exports=i):typeof r!==s&&(r.UAParser=J);var $=typeof r!==s&&(r.jQuery||r.Zepto);if($&&!$.ua){var ee=new J;$.ua=ee.getResult(),$.ua.get=function(){return ee.getUA()},$.ua.set=function(e){ee.setUA(e);var t=ee.getResult();for(var n in t)$.ua[n]=t[n]}}}("object"==typeof window?window:this)},7839:function(e,t,n){function i(e){try{if(!n.g.localStorage)return!1}catch(e){return!1}var t=n.g.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}e.exports=function(e,t){if(i("noDeprecation"))return e;var n=!1;return function(){if(!n){if(i("throwDeprecation"))throw new Error(t);i("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}},9862:function(){},964:function(){},3165:function(e){e.exports=JSON.parse('["mni-beng-in","mni-mtei-in","sat-deva-in","sat-olck-in","shi-latn-ma","shi-tfng-ma","vai-latn-lr","vai-vaii-lr","yue-hans-cn","yue-hant-hk","az-arab-ir","az-cyrl-az","az-latn-az","bm-nkoo-ml","bs-cyrl-ba","bs-latn-ba","en-dsrt-us","ff-adlm-gn","ff-latn-sn","ha-arab-ng","hi-latn-in","iu-latn-ca","ks-arab-in","ks-deva-in","mn-mong-cn","ms-arab-my","pa-arab-pk","pa-guru-in","sd-arab-pk","sd-deva-in","sr-cyrl-rs","sr-latn-rs","su-latn-id","uz-arab-af","uz-cyrl-uz","uz-latn-uz","zh-hans-cn","zh-hant-tw","mni-beng","sat-olck","shi-tfng","vai-vaii","yue-hant","az-latn","bs-latn","ff-latn","jbo-001","ks-arab","pa-guru","prg-001","sd-arab","sr-cyrl","su-latn","uz-latn","zh-hans","agq-cm","ar-001","arn-cl","asa-tz","ast-es","bas-cm","bem-zm","bez-tz","bgn-pk","blt-vn","brx-in","bss-cm","byn-er","cad-us","cch-ng","ccp-bd","ceb-ph","cgg-ug","chr-us","cic-us","ckb-iq","dav-ke","dje-ne","doi-in","dsb-de","dua-cm","dyo-sn","ebu-ke","eo-001","ewo-cm","fil-ph","fur-it","gaa-gh","gez-et","gsw-ch","guz-ke","haw-us","hsb-de","ia-001","ife-tg","io-001","jgo-cm","jmc-tz","kab-dz","kaj-ng","kam-ke","kcg-ng","kde-tz","kea-cv","ken-cm","khq-ml","kkj-cm","kln-ke","kok-in","kpe-lr","ksb-tz","ksf-cm","ksh-de","lag-tz","lkt-us","lrc-ir","luo-ke","luy-ke","mai-in","mas-ke","mer-ke","mfe-mu","mgh-mz","mgo-cm","moh-ca","mua-cm","mus-us","myv-ru","mzn-ir","naq-na","nds-de","nmg-cm","nnh-cm","nqo-gn","nso-za","nus-ss","nyn-ug","osa-us","pcm-ng","quc-gt","rof-tz","rwk-tz","sah-ru","saq-ke","sbp-tz","scn-it","sdh-ir","seh-mz","ses-ml","sid-et","sma-se","smj-se","smn-fi","sms-fi","ssy-er","syr-iq","szl-pl","teo-ug","tig-er","trv-tw","trw-pk","twq-ne","tzm-ma","vo-001","vun-tz","wae-ch","wal-et","wbp-au","xog-ug","yav-cm","yi-001","zgh-ma","aa-et","af-za","ak-gh","am-et","an-es","as-in","ba-ru","be-by","bg-bg","bm-ml","bn-bd","bo-cn","br-fr","ca-es","ce-ru","co-fr","cs-cz","cu-ru","cv-ru","cy-gb","da-dk","de-de","dv-mv","dz-bt","ee-gh","el-gr","en-us","es-es","et-ee","eu-es","fa-ir","fi-fi","fo-fo","fr-fr","fy-nl","ga-ie","gd-gb","gl-es","gn-py","gu-in","gv-im","ha-ng","he-il","hi-in","hr-hr","hu-hu","hy-am","id-id","ig-ng","ii-cn","is-is","it-it","iu-ca","ja-jp","jv-id","ka-ge","ki-ke","kk-kz","kl-gl","km-kh","kn-in","ko-kr","ku-tr","kw-gb","ky-kg","lb-lu","lg-ug","ln-cd","lo-la","lt-lt","lu-cd","lv-lv","mg-mg","mi-nz","mk-mk","ml-in","mn-mn","mr-in","ms-my","mt-mt","my-mm","nb-no","nd-zw","ne-np","nl-nl","nn-no","nr-za","nv-us","ny-mw","oc-fr","om-et","or-in","os-ge","pl-pl","ps-af","pt-br","qu-pe","rm-ch","rn-bi","ro-ro","ru-ru","rw-rw","sa-in","sc-it","se-no","sg-cf","si-lk","sk-sk","sl-si","sn-zw","so-so","sq-al","ss-za","st-za","sv-se","sw-tz","ta-in","te-in","tg-tj","th-th","ti-et","tk-tm","tn-za","to-to","tr-tr","ts-za","tt-ru","ug-cn","uk-ua","ur-pk","ve-za","vi-vn","wa-be","wo-sn","xh-za","yo-ng","zu-za"]')},5813:function(e){e.exports=JSON.parse('[{"from":{"field":"script","value":"qaai"},"to":{"field":"script","value":"zinh"}},{"from":{"field":"region","value":"bu"},"to":{"field":"region","value":"mm"}},{"from":{"field":"region","value":"ct"},"to":{"field":"region","value":"ki"}},{"from":{"field":"region","value":"dd"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"dy"},"to":{"field":"region","value":"bj"}},{"from":{"field":"region","value":"fx"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"hv"},"to":{"field":"region","value":"bf"}},{"from":{"field":"region","value":"jt"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"mi"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"nh"},"to":{"field":"region","value":"vu"}},{"from":{"field":"region","value":"nq"},"to":{"field":"region","value":"aq"}},{"from":{"field":"region","value":"pu"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"pz"},"to":{"field":"region","value":"pa"}},{"from":{"field":"region","value":"qu"},"to":{"field":"region","value":"eu"}},{"from":{"field":"region","value":"rh"},"to":{"field":"region","value":"zw"}},{"from":{"field":"region","value":"tp"},"to":{"field":"region","value":"tl"}},{"from":{"field":"region","value":"uk"},"to":{"field":"region","value":"gb"}},{"from":{"field":"region","value":"vd"},"to":{"field":"region","value":"vn"}},{"from":{"field":"region","value":"wk"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"yd"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"zr"},"to":{"field":"region","value":"cd"}},{"from":{"field":"region","value":"230"},"to":{"field":"region","value":"et"}},{"from":{"field":"region","value":"280"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"736"},"to":{"field":"region","value":"sd"}},{"from":{"field":"region","value":"886"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"958"},"to":{"field":"region","value":"aa"}},{"from":{"field":"region","value":"020"},"to":{"field":"region","value":"ad"}},{"from":{"field":"region","value":"784"},"to":{"field":"region","value":"ae"}},{"from":{"field":"region","value":"004"},"to":{"field":"region","value":"af"}},{"from":{"field":"region","value":"028"},"to":{"field":"region","value":"ag"}},{"from":{"field":"region","value":"660"},"to":{"field":"region","value":"ai"}},{"from":{"field":"region","value":"008"},"to":{"field":"region","value":"al"}},{"from":{"field":"region","value":"051"},"to":{"field":"region","value":"am"}},{"from":{"field":"region","value":"024"},"to":{"field":"region","value":"ao"}},{"from":{"field":"region","value":"010"},"to":{"field":"region","value":"aq"}},{"from":{"field":"region","value":"032"},"to":{"field":"region","value":"ar"}},{"from":{"field":"region","value":"016"},"to":{"field":"region","value":"as"}},{"from":{"field":"region","value":"040"},"to":{"field":"region","value":"at"}},{"from":{"field":"region","value":"036"},"to":{"field":"region","value":"au"}},{"from":{"field":"region","value":"533"},"to":{"field":"region","value":"aw"}},{"from":{"field":"region","value":"248"},"to":{"field":"region","value":"ax"}},{"from":{"field":"region","value":"031"},"to":{"field":"region","value":"az"}},{"from":{"field":"region","value":"070"},"to":{"field":"region","value":"ba"}},{"from":{"field":"region","value":"052"},"to":{"field":"region","value":"bb"}},{"from":{"field":"region","value":"050"},"to":{"field":"region","value":"bd"}},{"from":{"field":"region","value":"056"},"to":{"field":"region","value":"be"}},{"from":{"field":"region","value":"854"},"to":{"field":"region","value":"bf"}},{"from":{"field":"region","value":"100"},"to":{"field":"region","value":"bg"}},{"from":{"field":"region","value":"048"},"to":{"field":"region","value":"bh"}},{"from":{"field":"region","value":"108"},"to":{"field":"region","value":"bi"}},{"from":{"field":"region","value":"204"},"to":{"field":"region","value":"bj"}},{"from":{"field":"region","value":"652"},"to":{"field":"region","value":"bl"}},{"from":{"field":"region","value":"060"},"to":{"field":"region","value":"bm"}},{"from":{"field":"region","value":"096"},"to":{"field":"region","value":"bn"}},{"from":{"field":"region","value":"068"},"to":{"field":"region","value":"bo"}},{"from":{"field":"region","value":"535"},"to":{"field":"region","value":"bq"}},{"from":{"field":"region","value":"076"},"to":{"field":"region","value":"br"}},{"from":{"field":"region","value":"044"},"to":{"field":"region","value":"bs"}},{"from":{"field":"region","value":"064"},"to":{"field":"region","value":"bt"}},{"from":{"field":"region","value":"104"},"to":{"field":"region","value":"mm"}},{"from":{"field":"region","value":"074"},"to":{"field":"region","value":"bv"}},{"from":{"field":"region","value":"072"},"to":{"field":"region","value":"bw"}},{"from":{"field":"region","value":"112"},"to":{"field":"region","value":"by"}},{"from":{"field":"region","value":"084"},"to":{"field":"region","value":"bz"}},{"from":{"field":"region","value":"124"},"to":{"field":"region","value":"ca"}},{"from":{"field":"region","value":"166"},"to":{"field":"region","value":"cc"}},{"from":{"field":"region","value":"180"},"to":{"field":"region","value":"cd"}},{"from":{"field":"region","value":"140"},"to":{"field":"region","value":"cf"}},{"from":{"field":"region","value":"178"},"to":{"field":"region","value":"cg"}},{"from":{"field":"region","value":"756"},"to":{"field":"region","value":"ch"}},{"from":{"field":"region","value":"384"},"to":{"field":"region","value":"ci"}},{"from":{"field":"region","value":"184"},"to":{"field":"region","value":"ck"}},{"from":{"field":"region","value":"152"},"to":{"field":"region","value":"cl"}},{"from":{"field":"region","value":"120"},"to":{"field":"region","value":"cm"}},{"from":{"field":"region","value":"156"},"to":{"field":"region","value":"cn"}},{"from":{"field":"region","value":"170"},"to":{"field":"region","value":"co"}},{"from":{"field":"region","value":"188"},"to":{"field":"region","value":"cr"}},{"from":{"field":"region","value":"192"},"to":{"field":"region","value":"cu"}},{"from":{"field":"region","value":"132"},"to":{"field":"region","value":"cv"}},{"from":{"field":"region","value":"531"},"to":{"field":"region","value":"cw"}},{"from":{"field":"region","value":"162"},"to":{"field":"region","value":"cx"}},{"from":{"field":"region","value":"196"},"to":{"field":"region","value":"cy"}},{"from":{"field":"region","value":"203"},"to":{"field":"region","value":"cz"}},{"from":{"field":"region","value":"278"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"276"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"262"},"to":{"field":"region","value":"dj"}},{"from":{"field":"region","value":"208"},"to":{"field":"region","value":"dk"}},{"from":{"field":"region","value":"212"},"to":{"field":"region","value":"dm"}},{"from":{"field":"region","value":"214"},"to":{"field":"region","value":"do"}},{"from":{"field":"region","value":"012"},"to":{"field":"region","value":"dz"}},{"from":{"field":"region","value":"218"},"to":{"field":"region","value":"ec"}},{"from":{"field":"region","value":"233"},"to":{"field":"region","value":"ee"}},{"from":{"field":"region","value":"818"},"to":{"field":"region","value":"eg"}},{"from":{"field":"region","value":"732"},"to":{"field":"region","value":"eh"}},{"from":{"field":"region","value":"232"},"to":{"field":"region","value":"er"}},{"from":{"field":"region","value":"724"},"to":{"field":"region","value":"es"}},{"from":{"field":"region","value":"231"},"to":{"field":"region","value":"et"}},{"from":{"field":"region","value":"246"},"to":{"field":"region","value":"fi"}},{"from":{"field":"region","value":"242"},"to":{"field":"region","value":"fj"}},{"from":{"field":"region","value":"238"},"to":{"field":"region","value":"fk"}},{"from":{"field":"region","value":"583"},"to":{"field":"region","value":"fm"}},{"from":{"field":"region","value":"234"},"to":{"field":"region","value":"fo"}},{"from":{"field":"region","value":"250"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"249"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"266"},"to":{"field":"region","value":"ga"}},{"from":{"field":"region","value":"826"},"to":{"field":"region","value":"gb"}},{"from":{"field":"region","value":"308"},"to":{"field":"region","value":"gd"}},{"from":{"field":"region","value":"268"},"to":{"field":"region","value":"ge"}},{"from":{"field":"region","value":"254"},"to":{"field":"region","value":"gf"}},{"from":{"field":"region","value":"831"},"to":{"field":"region","value":"gg"}},{"from":{"field":"region","value":"288"},"to":{"field":"region","value":"gh"}},{"from":{"field":"region","value":"292"},"to":{"field":"region","value":"gi"}},{"from":{"field":"region","value":"304"},"to":{"field":"region","value":"gl"}},{"from":{"field":"region","value":"270"},"to":{"field":"region","value":"gm"}},{"from":{"field":"region","value":"324"},"to":{"field":"region","value":"gn"}},{"from":{"field":"region","value":"312"},"to":{"field":"region","value":"gp"}},{"from":{"field":"region","value":"226"},"to":{"field":"region","value":"gq"}},{"from":{"field":"region","value":"300"},"to":{"field":"region","value":"gr"}},{"from":{"field":"region","value":"239"},"to":{"field":"region","value":"gs"}},{"from":{"field":"region","value":"320"},"to":{"field":"region","value":"gt"}},{"from":{"field":"region","value":"316"},"to":{"field":"region","value":"gu"}},{"from":{"field":"region","value":"624"},"to":{"field":"region","value":"gw"}},{"from":{"field":"region","value":"328"},"to":{"field":"region","value":"gy"}},{"from":{"field":"region","value":"344"},"to":{"field":"region","value":"hk"}},{"from":{"field":"region","value":"334"},"to":{"field":"region","value":"hm"}},{"from":{"field":"region","value":"340"},"to":{"field":"region","value":"hn"}},{"from":{"field":"region","value":"191"},"to":{"field":"region","value":"hr"}},{"from":{"field":"region","value":"332"},"to":{"field":"region","value":"ht"}},{"from":{"field":"region","value":"348"},"to":{"field":"region","value":"hu"}},{"from":{"field":"region","value":"360"},"to":{"field":"region","value":"id"}},{"from":{"field":"region","value":"372"},"to":{"field":"region","value":"ie"}},{"from":{"field":"region","value":"376"},"to":{"field":"region","value":"il"}},{"from":{"field":"region","value":"833"},"to":{"field":"region","value":"im"}},{"from":{"field":"region","value":"356"},"to":{"field":"region","value":"in"}},{"from":{"field":"region","value":"086"},"to":{"field":"region","value":"io"}},{"from":{"field":"region","value":"368"},"to":{"field":"region","value":"iq"}},{"from":{"field":"region","value":"364"},"to":{"field":"region","value":"ir"}},{"from":{"field":"region","value":"352"},"to":{"field":"region","value":"is"}},{"from":{"field":"region","value":"380"},"to":{"field":"region","value":"it"}},{"from":{"field":"region","value":"832"},"to":{"field":"region","value":"je"}},{"from":{"field":"region","value":"388"},"to":{"field":"region","value":"jm"}},{"from":{"field":"region","value":"400"},"to":{"field":"region","value":"jo"}},{"from":{"field":"region","value":"392"},"to":{"field":"region","value":"jp"}},{"from":{"field":"region","value":"404"},"to":{"field":"region","value":"ke"}},{"from":{"field":"region","value":"417"},"to":{"field":"region","value":"kg"}},{"from":{"field":"region","value":"116"},"to":{"field":"region","value":"kh"}},{"from":{"field":"region","value":"296"},"to":{"field":"region","value":"ki"}},{"from":{"field":"region","value":"174"},"to":{"field":"region","value":"km"}},{"from":{"field":"region","value":"659"},"to":{"field":"region","value":"kn"}},{"from":{"field":"region","value":"408"},"to":{"field":"region","value":"kp"}},{"from":{"field":"region","value":"410"},"to":{"field":"region","value":"kr"}},{"from":{"field":"region","value":"414"},"to":{"field":"region","value":"kw"}},{"from":{"field":"region","value":"136"},"to":{"field":"region","value":"ky"}},{"from":{"field":"region","value":"398"},"to":{"field":"region","value":"kz"}},{"from":{"field":"region","value":"418"},"to":{"field":"region","value":"la"}},{"from":{"field":"region","value":"422"},"to":{"field":"region","value":"lb"}},{"from":{"field":"region","value":"662"},"to":{"field":"region","value":"lc"}},{"from":{"field":"region","value":"438"},"to":{"field":"region","value":"li"}},{"from":{"field":"region","value":"144"},"to":{"field":"region","value":"lk"}},{"from":{"field":"region","value":"430"},"to":{"field":"region","value":"lr"}},{"from":{"field":"region","value":"426"},"to":{"field":"region","value":"ls"}},{"from":{"field":"region","value":"440"},"to":{"field":"region","value":"lt"}},{"from":{"field":"region","value":"442"},"to":{"field":"region","value":"lu"}},{"from":{"field":"region","value":"428"},"to":{"field":"region","value":"lv"}},{"from":{"field":"region","value":"434"},"to":{"field":"region","value":"ly"}},{"from":{"field":"region","value":"504"},"to":{"field":"region","value":"ma"}},{"from":{"field":"region","value":"492"},"to":{"field":"region","value":"mc"}},{"from":{"field":"region","value":"498"},"to":{"field":"region","value":"md"}},{"from":{"field":"region","value":"499"},"to":{"field":"region","value":"me"}},{"from":{"field":"region","value":"663"},"to":{"field":"region","value":"mf"}},{"from":{"field":"region","value":"450"},"to":{"field":"region","value":"mg"}},{"from":{"field":"region","value":"584"},"to":{"field":"region","value":"mh"}},{"from":{"field":"region","value":"807"},"to":{"field":"region","value":"mk"}},{"from":{"field":"region","value":"466"},"to":{"field":"region","value":"ml"}},{"from":{"field":"region","value":"496"},"to":{"field":"region","value":"mn"}},{"from":{"field":"region","value":"446"},"to":{"field":"region","value":"mo"}},{"from":{"field":"region","value":"580"},"to":{"field":"region","value":"mp"}},{"from":{"field":"region","value":"474"},"to":{"field":"region","value":"mq"}},{"from":{"field":"region","value":"478"},"to":{"field":"region","value":"mr"}},{"from":{"field":"region","value":"500"},"to":{"field":"region","value":"ms"}},{"from":{"field":"region","value":"470"},"to":{"field":"region","value":"mt"}},{"from":{"field":"region","value":"480"},"to":{"field":"region","value":"mu"}},{"from":{"field":"region","value":"462"},"to":{"field":"region","value":"mv"}},{"from":{"field":"region","value":"454"},"to":{"field":"region","value":"mw"}},{"from":{"field":"region","value":"484"},"to":{"field":"region","value":"mx"}},{"from":{"field":"region","value":"458"},"to":{"field":"region","value":"my"}},{"from":{"field":"region","value":"508"},"to":{"field":"region","value":"mz"}},{"from":{"field":"region","value":"516"},"to":{"field":"region","value":"na"}},{"from":{"field":"region","value":"540"},"to":{"field":"region","value":"nc"}},{"from":{"field":"region","value":"562"},"to":{"field":"region","value":"ne"}},{"from":{"field":"region","value":"574"},"to":{"field":"region","value":"nf"}},{"from":{"field":"region","value":"566"},"to":{"field":"region","value":"ng"}},{"from":{"field":"region","value":"558"},"to":{"field":"region","value":"ni"}},{"from":{"field":"region","value":"528"},"to":{"field":"region","value":"nl"}},{"from":{"field":"region","value":"578"},"to":{"field":"region","value":"no"}},{"from":{"field":"region","value":"524"},"to":{"field":"region","value":"np"}},{"from":{"field":"region","value":"520"},"to":{"field":"region","value":"nr"}},{"from":{"field":"region","value":"570"},"to":{"field":"region","value":"nu"}},{"from":{"field":"region","value":"554"},"to":{"field":"region","value":"nz"}},{"from":{"field":"region","value":"512"},"to":{"field":"region","value":"om"}},{"from":{"field":"region","value":"591"},"to":{"field":"region","value":"pa"}},{"from":{"field":"region","value":"604"},"to":{"field":"region","value":"pe"}},{"from":{"field":"region","value":"258"},"to":{"field":"region","value":"pf"}},{"from":{"field":"region","value":"598"},"to":{"field":"region","value":"pg"}},{"from":{"field":"region","value":"608"},"to":{"field":"region","value":"ph"}},{"from":{"field":"region","value":"586"},"to":{"field":"region","value":"pk"}},{"from":{"field":"region","value":"616"},"to":{"field":"region","value":"pl"}},{"from":{"field":"region","value":"666"},"to":{"field":"region","value":"pm"}},{"from":{"field":"region","value":"612"},"to":{"field":"region","value":"pn"}},{"from":{"field":"region","value":"630"},"to":{"field":"region","value":"pr"}},{"from":{"field":"region","value":"275"},"to":{"field":"region","value":"ps"}},{"from":{"field":"region","value":"620"},"to":{"field":"region","value":"pt"}},{"from":{"field":"region","value":"585"},"to":{"field":"region","value":"pw"}},{"from":{"field":"region","value":"600"},"to":{"field":"region","value":"py"}},{"from":{"field":"region","value":"634"},"to":{"field":"region","value":"qa"}},{"from":{"field":"region","value":"959"},"to":{"field":"region","value":"qm"}},{"from":{"field":"region","value":"960"},"to":{"field":"region","value":"qn"}},{"from":{"field":"region","value":"962"},"to":{"field":"region","value":"qp"}},{"from":{"field":"region","value":"963"},"to":{"field":"region","value":"qq"}},{"from":{"field":"region","value":"964"},"to":{"field":"region","value":"qr"}},{"from":{"field":"region","value":"965"},"to":{"field":"region","value":"qs"}},{"from":{"field":"region","value":"966"},"to":{"field":"region","value":"qt"}},{"from":{"field":"region","value":"967"},"to":{"field":"region","value":"eu"}},{"from":{"field":"region","value":"968"},"to":{"field":"region","value":"qv"}},{"from":{"field":"region","value":"969"},"to":{"field":"region","value":"qw"}},{"from":{"field":"region","value":"970"},"to":{"field":"region","value":"qx"}},{"from":{"field":"region","value":"971"},"to":{"field":"region","value":"qy"}},{"from":{"field":"region","value":"972"},"to":{"field":"region","value":"qz"}},{"from":{"field":"region","value":"638"},"to":{"field":"region","value":"re"}},{"from":{"field":"region","value":"642"},"to":{"field":"region","value":"ro"}},{"from":{"field":"region","value":"688"},"to":{"field":"region","value":"rs"}},{"from":{"field":"region","value":"643"},"to":{"field":"region","value":"ru"}},{"from":{"field":"region","value":"646"},"to":{"field":"region","value":"rw"}},{"from":{"field":"region","value":"682"},"to":{"field":"region","value":"sa"}},{"from":{"field":"region","value":"090"},"to":{"field":"region","value":"sb"}},{"from":{"field":"region","value":"690"},"to":{"field":"region","value":"sc"}},{"from":{"field":"region","value":"729"},"to":{"field":"region","value":"sd"}},{"from":{"field":"region","value":"752"},"to":{"field":"region","value":"se"}},{"from":{"field":"region","value":"702"},"to":{"field":"region","value":"sg"}},{"from":{"field":"region","value":"654"},"to":{"field":"region","value":"sh"}},{"from":{"field":"region","value":"705"},"to":{"field":"region","value":"si"}},{"from":{"field":"region","value":"744"},"to":{"field":"region","value":"sj"}},{"from":{"field":"region","value":"703"},"to":{"field":"region","value":"sk"}},{"from":{"field":"region","value":"694"},"to":{"field":"region","value":"sl"}},{"from":{"field":"region","value":"674"},"to":{"field":"region","value":"sm"}},{"from":{"field":"region","value":"686"},"to":{"field":"region","value":"sn"}},{"from":{"field":"region","value":"706"},"to":{"field":"region","value":"so"}},{"from":{"field":"region","value":"740"},"to":{"field":"region","value":"sr"}},{"from":{"field":"region","value":"728"},"to":{"field":"region","value":"ss"}},{"from":{"field":"region","value":"678"},"to":{"field":"region","value":"st"}},{"from":{"field":"region","value":"222"},"to":{"field":"region","value":"sv"}},{"from":{"field":"region","value":"534"},"to":{"field":"region","value":"sx"}},{"from":{"field":"region","value":"760"},"to":{"field":"region","value":"sy"}},{"from":{"field":"region","value":"748"},"to":{"field":"region","value":"sz"}},{"from":{"field":"region","value":"796"},"to":{"field":"region","value":"tc"}},{"from":{"field":"region","value":"148"},"to":{"field":"region","value":"td"}},{"from":{"field":"region","value":"260"},"to":{"field":"region","value":"tf"}},{"from":{"field":"region","value":"768"},"to":{"field":"region","value":"tg"}},{"from":{"field":"region","value":"764"},"to":{"field":"region","value":"th"}},{"from":{"field":"region","value":"762"},"to":{"field":"region","value":"tj"}},{"from":{"field":"region","value":"772"},"to":{"field":"region","value":"tk"}},{"from":{"field":"region","value":"626"},"to":{"field":"region","value":"tl"}},{"from":{"field":"region","value":"795"},"to":{"field":"region","value":"tm"}},{"from":{"field":"region","value":"788"},"to":{"field":"region","value":"tn"}},{"from":{"field":"region","value":"776"},"to":{"field":"region","value":"to"}},{"from":{"field":"region","value":"792"},"to":{"field":"region","value":"tr"}},{"from":{"field":"region","value":"780"},"to":{"field":"region","value":"tt"}},{"from":{"field":"region","value":"798"},"to":{"field":"region","value":"tv"}},{"from":{"field":"region","value":"158"},"to":{"field":"region","value":"tw"}},{"from":{"field":"region","value":"834"},"to":{"field":"region","value":"tz"}},{"from":{"field":"region","value":"804"},"to":{"field":"region","value":"ua"}},{"from":{"field":"region","value":"800"},"to":{"field":"region","value":"ug"}},{"from":{"field":"region","value":"581"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"840"},"to":{"field":"region","value":"us"}},{"from":{"field":"region","value":"858"},"to":{"field":"region","value":"uy"}},{"from":{"field":"region","value":"860"},"to":{"field":"region","value":"uz"}},{"from":{"field":"region","value":"336"},"to":{"field":"region","value":"va"}},{"from":{"field":"region","value":"670"},"to":{"field":"region","value":"vc"}},{"from":{"field":"region","value":"862"},"to":{"field":"region","value":"ve"}},{"from":{"field":"region","value":"092"},"to":{"field":"region","value":"vg"}},{"from":{"field":"region","value":"850"},"to":{"field":"region","value":"vi"}},{"from":{"field":"region","value":"704"},"to":{"field":"region","value":"vn"}},{"from":{"field":"region","value":"548"},"to":{"field":"region","value":"vu"}},{"from":{"field":"region","value":"876"},"to":{"field":"region","value":"wf"}},{"from":{"field":"region","value":"882"},"to":{"field":"region","value":"ws"}},{"from":{"field":"region","value":"973"},"to":{"field":"region","value":"xa"}},{"from":{"field":"region","value":"974"},"to":{"field":"region","value":"xb"}},{"from":{"field":"region","value":"975"},"to":{"field":"region","value":"xc"}},{"from":{"field":"region","value":"976"},"to":{"field":"region","value":"xd"}},{"from":{"field":"region","value":"977"},"to":{"field":"region","value":"xe"}},{"from":{"field":"region","value":"978"},"to":{"field":"region","value":"xf"}},{"from":{"field":"region","value":"979"},"to":{"field":"region","value":"xg"}},{"from":{"field":"region","value":"980"},"to":{"field":"region","value":"xh"}},{"from":{"field":"region","value":"981"},"to":{"field":"region","value":"xi"}},{"from":{"field":"region","value":"982"},"to":{"field":"region","value":"xj"}},{"from":{"field":"region","value":"983"},"to":{"field":"region","value":"xk"}},{"from":{"field":"region","value":"984"},"to":{"field":"region","value":"xl"}},{"from":{"field":"region","value":"985"},"to":{"field":"region","value":"xm"}},{"from":{"field":"region","value":"986"},"to":{"field":"region","value":"xn"}},{"from":{"field":"region","value":"987"},"to":{"field":"region","value":"xo"}},{"from":{"field":"region","value":"988"},"to":{"field":"region","value":"xp"}},{"from":{"field":"region","value":"989"},"to":{"field":"region","value":"xq"}},{"from":{"field":"region","value":"990"},"to":{"field":"region","value":"xr"}},{"from":{"field":"region","value":"991"},"to":{"field":"region","value":"xs"}},{"from":{"field":"region","value":"992"},"to":{"field":"region","value":"xt"}},{"from":{"field":"region","value":"993"},"to":{"field":"region","value":"xu"}},{"from":{"field":"region","value":"994"},"to":{"field":"region","value":"xv"}},{"from":{"field":"region","value":"995"},"to":{"field":"region","value":"xw"}},{"from":{"field":"region","value":"996"},"to":{"field":"region","value":"xx"}},{"from":{"field":"region","value":"997"},"to":{"field":"region","value":"xy"}},{"from":{"field":"region","value":"998"},"to":{"field":"region","value":"xz"}},{"from":{"field":"region","value":"720"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"887"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"175"},"to":{"field":"region","value":"yt"}},{"from":{"field":"region","value":"710"},"to":{"field":"region","value":"za"}},{"from":{"field":"region","value":"894"},"to":{"field":"region","value":"zm"}},{"from":{"field":"region","value":"716"},"to":{"field":"region","value":"zw"}},{"from":{"field":"region","value":"999"},"to":{"field":"region","value":"zz"}},{"from":{"field":"variants","value":"aaland"},"to":{"field":"region","value":"ax"}},{"from":{"field":"variants","value":"polytoni"},"to":{"field":"variants","value":"polyton"}},{"from":{"field":"variants","value":"heploc"},"to":{"field":"variants","value":"alalc97"}},{"from":{"field":"variants","value":"arevela"},"to":{"field":"language","value":"hy"}},{"from":{"field":"variants","value":"arevmda"},"to":{"field":"language","value":"hyw"}}]')},9460:function(e){e.exports=JSON.parse('{"region":{"172":["ru","am","az","by","ge","kg","kz","md","tj","tm","ua","uz"],"200":["cz","sk"],"530":["cw","sx","bq"],"532":["cw","sx","bq"],"536":["sa","iq"],"582":["fm","mh","mp","pw"],"810":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"830":["je","gg"],"890":["rs","me","si","hr","mk","ba"],"891":["rs","me"],"an":["cw","sx","bq"],"cs":["rs","me"],"fq":["aq","tf"],"nt":["sa","iq"],"pc":["fm","mh","mp","pw"],"su":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"yu":["rs","me"],"062":["034","143"],"ant":["cw","sx","bq"],"scg":["rs","me"],"ntz":["sa","iq"],"sun":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"yug":["rs","me"]}}')},7778:function(e){e.exports=JSON.parse('[{"from":"in","to":"id"},{"from":"iw","to":"he"},{"from":"ji","to":"yi"},{"from":"jw","to":"jv"},{"from":"mo","to":"ro"},{"from":"scc","to":"sr"},{"from":"scr","to":"hr"},{"from":"aam","to":"aas"},{"from":"adp","to":"dz"},{"from":"aue","to":"ktz"},{"from":"ayx","to":"nun"},{"from":"bgm","to":"bcg"},{"from":"bjd","to":"drl"},{"from":"ccq","to":"rki"},{"from":"cjr","to":"mom"},{"from":"cka","to":"cmr"},{"from":"cmk","to":"xch"},{"from":"coy","to":"pij"},{"from":"cqu","to":"quh"},{"from":"drh","to":"mn"},{"from":"drw","to":"fa-af"},{"from":"gav","to":"dev"},{"from":"gfx","to":"vaj"},{"from":"ggn","to":"gvr"},{"from":"gti","to":"nyc"},{"from":"guv","to":"duz"},{"from":"hrr","to":"jal"},{"from":"ibi","to":"opa"},{"from":"ilw","to":"gal"},{"from":"jeg","to":"oyb"},{"from":"kgc","to":"tdf"},{"from":"kgh","to":"kml"},{"from":"koj","to":"kwv"},{"from":"krm","to":"bmf"},{"from":"ktr","to":"dtp"},{"from":"kvs","to":"gdj"},{"from":"kwq","to":"yam"},{"from":"kxe","to":"tvd"},{"from":"kzj","to":"dtp"},{"from":"kzt","to":"dtp"},{"from":"lii","to":"raq"},{"from":"lmm","to":"rmx"},{"from":"meg","to":"cir"},{"from":"mst","to":"mry"},{"from":"mwj","to":"vaj"},{"from":"myt","to":"mry"},{"from":"nad","to":"xny"},{"from":"ncp","to":"kdz"},{"from":"nnx","to":"ngv"},{"from":"nts","to":"pij"},{"from":"oun","to":"vaj"},{"from":"pcr","to":"adx"},{"from":"pmc","to":"huw"},{"from":"pmu","to":"phr"},{"from":"ppa","to":"bfy"},{"from":"ppr","to":"lcq"},{"from":"pry","to":"prt"},{"from":"puz","to":"pub"},{"from":"sca","to":"hle"},{"from":"skk","to":"oyb"},{"from":"tdu","to":"dtp"},{"from":"thc","to":"tpo"},{"from":"thx","to":"oyb"},{"from":"tie","to":"ras"},{"from":"tkk","to":"twm"},{"from":"tlw","to":"weo"},{"from":"tmp","to":"tyj"},{"from":"tne","to":"kak"},{"from":"tnf","to":"fa-af"},{"from":"tsf","to":"taj"},{"from":"uok","to":"ema"},{"from":"xba","to":"cax"},{"from":"xia","to":"acn"},{"from":"xkh","to":"waw"},{"from":"xsj","to":"suj"},{"from":"ybd","to":"rki"},{"from":"yma","to":"lrr"},{"from":"ymt","to":"mtm"},{"from":"yos","to":"zom"},{"from":"yuu","to":"yug"},{"from":"asd","to":"snz"},{"from":"dit","to":"dif"},{"from":"llo","to":"ngt"},{"from":"myd","to":"aog"},{"from":"nns","to":"nbr"},{"from":"sgn-br","to":"bzs"},{"from":"sgn-co","to":"csn"},{"from":"sgn-de","to":"gsg"},{"from":"sgn-dk","to":"dsl"},{"from":"sgn-fr","to":"fsl"},{"from":"sgn-gb","to":"bfi"},{"from":"sgn-gr","to":"gss"},{"from":"sgn-ie","to":"isg"},{"from":"sgn-it","to":"ise"},{"from":"sgn-jp","to":"jsl"},{"from":"sgn-mx","to":"mfs"},{"from":"sgn-ni","to":"ncs"},{"from":"sgn-nl","to":"dse"},{"from":"sgn-no","to":"nsi"},{"from":"sgn-pt","to":"psr"},{"from":"sgn-se","to":"swl"},{"from":"sgn-us","to":"ase"},{"from":"sgn-za","to":"sfs"},{"from":"no-bokmal","to":"nb"},{"from":"no-nynorsk","to":"nn"},{"from":"aa-saaho","to":"ssy"},{"from":"sh","to":"sr-latn"},{"from":"cnr","to":"sr-me"},{"from":"no","to":"nb"},{"from":"tl","to":"fil"},{"from":"az-az","to":"az-latn-az"},{"from":"bs-ba","to":"bs-latn-ba"},{"from":"ha-latn-gh","to":"ha-gh"},{"from":"ha-latn-ne","to":"ha-ne"},{"from":"ha-latn-ng","to":"ha-ng"},{"from":"kk-cyrl-kz","to":"kk-kz"},{"from":"ky-cyrl-kg","to":"ky-kg"},{"from":"ks-arab-in","to":"ks-in"},{"from":"mn-cyrl-mn","to":"mn-mn"},{"from":"ms-latn-bn","to":"ms-bn"},{"from":"ms-latn-my","to":"ms-my"},{"from":"ms-latn-sg","to":"ms-sg"},{"from":"pa-in","to":"pa-guru-in"},{"from":"pa-pk","to":"pa-arab-pk"},{"from":"shi-ma","to":"shi-tfng-ma"},{"from":"sr-ba","to":"sr-cyrl-ba"},{"from":"sr-me","to":"sr-latn-me"},{"from":"sr-rs","to":"sr-cyrl-rs"},{"from":"sr-xk","to":"sr-cyrl-xk"},{"from":"tzm-latn-ma","to":"tzm-ma"},{"from":"ug-arab-cn","to":"ug-cn"},{"from":"uz-af","to":"uz-arab-af"},{"from":"uz-uz","to":"uz-latn-uz"},{"from":"vai-lr","to":"vai-vaii-lr"},{"from":"yue-cn","to":"yue-hans-cn"},{"from":"yue-hk","to":"yue-hant-hk"},{"from":"zh-cn","to":"zh-hans-cn"},{"from":"zh-hk","to":"zh-hant-hk"},{"from":"zh-mo","to":"zh-hant-mo"},{"from":"zh-sg","to":"zh-hans-sg"},{"from":"zh-tw","to":"zh-hant-tw"},{"from":"aju","to":"jrb"},{"from":"als","to":"sq"},{"from":"arb","to":"ar"},{"from":"ayr","to":"ay"},{"from":"azj","to":"az"},{"from":"bcc","to":"bal"},{"from":"bcl","to":"bik"},{"from":"bxk","to":"luy"},{"from":"bxr","to":"bua"},{"from":"cld","to":"syr"},{"from":"cmn","to":"zh"},{"from":"cwd","to":"cr"},{"from":"dgo","to":"doi"},{"from":"dhd","to":"mwr"},{"from":"dik","to":"din"},{"from":"diq","to":"zza"},{"from":"lbk","to":"bnc"},{"from":"ekk","to":"et"},{"from":"emk","to":"man"},{"from":"esk","to":"ik"},{"from":"fat","to":"ak"},{"from":"fuc","to":"ff"},{"from":"gaz","to":"om"},{"from":"gbo","to":"grb"},{"from":"gno","to":"gon"},{"from":"gug","to":"gn"},{"from":"gya","to":"gba"},{"from":"hdn","to":"hai"},{"from":"hea","to":"hmn"},{"from":"ike","to":"iu"},{"from":"kmr","to":"ku"},{"from":"knc","to":"kr"},{"from":"kng","to":"kg"},{"from":"knn","to":"kok"},{"from":"kpv","to":"kv"},{"from":"lvs","to":"lv"},{"from":"mhr","to":"chm"},{"from":"mup","to":"raj"},{"from":"khk","to":"mn"},{"from":"npi","to":"ne"},{"from":"ojg","to":"oj"},{"from":"ory","to":"or"},{"from":"pbu","to":"ps"},{"from":"pes","to":"fa"},{"from":"plt","to":"mg"},{"from":"pnb","to":"lah"},{"from":"quz","to":"qu"},{"from":"rmy","to":"rom"},{"from":"spy","to":"kln"},{"from":"src","to":"sc"},{"from":"swh","to":"sw"},{"from":"ttq","to":"tmh"},{"from":"tw","to":"ak"},{"from":"umu","to":"del"},{"from":"uzn","to":"uz"},{"from":"xpe","to":"kpe"},{"from":"xsl","to":"den"},{"from":"ydd","to":"yi"},{"from":"zai","to":"zap"},{"from":"zsm","to":"ms"},{"from":"zyb","to":"za"},{"from":"him","to":"srx"},{"from":"mnk","to":"man"},{"from":"bh","to":"bho"},{"from":"prs","to":"fa-af"},{"from":"swc","to":"sw-cd"},{"from":"aar","to":"aa"},{"from":"abk","to":"ab"},{"from":"ave","to":"ae"},{"from":"afr","to":"af"},{"from":"aka","to":"ak"},{"from":"amh","to":"am"},{"from":"arg","to":"an"},{"from":"ara","to":"ar"},{"from":"asm","to":"as"},{"from":"ava","to":"av"},{"from":"aym","to":"ay"},{"from":"aze","to":"az"},{"from":"bak","to":"ba"},{"from":"bel","to":"be"},{"from":"bul","to":"bg"},{"from":"bih","to":"bho"},{"from":"bis","to":"bi"},{"from":"bam","to":"bm"},{"from":"ben","to":"bn"},{"from":"bod","to":"bo"},{"from":"bre","to":"br"},{"from":"bos","to":"bs"},{"from":"cat","to":"ca"},{"from":"che","to":"ce"},{"from":"cha","to":"ch"},{"from":"cos","to":"co"},{"from":"cre","to":"cr"},{"from":"ces","to":"cs"},{"from":"chu","to":"cu"},{"from":"chv","to":"cv"},{"from":"cym","to":"cy"},{"from":"dan","to":"da"},{"from":"deu","to":"de"},{"from":"div","to":"dv"},{"from":"dzo","to":"dz"},{"from":"ewe","to":"ee"},{"from":"ell","to":"el"},{"from":"eng","to":"en"},{"from":"epo","to":"eo"},{"from":"spa","to":"es"},{"from":"est","to":"et"},{"from":"eus","to":"eu"},{"from":"fas","to":"fa"},{"from":"ful","to":"ff"},{"from":"fin","to":"fi"},{"from":"fij","to":"fj"},{"from":"fao","to":"fo"},{"from":"fra","to":"fr"},{"from":"fry","to":"fy"},{"from":"gle","to":"ga"},{"from":"gla","to":"gd"},{"from":"glg","to":"gl"},{"from":"grn","to":"gn"},{"from":"guj","to":"gu"},{"from":"glv","to":"gv"},{"from":"hau","to":"ha"},{"from":"heb","to":"he"},{"from":"hin","to":"hi"},{"from":"hmo","to":"ho"},{"from":"hrv","to":"hr"},{"from":"hat","to":"ht"},{"from":"hun","to":"hu"},{"from":"hye","to":"hy"},{"from":"her","to":"hz"},{"from":"ina","to":"ia"},{"from":"ind","to":"id"},{"from":"ile","to":"ie"},{"from":"ibo","to":"ig"},{"from":"iii","to":"ii"},{"from":"ipk","to":"ik"},{"from":"ido","to":"io"},{"from":"isl","to":"is"},{"from":"ita","to":"it"},{"from":"iku","to":"iu"},{"from":"jpn","to":"ja"},{"from":"jav","to":"jv"},{"from":"kat","to":"ka"},{"from":"kon","to":"kg"},{"from":"kik","to":"ki"},{"from":"kua","to":"kj"},{"from":"kaz","to":"kk"},{"from":"kal","to":"kl"},{"from":"khm","to":"km"},{"from":"kan","to":"kn"},{"from":"kor","to":"ko"},{"from":"kau","to":"kr"},{"from":"kas","to":"ks"},{"from":"kur","to":"ku"},{"from":"kom","to":"kv"},{"from":"cor","to":"kw"},{"from":"kir","to":"ky"},{"from":"lat","to":"la"},{"from":"ltz","to":"lb"},{"from":"lug","to":"lg"},{"from":"lim","to":"li"},{"from":"lin","to":"ln"},{"from":"lao","to":"lo"},{"from":"lit","to":"lt"},{"from":"lub","to":"lu"},{"from":"lav","to":"lv"},{"from":"mlg","to":"mg"},{"from":"mah","to":"mh"},{"from":"mri","to":"mi"},{"from":"mkd","to":"mk"},{"from":"mal","to":"ml"},{"from":"mon","to":"mn"},{"from":"mol","to":"ro"},{"from":"mar","to":"mr"},{"from":"msa","to":"ms"},{"from":"mlt","to":"mt"},{"from":"mya","to":"my"},{"from":"nau","to":"na"},{"from":"nob","to":"nb"},{"from":"nde","to":"nd"},{"from":"nep","to":"ne"},{"from":"ndo","to":"ng"},{"from":"nld","to":"nl"},{"from":"nno","to":"nn"},{"from":"nor","to":"nb"},{"from":"nbl","to":"nr"},{"from":"nav","to":"nv"},{"from":"nya","to":"ny"},{"from":"oci","to":"oc"},{"from":"oji","to":"oj"},{"from":"orm","to":"om"},{"from":"ori","to":"or"},{"from":"oss","to":"os"},{"from":"pan","to":"pa"},{"from":"pli","to":"pi"},{"from":"pol","to":"pl"},{"from":"pus","to":"ps"},{"from":"por","to":"pt"},{"from":"que","to":"qu"},{"from":"roh","to":"rm"},{"from":"run","to":"rn"},{"from":"ron","to":"ro"},{"from":"rus","to":"ru"},{"from":"kin","to":"rw"},{"from":"san","to":"sa"},{"from":"srd","to":"sc"},{"from":"snd","to":"sd"},{"from":"sme","to":"se"},{"from":"sag","to":"sg"},{"from":"hbs","to":"sr-latn"},{"from":"sin","to":"si"},{"from":"slk","to":"sk"},{"from":"slv","to":"sl"},{"from":"smo","to":"sm"},{"from":"sna","to":"sn"},{"from":"som","to":"so"},{"from":"sqi","to":"sq"},{"from":"srp","to":"sr"},{"from":"ssw","to":"ss"},{"from":"sot","to":"st"},{"from":"sun","to":"su"},{"from":"swe","to":"sv"},{"from":"swa","to":"sw"},{"from":"tam","to":"ta"},{"from":"tel","to":"te"},{"from":"tgk","to":"tg"},{"from":"tha","to":"th"},{"from":"tir","to":"ti"},{"from":"tuk","to":"tk"},{"from":"tgl","to":"fil"},{"from":"tsn","to":"tn"},{"from":"ton","to":"to"},{"from":"tur","to":"tr"},{"from":"tso","to":"ts"},{"from":"tat","to":"tt"},{"from":"twi","to":"ak"},{"from":"tah","to":"ty"},{"from":"uig","to":"ug"},{"from":"ukr","to":"uk"},{"from":"urd","to":"ur"},{"from":"uzb","to":"uz"},{"from":"ven","to":"ve"},{"from":"vie","to":"vi"},{"from":"vol","to":"vo"},{"from":"wln","to":"wa"},{"from":"wol","to":"wo"},{"from":"xho","to":"xh"},{"from":"yid","to":"yi"},{"from":"yor","to":"yo"},{"from":"zha","to":"za"},{"from":"zho","to":"zh"},{"from":"zul","to":"zu"},{"from":"alb","to":"sq"},{"from":"arm","to":"hy"},{"from":"baq","to":"eu"},{"from":"bur","to":"my"},{"from":"chi","to":"zh"},{"from":"cze","to":"cs"},{"from":"dut","to":"nl"},{"from":"fre","to":"fr"},{"from":"geo","to":"ka"},{"from":"ger","to":"de"},{"from":"gre","to":"el"},{"from":"ice","to":"is"},{"from":"mac","to":"mk"},{"from":"mao","to":"mi"},{"from":"may","to":"ms"},{"from":"per","to":"fa"},{"from":"rum","to":"ro"},{"from":"slo","to":"sk"},{"from":"tib","to":"bo"},{"from":"wel","to":"cy"}]')},8589:function(e){e.exports=JSON.parse('{"en-gb-oed":"en-GB-oxendict","i-ami":"ami","i-bnn":"bnn","i-default":null,"i-enochian":null,"i-hak":"hak","i-klingon":"tlh","i-lux":"lb","i-mingo":null,"i-navajo":"nv","i-pwn":"pwn","i-tao":"tao","i-tay":"tay","i-tsu":"tsu","sgn-be-fr":"sfb","sgn-be-nl":"vgt","sgn-ch-de":"sgg","art-lojban":"jbo","cel-gaulish":null,"no-bok":"nb","no-nyn":"nn","zh-guoyu":"cmn","zh-hakka":"hak","zh-min":null,"zh-min-nan":"nan","zh-xiang":"hsn"}')},858:function(e){e.exports=JSON.parse('["art-lojban","cel-gaulish","no-bok","no-nyn","zh-guoyu","zh-hakka","zh-min","zh-min-nan","zh-xiang"]')}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var a=t[i]={exports:{}};return e[i].call(a.exports,a,a.exports,n),a.exports}n.amdO={},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var i={};return function(){n.d(i,{default:function(){return u}}),n(8416);var e,t=n(1715),r=n(8080),a=n(1737),o=n(1139),s=function(){var e,t="application/dash+xml";function n(n,i,r){if(!n||!/^VIDEO$/i.test(n.nodeName))return null;if(n._dashjs_player)return n._dashjs_player;var a,s=n.id||n.name||"video element";if(!(i=i||[].slice.call(n.querySelectorAll("source")).filter(function(e){return e.type==t})[0])&&n.src)(i=document.createElement("source")).src=n.src;else if(!i&&!n.src)return null;return r=r||{},(a=(0,o.Z)(r).create()).initialize(n,i.src,n.autoplay),e||(e=a.getDebug().getLogger()),e.debug("Converted "+s+" to dash.js player and added content: "+i.src),n._dashjs_player=a,a}function i(e){return/^VIDEO$/i.test(e.nodeName)?e:i(e.parentNode)}return{create:n,createAll:function(e,r){var a=[];e=e||"[data-dashjs-player]";for(var o=(r=r||document).querySelectorAll(e),s=0;s<o.length;s++){var l=n(o[s],null);a.push(l)}for(var c=r.querySelectorAll('source[type="'+t+'"]'),u=0;u<c.length;u++){var d=n(i(c[u]),null);a.push(d)}return a}}}();!(typeof window<"u"&&window&&window.dashjs&&window.dashjs.skipAutoCreate)&&typeof window<"u"&&window&&window.addEventListener&&("complete"===window.document.readyState?window.dashjs?s.createAll():e=window.setInterval(function(){window.dashjs&&(window.clearInterval(e),s.createAll())},500):window.addEventListener("load",function e(){window.removeEventListener("load",e),s.createAll()}));var l=s,c=n(6398);dashjs.Protection=a.default,dashjs.MetricsReporting=r.default,dashjs.MediaPlayerFactory=l,dashjs.Debug=c.Z,dashjs.supportsMediaSource=t.B;var u=dashjs}(),i.default}()}(o_);var s_=o_.exports;const l_=i({__proto__:null,default:Q(s_)},[s_]);return class{async render(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;const s=new o(new l),u=document.getElementById(e);if(!u)throw new r;const d=new He;if("video"!==t.mediaType)throw new c("Unsupported formats.");new Ge(s,d).render(u,t,n,i,a)}getCurrentAdData(){return{}}}});
